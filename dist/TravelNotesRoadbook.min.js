/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 3.6.0
 * Build 00066 - 2022-06-03T08:22:52+0200 
 * Copyright 2017 2022 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";class t{_private_url;_private_errorsString;constructor(t,e){this._private_url=t,this._private_errorsString=e}get url(){return this._private_url}get errorsString(){return this._private_errorsString}}class e{_private_htmlString;_private_errorsString;constructor(t,e){this._private_htmlString=t,this._private_errorsString=e}get htmlString(){return this._private_htmlString}get errorsString(){return this._private_errorsString}}class r{_private_validityMap=new Map;constructor(){this._private_validityMap.set("a",["href","target"]),this._private_validityMap.set("div",[]),this._private_validityMap.set("del",[]),this._private_validityMap.set("em",[]),this._private_validityMap.set("figcaption",[]),this._private_validityMap.set("figure",[]),this._private_validityMap.set("h1",[]),this._private_validityMap.set("h2",[]),this._private_validityMap.set("h3",[]),this._private_validityMap.set("h4",[]),this._private_validityMap.set("h5",[]),this._private_validityMap.set("h6",[]),this._private_validityMap.set("hr",[]),this._private_validityMap.set("img",["src","alt","width","height"]),this._private_validityMap.set("ins",[]),this._private_validityMap.set("li",[]),this._private_validityMap.set("mark",[]),this._private_validityMap.set("ol",[]),this._private_validityMap.set("p",[]),this._private_validityMap.set("s",[]),this._private_validityMap.set("small",[]),this._private_validityMap.set("strong",[]),this._private_validityMap.set("span",[]),this._private_validityMap.set("sub",[]),this._private_validityMap.set("sup",[]),this._private_validityMap.set("ul",[]),this._private_validityMap.set("svg",["xmlns","viewBox","class"]),this._private_validityMap.set("text",["x","y","text-anchor"]),this._private_validityMap.set("polyline",["points","class","transform"]),this._private_validityMap.set("#text",[])}getValidAttributesNames(t){return this._private_validityMap.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this._private_validityMap.get(e)?e:""}}class i{_private_stringifiedHTML="";_private_stringifyErrors="";static _private_htmlSanitizerData=new r;_private_addHtmlEntities(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}_private_stringifyUrl(t,e){const r=this.sanitizeToUrl(t,e).url;""===r&&""!==t?this._private_stringifyErrors+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this._private_stringifiedHTML+=" "+e+'="'+r+'"'}_private_stringifySvgAttributes(t,e){i._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(this._private_stringifiedHTML+=" "+e+'="'+this._private_addHtmlEntities(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))}))}_private_stringifyHTMLAttributes(t,e){t.hasAttribute("target")&&(this._private_stringifiedHTML+=' rel="noopener noreferrer"'),i._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this._private_stringifyUrl(t.getAttribute(e),e):this._private_stringifiedHTML+=" "+e+'="'+this._private_addHtmlEntities(t.getAttribute(e))+'"',t.removeAttribute(e))}))}_private_addStringifyErrors(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this._private_stringifyErrors+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}_private_stringify(t){const e=t.childNodes;for(let r=0;r<e.length;r++){const e=t.childNodes[r],a=i._private_htmlSanitizerData.getValidNodeName(e.nodeName);""===a?this._private_stringifyErrors+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===a?this._private_stringifiedHTML+=this._private_addHtmlEntities(e.nodeValue):(this._private_stringifiedHTML+="<"+a,"svg"===a||"text"===a||"polyline"===a?this._private_stringifySvgAttributes(e,a):this._private_stringifyHTMLAttributes(e,a),this._private_stringifiedHTML+=">",this._private_stringify(e),this._private_stringifiedHTML+="</"+a+">",e.attributes&&this._private_addStringifyErrors(e))}}_private_cloneSvg(t,e){const r=document.createElementNS("http://www.w3.org/2000/svg",e);return i._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(r.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))})),r}_private_cloneHTML(t,e){const r=document.createElement(e);return i._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const i=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==i&&r.setAttribute(e,i)}else r.setAttribute(e,t.getAttribute(e))})),t.hasAttribute("target")&&r.setAttribute("rel","noopener noreferrer"),r}_private_cloneNode(t,e){const r=t.childNodes;for(let a=0;a<r.length;a++){const r=t.childNodes[a],s=i._private_htmlSanitizerData.getValidNodeName(r.nodeName);if("#text"===s)e.appendChild(document.createTextNode(r.nodeValue));else if(""!==s){const t="svg"===s||"text"===s||"polyline"===s?this._private_cloneSvg(r,s):this._private_cloneHTML(r,s);e.appendChild(t),this._private_cloneNode(r,t)}}}constructor(){}sanitizeToHtmlElement(t,e){const r=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),i=new DocumentFragment;r&&"#document"===r.nodeName?(this._private_cloneNode(r.body.firstChild,i),e.appendChild(i)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this._private_cloneNode(t,e),e}sanitizeToHtmlString(t){this._private_stringifiedHTML="",this._private_stringifyErrors="";const r=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html");return r&&"#document"===r.nodeName?(this._private_stringify(r.body.firstChild),new e(this._private_stringifiedHTML,this._private_stringifyErrors)):new e("","Parsing error")}sanitizeToUrl(e,r){const i=r||"href",a=(new DOMParser).parseFromString("<div>"+e+"</div>","text/html");if(!a||"#document"!==a.nodeName)return new t("","Parsing error");const s=a.body.firstChild;let o="";for(let e=0;e<s.childNodes.length;e++){if("#text"!==s.childNodes[e].nodeName)return new t("","Invalid characters found in the url");o+=s.childNodes[e].nodeValue}if(o=o.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),o!==e)return new t("","Invalid characters found in the url");const n=["https:"];if("http:"!==window.location.protocol&&"href"!==i||n.push("http:"),"href"===i){n.push("mailto:"),n.push("sms:"),n.push("tel:");const e=o.match(/^\u0023\w*/);if(e&&o===e[0])return new t(o,"")}"src"===i&&n.push("data:");let l=null;try{l=new URL(o)}catch(e){return new t("","Invalid url string")}if(-1===n.indexOf(l.protocol))return new t("","Invalid protocol "+l.protocol);if(-1!==["sms:","tel:"].indexOf(l.protocol))return l.pathname.match(/^\+[0-9,*,\u0023]*$/)?new t(o,""):new t("","Invalid sms: or tel: url");try{encodeURIComponent(l.href)}catch(e){return new t("","Invalid character in url")}return new t(o,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const r=e.body.firstChild;let i="";for(let t=0;t<r.childNodes.length;t++){if("#text"!==r.childNodes[t].nodeName)return"";i+=r.childNodes[t].nodeValue}return i=i.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),i}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const a=new i;const s=new class{_private_translations=new Map;constructor(){}setTranslations(t){t.forEach((t=>this._private_translations.set(t.msgid,a.sanitizeToJsString(t.msgstr))))}getText(t,e){let r=this._private_translations.get(t);return e&&r&&Object.getOwnPropertyNames(e).forEach((t=>r=r.replace("{"+t+"}",e[t]))),r||t}};class o{_private_indexedDb;_private_UUID;_private_data;static get _private_DB_VERSION(){return 1}_private_open(t,e){if(this._private_indexedDb)return void t();const r=window.indexedDB.open("TravelNotesDb",o._private_DB_VERSION);r.onerror=()=>{this._private_indexedDb=null,e(new Error("Not possible to open the db"))},r.onsuccess=e=>{this._private_indexedDb=e.target.result,t()},r.onupgradeneeded=t=>{this._private_indexedDb=t.target.result,this._private_indexedDb.createObjectStore("Travels",{keyPath:"UUID"})}}_private_read(t,e){if(!this._private_indexedDb)return void e(new Error("Database not opened"));const r=this._private_indexedDb.transaction(["Travels"],"readonly");r.onerror=()=>e(new Error("Transaction error"));r.objectStore("Travels").get(this._private_UUID).onsuccess=e=>t(e.target.result?e.target.result.data:null)}_private_write(t,e){if(!this._private_indexedDb)return void e(new Error("Database not opened"));const r=this._private_indexedDb.transaction(["Travels"],"readwrite");r.onerror=()=>e(new Error("Transaction error"));r.objectStore("Travels").put({UUID:this._private_UUID,data:this._private_data}).onsuccess=()=>t()}_private_close(){this._private_indexedDb.close(),this._private_indexedDb=null}constructor(){}getOpenPromise(){return new Promise(((t,e)=>this._private_open(t,e)))}getReadPromise(t){return this._private_UUID=t,new Promise(((t,e)=>this._private_read(t,e)))}getWritePromise(t,e){return this._private_UUID=t,this._private_data=e,new Promise(((t,e)=>this._private_write(t,e)))}closeDb(t){if(!this._private_indexedDb)return;if(!t)return void this._private_close();const e=this._private_indexedDb.transaction(["Travels"],"readwrite");e.onerror=()=>{};const r=e.objectStore("Travels").delete(t);r.onerror=()=>this._private_close(),r.onsuccess=()=>this._private_close()}}const n=new o;const l=new class{_private_travelNotesHtmlElement;_private_showTravelNotes;_private_showRouteNotes;_private_showManeuversNotes;_private_showSmallNotes;_private_toggleNotes(t,e){document.querySelectorAll(t).forEach((t=>{e?t.classList.remove("TravelNotes-Hidden"):t.classList.add("TravelNotes-Hidden")}))}_private_toggleSmallNotes(t){t?(this._private_travelNotesHtmlElement.classList.add("TravelNotes-SmallNotes"),this._private_travelNotesHtmlElement.classList.remove("TravelNotes-BigNotes")):(this._private_travelNotesHtmlElement.classList.add("TravelNotes-BigNotes"),this._private_travelNotesHtmlElement.classList.remove("TravelNotes-SmallNotes")),document.querySelectorAll(".TravelNotes-Roadbook-Travel-Notes-IconCell, .TravelNotes-Roadbook-Route-ManeuversAndNotes-IconCell").forEach((e=>{e.style.width=t?"6cm":e.dataset.tanWidth,e.style.height=t?"6cm":e.dataset.tanHeight}))}constructor(){this._private_travelNotesHtmlElement=document.getElementById("TravelNotes"),this._private_showTravelNotes=!0,this._private_showRouteNotes=!0,this._private_showManeuversNotes=!1,this._private_showSmallNotes=!1}get showTravelNotes(){return this._private_showTravelNotes}set showTravelNotes(t){this._private_showTravelNotes=t,this._private_toggleNotes(".TravelNotes-Roadbook-Travel-Notes-Row",t)}get showRouteNotes(){return this._private_showRouteNotes}set showRouteNotes(t){this._private_showRouteNotes=t,this._private_toggleNotes(".TravelNotes-Roadbook-Route-Notes-Row",t)}get showManeuversNotes(){return this._private_showManeuversNotes}set showManeuversNotes(t){this._private_showManeuversNotes=t,this._private_toggleNotes(".TravelNotes-Roadbook-Route-Maneuvers-Row",t)}get showSmallNotes(){return this._private_showSmallNotes}set showSmallNotes(t){this._private_showSmallNotes=t,this._private_toggleSmallNotes(t)}updateNotes(){this.showTravelNotes=this._private_showTravelNotes,this.showRouteNotes=this._private_showRouteNotes,this.showManeuversNotes=this._private_showManeuversNotes,this.showSmallNotes=this._private_showSmallNotes}updateRoadbook(t){this._private_travelNotesHtmlElement.innerHTML=t;const e=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name");e&&(document.title=""===e.textContent?"roadbook":e.textContent+" - roadbook"),document.querySelectorAll(".TravelNotes-Roadbook-Travel-Notes-IconCell, .TravelNotes-Roadbook-Route-ManeuversAndNotes-IconCell").forEach((t=>{t.style.width=t.dataset.tanWidth,t.style.height=t.dataset.tanHeight})),this.updateNotes()}};class _{constructor(){}handleEvent(t){t.stopPropagation(),l.showTravelNotes=t.target.checked}}class v{constructor(){}handleEvent(t){t.stopPropagation(),l.showRouteNotes=t.target.checked}}class d{constructor(){}handleEvent(t){t.stopPropagation(),l.showManeuversNotes=t.target.checked}}class h{constructor(){}handleEvent(t){t.stopPropagation(),l.showSmallNotes=t.target.checked}}class p{_private_UUID=null;constructor(t){this._private_UUID=t}handleEvent(){n.getReadPromise(this._private_UUID).then((t=>{t?l.updateRoadbook(t):l.updateRoadbook("")})).catch((t=>{t instanceof Error&&console.error(t)}))}}class c{constructor(){}handleEvent(){window.print()}}class u{constructor(){}handleEvent(){try{const t=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name").textContent+"-Roadbook.html",e=document.getElementById("TravelNotes-ButtonsDiv"),r=e.removeChild(document.getElementById("TravelNotes-SaveButton")),i=window.URL.createObjectURL(new File(["<!DOCTYPE html>",document.documentElement.outerHTML],t,{type:"text/plain"})),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download",t),a.style.display="none",a.click(),window.URL.revokeObjectURL(i),e.appendChild(r)}catch(t){t instanceof Error&&console.error(t)}}}(new class{_private_UUID=null;_private_language="fr";_private_saveButton=null;_private_initCheckboxes(){document.getElementById("TravelNotes-Travel-ShowNotes").checked=l.showTravelNotes,document.getElementById("TravelNotes-Routes-ShowNotes").checked=l.showRouteNotes,document.getElementById("TravelNotes-Routes-ShowManeuvers").checked=l.showManeuversNotes,document.getElementById("TravelNotes-Routes-ShowSmallNotes").checked=l.showSmallNotes}_private_addEventListeners(){document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",new _),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",new v),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",new d),document.getElementById("TravelNotes-Routes-ShowSmallNotes").addEventListener("change",new h),document.getElementById("TravelNotes-PrintButton").addEventListener("click",new c)}_private_addSaveButton(){this._private_saveButton=document.createElement("div"),this._private_saveButton.id="TravelNotes-SaveButton",this._private_saveButton.textContent="💾",this._private_saveButton.className="TravelNotes-RoadbookButton",this._private_saveButton.addEventListener("click",new u),document.getElementById("TravelNotes-ButtonsDiv").appendChild(this._private_saveButton)}_private_openIndexedDb(){n.getOpenPromise().then((()=>n.getReadPromise(this._private_UUID))).then((t=>l.updateRoadbook(t))).catch((t=>{t instanceof Error&&console.error(t)})),window.addEventListener("storage",new p(this._private_UUID)),window.addEventListener("unload",(()=>n.closeDb()))}_private_loadTranslations(){fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+this._private_language.toUpperCase()+".json").then((t=>{200===t.status&&t.ok&&t.json().then((t=>s.setTranslations(t))).then((()=>this._private_translatePage())).catch((t=>{t instanceof Error&&console.error(t)}))})).catch()}_private_translatePage(){document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=s.getText("RoadbookLoader - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=s.getText("RoadbookLoader - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=s.getText("RoadbookLoader - show routes notes"),document.getElementById("TravelNotes-Routes-ShowSmallNotesLabel").textContent=s.getText("RoadbookLoader - show small routes notes")}constructor(){let t=new URLSearchParams(document.location.search.substring(1));this._private_UUID=t.get("page"),this._private_language=t.get("lng")||"fr"}loadRoadbook(){this._private_initCheckboxes(),this._private_addEventListeners(),this._private_UUID&&(this._private_addSaveButton(),this._private_openIndexedDb(),this._private_loadTranslations()),l.updateNotes()}}).loadRoadbook()}();
/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 4.0.0-beta
 * Build 02351 - 2022-09-16T14:58:50+0200 
 * Copyright 2017 2022 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";const t={ApiKeys:{saveToSessionStorage:!0},ApiKeysDialog:{haveUnsecureButtons:!0,showApiKeys:!1,showButton:!0},baseDialog:{cancelTouchX:100,cancelTouchY:150,deltaZoomDistance:75,touchTopScreen:!0},contextMenu:{timeout:1500},dockableBaseDialog:{timeout:1500},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!1,showInfo:!0,showWarning:!0,timeOut:1e4},files:{openGpx:["gpx"],openTaN:["json","trv"],writeTouch:"trv",writeOthers:"trv"},fontSize:{initialValue:3.5,incrementValue:.5},FullScreenUI:{timeOut:5e3,screenMaxWidth:1200},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:0},options:{enableHighAccuracy:!0,maximumAge:0,timeout:36e5},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},mapContextMenu:{mouseMaxRouteDistance:10,touchMaxRouteDistance:10},mapLayersToolbar:{theDevil:{addButton:!0}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:6,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},theDevil:{addButton:!0,zoomFactor:17}},osmSearchDialog:{dialogX:50,dialogY:0},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"——————",iDashArray:[0]},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:0,width:5},routeEditor:{showEditedRouteInRoadbook:!0},toolbars:{timeOut:1500},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr",startupRouteEdition:!0},TravelNotesToolbar:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},travelNotesDialog:{dialogX:250,dialogY:0},travelPropertiesDialog:{dialogX:50,dialogY:0},wayPoint:{reverseGeocoding:!0,geocodingIncludeName:!0}};class e{#t=new Map;constructor(){Object.freeze(this),this.#t.set("a",["href","target"]),this.#t.set("div",[]),this.#t.set("del",[]),this.#t.set("em",[]),this.#t.set("figcaption",[]),this.#t.set("figure",[]),this.#t.set("h1",[]),this.#t.set("h2",[]),this.#t.set("h3",[]),this.#t.set("h4",[]),this.#t.set("h5",[]),this.#t.set("h6",[]),this.#t.set("hr",[]),this.#t.set("img",["src","alt","width","height"]),this.#t.set("ins",[]),this.#t.set("li",[]),this.#t.set("mark",[]),this.#t.set("ol",[]),this.#t.set("p",[]),this.#t.set("s",[]),this.#t.set("small",[]),this.#t.set("strong",[]),this.#t.set("span",[]),this.#t.set("sub",[]),this.#t.set("sup",[]),this.#t.set("ul",[]),this.#t.set("svg",["xmlns","viewBox","class"]),this.#t.set("text",["x","y","text-anchor"]),this.#t.set("polyline",["points","class","transform"]),this.#t.set("#text",[])}getValidAttributesNames(t){return this.#t.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#t.get(e)?e:""}}class i{#e;#i;constructor(t,e){Object.freeze(this),this.#e=t,this.#i=e}get htmlString(){return this.#e}get errorsString(){return this.#i}}class o{#o;#i;constructor(t,e){Object.freeze(this),this.#o=t,this.#i=e}get url(){return this.#o}get errorsString(){return this.#i}}class r{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class a{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class s{static get fixed(){return 2}static get defaultValue(){return 0}}class n{static get refusedByUser(){return-1}static get disabled(){return 0}static get inactive(){return 1}static get active(){return 2}}class l{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class d{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class c{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}const h=6371e3,u=200,g=-1,m=-1,p="http://www.w3.org/2000/svg";class y{#r="";#a="";static#s=new e;#n(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#l(t,e){const i=this.sanitizeToUrl(t,e).url;""===i&&""!==t?this.#a+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#r+=" "+e+'="'+i+'"'}#d(t,e){y.#s.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(this.#r+=" "+e+'="'+this.#n(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))}))}#c(t,e){t.hasAttribute("target")&&(this.#r+=' rel="noopener noreferrer"'),y.#s.getValidAttributesNames(e).forEach((e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#l(t.getAttribute(e),e):this.#r+=" "+e+'="'+this.#n(t.getAttribute(e))+'"',t.removeAttribute(e))}))}#h(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#a+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#u(t){const e=t.childNodes;for(let i=0;i<e.length;i++){const e=t.childNodes[i],o=y.#s.getValidNodeName(e.nodeName);""===o?this.#a+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===o?this.#r+=this.#n(e.nodeValue):(this.#r+="<"+o,"svg"===o||"text"===o||"polyline"===o?this.#d(e,o):this.#c(e,o),this.#r+=">",this.#u(e),this.#r+="</"+o+">",e.attributes&&this.#h(e))}}#g(t,e){const i=document.createElementNS(p,e);return y.#s.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(i.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))})),i}#m(t,e){const i=document.createElement(e);return y.#s.getValidAttributesNames(e).forEach((e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const o=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==o&&i.setAttribute(e,o)}else i.setAttribute(e,t.getAttribute(e))})),t.hasAttribute("target")&&i.setAttribute("rel","noopener noreferrer"),i}#p(t,e){const i=t.childNodes;for(let o=0;o<i.length;o++){const i=t.childNodes[o],r=y.#s.getValidNodeName(i.nodeName);if("#text"===r)e.appendChild(document.createTextNode(i.nodeValue));else if(""!==r){const t="svg"===r||"text"===r||"polyline"===r?this.#g(i,r):this.#m(i,r);e.appendChild(t),this.#p(i,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),o=new DocumentFragment;i&&"#document"===i.nodeName?(this.#p(i.body.firstChild,o),e.appendChild(o)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#p(t,e),e}sanitizeToHtmlString(t){this.#r="",this.#a="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#u(e.body.firstChild),new i(this.#r,this.#a)):new i("","Parsing error")}sanitizeToUrl(t,e){const i=e||"href",r=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!r||"#document"!==r.nodeName)return new o("","Parsing error");const a=r.body.firstChild;let s="";for(let t=0;t<a.childNodes.length;t++){if("#text"!==a.childNodes[t].nodeName)return new o("","Invalid characters found in the url");s+=a.childNodes[t].nodeValue}if(s=s.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),s!==t)return new o("","Invalid characters found in the url");const n=["https:"];if("http:"!==window.location.protocol&&"href"!==i||n.push("http:"),"href"===i){n.push("mailto:"),n.push("sms:"),n.push("tel:");const t=s.match(/^\u0023\w*/);if(t&&s===t[0])return new o(s,"")}"src"===i&&n.push("data:");let l=null;try{l=new URL(s)}catch(t){return new o("","Invalid url string")}if(m===n.indexOf(l.protocol))return new o("","Invalid protocol "+l.protocol);if(m!==["sms:","tel:"].indexOf(l.protocol))return l.pathname.match(/^\+[0-9,*,\u0023]*$/)?new o(s,""):new o("","Invalid sms: or tel: url");try{encodeURIComponent(l.href)}catch(t){return new o("","Invalid character in url")}return new o(s,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const i=e.body.firstChild;let o="";for(let t=0;t<i.childNodes.length;t++){if("#text"!==i.childNodes[t].nodeName)return"";o+=i.childNodes[t].nodeValue}return o=o.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),o}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const b=new y;class f{#y(t,e){if("object"==typeof t&&"object"==typeof e){for(const i in e)"object"==typeof e[i]?this.#y(t[i],e[i]):typeof t[i]==typeof e[i]&&("string"==typeof e[i]?e[i]="color"===i?b.sanitizeToColor(t[i])||e[i]:"url"===i?b.sanitizeToUrl(t[i]).url:b.sanitizeToJsString(t[i]):e[i]=t[i]||e[i]);for(const i in t)"object"==typeof t[i]?("[object Array]"===Object.prototype.toString.call(t[i])?e[i]=e[i]||[]:e[i]=e[i]||{},this.#y(t[i],e[i])):"string"==typeof e.property?e[i]=b.sanitizeToHtmlString(t[i],[]).htmlString:e[i]=t[i]}}#b(t){for(const e in t)"object"==typeof t[e]&&this.#b(t[e]);Object.freeze(t)}constructor(){Object.freeze(this)}overload(e){this.#y(e,t),this.#b(t)}}class v{static#f=0;static get nextObjId(){return++v.#f}}const T="2.4.0";class j{#v="";#T=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];#j=[];constructor(t,e){if(Object.freeze(this),m===this.#T.indexOf(t))throw new Error("Invalid ObjType name : "+t);this.#v=t,this.#j=e,Object.freeze(this.#j)}get name(){return this.#v}get version(){return T}get properties(){return this.#j}get jsonObject(){return{name:this.#v,version:T}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this.#v);if(this.#v!==t.name)throw new Error("Invalid name for "+this.#v);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this.#v)}}class L{#L=null;#w=m;constructor(t){Object.freeze(this),this.#L=t}get value(){return this.#w<this.#L.length?this.#L.at(this.#w):null}get previous(){return 0>=this.#w?null:this.#L.at(this.#w-1)}get next(){return this.#w<this.#L.length-1?this.#L.at(this.#w+1):null}get done(){return++this.#w>=this.#L.length}get first(){return 0===this.#w}get last(){return this.#w>=this.#L.length-1}get index(){return this.#w}}class w{#N;#I;#E;#M(t){return this.#N.findIndex((e=>e.objId===t))}#O(t,e,i){let o=this.#M(t);if(m===o)throw new Error("invalid objId for next or previous function");if(1!==i&&-1!==i)throw new Error("invalid direction");let r=e;for(r||(r=()=>!0),o+=i;m<o&&o<this.#N.length&&!r(this.#N[o]);)o+=i;return m===o||this.#N.length===o?null:this.#N[o]}constructor(t){Object.freeze(this),this.#N=[],this.#E=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this.#I=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this.#I)throw new Error("invalid object name for add function");this.#N.push(t)}at(t){return t<this.#N.length&&t>m?this.#N[t]:null}forEach(t){let e=null;const i=this.iterator;for(;!i.done;)e=t(i.value,e);return e}getAt(t){const e=this.#M(t);return m===e?null:this.#N[e]}moveTo(t,e,i){let o=this.#M(t),r=this.#M(e);if(m===o||m===r)throw new Error("invalid objId for function  myMoveTo");i||r++,this.#N.splice(r,0,this.#N[o]),r<o&&o++,this.#N.splice(o,1)}next(t,e){return this.#O(t,e,1)}previous(t,e){return this.#O(t,e,-1)}remove(t){const e=this.#M(t);if(m===e)throw new Error("invalid objId for remove function");this.#N.splice(e,1)}removeAll(t){t?this.#N.splice(1,this.#N.length-2):this.#N.length=0}replace(t,e){const i=this.#M(t);if(m===i)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this.#I)throw new Error("invalid object name for replace function");this.#N[i]=e}reverse(){this.#N.reverse()}sort(t){this.#N.sort(t)}swap(t,e){const i=this.#M(t);if(m===i||0===i&&e||this.#N.length-1===i&&!e)throw new Error("invalid objId for swap function");const o=e?-1:1,r=this.#N[i];this.#N[i]=this.#N[i+o],this.#N[i+o]=r}get first(){return this.#N[0]}get iterator(){return new L(this)}get last(){return this.#N[this.#N.length-1]}get length(){return this.#N.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this.#N.length=0,Array.isArray(t)&&t.forEach((t=>{const e=new this.#E;e.jsonObject=t,this.add(e)}))}}const N=new class{#x=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach((t=>this.#x.set(t.msgid,b.sanitizeToJsString(t.msgstr))))}getText(t,e){let i=this.#x.get(t);return e&&i&&Object.getOwnPropertyNames(e).forEach((t=>i=i.replace("{"+t+"}",e[t]))),i||t}};const I=new class{constructor(){Object.freeze(this)}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let i="";for(let o=0;o<16;o++)i+=e[o].toString(16).padStart(2,"0")+t[o];return i}storageAvailable(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return!1}}openFile(t,e){const i=document.createElement("input");i.type="file",e&&(i.accept=e),i.addEventListener("change",t,!1),i.click()}saveFile(t,e,i){try{const o=i?window.URL.createObjectURL(new File([e],t,{type:i})):URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download",t),r.click(),window.URL.revokeObjectURL(o)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const i=Math.floor(e/86400),o=Math.floor(e%86400/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60);return 0<i?i+" "+N.getText("Utilities - Day")+" "+o+" "+N.getText("Utilities - Hour"):0<o?o+" "+N.getText("Utilities - Hour")+" "+r+" "+N.getText("Utilities - Minute"):0<r?r+" "+N.getText("Utilities - Minute"):a+" "+N.getText("Utilities - Second")}formatDistance(t){const e=Math.floor(t);return 0>=e?"0 km":Math.floor(e/a.metersInKm)+","+Math.floor(e%a.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}numberToDMS(t){let e=t,i=Math.floor(t);e-=i;let o=Math.floor(60*e);e-=o/60,e*=3600;let r=Math.floor(e);return e-=r,e=Math.floor(100*e),i.toString()+"° "+o.toString()+"' "+r+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+" N":this.numberToDMS(-t)+" S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+" E":this.numberToDMS(-t)+" W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+" - "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(d.fixed)+" N":(-t).toFixed(d.fixed)+" S"}formatLng(t){return t>0?t.toFixed(d.fixed)+" E":(-t).toFixed(d.fixed)+" W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+" - "+this.formatLng(t[1])}};class E{#R;#A(){this.#R.routes.forEach((t=>{t.dashArray=0,t.hidden=!1}))}#P(){this.#R.routes.forEach((t=>{t.edited=c.notEdited}))}#S(){this.#P(),this.#R.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"#ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:c.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}#_(){if(this.#R.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find((t=>t.layerId===this.#R.userData.layerId));this.#R.layerName=t?t.layerName:"OSM - Color"}else this.#R.layerName="OSM - Color"}#H(t){t.forEach((t=>{t.elev=s.defaultValue}))}#D(){this.#R.routes.forEach((t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this.#H(t.itinerary.itineraryPoints)})),this.#R.editedRoute.itinerary.hasProfile=!1,this.#R.editedRoute.itinerary.ascent=0,this.#R.editedRoute.itinerary.descent=0,this.#H(this.#R.editedRoute.itinerary.itineraryPoints)}#C(t){t.itinerary.maneuvers.forEach((t=>{"kArriveDefault"===t.iconName&&(t.distance=a.defaultValue)}))}#F(t){t.wayPoints.forEach((t=>{t.address=t.name,t.name=""}))}#z(){this.#R.routes.forEach((t=>{t.editionStatus=t.edited,this.#C(t),this.#F(t)})),this.#R.editedRoute.editionStatus=this.#R.editedRoute.edited,this.#C(this.#R.editedRoute),this.#F(this.#R.editedRoute)}#V(){this.#R.routes.forEach((t=>{t.dashIndex=t.dashArray})),this.#R.editedRoute.dashIndex=this.#R.editedRoute.dashArray}#U(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}#k(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this.#U(t.iconContent),t.popupContent=this.#U(t.popupContent),t.tooltipContent=this.#U(t.tooltipContent),t.phone=this.#U(t.phone),t.address=this.#U(t.address)}#B(){this.#R.notes.forEach((t=>{this.#k(t)})),this.jsonTravel.routes.forEach((t=>{t.notes.forEach((t=>{this.#k(t)}))}))}#W(){switch(this.#R.objType.version){case"1.0.0":this.#A();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this.#S();case"1.5.0":this.#_();case"1.6.0":this.#D();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this.#z();case"1.12.0":case"1.13.0":this.#B();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this.#V(),this.#R.objType.version="2.4.0";break;default:throw new Error("invalid version for travel")}}constructor(){Object.freeze(this)}update(t){t.objType.version!==T&&(this.#R=t,this.#W())}}class M{constructor(){Object.freeze(this)}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new E).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach((t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)})),t}}class O extends M{static#G=new j("WayPoint",["address","name","lat","lng","objId"]);#Z="";#X="";#K=d.defaultValue;#J=d.defaultValue;#f=g;constructor(){super(),this.#f=v.nextObjId}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?b.sanitizeToJsString(t):""}get address(){return this.#X}set address(t){this.#X="string"==typeof t?b.sanitizeToJsString(t):""}get lat(){return this.#K}set lat(t){this.#K="number"==typeof t?t:d.defaultValue}get lng(){return this.#J}set lng(t){this.#J="number"==typeof t?t:d.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=I.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#K=t[0],this.#J=t[1]):(this.#K=d.defaultValue,this.#J=d.defaultValue)}get objId(){return this.#f}get objType(){return O.#G}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(d.fixed)),lng:parseFloat(this.lng.toFixed(d.fixed)),objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.#f=v.nextObjId}}class x extends M{static#G=new j("ItineraryPoint",["lat","lng","distance","elev","objId"]);#K=d.defaultValue;#J=d.defaultValue;#Y=a.defaultValue;#$=s.defaultValue;#f=g;constructor(){super(),this.#f=v.nextObjId}get lat(){return this.#K}set lat(t){this.#K="number"==typeof t?t:d.defaultValue}get lng(){return this.#J}set lng(t){this.#J="number"==typeof t?t:d.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:a.defaultValue}get elev(){return this.#$}set elev(t){this.#$="number"==typeof t?t:d.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#K=t[0],this.#J=t[1]):(this.#K=d.defaultValue,this.#J=d.defaultValue)}get objType(){return x.#G}get objId(){return this.#f}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(d.fixed)),lng:parseFloat(this.lng.toFixed(d.fixed)),distance:parseFloat(this.distance.toFixed(a.fixed)),elev:parseFloat(this.elev.toFixed(s.fixed)),objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this.#f=v.nextObjId}}class R extends M{static#G=new j("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);#q="";#Q="";#tt=g;#Y=a.defaultValue;#et=a.defaultValue;#f=g;constructor(){super(),this.#f=v.nextObjId}get iconName(){return this.#q}set iconName(t){this.#q="string"==typeof t?b.sanitizeToJsString(t):""}get instruction(){return this.#Q}set instruction(t){this.#Q="string"==typeof t?b.sanitizeToJsString(t):""}get itineraryPointObjId(){return this.#tt}set itineraryPointObjId(t){this.#tt="number"==typeof t?t:g}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:a.defaultValue}get duration(){return this.#et}set duration(t){this.#et="number"==typeof t?t:a.defaultValue}get objType(){return R.#G}get objId(){return this.#f}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(a.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this.#f=v.nextObjId}}class A extends M{static#G=new j("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);#f=g;#it=!1;#ot=0;#rt=0;#at="";#st="";#nt=new w(x);#lt=new w(R);constructor(){super(),this.#f=v.nextObjId}get hasProfile(){return this.#it}set hasProfile(t){this.#it="boolean"==typeof t&&t}get ascent(){return this.#ot}set ascent(t){this.#ot="number"==typeof t?Number.parseInt(t):0}get descent(){return this.#rt}set descent(t){this.#rt="number"==typeof t?Number.parseInt(t):0}get provider(){return this.#at}set provider(t){this.#at="string"==typeof t?b.sanitizeToJsString(t):""}get transitMode(){return this.#st}set transitMode(t){this.#st="string"==typeof t?b.sanitizeToJsString(t):""}get itineraryPoints(){return this.#nt}get maneuvers(){return this.#lt}get objType(){return A.#G}get objId(){return this.#f}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this.#f=v.nextObjId;const i=new Map;let o=0;const r=this.itineraryPoints.iterator;for(;!r.done;)i.set(e.itineraryPoints[o].objId,r.value.objId),o++;const a=this.maneuvers.iterator;for(;!a.done;)a.value.itineraryPointObjId=i.get(a.value.itineraryPointObjId)}}class P extends M{static#G=new j("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);#dt=l.height;#ct=l.width;#ht="";#ut="";#gt="";#mt="";#o="";#X="";#pt=d.defaultValue;#yt=d.defaultValue;#K=d.defaultValue;#J=d.defaultValue;#Y=a.invalid;#bt=a.defaultValue;#f=g;constructor(){super(),this.#f=v.nextObjId}get iconHeight(){return this.#dt}set iconHeight(t){this.#dt="number"==typeof t?t:l.height}get iconWidth(){return this.#ct}set iconWidth(t){this.#ct="number"==typeof t?t:l.width}get iconContent(){return this.#ht}set iconContent(t){this.#ht="string"==typeof t?b.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this.#ut}set popupContent(t){this.#ut="string"==typeof t?b.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this.#gt}set tooltipContent(t){this.#gt="string"==typeof t?b.sanitizeToHtmlString(t).htmlString:""}get phone(){return this.#mt}set phone(t){this.#mt="string"==typeof t?b.sanitizeToHtmlString(t).htmlString:""}get url(){return this.#o}set url(t){this.#o="string"==typeof t?encodeURI(b.sanitizeToUrl(t).url):""}get address(){return this.#X}set address(t){this.#X="string"==typeof t?b.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this.#pt}set iconLat(t){this.#pt="number"==typeof t?t:d.defaultValue}get iconLng(){return this.#yt}set iconLng(t){this.#yt="number"==typeof t?t:d.defaultValue}get lat(){return this.#K}set lat(t){this.#K="number"==typeof t?t:d.defaultValue}get lng(){return this.#J}set lng(t){this.#J="number"==typeof t?t:d.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:a.invalid}get chainedDistance(){return this.#bt}set chainedDistance(t){this.#bt="number"==typeof t?t:a.defaultValue}get isRouteNote(){return this.#Y!==a.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#pt=t[0],this.#yt=t[1]):(this.#pt=d.defaultValue,this.#yt=d.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#K=t[0],this.#J=t[1]):(this.#K=d.defaultValue,this.#J=d.defaultValue)}get objType(){return P.#G}get objId(){return this.#f}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(d.fixed)),iconLng:parseFloat(this.iconLng.toFixed(d.fixed)),lat:parseFloat(this.lat.toFixed(d.fixed)),lng:parseFloat(this.lng.toFixed(d.fixed)),distance:parseFloat(this.distance.toFixed(a.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(a.fixed)),objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this.#f=v.nextObjId}}class S extends M{static#G=new j("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);#Z="";#ft=new w(O);#vt=new w(P);#Tt=new A;#jt=t.route.width;#Lt=t.route.color;#wt=t.route.dashIndex;#Nt=!0;#bt=a.defaultValue;#Y=a.defaultValue;#et=a.defaultValue;#It=c.notEdited;#Et=!1;#f=g;constructor(){super(),this.#ft.add(new O),this.#ft.add(new O),this.#f=v.nextObjId}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?b.sanitizeToJsString(t):""}get wayPoints(){return this.#ft}get notes(){return this.#vt}get itinerary(){return this.#Tt}get width(){return this.#jt}set width(e){this.#jt="number"==typeof e?e:t.route.width}get color(){return this.#Lt}set color(e){this.#Lt="string"==typeof e&&b.sanitizeToColor(e)||t.route.color}get dashIndex(){return this.#wt}set dashIndex(e){this.#wt="number"==typeof e&&t.route.dashChoices[e]?e:0}get dashString(){let e="";return t.route.dashChoices[this.#wt].iDashArray.forEach((t=>e+=String(t*this.#jt)+",")),e.substring(0,e.length-1)}get chain(){return this.#Nt}set chain(t){this.#Nt="boolean"==typeof t&&t}get chainedDistance(){return this.#bt}set chainedDistance(t){this.#bt="number"==typeof t?t:a.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:a.defaultValue}get duration(){return this.#et}set duration(t){this.#et="number"==typeof t?t:a.defaultValue}get editionStatus(){return this.#It}set editionStatus(t){this.#It="number"==typeof t?t:c.notEdited}get hidden(){return this.#Et}set hidden(t){this.#Et="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this.#f}get objType(){return S.#G}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach((e=>{t=t&&d.defaultValue!==e.lat&&d.defaultValue!==e.lng})),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(a.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(a.fixed)),objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this.#f=v.nextObjId}}class _ extends M{static#G=new j("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);#Mt=new S;#Ot=new w(S);#vt=new w(P);#xt="OSM - Color";#Z="";#Rt=!1;#f=g;constructor(){super(),this.#Ot.add(new S),this.#f=v.nextObjId}get editedRoute(){return this.#Mt}set editedRoute(t){this.#Mt="Route"===t?.objType?.name?t:new S}get routes(){return this.#Ot}get notes(){return this.#vt}get layerName(){return this.#xt}set layerName(t){this.#xt="string"==typeof t?b.sanitizeToJsString(t):"OSM - Color"}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?b.sanitizeToJsString(t):""}get readOnly(){return this.#Rt}set readOnly(t){this.#Rt="boolean"!=typeof t||t}get objId(){return this.#f}get objType(){return _.#G}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this.#f,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this.#f=v.nextObjId}}class H{#at="";#st="";constructor(){Object.freeze(this)}get provider(){return this.#at}set provider(t){this.#at="string"==typeof t?t:""}get transitMode(){return this.#st}set transitMode(t){this.#st="string"==typeof t?t:""}}const D=new class{#At;#Pt;#St;#_t;#Ht;#Dt;#Ct;#Ft;constructor(){Object.freeze(this),this.#At=new Map,this.#Pt=new Map,this.#St=new H,this.#_t=I.UUID,this.#Ht=null,this.#Dt=new _,this.#Ct=g,this.#Ft=[]}get map(){return this.#Ht}set map(t){this.#Ht||(this.#Ht=t)}get travel(){return this.#Dt}get editedRouteObjId(){return this.#Ct}set editedRouteObjId(t){this.#Ct="number"==typeof t?t:g}get searchData(){return this.#Ft}get providers(){return this.#At}get mapObjects(){return this.#Pt}get routing(){return this.#St}get UUID(){return this.#_t}};const C=new class{constructor(){Object.freeze(this)}dispatch(t,e){const i=new Event(t);e&&(i.data=e),document.dispatchEvent(i)}};class F{static get#zt(){return.5}static get#Vt(){return 5}static get#Ut(){return 10}static get#kt(){return 31}static get#Bt(){return 32}static get#Wt(){return 63}#Gt(t){return Math.floor(Math.abs(t)+F.#zt)*(0<=t?1:-1)}#Zt(t,e,i){const o=this.#Gt(t*i),r=this.#Gt(e*i);let a=o-r;a<<=1,0>o-r&&(a=~a);let s="";for(;F.#Bt<=a;)s+=String.fromCharCode((F.#Bt|a&F.#kt)+F.#Wt),a>>=F.#Vt;return s+=String.fromCharCode(a+F.#Wt),s}#w;#Xt(t){let e=null,i=0,o=0;do{e=t.charCodeAt(this.#w++)-F.#Wt,o|=(e&F.#kt)<<i,i+=F.#Vt}while(F.#Bt<=e);return 1&o?~(o>>1):o>>1}constructor(){Object.freeze(this)}encode(t,e){if(!t.length)return"";const i=e.length,o=Array.from(e,(t=>Math.pow(F.#Ut,t)));let r="";for(let e=0;e<i;e++)r+=this.#Zt(t[0][e],0,o[e]);for(let e=1;e<t.length;e++){const a=t[e],s=t[e-1];for(let t=0;t<i;t++)r+=this.#Zt(a[t],s[t],o[t])}return r}decode(t,e){const i=e.length;if(!t||0===t.length)return[];this.#w=0;const o=[],r=Array.from(e,(t=>Math.pow(F.#Ut,t))),a=new Array(i).fill(0);for(;this.#w<t.length;){const e=new Array(i).fill(0);for(let o=0;o<i;o++)a[o]+=this.#Xt(t),e[o]=a[o]/r[o];o.push(e)}return o}}class z{#Kt(t){const e={values:"",objType:(new x).objType.jsonObject},i=[];t.itinerary.itineraryPoints.forEach((t=>{i.push([t.lat,t.lng,t.distance,t.elev,t.objId])})),e.values=(new F).encode(i,[d.fixed,d.fixed,2,2,0]),t.itinerary.itineraryPoints=e}#Jt(t){const e=[];if(t.itinerary.itineraryPoints.values)(new F).decode(t.itinerary.itineraryPoints.values,[d.fixed,d.fixed,2,2,0]).forEach((i=>{const o={lat:d.defaultValue,lng:d.defaultValue,distance:a.defaultValue,elev:s.defaultValue,objId:g};[o.lat,o.lng,o.distance,o.elev,o.objId]=i,o.objType=t.itinerary.itineraryPoints.objType,e.push(o)}));else{t.itinerary.itineraryPoints.latLngs=(new F).decode(t.itinerary.itineraryPoints.latLngs,[d.fixed,d.fixed]);let i=0;t.itinerary.itineraryPoints.latLngs.forEach((o=>{const r={};r.lat=o[0],r.lng=o[1],r.distance=t.itinerary.itineraryPoints.distances[i],t.itinerary.itineraryPoints.elevs?r.elev=t.itinerary.itineraryPoints.elevs[i]:r.elev=s.defaultValue,r.objId=t.itinerary.itineraryPoints.objIds[i],r.objType=t.itinerary.itineraryPoints.objType,e.push(r),i++}))}t.itinerary.itineraryPoints=e}constructor(){Object.freeze(this)}decompress(t){t.routes.forEach(this.#Jt),t.editedRoute&&this.#Jt(t.editedRoute)}compress(t){const e=t.jsonObject;return e.routes.forEach((t=>this.#Kt(t))),this.#Kt(e.editedRoute),e}}class V{#K;#J;constructor(t,e){Object.freeze(this),this.#K=t,this.#J=e}static clone(t){return new V(t.lat,t.lng)}get latLng(){return[this.#K,this.#J]}get lat(){return this.#K}get lng(){return this.#J}}class U extends V{#Y;constructor(t,e,i){super(t,e),this.#Y=i}get distance(){return this.#Y}}class k extends U{#$;#ot;constructor(t,e,i,o,r){super(t,e,i),this.#$=o,this.#ot=r}get elev(){return this.#$}get ascent(){return this.#ot}}class B{static get#Yt(){return 100}constructor(){Object.freeze(this)}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let i=0;const o=t.itinerary.itineraryPoints.iterator;for(;i<e&&!o.done;)i+=o.value.distance;const r=o.value;o.done;const a=(r.distance-i+e)/r.distance;return new k(r.lat+(o.value.lat-r.lat)*a,r.lng+(o.value.lng-r.lng)*a,e,r.elev+(o.value.elev-r.elev)*a,B.#Yt*(o.value.elev-r.elev)/r.distance)}getClosestLatLngDistance(t,e){if(0===t.itinerary.itineraryPoints.length)return null;const i=t.itinerary.itineraryPoints.iterator;i.done;let o=Number.MAX_VALUE;const r=window.L.Projection.SphericalMercator.project(window.L.latLng(e[0],e[1]));let s=window.L.Projection.SphericalMercator.project(window.L.latLng(i.value.lat,i.value.lng)),n=null,l=a.defaultValue,d=i.value.distance;for(;!i.done;){const t=window.L.Projection.SphericalMercator.project(window.L.latLng(i.value.lat,i.value.lng));let e=window.L.LineUtil.pointToSegmentDistance(r,s,t);e<o&&(o=e,n=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(r,s,t)),l=d-n.distanceTo(window.L.latLng(i.value.lat,i.value.lng))),d+=i.value.distance,s=t}return new U(n.lat,n.lng,l)}getLatLngBounds(t){const e=window.L.latLng([d.maxLat,d.maxLng]),i=window.L.latLng([d.minLat,d.minLng]);return t.forEach((t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),i.lat=Math.max(i.lat,t[0]),i.lng=Math.max(i.lng,t[1])})),window.L.latLngBounds(e,i)}getSquareBoundingBox(t,e){const i=t[0]*r.toRadians,o=e/h*r.fromRadians,a=Math.acos((Math.cos(e/h)-Math.sin(i)**2)/Math.cos(i)**2)*r.fromRadians;return window.L.latLngBounds(window.L.latLng([t[0]-o,t[1]-a]),window.L.latLng([t[0]+o,t[1]+a]))}project(t,e){const i=D.map.project(window.L.latLng(t),e);return[i.x,i.y]}screenCoordToLatLng(t,e){const i=D.map.containerPointToLatLng(window.L.point(t,e));return[i.lat,i.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const W=new B;const G=new class{#$t(t){return(t+r.d540)%r.d360-r.d180}constructor(){Object.freeze(this)}arcFromSummitArcArc(t,e,i){return Math.acos(Math.cos(e)*Math.cos(i)+Math.sin(e)*Math.sin(i)*Math.cos(t))}summitFromArcArcArc(t,e,i){return Math.acos((Math.cos(i)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(t,e){if(t[0]===e[0]&&t[1]===e[1])return 0;const i=t[0]*r.toRadians,o=e[0]*r.toRadians,a=(this.#$t(e[1])-this.#$t(t[1]))*r.toRadians;return Math.acos(Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos(a))*h}};class Z{#qt;#Qt;constructor(t,e){Object.freeze(this),this.#qt=t,this.#Qt=e}get note(){return this.#qt}get route(){return this.#Qt}}class X{constructor(){Object.seal(this)}distance=Number.MAX_VALUE;route=null;distanceOnRoute=0;latLngOnRoute=[d.defaultValue,d.defaultValue]}const K=new class{#te(t,e,i){if(t.objId!==D.editedRouteObjId){const o=W.getClosestLatLngDistance(t,e);if(o){const r=G.pointsDistance(e,o.latLng);r<i.distance&&(i.route=t,i.distance=r,i.latLngOnRoute=o.latLng,i.distanceOnRoute=o.distance)}}}constructor(){Object.freeze(this)}getNearestRouteData(t){const e=new X;return D.travel.routes.forEach((i=>this.#te(i,t,e))),g!==D.editedRouteObjId&&this.#te(D.travel.editedRoute,t,e),Object.freeze(e)}getRoute(t){let e=null;return e=D.travel.routes.getAt(t),e||t===D.travel.editedRoute.objId&&(e=D.travel.editedRoute),e}getNoteAndRoute(t){let e=null,i=null;if(e=D.travel.notes.getAt(t),!e){const o=D.travel.routes.iterator;for(;!o.done&&!e;)e=o.value.notes.getAt(t),e&&(i=o.value);e||(e=D.travel.editedRoute.notes.getAt(t),e&&(i=D.travel.editedRoute))}return new Z(e,i)}getWayPoint(t){let e=D.travel.editedRoute.wayPoints.getAt(t);if(!e){const i=D.travel.routes.iterator;for(;!i.done&&!e;)e=i.value.wayPoints.getAt(t)}return e}};class J{#ee=[];#ie(t){this.#ee.push(t.latLng),this.#ee.push(t.iconLatLng)}#oe(t){t.itinerary.itineraryPoints.forEach((t=>this.#ee.push(t.latLng))),t.notes.forEach((t=>this.#ie(t)))}constructor(){Object.freeze(this)}zoomToLatLng(t){C.dispatch("zoomto",{latLng:t})}zoomToNote(t){this.#ee=[],this.#ie(K.getNoteAndRoute(t).note),C.dispatch("zoomto",{geometry:[this.#ee]})}zoomToRoute(t){this.#ee=[],this.#oe(K.getRoute(t)),C.dispatch("zoomto",{geometry:[this.#ee]})}zoomToTravel(){this.#ee=[],D.travel.routes.forEach((t=>this.#oe(t))),g!==D.travel.editedRouteObjId&&this.#oe(D.travel.editedRoute),D.travel.notes.forEach((t=>this.#ie(t))),C.dispatch("zoomto",{geometry:[this.#ee]})}zoomToPoi(t){C.dispatch("zoomto",t)}}class Y{constructor(){Object.freeze(this)}openDistantFile(t){(new z).decompress(t),D.travel.jsonObject=t,D.travel.readOnly=!0,document.title="Travel & Notes"+(""===D.travel.name?"":" - "+D.travel.name);const e=D.travel.routes.iterator;for(;!e.done;)c.notEdited===e.value.editionStatus?C.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:e.value.objId}):D.editedRouteObjId=e.value.objId;g!==D.editedRouteObjId&&C.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:D.travel.editedRoute.objId});const i=D.travel.notes.iterator;for(;!i.done;)C.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:i.value.objId});(new J).zoomToTravel()}}const $=new class{#re(t,e){for(const i in e)try{if("dataset"===i){const i=e.dataset;for(const e in i)t.dataset["tan"+e]=i[e]}else t[i]=e[i]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){Object.freeze(this)}create(t,e,i){let o=null;return"text"===t.toLowerCase()?o=document.createTextNode(e.value||""):(o="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this.#re(o,e)),i&&i.appendChild(o),o}};const q=new class{#ae=null;constructor(){Object.freeze(this)}createUI(){this.#ae=$.create("div",{id:"TravelNotes-AttributionsUI"},document.body)}set attributions(t){const e='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>';for(;this.#ae.firstChild;)this.#ae.removeChild(this.#ae.firstChild);b.sanitizeToHtmlElement(e,this.#ae)}};class Q{#se;#Lt;#ne;constructor(t){if("string"!=typeof t?.text||"string"!=typeof t?.color||"string"!=typeof t?.backgroundColor)throw new Error("invalid toolbar for layer");Object.freeze(this),this.#se=b.sanitizeToJsString(t.text),this.#Lt=b.sanitizeToColor(t.color),this.#ne=b.sanitizeToColor(t.backgroundColor)}get text(){return this.#se}get color(){return this.#Lt}get backgroundColor(){return this.#ne}}class tt{#Z=null;#le=null;#o=null;#de=null;#ce=null;#he=null;#ue=null;#ge=null;#me=null;#pe=!1;#ye=null;#be=null;#fe(){if("string"!=typeof this.#be?.name)throw new Error("invalid name for layer");this.#Z=b.sanitizeToJsString(this.#be.name)}#ve(){if("wms"!==this.#be?.service&&"wmts"!==this.#be?.service)throw new Error("invalid service for layer "+this.#Z);this.#le=this.#be.service}#Te(){if("string"!=typeof this.#be?.url)throw new Error("invalid url for layer "+this.#Z);this.#o=this.#be.url}#je(){if("wms"===this.#le){if("string"!=typeof this.#be?.wmsOptions?.layers||"string"!=typeof this.#be?.wmsOptions?.format||"boolean"!=typeof this.#be?.wmsOptions?.transparent)throw new Error("invalid wmsOptions for layer "+this.#Z);this.#de=this.#be.wmsOptions,this.#de.layers=b.sanitizeToJsString(this.#de.layers),this.#de.format=b.sanitizeToJsString(this.#de.format)}}#Le(){try{this.#be.bounds&&"number"==typeof this.#be.bounds[0][0]&&"number"==typeof this.#be.bounds[0][1]&&"number"==typeof this.#be.bounds[1][0]&&"number"==typeof this.#be.bounds[1][1]&&(this.#ce=this.#be.bounds)}catch(t){throw new Error("invalid bounds for layer "+this.#Z)}}#we(){if(this.#be.minZoom){if("number"!=typeof this.#be.minZoom)throw new Error("invalid minZoom for layer "+this.#Z);this.#he=this.#be.minZoom}if(this.#be.maxZoom){if("number"!=typeof this.#be.maxZoom)throw new Error("invalid maxZoom for layer "+this.#Z);this.#ue=this.#be.maxZoom}}#Ne(){this.#ge=new Q(this.#be.toolbar)}#Ie(){if("string"!=typeof this.#be?.providerName)throw new Error("invalid providerName for layer "+this.#Z);this.#me=b.sanitizeToJsString(this.#be.providerName)}#Ee(){if("boolean"!=typeof this.#be.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this.#Z);this.#pe=this.#be.providerKeyNeeded}#Me(){if(""===this.#be.attribution)this.#ye="";else{if("string"!=typeof this.#be?.attribution)throw new Error("invalid attribution for map layer "+this.#Z);this.#ye=b.sanitizeToHtmlString(this.#be.attribution).htmlString}}constructor(t){Object.freeze(this),this.#be=t,this.#fe(),this.#ve(),this.#Te(),this.#je(),this.#Le(),this.#we(),this.#Ne(),this.#Ie(),this.#Ee(),this.#Me(),this.#be=null}get name(){return this.#Z}get service(){return this.#le}get url(){return this.#o}get wmsOptions(){return this.#de}get bounds(){return this.#ce}get minZoom(){return this.#he}get maxZoom(){return this.#ue}get toolbarButtonData(){return this.#ge}get providerName(){return this.#me}get providerKeyNeeded(){return this.#pe}get attribution(){return this.#ye}}class et{#Oe;constructor(t){Object.freeze(this),this.#Oe=t}handleEvent(t){t.stopPropagation();const e=this.#Oe[Number.parseInt(t.target.dataset.tanMapLayerId)];C.dispatch("layerchange",{layer:e}),q.attributions=e.attribution}}const it=new class{#ae;#xe;#Re;#Ae;#Pe;#Se;#_e(){this.#Re&&(clearTimeout(this.#Re),this.#Re=null),this.#ae.classList.remove("TravelNotes-ErrorsUI-"+this.#Se),this.#ae.classList.add("TravelNotes-Hidden"),this.#Pe.classList.add("TravelNotes-Hidden"),this.#xe.textContent=""}#He(e,i){if(this.#Se=i,!t.errorsUI["show"+this.#Se]||"Help"===i&&this.#Ae.checked)return;this.#Re&&(clearTimeout(this.#Re),this.#Re=null),this.#xe.textContent="",b.sanitizeToHtmlElement(e,this.#xe),this.#ae.classList.add("TravelNotes-ErrorsUI-"+this.#Se),this.#ae.classList.remove("TravelNotes-Hidden");let o=t.errorsUI.timeOut;"Help"===this.#Se&&(this.#Pe.classList.remove("TravelNotes-Hidden"),o=t.errorsUI.helpTimeOut),this.#Re=setTimeout((()=>this.#_e()),o)}constructor(){Object.freeze(this)}createUI(){if(this.#ae)return;this.#ae=$.create("div",{id:"TravelNotes-ErrorsUI",className:"TravelNotes-Hidden"},document.body);const e=$.create("div",null,this.#ae);$.create("span",{id:"TravelNotes-ErrorsUI-CancelButton",textContent:"❌"},e).addEventListener("click",(()=>this.#_e()),!1),this.#xe=$.create("div",{id:"TravelNotes-ErrorsUI-Message"},this.#ae),this.#Pe=$.create("div",{id:"TravelNotes-ErrorsUI-HelpInputDiv",className:"TravelNotes-Hidden"},this.#ae),this.#Ae=$.create("input",{id:"TravelNotes-ErrorsUI-HelpInput",type:"checkbox",checked:!t.errorsUI.showHelp},this.#Pe),$.create("label",{id:"TravelNotes-ErrorsUI-HelpInputLabel",htmlFor:"TravelNotes-ErrorsUI-HelpInput",textContent:"Don't show help again"},this.#Pe)}showError(t){this.#He(t,"Error")}showWarning(t){this.#He(t,"Warning")}showInfo(t){this.#He(t,"Info")}showHelp(t){this.#He(t,"Help")}};const ot=new class{#De=navigator.geolocation?n.inactive:n.disabled;#Ce=null;#Fe(t){C.dispatch("geolocationpositionchanged",{position:t})}#ze(){n.active===this.#De&&(this.#De=n.inactive),C.dispatch("geolocationstatuschanged",{status:this.#De}),this.#Ce&&(navigator.geolocation.clearWatch(this.#Ce),this.#Ce=null)}#Ve(t){1===t.code&&(this.#De=n.refusedByUser),2===t.code&&it.showError(N.getText("GeoLocator - Geolocation disabled on the device")),this.#ze()}#Ue(){this.#De=n.active,C.dispatch("geolocationstatuschanged",{status:this.#De}),t.geoLocation.watch?this.#Ce=navigator.geolocation.watchPosition((t=>this.#Fe(t)),(t=>this.#Ve(t)),t.geoLocation.options):navigator.geolocation.getCurrentPosition((t=>this.#Fe(t)),(t=>this.#Ve(t)),t.geoLocation.options)}constructor(){Object.freeze(this)}get status(){return this.#De}switch(){switch(this.#De){case n.inactive:this.#Ue();break;case n.active:this.#ze()}return this.#De}};class rt{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),ot.switch()}}class at{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),(new J).zoomToTravel()}}const st=new class{#ke;#Oe;constructor(){Object.freeze(this),this.#Oe=[];const t=new tt({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""});this.#Oe.push(t)}createUI(){this.#ke=$.create("div",{id:"TravelNotes-ViewerLayersToolbar"},document.body),$.create("div",{className:"TravelNotes-ViewerLayersToolbar-Button",title:"My position",textContent:"🌐",style:"color:black;background-color:white"},this.#ke).addEventListener("click",new rt,!1),$.create("div",{className:"TravelNotes-ViewerLayersToolbar-Button",title:"Zoom on the travel",textContent:"🔍",style:"color:black;background-color:white"},this.#ke).addEventListener("click",new at,!1);const t=new et(this.#Oe);for(let e=0;e<this.#Oe.length;e++){const i=this.#Oe[e];$.create("div",{className:"TravelNotes-ViewerLayersToolbar-Button",title:i.name,dataset:{MapLayerId:e},textContent:i.toolbarButtonData.text,style:"color:"+i.toolbarButtonData.color+";background-color:"+i.toolbarButtonData.backgroundColor},this.#ke).addEventListener("click",t,!1)}}setMapLayer(t){const e=t.match(/^[0-9]$/)?this.#Oe[Number.parseInt(t)]||this.#Oe[0]:this.#Oe.find((e=>e.name===t))||this.#Oe[0];C.dispatch("layerchange",{layer:e}),q.attributions=e.attribution}addMapLayers(t){t.forEach((t=>{const e=new tt(t);e.providerKeyNeeded||this.#Oe.push(e)}))}};const nt=new class{#Be;async#We(t){const e=await fetch(t);u===e.status&&e.ok?(new Y).openDistantFile(await e.json()):(D.map.setView([d.defaultValue,d.defaultValue],2),document.title="Travel & Notes")}constructor(){Object.freeze(this),this.#Be=!1}addReadOnlyMap(t,e){this.#Be||(this.#Be=!0,q.createUI(),e&&st.createUI(),st.setMapLayer("OSM - Color"),t&&this.#We(t))}};class lt{#Qt;#Ge;#Ze;#Xe;#Ke;#Je;#Ye;static get PROFILE_MARGIN(){return 100}static get PROFILE_HEIGHT(){return 500}static get PROFILE_WIDTH(){return 1e3}static get X_DELTA_TEXT(){return 10}static get Y_DELTA_TEXT(){return 30}static get#$e(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}static get#qe(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3]}static get#Qe(){return 8}static get#ti(){return 4}static get#ei(){return lt.PROFILE_MARGIN.toFixed(0)}static get#ii(){return(lt.PROFILE_MARGIN+lt.PROFILE_WIDTH).toFixed(0)}static get#oi(){return lt.PROFILE_MARGIN.toFixed(0)}static get#ri(){return(lt.PROFILE_MARGIN+lt.PROFILE_HEIGHT).toFixed(0)}static get#ai(){return(lt.PROFILE_MARGIN-lt.X_DELTA_TEXT).toFixed(0)}static get#si(){return(lt.PROFILE_MARGIN+lt.PROFILE_WIDTH+lt.X_DELTA_TEXT).toFixed(0)}static get#ni(){return lt.PROFILE_MARGIN+lt.PROFILE_HEIGHT+lt.PROFILE_MARGIN/2}#li(){let t="",e=0,i=0,o=0;this.#Qt.itinerary.itineraryPoints.forEach((r=>{i=(lt.PROFILE_MARGIN+this.#Xe*e).toFixed(0),o=(lt.PROFILE_MARGIN+this.#Ze*(this.#Je-r.elev)).toFixed(0),t+=i+","+o+" ",e+=r.distance}));const r=document.createElementNS(p,"polyline");r.setAttributeNS(null,"points",t),r.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-profilePolyline"),this.#Ge.appendChild(r)}#di(){const t=lt.#ei+","+lt.#oi+" "+lt.#ei+","+lt.#ri+" "+lt.#ii+","+lt.#ri+" "+lt.#ii+","+lt.#oi,e=document.createElementNS(p,"polyline");e.setAttributeNS(null,"points",t),e.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-framePolyline"),this.#Ge.appendChild(e)}#ci(){let t=Number.MAX_VALUE,e=0;lt.#$e.forEach((i=>{const o=Math.abs(this.#Qt.distance/lt.#Qe-i);o<t&&(t=o,e=i)}));let i=Math.ceil(this.#Qt.chainedDistance/e)*e;for(;i<this.#Qt.distance+this.#Qt.chainedDistance;){const t=document.createElementNS(p,"text");t.appendChild(document.createTextNode(a.metersInKm<e||0<this.#Qt.chainedDistance?i/a.metersInKm+" km":i+" m ")),t.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-distLegend"),t.setAttributeNS(null,"x",lt.PROFILE_MARGIN+(i-this.#Qt.chainedDistance)*this.#Xe),t.setAttributeNS(null,"y",lt.#ni),t.setAttributeNS(null,"text-anchor","start"),this.#Ge.appendChild(t),i+=e}}#hi(){let t=Number.MAX_VALUE,e=0;lt.#qe.forEach((i=>{const o=Math.abs(this.#Ye/lt.#ti-i);o<t&&(t=o,e=i)}));let i=Math.ceil(this.#Ke/e)*e;for(;i<this.#Je;){const t=lt.PROFILE_MARGIN+(this.#Je-i)*this.#Ze,o=document.createElementNS(p,"text");o.appendChild(document.createTextNode(i.toFixed(0))),o.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),o.setAttributeNS(null,"x",lt.#si),o.setAttributeNS(null,"y",t),o.setAttributeNS(null,"text-anchor","start"),this.#Ge.appendChild(o);const r=document.createElementNS(p,"text");r.appendChild(document.createTextNode(i.toFixed(0))),r.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),r.setAttributeNS(null,"x",lt.#ai),r.setAttributeNS(null,"y",t),r.setAttributeNS(null,"text-anchor","end"),this.#Ge.appendChild(r),i+=e}}#ui(){this.#Ge=document.createElementNS(p,"svg"),this.#Ge.setAttributeNS(null,"viewBox","0 0 "+(lt.PROFILE_WIDTH+2*lt.PROFILE_MARGIN)+" "+(lt.PROFILE_HEIGHT+2*lt.PROFILE_MARGIN)),this.#Ge.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile")}constructor(){Object.freeze(this)}createSvg(t){return this.#Qt=t,this.#Ke=Number.MAX_VALUE,this.#Je=0,this.#Qt.itinerary.itineraryPoints.forEach((t=>{this.#Je=Math.max(this.#Je,t.elev),this.#Ke=Math.min(this.#Ke,t.elev)})),this.#Ye=this.#Je-this.#Ke,this.#Ze=lt.PROFILE_HEIGHT/this.#Ye,this.#Xe=lt.PROFILE_WIDTH/this.#Qt.distance,this.#ui(),this.#li(),this.#di(),this.#hi(),this.#ci(),this.#Ge}}class dt{static get#gi(){return 40}static get#mi(){return 40}constructor(){Object.freeze(this)}getNoteTextAndIconHTML(e,i){const o=$.create("div",{dataset:{ObjId:i.note.objId}}),r=$.create("div",{className:e+(i.route?"Route-ManeuversAndNotes-IconCell":"Travel-Notes-IconCell")},o);let a=1;b.sanitizeToHtmlElement(i.note.iconContent,r),"TravelNotes-Roadbook-"===e&&r.firstChild&&("svg"===r.firstChild.tagName?(r.firstChild.setAttributeNS(null,"viewBox","0 0 "+l.svgViewboxDim+" "+l.svgViewboxDim),a=t.note.svgIcon.roadbookFactor):r?.firstChild?.classList?.contains("TravelNotes-MapNoteCategory-0073")&&(a=t.note.svgIcon.roadbookFactor)),r.dataset.tanWidth=String(i.note.iconWidth*a)+"px",r.dataset.tanHeight=String(i.note.iconHeight*a)+"px",r.style.width=String(i.note.iconWidth*a)+"px",r.style.height=String(i.note.iconHeight*a)+"px";const s=this.getNoteTextHTML(e,i);return s.className=e+(i.route?"Route-ManeuversAndNotes-Cell":"Travel-Notes-Cell"),o.appendChild(s),o}getNoteTextHTML(t,e){const i=e.note,o=$.create("div");if(0!==i.tooltipContent.length&&b.sanitizeToHtmlElement(i.tooltipContent,$.create("div",{className:t+"NoteHtml-TooltipContent"},o)),0!==i.popupContent.length&&b.sanitizeToHtmlElement(i.popupContent,$.create("div",{className:t+"NoteHtml-PopupContent"},o)),0!==i.address.length&&b.sanitizeToHtmlElement("<span>"+N.getText("NoteHTMLViewsFactory - Address")+"</span> : "+i.address,$.create("div",{className:t+"NoteHtml-Address"},o)),0!==i.url.length&&b.sanitizeToHtmlElement("<span>"+N.getText("NoteHTMLViewsFactory - Link")+"</span><a href="+i.url+' target="_blank" >'+i.url.substring(0,dt.#gi)+"...</a>",$.create("div",{className:t+"NoteHtml-Url"},o)),0!==i.phone.length){let e=i.phone;if(i.phone.match(/^\+[0-9, ,*,\u0023]*$/)){const t=i.phone.replaceAll(/\u0020/g,""),o=i.phone.replaceAll(/\u0020/g," ");e=N.getText("NoteHTMLViewsFactory - Phone")+" : "+N.getText("NoteHTMLViewsFactory - call")+'<a target="_blank" href="tel:'+t+'" >'+o+"</a>"+N.getText("NoteHTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+t+'" >'+o+"</a>"}else e=N.getText("NoteHTMLViewsFactory - Phone")+" : "+i.phone;b.sanitizeToHtmlElement(e,$.create("div",{className:t+"NoteHtml-Phone"},o))}if(b.sanitizeToHtmlElement(I.formatLatLng(i.latLng),$.create("div",{className:t+"NoteHtml-LatLng"},o)),e.route){e.route.chain&&b.sanitizeToHtmlElement("<span>"+N.getText("NoteHTMLViewsFactory - Distance from start of travel")+"</span> : "+I.formatDistance(i.chainedDistance+i.distance),$.create("div",{className:t+"NoteHtml-TravelDistance"},o)),b.sanitizeToHtmlElement("<span>"+N.getText("NoteHTMLViewsFactory - Distance from start of route")+"</span> : "+I.formatDistance(i.distance),$.create("div",{className:t+"NoteHtml-RouteDistance"},o));const r=e.route.notes.next(i.objId);if(r){const e=r.distance-i.distance;dt.#mi<e&&b.sanitizeToHtmlElement("<span>"+N.getText("NoteHTMLViewsFactory - Next note after")+"</span> : "+I.formatDistance(e),$.create("div",{className:t+"NoteHtml-NextDistance"},o))}}return o}getTravelNotesHTML(t){const e=$.create("div",{className:t+"Travel-Notes"}),i=D.travel.notes.iterator;for(;!i.done;){const o=this.getNoteTextAndIconHTML(t,{note:i.value,route:null});o.className=t+"Travel-Notes-Row",e.appendChild(o)}return e}}const ct=new dt;const ht=new class{#pi(t,e){const i=$.create("div"),o=$.create("div",{className:t+"Route-ManeuversAndNotes-IconCell"},i);$.create("div",{className:"TravelNotes-ManeuverNote TravelNotes-ManeuverNote-"+e.maneuver.iconName},o),o.dataset.tanWidth=String(l.width)+"px",o.dataset.tanHeight=String(l.height)+"px";const r=$.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},i);return $.create("div",{className:t+"Route-Maneuver-TooltipContent",textContent:N.getText("RouteHTMLViewsFactory - "+e.maneuver.iconName)},r),b.sanitizeToHtmlElement(e.maneuver.instruction,$.create("div",{className:t+"Route-Maneuver-Instruction"},r)),e.route.chain&&b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Distance from start of travel")+"</span> : "+I.formatDistance(e.route.chainedDistance+e.maneuverDistance),$.create("div",{className:t+"Route-Maneuver-TravelDistance"},r)),b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Distance from start of route")+"</span> : "+I.formatDistance(e.maneuverDistance),$.create("div",{className:t+"Route-Maneuver-RouteDistance"},r)),a.defaultValue<e.maneuver.distance&&b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Next maneuver after")+"</span> : "+I.formatDistance(e.maneuver.distance),$.create("div",{className:t+"Route-Maneuver-NextDistance"},r)),i}constructor(){Object.freeze(this)}getRouteProfileHTML(t,e){const i=$.create("div",{className:t+"RouteProfile"});return b.sanitizeToHtmlElement(N.getText("RouteHTMLViewsFactory - Profile"),i),i.appendChild((new lt).createSvg(e)),i}getRouteManeuversAndNotesHTML(t,e,i){const o=[],r=e.notes.iterator;for(;!r.done;)o.push({data:r.value,distance:r.value.distance});const a=e.itinerary.maneuvers.iterator;let s=0;for(;!a.done;)o.push({data:a.value,distance:s}),s+=a.value.distance;o.sort(((t,e)=>t.distance-e.distance));const n=$.create("div",{className:t+"Route-ManeuversAndNotes"});return o.forEach((o=>{let r=null;"Note"===o.data.objType.name?(r=ct.getNoteTextAndIconHTML(t,{note:o.data,route:e}),r.className=t+"Route-Notes-Row"):(r=this.#pi(t,{route:e,maneuver:o.data,maneuverDistance:o.distance}),r.className=t+"Route-Maneuvers-Row"),i&&(r.dataset.tanObjId=o.data.objId,r.dataset.tanMarkerObjId=v.nextObjId,r.dataset.tanObjType=o.data.objType.name),n.appendChild(r)})),n}getRouteHeaderHTML(t,e){const i=$.create("div",{className:t+"Route-Header",id:"route"+e.objId});return b.sanitizeToHtmlElement(e.computedName,$.create("div",{className:t+"Route-Header-Name"},i)),0!==e.distance&&b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Route distance")+"</span> : "+I.formatDistance(e.distance),$.create("div",{className:t+"Route-Header-Distance"},i)),D.travel.readOnly||"bike"===e.itinerary.transitMode||b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Duration")+"</span> : "+I.formatTime(e.duration),$.create("div",{className:t+"Route-Header-Duration"},i)),e.itinerary.hasProfile&&(b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Ascent")+"</span> : "+String(e.itinerary.ascent.toFixed(0))+" m.",$.create("div",{className:t+"Route-Header-Ascent"},i)),b.sanitizeToHtmlElement("<span>"+N.getText("RouteHTMLViewsFactory - Descent")+"</span> : "+String(e.itinerary.descent.toFixed(0))+" m.",$.create("div",{className:t+"Route-Header-Descent"},i))),i}getRouteFooterHTML(t,e){let i=""!==e.itinerary.provider&&""!==e.itinerary.transitMode?N.getText("RouteHTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:N.getText("RouteHTMLViewsFactory - TransitMode "+e.itinerary.transitMode)}):"";const o=$.create("div",{className:t+"RouteFooter"});return b.sanitizeToHtmlElement(i,o),o}};class ut{static handleEvent(t){const e=K.getRoute(t.target.objId);let i=W.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;i+=e.chainedDistance,i=I.formatDistance(i);const o=D.mapObjects.get(t.target.objId);o.closeTooltip();let r=e.computedName;D.travel.readOnly||(r+=0===r.length?"":" - ",r+=i),o.setTooltipContent(r),o.openTooltip(t.latlng)}}class gt{#yi;#bi;#fi;constructor(t,e,i){Object.freeze(this),this.#yi=t,this.#bi=e,this.#fi=i}get marker(){return this.#yi}get polyline(){return this.#bi}get bullet(){return this.#fi}}class mt{static#vi;static#Ti(){mt.#vi=!0,document.removeEventListener("touchstart",mt.#Ti,!0)}constructor(){Object.freeze(this),mt.#vi=!1,document.addEventListener("touchstart",mt.#Ti,!0)}get isTouch(){return mt.#vi}get screenAvailable(){const t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.right=0,t.style.height=1,t.style.width=1,document.body.appendChild(t);const e=t.getBoundingClientRect(),i=e.bottom,o=e.right;return document.body.removeChild(t),Object.freeze({height:i,width:o})}}const pt=new mt;class yt{#ji;#Li;static get#wi(){return 18}static get#Ni(){return 0}static get#Ii(){return 100}constructor(){Object.freeze(this),this.#ji=null,this.#Li=null}addToMap(t,e){e.objId=t,e.addTo(D.map),D.mapObjects.set(t,e)}addRoute(t){const e=K.getRoute(t),i=[],o=e.itinerary.itineraryPoints.iterator;for(;!o.done;)i.push(o.value.latLng);const r=window.L.polyline(i,{color:e.color,weight:e.width,dashArray:e.dashString});this.addToMap(e.objId,r),c.notEdited===e.editionStatus&&(r.bindTooltip(e.computedName,{sticky:!0,direction:"right"}),pt.isTouch||(window.L.DomEvent.on(r,"mouseover",ut.handleEvent),window.L.DomEvent.on(r,"mousemove",ut.handleEvent),r.bindPopup((t=>b.clone(ht.getRouteHeaderHTML("TravelNotes-Map-",K.getRoute(t.objId))))),window.L.DomEvent.on(r,"click",(t=>t.target.openPopup(t.latlng)))));const a=e.notes.iterator;for(;!a.done;)this.addNote(a.value.objId);return e}addNote(e){const i=K.getNoteAndRoute(e).note,o=window.L.marker(i.latLng,{icon:window.L.divIcon({iconSize:[t.note.grip.size,t.note.grip.size],iconAnchor:[t.note.grip.size/2,t.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Map-Note-Bullet"}),opacity:t.note.grip.opacity,draggable:!D.travel.readOnly});o.objId=i.objId;const r=window.L.marker(i.iconLatLng,{zIndexOffset:yt.#Ii,icon:window.L.divIcon({iconSize:[i.iconWidth,i.iconHeight],iconAnchor:[i.iconWidth/2,i.iconHeight/2],popupAnchor:[0,-i.iconHeight/2],html:i.iconContent,className:"TravelNotes-Map-AllNotes "}),draggable:!D.travel.readOnly});r.objId=i.objId,r.bindPopup((t=>b.clone(ct.getNoteTextHTML("TravelNotes-Map-",K.getNoteAndRoute(t.objId))))),0!==i.tooltipContent.length&&(r.bindTooltip((t=>K.getNoteAndRoute(t.objId).note.tooltipContent)),r.getTooltip().options.offset[0]=i.iconWidth/2);const a=window.L.polyline([i.latLng,i.iconLatLng],t.note.polyline);a.objId=i.objId;const s=window.L.layerGroup([r,a,o]);return s.markerId=window.L.Util.stamp(r),s.polylineId=window.L.Util.stamp(a),s.bulletId=window.L.Util.stamp(o),this.addToMap(i.objId,s),t.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach((t=>t.classList.add("TravelNotes-Map-Note-Background"))),new gt(r,a,o)}zoomTo(e,i){if(i){let t=[];i.forEach((e=>t=t.concat(e))),D.map.fitBounds(W.getLatLngBounds(t))}else D.map.setView(e,t.itineraryPoint.zoomFactor)}setLayer(t,e){const i="wmts"===t.service.toLowerCase()?window.L.tileLayer(e):window.L.tileLayer.wms(e,t.wmsOptions);this.#ji&&D.map.removeLayer(this.#ji),D.map.addLayer(i),this.#ji=i,D.travel.readOnly||(D.map.getZoom()<(t.minZoom||yt.#Ni)&&D.map.setZoom(t.minZoom||yt.#Ni),D.map.setMinZoom(t.minZoom||yt.#Ni),D.map.getZoom()>(t.maxZoom||yt.#wi)&&D.map.setZoom(t.maxZoom||yt.#wi),D.map.setMaxZoom(t.maxZoom||yt.#wi),t.bounds?(D.map.getBounds().intersects(t.bounds)&&!D.map.getBounds().contains(t.bounds)||(D.map.setMaxBounds(null),D.map.fitBounds(t.bounds),D.map.setZoom(t.minZoom||yt.#Ni)),D.map.setMaxBounds(t.bounds)):D.map.setMaxBounds(null)),D.map.fire("baselayerchange",i)}onGeolocationStatusChanged(t){n.active!==t&&this.#Li&&(D.map.removeLayer(this.#Li),this.#Li=null)}onGeolocationPositionChanged(e){let i=t.geoLocation.zoomToPosition;this.#Li&&(D.map.removeLayer(this.#Li),i=!1);let o="Position (+/- "+e.coords.accuracy.toFixed(0)+" m) : <br/>"+I.formatLatLngDMS([e.coords.latitude,e.coords.longitude])+"<br/>"+I.formatLatLng([e.coords.latitude,e.coords.longitude])+"<br/>";e.coords.altitude&&(o+="<br/> Altitude  :<br/>"+e.coords.altitude.toFixed(0)+" m",e.coords.altitudeAccuracy&&(o+="(+/- "+e.coords.altitudeAccuracy.toFixed(0)+" m)")),0===t.geoLocation.marker.radius?this.#Li=window.L.circle(window.L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.marker).setRadius(e.coords.accuracy.toFixed(0)):this.#Li=window.L.circleMarker(window.L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#Li.bindTooltip(o).addTo(D.map),t.geoLocation.watch||this.#Li.bindPopup(o).openPopup(),this.#Li.on("click",(t=>{const e=t.target.getTooltip().getContent();t.target.getTooltip().setContent(e+"Copied"),navigator.clipboard.writeText(e.replaceAll("<br/>","\n")).then((()=>{t.target.getTooltip().setContent(e+"<br/><br/>"+N.getText("MapEditorViewer -Copied to clipboard"))})).catch((()=>console.error("Failed to copy to clipboard ")))})),i&&D.map.setView(window.L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.zoomFactor)}}class bt{constructor(){Object.freeze(this)}handleEvent(t){if(t.stopPropagation(),"Z"===t.key||"z"===t.key)(new J).zoomToTravel();else if("G"===t.key||"g"===t.key)ot.switch();else{const e=t.key.charCodeAt(0);47<e&&58>e&&st.setMapLayer(t.key)}}}class ft{#Ei;#Mi;#Oi;#xi;static get#Ri(){return 2}static#Ai=new yt;#Pi(){document.addEventListener("keydown",new bt,!0),document.addEventListener("routeupdated",(t=>{t.data&&ft.#Ai.addRoute(t.data.addedRouteObjId)}),!1),document.addEventListener("noteupdated",(t=>{t.data&&ft.#Ai.addNote(t.data.addedNoteObjId)}),!1),document.addEventListener("zoomto",(t=>{t.data&&ft.#Ai.zoomTo(t.data.latLng,t.data.geometry)}),!1),document.addEventListener("layerchange",(t=>{t.data&&ft.#Ai.setLayer(t.data.layer,t.data.layer.url)})),document.addEventListener("geolocationpositionchanged",(t=>{t.data&&ft.#Ai.onGeolocationPositionChanged(t.data.position)}),!1),document.addEventListener("geolocationstatuschanged",(t=>{t.data&&ft.#Ai.onGeolocationStatusChanged(t.data.status)}),!1)}#Si(){const t=new URL(window.location);let e=t.searchParams.get("fil");if(e&&0!==e.length)try{if(e=atob(e),e.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");const i=new URL(e);if(!(t.protocol&&i.protocol&&t.protocol===i.protocol&&t.hostname&&i.hostname&&t.hostname===i.hostname))throw new Error("The distant file is not on the same site than the app");this.#Ei=encodeURI(i.href)}catch(t){t instanceof Error&&console.error(t)}const i=t.searchParams.get("lng");i&&i.match(/^[A-Z,a-z]{2}$/)&&(this.#Mi=i.toLowerCase()),""===t.searchParams.get("lay")&&(this.#xi=!0)}async#_i(){const t=await fetch(this.#Oi+"Config.json");if(u===t.status&&t.ok){const e=await t.json();return e.travelNotes.language=this.#Mi||e.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(e.note.haveBackground=!0),(new f).overload(e),!0}return!1}async#Hi(){const t=await fetch(this.#Oi+this.#Mi.toUpperCase()+".json");return!(u!==t.status||!t.ok)&&(N.setTranslations(await t.json()),!0)}async#Di(){const t=await fetch(this.#Oi+"Layers.json");return!(u!==t.status||!t.ok)&&(st.addMapLayers(await t.json()),!0)}#Ci(){const t=document.createElement("div");t.id="TravelNotes-Map",document.body.appendChild(t),D.map=window.L.map(t.id,{attributionControl:!1,zoomControl:!1}).setView([d.defaultValue,d.defaultValue],ft.#Ri),nt.addReadOnlyMap(this.#Ei,this.#xi)}constructor(){Object.freeze(this),this.#Oi=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes",this.#xi=!1}async loadApp(){this.#Si(),await this.#_i()?(this.#Mi=this.#Mi||t.travelNotes.language,await this.#Hi()?await this.#Di()?(this.#Pi(),this.#Ci()):document.body.textContent="Not possible to load the TravelNotesLayers.json file. ":document.body.textContent="Not possible to load the TravelNotesConfig"+this.#Mi.toUpperCase()+".json file. "):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}}(new ft).loadApp()}();
/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 3.6.0
 * Build 00066 - 2022-06-03T08:22:51+0200 
 * Copyright 2017 2022 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";const t={APIKeys:{saveToSessionStorage:!0},APIKeysDialog:{haveUnsecureButtons:!0,showAPIKeys:!0,showButton:!0},contextMenu:{timeout:1500},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!0,showInfo:!0,showWarning:!0,timeOut:1e4},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:11},options:{enableHighAccuracy:!1,maximumAge:0,timeout:1/0},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPaneUI:{showManeuvers:!1,showNotes:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},layersToolbarUI:{haveLayersToolbarUI:!0,toolbarTimeOut:1500,theDevil:{addButton:!1}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},mouseUI:{haveMouseUI:!0},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},reverseGeocoding:!1,svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:1,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},mask:{iconsDimension:!0,iconTextArea:!1,tooltip:!1,popupContent:!1,address:!1,link:!1,phone:!0},theDevil:{addButton:!1,zoomFactor:17}},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},paneUI:{switchToItinerary:!1,switchToTravelNotes:!1,switchToSearch:!0},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"——————",iDashArray:[0]},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:3,width:3},routeEditor:{showEditedRouteInRoadbook:!0},travelEditor:{startMinimized:!0,startupRouteEdition:!0,timeout:1e3},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr"},travelNotesToolbarUI:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},wayPoint:{reverseGeocoding:!1,geocodingIncludeName:!1}};class e{_private_url;_private_errorsString;constructor(t,e){this._private_url=t,this._private_errorsString=e}get url(){return this._private_url}get errorsString(){return this._private_errorsString}}class i{_private_htmlString;_private_errorsString;constructor(t,e){this._private_htmlString=t,this._private_errorsString=e}get htmlString(){return this._private_htmlString}get errorsString(){return this._private_errorsString}}class r{_private_validityMap=new Map;constructor(){this._private_validityMap.set("a",["href","target"]),this._private_validityMap.set("div",[]),this._private_validityMap.set("del",[]),this._private_validityMap.set("em",[]),this._private_validityMap.set("figcaption",[]),this._private_validityMap.set("figure",[]),this._private_validityMap.set("h1",[]),this._private_validityMap.set("h2",[]),this._private_validityMap.set("h3",[]),this._private_validityMap.set("h4",[]),this._private_validityMap.set("h5",[]),this._private_validityMap.set("h6",[]),this._private_validityMap.set("hr",[]),this._private_validityMap.set("img",["src","alt","width","height"]),this._private_validityMap.set("ins",[]),this._private_validityMap.set("li",[]),this._private_validityMap.set("mark",[]),this._private_validityMap.set("ol",[]),this._private_validityMap.set("p",[]),this._private_validityMap.set("s",[]),this._private_validityMap.set("small",[]),this._private_validityMap.set("strong",[]),this._private_validityMap.set("span",[]),this._private_validityMap.set("sub",[]),this._private_validityMap.set("sup",[]),this._private_validityMap.set("ul",[]),this._private_validityMap.set("svg",["xmlns","viewBox","class"]),this._private_validityMap.set("text",["x","y","text-anchor"]),this._private_validityMap.set("polyline",["points","class","transform"]),this._private_validityMap.set("#text",[])}getValidAttributesNames(t){return this._private_validityMap.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this._private_validityMap.get(e)?e:""}}class a{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class o{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class s{static get fixed(){return 2}static get defaultValue(){return 0}}class n{static get refusedByUser(){return-1}static get disabled(){return 0}static get inactive(){return 1}static get active(){return 2}}class _{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class p{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class l{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}const v=20,d=6371e3,c=200,h=-1,u=-1,g="http://www.w3.org/2000/svg";class m{_private_stringifiedHTML="";_private_stringifyErrors="";static _private_htmlSanitizerData=new r;_private_addHtmlEntities(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}_private_stringifyUrl(t,e){const i=this.sanitizeToUrl(t,e).url;""===i&&""!==t?this._private_stringifyErrors+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this._private_stringifiedHTML+=" "+e+'="'+i+'"'}_private_stringifySvgAttributes(t,e){m._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(this._private_stringifiedHTML+=" "+e+'="'+this._private_addHtmlEntities(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))}))}_private_stringifyHTMLAttributes(t,e){t.hasAttribute("target")&&(this._private_stringifiedHTML+=' rel="noopener noreferrer"'),m._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this._private_stringifyUrl(t.getAttribute(e),e):this._private_stringifiedHTML+=" "+e+'="'+this._private_addHtmlEntities(t.getAttribute(e))+'"',t.removeAttribute(e))}))}_private_addStringifyErrors(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this._private_stringifyErrors+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}_private_stringify(t){const e=t.childNodes;for(let i=0;i<e.length;i++){const e=t.childNodes[i],r=m._private_htmlSanitizerData.getValidNodeName(e.nodeName);""===r?this._private_stringifyErrors+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===r?this._private_stringifiedHTML+=this._private_addHtmlEntities(e.nodeValue):(this._private_stringifiedHTML+="<"+r,"svg"===r||"text"===r||"polyline"===r?this._private_stringifySvgAttributes(e,r):this._private_stringifyHTMLAttributes(e,r),this._private_stringifiedHTML+=">",this._private_stringify(e),this._private_stringifiedHTML+="</"+r+">",e.attributes&&this._private_addStringifyErrors(e))}}_private_cloneSvg(t,e){const i=document.createElementNS(g,e);return m._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(i.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))})),i}_private_cloneHTML(t,e){const i=document.createElement(e);return m._private_htmlSanitizerData.getValidAttributesNames(e).forEach((e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const r=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==r&&i.setAttribute(e,r)}else i.setAttribute(e,t.getAttribute(e))})),t.hasAttribute("target")&&i.setAttribute("rel","noopener noreferrer"),i}_private_cloneNode(t,e){const i=t.childNodes;for(let r=0;r<i.length;r++){const i=t.childNodes[r],a=m._private_htmlSanitizerData.getValidNodeName(i.nodeName);if("#text"===a)e.appendChild(document.createTextNode(i.nodeValue));else if(""!==a){const t="svg"===a||"text"===a||"polyline"===a?this._private_cloneSvg(i,a):this._private_cloneHTML(i,a);e.appendChild(t),this._private_cloneNode(i,t)}}}constructor(){}sanitizeToHtmlElement(t,e){const i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),r=new DocumentFragment;i&&"#document"===i.nodeName?(this._private_cloneNode(i.body.firstChild,r),e.appendChild(r)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this._private_cloneNode(t,e),e}sanitizeToHtmlString(t){this._private_stringifiedHTML="",this._private_stringifyErrors="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html");return e&&"#document"===e.nodeName?(this._private_stringify(e.body.firstChild),new i(this._private_stringifiedHTML,this._private_stringifyErrors)):new i("","Parsing error")}sanitizeToUrl(t,i){const r=i||"href",a=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!a||"#document"!==a.nodeName)return new e("","Parsing error");const o=a.body.firstChild;let s="";for(let t=0;t<o.childNodes.length;t++){if("#text"!==o.childNodes[t].nodeName)return new e("","Invalid characters found in the url");s+=o.childNodes[t].nodeValue}if(s=s.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),s!==t)return new e("","Invalid characters found in the url");const n=["https:"];if("http:"!==window.location.protocol&&"href"!==r||n.push("http:"),"href"===r){n.push("mailto:"),n.push("sms:"),n.push("tel:");const t=s.match(/^\u0023\w*/);if(t&&s===t[0])return new e(s,"")}"src"===r&&n.push("data:");let _=null;try{_=new URL(s)}catch(t){return new e("","Invalid url string")}if(u===n.indexOf(_.protocol))return new e("","Invalid protocol "+_.protocol);if(u!==["sms:","tel:"].indexOf(_.protocol))return _.pathname.match(/^\+[0-9,*,\u0023]*$/)?new e(s,""):new e("","Invalid sms: or tel: url");try{encodeURIComponent(_.href)}catch(t){return new e("","Invalid character in url")}return new e(s,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const i=e.body.firstChild;let r="";for(let t=0;t<i.childNodes.length;t++){if("#text"!==i.childNodes[t].nodeName)return"";r+=i.childNodes[t].nodeValue}return r=r.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),r}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const y=new m;class b{_private_copyObjectTo(t,e){if("object"==typeof t&&"object"==typeof e){for(const i in e)"object"==typeof e[i]?this._private_copyObjectTo(t[i],e[i]):typeof t[i]==typeof e[i]&&("string"==typeof e[i]?e[i]="color"===i?y.sanitizeToColor(t[i])||e[i]:"url"===i?y.sanitizeToUrl(t[i]).url:y.sanitizeToJsString(t[i]):e[i]=t[i]||e[i]);for(const i in t)"object"==typeof t[i]?("[object Array]"===Object.prototype.toString.call(t[i])?e[i]=e[i]||[]:e[i]=e[i]||{},this._private_copyObjectTo(t[i],e[i])):"string"==typeof e.property?e[i]=y.sanitizeToHtmlString(t[i],[]).htmlString:e[i]=t[i]}}_private_freeze(t){for(const e in t)"object"==typeof t[e]&&this._private_freeze(t[e]);Object.freeze(t)}constructor(){}overload(e){this._private_copyObjectTo(e,t),this._private_freeze(t)}}class f{static _private_objId=0;static get nextObjId(){return++f._private_objId}}const L="2.4.0";class w{_private_objTypeName="";_private_validObjTypeNames=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];_private_properties=[];constructor(t,e){if(u===this._private_validObjTypeNames.indexOf(t))throw new Error("Invalid ObjType name : "+t);this._private_objTypeName=t,this._private_properties=e,Object.freeze(this._private_properties)}get name(){return this._private_objTypeName}get version(){return L}get properties(){return this._private_properties}get jsonObject(){return{name:this._private_objTypeName,version:L}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this._private_objTypeName);if(this._private_objTypeName!==t.name)throw new Error("Invalid name for "+this._private_objTypeName);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this._private_objTypeName)}}class T{_private_collection=null;_private_index=u;constructor(t){this._private_collection=t}get value(){return this._private_index<this._private_collection.length?this._private_collection.at(this._private_index):null}get previous(){return 0>=this._private_index?null:this._private_collection.at(this._private_index-1)}get next(){return this._private_index<this._private_collection.length-1?this._private_collection.at(this._private_index+1):null}get done(){return++this._private_index>=this._private_collection.length}get first(){return 0===this._private_index}get last(){return this._private_index>=this._private_collection.length-1}get index(){return this._private_index}}class E{_private_array;_private_objName;_private_classCollection;_private_indexOfObjId(t){return this._private_array.findIndex((e=>e.objId===t))}_private_nextOrPrevious(t,e,i){let r=this._private_indexOfObjId(t);if(u===r)throw new Error("invalid objId for next or previous function");if(1!==i&&-1!==i)throw new Error("invalid direction");let a=e;for(a||(a=()=>!0),r+=i;u<r&&r<this._private_array.length&&!a(this._private_array[r]);)r+=i;return u===r||this._private_array.length===r?null:this._private_array[r]}constructor(t){this._private_array=[],this._private_classCollection=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this._private_objName=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this._private_objName)throw new Error("invalid object name for add function");this._private_array.push(t)}at(t){return t<this._private_array.length&&t>u?this._private_array[t]:null}forEach(t){let e=null;const i=this.iterator;for(;!i.done;)e=t(i.value,e);return e}getAt(t){const e=this._private_indexOfObjId(t);return u===e?null:this._private_array[e]}moveTo(t,e,i){let r=this._private_indexOfObjId(t),a=this._private_indexOfObjId(e);if(u===r||u===a)throw new Error("invalid objId for function  myMoveTo");i||a++,this._private_array.splice(a,0,this._private_array[r]),a<r&&r++,this._private_array.splice(r,1)}next(t,e){return this._private_nextOrPrevious(t,e,1)}previous(t,e){return this._private_nextOrPrevious(t,e,-1)}remove(t){const e=this._private_indexOfObjId(t);if(u===e)throw new Error("invalid objId for remove function");this._private_array.splice(e,1)}removeAll(t){t?this._private_array.splice(1,this._private_array.length-2):this._private_array.length=0}replace(t,e){const i=this._private_indexOfObjId(t);if(u===i)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this._private_objName)throw new Error("invalid object name for replace function");this._private_array[i]=e}reverse(){this._private_array.reverse()}sort(t){this._private_array.sort(t)}swap(t,e){const i=this._private_indexOfObjId(t);if(u===i||0===i&&e||this._private_array.length-1===i&&!e)throw new Error("invalid objId for swap function");const r=e?-1:1,a=this._private_array[i];this._private_array[i]=this._private_array[i+r],this._private_array[i+r]=a}get first(){return this._private_array[0]}get iterator(){return new T(this)}get last(){return this._private_array[this._private_array.length-1]}get length(){return this._private_array.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this._private_array.length=0,Array.isArray(t)&&t.forEach((t=>{const e=new this._private_classCollection;e.jsonObject=t,this.add(e)}))}}const I=new class{_private_translations=new Map;constructor(){}setTranslations(t){t.forEach((t=>this._private_translations.set(t.msgid,y.sanitizeToJsString(t.msgstr))))}getText(t,e){let i=this._private_translations.get(t);return e&&i&&Object.getOwnPropertyNames(e).forEach((t=>i=i.replace("{"+t+"}",e[t]))),i||t}};const N=new class{constructor(){}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let i="";for(let r=0;r<16;r++)i+=e[r].toString(16).padStart(2,"0")+t[r];return i}storageAvailable(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return!1}}openFile(t,e){const i=document.createElement("input");i.type="file",e&&(i.accept=e),i.addEventListener("change",t,!1),i.click()}saveFile(t,e,i){try{const r=i?window.URL.createObjectURL(new File([e],t,{type:i})):URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download",t),a.click(),window.URL.revokeObjectURL(r)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const i=Math.floor(e/86400),r=Math.floor(e%86400/3600),a=Math.floor(e%3600/60),o=Math.floor(e%60);return 0<i?i+" "+I.getText("Utilities - Day")+" "+r+" "+I.getText("Utilities - Hour"):0<r?r+" "+I.getText("Utilities - Hour")+" "+a+" "+I.getText("Utilities - Minute"):0<a?a+" "+I.getText("Utilities - Minute"):o+" "+I.getText("Utilities - Second")}formatDistance(t){const e=Math.floor(t);return 0>=e?"0 km":Math.floor(e/o.metersInKm)+","+Math.floor(e%o.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}numberToDMS(t){let e=t,i=Math.floor(t);e-=i;let r=Math.floor(60*e);e-=r/60,e*=3600;let a=Math.floor(e);return e-=a,e=Math.floor(100*e),i.toString()+"° "+r.toString()+"' "+a+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+" N":this.numberToDMS(-t)+" S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+" E":this.numberToDMS(-t)+" W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+" - "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(p.fixed)+" N":(-t).toFixed(p.fixed)+" S"}formatLng(t){return t>0?t.toFixed(p.fixed)+" E":(-t).toFixed(p.fixed)+" W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+" - "+this.formatLng(t[1])}};class D{_private_jsonTravel;_private_updateRoutesV_1_0_0(){this._private_jsonTravel.routes.forEach((t=>{t.dashArray=0,t.hidden=!1}))}_private_updateRoutesV_1_4_0(){this._private_jsonTravel.routes.forEach((t=>{t.edited=l.notEdited}))}_private_updateTravelV_1_4_0(){this._private_updateRoutesV_1_4_0(),this._private_jsonTravel.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"_private_ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:l.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}_private_updateTravelV_1_5_0(){if(this._private_jsonTravel.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find((t=>t.layerId===this._private_jsonTravel.userData.layerId));this._private_jsonTravel.layerName=t?t.layerName:"OSM - Color"}else this._private_jsonTravel.layerName="OSM - Color"}_private_updateItineraryPointsV_1_6_0(t){t.forEach((t=>{t.elev=s.defaultValue}))}_private_updateItineraryV_1_6_0(){this._private_jsonTravel.routes.forEach((t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this._private_updateItineraryPointsV_1_6_0(t.itinerary.itineraryPoints)})),this._private_jsonTravel.editedRoute.itinerary.hasProfile=!1,this._private_jsonTravel.editedRoute.itinerary.ascent=0,this._private_jsonTravel.editedRoute.itinerary.descent=0,this._private_updateItineraryPointsV_1_6_0(this._private_jsonTravel.editedRoute.itinerary.itineraryPoints)}_private_updateManeuversV_1_11_0(t){t.itinerary.maneuvers.forEach((t=>{"kArriveDefault"===t.iconName&&(t.distance=o.defaultValue)}))}_private_updateWayPointsV_1_11_0(t){t.wayPoints.forEach((t=>{t.address=t.name,t.name=""}))}_private_updateRoutesV_1_11_0(){this._private_jsonTravel.routes.forEach((t=>{t.editionStatus=t.edited,this._private_updateManeuversV_1_11_0(t),this._private_updateWayPointsV_1_11_0(t)})),this._private_jsonTravel.editedRoute.editionStatus=this._private_jsonTravel.editedRoute.edited,this._private_updateManeuversV_1_11_0(this._private_jsonTravel.editedRoute),this._private_updateWayPointsV_1_11_0(this._private_jsonTravel.editedRoute)}_private_updateRouteV_2_3_0(){this._private_jsonTravel.routes.forEach((t=>{t.dashIndex=t.dashArray})),this._private_jsonTravel.editedRoute.dashIndex=this._private_jsonTravel.editedRoute.dashArray}_private_UpdateStyleNoteV1_13_0(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}_private_updateNote_V1_13_0(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this._private_UpdateStyleNoteV1_13_0(t.iconContent),t.popupContent=this._private_UpdateStyleNoteV1_13_0(t.popupContent),t.tooltipContent=this._private_UpdateStyleNoteV1_13_0(t.tooltipContent),t.phone=this._private_UpdateStyleNoteV1_13_0(t.phone),t.address=this._private_UpdateStyleNoteV1_13_0(t.address)}_private_updateNotesV_1_13_0(){this._private_jsonTravel.notes.forEach((t=>{this._private_updateNote_V1_13_0(t)})),this.jsonTravel.routes.forEach((t=>{t.notes.forEach((t=>{this._private_updateNote_V1_13_0(t)}))}))}_private_updateTravel(){switch(this._private_jsonTravel.objType.version){case"1.0.0":this._private_updateRoutesV_1_0_0();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this._private_updateTravelV_1_4_0();case"1.5.0":this._private_updateTravelV_1_5_0();case"1.6.0":this._private_updateItineraryV_1_6_0();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this._private_updateRoutesV_1_11_0();case"1.12.0":case"1.13.0":this._private_updateNotesV_1_13_0();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this._private_updateRouteV_2_3_0(),this._private_jsonTravel.objType.version="2.4.0";break;default:throw new Error("invalid version for travel")}}constructor(){}update(t){t.objType.version!==L&&(this._private_jsonTravel=t,this._private_updateTravel())}}class P{constructor(){}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new D).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach((t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)})),t}}class j extends P{static _private_objType=new w("WayPoint",["address","name","lat","lng","objId"]);_private_name="";_private_address="";_private_lat=p.defaultValue;_private_lng=p.defaultValue;_private_objId=h;constructor(){super(),this._private_objId=f.nextObjId}get name(){return this._private_name}set name(t){this._private_name="string"==typeof t?y.sanitizeToJsString(t):""}get address(){return this._private_address}set address(t){this._private_address="string"==typeof t?y.sanitizeToJsString(t):""}get lat(){return this._private_lat}set lat(t){this._private_lat="number"==typeof t?t:p.defaultValue}get lng(){return this._private_lng}set lng(t){this._private_lng="number"==typeof t?t:p.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=N.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this._private_lat=t[0],this._private_lng=t[1]):(this._private_lat=p.defaultValue,this._private_lng=p.defaultValue)}get objId(){return this._private_objId}get objType(){return j._private_objType}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(p.fixed)),lng:parseFloat(this.lng.toFixed(p.fixed)),objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this._private_objId=f.nextObjId}}class M extends P{static _private_objType=new w("ItineraryPoint",["lat","lng","distance","elev","objId"]);_private_lat=p.defaultValue;_private_lng=p.defaultValue;_private_distance=o.defaultValue;_private_elev=s.defaultValue;_private_objId=h;constructor(){super(),this._private_objId=f.nextObjId}get lat(){return this._private_lat}set lat(t){this._private_lat="number"==typeof t?t:p.defaultValue}get lng(){return this._private_lng}set lng(t){this._private_lng="number"==typeof t?t:p.defaultValue}get distance(){return this._private_distance}set distance(t){this._private_distance="number"==typeof t?t:o.defaultValue}get elev(){return this._private_elev}set elev(t){this._private_elev="number"==typeof t?t:p.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this._private_lat=t[0],this._private_lng=t[1]):(this._private_lat=p.defaultValue,this._private_lng=p.defaultValue)}get objType(){return M._private_objType}get objId(){return this._private_objId}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(p.fixed)),lng:parseFloat(this.lng.toFixed(p.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),elev:parseFloat(this.elev.toFixed(s.fixed)),objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this._private_objId=f.nextObjId}}class A extends P{static _private_objType=new w("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);_private_iconName="";_private_instruction="";_private_itineraryPointObjId=h;_private_distance=o.defaultValue;_private_duration=o.defaultValue;_private_objId=h;constructor(){super(),this._private_objId=f.nextObjId}get iconName(){return this._private_iconName}set iconName(t){this._private_iconName="string"==typeof t?y.sanitizeToJsString(t):""}get instruction(){return this._private_instruction}set instruction(t){this._private_instruction="string"==typeof t?y.sanitizeToJsString(t):""}get itineraryPointObjId(){return this._private_itineraryPointObjId}set itineraryPointObjId(t){this._private_itineraryPointObjId="number"==typeof t?t:h}get distance(){return this._private_distance}set distance(t){this._private_distance="number"==typeof t?t:o.defaultValue}get duration(){return this._private_duration}set duration(t){this._private_duration="number"==typeof t?t:o.defaultValue}get objType(){return A._private_objType}get objId(){return this._private_objId}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this._private_objId=f.nextObjId}}class x extends P{static _private_objType=new w("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);_private_objId=h;_private_hasProfile=!1;_private_ascent=0;_private_descent=0;_private_provider="";_private_transitMode="";_private_itineraryPoints=new E(M);_private_maneuvers=new E(A);constructor(){super(),this._private_objId=f.nextObjId}get hasProfile(){return this._private_hasProfile}set hasProfile(t){this._private_hasProfile="boolean"==typeof t&&t}get ascent(){return this._private_ascent}set ascent(t){this._private_ascent="number"==typeof t?Number.parseInt(t):0}get descent(){return this._private_descent}set descent(t){this._private_descent="number"==typeof t?Number.parseInt(t):0}get provider(){return this._private_provider}set provider(t){this._private_provider="string"==typeof t?y.sanitizeToJsString(t):""}get transitMode(){return this._private_transitMode}set transitMode(t){this._private_transitMode="string"==typeof t?y.sanitizeToJsString(t):""}get itineraryPoints(){return this._private_itineraryPoints}get maneuvers(){return this._private_maneuvers}get objType(){return x._private_objType}get objId(){return this._private_objId}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this._private_objId=f.nextObjId;const i=new Map;let r=0;const a=this.itineraryPoints.iterator;for(;!a.done;)i.set(e.itineraryPoints[r].objId,a.value.objId),r++;const o=this.maneuvers.iterator;for(;!o.done;)o.value.itineraryPointObjId=i.get(o.value.itineraryPointObjId)}}class O extends P{static _private_objType=new w("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);_private_iconHeight=_.height;_private_iconWidth=_.width;_private_iconContent="";_private_popupContent="";_private_tooltipContent="";_private_phone="";_private_url="";_private_address="";_private_iconLat=p.defaultValue;_private_iconLng=p.defaultValue;_private_lat=p.defaultValue;_private_lng=p.defaultValue;_private_distance=o.invalid;_private_chainedDistance=o.defaultValue;_private_objId=h;constructor(){super(),this._private_objId=f.nextObjId}get iconHeight(){return this._private_iconHeight}set iconHeight(t){this._private_iconHeight="number"==typeof t?t:_.height}get iconWidth(){return this._private_iconWidth}set iconWidth(t){this._private_iconWidth="number"==typeof t?t:_.width}get iconContent(){return this._private_iconContent}set iconContent(t){this._private_iconContent="string"==typeof t?y.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this._private_popupContent}set popupContent(t){this._private_popupContent="string"==typeof t?y.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this._private_tooltipContent}set tooltipContent(t){this._private_tooltipContent="string"==typeof t?y.sanitizeToHtmlString(t).htmlString:""}get phone(){return this._private_phone}set phone(t){this._private_phone="string"==typeof t?y.sanitizeToHtmlString(t).htmlString:""}get url(){return this._private_url}set url(t){this._private_url="string"==typeof t?encodeURI(y.sanitizeToUrl(t).url):""}get address(){return this._private_address}set address(t){this._private_address="string"==typeof t?y.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this._private_iconLat}set iconLat(t){this._private_iconLat="number"==typeof t?t:p.defaultValue}get iconLng(){return this._private_iconLng}set iconLng(t){this._private_iconLng="number"==typeof t?t:p.defaultValue}get lat(){return this._private_lat}set lat(t){this._private_lat="number"==typeof t?t:p.defaultValue}get lng(){return this._private_lng}set lng(t){this._private_lng="number"==typeof t?t:p.defaultValue}get distance(){return this._private_distance}set distance(t){this._private_distance="number"==typeof t?t:o.invalid}get chainedDistance(){return this._private_chainedDistance}set chainedDistance(t){this._private_chainedDistance="number"==typeof t?t:o.defaultValue}get isRouteNote(){return this._private_distance!==o.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this._private_iconLat=t[0],this._private_iconLng=t[1]):(this._private_iconLat=p.defaultValue,this._private_iconLng=p.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this._private_lat=t[0],this._private_lng=t[1]):(this._private_lat=p.defaultValue,this._private_lng=p.defaultValue)}get objType(){return O._private_objType}get objId(){return this._private_objId}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(p.fixed)),iconLng:parseFloat(this.iconLng.toFixed(p.fixed)),lat:parseFloat(this.lat.toFixed(p.fixed)),lng:parseFloat(this.lng.toFixed(p.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this._private_objId=f.nextObjId}}class C extends P{static _private_objType=new w("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);_private_name="";_private_wayPoints=new E(j);_private_notes=new E(O);_private_itinerary=new x;_private_width=t.route.width;_private_color=t.route.color;_private_dashIndex=t.route.dashIndex;_private_chain=!0;_private_chainedDistance=o.defaultValue;_private_distance=o.defaultValue;_private_duration=o.defaultValue;_private_editionStatus=l.notEdited;_private_hidden=!1;_private_objId=h;constructor(){super(),this._private_wayPoints.add(new j),this._private_wayPoints.add(new j),this._private_objId=f.nextObjId}get name(){return this._private_name}set name(t){this._private_name="string"==typeof t?y.sanitizeToJsString(t):""}get wayPoints(){return this._private_wayPoints}get notes(){return this._private_notes}get itinerary(){return this._private_itinerary}get width(){return this._private_width}set width(e){this._private_width="number"==typeof e?e:t.route.width}get color(){return this._private_color}set color(e){this._private_color="string"==typeof e&&y.sanitizeToColor(e)||t.route.color}get dashIndex(){return this._private_dashIndex}set dashIndex(e){this._private_dashIndex="number"==typeof e&&t.route.dashChoices[e]?e:0}get dashString(){let e="";return t.route.dashChoices[this._private_dashIndex].iDashArray.forEach((t=>e+=String(t*this._private_width)+",")),e.substring(0,e.length-1)}get chain(){return this._private_chain}set chain(t){this._private_chain="boolean"==typeof t&&t}get chainedDistance(){return this._private_chainedDistance}set chainedDistance(t){this._private_chainedDistance="number"==typeof t?t:o.defaultValue}get distance(){return this._private_distance}set distance(t){this._private_distance="number"==typeof t?t:o.defaultValue}get duration(){return this._private_duration}set duration(t){this._private_duration="number"==typeof t?t:o.defaultValue}get editionStatus(){return this._private_editionStatus}set editionStatus(t){this._private_editionStatus="number"==typeof t?t:l.notEdited}get hidden(){return this._private_hidden}set hidden(t){this._private_hidden="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this._private_objId}get objType(){return C._private_objType}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach((e=>{t=t&&p.defaultValue!==e.lat&&p.defaultValue!==e.lng})),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this._private_objId=f.nextObjId}}class S extends P{static _private_objType=new w("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);_private_editedRoute=new C;_private_routes=new E(C);_private_notes=new E(O);_private_layerName="OSM - Color";_private_name="";_private_readOnly=!1;_private_objId=h;constructor(){super(),this._private_routes.add(new C),this._private_objId=f.nextObjId}get editedRoute(){return this._private_editedRoute}set editedRoute(t){this._private_editedRoute="Route"===t?.objType?.name?t:new C}get routes(){return this._private_routes}get notes(){return this._private_notes}get layerName(){return this._private_layerName}set layerName(t){this._private_layerName="string"==typeof t?y.sanitizeToJsString(t):"OSM - Color"}get name(){return this._private_name}set name(t){this._private_name="string"==typeof t?y.sanitizeToJsString(t):""}get readOnly(){return this._private_readOnly}set readOnly(t){this._private_readOnly="boolean"!=typeof t||t}get objId(){return this._private_objId}get objType(){return S._private_objType}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this._private_objId,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this._private_objId=f.nextObjId}}class K{_private_provider="";_private_transitMode="";constructor(){}get provider(){return this._private_provider}set provider(t){this._private_provider="string"==typeof t?t:""}get transitMode(){return this._private_transitMode}set transitMode(t){this._private_transitMode="string"==typeof t?t:""}}const R=new class{_private_providers;_private_mapObjects;_private_routing;_private_UUID;_private_map;_private_travel;_private_editedRouteObjId;_private_searchData;constructor(){this._private_providers=new Map,this._private_mapObjects=new Map,this._private_routing=new K,this._private_UUID=N.UUID,this._private_map=null,this._private_travel=new S,this._private_editedRouteObjId=h,this._private_searchData=[]}get map(){return this._private_map}set map(t){this._private_map||(this._private_map=t)}get travel(){return this._private_travel}get editedRouteObjId(){return this._private_editedRouteObjId}set editedRouteObjId(t){this._private_editedRouteObjId="number"==typeof t?t:h}get searchData(){return this._private_searchData}get providers(){return this._private_providers}get mapObjects(){return this._private_mapObjects}get routing(){return this._private_routing}get UUID(){return this._private_UUID}};const F=new class{constructor(){}dispatch(t,e){const i=new Event(t);e&&(i.data=e),document.dispatchEvent(i)}};class k{static get _private_DOT5(){return.5}static get _private_NUMBER5(){return 5}static get _private_NUMBER10(){return 10}static get _private_NUMBER31(){return 31}static get _private_NUMBER32(){return 32}static get _private_NUMBER63(){return 63}_private_python2Round(t){return Math.floor(Math.abs(t)+k._private_DOT5)*(0<=t?1:-1)}_private_encodeDelta(t,e,i){const r=this._private_python2Round(t*i),a=this._private_python2Round(e*i);let o=r-a;o<<=1,0>r-a&&(o=~o);let s="";for(;k._private_NUMBER32<=o;)s+=String.fromCharCode((k._private_NUMBER32|o&k._private_NUMBER31)+k._private_NUMBER63),o>>=k._private_NUMBER5;return s+=String.fromCharCode(o+k._private_NUMBER63),s}_private_index;_private_decodeDelta(t){let e=null,i=0,r=0;do{e=t.charCodeAt(this._private_index++)-k._private_NUMBER63,r|=(e&k._private_NUMBER31)<<i,i+=k._private_NUMBER5}while(k._private_NUMBER32<=e);return 1&r?~(r>>1):r>>1}constructor(){}encode(t,e){if(!t.length)return"";const i=e.length,r=Array.from(e,(t=>Math.pow(k._private_NUMBER10,t)));let a="";for(let e=0;e<i;e++)a+=this._private_encodeDelta(t[0][e],0,r[e]);for(let e=1;e<t.length;e++){const o=t[e],s=t[e-1];for(let t=0;t<i;t++)a+=this._private_encodeDelta(o[t],s[t],r[t])}return a}decode(t,e){const i=e.length;if(!t||0===t.length)return[];this._private_index=0;const r=[],a=Array.from(e,(t=>Math.pow(k._private_NUMBER10,t))),o=new Array(i).fill(0);for(;this._private_index<t.length;){const e=new Array(i).fill(0);for(let r=0;r<i;r++)o[r]+=this._private_decodeDelta(t),e[r]=o[r]/a[r];r.push(e)}return r}}class B{_private_compressRoute(t){const e={values:"",objType:(new M).objType.jsonObject},i=[];t.itinerary.itineraryPoints.forEach((t=>{i.push([t.lat,t.lng,t.distance,t.elev,t.objId])})),e.values=(new k).encode(i,[p.fixed,p.fixed,2,2,0]),t.itinerary.itineraryPoints=e}_private_decompressRoute(t){const e=[];if(t.itinerary.itineraryPoints.values)(new k).decode(t.itinerary.itineraryPoints.values,[p.fixed,p.fixed,2,2,0]).forEach((i=>{const r={lat:p.defaultValue,lng:p.defaultValue,distance:o.defaultValue,elev:s.defaultValue,objId:h};[r.lat,r.lng,r.distance,r.elev,r.objId]=i,r.objType=t.itinerary.itineraryPoints.objType,e.push(r)}));else{t.itinerary.itineraryPoints.latLngs=(new k).decode(t.itinerary.itineraryPoints.latLngs,[p.fixed,p.fixed]);let i=0;t.itinerary.itineraryPoints.latLngs.forEach((r=>{const a={};a.lat=r[0],a.lng=r[1],a.distance=t.itinerary.itineraryPoints.distances[i],t.itinerary.itineraryPoints.elevs?a.elev=t.itinerary.itineraryPoints.elevs[i]:a.elev=s.defaultValue,a.objId=t.itinerary.itineraryPoints.objIds[i],a.objType=t.itinerary.itineraryPoints.objType,e.push(a),i++}))}t.itinerary.itineraryPoints=e}constructor(){}decompress(t){t.routes.forEach(this._private_decompressRoute),t.editedRoute&&this._private_decompressRoute(t.editedRoute)}compress(t){const e=t.jsonObject;return e.routes.forEach((t=>this._private_compressRoute(t))),this._private_compressRoute(e.editedRoute),e}}class H{_private_lat;_private_lng;constructor(t,e){this._private_lat=t,this._private_lng=e}static clone(t){return new H(t.lat,t.lng)}get latLng(){return[this._private_lat,this._private_lng]}get lat(){return this._private_lat}get lng(){return this._private_lng}}class U extends H{_private_distance;constructor(t,e,i){super(t,e),this._private_distance=i}get distance(){return this._private_distance}}class V extends U{_private_elev;_private_ascent;constructor(t,e,i,r,a){super(t,e,i),this._private_elev=r,this._private_ascent=a}get elev(){return this._private_elev}get ascent(){return this._private_ascent}}class z{_private_providerName;_private_providerKey;constructor(t,e){this._private_providerName="string"==typeof t?t:"",this._private_providerKey="string"==typeof e?e:""}get providerName(){return this._private_providerName}get providerKey(){return this._private_providerKey}}class W{static get _private_HUNDRED(){return 100}constructor(){}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let i=0;const r=t.itinerary.itineraryPoints.iterator;for(;i<e&&!r.done;)i+=r.value.distance;const a=r.value;r.done;const o=(a.distance-i+e)/a.distance;return new V(a.lat+(r.value.lat-a.lat)*o,a.lng+(r.value.lng-a.lng)*o,e,a.elev+(r.value.elev-a.elev)*o,W._private_HUNDRED*(r.value.elev-a.elev)/a.distance)}getClosestLatLngDistance(t,e){if(0===t.itinerary.itineraryPoints.length)return null;const i=t.itinerary.itineraryPoints.iterator;i.done;let r=Number.MAX_VALUE;const a=window.L.Projection.SphericalMercator.project(window.L.latLng(e[0],e[1]));let s=window.L.Projection.SphericalMercator.project(window.L.latLng(i.value.lat,i.value.lng)),n=null,_=o.defaultValue,p=i.value.distance;for(;!i.done;){const t=window.L.Projection.SphericalMercator.project(window.L.latLng(i.value.lat,i.value.lng));let e=window.L.LineUtil.pointToSegmentDistance(a,s,t);e<r&&(r=e,n=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(a,s,t)),_=p-n.distanceTo(window.L.latLng(i.value.lat,i.value.lng))),p+=i.value.distance,s=t}return new U(n.lat,n.lng,_)}getLatLngBounds(t){const e=window.L.latLng([p.maxLat,p.maxLng]),i=window.L.latLng([p.minLat,p.minLng]);return t.forEach((t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),i.lat=Math.max(i.lat,t[0]),i.lng=Math.max(i.lng,t[1])})),window.L.latLngBounds(e,i)}getSquareBoundingBox(t,e){const i=t[0]*a.toRadians,r=e/d*a.fromRadians,o=Math.acos((Math.cos(e/d)-Math.sin(i)**2)/Math.cos(i)**2)*a.fromRadians;return window.L.latLngBounds(window.L.latLng([t[0]-r,t[1]-o]),window.L.latLng([t[0]+r,t[1]+o]))}project(t,e){const i=R.map.project(window.L.latLng(t),e);return[i.x,i.y]}screenCoordToLatLng(t,e){const i=R.map.containerPointToLatLng(window.L.point(t,e));return[i.lat,i.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const X=new W;const Z=new class{_private_normalizeLng(t){return(t+a.d540)%a.d360-a.d180}constructor(){}arcFromSummitArcArc(t,e,i){return Math.acos(Math.cos(e)*Math.cos(i)+Math.sin(e)*Math.sin(i)*Math.cos(t))}summitFromArcArcArc(t,e,i){return Math.acos((Math.cos(i)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(t,e){if(t[0]===e[0]&&t[1]===e[1])return 0;const i=t[0]*a.toRadians,r=e[0]*a.toRadians,o=(this._private_normalizeLng(e[1])-this._private_normalizeLng(t[1]))*a.toRadians;return Math.acos(Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(o))*d}};class G{_private_note;_private_route;constructor(t,e){this._private_note=t,this._private_route=e}get note(){return this._private_note}get route(){return this._private_route}}class Y{constructor(){}distance=Number.MAX_VALUE;route=null;distanceOnRoute=0;latLngOnRoute=[p.defaultValue,p.defaultValue]}const J=new class{_private_setNearestRouteData(t,e,i){if(t.objId!==R.editedRouteObjId){const r=X.getClosestLatLngDistance(t,e);if(r){const a=Z.pointsDistance(e,r.latLng);a<i.distance&&(i.route=t,i.distance=a,i.latLngOnRoute=r.latLng,i.distanceOnRoute=r.distance)}}}constructor(){}getNearestRouteData(t){const e=new Y;return R.travel.routes.forEach((i=>this._private_setNearestRouteData(i,t,e))),h!==R.editedRouteObjId&&this._private_setNearestRouteData(R.travel.editedRoute,t,e),Object.freeze(e)}getRoute(t){let e=null;return e=R.travel.routes.getAt(t),e||t===R.travel.editedRoute.objId&&(e=R.travel.editedRoute),e}getNoteAndRoute(t){let e=null,i=null;if(e=R.travel.notes.getAt(t),!e){const r=R.travel.routes.iterator;for(;!r.done&&!e;)e=r.value.notes.getAt(t),e&&(i=r.value);e||(e=R.travel.editedRoute.notes.getAt(t),e&&(i=R.travel.editedRoute))}return new G(e,i)}getWayPoint(t){let e=R.travel.editedRoute.wayPoints.getAt(t);if(!e){const i=R.travel.routes.iterator;for(;!i.done&&!e;)e=i.value.wayPoints.getAt(t)}return e}};class ${_private_geometry=[];_private_pushNoteGeometry(t){this._private_geometry.push(t.latLng),this._private_geometry.push(t.iconLatLng)}_private_pushRouteGeometry(t){t.itinerary.itineraryPoints.forEach((t=>this._private_geometry.push(t.latLng))),t.notes.forEach((t=>this._private_pushNoteGeometry(t)))}constructor(){}zoomToLatLng(t){F.dispatch("zoomto",{latLng:t})}zoomToManeuver(t){const e=R.travel.editedRoute.itinerary.maneuvers.getAt(t).itineraryPointObjId,i=R.travel.editedRoute.itinerary.itineraryPoints.getAt(e).latLng;F.dispatch("zoomto",{latLng:i})}zoomToNote(t){this._private_geometry=[],this._private_pushNoteGeometry(J.getNoteAndRoute(t).note),F.dispatch("zoomto",{geometry:[this._private_geometry]})}zoomToRoute(t){this._private_geometry=[],this._private_pushRouteGeometry(J.getRoute(t)),F.dispatch("zoomto",{geometry:[this._private_geometry]})}zoomToTravel(){this._private_geometry=[],R.travel.routes.forEach((t=>this._private_pushRouteGeometry(t))),h!==R.travel.editedRouteObjId&&this._private_pushRouteGeometry(R.travel.editedRoute),R.travel.notes.forEach((t=>this._private_pushNoteGeometry(t))),F.dispatch("zoomto",{geometry:[this._private_geometry]})}zoomToPoi(t){F.dispatch("zoomto",t)}}class q{constructor(){}openDistantFile(t){(new B).decompress(t),R.travel.jsonObject=t,R.travel.readOnly=!0,document.title="Travel & Notes"+(""===R.travel.name?"":" - "+R.travel.name);const e=R.travel.routes.iterator;for(;!e.done;)l.notEdited===e.value.editionStatus?F.dispatch("routeupdated",{removedRouteObjId:h,addedRouteObjId:e.value.objId}):R.editedRouteObjId=e.value.objId;h!==R.editedRouteObjId&&F.dispatch("routeupdated",{removedRouteObjId:h,addedRouteObjId:R.travel.editedRoute.objId});const i=R.travel.notes.iterator;for(;!i.done;)F.dispatch("noteupdated",{removedNoteObjId:h,addedNoteObjId:i.value.objId});(new $).zoomToTravel()}}const Q=new class{_private_addProperties(t,e){for(const i in e)try{if("dataset"===i){const i=e.dataset;for(const e in i)t.dataset["tan"+e]=i[e]}else t[i]=e[i]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){}create(t,e,i){let r=null;return"text"===t.toLowerCase()?r=document.createTextNode(e.value||""):(r="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this._private_addProperties(r,e)),i&&i.appendChild(r),r}};const tt=new class{_private_mainHTMLElement=null;constructor(){}createUI(){this._private_mainHTMLElement=Q.create("div",{id:"TravelNotes-AttributionsUI"},document.body)}set attributions(t){const e='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>';for(;this._private_mainHTMLElement.firstChild;)this._private_mainHTMLElement.removeChild(this._private_mainHTMLElement.firstChild);y.sanitizeToHtmlElement(e,this._private_mainHTMLElement)}};class et{_private_text;_private_color;_private_backgroundColor;constructor(t){if("string"!=typeof t?.text||"string"!=typeof t?.color||"string"!=typeof t?.backgroundColor)throw new Error("invalid toolbar for layer");this._private_text=y.sanitizeToJsString(t.text),this._private_color=y.sanitizeToColor(t.color),this._private_backgroundColor=y.sanitizeToColor(t.backgroundColor)}get text(){return this._private_text}get color(){return this._private_color}get backgroundColor(){return this._private_backgroundColor}}class it{_private_name=null;_private_service=null;_private_url=null;_private_wmsOptions=null;_private_bounds=null;_private_minZoom=null;_private_maxZoom=null;_private_toolbarButtonData=null;_private_providerName=null;_private_providerKeyNeeded=!1;_private_attribution=null;_private_jsonLayer=null;_private_setLayerName(){if("string"!=typeof this._private_jsonLayer?.name)throw new Error("invalid name for layer");this._private_name=y.sanitizeToJsString(this._private_jsonLayer.name)}_private_setService(){if("wms"!==this._private_jsonLayer?.service&&"wmts"!==this._private_jsonLayer?.service)throw new Error("invalid service for layer "+this._private_name);this._private_service=this._private_jsonLayer.service}_private_setUrl(){if("string"!=typeof this._private_jsonLayer?.url)throw new Error("invalid url for layer "+this._private_name);this._private_url=this._private_jsonLayer.url}_private_setWmsOptions(){if("wms"===this._private_service){if("string"!=typeof this._private_jsonLayer?.wmsOptions?.layers||"string"!=typeof this._private_jsonLayer?.wmsOptions?.format||"boolean"!=typeof this._private_jsonLayer?.wmsOptions?.transparent)throw new Error("invalid wmsOptions for layer "+this._private_name);this._private_wmsOptions=this._private_jsonLayer.wmsOptions,this._private_wmsOptions.layers=y.sanitizeToJsString(this._private_wmsOptions.layers),this._private_wmsOptions.format=y.sanitizeToJsString(this._private_wmsOptions.format)}}_private_setBounds(){try{this._private_jsonLayer.bounds&&"number"==typeof this._private_jsonLayer.bounds[0][0]&&"number"==typeof this._private_jsonLayer.bounds[0][1]&&"number"==typeof this._private_jsonLayer.bounds[1][0]&&"number"==typeof this._private_jsonLayer.bounds[1][1]&&(this._private_bounds=this._private_jsonLayer.bounds)}catch(t){throw new Error("invalid bounds for layer "+this._private_name)}}_private_setMinMaxZoom(){if(this._private_jsonLayer.minZoom){if("number"!=typeof this._private_jsonLayer.minZoom)throw new Error("invalid minZoom for layer "+this._private_name);this._private_minZoom=this._private_jsonLayer.minZoom}if(this._private_jsonLayer.maxZoom){if("number"!=typeof this._private_jsonLayer.maxZoom)throw new Error("invalid maxZoom for layer "+this._private_name);this._private_maxZoom=this._private_jsonLayer.maxZoom}}_private_setToolbarButtonData(){this._private_toolbarButtonData=new et(this._private_jsonLayer.toolbar)}_private_setProviderName(){if("string"!=typeof this._private_jsonLayer?.providerName)throw new Error("invalid providerName for layer "+this._private_name);this._private_providerName=y.sanitizeToJsString(this._private_jsonLayer.providerName)}_private_setProviderKeyNeeded(){if("boolean"!=typeof this._private_jsonLayer.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this._private_name);this._private_providerKeyNeeded=this._private_jsonLayer.providerKeyNeeded}_private_setAttributions(){if(""===this._private_jsonLayer.attribution)this._private_attribution="";else{if("string"!=typeof this._private_jsonLayer?.attribution)throw new Error("invalid attribution for map layer "+this._private_name);this._private_attribution=y.sanitizeToHtmlString(this._private_jsonLayer.attribution).htmlString}}constructor(t){this._private_jsonLayer=t,this._private_setLayerName(),this._private_setService(),this._private_setUrl(),this._private_setWmsOptions(),this._private_setBounds(),this._private_setMinMaxZoom(),this._private_setToolbarButtonData(),this._private_setProviderName(),this._private_setProviderKeyNeeded(),this._private_setAttributions(),this._private_jsonLayer=null}get name(){return this._private_name}get service(){return this._private_service}get url(){return this._private_url}get wmsOptions(){return this._private_wmsOptions}get bounds(){return this._private_bounds}get minZoom(){return this._private_minZoom}get maxZoom(){return this._private_maxZoom}get toolbarButtonData(){return this._private_toolbarButtonData}get providerName(){return this._private_providerName}get providerKeyNeeded(){return this._private_providerKeyNeeded}get attribution(){return this._private_attribution}}const rt=new class{_private_status=navigator.geolocation?n.inactive:n.disabled;_private_watchId=null;_private_showPosition(t){F.dispatch("geolocationpositionchanged",{position:t})}_private_stop(){n.active===this._private_status&&(this._private_status=n.inactive),F.dispatch("geolocationstatuschanged",{status:this._private_status}),this._private_watchId&&(navigator.geolocation.clearWatch(this._private_watchId),this._private_watchId=null)}_private_error(t){1===t.code&&(this._private_status=n.refusedByUser),this._private_stop()}_private_start(){this._private_status=n.active,F.dispatch("geolocationstatuschanged",{status:this._private_status}),navigator.geolocation.getCurrentPosition((t=>this._private_showPosition(t)),(t=>this._private_error(t)),t.geoLocation.options),t.geoLocation.watch&&(this._private_watchId=navigator.geolocation.watchPosition((t=>this._private_showPosition(t)),(t=>this._private_error(t)),t.geoLocation.options))}constructor(){}get status(){return this._private_status}switch(){switch(this._private_status){case n.inactive:this._private_start();break;case n.active:this._private_stop()}return this._private_status}};class at{_private_mapLayers;constructor(t){this._private_mapLayers=t}handleEvent(t){t.stopPropagation();const e=this._private_mapLayers[Number.parseInt(t.target.dataset.tanMapLayerId)];F.dispatch("layerchange",{layer:e}),tt.attributions=e.attribution}}class ot{constructor(){}handleEvent(t){t.stopPropagation(),rt.switch()}}class st{constructor(){}handleEvent(t){t.stopPropagation(),(new $).zoomToTravel()}}const nt=new class{_private_mapLayersToolbar;_private_mapLayers;constructor(){this._private_mapLayers=[];const t=new it({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""});this._private_mapLayers.push(t)}createUI(){this._private_mapLayersToolbar=Q.create("div",{id:"TravelNotes-ViewerLayersToolbarUI"},document.body),Q.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"My position",textContent:"🌐",style:"color:black;background-color:white"},this._private_mapLayersToolbar).addEventListener("click",new ot,!1),Q.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:"Zoom on the travel",textContent:"🔍",style:"color:black;background-color:white"},this._private_mapLayersToolbar).addEventListener("click",new st,!1);const t=new at(this._private_mapLayers);for(let e=0;e<this._private_mapLayers.length;e++){const i=this._private_mapLayers[e];Q.create("div",{className:"TravelNotes-ViewerLayersToolbarUI-Button",title:i.name,dataset:{MapLayerId:e},textContent:i.toolbarButtonData.text,style:"color:"+i.toolbarButtonData.color+";background-color:"+i.toolbarButtonData.backgroundColor},this._private_mapLayersToolbar).addEventListener("click",t,!1)}}setMapLayer(t){const e=t.match(/^[0-9]$/)?this._private_mapLayers[Number.parseInt(t)]||this._private_mapLayers[0]:this._private_mapLayers.find((e=>e.name===t))||this._private_mapLayers[0];F.dispatch("layerchange",{layer:e}),tt.attributions=e.attribution}addMapLayers(t){t.forEach((t=>{const e=new it(t);e.providerKeyNeeded||this._private_mapLayers.push(e)}))}};const _t=new class{_private_travelNotesLoaded;async _private_loadDistantTravel(t){const e=await fetch(t);c===e.status&&e.ok?(new q).openDistantFile(await e.json()):(R.map.setView([p.defaultValue,p.defaultValue],2),document.title="Travel & Notes")}constructor(){this._private_travelNotesLoaded=!1}addReadOnlyMap(t,e){this._private_travelNotesLoaded||(this._private_travelNotesLoaded=!0,tt.createUI(),e&&nt.createUI(),nt.setMapLayer("OSM - Color"),t&&this._private_loadDistantTravel(t))}};class pt{_private_route;_private_svg;_private_YScale;_private_XScale;_private_minElev;_private_maxElev;_private_deltaElev;static get PROFILE_MARGIN(){return 100}static get PROFILE_HEIGHT(){return 500}static get PROFILE_WIDTH(){return 1e3}static get X_DELTA_TEXT(){return 10}static get Y_DELTA_TEXT(){return 30}static get _private_X_SCALES(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}static get _private_Y_SCALES(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3]}static get _private_MAX_X_LEGEND_NUMBER(){return 8}static get _private_MAX_Y_LEGEND_NUMBER(){return 4}static get _private_LEFT_PROFILE(){return pt.PROFILE_MARGIN.toFixed(0)}static get _private_RIGHT_PROFILE(){return(pt.PROFILE_MARGIN+pt.PROFILE_WIDTH).toFixed(0)}static get _private_TOP_PROFILE(){return pt.PROFILE_MARGIN.toFixed(0)}static get _private_BOTTOM_PROFILE(){return(pt.PROFILE_MARGIN+pt.PROFILE_HEIGHT).toFixed(0)}static get _private_LEFT_TEXT_PROFILE(){return(pt.PROFILE_MARGIN-pt.X_DELTA_TEXT).toFixed(0)}static get _private_RIGHT_TEXT_PROFILE(){return(pt.PROFILE_MARGIN+pt.PROFILE_WIDTH+pt.X_DELTA_TEXT).toFixed(0)}static get _private_BOTTOM_TEXT_PROFILE(){return pt.PROFILE_MARGIN+pt.PROFILE_HEIGHT+pt.PROFILE_MARGIN/2}_private_createProfilePolyline(){let t="",e=0,i=0,r=0;this._private_route.itinerary.itineraryPoints.forEach((a=>{i=(pt.PROFILE_MARGIN+this._private_XScale*e).toFixed(0),r=(pt.PROFILE_MARGIN+this._private_YScale*(this._private_maxElev-a.elev)).toFixed(0),t+=i+","+r+" ",e+=a.distance}));const a=document.createElementNS(g,"polyline");a.setAttributeNS(null,"points",t),a.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-profilePolyline"),this._private_svg.appendChild(a)}_private_createFramePolyline(){const t=pt._private_LEFT_PROFILE+","+pt._private_TOP_PROFILE+" "+pt._private_LEFT_PROFILE+","+pt._private_BOTTOM_PROFILE+" "+pt._private_RIGHT_PROFILE+","+pt._private_BOTTOM_PROFILE+" "+pt._private_RIGHT_PROFILE+","+pt._private_TOP_PROFILE,e=document.createElementNS(g,"polyline");e.setAttributeNS(null,"points",t),e.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-framePolyline"),this._private_svg.appendChild(e)}_private_createDistanceTexts(){let t=Number.MAX_VALUE,e=0;pt._private_X_SCALES.forEach((i=>{const r=Math.abs(this._private_route.distance/pt._private_MAX_X_LEGEND_NUMBER-i);r<t&&(t=r,e=i)}));let i=Math.ceil(this._private_route.chainedDistance/e)*e;for(;i<this._private_route.distance+this._private_route.chainedDistance;){const t=document.createElementNS(g,"text");t.appendChild(document.createTextNode(o.metersInKm<e||0<this._private_route.chainedDistance?i/o.metersInKm+" km":i+" m ")),t.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-distLegend"),t.setAttributeNS(null,"x",pt.PROFILE_MARGIN+(i-this._private_route.chainedDistance)*this._private_XScale),t.setAttributeNS(null,"y",pt._private_BOTTOM_TEXT_PROFILE),t.setAttributeNS(null,"text-anchor","start"),this._private_svg.appendChild(t),i+=e}}_private_createElevTexts(){let t=Number.MAX_VALUE,e=0;pt._private_Y_SCALES.forEach((i=>{const r=Math.abs(this._private_deltaElev/pt._private_MAX_Y_LEGEND_NUMBER-i);r<t&&(t=r,e=i)}));let i=Math.ceil(this._private_minElev/e)*e;for(;i<this._private_maxElev;){const t=pt.PROFILE_MARGIN+(this._private_maxElev-i)*this._private_YScale,r=document.createElementNS(g,"text");r.appendChild(document.createTextNode(i.toFixed(0))),r.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),r.setAttributeNS(null,"x",pt._private_RIGHT_TEXT_PROFILE),r.setAttributeNS(null,"y",t),r.setAttributeNS(null,"text-anchor","start"),this._private_svg.appendChild(r);const a=document.createElementNS(g,"text");a.appendChild(document.createTextNode(i.toFixed(0))),a.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),a.setAttributeNS(null,"x",pt._private_LEFT_TEXT_PROFILE),a.setAttributeNS(null,"y",t),a.setAttributeNS(null,"text-anchor","end"),this._private_svg.appendChild(a),i+=e}}_private_createSvgElement(){this._private_svg=document.createElementNS(g,"svg"),this._private_svg.setAttributeNS(null,"viewBox","0 0 "+(pt.PROFILE_WIDTH+2*pt.PROFILE_MARGIN)+" "+(pt.PROFILE_HEIGHT+2*pt.PROFILE_MARGIN)),this._private_svg.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile")}constructor(){}createSvg(t){return this._private_route=t,this._private_minElev=Number.MAX_VALUE,this._private_maxElev=0,this._private_route.itinerary.itineraryPoints.forEach((t=>{this._private_maxElev=Math.max(this._private_maxElev,t.elev),this._private_minElev=Math.min(this._private_minElev,t.elev)})),this._private_deltaElev=this._private_maxElev-this._private_minElev,this._private_YScale=pt.PROFILE_HEIGHT/this._private_deltaElev,this._private_XScale=pt.PROFILE_WIDTH/this._private_route.distance,this._private_createSvgElement(),this._private_createProfilePolyline(),this._private_createFramePolyline(),this._private_createElevTexts(),this._private_createDistanceTexts(),this._private_svg}}class lt{static get _private_LINKS_MAX_LENGTH(){return 40}static get _private_MIN_NOTES_DISTANCE(){return 40}constructor(){}getNoteTextAndIconHTML(e,i){const r=Q.create("div",{dataset:{ObjId:i.note.objId}}),a=Q.create("div",{className:e+(i.route?"Route-ManeuversAndNotes-IconCell":"Travel-Notes-IconCell")},r);let o=1;y.sanitizeToHtmlElement(i.note.iconContent,a),"TravelNotes-Roadbook-"===e&&a.firstChild&&("svg"===a.firstChild.tagName?(a.firstChild.setAttributeNS(null,"viewBox","0 0 "+_.svgViewboxDim+" "+_.svgViewboxDim),o=t.note.svgIcon.roadbookFactor):a?.firstChild?.classList?.contains("TravelNotes-MapNoteCategory-0073")&&(o=t.note.svgIcon.roadbookFactor)),a.dataset.tanWidth=String(i.note.iconWidth*o)+"px",a.dataset.tanHeight=String(i.note.iconHeight*o)+"px",a.style.width=String(i.note.iconWidth*o)+"px",a.style.height=String(i.note.iconHeight*o)+"px";const s=this.getNoteTextHTML(e,i);return s.className=e+(i.route?"Route-ManeuversAndNotes-Cell":"Travel-Notes-Cell"),r.appendChild(s),r}getNoteTextHTML(t,e){const i=e.note,r=Q.create("div");if(0!==i.tooltipContent.length&&y.sanitizeToHtmlElement(i.tooltipContent,Q.create("div",{className:t+"NoteHtml-TooltipContent"},r)),0!==i.popupContent.length&&y.sanitizeToHtmlElement(i.popupContent,Q.create("div",{className:t+"NoteHtml-PopupContent"},r)),0!==i.address.length&&y.sanitizeToHtmlElement("<span>"+I.getText("NoteHTMLViewsFactory - Address")+"</span> : "+i.address,Q.create("div",{className:t+"NoteHtml-Address"},r)),0!==i.url.length&&y.sanitizeToHtmlElement("<span>"+I.getText("NoteHTMLViewsFactory - Link")+"</span><a href="+i.url+' target="_blank" >'+i.url.substring(0,lt._private_LINKS_MAX_LENGTH)+"...</a>",Q.create("div",{className:t+"NoteHtml-Url"},r)),0!==i.phone.length){let e=i.phone;if(i.phone.match(/^\+[0-9, ,*,\u0023]*$/)){const t=i.phone.replaceAll(/\u0020/g,""),r=i.phone.replaceAll(/\u0020/g," ");e=I.getText("NoteHTMLViewsFactory - Phone")+" : "+I.getText("NoteHTMLViewsFactory - call")+'<a target="_blank" href="tel:'+t+'" >'+r+"</a>"+I.getText("NoteHTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+t+'" >'+r+"</a>"}else e=I.getText("NoteHTMLViewsFactory - Phone")+" : "+i.phone;y.sanitizeToHtmlElement(e,Q.create("div",{className:t+"NoteHtml-Phone"},r))}if(y.sanitizeToHtmlElement(N.formatLatLng(i.latLng),Q.create("div",{className:t+"NoteHtml-LatLng"},r)),e.route){e.route.chain&&y.sanitizeToHtmlElement("<span>"+I.getText("NoteHTMLViewsFactory - Distance from start of travel")+"</span> : "+N.formatDistance(i.chainedDistance+i.distance),Q.create("div",{className:t+"NoteHtml-TravelDistance"},r)),y.sanitizeToHtmlElement("<span>"+I.getText("NoteHTMLViewsFactory - Distance from start of route")+"</span> : "+N.formatDistance(i.distance),Q.create("div",{className:t+"NoteHtml-RouteDistance"},r));const a=e.route.notes.next(i.objId);if(a){const e=a.distance-i.distance;lt._private_MIN_NOTES_DISTANCE<e&&y.sanitizeToHtmlElement("<span>"+I.getText("NoteHTMLViewsFactory - Next note after")+"</span> : "+N.formatDistance(e),Q.create("div",{className:t+"NoteHtml-NextDistance"},r))}}return r}getTravelNotesHTML(t){const e=Q.create("div",{className:t+"Travel-Notes"}),i=R.travel.notes.iterator;for(;!i.done;){const r=this.getNoteTextAndIconHTML(t,{note:i.value,route:null});r.className=t+"Travel-Notes-Row",e.appendChild(r)}return e}}const vt=new lt;const dt=new class{_private_getManeuverHTML(t,e){const i=Q.create("div"),r=Q.create("div",{className:t+"Route-ManeuversAndNotes-IconCell"},i);Q.create("div",{className:"TravelNotes-ManeuverNote TravelNotes-ManeuverNote-"+e.maneuver.iconName},r),r.dataset.tanWidth=String(_.width)+"px",r.dataset.tanHeight=String(_.height)+"px";const a=Q.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},i);return Q.create("div",{className:t+"Route-Maneuver-TooltipContent",textContent:I.getText("RouteHTMLViewsFactory - "+e.maneuver.iconName)},a),y.sanitizeToHtmlElement(e.maneuver.instruction,Q.create("div",{className:t+"Route-Maneuver-Instruction"},a)),e.route.chain&&y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Distance from start of travel")+"</span> : "+N.formatDistance(e.route.chainedDistance+e.maneuverDistance),Q.create("div",{className:t+"Route-Maneuver-TravelDistance"},a)),y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Distance from start of route")+"</span> : "+N.formatDistance(e.maneuverDistance),Q.create("div",{className:t+"Route-Maneuver-RouteDistance"},a)),o.defaultValue<e.maneuver.distance&&y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Next maneuver after")+"</span> : "+N.formatDistance(e.maneuver.distance),Q.create("div",{className:t+"Route-Maneuver-NextDistance"},a)),i}constructor(){}getRouteProfileHTML(t,e){const i=Q.create("div",{className:t+"RouteProfile"});return y.sanitizeToHtmlElement(I.getText("RouteHTMLViewsFactory - Profile"),i),i.appendChild((new pt).createSvg(e)),i}getRouteManeuversAndNotesHTML(t,e,i){const r=[],a=e.notes.iterator;for(;!a.done;)r.push({data:a.value,distance:a.value.distance});const o=e.itinerary.maneuvers.iterator;let s=0;for(;!o.done;)r.push({data:o.value,distance:s}),s+=o.value.distance;r.sort(((t,e)=>t.distance-e.distance));const n=Q.create("div",{className:t+"Route-ManeuversAndNotes"});return r.forEach((r=>{let a=null;"Note"===r.data.objType.name?(a=vt.getNoteTextAndIconHTML(t,{note:r.data,route:e}),a.className=t+"Route-Notes-Row"):(a=this._private_getManeuverHTML(t,{route:e,maneuver:r.data,maneuverDistance:r.distance}),a.className=t+"Route-Maneuvers-Row"),i&&(a.dataset.tanObjId=r.data.objId,a.dataset.tanMarkerObjId=f.nextObjId,a.dataset.tanObjType=r.data.objType.name),n.appendChild(a)})),n}getRouteHeaderHTML(t,e){const i=Q.create("div",{className:t+"Route-Header",id:"route"+e.objId});return y.sanitizeToHtmlElement(e.computedName,Q.create("div",{className:t+"Route-Header-Name"},i)),0!==e.distance&&y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Route distance")+"</span> : "+N.formatDistance(e.distance),Q.create("div",{className:t+"Route-Header-Distance"},i)),R.travel.readOnly||"bike"===e.itinerary.transitMode||y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Duration")+"</span> : "+N.formatTime(e.duration),Q.create("div",{className:t+"Route-Header-Duration"},i)),e.itinerary.hasProfile&&(y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Ascent")+"</span> : "+String(e.itinerary.ascent.toFixed(0))+" m.",Q.create("div",{className:t+"Route-Header-Ascent"},i)),y.sanitizeToHtmlElement("<span>"+I.getText("RouteHTMLViewsFactory - Descent")+"</span> : "+String(e.itinerary.descent.toFixed(0))+" m.",Q.create("div",{className:t+"Route-Header-Descent"},i))),i}getRouteFooterHTML(t,e){let i=""!==e.itinerary.provider&&""!==e.itinerary.transitMode?I.getText("RouteHTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:I.getText("RouteHTMLViewsFactory - TransitMode "+e.itinerary.transitMode)}):"";const r=Q.create("div",{className:t+"RouteFooter"});return y.sanitizeToHtmlElement(i,r),r}};Object.freeze({get previousItem(){return-1},get firstItem(){return 0},get nextItem(){return 1},get lastItem(){return 2}});class ct{_private_baseDialog;constructor(t){this._private_baseDialog=t}handleEvent(){this._private_baseDialog.onOk()}}class ht{_private_baseDialog;constructor(t){this._private_baseDialog=t}handleEvent(){this._private_baseDialog.onCancel()}}class ut{_private_dragData;constructor(t){this._private_dragData=t}handleEvent(t){this._private_dragData.dragStartX=t.screenX,this._private_dragData.dragStartY=t.screenY,t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move"}}class gt{_private_dragData;_private_container;_private_background;constructor(t,e,i){this._private_dragData=t,this._private_container=e,this._private_background=i}handleEvent(t){this._private_dragData.dialogX+=t.screenX-this._private_dragData.dragStartX,this._private_dragData.dialogX=Math.min(Math.max(this._private_dragData.dialogX,v),this._private_background.clientWidth-this._private_container.clientWidth-v),this._private_dragData.dialogY+=t.screenY-this._private_dragData.dragStartY,this._private_dragData.dialogY=Math.max(this._private_dragData.dialogY,v);const e=this._private_background.clientHeight-Math.max(this._private_dragData.dialogY,0)-v;this._private_container.style.left=String(this._private_dragData.dialogX)+"px",this._private_container.style.top=String(this._private_dragData.dialogY)+"px",this._private_container.style["max-height"]=String(e)+"px"}}class mt{_private_baseDialog;constructor(t){this._private_baseDialog=t}handleEvent(t){this._private_baseDialog.keyboardELEnabled&&("Escape"===t.key||"Esc"===t.key?this._private_baseDialog.onCancel():"Enter"===t.key&&this._private_baseDialog.onOk())}}class yt{_private_mapCenter;constructor(){}handleEvent(t){if("start"===t.action)return void(this._private_mapCenter=R.map.getCenter());const e=X.screenCoordToLatLng(t.startX,t.startY),i=X.screenCoordToLatLng(t.endX,t.endY);R.map.panTo([this._private_mapCenter.lat+e[0]-i[0],this._private_mapCenter.lng+e[1]-i[1]])}}class bt{static get _private_ZOOM_DISPLACMENT(){return 25}_private_initialZoom;_private_startPoint;constructor(){this._private_initialZoom=0}handleEvent(t){if("start"===t.action)return this._private_initialZoom=R.map.getZoom(),void(this._private_startPoint=window.L.point(t.clientX,t.clientY));let e=Math.floor(this._private_initialZoom+(t.startY-t.endY)/bt._private_ZOOM_DISPLACMENT);e=Math.min(R.map.getMaxZoom(),e),e=Math.max(R.map.getMinZoom(),e),R.map.setZoomAround(this._private_startPoint,e)}}class ft{constructor(){}handleEvent(t){if(!t.target.classList.contains("TravelNotes-Background"))return;let e=R.map.getZoom()+(0>t.deltaY?1:-1);e=Math.min(R.map.getMaxZoom(),e),e=Math.max(R.map.getMinZoom(),e),R.map.setZoomAround(window.L.point(t.clientX,t.clientY),e)}}class Lt{constructor(){}handleEvent(t){t.preventDefault()}}class wt{constructor(){}handleEvent(t){t.preventDefault()}}class Tt{_private_panOngoing=!1;_private_startPanX=0;_private_startPanY=0;_private_target=null;_private_button=0;_private_eventType="";_private_dispatchEvent(t,e){const i=new Event(this._private_eventType);i.startX=this._private_startPanX,i.startY=this._private_startPanY,i.endX=t.screenX,i.endY=t.screenY,i.clientX=t.clientX,i.clientY=t.clientY,i.action=e,this._private_target.dispatchEvent(i)}constructor(t,e){switch(this._private_target=t,this._private_button=e,e){case 0:this._private_eventType="leftpan";break;case 1:this._private_eventType="middlepan";break;case 2:this._private_eventType="rightpan";break;default:this._private_button=u}}handleEvent(t){switch(t.type){case"mousedown":t.button===this._private_button&&t.target===this._private_target&&(this._private_startPanX=t.screenX,this._private_startPanY=t.screenY,this._private_panOngoing=!0,this._private_dispatchEvent(t,"start"));break;case"mouseup":t.button!==this._private_button||!this._private_panOngoing||this._private_startPanX===t.screenX&&this._private_startPanY===t.screenY||this._private_dispatchEvent(t,"end"),this._private_panOngoing=!1;break;case"mousemove":this._private_panOngoing&&(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),this._private_dispatchEvent(t,"move"))}}}class Et{_private_target;_private_eventListener;static get LEFT_BUTTON(){return 0}static get MIDDLE_BUTTON(){return 1}static get RIGHT_BUTTON(){return 2}constructor(t,e){this._private_target=t,this._private_eventListener=new Tt(t,e??0),this._private_target.addEventListener("mousedown",this._private_eventListener),this._private_target.addEventListener("mouseup",this._private_eventListener),this._private_target.addEventListener("mousemove",this._private_eventListener)}detach(){this._private_target.removeEventListener("mousedown",this._private_eventListener),this._private_target.removeEventListener("mouseup",this._private_eventListener),this._private_target.removeEventListener("mousemove",this._private_eventListener),this._private_eventListener=null,this._private_target=null}}class It{constructor(){}dragStartX=0;dragStartY=0;dialogX=0;dialogY=0}class Nt{_private_firstButtonText=null;_private_secondButtonText=null;_private_selectOptionsData=null;_private_title=null;_private_text=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this._private_firstButtonText=t.firstButtonText;break;case"secondButtonText":this._private_secondButtonText=t.secondButtonText;break;case"selectOptionsData":this._private_selectOptionsData=t.selectOptionsData;break;case"title":this._private_title=t.title;break;case"text":this._private_text=t.text}}get firstButtonText(){return this._private_firstButtonText}get secondButtonText(){return this._private_secondButtonText}get selectOptionsData(){return this._private_selectOptionsData}get title(){return this._private_title}get text(){return this._private_text}}class Dt{_private_backgroundDiv;_private_containerDiv;_private_errorDiv;_private_waitDiv;_private_okButton;_private_cancelButton;_private_topBar;_private_secondButton;_private_leftPanEventDispatcher;_private_rightPanEventDispatcher;_private_keyboardELEnabled;_private_dragData;_private_backgroundLeftPanEL;_private_backgroundRightPanEL;_private_backgroundDragOverEL;_private_backgroundWheelEL;_private_backgroundContextMenuEL;_private_topBarDragStartEL;_private_topBarDragEndEL;_private_cancelDialogButtonClickEL;_private_okButtonClickEL;_private_dialogKeyboardKeydownEL;_private_options=null;_private_onPromiseOkFct;_private_onPromiseErrorFct;_private_createBackgroundDiv(){this._private_backgroundDiv=Q.create("div",{className:"TravelNotes-Background"}),this._private_leftPanEventDispatcher=new Et(this._private_backgroundDiv,Et.LEFT_BUTTON),this._private_rightPanEventDispatcher=new Et(this._private_backgroundDiv,Et.RIGHT_BUTTON),this._private_backgroundLeftPanEL=new yt,this._private_backgroundDiv.addEventListener("leftpan",this._private_backgroundLeftPanEL,!1),this._private_backgroundRightPanEL=new bt,this._private_backgroundDiv.addEventListener("rightpan",this._private_backgroundRightPanEL,!1),this._private_backgroundDragOverEL=new wt,this._private_backgroundDiv.addEventListener("dragover",this._private_backgroundDragOverEL,!1),this._private_backgroundWheelEL=new ft,this._private_backgroundDiv.addEventListener("wheel",this._private_backgroundWheelEL,{passive:!0}),this._private_backgroundContextMenuEL=new Lt,this._private_backgroundDiv.addEventListener("contextmenu",this._private_backgroundContextMenuEL,!1)}_private_createContainerDiv(){this._private_containerDiv=Q.create("div",{className:"TravelNotes-BaseDialog-Container"},this._private_backgroundDiv)}_private_createTopBar(){this._private_topBar=Q.create("div",{className:"TravelNotes-BaseDialog-TopBar",draggable:!0},this._private_containerDiv),this._private_topBarDragStartEL=new ut(this._private_dragData),this._private_topBar.addEventListener("dragstart",this._private_topBarDragStartEL,!1),this._private_topBarDragEndEL=new gt(this._private_dragData,this._private_containerDiv,this._private_backgroundDiv),this._private_topBar.addEventListener("dragend",this._private_topBarDragEndEL,!1),this._private_cancelButton=Q.create("div",{textContent:"❌",className:"TravelNotes-BaseDialog-CancelButton",title:I.getText("BaseDialog - Cancel")},this._private_topBar),this._private_cancelDialogButtonClickEL=new ht(this),this._private_cancelButton.addEventListener("click",this._private_cancelDialogButtonClickEL,!1)}_private_createHeaderDiv(){Q.create("text",{value:this.title},Q.create("div",{className:"TravelNotes-BaseDialog-HeaderDiv"},this._private_containerDiv))}_private_createContentDiv(){const t=Q.create("div",{className:"TravelNotes-BaseDialog-ContentDiv"},this._private_containerDiv);this.contentHTMLElements.forEach((e=>t.appendChild(e)))}_private_createErrorDiv(){this._private_errorDiv=Q.create("div",{className:"TravelNotes-BaseDialog-ErrorDiv TravelNotes-Hidden"},this._private_containerDiv)}_private_createWaitDiv(){Q.create("div",{className:"TravelNotes-WaitAnimationBullet"},Q.create("div",{className:"TravelNotes-WaitAnimation"},this._private_waitDiv=Q.create("div",{className:"TravelNotes-BaseDialog-WaitDiv  TravelNotes-Hidden"},this._private_containerDiv)))}_private_createFooterDiv(){const t=Q.create("div",{className:"TravelNotes-BaseDialog-FooterDiv"},this._private_containerDiv);this._private_okButton=Q.create("div",{textContent:this._private_options.firstButtonText||"🆗",className:"TravelNotes-BaseDialog-Button"},t),this._private_okButtonClickEL=new ct(this),this._private_okButton.addEventListener("click",this._private_okButtonClickEL,!1),this._private_options.secondButtonText?(this._private_secondButton=Q.create("div",{textContent:this._private_options.secondButtonText,className:"TravelNotes-BaseDialog-Button"},t),this._private_secondButton.addEventListener("click",this._private_cancelDialogButtonClickEL,!1)):this._private_secondButton=null,this.footerHTMLElements.forEach((e=>t.appendChild(e)))}_private_createHTML(){this._private_createBackgroundDiv(),this._private_createContainerDiv(),this._private_createTopBar(),this._private_createHeaderDiv(),this._private_createContentDiv(),this._private_createErrorDiv(),this._private_createWaitDiv(),this._private_createFooterDiv()}_private_centerDialog(){this._private_dragData.dialogX=(this._private_backgroundDiv.clientWidth-this._private_containerDiv.clientWidth)/2,this._private_dragData.dialogY=(this._private_backgroundDiv.clientHeight-this._private_containerDiv.clientHeight)/2,this._private_dragData.dialogX=Math.min(Math.max(this._private_dragData.dialogX,v),this._private_backgroundDiv.clientWidth-this._private_containerDiv.clientWidth-v),this._private_dragData.dialogY=Math.max(this._private_dragData.dialogY,v);const t=this._private_backgroundDiv.clientHeight-Math.max(this._private_dragData.dialogY,0)-v;this._private_containerDiv.style.left=String(this._private_dragData.dialogX)+"px",this._private_containerDiv.style.top=String(this._private_dragData.dialogY)+"px",this._private_containerDiv.style["max-height"]=String(t)+"px"}_private_show(t,e){this._private_onPromiseOkFct=t,this._private_onPromiseErrorFct=e,this._private_createHTML(),document.body.appendChild(this._private_backgroundDiv),this._private_centerDialog(),this._private_dialogKeyboardKeydownEL=new mt(this),document.addEventListener("keydown",this._private_dialogKeyboardKeydownEL,{capture:!0}),this.onShow()}constructor(t){this._private_dragData=new It,this._private_options=new Nt(t),this._private_keyboardELEnabled=!0}_private_BaseDialogDestructor(){document.removeEventListener("keydown",this._private_dialogKeyboardKeydownEL,{capture:!0}),this._private_dialogKeyboardKeydownEL=null,this._private_topBar.removeEventListener("dragstart",this._private_topBarDragStartEL,!1),this._private_topBarDragStartEL=null,this._private_topBar.removeEventListener("dragend",this._private_topBarDragEndEL,!1),this._private_topBarDragEndEL=null,this._private_cancelButton.removeEventListener("click",this._private_cancelDialogButtonClickEL,!1),this._private_options.secondButtonText&&this._private_secondButton.removeEventListener("click",this._private_cancelDialogButtonClickEL,!1),this._private_cancelDialogButtonClickEL=null,this._private_okButton.removeEventListener("click",this._private_okButtonClickEL,!1),this._private_okButtonClickEL=null,this._private_backgroundDiv.removeEventListener("leftpan",this._private_backgroundLeftPanEL,!1),this._private_backgroundLeftPanEL=null,this._private_backgroundDiv.removeEventListener("rightpan",this._private_backgroundRightPanEL,!1),this._private_backgroundRightPanEL=null,this._private_backgroundDiv.removeEventListener("wheel",this._private_backgroundWheelEL,{passive:!0}),this._private_backgroundWheelEL=null,this._private_backgroundDiv.removeEventListener("contextmenu",this._private_backgroundContextMenuEL,!1),this._private_backgroundContextMenuEL=null,this._private_backgroundDiv.removeEventListener("dragover",this._private_backgroundDragOverEL,!1),this._private_backgroundDragOverEL=null,this._private_leftPanEventDispatcher.detach(),this._private_rightPanEventDispatcher.detach(),document.body.removeChild(this._private_backgroundDiv)}onCancel(){this._private_BaseDialogDestructor(),this._private_onPromiseErrorFct("Canceled by user")}canClose(){return!0}onOk(t){return!!this.canClose()&&(this._private_BaseDialogDestructor(),this._private_onPromiseOkFct(t),!0)}onShow(){}get title(){return""}get contentHTMLElements(){return[]}get footerHTMLElements(){return[]}show(){return new Promise(((t,e)=>this._private_show(t,e)))}showWait(){this._private_waitDiv.classList.remove("TravelNotes-Hidden"),this._private_okButton.classList.add("TravelNotes-Hidden")}hideWait(){this._private_waitDiv.classList.add("TravelNotes-Hidden"),this._private_okButton.classList.remove("TravelNotes-Hidden")}showError(t){this._private_errorDiv.textContent="",y.sanitizeToHtmlElement(t,this._private_errorDiv),this._private_errorDiv.classList.remove("TravelNotes-Hidden")}hideError(){this._private_errorDiv.textContent="",this._private_errorDiv.classList.add("TravelNotes-Hidden")}get keyboardELEnabled(){return this._private_keyboardELEnabled}set keyboardELEnabled(t){this._private_keyboardELEnabled=t}get options(){return this._private_options}}const Pt=new class{_private_mainHTMLElement;_private_messageHTMLElement;_private_timerId;_private_hideHelpInput;_private_hideHelpHTMLElement;_private_currentErrorLevel;_private_hide(){this._private_timerId&&(clearTimeout(this._private_timerId),this._private_timerId=null),this._private_mainHTMLElement.classList.remove("TravelNotes-ErrorsUI-"+this._private_currentErrorLevel),this._private_mainHTMLElement.classList.add("TravelNotes-Hidden"),this._private_hideHelpHTMLElement.classList.add("TravelNotes-Hidden"),this._private_messageHTMLElement.textContent=""}_private_show(e,i){if(this._private_currentErrorLevel=i,!t.errorsUI["show"+this._private_currentErrorLevel]||"Help"===i&&this._private_hideHelpInput.checked)return;this._private_timerId&&(clearTimeout(this._private_timerId),this._private_timerId=null),this._private_messageHTMLElement.textContent="",y.sanitizeToHtmlElement(e,this._private_messageHTMLElement),this._private_mainHTMLElement.classList.add("TravelNotes-ErrorsUI-"+this._private_currentErrorLevel),this._private_mainHTMLElement.classList.remove("TravelNotes-Hidden");let r=t.errorsUI.timeOut;"Help"===this._private_currentErrorLevel&&(this._private_hideHelpHTMLElement.classList.remove("TravelNotes-Hidden"),r=t.errorsUI.helpTimeOut),this._private_timerId=setTimeout((()=>this._private_hide()),r)}constructor(){}createUI(){if(this._private_mainHTMLElement)return;this._private_mainHTMLElement=Q.create("div",{id:"TravelNotes-ErrorsUI",className:"TravelNotes-Hidden"},document.body);const e=Q.create("div",null,this._private_mainHTMLElement);Q.create("span",{id:"TravelNotes-ErrorsUI-CancelButton",textContent:"❌"},e).addEventListener("click",(()=>this._private_hide()),!1),this._private_messageHTMLElement=Q.create("div",{id:"TravelNotes-ErrorsUI-Message"},this._private_mainHTMLElement),this._private_hideHelpHTMLElement=Q.create("div",{id:"TravelNotes-ErrorsUI-HelpInputDiv",className:"TravelNotes-Hidden"},this._private_mainHTMLElement),this._private_hideHelpInput=Q.create("input",{id:"TravelNotes-ErrorsUI-HelpInput",type:"checkbox",checked:!t.errorsUI.showHelp},this._private_hideHelpHTMLElement),Q.create("label",{id:"TravelNotes-ErrorsUI-HelpInputLabel",htmlFor:"TravelNotes-ErrorsUI-HelpInput",textContent:"Don't show help again"},this._private_hideHelpHTMLElement)}showError(t){this._private_show(t,"Error")}showWarning(t){this._private_show(t,"Warning")}showInfo(t){this._private_show(t,"Info")}showHelp(t){this._private_show(t,"Help")}};class jt{_private_passwordInput=null;constructor(t){this._private_passwordInput=t}handleEvent(t){t.currentTarget.textContent="👀",t.stopPropagation,this._private_passwordInput.type="text"}}class Mt{_private_passwordInput;constructor(t){this._private_passwordInput=t}handleEvent(t){t.currentTarget.textContent="👁️",t.stopPropagation,this._private_passwordInput.type="password",this._private_passwordInput.focus()}}class At extends Dt{_private_passwordDiv;_private_passwordInput;_private_eyeSpan;_private_verifyPassword;_private_eyeMouseDownEL;_private_eyeMouseUpEL;static get _private_PSWD_MIN_LENGTH(){return 12}constructor(t){super(),this._private_verifyPassword=t,this._private_passwordDiv=Q.create("div",{id:"TravelNotes-PasswordDialog-PasswordDiv"}),this._private_passwordInput=Q.create("input",{type:"password"},this._private_passwordDiv),this._private_eyeSpan=Q.create("span",{id:"TravelNotes-PasswordDialog-EyeSpan",textContent:"👁️"},this._private_passwordDiv),this._private_eyeMouseDownEL=new jt(this._private_passwordInput),this._private_eyeMouseUpEL=new Mt(this._private_passwordInput),this._private_eyeSpan.addEventListener("mousedown",this._private_eyeMouseDownEL,!1),this._private_eyeSpan.addEventListener("mouseup",this._private_eyeMouseUpEL,!1)}_private_destructor(){this._private_eyeSpan.removeEventListener("mousedown",this._private_eyeMouseDownEL,!1),this._private_eyeSpan.removeEventListener("mouseup",this._private_eyeMouseUpEL,!1),this._private_eyeMouseDownEL=null,this._private_eyeMouseUpEL=null}canClose(){return this.hideError(),!(this._private_verifyPassword&&(this._private_passwordInput.value.length<At._private_PSWD_MIN_LENGTH||!this._private_passwordInput.value.match(/[0-9]+/)||!this._private_passwordInput.value.match(/[a-z]+/)||!this._private_passwordInput.value.match(/[A-Z]+/)||!this._private_passwordInput.value.match(/[^0-9a-zA-Z]/)))||(this.showError("<p>"+I.getText("PasswordDialog - Password rules1")+"</p><ul><li>"+I.getText("PasswordDialog - Password rules2")+"</li><li>"+I.getText("PasswordDialog - Password rules3")+"</li><li>"+I.getText("PasswordDialog - Password rules4")+"</li><li>"+I.getText("PasswordDialog - Password rules5")+"</li><li>"+I.getText("PasswordDialog - Password rules6")+"</li></ul>"),this._private_passwordInput.focus(),!1)}onCancel(){this._private_destructor(),super.onCancel()}onOk(){this._private_destructor(),super.onOk((new window.TextEncoder).encode(this._private_passwordInput.value))}onShow(){this._private_passwordInput.focus()}get contentHTMLElements(){return[this._private_passwordDiv]}get title(){return I.getText("PasswordDialog - password")}}class xt{_private_salt;_private_importKey(t){return window.crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"])}_private_deriveKey(t,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode(e),iterations:1e6,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}_private_decrypt(t,e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(e.slice(0,16))},t,new Uint8Array(e.slice(16)))}_private_encrypt(t,e,i){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,i)}constructor(t){this._private_salt=t||"Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette."}encryptData(t,e,i,r){let a=window.crypto.getRandomValues(new Uint8Array(16));r.then((t=>this._private_importKey(t))).then((t=>this._private_deriveKey(t,this._private_salt))).then((e=>this._private_encrypt(e,a,t))).then((t=>{e(new Blob([a,new Uint8Array(t)],{type:"application/octet-stream"}))})).catch(i)}decryptData(t,e,i,r){r.then((t=>this._private_importKey(t))).then((t=>this._private_deriveKey(t,this._private_salt))).then((e=>this._private_decrypt(e,t))).then(e).catch(i)}}class Ot{constructor(){}handleEvent(t){t.stopPropagation();const e=new Event("apikeydeleted");e.data={objId:Number.parseInt(t.target.dataset.tanObjId)},t.target.parentNode.parentNode.dispatchEvent(e)}}class Ct{_private_rootHTMLElement;_private_providerNameInput;_private_providerKeyInput;_private_objId;constructor(e){this._private_objId=f.nextObjId,this._private_rootHTMLElement=Q.create("div",{className:"TravelNotes-APIKeysDialog-ApiKeyRow"}),this._private_providerNameInput=Q.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyName TravelNotes-APIKeysDialog-Input",value:e.providerName,placeholder:I.getText("APIKeysDialogKeyControl - provider name")},this._private_rootHTMLElement),this._private_providerKeyInput=Q.create("input",{className:"TravelNotes-APIKeysDialog-ApiKeyValue TravelNotes-APIKeysDialog-Input",value:e.providerKey,placeholder:I.getText("APIKeysDialogKeyControl - API key"),type:t.APIKeysDialog.showAPIKeys?"text":"password"},this._private_rootHTMLElement),Q.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-APIKeysDialog-AtRightButton",title:I.getText("APIKeysDialogKeyControl - delete API key"),textContent:"❌",dataset:{ObjId:this._private_objId}},this._private_rootHTMLElement).addEventListener("click",new Ot,!1)}get objId(){return this._private_objId}get HTMLElements(){return[this._private_rootHTMLElement]}get providerName(){return this._private_providerNameInput.value}get providerKey(){return this._private_providerKeyInput.value}get apiKey(){return new z(this._private_providerNameInput.value,this._private_providerKeyInput.value)}}class St{_private_APIKeysDialog;constructor(t){this._private_APIKeysDialog=t}onErrorDecrypt(t){this._private_APIKeysDialog.hideWait(),this._private_APIKeysDialog.keyboardELEnabled=!0,t&&"Canceled by user"!==t&&this._private_APIKeysDialog.showError(I.getText("DataEncryptorHandlers - An error occurs when reading the file"))}onOkDecrypt(t){try{this._private_APIKeysDialog.addAPIKeys(JSON.parse((new TextDecoder).decode(t)))}catch(t){return void this.onErrorDecrypt(t)}this._private_APIKeysDialog.hideWait(),this._private_APIKeysDialog.hideError(),this._private_APIKeysDialog.keyboardELEnabled=!0}onOkEncrypt(t){this._private_APIKeysDialog.hideError(),this._private_APIKeysDialog.hideWait(),N.saveFile("APIKeys",t),this._private_APIKeysDialog.keyboardELEnabled=!0}onErrorEncrypt(){this._private_APIKeysDialog.showError(I.getText("DataEncryptorHandlers - An error occurs when saving the keys")),this._private_APIKeysDialog.hideWait(),this._private_APIKeysDialog.keyboardELEnabled=!0}}class Kt{_private_APIKeysControls;constructor(t){this._private_APIKeysControls=t}getAPIKeysJsonString(){const t=[];return this._private_APIKeysControls.forEach((e=>{t.push({providerName:e.providerName,providerKey:e.providerKey})})),JSON.stringify(t)}}class Rt{_private_APIKeysDialog;_private_APIKeysControls;constructor(t,e){this._private_APIKeysDialog=t,this._private_APIKeysControls=e}handleEvent(t){t.stopPropagation(),this._private_APIKeysControls.delete(t.data.objId),this._private_APIKeysDialog.refreshAPIKeys()}}class Ft{_private_APIKeysDialog;constructor(t){this._private_APIKeysDialog=t}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{this._private_APIKeysDialog.addAPIKeys(JSON.parse(e.result))}catch(t){this._private_APIKeysDialog.showError(t.message),t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class kt{_private_APIKeysDialog;constructor(t){this._private_APIKeysDialog=t}handleEvent(t){t.stopPropagation(),this._private_APIKeysDialog.hideError(),N.openFile(new Ft(this._private_APIKeysDialog),".json")}}class Bt{_private_APIKeysDialog;constructor(t){this._private_APIKeysDialog=t}handleEvent(t){t.stopPropagation(),this._private_APIKeysDialog.hideError(),this._private_APIKeysDialog.showWait(),this._private_APIKeysDialog.keyboardELEnabled=!1,fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"APIKeys").then((t=>{c===t.status&&t.ok?t.arrayBuffer().then((t=>{const e=new St(this._private_APIKeysDialog);(new xt).decryptData(t,(t=>{e.onOkDecrypt(t)}),(t=>{e.onErrorDecrypt(t)}),new At(!1).show())})):new St(this._private_APIKeysDialog).onErrorDecrypt(new Error("Invalid http status"))})).catch((t=>{new St(this._private_APIKeysDialog).onErrorDecrypt(t),t instanceof Error&&console.error(t)}))}}class Ht{_private_APIKeysDialog;constructor(t){this._private_APIKeysDialog=t}handleEvent(t){t.stopPropagation(),this._private_APIKeysDialog.showWait(),this._private_APIKeysDialog.keyboardELEnabled=!1;const e=new FileReader;e.onload=()=>{const t=new St(this._private_APIKeysDialog);(new xt).decryptData(e.result,(e=>{t.onOkDecrypt(e)}),(e=>{t.onErrorDecrypt(e)}),new At(!1).show())},e.readAsArrayBuffer(t.target.files[0])}}class Ut{_private_APIKeysDialog;constructor(t){this._private_APIKeysDialog=t}handleEvent(t){t.stopPropagation(),this._private_APIKeysDialog.hideError(),N.openFile(new Ht(this._private_APIKeysDialog))}}class Vt{_private_APIKeysDialog;_private_APIKeysControls;constructor(t,e){this._private_APIKeysDialog=t,this._private_APIKeysControls=e}handleEvent(t){if(t.stopPropagation(),!this._private_APIKeysDialog.validateAPIKeys())return;this._private_APIKeysDialog.showWait(),this._private_APIKeysDialog.keyboardELEnabled=!1;const e=new St(this._private_APIKeysDialog);(new xt).encryptData((new window.TextEncoder).encode(new Kt(this._private_APIKeysControls).getAPIKeysJsonString()),(t=>e.onOkEncrypt(t)),(()=>e.onErrorEncrypt()),new At(!0).show())}}class zt{_private_APIKeysDialog;_private_APIKeysControls;constructor(t,e){this._private_APIKeysDialog=t,this._private_APIKeysControls=e}handleEvent(t){t.stopPropagation(),this._private_APIKeysDialog.validateAPIKeys()&&N.saveFile("APIKeys.json",new Kt(this._private_APIKeysControls).getAPIKeysJsonString(),"application/json")}}class Wt{_private_APIKeysDialog;_private_APIKeysControls;constructor(t,e){this._private_APIKeysDialog=t,this._private_APIKeysControls=e}handleEvent(t){t.stopPropagation();const e=new z,i=new Ct(e);this._private_APIKeysControls.set(i.objId,i),this._private_APIKeysDialog.refreshAPIKeys()}}class Xt{_private_APIKeysDialog;_private_APIKeysControls;_private_haveAPIKeysFile;_private_rootHTMLElement;_private_reloadKeysFromServerButton;_private_saveKeysToSecureFileButton;_private_restoreKeysFromSecureFileButton;_private_newAPIKeyButton;_private_saveKeysToUnsecureFileButton;_private_restoreKeysFromUnsecureFileButton;_private_reloadFromServerButtonClickEL;_private_saveToSecureFileButtonClickEL;_private_restoreFromSecureFileButtonClickEL;_private_newAPIKeyButtonClickEL;_private_saveToUnsecureFileButtonClickEL;_private_restoreFromUnsecureFileButtonClickEL;_private_createReloadKeysFromServerButton(){this._private_reloadKeysFromServerButton=Q.create("div",{className:"TravelNotes-BaseDialog-Button",title:I.getText("APIKeysDialogToolbar - Reload from server"),textContent:"🔄"},this._private_rootHTMLElement),this._private_reloadFromServerButtonClickEL=new Bt(this._private_APIKeysDialog),this._private_reloadKeysFromServerButton.addEventListener("click",this._private_reloadFromServerButtonClickEL,!1)}_private_createSaveKeysToSecureFileButton(){this._private_saveKeysToSecureFileButton=Q.create("div",{className:"TravelNotes-BaseDialog-Button",title:I.getText("APIKeysDialogToolbar - Save to file"),textContent:"💾"},this._private_rootHTMLElement),this._private_saveToSecureFileButtonClickEL=new Vt(this._private_APIKeysDialog,this._private_APIKeysControls),this._private_saveKeysToSecureFileButton.addEventListener("click",this._private_saveToSecureFileButtonClickEL,!1)}_private_createRestoreKeysFromSecureFileButton(){this._private_restoreKeysFromSecureFileButton=Q.create("div",{className:"TravelNotes-BaseDialog-Button",title:I.getText("APIKeysDialogToolbar - Open file"),textContent:"📂"},this._private_rootHTMLElement),this._private_restoreFromSecureFileButtonClickEL=new Ut(this._private_APIKeysDialog),this._private_restoreKeysFromSecureFileButton.addEventListener("click",this._private_restoreFromSecureFileButtonClickEL,!1)}_private_createNewAPIKeyButton(){this._private_newAPIKeyButton=Q.create("div",{className:"TravelNotes-BaseDialog-Button",title:I.getText("APIKeysDialogToolbar - new API key"),textContent:"+"},this._private_rootHTMLElement),this._private_newAPIKeyButtonClickEL=new Wt(this._private_APIKeysDialog,this._private_APIKeysControls),this._private_newAPIKeyButton.addEventListener("click",this._private_newAPIKeyButtonClickEL,!1)}_private_createSaveKeysToUnsecureFileButton(){this._private_saveKeysToUnsecureFileButton=Q.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-APIKeysDialog-AtRightButton",title:I.getText("APIKeysDialogToolbar - Save to json file"),textContent:"💾"},this._private_rootHTMLElement),this._private_saveToUnsecureFileButtonClickEL=new zt(this._private_APIKeysDialog,this._private_APIKeysControls),this._private_saveKeysToUnsecureFileButton.addEventListener("click",this._private_saveToUnsecureFileButtonClickEL,!1)}_private_createRestoreKeysFromUnsecureFileButton(){this._private_restoreKeysFromUnsecureFileButton=Q.create("div",{className:"TravelNotes-BaseDialog-Button",title:I.getText("APIKeysDialogToolbar - Open json file"),textContent:"📂"},this._private_rootHTMLElement),this._private_restoreFromUnsecureFileButtonClickEL=new kt(this._private_APIKeysDialog),this._private_restoreKeysFromUnsecureFileButton.addEventListener("click",this._private_restoreFromUnsecureFileButtonClickEL,!1)}_private_addToolbarButtons(){window?.crypto?.subtle?.importKey&&window.isSecureContext&&(this._private_haveAPIKeysFile&&this._private_createReloadKeysFromServerButton(),this._private_createSaveKeysToSecureFileButton(),this._private_createRestoreKeysFromSecureFileButton()),this._private_createNewAPIKeyButton(),t.APIKeysDialog.haveUnsecureButtons&&(this._private_createSaveKeysToUnsecureFileButton(),this._private_createRestoreKeysFromUnsecureFileButton())}constructor(t,e,i){this._private_APIKeysDialog=t,this._private_APIKeysControls=e,this._private_haveAPIKeysFile=i,this._private_rootHTMLElement=Q.create("div",{id:"TravelNotes-APIKeysDialog-ToolbarDiv"}),this._private_addToolbarButtons()}destructor(){this._private_reloadKeysFromServerButton&&this._private_reloadKeysFromServerButton.removeEventListener("click",this._private_reloadFromServerButtonClickEL,!1),this._private_reloadFromServerButtonClickEL=null,this._private_saveKeysToSecureFileButton&&this._private_saveKeysToSecureFileButton.removeEventListener("click",this._private_saveToSecureFileButtonClickEL,!1),this._private_saveToSecureFileButtonClickEL=null,this._private_restoreKeysFromSecureFileButton&&this._private_restoreKeysFromSecureFileButton.removeEventListener("click",this._private_restoreFromSecureFileButtonClickEL,!1),this._private_restoreFromSecureFileButtonClickEL=null,this._private_newAPIKeyButton&&this._private_newAPIKeyButton.removeEventListener("click",this._private_newAPIKeyButtonClickEL,!1),this._private_newAPIKeyButtonClickEL=null,this._private_saveKeysToUnsecureFileButton&&this._private_saveKeysToUnsecureFileButton.removeEventListener("click",this._private_saveToUnsecureFileButtonClickEL,!1),this._private_saveToUnsecureFileButtonClickEL=null,this._private_restoreKeysFromUnsecureFileButton&&this._private_restoreKeysFromUnsecureFileButton.removeEventListener("click",this._private_restoreFromUnsecureFileButtonClickEL,!1),this._private_restoreFromUnsecureFileButtonClickEL=null}get rootHTMLElement(){return this._private_rootHTMLElement}}class Zt extends Dt{_private_apiKeysControls;_private_toolbar;_private_apiKeysControlsContainer;_private_onAPIKeyDeletedEventListener;_private_createAPIKeysControlsContainer(){this._private_apiKeysControlsContainer=Q.create("div"),this._private_onAPIKeyDeletedEventListener=new Rt(this,this._private_apiKeysControls),this._private_apiKeysControlsContainer.addEventListener("apikeydeleted",this._private_onAPIKeyDeletedEventListener,!1)}constructor(t,e){super(),this._private_apiKeysControls=new Map,this._private_toolbar=new Xt(this,this._private_apiKeysControls,e),this._private_createAPIKeysControlsContainer(),this.addAPIKeys(t)}_private_destructor(){this._private_toolbar.destructor(),this._private_toolbar=null,this._private_apiKeysControlsContainer.removeEventListener("apikeydeleted",this._private_onAPIKeyDeletedEventListener,!1),this._private_onAPIKeyDeletedEventListener=null}validateAPIKeys(){this.hideError();let t=!1;const e=[];this._private_apiKeysControls.forEach((i=>{t=t||""===i.providerName||""===i.providerKey,e.push(i.providerName)}));let i=!1;return e.forEach((t=>{i=i||e.indexOf(t)!==e.lastIndexOf(t)})),t?(this.showError(I.getText("APIKeysDialog - empty API key name or value")),!1):!i||(this.showError(I.getText("APIKeysDialog - duplicate API key name found")),!1)}addAPIKeys(t){this._private_apiKeysControls.clear(),t.forEach((t=>{const e=new Ct(t);this._private_apiKeysControls.set(e.objId,e)})),this.refreshAPIKeys()}refreshAPIKeys(){for(;this._private_apiKeysControlsContainer.firstChild;)this._private_apiKeysControlsContainer.removeChild(this._private_apiKeysControlsContainer.firstChild);this._private_apiKeysControls.forEach((t=>{this._private_apiKeysControlsContainer.appendChild(t.HTMLElements[0])}))}onShow(){Pt.showHelp("<p>"+I.getText("Help - Complete the APIKeys1")+"</p><p>"+I.getText("Help - Complete the APIKeys2")+"</p><p>"+I.getText("Help - Complete the APIKeys3")+"</p>")}canClose(){return this.validateAPIKeys()}onCancel(){this._private_destructor(),super.onCancel()}onOk(){const t=[];this._private_apiKeysControls.forEach((e=>t.push(e.apiKey))),super.onOk(t)&&this._private_destructor()}get title(){return I.getText("APIKeysDialog - API keys")}get contentHTMLElements(){return[this._private_toolbar.rootHTMLElement,this._private_apiKeysControlsContainer]}}const Gt=new class{_private_haveAPIKeysFile=!1;_private_apiKeysMap=new Map;_private_onOkDecryptServerFile(t){this._private_resetAPIKeys(JSON.parse((new TextDecoder).decode(t)))}_private_onErrorDecryptServerFile(t){t instanceof Error&&console.error(t),t&&"Canceled by user"!==t&&Pt.showError(I.getText("APIKeysManager - An error occurs when reading the APIKeys file"))}_private_onServerFileFound(t){window.isSecureContext&&window?.crypto?.subtle?.importKey&&(new xt).decryptData(t,(t=>this._private_onOkDecryptServerFile(t)),(t=>this._private_onErrorDecryptServerFile(t)),new At(!1).show())}_private_getAPIKey(t){return this._private_apiKeysMap.get(t.toLowerCase())}_private_setAPIKey(t,e){this._private_apiKeysMap.set(t.toLowerCase(),e)}_private_setAPIKeysFromSessionStorage(){if(!N.storageAvailable("sessionStorage"))return 0;let t=0;for(let e=0;e<sessionStorage.length;e++){const i=sessionStorage.key(e);i.match(/^\w*ProviderKey$/)&&(this._private_setAPIKey(i.replace("ProviderKey",""),atob(sessionStorage.getItem(i))),t++)}return R.providers.forEach((t=>{t.providerKeyNeeded&&(t.providerKey=this._private_getAPIKey(t.name)||"")})),t}_private_resetAPIKeys(e){sessionStorage.clear(),this._private_apiKeysMap.clear();const i=N.storageAvailable("sessionStorage")&&t.APIKeys.saveToSessionStorage;e.forEach((t=>{i&&sessionStorage.setItem(t.providerName.toLowerCase()+"ProviderKey",btoa(t.providerKey)),this._private_setAPIKey(t.providerName,t.providerKey)})),R.providers.forEach((t=>{t.providerKeyNeeded&&(t.providerKey=this._private_getAPIKey(t.name)||"")})),F.dispatch("providersadded")}constructor(){}hasKey(t){return this._private_apiKeysMap.has(t.toLowerCase())}getUrl(t){if(t.providerKeyNeeded){const e=this._private_apiKeysMap.get(t.providerName.toLowerCase());return e?t.url.replace("{providerKey}",e):null}return t.url}setKeysFromServerFile(){let t=!1;0!==this._private_setAPIKeysFromSessionStorage()&&(F.dispatch("providersadded"),t=!0),fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"APIKeys").then((e=>{c===e.status&&e.ok&&(this._private_haveAPIKeysFile=!0,t||e.arrayBuffer().then((t=>this._private_onServerFileFound(t))))})).catch((t=>{t instanceof Error&&console.error(t)}))}setKeysFromDialog(){const t=[];this._private_apiKeysMap.forEach(((e,i)=>{t.push(new z(i,e))})),t.sort(((t,e)=>t.providerName.localeCompare(e.providerName))),new Zt(t,this._private_haveAPIKeysFile).show().then((t=>this._private_resetAPIKeys(t))).catch((t=>{t instanceof Error&&console.error(t)}))}addProvider(t){const e=new t,i=e.name.toLowerCase();let r=this._private_getAPIKey(i);e.providerKeyNeeded&&!r&&N.storageAvailable("sessionStorage")&&(r=sessionStorage.getItem(i),r&&(r=atob(r))),e.providerKeyNeeded&&r&&(e.providerKey=r),R.providers.set(e.name.toLowerCase(),e)}};new class{_private_mapLayers;_private_defaultMapLayer;_private_mapLayersAdded;constructor(){this._private_mapLayers=new Map,this._private_mapLayersAdded=!1,this._private_defaultMapLayer=new it({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}),this._private_mapLayers.set(this._private_defaultMapLayer.name,this._private_defaultMapLayer)}getMapLayer(t){let e=this._private_mapLayers.get(t)||this._private_defaultMapLayer;return e.providerKeyNeeded&&(Gt.hasKey(e.providerName.toLowerCase())||(e=this._private_defaultMapLayer)),e}forEach(t){this._private_mapLayers.forEach(t)}addMapLayers(t){this._private_mapLayersAdded||(t.forEach((t=>{const e=new it(t);this._private_mapLayers.get(e.name)||this._private_mapLayers.set(e.name,e)})),this._private_mapLayersAdded=!0)}get defaultMapLayer(){return this._private_defaultMapLayer}};class Yt{static handleEvent(t){const e=J.getRoute(t.target.objId);let i=X.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;i+=e.chainedDistance,i=N.formatDistance(i);const r=R.mapObjects.get(t.target.objId);r.closeTooltip();let a=e.computedName;R.travel.readOnly||(a+=0===a.length?"":" - ",a+=i),r.setTooltipContent(a),r.openTooltip(t.latlng)}}class Jt{_private_marker;_private_polyline;_private_bullet;constructor(t,e,i){this._private_marker=t,this._private_polyline=e,this._private_bullet=i}get marker(){return this._private_marker}get polyline(){return this._private_polyline}get bullet(){return this._private_bullet}}class $t{_private_currentLayer;_private_geolocationCircle;static get _private_DEFAULT_MAX_ZOOM(){return 18}static get _private_DEFAULT_MIN_ZOOM(){return 0}static get _private_NOTE_Z_INDEX_OFFSET(){return 100}constructor(){this._private_currentLayer=null,this._private_geolocationCircle=null}addToMap(t,e){e.objId=t,e.addTo(R.map),R.mapObjects.set(t,e)}addRoute(t){const e=J.getRoute(t),i=[],r=e.itinerary.itineraryPoints.iterator;for(;!r.done;)i.push(r.value.latLng);const a=window.L.polyline(i,{color:e.color,weight:e.width,dashArray:e.dashString});this.addToMap(e.objId,a),l.notEdited===e.editionStatus&&(a.bindTooltip(e.computedName,{sticky:!0,direction:"right"}),window.L.DomEvent.on(a,"mouseover",Yt.handleEvent),window.L.DomEvent.on(a,"mousemove",Yt.handleEvent)),a.bindPopup((t=>y.clone(dt.getRouteHeaderHTML("TravelNotes-Map-",J.getRoute(t.objId))))),window.L.DomEvent.on(a,"click",(t=>t.target.openPopup(t.latlng)));const o=e.notes.iterator;for(;!o.done;)this.addNote(o.value.objId);return e}addNote(e){const i=J.getNoteAndRoute(e).note,r=window.L.marker(i.latLng,{icon:window.L.divIcon({iconSize:[t.note.grip.size,t.note.grip.size],iconAnchor:[t.note.grip.size/2,t.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Map-Note-Bullet"}),opacity:t.note.grip.opacity,draggable:!R.travel.readOnly});r.objId=i.objId;const a=window.L.marker(i.iconLatLng,{zIndexOffset:$t._private_NOTE_Z_INDEX_OFFSET,icon:window.L.divIcon({iconSize:[i.iconWidth,i.iconHeight],iconAnchor:[i.iconWidth/2,i.iconHeight/2],popupAnchor:[0,-i.iconHeight/2],html:i.iconContent,className:"TravelNotes-Map-AllNotes "}),draggable:!R.travel.readOnly});a.objId=i.objId,a.bindPopup((t=>y.clone(vt.getNoteTextHTML("TravelNotes-Map-",J.getNoteAndRoute(t.objId))))),0!==i.tooltipContent.length&&(a.bindTooltip((t=>J.getNoteAndRoute(t.objId).note.tooltipContent)),a.getTooltip().options.offset[0]=i.iconWidth/2);const o=window.L.polyline([i.latLng,i.iconLatLng],t.note.polyline);o.objId=i.objId;const s=window.L.layerGroup([a,o,r]);return s.markerId=window.L.Util.stamp(a),s.polylineId=window.L.Util.stamp(o),s.bulletId=window.L.Util.stamp(r),this.addToMap(i.objId,s),t.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach((t=>t.classList.add("TravelNotes-Map-Note-Background"))),new Jt(a,o,r)}zoomTo(e,i){if(i){let t=[];i.forEach((e=>t=t.concat(e))),R.map.fitBounds(X.getLatLngBounds(t))}else R.map.setView(e,t.itineraryPoint.zoomFactor)}setLayer(t,e){const i="wmts"===t.service.toLowerCase()?window.L.tileLayer(e):window.L.tileLayer.wms(e,t.wmsOptions);this._private_currentLayer&&R.map.removeLayer(this._private_currentLayer),R.map.addLayer(i),this._private_currentLayer=i,R.travel.readOnly||(R.map.getZoom()<(t.minZoom||$t._private_DEFAULT_MIN_ZOOM)&&R.map.setZoom(t.minZoom||$t._private_DEFAULT_MIN_ZOOM),R.map.setMinZoom(t.minZoom||$t._private_DEFAULT_MIN_ZOOM),R.map.getZoom()>(t.maxZoom||$t._private_DEFAULT_MAX_ZOOM)&&R.map.setZoom(t.maxZoom||$t._private_DEFAULT_MAX_ZOOM),R.map.setMaxZoom(t.maxZoom||$t._private_DEFAULT_MAX_ZOOM),t.bounds?(R.map.getBounds().intersects(t.bounds)&&!R.map.getBounds().contains(t.bounds)||(R.map.setMaxBounds(null),R.map.fitBounds(t.bounds),R.map.setZoom(t.minZoom||$t._private_DEFAULT_MIN_ZOOM)),R.map.setMaxBounds(t.bounds)):R.map.setMaxBounds(null)),R.map.fire("baselayerchange",i)}onGeolocationStatusChanged(t){n.active!==t&&this._private_geolocationCircle&&(R.map.removeLayer(this._private_geolocationCircle),this._private_geolocationCircle=null)}onGeolocationPositionChanged(e){let i=t.geoLocation.zoomToPosition;this._private_geolocationCircle&&(R.map.removeLayer(this._private_geolocationCircle),i=!1);let r="Position (+/- "+e.coords.accuracy.toFixed(0)+" m) : <br/>"+N.formatLatLngDMS([e.coords.latitude,e.coords.longitude])+"<br/>"+N.formatLatLng([e.coords.latitude,e.coords.longitude])+"<br/>";e.coords.altitude&&(r+="<br/> Altitude (+/- "+e.coords.altitudeAccuracy.toFixed(0)+" m) :<br/>"+e.coords.altitude.toFixed(0)+" m"),0===t.geoLocation.marker.radius?this._private_geolocationCircle=window.L.circle(window.L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.marker).setRadius(e.coords.accuracy.toFixed(0)):this._private_geolocationCircle=window.L.circleMarker(window.L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this._private_geolocationCircle.bindTooltip(r).bindPopup(r).addTo(R.map),this._private_geolocationCircle.openPopup(),i&&R.map.setView(window.L.latLng(e.coords.latitude,e.coords.longitude),t.geoLocation.zoomFactor)}}class qt{constructor(){}handleEvent(t){if(t.stopPropagation(),"Z"===t.key||"z"===t.key)(new $).zoomToTravel();else if("G"===t.key||"g"===t.key)rt.switch();else{const e=t.key.charCodeAt(0);47<e&&58>e&&nt.setMapLayer(t.key)}}}class Qt{_private_travelUrl;_private_language;_private_originAndPath;_private_addLayerToolbar;static get _private_VIEWER_DEFAULT_ZOOM(){return 2}static _private_mapEditorViewer=new $t;_private_addEventsListeners(){document.addEventListener("keydown",new qt,!0),document.addEventListener("routeupdated",(t=>{t.data&&Qt._private_mapEditorViewer.addRoute(t.data.addedRouteObjId)}),!1),document.addEventListener("noteupdated",(t=>{t.data&&Qt._private_mapEditorViewer.addNote(t.data.addedNoteObjId)}),!1),document.addEventListener("zoomto",(t=>{t.data&&Qt._private_mapEditorViewer.zoomTo(t.data.latLng,t.data.geometry)}),!1),document.addEventListener("layerchange",(t=>{t.data&&Qt._private_mapEditorViewer.setLayer(t.data.layer,t.data.layer.url)})),document.addEventListener("geolocationpositionchanged",(t=>{t.data&&Qt._private_mapEditorViewer.onGeolocationPositionChanged(t.data.position)}),!1),document.addEventListener("geolocationstatuschanged",(t=>{t.data&&Qt._private_mapEditorViewer.onGeolocationStatusChanged(t.data.status)}),!1)}_private_readURL(){const t=new URL(window.location);let e=t.searchParams.get("fil");if(e&&0!==e.length)try{if(e=atob(e),e.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");const i=new URL(e);if(!(t.protocol&&i.protocol&&t.protocol===i.protocol&&t.hostname&&i.hostname&&t.hostname===i.hostname))throw new Error("The distant file is not on the same site than the app");this._private_travelUrl=encodeURI(i.href)}catch(t){t instanceof Error&&console.error(t)}const i=t.searchParams.get("lng");i&&i.match(/^[A-Z,a-z]{2}$/)&&(this._private_language=i.toLowerCase()),""===t.searchParams.get("lay")&&(this._private_addLayerToolbar=!0)}async _private_loadConfig(){const t=await fetch(this._private_originAndPath+"Config.json");if(c===t.status&&t.ok){const e=await t.json();return e.travelNotes.language=this._private_language||e.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(e.note.haveBackground=!0),(new b).overload(e),!0}return!1}async _private_loadTranslations(){const t=await fetch(this._private_originAndPath+this._private_language.toUpperCase()+".json");return!(c!==t.status||!t.ok)&&(I.setTranslations(await t.json()),!0)}async _private_loadMapLayers(){const t=await fetch(this._private_originAndPath+"Layers.json");return!(c!==t.status||!t.ok)&&(nt.addMapLayers(await t.json()),!0)}_private_loadTravelNotes(){const t=document.createElement("div");t.id="TravelNotes-Map",document.body.appendChild(t),R.map=window.L.map(t.id,{attributionControl:!1,zoomControl:!1}).setView([p.defaultValue,p.defaultValue],Qt._private_VIEWER_DEFAULT_ZOOM),_t.addReadOnlyMap(this._private_travelUrl,this._private_addLayerToolbar)}constructor(){this._private_originAndPath=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes",this._private_addLayerToolbar=!1}async loadApp(){this._private_readURL(),await this._private_loadConfig()?(this._private_language=this._private_language||t.travelNotes.language,await this._private_loadTranslations()?await this._private_loadMapLayers()?(this._private_addEventsListeners(),this._private_loadTravelNotes()):document.body.textContent="Not possible to load the TravelNotesLayers.json file. ":document.body.textContent="Not possible to load the TravelNotesConfig"+this._private_language.toUpperCase()+".json file. "):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}}(new Qt).loadApp()}();
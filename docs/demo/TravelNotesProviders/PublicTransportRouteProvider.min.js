/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 4.0.0-beta
 * Build 02351 - 2022-09-16T14:58:43+0200 
 * Copyright 2017 2022 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";class t{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class e{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class s{static get fixed(){return 2}static get defaultValue(){return 0}}class i{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class n{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class a{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}const o=40,r=6371e3,l=-1,d=-1;const h=new class{#t(t,e){for(const s in e)try{if("dataset"===s){const s=e.dataset;for(const e in s)t.dataset["tan"+e]=s[e]}else t[s]=e[s]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){Object.freeze(this)}create(t,e,s){let i=null;return"text"===t.toLowerCase()?i=document.createTextNode(e.value||""):(i="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this.#t(i,e)),s&&s.appendChild(i),i}};class c{#e=new Map;constructor(){Object.freeze(this),this.#e.set("a",["href","target"]),this.#e.set("div",[]),this.#e.set("del",[]),this.#e.set("em",[]),this.#e.set("figcaption",[]),this.#e.set("figure",[]),this.#e.set("h1",[]),this.#e.set("h2",[]),this.#e.set("h3",[]),this.#e.set("h4",[]),this.#e.set("h5",[]),this.#e.set("h6",[]),this.#e.set("hr",[]),this.#e.set("img",["src","alt","width","height"]),this.#e.set("ins",[]),this.#e.set("li",[]),this.#e.set("mark",[]),this.#e.set("ol",[]),this.#e.set("p",[]),this.#e.set("s",[]),this.#e.set("small",[]),this.#e.set("strong",[]),this.#e.set("span",[]),this.#e.set("sub",[]),this.#e.set("sup",[]),this.#e.set("ul",[]),this.#e.set("svg",["xmlns","viewBox","class"]),this.#e.set("text",["x","y","text-anchor"]),this.#e.set("polyline",["points","class","transform"]),this.#e.set("#text",[])}getValidAttributesNames(t){return this.#e.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#e.get(e)?e:""}}class u{#s;#i;constructor(t,e){Object.freeze(this),this.#s=t,this.#i=e}get htmlString(){return this.#s}get errorsString(){return this.#i}}class g{#n;#i;constructor(t,e){Object.freeze(this),this.#n=t,this.#i=e}get url(){return this.#n}get errorsString(){return this.#i}}class p{#a="";#o="";static#r=new c;#l(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#d(t,e){const s=this.sanitizeToUrl(t,e).url;""===s&&""!==t?this.#o+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#a+=" "+e+'="'+s+'"'}#h(t,e){p.#r.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(this.#a+=" "+e+'="'+this.#l(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))}))}#c(t,e){t.hasAttribute("target")&&(this.#a+=' rel="noopener noreferrer"'),p.#r.getValidAttributesNames(e).forEach((e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#d(t.getAttribute(e),e):this.#a+=" "+e+'="'+this.#l(t.getAttribute(e))+'"',t.removeAttribute(e))}))}#u(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#o+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#g(t){const e=t.childNodes;for(let s=0;s<e.length;s++){const e=t.childNodes[s],i=p.#r.getValidNodeName(e.nodeName);""===i?this.#o+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===i?this.#a+=this.#l(e.nodeValue):(this.#a+="<"+i,"svg"===i||"text"===i||"polyline"===i?this.#h(e,i):this.#c(e,i),this.#a+=">",this.#g(e),this.#a+="</"+i+">",e.attributes&&this.#u(e))}}#p(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg",e);return p.#r.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(s.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))})),s}#m(t,e){const s=document.createElement(e);return p.#r.getValidAttributesNames(e).forEach((e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const i=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==i&&s.setAttribute(e,i)}else s.setAttribute(e,t.getAttribute(e))})),t.hasAttribute("target")&&s.setAttribute("rel","noopener noreferrer"),s}#b(t,e){const s=t.childNodes;for(let i=0;i<s.length;i++){const s=t.childNodes[i],n=p.#r.getValidNodeName(s.nodeName);if("#text"===n)e.appendChild(document.createTextNode(s.nodeValue));else if(""!==n){const t="svg"===n||"text"===n||"polyline"===n?this.#p(s,n):this.#m(s,n);e.appendChild(t),this.#b(s,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const s=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),i=new DocumentFragment;s&&"#document"===s.nodeName?(this.#b(s.body.firstChild,i),e.appendChild(i)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#b(t,e),e}sanitizeToHtmlString(t){this.#a="",this.#o="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#g(e.body.firstChild),new u(this.#a,this.#o)):new u("","Parsing error")}sanitizeToUrl(t,e){const s=e||"href",i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!i||"#document"!==i.nodeName)return new g("","Parsing error");const n=i.body.firstChild;let a="";for(let t=0;t<n.childNodes.length;t++){if("#text"!==n.childNodes[t].nodeName)return new g("","Invalid characters found in the url");a+=n.childNodes[t].nodeValue}if(a=a.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),a!==t)return new g("","Invalid characters found in the url");const o=["https:"];if("http:"!==window.location.protocol&&"href"!==s||o.push("http:"),"href"===s){o.push("mailto:"),o.push("sms:"),o.push("tel:");const t=a.match(/^\u0023\w*/);if(t&&a===t[0])return new g(a,"")}"src"===s&&o.push("data:");let r=null;try{r=new URL(a)}catch(t){return new g("","Invalid url string")}if(d===o.indexOf(r.protocol))return new g("","Invalid protocol "+r.protocol);if(d!==["sms:","tel:"].indexOf(r.protocol))return r.pathname.match(/^\+[0-9,*,\u0023]*$/)?new g(a,""):new g("","Invalid sms: or tel: url");try{encodeURIComponent(r.href)}catch(t){return new g("","Invalid character in url")}return new g(a,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const s=e.body.firstChild;let i="";for(let t=0;t<s.childNodes.length;t++){if("#text"!==s.childNodes[t].nodeName)return"";i+=s.childNodes[t].nodeValue}return i=i.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),i}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const m=new p;class b{#y;constructor(t){Object.freeze(this),this.#y=t}handleEvent(){this.#y.onCancel()}}class y{#f;constructor(t){Object.freeze(this),this.#f=t}handleEvent(t){this.#f.keyboardELEnabled&&("Escape"===t.key||"Esc"===t.key?this.#f.onCancel():"Enter"===t.key&&this.#f.onOk())}}class f{#f;constructor(t){Object.freeze(this),this.#f=t}handleEvent(){this.#f.onOk()}}class v{static#v=0;static get nextObjId(){return++v.#v}}const T="2.4.0";class L{#T="";#L=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];#E=[];constructor(t,e){if(Object.freeze(this),d===this.#L.indexOf(t))throw new Error("Invalid ObjType name : "+t);this.#T=t,this.#E=e,Object.freeze(this.#E)}get name(){return this.#T}get version(){return T}get properties(){return this.#E}get jsonObject(){return{name:this.#T,version:T}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this.#T);if(this.#T!==t.name)throw new Error("Invalid name for "+this.#T);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this.#T)}}class E{#M=null;#j=d;constructor(t){Object.freeze(this),this.#M=t}get value(){return this.#j<this.#M.length?this.#M.at(this.#j):null}get previous(){return 0>=this.#j?null:this.#M.at(this.#j-1)}get next(){return this.#j<this.#M.length-1?this.#M.at(this.#j+1):null}get done(){return++this.#j>=this.#M.length}get first(){return 0===this.#j}get last(){return this.#j>=this.#M.length-1}get index(){return this.#j}}class M{#w;#I;#O;#D(t){return this.#w.findIndex((e=>e.objId===t))}#x(t,e,s){let i=this.#D(t);if(d===i)throw new Error("invalid objId for next or previous function");if(1!==s&&-1!==s)throw new Error("invalid direction");let n=e;for(n||(n=()=>!0),i+=s;d<i&&i<this.#w.length&&!n(this.#w[i]);)i+=s;return d===i||this.#w.length===i?null:this.#w[i]}constructor(t){Object.freeze(this),this.#w=[],this.#O=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this.#I=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this.#I)throw new Error("invalid object name for add function");this.#w.push(t)}at(t){return t<this.#w.length&&t>d?this.#w[t]:null}forEach(t){let e=null;const s=this.iterator;for(;!s.done;)e=t(s.value,e);return e}getAt(t){const e=this.#D(t);return d===e?null:this.#w[e]}moveTo(t,e,s){let i=this.#D(t),n=this.#D(e);if(d===i||d===n)throw new Error("invalid objId for function  myMoveTo");s||n++,this.#w.splice(n,0,this.#w[i]),n<i&&i++,this.#w.splice(i,1)}next(t,e){return this.#x(t,e,1)}previous(t,e){return this.#x(t,e,-1)}remove(t){const e=this.#D(t);if(d===e)throw new Error("invalid objId for remove function");this.#w.splice(e,1)}removeAll(t){t?this.#w.splice(1,this.#w.length-2):this.#w.length=0}replace(t,e){const s=this.#D(t);if(d===s)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this.#I)throw new Error("invalid object name for replace function");this.#w[s]=e}reverse(){this.#w.reverse()}sort(t){this.#w.sort(t)}swap(t,e){const s=this.#D(t);if(d===s||0===s&&e||this.#w.length-1===s&&!e)throw new Error("invalid objId for swap function");const i=e?-1:1,n=this.#w[s];this.#w[s]=this.#w[s+i],this.#w[s+i]=n}get first(){return this.#w[0]}get iterator(){return new E(this)}get last(){return this.#w[this.#w.length-1]}get length(){return this.#w.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this.#w.length=0,Array.isArray(t)&&t.forEach((t=>{const e=new this.#O;e.jsonObject=t,this.add(e)}))}}const j={ApiKeys:{saveToSessionStorage:!0},ApiKeysDialog:{haveUnsecureButtons:!0,showApiKeys:!1,showButton:!0},baseDialog:{cancelTouchX:100,cancelTouchY:150,deltaZoomDistance:75,touchTopScreen:!0},contextMenu:{timeout:1500},dockableBaseDialog:{timeout:1500},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!1,showInfo:!0,showWarning:!0,timeOut:1e4},files:{openGpx:["gpx"],openTaN:["json","trv"],writeTouch:"trv",writeOthers:"trv"},fontSize:{initialValue:3.5,incrementValue:.5},FullScreenUI:{timeOut:5e3,screenMaxWidth:1200},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:0},options:{enableHighAccuracy:!0,maximumAge:0,timeout:36e5},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},mapContextMenu:{mouseMaxRouteDistance:10,touchMaxRouteDistance:10},mapLayersToolbar:{theDevil:{addButton:!0}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:6,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},theDevil:{addButton:!0,zoomFactor:17}},osmSearchDialog:{dialogX:50,dialogY:0},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"——————",iDashArray:[0]},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:0,width:5},routeEditor:{showEditedRouteInRoadbook:!0},toolbars:{timeOut:1500},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr",startupRouteEdition:!0},TravelNotesToolbar:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},travelNotesDialog:{dialogX:250,dialogY:0},travelPropertiesDialog:{dialogX:50,dialogY:0},wayPoint:{reverseGeocoding:!0,geocodingIncludeName:!0}};const w=new class{#N=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach((t=>this.#N.set(t.msgid,m.sanitizeToJsString(t.msgstr))))}getText(t,e){let s=this.#N.get(t);return e&&s&&Object.getOwnPropertyNames(e).forEach((t=>s=s.replace("{"+t+"}",e[t]))),s||t}};const I=new class{constructor(){Object.freeze(this)}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let s="";for(let i=0;i<16;i++)s+=e[i].toString(16).padStart(2,"0")+t[i];return s}storageAvailable(t){try{const e=window[t],s="__storage_test__";return e.setItem(s,s),e.removeItem(s),!0}catch(t){return!1}}openFile(t,e){const s=document.createElement("input");s.type="file",e&&(s.accept=e),s.addEventListener("change",t,!1),s.click()}saveFile(t,e,s){try{const i=s?window.URL.createObjectURL(new File([e],t,{type:s})):URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",t),n.click(),window.URL.revokeObjectURL(i)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const s=Math.floor(e/86400),i=Math.floor(e%86400/3600),n=Math.floor(e%3600/60),a=Math.floor(e%60);return 0<s?s+" "+w.getText("Utilities - Day")+" "+i+" "+w.getText("Utilities - Hour"):0<i?i+" "+w.getText("Utilities - Hour")+" "+n+" "+w.getText("Utilities - Minute"):0<n?n+" "+w.getText("Utilities - Minute"):a+" "+w.getText("Utilities - Second")}formatDistance(t){const s=Math.floor(t);return 0>=s?"0 km":Math.floor(s/e.metersInKm)+","+Math.floor(s%e.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}numberToDMS(t){let e=t,s=Math.floor(t);e-=s;let i=Math.floor(60*e);e-=i/60,e*=3600;let n=Math.floor(e);return e-=n,e=Math.floor(100*e),s.toString()+"° "+i.toString()+"' "+n+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+" N":this.numberToDMS(-t)+" S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+" E":this.numberToDMS(-t)+" W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+" - "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(n.fixed)+" N":(-t).toFixed(n.fixed)+" S"}formatLng(t){return t>0?t.toFixed(n.fixed)+" E":(-t).toFixed(n.fixed)+" W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+" - "+this.formatLng(t[1])}};class O{#H;#k(){this.#H.routes.forEach((t=>{t.dashArray=0,t.hidden=!1}))}#P(){this.#H.routes.forEach((t=>{t.edited=a.notEdited}))}#A(){this.#P(),this.#H.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"#ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:a.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}#C(){if(this.#H.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find((t=>t.layerId===this.#H.userData.layerId));this.#H.layerName=t?t.layerName:"OSM - Color"}else this.#H.layerName="OSM - Color"}#S(t){t.forEach((t=>{t.elev=s.defaultValue}))}#B(){this.#H.routes.forEach((t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this.#S(t.itinerary.itineraryPoints)})),this.#H.editedRoute.itinerary.hasProfile=!1,this.#H.editedRoute.itinerary.ascent=0,this.#H.editedRoute.itinerary.descent=0,this.#S(this.#H.editedRoute.itinerary.itineraryPoints)}#W(t){t.itinerary.maneuvers.forEach((t=>{"kArriveDefault"===t.iconName&&(t.distance=e.defaultValue)}))}#_(t){t.wayPoints.forEach((t=>{t.address=t.name,t.name=""}))}#V(){this.#H.routes.forEach((t=>{t.editionStatus=t.edited,this.#W(t),this.#_(t)})),this.#H.editedRoute.editionStatus=this.#H.editedRoute.edited,this.#W(this.#H.editedRoute),this.#_(this.#H.editedRoute)}#R(){this.#H.routes.forEach((t=>{t.dashIndex=t.dashArray})),this.#H.editedRoute.dashIndex=this.#H.editedRoute.dashArray}#z(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}#F(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this.#z(t.iconContent),t.popupContent=this.#z(t.popupContent),t.tooltipContent=this.#z(t.tooltipContent),t.phone=this.#z(t.phone),t.address=this.#z(t.address)}#U(){this.#H.notes.forEach((t=>{this.#F(t)})),this.jsonTravel.routes.forEach((t=>{t.notes.forEach((t=>{this.#F(t)}))}))}#Y(){switch(this.#H.objType.version){case"1.0.0":this.#k();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this.#A();case"1.5.0":this.#C();case"1.6.0":this.#B();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this.#V();case"1.12.0":case"1.13.0":this.#U();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this.#R(),this.#H.objType.version="2.4.0";break;default:throw new Error("invalid version for travel")}}constructor(){Object.freeze(this)}update(t){t.objType.version!==T&&(this.#H=t,this.#Y())}}class D{constructor(){Object.freeze(this)}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new O).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach((t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)})),t}}class x extends D{static#X=new L("WayPoint",["address","name","lat","lng","objId"]);#Z="";#K="";#J=n.defaultValue;#G=n.defaultValue;#v=l;constructor(){super(),this.#v=v.nextObjId}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?m.sanitizeToJsString(t):""}get address(){return this.#K}set address(t){this.#K="string"==typeof t?m.sanitizeToJsString(t):""}get lat(){return this.#J}set lat(t){this.#J="number"==typeof t?t:n.defaultValue}get lng(){return this.#G}set lng(t){this.#G="number"==typeof t?t:n.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=I.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#J=t[0],this.#G=t[1]):(this.#J=n.defaultValue,this.#G=n.defaultValue)}get objId(){return this.#v}get objType(){return x.#X}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.#v=v.nextObjId}}class N extends D{static#X=new L("ItineraryPoint",["lat","lng","distance","elev","objId"]);#J=n.defaultValue;#G=n.defaultValue;#q=e.defaultValue;#Q=s.defaultValue;#v=l;constructor(){super(),this.#v=v.nextObjId}get lat(){return this.#J}set lat(t){this.#J="number"==typeof t?t:n.defaultValue}get lng(){return this.#G}set lng(t){this.#G="number"==typeof t?t:n.defaultValue}get distance(){return this.#q}set distance(t){this.#q="number"==typeof t?t:e.defaultValue}get elev(){return this.#Q}set elev(t){this.#Q="number"==typeof t?t:n.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#J=t[0],this.#G=t[1]):(this.#J=n.defaultValue,this.#G=n.defaultValue)}get objType(){return N.#X}get objId(){return this.#v}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),elev:parseFloat(this.elev.toFixed(s.fixed)),objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this.#v=v.nextObjId}}class H extends D{static#X=new L("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);#$="";#tt="";#et=l;#q=e.defaultValue;#st=e.defaultValue;#v=l;constructor(){super(),this.#v=v.nextObjId}get iconName(){return this.#$}set iconName(t){this.#$="string"==typeof t?m.sanitizeToJsString(t):""}get instruction(){return this.#tt}set instruction(t){this.#tt="string"==typeof t?m.sanitizeToJsString(t):""}get itineraryPointObjId(){return this.#et}set itineraryPointObjId(t){this.#et="number"==typeof t?t:l}get distance(){return this.#q}set distance(t){this.#q="number"==typeof t?t:e.defaultValue}get duration(){return this.#st}set duration(t){this.#st="number"==typeof t?t:e.defaultValue}get objType(){return H.#X}get objId(){return this.#v}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this.#v=v.nextObjId}}class k extends D{static#X=new L("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);#v=l;#it=!1;#nt=0;#at=0;#ot="";#rt="";#lt=new M(N);#dt=new M(H);constructor(){super(),this.#v=v.nextObjId}get hasProfile(){return this.#it}set hasProfile(t){this.#it="boolean"==typeof t&&t}get ascent(){return this.#nt}set ascent(t){this.#nt="number"==typeof t?Number.parseInt(t):0}get descent(){return this.#at}set descent(t){this.#at="number"==typeof t?Number.parseInt(t):0}get provider(){return this.#ot}set provider(t){this.#ot="string"==typeof t?m.sanitizeToJsString(t):""}get transitMode(){return this.#rt}set transitMode(t){this.#rt="string"==typeof t?m.sanitizeToJsString(t):""}get itineraryPoints(){return this.#lt}get maneuvers(){return this.#dt}get objType(){return k.#X}get objId(){return this.#v}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this.#v=v.nextObjId;const s=new Map;let i=0;const n=this.itineraryPoints.iterator;for(;!n.done;)s.set(e.itineraryPoints[i].objId,n.value.objId),i++;const a=this.maneuvers.iterator;for(;!a.done;)a.value.itineraryPointObjId=s.get(a.value.itineraryPointObjId)}}class P extends D{static#X=new L("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);#ht=i.height;#ct=i.width;#ut="";#gt="";#pt="";#mt="";#n="";#K="";#bt=n.defaultValue;#yt=n.defaultValue;#J=n.defaultValue;#G=n.defaultValue;#q=e.invalid;#ft=e.defaultValue;#v=l;constructor(){super(),this.#v=v.nextObjId}get iconHeight(){return this.#ht}set iconHeight(t){this.#ht="number"==typeof t?t:i.height}get iconWidth(){return this.#ct}set iconWidth(t){this.#ct="number"==typeof t?t:i.width}get iconContent(){return this.#ut}set iconContent(t){this.#ut="string"==typeof t?m.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this.#gt}set popupContent(t){this.#gt="string"==typeof t?m.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this.#pt}set tooltipContent(t){this.#pt="string"==typeof t?m.sanitizeToHtmlString(t).htmlString:""}get phone(){return this.#mt}set phone(t){this.#mt="string"==typeof t?m.sanitizeToHtmlString(t).htmlString:""}get url(){return this.#n}set url(t){this.#n="string"==typeof t?encodeURI(m.sanitizeToUrl(t).url):""}get address(){return this.#K}set address(t){this.#K="string"==typeof t?m.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this.#bt}set iconLat(t){this.#bt="number"==typeof t?t:n.defaultValue}get iconLng(){return this.#yt}set iconLng(t){this.#yt="number"==typeof t?t:n.defaultValue}get lat(){return this.#J}set lat(t){this.#J="number"==typeof t?t:n.defaultValue}get lng(){return this.#G}set lng(t){this.#G="number"==typeof t?t:n.defaultValue}get distance(){return this.#q}set distance(t){this.#q="number"==typeof t?t:e.invalid}get chainedDistance(){return this.#ft}set chainedDistance(t){this.#ft="number"==typeof t?t:e.defaultValue}get isRouteNote(){return this.#q!==e.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#bt=t[0],this.#yt=t[1]):(this.#bt=n.defaultValue,this.#yt=n.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#J=t[0],this.#G=t[1]):(this.#J=n.defaultValue,this.#G=n.defaultValue)}get objType(){return P.#X}get objId(){return this.#v}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(n.fixed)),iconLng:parseFloat(this.iconLng.toFixed(n.fixed)),lat:parseFloat(this.lat.toFixed(n.fixed)),lng:parseFloat(this.lng.toFixed(n.fixed)),distance:parseFloat(this.distance.toFixed(e.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this.#v=v.nextObjId}}class A extends D{static#X=new L("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);#Z="";#vt=new M(x);#Tt=new M(P);#Lt=new k;#Et=j.route.width;#Mt=j.route.color;#jt=j.route.dashIndex;#wt=!0;#ft=e.defaultValue;#q=e.defaultValue;#st=e.defaultValue;#It=a.notEdited;#Ot=!1;#v=l;constructor(){super(),this.#vt.add(new x),this.#vt.add(new x),this.#v=v.nextObjId}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?m.sanitizeToJsString(t):""}get wayPoints(){return this.#vt}get notes(){return this.#Tt}get itinerary(){return this.#Lt}get width(){return this.#Et}set width(t){this.#Et="number"==typeof t?t:j.route.width}get color(){return this.#Mt}set color(t){this.#Mt="string"==typeof t&&m.sanitizeToColor(t)||j.route.color}get dashIndex(){return this.#jt}set dashIndex(t){this.#jt="number"==typeof t&&j.route.dashChoices[t]?t:0}get dashString(){let t="";return j.route.dashChoices[this.#jt].iDashArray.forEach((e=>t+=String(e*this.#Et)+",")),t.substring(0,t.length-1)}get chain(){return this.#wt}set chain(t){this.#wt="boolean"==typeof t&&t}get chainedDistance(){return this.#ft}set chainedDistance(t){this.#ft="number"==typeof t?t:e.defaultValue}get distance(){return this.#q}set distance(t){this.#q="number"==typeof t?t:e.defaultValue}get duration(){return this.#st}set duration(t){this.#st="number"==typeof t?t:e.defaultValue}get editionStatus(){return this.#It}set editionStatus(t){this.#It="number"==typeof t?t:a.notEdited}get hidden(){return this.#Ot}set hidden(t){this.#Ot="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this.#v}get objType(){return A.#X}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach((e=>{t=t&&n.defaultValue!==e.lat&&n.defaultValue!==e.lng})),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(e.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(e.fixed)),objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this.#v=v.nextObjId}}class C extends D{static#X=new L("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);#Dt=new A;#xt=new M(A);#Tt=new M(P);#Nt="OSM - Color";#Z="";#Ht=!1;#v=l;constructor(){super(),this.#xt.add(new A),this.#v=v.nextObjId}get editedRoute(){return this.#Dt}set editedRoute(t){this.#Dt="Route"===t?.objType?.name?t:new A}get routes(){return this.#xt}get notes(){return this.#Tt}get layerName(){return this.#Nt}set layerName(t){this.#Nt="string"==typeof t?m.sanitizeToJsString(t):"OSM - Color"}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?m.sanitizeToJsString(t):""}get readOnly(){return this.#Ht}set readOnly(t){this.#Ht="boolean"!=typeof t||t}get objId(){return this.#v}get objType(){return C.#X}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this.#v,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this.#v=v.nextObjId}}class S{#ot="";#rt="";constructor(){Object.freeze(this)}get provider(){return this.#ot}set provider(t){this.#ot="string"==typeof t?t:""}get transitMode(){return this.#rt}set transitMode(t){this.#rt="string"==typeof t?t:""}}const B=new class{#kt;#Pt;#At;#Ct;#St;#Bt;#Wt;#_t;constructor(){Object.freeze(this),this.#kt=new Map,this.#Pt=new Map,this.#At=new S,this.#Ct=I.UUID,this.#St=null,this.#Bt=new C,this.#Wt=l,this.#_t=[]}get map(){return this.#St}set map(t){this.#St||(this.#St=t)}get travel(){return this.#Bt}get editedRouteObjId(){return this.#Wt}set editedRouteObjId(t){this.#Wt="number"==typeof t?t:l}get searchData(){return this.#_t}get providers(){return this.#kt}get mapObjects(){return this.#Pt}get routing(){return this.#At}get UUID(){return this.#Ct}};class W{constructor(){Object.freeze(this)}handleEvent(t){if(!t.target.classList.contains("TravelNotes-Background"))return;let e=B.map.getZoom()+(0>t.deltaY?1:-1);e=Math.min(B.map.getMaxZoom(),e),e=Math.max(B.map.getMinZoom(),e),B.map.setZoomAround(window.L.point(t.clientX,t.clientY),e)}}class _{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault()}}class V{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){t.preventDefault(),Number.parseInt(t.dataTransfer.getData("ObjId"))===this.#Vt.objId&&(t.stopPropagation(),this.#Vt.moveDialog(t))}}class R{#J;#G;constructor(t,e){Object.freeze(this),this.#J=t,this.#G=e}static clone(t){return new R(t.lat,t.lng)}get latLng(){return[this.#J,this.#G]}get lat(){return this.#J}get lng(){return this.#G}}class z extends R{#q;constructor(t,e,s){super(t,e),this.#q=s}get distance(){return this.#q}}class F extends z{#Q;#nt;constructor(t,e,s,i,n){super(t,e,s),this.#Q=i,this.#nt=n}get elev(){return this.#Q}get ascent(){return this.#nt}}class U{static get#Rt(){return 100}constructor(){Object.freeze(this)}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let s=0;const i=t.itinerary.itineraryPoints.iterator;for(;s<e&&!i.done;)s+=i.value.distance;const n=i.value;i.done;const a=(n.distance-s+e)/n.distance;return new F(n.lat+(i.value.lat-n.lat)*a,n.lng+(i.value.lng-n.lng)*a,e,n.elev+(i.value.elev-n.elev)*a,U.#Rt*(i.value.elev-n.elev)/n.distance)}getClosestLatLngDistance(t,s){if(0===t.itinerary.itineraryPoints.length)return null;const i=t.itinerary.itineraryPoints.iterator;i.done;let n=Number.MAX_VALUE;const a=window.L.Projection.SphericalMercator.project(window.L.latLng(s[0],s[1]));let o=window.L.Projection.SphericalMercator.project(window.L.latLng(i.value.lat,i.value.lng)),r=null,l=e.defaultValue,d=i.value.distance;for(;!i.done;){const t=window.L.Projection.SphericalMercator.project(window.L.latLng(i.value.lat,i.value.lng));let e=window.L.LineUtil.pointToSegmentDistance(a,o,t);e<n&&(n=e,r=window.L.Projection.SphericalMercator.unproject(window.L.LineUtil.closestPointOnSegment(a,o,t)),l=d-r.distanceTo(window.L.latLng(i.value.lat,i.value.lng))),d+=i.value.distance,o=t}return new z(r.lat,r.lng,l)}getLatLngBounds(t){const e=window.L.latLng([n.maxLat,n.maxLng]),s=window.L.latLng([n.minLat,n.minLng]);return t.forEach((t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),s.lat=Math.max(s.lat,t[0]),s.lng=Math.max(s.lng,t[1])})),window.L.latLngBounds(e,s)}getSquareBoundingBox(e,s){const i=e[0]*t.toRadians,n=s/r*t.fromRadians,a=Math.acos((Math.cos(s/r)-Math.sin(i)**2)/Math.cos(i)**2)*t.fromRadians;return window.L.latLngBounds(window.L.latLng([e[0]-n,e[1]-a]),window.L.latLng([e[0]+n,e[1]+a]))}project(t,e){const s=B.map.project(window.L.latLng(t),e);return[s.x,s.y]}screenCoordToLatLng(t,e){const s=B.map.containerPointToLatLng(window.L.point(t,e));return[s.lat,s.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const Y=new U;class X{#y;#zt=!1;#Ft=!1;#Ut=0;#Yt=0;#Xt;#Zt;#Kt;#Jt;#Gt(t){if(this.#zt&&(this.#Ut!==t.screenX||this.#Yt!==t.screenY)){j.baseDialog.cancelTouchY>this.#Yt&&t.screenY<this.#Yt&&j.baseDialog.cancelTouchX>this.#Ut&&this.#y.onCancel();const e=Y.screenCoordToLatLng(this.#Ut,this.#Yt),s=Y.screenCoordToLatLng(t.screenX,t.screenY);B.map.panTo([this.#Xt.lat+e[0]-s[0],this.#Xt.lng+e[1]-s[1]])}}#qt(t){let e=Math.sqrt((t.item(0).clientX-t.item(1).clientX)**2+(t.item(0).clientY-t.item(1).clientY)**2),s=this.#Zt,i=e-this.#Kt;j.baseDialog.deltaZoomDistance<i?s++:-j.baseDialog.deltaZoomDistance>i&&s--,s=Math.min(B.map.getMaxZoom(),s),s=Math.max(B.map.getMinZoom(),s),s!==this.#Zt&&(B.map.setZoomAround(this.#Jt,s),this.#Zt=s,this.#Kt=e)}#Qt(t){this.#zt&&1===t.changedTouches.length&&(this.#Gt(t.changedTouches.item(0)),this.#zt=!1)}#$t(t){this.#zt&&1===t.changedTouches.length?this.#Gt(t.changedTouches.item(0)):this.#Ft&&2===t.targetTouches.length&&this.#qt(t.targetTouches)}#te(t){if(1===t.targetTouches.length){const e=t.changedTouches.item(0);this.#Ut=e.screenX,this.#Yt=e.screenY,this.#Xt=B.map.getCenter(),this.#zt=!0,this.#Ft=!1}2===t.targetTouches.length&&(this.#Zt=B.map.getZoom(),this.#Jt=window.L.point((t.targetTouches.item(0).clientX+t.targetTouches.item(1).clientX)/2,(t.targetTouches.item(0).clientY+t.targetTouches.item(1).clientY)/2),this.#Kt=Math.sqrt((t.targetTouches.item(0).clientX-t.targetTouches.item(1).clientX)**2+(t.targetTouches.item(0).clientY-t.targetTouches.item(1).clientY)**2),this.#zt=!1,this.#Ft=!0)}constructor(t){Object.freeze(this),this.#y=t}handleEvent(t){switch(t.currentTarget===t.target&&t.preventDefault(),t.type){case"touchstart":t.currentTarget===t.target&&this.#te(t);break;case"touchmove":this.#$t(t);break;case"touchend":this.#Qt(t)}}}class Z{static get LEFT_BUTTON(){return 0}#zt=!1;#Ut=0;#Yt=0;#Xt;#Gt(t){const e=Y.screenCoordToLatLng(this.#Ut,this.#Yt),s=Y.screenCoordToLatLng(t.screenX,t.screenY);B.map.panTo([this.#Xt.lat+e[0]-s[0],this.#Xt.lng+e[1]-s[1]])}constructor(){Object.freeze(this)}handleEvent(t){switch(t.type){case"mousedown":t.button===Z.LEFT_BUTTON&&t.target===t.currentTarget&&(this.#Ut=t.screenX,this.#Yt=t.screenY,this.#Xt=B.map.getCenter(),this.#zt=!0);break;case"mousemove":t.button===Z.LEFT_BUTTON&&this.#zt&&(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),this.#Gt(t));break;case"mouseup":t.button!==Z.LEFT_BUTTON||!this.#zt||this.#Ut===t.screenX&&this.#Yt===t.screenY||this.#Gt(t),this.#zt=!1}}}class K{#ee=null;#se=null;#ie=null;#ne=null;#ae=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#ee=t.firstButtonText;break;case"secondButtonText":this.#se=t.secondButtonText;break;case"selectOptionsData":this.#ie=t.selectOptionsData;break;case"title":this.#ne=t.title;break;case"text":this.#ae=t.text}}get firstButtonText(){return this.#ee}get secondButtonText(){return this.#se}get selectOptionsData(){return this.#ie}get title(){return this.#ne}get text(){return this.#ae}}class J{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){this.#Vt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Vt.objId)}}class G{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){this.#Vt.moveDialog(t)}}class q{#Vt;#oe;constructor(t){Object.freeze(this),this.#Vt=t,this.#oe=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const s=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#oe=!0,this.#Vt.setDragStartPoint(s);break;case"touchmove":this.#oe=!1,t.preventDefault(),this.#Vt.moveDialog(s,e);break;case"touchend":this.#oe||this.#Vt.moveDialog(s,e)}}}}class Q{static#re;static#le(){Q.#re=!0,document.removeEventListener("touchstart",Q.#le,!0)}constructor(){Object.freeze(this),Q.#re=!1,document.addEventListener("touchstart",Q.#le,!0)}get isTouch(){return Q.#re}get screenAvailable(){const t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.right=0,t.style.height=1,t.style.width=1,document.body.appendChild(t);const e=t.getBoundingClientRect(),s=e.bottom,i=e.right;return document.body.removeChild(t),Object.freeze({height:s,width:i})}}const $=new Q;class tt{#v;#de;#he;#ce;#ue;#ge(t,e){const s=$.screenAvailable,i=s.width-this.dialogHTMLElement.offsetWidth-o,n=s.height-this.dialogHTMLElement.offsetHeight-o;this.#ce=Math.max(Math.min(t,i),o),this.#ue=Math.max(Math.min(e,n),o)}#pe(){this.dialogHTMLElement.style.left=String(this.#ce)+"px",this.dialogHTMLElement.style.top=String(this.#ue)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#ce=o,this.#ue=o,this.#de=0,this.#he=0,this.#v=v.nextObjId}get onTop(){return 42>this.#ue}get objId(){return this.#v}centerDialog(){const t=$.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(t.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(t.width-80)+"px",this.#ce=(t.width-this.dialogHTMLElement.clientWidth)/2,$.isTouch?this.#ue=o:this.#ue=(t.height-this.dialogHTMLElement.clientHeight)/2,this.#pe()}moveDialog(t,e){const s=this.#ce+t.screenX-this.#de,i=this.#ue+t.screenY-this.#he;this.moveDialogTo(s,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#ge(t,e),this.#pe()}moveDialogToLastPosition(){this.moveDialogTo(this.#ce,this.#ue)}moveDialogToTopLeft(){this.#ce=o,this.#ue=o,this.#pe()}setDragStartPoint(t){this.#de=t.screenX,this.#he=t.screenY}}class et{#ae;#v;constructor(t,e){Object.freeze(this),this.#ae=t,this.#v=e}get text(){return this.#ae}get objId(){return this.#v}}class st extends class{#me;constructor(){Object.freeze(this),this.#me=h.create("div",{className:"TravelNotes-BaseDialog-DataDiv"})}get controlHTMLElement(){return this.#me}}{#be;constructor(t){super(),h.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#be=h.create("select",null,this.controlHTMLElement),t?.elements.forEach((t=>{this.#be.add(h.create("option",{text:t}))}))}get selectedIndex(){return this.#be.selectedIndex}set selectedIndex(t){this.#be.selectedIndex=t}}class it extends class extends class{#ye;#fe;#ve;#Te;#Le;#Ee;#Me;#je;#we;#Ie=null;#Oe(){this.#ye=h.create("div",{className:"TravelNotes-BaseDialog-DialogHTMLElement"}),this.mover.dialogHTMLElement=this.#ye}#De(){this.#fe=h.create("div",{className:"TravelNotes-BaseDialog-TopBarHTMLElement",draggable:!0},this.#ye),this.#je=new q(this.mover),this.#fe.addEventListener("touchstart",this.#je,!1),this.#fe.addEventListener("touchmove",this.#je,!1),this.#fe.addEventListener("touchend",this.#je,!1),this.#fe.addEventListener("touchcancel",this.#je,!1),this.#Ee=new J(this.mover),this.#fe.addEventListener("dragstart",this.#Ee,!1),this.#Me=new G(this.mover),this.#fe.addEventListener("dragend",this.#Me,!1),this.#ve=h.create("div",{textContent:"❌",className:"TravelNotes-BaseDialog-CancelButton",title:w.getText("BaseDialog - Cancel")},this.#fe),h.create("div",{textContent:this.title,className:"TravelNotes-BaseDialog-Title"},this.#fe),this.#we=new b(this),this.#ve.addEventListener("click",this.#we,!1),this.mover.topBarHTMLElement=this.#fe}#xe(){this.toolbarHTMLElement&&h.create("div",{className:"TravelNotes-BaseDialog-ToolbarHTMLElement"},this.#ye).appendChild(this.toolbarHTMLElement)}#Ne(){this.#Te=h.create("div",{className:"TravelNotes-BaseDialog-ContentHTMLElement"},this.#ye),this.contentHTMLElements.forEach((t=>this.#Te.appendChild(t)))}#He(){this.#Oe(),this.#De(),this.#xe(),this.#Ne()}constructor(t){Object.freeze(this),this.#Ie=new K(t)}#ke(){this.#fe.removeEventListener("dragstart",this.#Ee,!1),this.#Ee=null,this.#fe.removeEventListener("dragend",this.#Me,!1),this.#Me=null,this.#fe.removeEventListener("touchstart",this.#je,!1),this.#fe.removeEventListener("touchmove",this.#je,!1),this.#fe.removeEventListener("touchend",this.#je,!1),this.#fe.removeEventListener("touchcancel",this.#je,!1),this.#je=null,this.#ve.removeEventListener("click",this.#we,!1),this.#we=null,this.#Le&&(this.#Le=null)}get mover(){return this.#Le?this.#Le:this.#Le=new tt}onCancel(){this.#ke()}onOk(){this.#ke()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#He()}removeFromBackground(t){t.removeChild(this.#ye)}addToBackground(t){t.appendChild(this.#ye)}addToDialog(t){this.#ye.appendChild(t)}get options(){return this.#Ie}addCssClass(t){this.#ye.classList.add(t)}}{#Pe;#Ae;#Ce;#Se;#Be;#We;#_e;#we;#Ve;#Re;#ze;#Fe;#Ue;#Ye;#Xe;#Ze;#Ke(){this.#Pe=h.create("div",{className:"TravelNotes-Background"})}#Je(){this.#Fe=new V(this.mover),this.#Pe.addEventListener("dragover",this.#Fe,!1),this.#Xe=new W,this.#Pe.addEventListener("wheel",this.#Xe,{passive:!0}),this.#Ze=new _,this.#Pe.addEventListener("contextmenu",this.#Ze,!1),this.#Ue=new X(this),this.#Pe.addEventListener("touchstart",this.#Ue,!1),this.#Pe.addEventListener("touchmove",this.#Ue,!1),this.#Pe.addEventListener("touchend",this.#Ue,!1),this.#Pe.addEventListener("touchcancel",this.#Ue,!1),this.#Ye=new Z,this.#Pe.addEventListener("mouseup",this.#Ye,!1),this.#Pe.addEventListener("mousemove",this.#Ye,!1),this.#Pe.addEventListener("mousedown",this.#Ye,!1)}#Ge(){this.#Ae=h.create("div",{className:"TravelNotes-ModalBaseDialog-ErrorHTMLElement TravelNotes-Hidden"}),this.addToDialog(this.#Ae)}#qe(){h.create("div",{className:"TravelNotes-WaitAnimationBullet"},h.create("div",{className:"TravelNotes-WaitAnimation"},this.#Ce=h.create("div",{className:"TravelNotes-ModalBaseDialog-WaitHTMLElement  TravelNotes-Hidden"}))),this.addToDialog(this.#Ce)}#Qe(){const t=h.create("div",{className:"TravelNotes-ModalBaseDialog-FooterHTMLElement"});this.addToDialog(t),this.#Be=h.create("div",{textContent:this.options.firstButtonText||"🆗",className:"TravelNotes-BaseDialog-Button"},t),this.#_e=new f(this),this.#Be.addEventListener("click",this.#_e,!1),this.options.secondButtonText?(this.#We=h.create("div",{textContent:this.options.secondButtonText,className:"TravelNotes-BaseDialog-Button"},t),this.#we=new b(this),this.#We.addEventListener("click",this.#we,!1)):this.#We=null,this.footerHTMLElements.forEach((e=>t.appendChild(e)))}#He(){this.#Ke(),this.#Je(),this.#Ge(),this.#qe(),this.#Qe()}#ke(){this.#Pe.removeEventListener("wheel",this.#Xe,{passive:!0}),this.#Xe=null,this.#Pe.removeEventListener("contextmenu",this.#Ze,!1),this.#Ze=null,this.#Pe.removeEventListener("dragover",this.#Fe,!1),this.#Fe=null,this.#Pe.removeEventListener("touchstart",this.#Ue,!1),this.#Pe.removeEventListener("touchmove",this.#Ue,!1),this.#Pe.removeEventListener("touchend",this.#Ue,!1),this.#Pe.removeEventListener("touchcancel",this.#Ue,!1),this.#Ue=null,this.#Pe.removeEventListener("mouseup",this.#Ye,!1),this.#Pe.removeEventListener("mousemove",this.#Ye,!1),this.#Pe.removeEventListener("mousedown",this.#Ye,!1),this.#Ye=null,document.removeEventListener("keydown",this.#ze,{capture:!0}),this.#ze=null,this.#Be.removeEventListener("click",this.#_e,!1),this.#_e=null,this.options.secondButtonText&&(this.#We.removeEventListener("click",this.#we,!1),this.#we=null),document.body.removeChild(this.#Pe)}#$e(t,e){this.#Ve=t,this.#Re=e}constructor(t){super(t),this.#Se=!0}show(){return super.show(),this.#He(),document.body.appendChild(this.#Pe),this.addToBackground(this.#Pe),this.#ze=new y(this),document.addEventListener("keydown",this.#ze,{capture:!0}),this.mover.centerDialog(),new Promise(((t,e)=>this.#$e(t,e)))}onCancel(){this.#ke(),super.onCancel(),this.#Re("Canceled by user")}canClose(){return!0}onOk(t){return!!this.canClose()&&(this.#Ve(t),this.#ke(),super.onOk(),!0)}showWait(){this.#Ce.classList.remove("TravelNotes-Hidden"),this.#Be.classList.add("TravelNotes-Hidden")}hideWait(){this.#Ce.classList.add("TravelNotes-Hidden"),this.#Be.classList.remove("TravelNotes-Hidden")}showError(t){this.#Ae.textContent="",m.sanitizeToHtmlElement(t,this.#Ae),this.#Ae.classList.remove("TravelNotes-Hidden")}hideError(){this.#Ae.textContent="",this.#Ae.classList.add("TravelNotes-Hidden")}get footerHTMLElements(){return[]}get keyboardELEnabled(){return this.#Se}set keyboardELEnabled(t){this.#Se=t}}{#ts;constructor(t){super(t)}createContentHTML(){this.#ts=new st({elements:Array.from(this.options.selectOptionsData,(t=>t.text))})}get title(){return this.options.title||""}get contentHTMLElements(){return[this.#ts.controlHTMLElement]}onOk(){super.onOk(this.options.selectOptionsData[this.#ts.selectedIndex].objId)}}const nt=new class{#es(e){return(e+t.d540)%t.d360-t.d180}constructor(){Object.freeze(this)}arcFromSummitArcArc(t,e,s){return Math.acos(Math.cos(e)*Math.cos(s)+Math.sin(e)*Math.sin(s)*Math.cos(t))}summitFromArcArcArc(t,e,s){return Math.acos((Math.cos(s)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(e,s){if(e[0]===s[0]&&e[1]===s[1])return 0;const i=e[0]*t.toRadians,n=s[0]*t.toRadians,a=(this.#es(s[1])-this.#es(e[1]))*t.toRadians;return Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(a))*r}};class at{#ss;#is;#ns;#as;#os;#rs;constructor(t){Object.freeze(this),this.#ss=l,this.#is=t,this.#ns=new Map,this.#as=new Map,this.#os=new Map,this.#rs=0}get nodes3WaysCounter(){return this.#rs}set nodes3WaysCounter(t){this.#rs=t}get waysMap(){return this.#ns}get nodesMap(){return this.#as}get stopsMap(){return this.#os}get newId(){return this.#ss--}firstOf(t){return t[0]}lastOf(t){return t[t.length-1]}removeFrom(t,e){t.splice(t.indexOf(e),1)}#ls(t){const e=this.#as.get(this.firstOf(t.nodesIds)),s=this.#as.get(this.lastOf(t.nodesIds));this.removeFrom(e.startingWaysIds,t.id),e.endingWaysIds.push(t.id),this.removeFrom(s.endingWaysIds,t.id),s.startingWaysIds.push(t.id),t.nodesIds.reverse()}mergeWays(t,e){const s=this.#ns.get(t),i=this.#ns.get(e);this.lastOf(s.nodesIds)===this.lastOf(i.nodesIds)?this.#ls(i):this.firstOf(s.nodesIds)===this.firstOf(i.nodesIds)?this.#ls(s):this.firstOf(s.nodesIds)===this.lastOf(i.nodesIds)&&(this.#ls(s),this.#ls(i));const n=this.#as.get(s.nodesIds.pop());n.startingWaysIds=[],n.endingWaysIds=[],s.nodesIds=s.nodesIds.concat(i.nodesIds),s.distance+=i.distance;const a=this.#as.get(this.lastOf(s.nodesIds));return this.removeFrom(a.endingWaysIds,i.id),a.endingWaysIds.push(s.id),this.#ns.delete(i.id),s.id}#b(t){const e=this.#as.get(t),s={id:this.newId,lat:e.lat,lon:e.lon,type:"node",startingWaysIds:[],endingWaysIds:[],isNode3Ways:e.isNode3Ways};return this.#as.set(s.id,s),s.id}cloneWay(t){const e=this.#ns.get(t),s={id:this.newId,type:"way",nodesIds:[],distance:e.distance};return e.nodesIds.forEach((t=>s.nodesIds.push(this.#b(t)))),this.#as.get(this.firstOf(s.nodesIds)).startingWaysIds.push(s.id),this.#as.get(this.lastOf(s.nodesIds)).endingWaysIds.push(s.id),this.#ns.set(s.id,s),s.id}createMaps(t){this.#ns.clear(),this.#as.clear(),this.#os.clear(),t.forEach((t=>{switch(t.type){case"way":t.nodesIds=t.nodes,delete t.nodes,2<=t.nodesIds.length&&(t.distance=0,this.#ns.set(t.id,t));break;case"node":t.startingWaysIds=[],t.endingWaysIds=[],t.isNode3Ways=!1,this.#as.set(t.id,t);break;case"relation":t.members.forEach((t=>{"node"===t.type&&t.role&&"stop"===t.role&&this.#os.set(t.ref,t.ref)}))}})),this.#os.forEach((t=>{const e=this.#as.get(t);e?this.#os.set(t,e):(window.TaN.showInfo("the relation "+this.#is+" have nodes not positionned on the railway ( node "+t+")."),this.#os.delete(t))})),this.#ns.forEach((t=>{this.#as.get(this.firstOf(t.nodesIds)).startingWaysIds.push(t.id),this.#as.get(this.lastOf(t.nodesIds)).endingWaysIds.push(t.id);let e=null;t.nodesIds.forEach((s=>{const i=this.#as.get(s);e&&(t.distance+=nt.pointsDistance([i.lat,i.lon],[e.lat,e.lon])),e=i}))}))}}class ot{#ds;#hs(t,e,s){t.isNode3Ways||e.isNode3Ways||s.push({distance:nt.pointsDistance([t.lat,t.lon],[e.lat,e.lon]),nodesId:[t.id,e.id]})}#cs(){const t=[],e=Array.from(this.#ds.waysMap.values());let s=1;e.forEach((i=>{for(let n=s;n<e.length;n++){const s=[];s.push(this.#ds.nodesMap.get(this.#ds.firstOf(i.nodesIds))),s.push(this.#ds.nodesMap.get(this.#ds.lastOf(i.nodesIds))),s.push(this.#ds.nodesMap.get(this.#ds.firstOf(e[n].nodesIds))),s.push(this.#ds.nodesMap.get(this.#ds.lastOf(e[n].nodesIds))),this.#hs(s[0],s[2],t),this.#hs(s[0],s[3],t),this.#hs(s[1],s[2],t),this.#hs(s[1],s[3],t)}s++}));let i=t[0];t.forEach((t=>{t.distance<i.distance&&(i=t)}));const n={id:this.#ds.newId,type:"way",nodesIds:i.nodesId,distance:i.distance};this.#ds.waysMap.set(n.id,n);const a=this.#ds.nodesMap.get(i.nodesId[0]),o=a.startingWaysIds.concat(a.endingWaysIds)[0];a.startingWaysIds.push(n.id);const r=this.#ds.nodesMap.get(i.nodesId[1]),l=r.startingWaysIds.concat(r.endingWaysIds)[0];r.endingWaysIds.push(n.id),this.#ds.mergeWays(this.#ds.mergeWays(n.id,o),l),this.#ds.waysMap.size>2*this.#ds.nodes3WaysCounter+1&&this.#cs()}constructor(t){Object.freeze(this),this.#ds=t}removeHoles(){this.#cs()}}class rt{#is;#us;#gs;#ds;#ps(){this.#us.forEach((t=>{let e=Number.MAX_VALUE,s=null;const i=t.startingWaysIds.concat(t.endingWaysIds);i.forEach((t=>{const i=this.#ds.waysMap.get(t);i.distance<e&&(e=i.distance,s=i)})),this.#ds.removeFrom(i,s.id);const n=this.#ds.waysMap.get(this.#ds.cloneWay(s.id));let a=null;this.#ds.firstOf(s.nodesIds)===t.id?(n.nodesIds.pop(),n.nodesIds.push(this.#ds.lastOf(s.nodesIds)),a=this.#ds.firstOf(n.nodesIds)):(n.nodesIds.shift(),n.nodesIds.unshift(this.#ds.firstOf(s.nodesIds)),a=this.#ds.lastOf(n.nodesIds));const o=this.#ds.waysMap.get(i[1]);o.nodesIds[o.nodesIds.indexOf(t.id)]=a,this.#ds.mergeWays(this.#ds.mergeWays(this.#ds.mergeWays(s.id,n.id),i[0]),o.id)}))}#ms(t){let e=null,s=null,i=Number.MAX_VALUE,n=Number.MAX_VALUE;this.#ds.stopsMap.forEach((t=>{let a=nt.pointsDistance([t.lat,t.lon],this.#gs.wayPoints.first.latLng);a<i&&(i=a,e=t),a=nt.pointsDistance([t.lat,t.lon],this.#gs.wayPoints.last.latLng),a<n&&(n=a,s=t)})),t.itinerary.itineraryPoints.removeAll(),t.itinerary.maneuvers.removeAll(),t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0;let a=0,o=!1;Array.from(this.#ds.waysMap.values())[0].nodesIds.forEach((i=>{if(0!==a||i!==e.id&&i!==s.id?2!==a||i!==e.id&&i!==s.id||(a=3):(a=1,o=i===s.id),0<a&&4>a){const n=new N,a=this.#ds.nodesMap.get(i);n.latLng=[a.lat,a.lon],t.itinerary.itineraryPoints.add(n);const o=this.#ds.stopsMap.get(i);if(o){const i=new H;let a=null;o.tags&&o.tags.name&&(a=o.tags.name,i.instruction=a+"&nbsp;:&nbsp;"),o.id===e.id?(a&&(t.wayPoints.first.name=a),i.iconName="kTrainStart",i.instruction+="Monter dans le train"):o.id===s.id?(a&&(t.wayPoints.last.name=a),i.iconName="kTrainEnd",i.instruction+="Descendre du train"):(i.iconName="kTrainContinue",i.instruction+="Rester dans le train"),i.distance=0,i.duration=0,i.itineraryPointObjId=n.objId,t.itinerary.maneuvers.add(i)}}1===a&&(a=2),3===a&&(a=4)})),o&&(t.itinerary.itineraryPoints.reverse(),t.itinerary.maneuvers.reverse()),t.distance=0;const r=t.itinerary.maneuvers.iterator;r.done;let l=r.value;r.done;const d=t.itinerary.itineraryPoints.iterator;d.done;let h=d.value;for(;!d.done;)d.value.distance=0,h.distance=nt.pointsDistance(h.latLng,d.value.latLng),t.distance+=h.distance,l.distance+=h.distance,r.value.itineraryPointObjId===d.value.objId&&(l=r.value,l.distance=0,r.done),h=d.value}constructor(t,e){Object.freeze(this),this.#gs=t,this.#is=e,this.#ds=new at(e),this.#us=[]}buildRoute(t,e,s){this.#us=[],this.#ds.nodes3WaysCounter=0,this.#ds.createMaps(t.elements);let i=!1;this.#ds.nodesMap.forEach((t=>{const e=t.startingWaysIds.concat(t.endingWaysIds);switch(e.length){case 0:case 1:break;case 2:this.#ds.mergeWays(e[0],e[1]);break;case 3:t.isNode3Ways=!0,this.#us.push(t),this.#ds.nodes3WaysCounter++;break;default:i=!0,window.TaN.showInfo("A node with more than 3 ways is found : "+t.id+" - the relation "+this.#is+" - ways "+t.startingWaysIds.concat(t.endingWaysIds))}})),i?s(new Error("A node with more than 3 ways was found in the relation.See the console for more infos")):(this.#ds.waysMap.size>2*this.#ds.nodes3WaysCounter+1&&(new ot(this.#ds).removeHoles(),window.TaN.showInfo("Holes found in the OSM relation number "+this.#is+". Try to correct OSM data.")),0<this.#ds.nodes3WaysCounter&&this.#ps(),this.#ms(this.#gs),e(this.#gs))}}window.TaN.addProvider(class extends class{#bs;#gs;#ys(t,e){}constructor(){Object.freeze(this),this.#bs="fr"}getPromiseRoute(t){return this.#gs=t,new Promise(((t,e)=>this.#ys(t,e)))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVEhL7cyxDQAgAAQh91/67ektTI4BOHumGtWoRjWqUY1qVKMaP9bbBZKXggu6NeCUAAAAAElFTkSuQmCC"}get name(){return""}get title(){return""}get transitModes(){return[]}get providerKeyNeeded(){return!0}get userLanguage(){return this.#bs}set userLanguage(t){this.#bs=t}}{#gs;#fs(t,e,s){new rt(this.#gs).buildRoute(t,e,s)}#vs(t){return window.TaN.overpassApiUrl+"?data=[out:json];rel("+t.toFixed(0)+');way(r)->.e;way.e["railway"="rail"];(._;>;rel('+t.toFixed(0)+"););out;"}#Ts(t){if(0===t.elements.length)return Promise.reject(new Error("No relations found"));const e=[];t.elements.forEach((t=>{e.push(new et(t.tags.name,t.id))}));return new it({title:"Relations",text:"select a relation : ",selectOptionsData:e}).show()}get#Ls(){return window.TaN.overpassApiUrl+'?data=[out:json];node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+this.#gs.wayPoints.first.lat.toFixed(n.fixed)+","+this.#gs.wayPoints.first.lng.toFixed(n.fixed)+')->.s;rel(bn.s)->.s;node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+this.#gs.wayPoints.last.lat.toFixed(n.fixed)+","+this.#gs.wayPoints.last.lng.toFixed(n.fixed)+")->.e;rel(bn.e)->.e;rel.e.s;out tags;"}#ys(t,e){fetch(this.#Ls).then((s=>{200===s.status&&s.ok?s.json().then((t=>this.#Ts(t))).then((t=>fetch(this.#vs(t)))).then((s=>{200===s.status&&s.ok?s.json().then((s=>this.#fs(s,t,e))):e(new Error("An error occurs..."))})).catch((()=>e(new Error("An error occurs...")))):e(new Error("An error occurs..."))})).catch((()=>{e()}))}constructor(){super()}getPromiseRoute(t){return this.#gs=t,new Promise(((t,e)=>this.#ys(t,e)))}get icon(){return'data:image/svg+xml;utf8,<svg viewBox="-3 -3 20 20" xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(128,0,0)"><path d="M 5,0 C 3.025911,-0.0084 1,3 1,7 l 0,2 c 0,1 1,2 2,2 l 8,0 c 1,0 2,-1 2,-2 L 13,7 C 13,3 11,0 9,0 z m -1,3 6,0 c 0,0 1,1 1,3 L 3.03125,6 C 2.994661,3.9916 4,3 4,3 z M 3,8 6,8 6,9 3,9 z m 5,0 3,0 0,1 -3,0 z m -6,4 -1,2 3,0 1,-2 z m 7,0 1,2 3,0 -1,-2 z"/></g></svg>'}get name(){return"PublicTransport"}get title(){return"Public Transport on OpenStreetMap"}get transitModes(){return["train"]}get providerKeyNeeded(){return!1}})}();
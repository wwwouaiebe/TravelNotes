/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 5.0.0-dev
 * Build 183 - Sat Jan 17 2026 16:26:43 GMT+0100 (heure normale dâ€™Europe centrale)
 * Copyright 2019 2026 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
*/


const theConfig={ApiKeys:{saveToSessionStorage:!0},ApiKeysDialog:{haveUnsecureButtons:!0,showApiKeys:!1,showButton:!0},baseDialog:{cancelTouchX:100,cancelTouchY:150,deltaZoomDistance:75,touchTopScreen:!0},contextMenu:{timeout:1500},dockableBaseDialog:{timeout:1500,hideOnMouseLeave:!1},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!1,showInfo:!0,showWarning:!0,timeOut:1e4},files:{openGpx:["gpx"],openTaN:["json","trv"],writeTouch:"trv",writeOthers:"trv"},fontSize:{initialValue:3.5,incrementValue:.5},FullScreenUI:{timeOut:5e3,screenMaxWidth:1200},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:0},options:{enableHighAccuracy:!0,maximumAge:0,timeout:36e5},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},mapContextMenu:{mouseMaxRouteDistance:10,touchMaxRouteDistance:10},mapLayersToolbar:{theDevil:{addButton:!0}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:6,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},theDevil:{addButton:!0,zoomFactor:17}},osmSearchDialog:{dialogX:50,dialogY:0},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"â€”â€”â€”â€”â€”â€”",iDashArray:[0]},{text:"â€” â€” â€” â€” â€”",iDashArray:[4,2]},{text:"â€”â€§â€”â€§â€”â€§â€”â€§â€”",iDashArray:[4,2,0,2]},{text:"Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:0,width:5},routeEditor:{showEditedRouteInRoadbook:!0},toolbars:{timeOut:1500},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr",startupRouteEdition:!0,resizeDelay:200},travelNotesToolbar:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},travelNotesDialog:{dialogX:250,dialogY:0},travelPropertiesDialog:{dialogX:50,dialogY:0},wayPoint:{reverseGeocoding:!0,geocodingIncludeName:!0}};class DEGREES{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class DISTANCE{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class ELEV{static get fixed(){return 2}static get defaultValue(){return 0}}class GEOLOCATION_STATUS{static get refusedByUser(){return-1}static get disabled(){return 0}static get inactive(){return 1}static get active(){return 2}}class ICON_DIMENSIONS{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class ICON_POSITION{static get atStart(){return-1}static get onRoute(){return 0}static get atEnd(){return 1}}class LAT_LNG{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class ROUTE_EDITION_STATUS{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}class SAVE_STATUS{static get notSaved(){return"ðŸ”´"}static get modified(){return"ðŸŸ¡"}static get saved(){return"ðŸŸ¢"}}class TOOLBAR_POSITION{static get topLeft(){return"travelnotes-base-toolbar-top-left"}static get topRight(){return"travelnotes-base-toolbar-top-right"}static get bottomLeft(){return"travelnotes-base-toolbar-bottom-left"}static get bottomRight(){return"travelnotes-base-toolbar-bottom-right"}}const DIALOG_DRAG_MARGIN=40,DIALOG_MAX_WIDTH=800,EARTH_RADIUS=6371e3,ELEVATION=2,HEXADECIMAL=16,HTTP_STATUS_OK=200,INVALID_OBJ_ID=-1,LAT=0,LNG=1,MOUSE_WHEEL_FACTORS=[.3,10,1],NEXT=1,NOT_FOUND=-1,ONE=1,OSM_COUNTRY_ADMIN_LEVEL="2",PREVIOUS=-1,SVG_NS="http://www.w3.org/2000/svg",THREE=3,TWO=2,WAY_POINT_ICON_SIZE=20,ZERO=0;class ObjId{static#t=0;static get nextObjId(){return++ObjId.#t}}const theDataVersion="5.0.0",theAppVersion="v5.0.0-dev";class ObjType{#e="";#o=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];#i=[];constructor(t,e){if(Object.freeze(this),-1===this.#o.indexOf(t))throw new Error("Invalid ObjType name : "+t);this.#e=t,this.#i=e,Object.freeze(this.#i)}get name(){return this.#e}get version(){return"5.0.0"}get properties(){return this.#i}get jsonObject(){return{name:this.#e,version:"5.0.0"}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this.#e);if(this.#e!==t.name)throw new Error("Invalid name for "+this.#e);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this.#e)}}class CollectionIterator{#n=null;#r=-1;constructor(t){Object.freeze(this),this.#n=t}get value(){return this.#r<this.#n.length?this.#n.at(this.#r):null}get previous(){return 0>=this.#r?null:this.#n.at(this.#r-1)}get next(){return this.#r<this.#n.length-1?this.#n.at(this.#r+1):null}get done(){return++this.#r>=this.#n.length}get first(){return 0===this.#r}get last(){return this.#r>=this.#n.length-1}get index(){return this.#r}}class Collection{#a;#s;#l;#h(t){return this.#a.findIndex(e=>e.objId===t)}#d(t,e,o){let i=this.#h(t);if(-1===i)throw new Error("invalid objId for next or previous function");if(1!==o&&-1!==o)throw new Error("invalid direction");let n=e;for(n||(n=()=>!0),i+=o;-1<i&&i<this.#a.length&&!n(this.#a[i]);)i+=o;return-1===i||this.#a.length===i?null:this.#a[i]}constructor(t){Object.freeze(this),this.#a=[],this.#l=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this.#s=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this.#s)throw new Error("invalid object name for add function");this.#a.push(t)}at(t){return t<this.#a.length&&t>-1?this.#a[t]:null}forEach(t){let e=null;const o=this.iterator;for(;!o.done;)e=t(o.value,e);return e}getAt(t){const e=this.#h(t);return-1===e?null:this.#a[e]}moveTo(t,e,o){let i=this.#h(t),n=this.#h(e);if(-1===i||-1===n)throw new Error("invalid objId for function  myMoveTo");o||n++,this.#a.splice(n,0,this.#a[i]),n<i&&i++,this.#a.splice(i,1)}next(t,e){return this.#d(t,e,1)}previous(t,e){return this.#d(t,e,-1)}remove(t){const e=this.#h(t);if(-1===e)throw new Error("invalid objId for remove function");this.#a.splice(e,1)}removeAll(t){t?this.#a.splice(1,this.#a.length-2):this.#a.length=0}replace(t,e){const o=this.#h(t);if(-1===o)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this.#s)throw new Error("invalid object name for replace function");this.#a[o]=e}reverse(){this.#a.reverse()}sort(t){this.#a.sort(t)}swap(t,e){const o=this.#h(t);if(-1===o||0===o&&e||this.#a.length-1===o&&!e)throw new Error("invalid objId for swap function");const i=e?-1:1,n=this.#a[o];this.#a[o]=this.#a[o+i],this.#a[o+i]=n}get first(){return this.#a[0]}get iterator(){return new CollectionIterator(this)}get last(){return this.#a[this.#a.length-1]}get length(){return this.#a.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this.#a.length=0,Array.isArray(t)&&t.forEach(t=>{const e=new this.#l;e.jsonObject=t,this.add(e)})}}class HTMLSanitizerData{#c=new Map;constructor(){Object.freeze(this),this.#c.set("a",["href","target"]),this.#c.set("div",[]),this.#c.set("del",[]),this.#c.set("em",[]),this.#c.set("figcaption",[]),this.#c.set("figure",[]),this.#c.set("h1",[]),this.#c.set("h2",[]),this.#c.set("h3",[]),this.#c.set("h4",[]),this.#c.set("h5",[]),this.#c.set("h6",[]),this.#c.set("hr",[]),this.#c.set("img",["src","alt","width","height"]),this.#c.set("ins",[]),this.#c.set("li",[]),this.#c.set("mark",[]),this.#c.set("ol",[]),this.#c.set("p",[]),this.#c.set("s",[]),this.#c.set("small",[]),this.#c.set("strong",[]),this.#c.set("span",[]),this.#c.set("sub",[]),this.#c.set("sup",[]),this.#c.set("ul",[]),this.#c.set("svg",["xmlns","viewBox","class"]),this.#c.set("text",["x","y","text-anchor"]),this.#c.set("polyline",["points","class","transform"]),this.#c.set("#text",[])}getValidAttributesNames(t){return this.#c.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#c.get(e)?e:""}}class HtmlStringValidationResult{#u;#p;constructor(t,e){Object.freeze(this),this.#u=t,this.#p=e}get htmlString(){return this.#u}get errorsString(){return this.#p}}class UrlValidationResult{#m;#p;constructor(t,e){Object.freeze(this),this.#m=t,this.#p=e}get url(){return this.#m}get errorsString(){return this.#p}}class HTMLSanitizer{#g="";#v="";static#f=new HTMLSanitizerData;#T(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#y(t,e){const o=this.sanitizeToUrl(t,e).url;""===o&&""!==t?this.#v+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#g+=" "+e+'="'+o+'"'}#L(t,e){HTMLSanitizer.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(this.#g+=" "+e+'="'+this.#T(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))})}#E(t,e){t.hasAttribute("target")&&(this.#g+=' rel="noopener noreferrer"'),HTMLSanitizer.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#y(t.getAttribute(e),e):this.#g+=" "+e+'="'+this.#T(t.getAttribute(e))+'"',t.removeAttribute(e))})}#b(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#v+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#_(t){const e=t.childNodes;for(let o=0;o<e.length;o++){const e=t.childNodes[o],i=HTMLSanitizer.#f.getValidNodeName(e.nodeName);""===i?this.#v+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===i?this.#g+=this.#T(e.nodeValue):(this.#g+="<"+i,"svg"===i||"text"===i||"polyline"===i?this.#L(e,i):this.#E(e,i),this.#g+=">",this.#_(e),this.#g+="</"+i+">",e.attributes&&this.#b(e))}}#M(t,e){const o=document.createElementNS(SVG_NS,e);return HTMLSanitizer.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(o.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))}),o}#w(t,e){const o=document.createElement(e);return HTMLSanitizer.#f.getValidAttributesNames(e).forEach(e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const i=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==i&&o.setAttribute(e,i)}else o.setAttribute(e,t.getAttribute(e))}),t.hasAttribute("target")&&o.setAttribute("rel","noopener noreferrer"),o}#D(t,e){const o=t.childNodes;for(let i=0;i<o.length;i++){const o=t.childNodes[i],n=HTMLSanitizer.#f.getValidNodeName(o.nodeName);if("#text"===n)e.appendChild(document.createTextNode(o.nodeValue));else if(""!==n){const t="svg"===n||"text"===n||"polyline"===n?this.#M(o,n):this.#w(o,n);e.appendChild(t),this.#D(o,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const o=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),i=new DocumentFragment;o&&"#document"===o.nodeName?(this.#D(o.body.firstChild,i),e.appendChild(i)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#D(t,e),e}sanitizeToHtmlString(t){this.#g="",this.#v="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","à¨€")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#_(e.body.firstChild),new HtmlStringValidationResult(this.#g,this.#v)):new HtmlStringValidationResult("","Parsing error")}sanitizeToUrl(t,e){const o=e||"href",i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!i||"#document"!==i.nodeName)return new UrlValidationResult("","Parsing error");const n=i.body.firstChild;let r="";for(let t=0;t<n.childNodes.length;t++){if("#text"!==n.childNodes[t].nodeName)return new UrlValidationResult("","Invalid characters found in the url");r+=n.childNodes[t].nodeValue}if(r=r.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),r!==t)return new UrlValidationResult("","Invalid characters found in the url");const a=["https:"];if("http:"!==window.location.protocol&&"href"!==o||a.push("http:"),"href"===o){a.push("mailto:"),a.push("sms:"),a.push("tel:");const t=r.match(/^\u0023\w*/);if(t&&r===t[0])return new UrlValidationResult(r,"")}"src"===o&&a.push("data:");let s=null;try{s=new URL(r)}catch{return new UrlValidationResult("","Invalid url string")}if(-1===a.indexOf(s.protocol))return new UrlValidationResult("","Invalid protocol "+s.protocol);if(-1!==["sms:","tel:"].indexOf(s.protocol))return s.pathname.match(/^\+[0-9,*,\u0023]*$/)?new UrlValidationResult(r,""):new UrlValidationResult("","Invalid sms: or tel: url");try{encodeURIComponent(s.href)}catch{return new UrlValidationResult("","Invalid character in url")}return new UrlValidationResult(r,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const o=e.body.firstChild;let i="";for(let t=0;t<o.childNodes.length;t++){if("#text"!==o.childNodes[t].nodeName)return"";i+=o.childNodes[t].nodeValue}return i=i.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),i}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const theHTMLSanitizer=new HTMLSanitizer;class Translator{#C=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach(t=>this.#C.set(t.msgid,theHTMLSanitizer.sanitizeToJsString(t.msgstr)))}getText(t,e){let o=this.#C.get(t);return e&&o&&Object.getOwnPropertyNames(e).forEach(t=>o=o.replace("{"+t+"}",e[t])),o||t}}const theTranslator=new Translator;class Utilities{constructor(){Object.freeze(this)}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let o="";for(let i=0;i<16;i++)o+=e[i].toString(16).padStart(2,"0")+t[i];return o}storageAvailable(t){try{const e=window[t],o="__storage_test__";return e.setItem(o,o),e.removeItem(o),!0}catch{return!1}}openFile(t,e){const o=document.createElement("input");o.type="file",e&&(o.accept=e),o.addEventListener("change",t,!1),o.click()}saveFile(t,e,o){try{const i=o?window.URL.createObjectURL(new File([e],t,{type:o})):URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",t),n.click(),window.URL.revokeObjectURL(i)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const o=Math.floor(e/86400),i=Math.floor(e%86400/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return 0<o?o+"Â "+theTranslator.getText("Utilities - Day")+"Â "+i+"Â "+theTranslator.getText("Utilities - Hour"):0<i?i+"Â "+theTranslator.getText("Utilities - Hour")+"Â "+n+"Â "+theTranslator.getText("Utilities - Minute"):0<n?n+"Â "+theTranslator.getText("Utilities - Minute"):r+"Â "+theTranslator.getText("Utilities - Second")}formatDistance(t){const e=Math.floor(t);return 0>=e?"0Â km":Math.floor(e/DISTANCE.metersInKm)+","+Math.floor(e%DISTANCE.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+"Â km"}numberToDMS(t){let e=t,o=Math.floor(t);e-=o;let i=Math.floor(60*e);e-=i/60,e*=3600;let n=Math.floor(e);return e-=n,e=Math.floor(100*e),o.toString()+"Â° "+i.toString()+"' "+n+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+"Â N":this.numberToDMS(-t)+"Â S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+"Â E":this.numberToDMS(-t)+"Â W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+"Â -Â "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(LAT_LNG.fixed)+"Â N":(-t).toFixed(LAT_LNG.fixed)+"Â S"}formatLng(t){return t>0?t.toFixed(LAT_LNG.fixed)+"Â E":(-t).toFixed(LAT_LNG.fixed)+"Â W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+"Â -Â "+this.formatLng(t[1])}}const theUtilities=new Utilities;class TravelUpdater{#I;#N(){this.#I.routes.forEach(t=>{t.dashArray=0,t.hidden=!1})}#x(){this.#I.routes.forEach(t=>{t.edited=ROUTE_EDITION_STATUS.notEdited})}#P(){this.#x(),this.#I.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"#ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:ROUTE_EDITION_STATUS.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}#S(){if(this.#I.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"LantmÃ¤teriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===this.#I.userData.layerId);this.#I.layerName=t?t.layerName:"OSM - Color"}else this.#I.layerName="OSM - Color"}#O(t){t.forEach(t=>{t.elev=ELEV.defaultValue})}#A(){this.#I.routes.forEach(t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this.#O(t.itinerary.itineraryPoints)}),this.#I.editedRoute.itinerary.hasProfile=!1,this.#I.editedRoute.itinerary.ascent=0,this.#I.editedRoute.itinerary.descent=0,this.#O(this.#I.editedRoute.itinerary.itineraryPoints)}#R(t){t.itinerary.maneuvers.forEach(t=>{"kArriveDefault"===t.iconName&&(t.distance=DISTANCE.defaultValue)})}#k(t){t.wayPoints.forEach(t=>{t.address=t.name,t.name=""})}#B(){this.#I.routes.forEach(t=>{t.editionStatus=t.edited,this.#R(t),this.#k(t)}),this.#I.editedRoute.editionStatus=this.#I.editedRoute.edited,this.#R(this.#I.editedRoute),this.#k(this.#I.editedRoute)}#j(){this.#I.routes.forEach(t=>{t.dashIndex=t.dashArray}),this.#I.editedRoute.dashIndex=this.#I.editedRoute.dashArray}#H(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}#F(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this.#H(t.iconContent),t.popupContent=this.#H(t.popupContent),t.tooltipContent=this.#H(t.tooltipContent),t.phone=this.#H(t.phone),t.address=this.#H(t.address)}#z(){this.#I.notes.forEach(t=>{this.#F(t)}),this.jsonTravel.routes.forEach(t=>{t.notes.forEach(t=>{this.#F(t)})})}#U(t){[[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kBusEnd"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0075"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kBusStart"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0076"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kFerryExit"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0077"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kFerryEnter"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0078"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kTrainEnd"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0079"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kTrainStart"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0080"></div>'],[/class="TravelNotes-MapNote TravelNotes-MapNoteCategory/g,'class="travelnotes-map-note travelnotes-map-note-category'],[/class="TravelNotes-SvgIcon/g,'class="travelnotes-svg-icon'],[/class="TravelNotes-OSM-Itinerary/g,'class="travelnotes-osm-itinerary'],[/class="TravelNotes-OSM-Highway TravelNotes-OSM-Highway/g,'class="travelnotes-osm-highway travelnotes-osm-highway'],[/class="TravelNotes-OSM-RcnRef/g,'class="travelnotes-osm-rcn-ref']].forEach(e=>{t.iconContent=t.iconContent.replaceAll(e[0],e[1])}),[[/class="TravelNotes-Note-WhiteRed/g,'class="travelnotes-note-white-red'],[/class="TravelNotes-Note-WhiteGreen/g,'class="travelnotes-note-white-green'],[/class="TravelNotes-Note-WhiteBlue/g,'class="travelnotes-note-white-blue'],[/class="TravelNotes-Note-WhiteBrown/g,'class="travelnotes-note-white-brown'],[/class="TravelNotes-Note-WhiteBlack/g,'class="travelnotes-note-white-black'],[/class="TravelNotes-Note-BlackWhite/g,'class="travelnotes-note-black-white']].forEach(e=>{t.iconContent=t.iconContent.replaceAll(e[0],e[1]),t.popupContent=t.popupContent.replaceAll(e[0],e[1]),t.tooltipContent=t.tooltipContent.replaceAll(e[0],e[1]),t.address=t.address.replaceAll(e[0],e[1]),t.phone=t.phone.replaceAll(e[0],e[1])})}#W(){const t=new Map;t.set("kArriveLeft","arrive-left"),t.set("kArriveRight","arrive-right"),t.set("kContinueLeft","continue-left"),t.set("kContinueRight","continue-right"),t.set("kContinueSharpLeft","continue-sharp-left"),t.set("kContinueSharpRight","continue-sharp-right"),t.set("kContinueSlightLeft","continue-slight-left"),t.set("kContinueSlightRight","continue-slight-right"),t.set("kContinueStraight","continue-straight"),t.set("kDepartDefault","depart-default"),t.set("kDepartLeft","depart-left"),t.set("kDepartRight","depart-right"),t.set("kEndOfRoadLeft","end-of-road-left"),t.set("kEndOfRoadRight","end-of-road-right"),t.set("kFerryEnter","ferry-enter"),t.set("kFerryExit","ferry-exit"),t.set("kForkLeft","fork-left"),t.set("kForkRight","fork-right"),t.set("kMergeDefault","merge-default"),t.set("kMergeLeft","merge-left"),t.set("kMergeRight","merge-right"),t.set("kNewNameLeft","new-name-left"),t.set("kNewNameRight","new-name-right"),t.set("kNewNameSharpLeft","new-name-sharp-left"),t.set("kNewNameSharpRight","new-name-sharp-right"),t.set("kNewNameSlightLeft","new-name-slight-left"),t.set("kNewNameSlightRight","new-name-slight-right"),t.set("kNewNameStraight","new-name-straight"),t.set("kOffRampLeft","off-ramp-left"),t.set("kOffRampRight","off-ramp-right"),t.set("kOnRampLeft","on-ramp-left"),t.set("kOnRampRight","on-ramp-right"),t.set("kRotaryLeft","rotary-left"),t.set("kRotaryRight","rotary-right"),t.set("kRoundaboutExit","roundabout-exit"),t.set("kRoundaboutLeft","roundabout-left"),t.set("kRoundaboutRight","roundabout-right"),t.set("kRoundaboutTurnLeft","roundabout-turn-left"),t.set("kRoundaboutTurnRight","roundabout-turn-right"),t.set("kRoundaboutTurnSharpLeft","roundabout-turn-sharp-left"),t.set("kRoundaboutTurnSharpRight","roundabout-turn-sharp-right"),t.set("kRoundaboutTurnSlightLeft","roundabout-turn-slight-left"),t.set("kRoundaboutTurnSlightRight","roundabout-turn-slight-right"),t.set("kRoundaboutTurnStraight","roundabout-turn-straight"),t.set("kStayLeft","stay-left"),t.set("kStayRight","stay-right"),t.set("kStayStraight","stay-straight"),t.set("kTurnLeft","turn-left"),t.set("kTurnRight","turn-right"),t.set("kTurnSharpLeft","turn-sharp-left"),t.set("kTurnSharpRight","turn-sharp-right"),t.set("kTurnSlightLeft","turn-slight-left"),t.set("kTurnSlightRight","turn-slight-right"),t.set("kTurnStraight","turn-straight"),t.set("kTurnUturn","turn-u-turn"),t.set("kUndefined","undefined"),t.set("kUturnLeft","u-turn-left"),t.set("kUturnRight","u-turn-right"),t.set("kTrainStart","train-start"),t.set("kTrainContinue","train-continue"),t.set("kTrainEnd","train-end"),this.#I.routes.forEach(e=>{e.itinerary.maneuvers.forEach(e=>{e.iconName=t.get(e.iconName)||"undefined"})})}#K(){this.#I.notes.forEach(t=>{this.#U(t)}),this.#I.routes.forEach(t=>{t.notes.forEach(t=>{this.#U(t)})})}#V(){switch(this.#I.objType.version){case"1.0.0":this.#N();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this.#P();case"1.5.0":this.#S();case"1.6.0":this.#A();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this.#B();case"1.12.0":case"1.13.0":this.#z();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this.#j();case"2.4.0":this.#K(),this.#W(),this.#I.objType.version="5.0.0";break;default:throw new Error("invalid version for travel")}}constructor(){Object.freeze(this)}update(t){"5.0.0"!==t.objType.version&&(this.#I=t,this.#V())}}class TravelObject{constructor(){Object.freeze(this)}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new TravelUpdater).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach(t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)}),t}}class WayPoint extends TravelObject{static#G=new ObjType("WayPoint",["address","name","lat","lng","objId"]);#Z="";#X="";#Y=LAT_LNG.defaultValue;#q=LAT_LNG.defaultValue;#t=-1;constructor(){super(),this.#t=ObjId.nextObjId}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get address(){return this.#X}set address(t){this.#X="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get lat(){return this.#Y}set lat(t){this.#Y="number"==typeof t?t:LAT_LNG.defaultValue}get lng(){return this.#q}set lng(t){this.#q="number"==typeof t?t:LAT_LNG.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=theUtilities.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#Y=t[0],this.#q=t[1]):(this.#Y=LAT_LNG.defaultValue,this.#q=LAT_LNG.defaultValue)}get objId(){return this.#t}get objType(){return WayPoint.#G}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(LAT_LNG.fixed)),lng:parseFloat(this.lng.toFixed(LAT_LNG.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.#t=ObjId.nextObjId}}class ItineraryPoint extends TravelObject{static#G=new ObjType("ItineraryPoint",["lat","lng","distance","elev","objId"]);#Y=LAT_LNG.defaultValue;#q=LAT_LNG.defaultValue;#J=DISTANCE.defaultValue;#$=ELEV.defaultValue;#t=-1;constructor(){super(),this.#t=ObjId.nextObjId}get lat(){return this.#Y}set lat(t){this.#Y="number"==typeof t?t:LAT_LNG.defaultValue}get lng(){return this.#q}set lng(t){this.#q="number"==typeof t?t:LAT_LNG.defaultValue}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:DISTANCE.defaultValue}get elev(){return this.#$}set elev(t){this.#$="number"==typeof t?t:LAT_LNG.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#Y=t[0],this.#q=t[1]):(this.#Y=LAT_LNG.defaultValue,this.#q=LAT_LNG.defaultValue)}get objType(){return ItineraryPoint.#G}get objId(){return this.#t}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(LAT_LNG.fixed)),lng:parseFloat(this.lng.toFixed(LAT_LNG.fixed)),distance:parseFloat(this.distance.toFixed(DISTANCE.fixed)),elev:parseFloat(this.elev.toFixed(ELEV.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this.#t=ObjId.nextObjId}}class Maneuver extends TravelObject{static#G=new ObjType("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);#Q="";#tt="";#et=-1;#J=DISTANCE.defaultValue;#ot=DISTANCE.defaultValue;#t=-1;constructor(){super(),this.#t=ObjId.nextObjId}get iconName(){return this.#Q}set iconName(t){this.#Q="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get instruction(){return this.#tt}set instruction(t){this.#tt="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get itineraryPointObjId(){return this.#et}set itineraryPointObjId(t){this.#et="number"==typeof t?t:-1}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:DISTANCE.defaultValue}get duration(){return this.#ot}set duration(t){this.#ot="number"==typeof t?t:DISTANCE.defaultValue}get objType(){return Maneuver.#G}get objId(){return this.#t}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(DISTANCE.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this.#t=ObjId.nextObjId}}class Itinerary extends TravelObject{static#G=new ObjType("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);#t=-1;#it=!1;#nt=0;#rt=0;#at="";#st="";#lt=new Collection(ItineraryPoint);#ht=new Collection(Maneuver);constructor(){super(),this.#t=ObjId.nextObjId}get hasProfile(){return this.#it}set hasProfile(t){this.#it="boolean"==typeof t&&t}get ascent(){return this.#nt}set ascent(t){this.#nt="number"==typeof t?Number.parseInt(t):0}get descent(){return this.#rt}set descent(t){this.#rt="number"==typeof t?Number.parseInt(t):0}get provider(){return this.#at}set provider(t){this.#at="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get transitMode(){return this.#st}set transitMode(t){this.#st="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get itineraryPoints(){return this.#lt}get maneuvers(){return this.#ht}get objType(){return Itinerary.#G}get objId(){return this.#t}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this.#t=ObjId.nextObjId;const o=new Map;let i=0;const n=this.itineraryPoints.iterator;for(;!n.done;)o.set(e.itineraryPoints[i].objId,n.value.objId),i++;const r=this.maneuvers.iterator;for(;!r.done;)r.value.itineraryPointObjId=o.get(r.value.itineraryPointObjId)}}class Note extends TravelObject{static#G=new ObjType("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);#dt=ICON_DIMENSIONS.height;#ct=ICON_DIMENSIONS.width;#ut="";#pt="";#mt="";#gt="";#m="";#X="";#vt=LAT_LNG.defaultValue;#ft=LAT_LNG.defaultValue;#Y=LAT_LNG.defaultValue;#q=LAT_LNG.defaultValue;#J=DISTANCE.invalid;#Tt=DISTANCE.defaultValue;#t=-1;constructor(){super(),this.#t=ObjId.nextObjId}get iconHeight(){return this.#dt}set iconHeight(t){this.#dt="number"==typeof t?t:ICON_DIMENSIONS.height}get iconWidth(){return this.#ct}set iconWidth(t){this.#ct="number"==typeof t?t:ICON_DIMENSIONS.width}get iconContent(){return this.#ut}set iconContent(t){this.#ut="string"==typeof t?theHTMLSanitizer.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this.#pt}set popupContent(t){this.#pt="string"==typeof t?theHTMLSanitizer.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this.#mt}set tooltipContent(t){this.#mt="string"==typeof t?theHTMLSanitizer.sanitizeToHtmlString(t).htmlString:""}get phone(){return this.#gt}set phone(t){this.#gt="string"==typeof t?theHTMLSanitizer.sanitizeToHtmlString(t).htmlString:""}get url(){return this.#m}set url(t){this.#m="string"==typeof t?encodeURI(theHTMLSanitizer.sanitizeToUrl(t).url):""}get address(){return this.#X}set address(t){this.#X="string"==typeof t?theHTMLSanitizer.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this.#vt}set iconLat(t){this.#vt="number"==typeof t?t:LAT_LNG.defaultValue}get iconLng(){return this.#ft}set iconLng(t){this.#ft="number"==typeof t?t:LAT_LNG.defaultValue}get lat(){return this.#Y}set lat(t){this.#Y="number"==typeof t?t:LAT_LNG.defaultValue}get lng(){return this.#q}set lng(t){this.#q="number"==typeof t?t:LAT_LNG.defaultValue}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:DISTANCE.invalid}get chainedDistance(){return this.#Tt}set chainedDistance(t){this.#Tt="number"==typeof t?t:DISTANCE.defaultValue}get isRouteNote(){return this.#J!==DISTANCE.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#vt=t[0],this.#ft=t[1]):(this.#vt=LAT_LNG.defaultValue,this.#ft=LAT_LNG.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#Y=t[0],this.#q=t[1]):(this.#Y=LAT_LNG.defaultValue,this.#q=LAT_LNG.defaultValue)}get objType(){return Note.#G}get objId(){return this.#t}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(LAT_LNG.fixed)),iconLng:parseFloat(this.iconLng.toFixed(LAT_LNG.fixed)),lat:parseFloat(this.lat.toFixed(LAT_LNG.fixed)),lng:parseFloat(this.lng.toFixed(LAT_LNG.fixed)),distance:parseFloat(this.distance.toFixed(DISTANCE.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(DISTANCE.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this.#t=ObjId.nextObjId}}class Route extends TravelObject{static#G=new ObjType("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);#Z="";#yt=new Collection(WayPoint);#Lt=new Collection(Note);#Et=new Itinerary;#bt=theConfig.route.width;#_t=theConfig.route.color;#Mt=theConfig.route.dashIndex;#wt=!0;#Tt=DISTANCE.defaultValue;#J=DISTANCE.defaultValue;#ot=DISTANCE.defaultValue;#Dt=ROUTE_EDITION_STATUS.notEdited;#Ct=!1;#t=-1;constructor(){super(),this.#yt.add(new WayPoint),this.#yt.add(new WayPoint),this.#t=ObjId.nextObjId}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get wayPoints(){return this.#yt}get notes(){return this.#Lt}get itinerary(){return this.#Et}get width(){return this.#bt}set width(t){this.#bt="number"==typeof t?t:theConfig.route.width}get color(){return this.#_t}set color(t){this.#_t="string"==typeof t&&theHTMLSanitizer.sanitizeToColor(t)||theConfig.route.color}get dashIndex(){return this.#Mt}set dashIndex(t){this.#Mt="number"==typeof t&&theConfig.route.dashChoices[t]?t:0}get dashString(){let t="";return theConfig.route.dashChoices[this.#Mt].iDashArray.forEach(e=>t+=String(e*this.#bt)+","),t.substring(0,t.length-1)}get chain(){return this.#wt}set chain(t){this.#wt="boolean"==typeof t&&t}get chainedDistance(){return this.#Tt}set chainedDistance(t){this.#Tt="number"==typeof t?t:DISTANCE.defaultValue}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:DISTANCE.defaultValue}get duration(){return this.#ot}set duration(t){this.#ot="number"==typeof t?t:DISTANCE.defaultValue}get editionStatus(){return this.#Dt}set editionStatus(t){this.#Dt="number"==typeof t?t:ROUTE_EDITION_STATUS.notEdited}get hidden(){return this.#Ct}set hidden(t){this.#Ct="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" â®ž "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this.#t}get objType(){return Route.#G}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach(e=>{t=t&&LAT_LNG.defaultValue!==e.lat&&LAT_LNG.defaultValue!==e.lng}),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(DISTANCE.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(DISTANCE.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this.#t=ObjId.nextObjId}}class Travel extends TravelObject{static#G=new ObjType("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);#It=new Route;#Nt=new Collection(Route);#Lt=new Collection(Note);#xt="OSM - Color";#Z="";#Pt=!1;#t=-1;constructor(){super(),this.#Nt.add(new Route),this.#t=ObjId.nextObjId}get editedRoute(){return this.#It}set editedRoute(t){this.#It="Route"===t?.objType?.name?t:new Route}get routes(){return this.#Nt}get notes(){return this.#Lt}get layerName(){return this.#xt}set layerName(t){this.#xt="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):"OSM - Color"}get name(){return this.#Z}set name(t){this.#Z="string"==typeof t?theHTMLSanitizer.sanitizeToJsString(t):""}get readOnly(){return this.#Pt}set readOnly(t){this.#Pt="boolean"!=typeof t||t}get objId(){return this.#t}get objType(){return Travel.#G}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this.#t=ObjId.nextObjId}}class TravelNotesDataRouting{#at="";#st="";constructor(){Object.freeze(this)}get provider(){return this.#at}set provider(t){this.#at="string"==typeof t?t:""}get transitMode(){return this.#st}set transitMode(t){this.#st="string"==typeof t?t:""}}class TravelNotesData{#St;#Ot;#At;#Rt;#kt;#Bt;#jt;constructor(){Object.freeze(this),this.#St=new Map,this.#Ot=new TravelNotesDataRouting,this.#At=theUtilities.UUID,this.#Rt=null,this.#kt=new Travel,this.#Bt=-1,this.#jt=[]}get map(){return this.#Rt}set map(t){this.#Rt||(this.#Rt=t)}get travel(){return this.#kt}get editedRouteObjId(){return this.#Bt}set editedRouteObjId(t){this.#Bt="number"==typeof t?t:-1}get searchData(){return this.#jt}get mapObjects(){return this.#St}get routing(){return this.#Ot}get UUID(){return this.#At}}const theTravelNotesData=new TravelNotesData;class ApiKey{#Ht;#Ft;constructor(t,e){Object.freeze(this),this.#Ht="string"==typeof t?t:"",this.#Ft="string"==typeof e?e:""}get providerName(){return this.#Ht}get providerKey(){return this.#Ft}get jsonObject(){return{providerName:this.providerName,providerKey:this.providerKey}}}class HTMLElementsFactory{#zt(t,e){for(const o in e)try{if("dataset"===o){const o=e.dataset;for(const e in o)t.dataset["tan"+e]=o[e]}else t[o]=e[o]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){Object.freeze(this)}create(t,e,o){let i=null;return"text"===t.toLowerCase()?i=document.createTextNode(e.value||""):(i="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this.#zt(i,e)),o&&o.appendChild(i),i}}const theHTMLElementsFactory=new HTMLElementsFactory;let CancelButtonClickEL$1=class{#Ut;constructor(t){Object.freeze(this),this.#Ut=t}handleEvent(){this.#Ut.onCancel()}};class ModalDialogKeyboardKeydownEL{#Wt;constructor(t){Object.freeze(this),this.#Wt=t}handleEvent(t){this.#Wt.keyboardELEnabled&&("Escape"===t.key||"Esc"===t.key?this.#Wt.onCancel():"Enter"===t.key&&this.#Wt.onOk())}}class OkButtonClickEL{#Wt;constructor(t){Object.freeze(this),this.#Wt=t}handleEvent(){this.#Wt.onOk()}}
/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */function extend(t){var e,o,i,n;for(o=1,i=arguments.length;o<i;o++)for(e in n=arguments[o])t[e]=n[e];return t}var create$2=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function bind(t,e){var o=Array.prototype.slice;if(t.bind)return t.bind.apply(t,o.call(arguments,1));var i=o.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(o.call(arguments)):arguments)}}var lastId=0;function stamp(t){return"_leaflet_id"in t||(t._leaflet_id=++lastId),t._leaflet_id}function throttle(t,e,o){var i,n,r,a;return a=function(){i=!1,n&&(r.apply(o,n),n=!1)},r=function(){i?n=arguments:(t.apply(o,arguments),setTimeout(a,e),i=!0)},r}function wrapNum(t,e,o){var i=e[1],n=e[0],r=i-n;return t===i&&o?t:((t-n)%r+r)%r+n}function falseFn(){return!1}function formatNum(t,e){if(!1===e)return t;var o=Math.pow(10,void 0===e?6:e);return Math.round(t*o)/o}function trim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function splitWords(t){return trim(t).split(/\s+/)}function setOptions(t,e){for(var o in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?create$2(t.options):{}),e)t.options[o]=e[o];return t.options}function getParamString(t,e,o){var i=[];for(var n in t)i.push(encodeURIComponent(o?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}var templateRe=/\{ *([\w_ -]+) *\}/g;function template(t,e){return t.replace(templateRe,function(t,o){var i=e[o];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})}var isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function indexOf(t,e){for(var o=0;o<t.length;o++)if(t[o]===e)return o;return-1}var emptyImageUrl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function getPrefixed(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var lastTime=0;function timeoutDefer(t){var e=+new Date,o=Math.max(0,16-(e-lastTime));return lastTime=e+o,window.setTimeout(t,o)}var requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function requestAnimFrame(t,e,o){if(!o||requestFn!==timeoutDefer)return requestFn.call(window,bind(t,e));t.call(e)}function cancelAnimFrame(t){t&&cancelFn.call(window,t)}var Util={__proto__:null,extend,create:create$2,bind,get lastId(){return lastId},stamp,throttle,wrapNum,falseFn,formatNum,trim,splitWords,setOptions,getParamString,template,isArray,indexOf,emptyImageUrl,requestFn,cancelFn,requestAnimFrame,cancelAnimFrame};function Class(){}function checkDeprecatedMixinEvents(t){if("undefined"!=typeof L&&L&&L.Mixin){t=isArray(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}Class.extend=function(t){var e=function(){setOptions(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=e.__super__=this.prototype,i=create$2(o);for(var n in i.constructor=e,e.prototype=i,this)Object.prototype.hasOwnProperty.call(this,n)&&"prototype"!==n&&"__super__"!==n&&(e[n]=this[n]);return t.statics&&extend(e,t.statics),t.includes&&(checkDeprecatedMixinEvents(t.includes),extend.apply(null,[i].concat(t.includes))),extend(i,t),delete i.statics,delete i.includes,i.options&&(i.options=o.options?create$2(o.options):{},extend(i.options,t.options)),i._initHooks=[],i.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=i._initHooks.length;t<e;t++)i._initHooks[t].call(this)}},e},Class.include=function(t){var e=this.prototype.options;return extend(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},Class.mergeOptions=function(t){return extend(this.prototype.options,t),this},Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),o="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};var Events={on:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else for(var n=0,r=(t=splitWords(t)).length;n<r;n++)this._on(t[n],e,o);return this},off:function(t,e,o){if(arguments.length)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=splitWords(t);for(var n=1===arguments.length,r=0,a=t.length;r<a;r++)n?this._off(t[r]):this._off(t[r],e,o)}else delete this._events;return this},_on:function(t,e,o,i){if("function"==typeof e){if(!1===this._listens(t,e,o)){o===this&&(o=void 0);var n={fn:e,ctx:o};i&&(n.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,o){var i,n,r;if(this._events&&(i=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var a=this._listens(t,e,o);if(!1!==a){var s=i[a];this._firingCount&&(s.fn=falseFn,this._events[t]=i=i.slice()),i.splice(a,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(n=0,r=i.length;n<r;n++)i[n].fn=falseFn;delete this._events[t]}},fire:function(t,e,o){if(!this.listens(t,o))return this;var i=extend({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var n=this._events[t];if(n){this._firingCount=this._firingCount+1||1;for(var r=0,a=n.length;r<a;r++){var s=n[r],l=s.fn;s.once&&this.off(t,l,s.ctx),l.call(s.ctx||this,i)}this._firingCount--}}return o&&this._propagateEvent(i),this},listens:function(t,e,o,i){"string"!=typeof t&&console.warn('"string" type argument expected');var n=e;"function"!=typeof e&&(i=!!e,n=void 0,o=void 0);var r=this._events&&this._events[t];if(r&&r.length&&!1!==this._listens(t,n,o))return!0;if(i)for(var a in this._eventParents)if(this._eventParents[a].listens(t,e,o,i))return!0;return!1},_listens:function(t,e,o){if(!this._events)return!1;var i=this._events[t]||[];if(!e)return!!i.length;o===this&&(o=void 0);for(var n=0,r=i.length;n<r;n++)if(i[n].fn===e&&i[n].ctx===o)return n;return!1},once:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e,!0);else for(var n=0,r=(t=splitWords(t)).length;n<r;n++)this._on(t[n],e,o,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,extend({layer:t.target,propagatedFrom:t.target},t),!0)}};Events.addEventListener=Events.on,Events.removeEventListener=Events.clearAllEventListeners=Events.off,Events.addOneTimeEventListener=Events.once,Events.fireEvent=Events.fire,Events.hasEventListeners=Events.listens;var Evented=Class.extend(Events);function Point(t,e,o){this.x=o?Math.round(t):t,this.y=o?Math.round(e):e}var trunc=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function toPoint(t,e,o){return t instanceof Point?t:isArray(t)?new Point(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new Point(t.x,t.y):new Point(t,e,o)}function Bounds(t,e){if(t)for(var o=e?[t,e]:t,i=0,n=o.length;i<n;i++)this.extend(o[i])}function toBounds(t,e){return!t||t instanceof Bounds?t:new Bounds(t,e)}function LatLngBounds(t,e){if(t)for(var o=e?[t,e]:t,i=0,n=o.length;i<n;i++)this.extend(o[i])}function toLatLngBounds(t,e){return t instanceof LatLngBounds?t:new LatLngBounds(t,e)}function LatLng$1(t,e,o){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==o&&(this.alt=+o)}function toLatLng(t,e,o){return t instanceof LatLng$1?t:isArray(t)&&"object"!=typeof t[0]?3===t.length?new LatLng$1(t[0],t[1],t[2]):2===t.length?new LatLng$1(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new LatLng$1(t.lat,"lng"in t?t.lng:t.lon,t.alt):null}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){return this.clone()._add(toPoint(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(toPoint(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new Point(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new Point(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=trunc(this.x),this.y=trunc(this.y),this},distanceTo:function(t){var e=(t=toPoint(t)).x-this.x,o=t.y-this.y;return Math.sqrt(e*e+o*o)},equals:function(t){return(t=toPoint(t)).x===this.x&&t.y===this.y},contains:function(t){return t=toPoint(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+formatNum(this.x)+", "+formatNum(this.y)+")"}},Bounds.prototype={extend:function(t){var e,o;if(!t)return this;if(t instanceof Point||"number"==typeof t[0]||"x"in t)e=o=toPoint(t);else if(e=(t=toBounds(t)).min,o=t.max,!e||!o)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)):(this.min=e.clone(),this.max=o.clone()),this},getCenter:function(t){return toPoint((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return toPoint(this.min.x,this.max.y)},getTopRight:function(){return toPoint(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,o;return(t="number"==typeof t[0]||t instanceof Point?toPoint(t):toBounds(t))instanceof Bounds?(e=t.min,o=t.max):e=o=t,e.x>=this.min.x&&o.x<=this.max.x&&e.y>=this.min.y&&o.y<=this.max.y},intersects:function(t){t=toBounds(t);var e=this.min,o=this.max,i=t.min,n=t.max,r=n.x>=e.x&&i.x<=o.x,a=n.y>=e.y&&i.y<=o.y;return r&&a},overlaps:function(t){t=toBounds(t);var e=this.min,o=this.max,i=t.min,n=t.max,r=n.x>e.x&&i.x<o.x,a=n.y>e.y&&i.y<o.y;return r&&a},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,o=this.max,i=Math.abs(e.x-o.x)*t,n=Math.abs(e.y-o.y)*t;return toBounds(toPoint(e.x-i,e.y-n),toPoint(o.x+i,o.y+n))},equals:function(t){return!!t&&(t=toBounds(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},LatLngBounds.prototype={extend:function(t){var e,o,i=this._southWest,n=this._northEast;if(t instanceof LatLng$1)e=t,o=t;else{if(!(t instanceof LatLngBounds))return t?this.extend(toLatLng(t)||toLatLngBounds(t)):this;if(e=t._southWest,o=t._northEast,!e||!o)return this}return i||n?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),n.lat=Math.max(o.lat,n.lat),n.lng=Math.max(o.lng,n.lng)):(this._southWest=new LatLng$1(e.lat,e.lng),this._northEast=new LatLng$1(o.lat,o.lng)),this},pad:function(t){var e=this._southWest,o=this._northEast,i=Math.abs(e.lat-o.lat)*t,n=Math.abs(e.lng-o.lng)*t;return new LatLngBounds(new LatLng$1(e.lat-i,e.lng-n),new LatLng$1(o.lat+i,o.lng+n))},getCenter:function(){return new LatLng$1((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new LatLng$1(this.getNorth(),this.getWest())},getSouthEast:function(){return new LatLng$1(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof LatLng$1||"lat"in t?toLatLng(t):toLatLngBounds(t);var e,o,i=this._southWest,n=this._northEast;return t instanceof LatLngBounds?(e=t.getSouthWest(),o=t.getNorthEast()):e=o=t,e.lat>=i.lat&&o.lat<=n.lat&&e.lng>=i.lng&&o.lng<=n.lng},intersects:function(t){t=toLatLngBounds(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),n=t.getNorthEast(),r=n.lat>=e.lat&&i.lat<=o.lat,a=n.lng>=e.lng&&i.lng<=o.lng;return r&&a},overlaps:function(t){t=toLatLngBounds(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),n=t.getNorthEast(),r=n.lat>e.lat&&i.lat<o.lat,a=n.lng>e.lng&&i.lng<o.lng;return r&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=toLatLngBounds(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},LatLng$1.prototype={equals:function(t,e){return!!t&&(t=toLatLng(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+formatNum(this.lat,t)+", "+formatNum(this.lng,t)+")"},distanceTo:function(t){return Earth.distance(this,toLatLng(t))},wrap:function(){return Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,o=e/Math.cos(Math.PI/180*this.lat);return toLatLngBounds([this.lat-e,this.lng-o],[this.lat+e,this.lng+o])},clone:function(){return new LatLng$1(this.lat,this.lng,this.alt)}};var CRS={latLngToPoint:function(t,e){var o=this.projection.project(t),i=this.scale(e);return this.transformation._transform(o,i)},pointToLatLng:function(t,e){var o=this.scale(e),i=this.transformation.untransform(t,o);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,o=this.scale(t);return new Bounds(this.transformation.transform(e.min,o),this.transformation.transform(e.max,o))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?wrapNum(t.lng,this.wrapLng,!0):t.lng;return new LatLng$1(this.wrapLat?wrapNum(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),o=this.wrapLatLng(e),i=e.lat-o.lat,n=e.lng-o.lng;if(0===i&&0===n)return t;var r=t.getSouthWest(),a=t.getNorthEast();return new LatLngBounds(new LatLng$1(r.lat-i,r.lng-n),new LatLng$1(a.lat-i,a.lng-n))}},Earth=extend({},CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var o=Math.PI/180,i=t.lat*o,n=e.lat*o,r=Math.sin((e.lat-t.lat)*o/2),a=Math.sin((e.lng-t.lng)*o/2),s=r*r+Math.cos(i)*Math.cos(n)*a*a,l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*l}}),earthRadius=6378137,SphericalMercator={R:earthRadius,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,o=this.MAX_LATITUDE,i=Math.max(Math.min(o,t.lat),-o),n=Math.sin(i*e);return new Point(this.R*t.lng*e,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(t){var e=180/Math.PI;return new LatLng$1((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=earthRadius*Math.PI;return new Bounds([-t,-t],[t,t])}()};function Transformation(t,e,o,i){if(isArray(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=o,this._d=i}function toTransformation(t,e,o,i){return new Transformation(t,e,o,i)}Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var EPSG3857=extend({},Earth,{code:"EPSG:3857",projection:SphericalMercator,transformation:function(){var t=.5/(Math.PI*SphericalMercator.R);return toTransformation(t,.5,-t,.5)}()}),EPSG900913=extend({},EPSG3857,{code:"EPSG:900913"});function svgCreate(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function pointsToPath(t,e){var o,i,n,r,a,s,l="";for(o=0,n=t.length;o<n;o++){for(i=0,r=(a=t[o]).length;i<r;i++)l+=(i?"L":"M")+(s=a[i]).x+" "+s.y;l+=e?Browser.svg?"z":"x":""}return l||"M0 0"}var style=document.documentElement.style,ie="ActiveXObject"in window,ielt9=ie&&!document.addEventListener,edge="msLaunchUri"in navigator&&!("documentMode"in document),webkit=userAgentContains("webkit"),android=userAgentContains("android"),android23=userAgentContains("android 2")||userAgentContains("android 3"),webkitVer=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10);android&&userAgentContains("Google")&&webkitVer<537&&window;var opera=!!window.opera,chrome=!edge&&userAgentContains("chrome");userAgentContains("gecko");var safari=!chrome&&userAgentContains("safari"),phantom=userAgentContains("phantom"),opera12="OTransition"in style;navigator.platform.indexOf("Win");var ie3d=ie&&"transition"in style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in style,any3d=!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d)&&!opera12&&!phantom,mobile="undefined"!=typeof orientation||userAgentContains("mobile"),msPointer=!window.PointerEvent&&window.MSPointerEvent,pointer=!(!window.PointerEvent&&!msPointer),touchNative="ontouchstart"in window||!!window.TouchEvent,touch=!window.L_NO_TOUCH&&(touchNative||pointer),mobileOpera=mobile&&opera,retina=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,passiveEvents=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",falseFn,e),window.removeEventListener("testPassiveEventSupport",falseFn,e)}catch(t){}return t}(),canvas$1=!!document.createElement("canvas").getContext,svg$1=!(!document.createElementNS||!svgCreate("svg").createSVGRect),inlineSvg=!!svg$1&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(t.firstChild&&t.firstChild.namespaceURI)}(),vml=!svg$1&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),mac=0===navigator.platform.indexOf("Mac"),linux=0===navigator.platform.indexOf("Linux");function userAgentContains(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Browser={ielt9,edge,chrome,safari,ie3d,any3d,mobile,msPointer,pointer,touch,touchNative,mobileOpera,retina,passiveEvents,canvas:canvas$1,svg:svg$1,vml,inlineSvg,mac,linux},POINTER_DOWN=Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE=Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP=Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL=Browser.msPointer?"MSPointerCancel":"pointercancel",pEvent={touchstart:POINTER_DOWN,touchmove:POINTER_MOVE,touchend:POINTER_UP,touchcancel:POINTER_CANCEL},handle={touchstart:_onPointerStart,touchmove:_handlePointer,touchend:_handlePointer,touchcancel:_handlePointer},_pointers={},_pointerDocListener=!1;function addPointerListener(t,e,o){return"touchstart"===e&&_addPointerDocListener(),handle[e]?(o=handle[e].bind(this,o),t.addEventListener(pEvent[e],o,!1),o):(console.warn("wrong event specified:",e),falseFn)}function removePointerListener(t,e,o){pEvent[e]?t.removeEventListener(pEvent[e],o,!1):console.warn("wrong event specified:",e)}function _globalPointerDown(t){_pointers[t.pointerId]=t}function _globalPointerMove(t){_pointers[t.pointerId]&&(_pointers[t.pointerId]=t)}function _globalPointerUp(t){delete _pointers[t.pointerId]}function _addPointerDocListener(){_pointerDocListener||(document.addEventListener(POINTER_DOWN,_globalPointerDown,!0),document.addEventListener(POINTER_MOVE,_globalPointerMove,!0),document.addEventListener(POINTER_UP,_globalPointerUp,!0),document.addEventListener(POINTER_CANCEL,_globalPointerUp,!0),_pointerDocListener=!0)}function _handlePointer(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var o in e.touches=[],_pointers)e.touches.push(_pointers[o]);e.changedTouches=[e],t(e)}}function _onPointerStart(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&preventDefault(e),_handlePointer(t,e)}function makeDblclick(t){var e,o,i={};for(o in t)e=t[o],i[o]=e&&e.bind?e.bind(t):e;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var delay=200;function addDoubleTapListener(t,e){t.addEventListener("dblclick",e);var o,i=0;function n(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var n=getPropagationPath(t);if(!n.some(function(t){return t instanceof HTMLLabelElement&&t.attributes.for})||n.some(function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement})){var r=Date.now();r-i<=delay?2===++o&&e(makeDblclick(t)):o=1,i=r}}}else o=t.detail}return t.addEventListener("click",n),{dblclick:e,simDblclick:n}}function removeDoubleTapListener(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var disableTextSelection,enableTextSelection,_userSelect,_outlineElement,_outlineStyle,TRANSFORM=testProp(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),TRANSITION=testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),TRANSITION_END="webkitTransition"===TRANSITION||"OTransition"===TRANSITION?TRANSITION+"End":"transitionend";function get(t){return"string"==typeof t?document.getElementById(t):t}function getStyle(t,e){var o=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!o||"auto"===o)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);o=i?i[e]:null}return"auto"===o?null:o}function create$1(t,e,o){var i=document.createElement(t);return i.className=e||"",o&&o.appendChild(i),i}function remove(t){var e=t.parentNode;e&&e.removeChild(t)}function empty(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function toFront(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function toBack(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function hasClass(t,e){if(void 0!==t.classList)return t.classList.contains(e);var o=getClass(t);return o.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(o)}function addClass(t,e){if(void 0!==t.classList)for(var o=splitWords(e),i=0,n=o.length;i<n;i++)t.classList.add(o[i]);else if(!hasClass(t,e)){var r=getClass(t);setClass(t,(r?r+" ":"")+e)}}function removeClass(t,e){void 0!==t.classList?t.classList.remove(e):setClass(t,trim((" "+getClass(t)+" ").replace(" "+e+" "," ")))}function setClass(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function getClass(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function setOpacity(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&_setOpacityIE(t,e)}function _setOpacityIE(t,e){var o=!1,i="DXImageTransform.Microsoft.Alpha";try{o=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),o?(o.Enabled=100!==e,o.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}function testProp(t){for(var e=document.documentElement.style,o=0;o<t.length;o++)if(t[o]in e)return t[o];return!1}function setTransform(t,e,o){var i=e||new Point(0,0);t.style[TRANSFORM]=(Browser.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(o?" scale("+o+")":"")}function setPosition(t,e){t._leaflet_pos=e,Browser.any3d?setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function getPosition(t){return t._leaflet_pos||new Point(0,0)}if("onselectstart"in document)disableTextSelection=function(){on(window,"selectstart",preventDefault)},enableTextSelection=function(){off(window,"selectstart",preventDefault)};else{var userSelectProperty=testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);disableTextSelection=function(){if(userSelectProperty){var t=document.documentElement.style;_userSelect=t[userSelectProperty],t[userSelectProperty]="none"}},enableTextSelection=function(){userSelectProperty&&(document.documentElement.style[userSelectProperty]=_userSelect,_userSelect=void 0)}}function disableImageDrag(){on(window,"dragstart",preventDefault)}function enableImageDrag(){off(window,"dragstart",preventDefault)}function preventOutline(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(restoreOutline(),_outlineElement=t,_outlineStyle=t.style.outlineStyle,t.style.outlineStyle="none",on(window,"keydown",restoreOutline))}function restoreOutline(){_outlineElement&&(_outlineElement.style.outlineStyle=_outlineStyle,_outlineElement=void 0,_outlineStyle=void 0,off(window,"keydown",restoreOutline))}function getSizedParentNode(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function getScale(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}function on(t,e,o,i){if(e&&"object"==typeof e)for(var n in e)addOne(t,n,e[n],o);else for(var r=0,a=(e=splitWords(e)).length;r<a;r++)addOne(t,e[r],o,i);return this}var eventsKey="_leaflet_events";function off(t,e,o,i){if(1===arguments.length)batchRemove(t),delete t[eventsKey];else if(e&&"object"==typeof e)for(var n in e)removeOne(t,n,e[n],o);else if(e=splitWords(e),2===arguments.length)batchRemove(t,function(t){return-1!==indexOf(e,t)});else for(var r=0,a=e.length;r<a;r++)removeOne(t,e[r],o,i);return this}function batchRemove(t,e){for(var o in t[eventsKey]){var i=o.split(/\d/)[0];e&&!e(i)||removeOne(t,i,null,null,o)}}var mouseSubst={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function addOne(t,e,o,i){var n=e+stamp(o)+(i?"_"+stamp(i):"");if(t[eventsKey]&&t[eventsKey][n])return this;var r=function(e){return o.call(i||t,e||window.event)},a=r;!Browser.touchNative&&Browser.pointer&&0===e.indexOf("touch")?r=addPointerListener(t,e,r):Browser.touch&&"dblclick"===e?r=addDoubleTapListener(t,r):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(mouseSubst[e]||e,r,!!Browser.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(r=function(e){e=e||window.event,isExternalTarget(t,e)&&a(e)},t.addEventListener(mouseSubst[e],r,!1)):t.addEventListener(e,a,!1):t.attachEvent("on"+e,r),t[eventsKey]=t[eventsKey]||{},t[eventsKey][n]=r}function removeOne(t,e,o,i,n){n=n||e+stamp(o)+(i?"_"+stamp(i):"");var r=t[eventsKey]&&t[eventsKey][n];if(!r)return this;!Browser.touchNative&&Browser.pointer&&0===e.indexOf("touch")?removePointerListener(t,e,r):Browser.touch&&"dblclick"===e?removeDoubleTapListener(t,r):"removeEventListener"in t?t.removeEventListener(mouseSubst[e]||e,r,!1):t.detachEvent("on"+e,r),t[eventsKey][n]=null}function stopPropagation(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function disableScrollPropagation(t){return addOne(t,"wheel",stopPropagation),this}function disableClickPropagation(t){return on(t,"mousedown touchstart dblclick contextmenu",stopPropagation),t._leaflet_disable_click=!0,this}function preventDefault(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function stop(t){return preventDefault(t),stopPropagation(t),this}function getPropagationPath(t){if(t.composedPath)return t.composedPath();for(var e=[],o=t.target;o;)e.push(o),o=o.parentNode;return e}function getMousePosition(t,e){if(!e)return new Point(t.clientX,t.clientY);var o=getScale(e),i=o.boundingClientRect;return new Point((t.clientX-i.left)/o.x-e.clientLeft,(t.clientY-i.top)/o.y-e.clientTop)}var wheelPxFactor=Browser.linux&&Browser.chrome?window.devicePixelRatio:Browser.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function getWheelDelta(t){return Browser.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/wheelPxFactor:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function isExternalTarget(t,e){var o=e.relatedTarget;if(!o)return!0;try{for(;o&&o!==t;)o=o.parentNode}catch(t){return!1}return o!==t}var DomEvent={__proto__:null,on,off,stopPropagation,disableScrollPropagation,disableClickPropagation,preventDefault,stop,getPropagationPath,getMousePosition,getWheelDelta,isExternalTarget,addListener:on,removeListener:off},PosAnimation=Evented.extend({run:function(t,e,o,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=requestAnimFrame(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,o=1e3*this._duration;e<o?this._runFrame(this._easeOut(e/o),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var o=this._startPos.add(this._offset.multiplyBy(t));e&&o._round(),setPosition(this._el,o),this.fire("step")},_complete:function(){cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Map$1=Evented.extend({options:{crs:EPSG3857,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=setOptions(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(toLatLng(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=TRANSITION&&Browser.any3d&&!Browser.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),on(this._proxy,TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,o){if((e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(toLatLng(t),e,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&!0!==o)&&(void 0!==o.animate&&(o.zoom=extend({animate:o.animate},o.zoom),o.pan=extend({animate:o.animate,duration:o.duration},o.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,o.zoom):this._tryAnimatedPan(t,o.pan)))return clearTimeout(this._sizeTimer),this;return this._resetView(t,e,o.pan&&o.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,o){var i=this.getZoomScale(e),n=this.getSize().divideBy(2),r=(t instanceof Point?t:this.latLngToContainerPoint(t)).subtract(n).multiplyBy(1-1/i),a=this.containerPointToLatLng(n.add(r));return this.setView(a,e,{zoom:o})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():toLatLngBounds(t);var o=toPoint(e.paddingTopLeft||e.padding||[0,0]),i=toPoint(e.paddingBottomRight||e.padding||[0,0]),n=this.getBoundsZoom(t,!1,o.add(i));if((n="number"==typeof e.maxZoom?Math.min(e.maxZoom,n):n)===1/0)return{center:t.getCenter(),zoom:n};var r=i.subtract(o).divideBy(2),a=this.project(t.getSouthWest(),n),s=this.project(t.getNorthEast(),n);return{center:this.unproject(a.add(s).divideBy(2).add(r),n),zoom:n}},fitBounds:function(t,e){if(!(t=toLatLngBounds(t)).isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(t,e);return this.setView(o.center,o.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=toPoint(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){addClass(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,o,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,o){if(!1===(o=o||{}).animate||!Browser.any3d)return this.setView(t,e,o);this._stop();var i=this.project(this.getCenter()),n=this.project(t),r=this.getSize(),a=this._zoom;t=toLatLng(t),e=void 0===e?a:e;var s=Math.max(r.x,r.y),l=s*this.getZoomScale(a,e),h=n.distanceTo(i)||1,d=1.42,c=2.0164;function u(t){var e=(l*l-s*s+(t?-1:1)*c*c*h*h)/(2*(t?l:s)*c*h),o=Math.sqrt(e*e+1)-e;return o<1e-9?-18:Math.log(o)}function p(t){return(Math.exp(t)-Math.exp(-t))/2}function m(t){return(Math.exp(t)+Math.exp(-t))/2}var g=u(0);function v(t){return s*(m(g)*(p(e=g+d*t)/m(e))-p(g))/c;var e}var f=Date.now(),T=(u(1)-g)/d,y=o.duration?1e3*o.duration:1e3*T*.8;return this._moveStart(!0,o.noMoveStart),function o(){var r=(Date.now()-f)/y,l=function(t){return 1-Math.pow(1-t,1.5)}(r)*T;r<=1?(this._flyToFrame=requestAnimFrame(o,this),this._move(this.unproject(i.add(n.subtract(i).multiplyBy(v(l)/h)),a),this.getScaleZoom(s/function(t){return s*(m(g)/m(g+d*t))}(l),a),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var o=this._getBoundsCenterZoom(t,e);return this.flyTo(o.center,o.zoom,e)},setMaxBounds:function(t){return t=toLatLngBounds(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var o=this.getCenter(),i=this._limitCenter(o,this._zoom,toLatLngBounds(t));return o.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){var o=toPoint((e=e||{}).paddingTopLeft||e.padding||[0,0]),i=toPoint(e.paddingBottomRight||e.padding||[0,0]),n=this.project(this.getCenter()),r=this.project(t),a=this.getPixelBounds(),s=toBounds([a.min.add(o),a.max.subtract(i)]),l=s.getSize();if(!s.contains(r)){this._enforcingBounds=!0;var h=r.subtract(s.getCenter()),d=s.extend(r).getSize().subtract(l);n.x+=h.x<0?-d.x:d.x,n.y+=h.y<0?-d.y:d.y,this.panTo(this.unproject(n),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=extend({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),i=e.divideBy(2).round(),n=o.divideBy(2).round(),r=i.subtract(n);return r.x||r.y?(t.animate&&t.pan?this.panBy(r):(t.pan&&this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:o})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=extend({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=bind(this._handleGeolocationResponse,this),o=bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,o,t):navigator.geolocation.getCurrentPosition(e,o,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,o=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new LatLng$1(t.coords.latitude,t.coords.longitude),o=e.toBounds(2*t.coords.accuracy),i=this._locateOptions;if(i.setView){var n=this.getBoundsZoom(o);this.setView(e,i.maxZoom?Math.min(n,i.maxZoom):n)}var r={latlng:e,bounds:o,timestamp:t.timestamp};for(var a in t.coords)"number"==typeof t.coords[a]&&(r[a]=t.coords[a]);this.fire("locationfound",r)}},addHandler:function(t,e){if(!e)return this;var o=this[t]=new e(this);return this._handlers.push(o),this.options[t]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(cancelAnimFrame(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)remove(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var o=create$1("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=o),o},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new LatLngBounds(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,o){t=toLatLngBounds(t),o=toPoint(o||[0,0]);var i=this.getZoom()||0,n=this.getMinZoom(),r=this.getMaxZoom(),a=t.getNorthWest(),s=t.getSouthEast(),l=this.getSize().subtract(o),h=toBounds(this.project(s,i),this.project(a,i)).getSize(),d=Browser.any3d?this.options.zoomSnap:1,c=l.x/h.x,u=l.y/h.y,p=e?Math.max(c,u):Math.min(c,u);return i=this.getScaleZoom(p,i),d&&(i=Math.round(i/(d/100))*(d/100),i=e?Math.ceil(i/d)*d:Math.floor(i/d)*d),Math.max(n,Math.min(r,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new Point(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var o=this._getTopLeftPoint(t,e);return new Bounds(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var o=this.options.crs;return e=void 0===e?this._zoom:e,o.scale(t)/o.scale(e)},getScaleZoom:function(t,e){var o=this.options.crs;e=void 0===e?this._zoom:e;var i=o.zoom(t*o.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(toLatLng(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(toPoint(t),e)},layerPointToLatLng:function(t){var e=toPoint(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(toLatLng(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(toLatLng(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(toLatLngBounds(t))},distance:function(t,e){return this.options.crs.distance(toLatLng(t),toLatLng(e))},containerPointToLayerPoint:function(t){return toPoint(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return toPoint(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(toPoint(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(toLatLng(t)))},mouseEventToContainerPoint:function(t){return getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");on(e,"scroll",this._onScroll,this),this._containerId=stamp(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Browser.any3d,addClass(t,"leaflet-container"+(Browser.touch?" leaflet-touch":"")+(Browser.retina?" leaflet-retina":"")+(Browser.ielt9?" leaflet-oldie":"")+(Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),setPosition(this._mapPane,new Point(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(addClass(t.markerPane,"leaflet-zoom-hide"),addClass(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,o){setPosition(this._mapPane,new Point(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,o)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,o,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?o&&o.pinch&&this.fire("zoom",o):((n||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[stamp(this._container)]=this;var e=t?off:on;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Browser.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){cancelAnimFrame(this._resizeRequest),this._resizeRequest=requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var o,i=[],n="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,a=!1;r;){if((o=this._targets[stamp(r)])&&("click"===e||"preclick"===e)&&this._draggableMoved(o)){a=!0;break}if(o&&o.listens(e,!0)){if(n&&!isExternalTarget(r,t))break;if(i.push(o),n)break}if(r===this._container)break;r=r.parentNode}return i.length||a||n||!this.listens(e,!0)||(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var o=t.type;"mousedown"===o&&preventOutline(e),this._fireDOMEvent(t,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,o){if("click"===t.type){var i=extend({},t);i.type="preclick",this._fireDOMEvent(i,i.type,o)}var n=this._findEventTargets(t,e);if(o){for(var r=[],a=0;a<o.length;a++)o[a].listens(e,!0)&&r.push(o[a]);n=r.concat(n)}if(n.length){"contextmenu"===e&&preventDefault(t);var s=n[0],l={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var h=s.getLatLng&&(!s._radius||s._radius<=10);l.containerPoint=h?this.latLngToContainerPoint(s.getLatLng()):this.mouseEventToContainerPoint(t),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=h?s.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(a=0;a<n.length;a++)if(n[a].fire(e,l,!0),l.originalEvent._stopped||!1===n[a].options.bubblingMouseEvents&&-1!==indexOf(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return getPosition(this._mapPane)||new Point(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var o=this.getSize()._divideBy(2);return this.project(t,e)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return toBounds([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,o){if(!o)return t;var i=this.project(t,e),n=this.getSize().divideBy(2),r=new Bounds(i.subtract(n),i.add(n)),a=this._getBoundsOffset(r,o,e);return Math.abs(a.x)<=1&&Math.abs(a.y)<=1?t:this.unproject(i.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var o=this.getPixelBounds(),i=new Bounds(o.min.add(t),o.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,o){var i=toBounds(this.project(e.getNorthEast(),o),this.project(e.getSouthWest(),o)),n=i.min.subtract(t.min),r=i.max.subtract(t.max);return new Point(this._rebound(n.x,-r.x),this._rebound(n.y,-r.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),o=this.getMaxZoom(),i=Browser.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(o,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var o=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(o))&&(this.panBy(o,e),!0)},_createAnimProxy:function(){var t=this._proxy=create$1("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=TRANSFORM,o=this._proxy.style[e];setTransform(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),o===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){remove(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();setTransform(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||!1===o.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==o.animate&&!this.getSize().contains(n))&&(requestAnimFrame(function(){this._moveStart(!0,o.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,o,i){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(bind(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}}),Control=Class.extend({options:{position:"topright"},initialize:function(t){setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),o=this.getPosition(),i=t._controlCorners[o];return addClass(e,"leaflet-control"),-1!==o.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(remove(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}});Map$1.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",o=this._controlContainer=create$1("div",e+"control-container",this._container);function i(i,n){var r=e+i+" "+e+n;t[i+n]=create$1("div",r,o)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)remove(this._controlCorners[t]);remove(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Layers=Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,o,i){return o<i?-1:i<o?1:0}},initialize:function(t,e,o){for(var i in setOptions(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Control.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(stamp(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){addClass(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(addClass(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):removeClass(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=create$1("div",t),o=this.options.collapsed;e.setAttribute("aria-haspopup",!0),disableClickPropagation(e),disableScrollPropagation(e);var i=this._section=create$1("section",t+"-list");o&&(this._map.on("click",this.collapse,this),on(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var n=this._layersLink=create$1("a",t+"-toggle",e);n.href="#",n.title="Layers",n.setAttribute("role","button"),on(n,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){preventDefault(t),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=create$1("div",t+"-base",i),this._separator=create$1("div",t+"-separator",i),this._overlaysList=create$1("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,o){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:o}),this.options.sortLayers&&this._layers.sort(bind(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;empty(this._baseLayersList),empty(this._overlaysList),this._layerControlInputs=[];var t,e,o,i,n=0;for(o=0;o<this._layers.length;o++)i=this._layers[o],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,n+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&n>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(stamp(t.target)),o=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;o&&this._map.fire(o,e)},_createRadioElement:function(t,e){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=o,i.firstChild},_addItem:function(t){var e,o=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers_"+stamp(this),i),this._layerControlInputs.push(e),e.layerId=stamp(t.layer),on(e,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var r=document.createElement("span");return o.appendChild(r),r.appendChild(e),r.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(o),this._checkDisabledLayers(),o},_onInputClick:function(){if(!this._preventClick){var t,e,o=this._layerControlInputs,i=[],n=[];this._handlingClick=!0;for(var r=o.length-1;r>=0;r--)t=o[r],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||n.push(e);for(r=0;r<n.length;r++)this._map.hasLayer(n[r])&&this._map.removeLayer(n[r]);for(r=0;r<i.length;r++)this._map.hasLayer(i[r])||this._map.addLayer(i[r]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,o=this._layerControlInputs,i=this._map.getZoom(),n=o.length-1;n>=0;n--)t=o[n],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,on(t,"click",preventDefault),this.expand();var e=this;setTimeout(function(){off(t,"click",preventDefault),e._preventClick=!1})}}),Zoom=Control.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",o=create$1("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",o,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,o,i,n){var r=create$1("a",o,i);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),disableClickPropagation(r),on(r,"click",stop),on(r,"click",n,this),on(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";removeClass(this._zoomInButton,e),removeClass(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(addClass(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(addClass(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});Map$1.mergeOptions({zoomControl:!0}),Map$1.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Zoom,this.addControl(this.zoomControl))});var Scale=Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",o=create$1("div",e),i=this.options;return this._addScales(i,e+"-line",o),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),o},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,o){t.metric&&(this._mScale=create$1("div",e,o)),t.imperial&&(this._iScale=create$1("div",e,o))},_update:function(){var t=this._map,e=t.getSize().y/2,o=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(o)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),o=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,o,e/t)},_updateImperial:function(t){var e,o,i,n=3.2808399*t;n>5280?(e=n/5280,o=this._getRoundNum(e),this._updateScale(this._iScale,o+" mi",o/e)):(i=this._getRoundNum(n),this._updateScale(this._iScale,i+" ft",i/n))},_updateScale:function(t,e,o){t.style.width=Math.round(this.options.maxWidth*o)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),o=t/e;return e*(o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1)}}),ukrainianFlag='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Attribution=Control.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Browser.inlineSvg?ukrainianFlag+" ":"")+"Leaflet</a>"},initialize:function(t){setOptions(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=create$1("div","leaflet-control-attribution"),disableClickPropagation(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var o=[];this.options.prefix&&o.push(this.options.prefix),t.length&&o.push(t.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});Map$1.mergeOptions({attributionControl:!0}),Map$1.addInitHook(function(){this.options.attributionControl&&(new Attribution).addTo(this)}),Control.Layers=Layers,Control.Zoom=Zoom,Control.Scale=Scale,Control.Attribution=Attribution;var Handler=Class.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Handler.addTo=function(t,e){return t.addHandler(e,this),this};var _lastCode,START=Browser.touch?"touchstart mousedown":"mousedown",Draggable=Evented.extend({options:{clickTolerance:3},initialize:function(t,e,o,i){setOptions(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=o},enable:function(){this._enabled||(on(this._dragStartTarget,START,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Draggable._dragging===this&&this.finishDrag(!0),off(this._dragStartTarget,START,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!hasClass(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)Draggable._dragging===this&&this.finishDrag();else if(!(Draggable._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(Draggable._dragging=this,this._preventOutline&&preventOutline(this._element),disableImageDrag(),disableTextSelection(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,o=getSizedParentNode(this._element);this._startPoint=new Point(e.clientX,e.clientY),this._startPos=getPosition(this._element),this._parentScale=getScale(o);var i="mousedown"===t.type;on(document,i?"mousemove":"touchmove",this._onMove,this),on(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,o=new Point(e.clientX,e.clientY)._subtract(this._startPoint);(o.x||o.y)&&(Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,addClass(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),setPosition(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){removeClass(document.body,"leaflet-dragging"),this._lastTarget&&(removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),off(document,"mousemove touchmove",this._onMove,this),off(document,"mouseup touchend touchcancel",this._onUp,this),enableImageDrag(),enableTextSelection();var e=this._moved&&this._moving;this._moving=!1,Draggable._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function clipPolygon(t,e,o){var i,n,r,a,s,l,h,d,c,u=[1,4,2,8];for(n=0,h=t.length;n<h;n++)t[n]._code=_getBitCode(t[n],e);for(a=0;a<4;a++){for(d=u[a],i=[],n=0,r=(h=t.length)-1;n<h;r=n++)s=t[n],l=t[r],s._code&d?l._code&d||((c=_getEdgeIntersection(l,s,d,e,o))._code=_getBitCode(c,e),i.push(c)):(l._code&d&&((c=_getEdgeIntersection(l,s,d,e,o))._code=_getBitCode(c,e),i.push(c)),i.push(s));t=i}return t}function polygonCenter(t,e){var o,i,n,r,a,s,l,h,d;if(!t||0===t.length)throw new Error("latlngs not passed");isFlat(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var c=toLatLng([0,0]),u=toLatLngBounds(t);u.getNorthWest().distanceTo(u.getSouthWest())*u.getNorthEast().distanceTo(u.getNorthWest())<1700&&(c=centroid(t));var p=t.length,m=[];for(o=0;o<p;o++){var g=toLatLng(t[o]);m.push(e.project(toLatLng([g.lat-c.lat,g.lng-c.lng])))}for(s=l=h=0,o=0,i=p-1;o<p;i=o++)n=m[o],r=m[i],a=n.y*r.x-r.y*n.x,l+=(n.x+r.x)*a,h+=(n.y+r.y)*a,s+=3*a;d=0===s?m[0]:[l/s,h/s];var v=e.unproject(toPoint(d));return toLatLng([v.lat+c.lat,v.lng+c.lng])}function centroid(t){for(var e=0,o=0,i=0,n=0;n<t.length;n++){var r=toLatLng(t[n]);e+=r.lat,o+=r.lng,i++}return toLatLng([e/i,o/i])}function simplify(t,e){if(!e||!t.length)return t.slice();var o=e*e;return t=_simplifyDP(t=_reducePoints(t,o),o)}function pointToSegmentDistance(t,e,o){return Math.sqrt(_sqClosestPointOnSegment(t,e,o,!0))}function closestPointOnSegment(t,e,o){return _sqClosestPointOnSegment(t,e,o)}function _simplifyDP(t,e){var o=t.length,i=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(o);i[0]=i[o-1]=1,_simplifyDPStep(t,i,e,0,o-1);var n,r=[];for(n=0;n<o;n++)i[n]&&r.push(t[n]);return r}function _simplifyDPStep(t,e,o,i,n){var r,a,s,l=0;for(a=i+1;a<=n-1;a++)(s=_sqClosestPointOnSegment(t[a],t[i],t[n],!0))>l&&(r=a,l=s);l>o&&(e[r]=1,_simplifyDPStep(t,e,o,i,r),_simplifyDPStep(t,e,o,r,n))}function _reducePoints(t,e){for(var o=[t[0]],i=1,n=0,r=t.length;i<r;i++)_sqDist(t[i],t[n])>e&&(o.push(t[i]),n=i);return n<r-1&&o.push(t[r-1]),o}function clipSegment(t,e,o,i,n){var r,a,s,l=i?_lastCode:_getBitCode(t,o),h=_getBitCode(e,o);for(_lastCode=h;;){if(!(l|h))return[t,e];if(l&h)return!1;s=_getBitCode(a=_getEdgeIntersection(t,e,r=l||h,o,n),o),r===l?(t=a,l=s):(e=a,h=s)}}function _getEdgeIntersection(t,e,o,i,n){var r,a,s=e.x-t.x,l=e.y-t.y,h=i.min,d=i.max;return 8&o?(r=t.x+s*(d.y-t.y)/l,a=d.y):4&o?(r=t.x+s*(h.y-t.y)/l,a=h.y):2&o?(r=d.x,a=t.y+l*(d.x-t.x)/s):1&o&&(r=h.x,a=t.y+l*(h.x-t.x)/s),new Point(r,a,n)}function _getBitCode(t,e){var o=0;return t.x<e.min.x?o|=1:t.x>e.max.x&&(o|=2),t.y<e.min.y?o|=4:t.y>e.max.y&&(o|=8),o}function _sqDist(t,e){var o=e.x-t.x,i=e.y-t.y;return o*o+i*i}function _sqClosestPointOnSegment(t,e,o,i){var n,r=e.x,a=e.y,s=o.x-r,l=o.y-a,h=s*s+l*l;return h>0&&((n=((t.x-r)*s+(t.y-a)*l)/h)>1?(r=o.x,a=o.y):n>0&&(r+=s*n,a+=l*n)),s=t.x-r,l=t.y-a,i?s*s+l*l:new Point(r,a)}function isFlat(t){return!isArray(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function _flat(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),isFlat(t)}function polylineCenter(t,e){var o,i,n,r,a,s,l,h;if(!t||0===t.length)throw new Error("latlngs not passed");isFlat(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var d=toLatLng([0,0]),c=toLatLngBounds(t);c.getNorthWest().distanceTo(c.getSouthWest())*c.getNorthEast().distanceTo(c.getNorthWest())<1700&&(d=centroid(t));var u=t.length,p=[];for(o=0;o<u;o++){var m=toLatLng(t[o]);p.push(e.project(toLatLng([m.lat-d.lat,m.lng-d.lng])))}for(o=0,i=0;o<u-1;o++)i+=p[o].distanceTo(p[o+1])/2;if(0===i)h=p[0];else for(o=0,r=0;o<u-1;o++)if(a=p[o],s=p[o+1],(r+=n=a.distanceTo(s))>i){l=(r-i)/n,h=[s.x-l*(s.x-a.x),s.y-l*(s.y-a.y)];break}var g=e.unproject(toPoint(h));return toLatLng([g.lat+d.lat,g.lng+d.lng])}var LineUtil={__proto__:null,simplify,pointToSegmentDistance,closestPointOnSegment,clipSegment,_getEdgeIntersection,_getBitCode,_sqClosestPointOnSegment,isFlat,_flat,polylineCenter},LonLat={project:function(t){return new Point(t.lng,t.lat)},unproject:function(t){return new LatLng$1(t.y,t.x)},bounds:new Bounds([-180,-90],[180,90])},Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:new Bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,o=this.R,i=t.lat*e,n=this.R_MINOR/o,r=Math.sqrt(1-n*n),a=r*Math.sin(i),s=Math.tan(Math.PI/4-i/2)/Math.pow((1-a)/(1+a),r/2);return i=-o*Math.log(Math.max(s,1e-10)),new Point(t.lng*e*o,i)},unproject:function(t){for(var e,o=180/Math.PI,i=this.R,n=this.R_MINOR/i,r=Math.sqrt(1-n*n),a=Math.exp(-t.y/i),s=Math.PI/2-2*Math.atan(a),l=0,h=.1;l<15&&Math.abs(h)>1e-7;l++)e=r*Math.sin(s),e=Math.pow((1-e)/(1+e),r/2),s+=h=Math.PI/2-2*Math.atan(a*e)-s;return new LatLng$1(s*o,t.x*o/i)}},index={__proto__:null,SphericalMercator},EPSG3395=extend({},Earth,{code:"EPSG:3395",projection:Mercator,transformation:function(){var t=.5/(Math.PI*Mercator.R);return toTransformation(t,.5,-t,.5)}()}),EPSG4326=extend({},Earth,{code:"EPSG:4326",projection:LonLat,transformation:toTransformation(1/180,1,-1/180,.5)}),Simple=extend({},CRS,{projection:LonLat,transformation:toTransformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var o=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(o*o+i*i)},infinite:!0});CRS.Earth=Earth,CRS.EPSG3395=EPSG3395,CRS.EPSG3857=EPSG3857,CRS.EPSG900913=EPSG900913,CRS.EPSG4326=EPSG4326,CRS.Simple=Simple;var Layer=Evented.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[stamp(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[stamp(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var o=this.getEvents();e.on(o,this),this.once("remove",function(){e.off(o,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});Map$1.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=stamp(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return stamp(t)in this._layers},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},_addLayers:function(t){for(var e=0,o=(t=t?isArray(t)?t:[t]:[]).length;e<o;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=stamp(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,o=this._getZoomSpan();for(var i in this._zoomBoundLayers){var n=this._zoomBoundLayers[i].options;t=void 0===n.minZoom?t:Math.min(t,n.minZoom),e=void 0===n.maxZoom?e:Math.max(e,n.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var LayerGroup=Layer.extend({initialize:function(t,e){var o,i;if(setOptions(this,e),this._layers={},t)for(o=0,i=t.length;o<i;o++)this.addLayer(t[o])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,o,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)(o=this._layers[e])[t]&&o[t].apply(o,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return stamp(t)}}),FeatureGroup=LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),LayerGroup.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),LayerGroup.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new LatLngBounds;for(var e in this._layers){var o=this._layers[e];t.extend(o.getBounds?o.getBounds():o.getLatLng())}return t}}),Icon=Class.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var o=this._getIconUrl(t);if(!o){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(o,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(t,e){var o=this.options,i=o[e+"Size"];"number"==typeof i&&(i=[i,i]);var n=toPoint(i),r=toPoint("shadow"===e&&o.shadowAnchor||o.iconAnchor||n&&n.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(o.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Browser.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),IconDefault=Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof IconDefault.imagePath&&(IconDefault.imagePath=this._detectIconPath()),(this.options.imagePath||IconDefault.imagePath)+Icon.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,o){var i=e.exec(t);return i&&i[o]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=create$1("div","leaflet-default-icon-path",document.body),e=getStyle(t,"background-image")||getStyle(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}),MarkerDrag=Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new Draggable(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),addClass(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,o=e._map,i=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,r=getPosition(e._icon),a=o.getPixelBounds(),s=o.getPixelOrigin(),l=toBounds(a.min._subtract(s).add(n),a.max._subtract(s).subtract(n));if(!l.contains(r)){var h=toPoint((Math.max(l.max.x,r.x)-l.max.x)/(a.max.x-l.max.x)-(Math.min(l.min.x,r.x)-l.min.x)/(a.min.x-l.min.x),(Math.max(l.max.y,r.y)-l.max.y)/(a.max.y-l.max.y)-(Math.min(l.min.y,r.y)-l.min.y)/(a.min.y-l.min.y)).multiplyBy(i);o.panBy(h,{animate:!1}),this._draggable._newPos._add(h),this._draggable._startPos._add(h),setPosition(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=requestAnimFrame(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(cancelAnimFrame(this._panRequest),this._panRequest=requestAnimFrame(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,o=e._shadow,i=getPosition(e._icon),n=e._map.layerPointToLatLng(i);o&&setPosition(o,i),e._latlng=n,t.latlng=n,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){cancelAnimFrame(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Marker=Layer.extend({options:{icon:new IconDefault,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){setOptions(this,e),this._latlng=toLatLng(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=toLatLng(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=t.icon.createIcon(this._icon),i=!1;o!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(o.title=t.title),"IMG"===o.tagName&&(o.alt=t.alt||"")),addClass(o,e),t.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&on(o,"focus",this._panOnFocus,this);var n=t.icon.createShadow(this._shadow),r=!1;n!==this._shadow&&(this._removeShadow(),r=!0),n&&(addClass(n,e),n.alt=""),this._shadow=n,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&r&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&off(this._icon,"focus",this._panOnFocus,this),remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&remove(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&setPosition(this._icon,t),this._shadow&&setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),MarkerDrag)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new MarkerDrag(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&setOpacity(this._icon,t),this._shadow&&setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,o=e.iconSize?toPoint(e.iconSize):toPoint(0,0),i=e.iconAnchor?toPoint(e.iconAnchor):toPoint(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:o.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Path=Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return setOptions(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),CircleMarker=Path.extend({options:{fill:!0,radius:10},initialize:function(t,e){setOptions(this,e),this._latlng=toLatLng(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=toLatLng(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Path.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,o=this._clickTolerance(),i=[t+o,e+o];this._pxBounds=new Bounds(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Circle=CircleMarker.extend({initialize:function(t,e,o){if("number"==typeof e&&(e=extend({},o,{radius:e})),setOptions(this,e),this._latlng=toLatLng(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Path.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,o=this._map,i=o.options.crs;if(i.distance===Earth.distance){var n=Math.PI/180,r=this._mRadius/Earth.R/n,a=o.project([e+r,t]),s=o.project([e-r,t]),l=a.add(s).divideBy(2),h=o.unproject(l).lat,d=Math.acos((Math.cos(r*n)-Math.sin(e*n)*Math.sin(h*n))/(Math.cos(e*n)*Math.cos(h*n)))/n;(isNaN(d)||0===d)&&(d=r/Math.cos(Math.PI/180*e)),this._point=l.subtract(o.getPixelOrigin()),this._radius=isNaN(d)?0:l.x-o.project([h,t-d]).x,this._radiusY=l.y-a.y}else{var c=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(c).x}this._updateBounds()}}),Polyline=Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){setOptions(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,o,i=1/0,n=null,r=_sqClosestPointOnSegment,a=0,s=this._parts.length;a<s;a++)for(var l=this._parts[a],h=1,d=l.length;h<d;h++){var c=r(t,e=l[h-1],o=l[h],!0);c<i&&(i=c,n=r(t,e,o))}return n&&(n.distance=Math.sqrt(i)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return polylineCenter(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=toLatLng(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new LatLngBounds,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return isFlat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],o=isFlat(t),i=0,n=t.length;i<n;i++)o?(e[i]=toLatLng(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new Point(t,t);this._rawPxBounds&&(this._pxBounds=new Bounds([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,o){var i,n,r=t[0]instanceof LatLng$1,a=t.length;if(r){for(n=[],i=0;i<a;i++)n[i]=this._map.latLngToLayerPoint(t[i]),o.extend(n[i]);e.push(n)}else for(i=0;i<a;i++)this._projectLatlngs(t[i],e,o)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,o,i,n,r,a,s,l=this._parts;for(e=0,i=0,n=this._rings.length;e<n;e++)for(o=0,r=(s=this._rings[e]).length;o<r-1;o++)(a=clipSegment(s[o],s[o+1],t,o,!0))&&(l[i]=l[i]||[],l[i].push(a[0]),a[1]===s[o+1]&&o!==r-2||(l[i].push(a[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,o=0,i=t.length;o<i;o++)t[o]=simplify(t[o],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var o,i,n,r,a,s,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,r=this._parts.length;o<r;o++)for(i=0,n=(a=(s=this._parts[o]).length)-1;i<a;n=i++)if((e||0!==i)&&pointToSegmentDistance(t,s[n],s[i])<=l)return!0;return!1}});Polyline._flat=_flat;var Polygon=Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return polygonCenter(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=Polyline.prototype._convertLatLngs.call(this,t),o=e.length;return o>=2&&e[0]instanceof LatLng$1&&e[0].equals(e[o-1])&&e.pop(),e},_setLatLngs:function(t){Polyline.prototype._setLatLngs.call(this,t),isFlat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return isFlat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,o=new Point(e,e);if(t=new Bounds(t.min.subtract(o),t.max.add(o)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,n=0,r=this._rings.length;n<r;n++)(i=clipPolygon(this._rings[n],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,o,i,n,r,a,s,l,h=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,s=this._parts.length;n<s;n++)for(r=0,a=(l=(e=this._parts[n]).length)-1;r<l;a=r++)o=e[r],i=e[a],o.y>t.y!=i.y>t.y&&t.x<(i.x-o.x)*(t.y-o.y)/(i.y-o.y)+o.x&&(h=!h);return h||Polyline.prototype._containsPoint.call(this,t,!0)}}),GeoJSON=FeatureGroup.extend({initialize:function(t,e){setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,o,i,n=isArray(t)?t:t.features;if(n){for(e=0,o=n.length;e<o;e++)((i=n[e]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var a=geometryToLayer(t,r);return a?(a.feature=asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&&r.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=extend({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function geometryToLayer(t,e){var o,i,n,r,a="Feature"===t.type?t.geometry:t,s=a?a.coordinates:null,l=[],h=e&&e.pointToLayer,d=e&&e.coordsToLatLng||coordsToLatLng;if(!s&&!a)return null;switch(a.type){case"Point":return _pointToLayer(h,t,o=d(s),e);case"MultiPoint":for(n=0,r=s.length;n<r;n++)o=d(s[n]),l.push(_pointToLayer(h,t,o,e));return new FeatureGroup(l);case"LineString":case"MultiLineString":return i=coordsToLatLngs(s,"LineString"===a.type?0:1,d),new Polyline(i,e);case"Polygon":case"MultiPolygon":return i=coordsToLatLngs(s,"Polygon"===a.type?1:2,d),new Polygon(i,e);case"GeometryCollection":for(n=0,r=a.geometries.length;n<r;n++){var c=geometryToLayer({geometry:a.geometries[n],type:"Feature",properties:t.properties},e);c&&l.push(c)}return new FeatureGroup(l);case"FeatureCollection":for(n=0,r=a.features.length;n<r;n++){var u=geometryToLayer(a.features[n],e);u&&l.push(u)}return new FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}}function _pointToLayer(t,e,o,i){return t?t(e,o):new Marker(o,i&&i.markersInheritOptions&&i)}function coordsToLatLng(t){return new LatLng$1(t[1],t[0],t[2])}function coordsToLatLngs(t,e,o){for(var i,n=[],r=0,a=t.length;r<a;r++)i=e?coordsToLatLngs(t[r],e-1,o):(o||coordsToLatLng)(t[r]),n.push(i);return n}function latLngToCoords(t,e){return void 0!==(t=toLatLng(t)).alt?[formatNum(t.lng,e),formatNum(t.lat,e),formatNum(t.alt,e)]:[formatNum(t.lng,e),formatNum(t.lat,e)]}function latLngsToCoords(t,e,o,i){for(var n=[],r=0,a=t.length;r<a;r++)n.push(e?latLngsToCoords(t[r],isFlat(t[r])?0:e-1,o,i):latLngToCoords(t[r],i));return!e&&o&&n.length>0&&n.push(n[0].slice()),n}function getFeature(t,e){return t.feature?extend({},t.feature,{geometry:e}):asFeature(e)}function asFeature(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var PointToGeoJSON={toGeoJSON:function(t){return getFeature(this,{type:"Point",coordinates:latLngToCoords(this.getLatLng(),t)})}};Marker.include(PointToGeoJSON),Circle.include(PointToGeoJSON),CircleMarker.include(PointToGeoJSON),Polyline.include({toGeoJSON:function(t){var e=!isFlat(this._latlngs);return getFeature(this,{type:(e?"Multi":"")+"LineString",coordinates:latLngsToCoords(this._latlngs,e?1:0,!1,t)})}}),Polygon.include({toGeoJSON:function(t){var e=!isFlat(this._latlngs),o=e&&!isFlat(this._latlngs[0]),i=latLngsToCoords(this._latlngs,o?2:e?1:0,!0,t);return e||(i=[i]),getFeature(this,{type:(o?"Multi":"")+"Polygon",coordinates:i})}}),LayerGroup.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(o){e.push(o.toGeoJSON(t).geometry.coordinates)}),getFeature(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var o="GeometryCollection"===e,i=[];return this.eachLayer(function(e){if(e.toGeoJSON){var n=e.toGeoJSON(t);if(o)i.push(n.geometry);else{var r=asFeature(n);"FeatureCollection"===r.type?i.push.apply(i,r.features):i.push(r)}}}),o?getFeature(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var ImageOverlay=Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,o){this._url=t,this._bounds=toLatLngBounds(e),setOptions(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&toFront(this._image),this},bringToBack:function(){return this._map&&toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=toLatLngBounds(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:create$1("img");addClass(e,"leaflet-image-layer"),this._zoomAnimated&&addClass(e,"leaflet-zoom-animated"),this.options.className&&addClass(e,this.options.className),e.onselectstart=falseFn,e.onmousemove=falseFn,e.onload=bind(this.fire,this,"load"),e.onerror=bind(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;setTransform(this._image,o,e)},_reset:function(){var t=this._image,e=new Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=e.getSize();setPosition(t,e.min),t.style.width=o.x+"px",t.style.height=o.y+"px"},_updateOpacity:function(){setOpacity(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}});ImageOverlay.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:create$1("video");if(addClass(e,"leaflet-image-layer"),this._zoomAnimated&&addClass(e,"leaflet-zoom-animated"),this.options.className&&addClass(e,this.options.className),e.onselectstart=falseFn,e.onmousemove=falseFn,e.onloadeddata=bind(this.fire,this,"load"),t){for(var o=e.getElementsByTagName("source"),i=[],n=0;n<o.length;n++)i.push(o[n].src);this._url=o.length>0?i:[e.src]}else{isArray(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var r=0;r<this._url.length;r++){var a=create$1("source");a.src=this._url[r],e.appendChild(a)}}}}),ImageOverlay.extend({_initImage:function(){var t=this._image=this._url;addClass(t,"leaflet-image-layer"),this._zoomAnimated&&addClass(t,"leaflet-zoom-animated"),this.options.className&&addClass(t,this.options.className),t.onselectstart=falseFn,t.onmousemove=falseFn}});var DivOverlay=Layer.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof LatLng$1||isArray(t))?(this._latlng=toLatLng(t),setOptions(this,e)):(setOptions(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&setOpacity(this._container,1),this.bringToFront(),this.options.interactive&&(addClass(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(setOpacity(this._container,0),this._removeTimeout=setTimeout(bind(remove,void 0,this._container),200)):remove(this._container),this.options.interactive&&(removeClass(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=toLatLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&toFront(this._container),this},bringToBack:function(){return this._map&&toBack(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof FeatureGroup){e=null;var o=this._source._layers;for(var i in o)if(o[i]._map){e=o[i];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=toPoint(this.options.offset),o=this._getAnchor();this._zoomAnimated?setPosition(this._container,t.add(o)):e=e.add(t).add(o);var i=this._containerBottom=-e.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});Map$1.include({_initOverlay:function(t,e,o,i){var n=e;return n instanceof t||(n=new t(i).setContent(e)),o&&n.setLatLng(o),n}}),Layer.include({_initOverlay:function(t,e,o,i){var n=o;return n instanceof t?(setOptions(n,i),n._source=this):(n=e&&!i?e:new t(i,this)).setContent(o),n}});var Popup=DivOverlay.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,DivOverlay.prototype.openOn.call(this,t)},onAdd:function(t){DivOverlay.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Path||this._source.on("preclick",stopPropagation))},onRemove:function(t){DivOverlay.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Path||this._source.off("preclick",stopPropagation))},getEvents:function(){var t=DivOverlay.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=create$1("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=create$1("div",t+"-content-wrapper",e);if(this._contentNode=create$1("div",t+"-content",o),disableClickPropagation(e),disableScrollPropagation(this._contentNode),on(e,"contextmenu",stopPropagation),this._tipContainer=create$1("div",t+"-tip-container",e),this._tip=create$1("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=create$1("a",t+"-close-button",e);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',on(i,"click",function(t){preventDefault(t),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var o=t.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),e.width=o+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,n=this.options.maxHeight,r="leaflet-popup-scrolled";n&&i>n?(e.height=n+"px",addClass(t,r)):removeClass(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();setPosition(this._container,e.add(o))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(getStyle(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+e,i=this._containerWidth,n=new Point(this._containerLeft,-o-this._containerBottom);n._add(getPosition(this._container));var r=t.layerPointToContainerPoint(n),a=toPoint(this.options.autoPanPadding),s=toPoint(this.options.autoPanPaddingTopLeft||a),l=toPoint(this.options.autoPanPaddingBottomRight||a),h=t.getSize(),d=0,c=0;r.x+i+l.x>h.x&&(d=r.x+i-h.x+l.x),r.x-d-s.x<0&&(d=r.x-s.x),r.y+o+l.y>h.y&&(c=r.y+o-h.y+l.y),r.y-c-s.y<0&&(c=r.y-s.y),(d||c)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([d,c]))}},_getAnchor:function(){return toPoint(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Map$1.mergeOptions({closePopupOnClick:!0}),Map$1.include({openPopup:function(t,e,o){return this._initOverlay(Popup,t,e,o).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Layer.include({bindPopup:function(t,e){return this._popup=this._initOverlay(Popup,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof FeatureGroup||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){stop(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof Path?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Tooltip=DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=DivOverlay.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=create$1("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+stamp(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,o,i=this._map,n=this._container,r=i.latLngToContainerPoint(i.getCenter()),a=i.layerPointToContainerPoint(t),s=this.options.direction,l=n.offsetWidth,h=n.offsetHeight,d=toPoint(this.options.offset),c=this._getAnchor();"top"===s?(e=l/2,o=h):"bottom"===s?(e=l/2,o=0):"center"===s?(e=l/2,o=h/2):"right"===s?(e=0,o=h/2):"left"===s?(e=l,o=h/2):a.x<r.x?(s="right",e=0,o=h/2):(s="left",e=l+2*(d.x+c.x),o=h/2),t=t.subtract(toPoint(e,o,!0)).add(d).add(c),removeClass(n,"leaflet-tooltip-right"),removeClass(n,"leaflet-tooltip-left"),removeClass(n,"leaflet-tooltip-top"),removeClass(n,"leaflet-tooltip-bottom"),addClass(n,"leaflet-tooltip-"+s),setPosition(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&setOpacity(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return toPoint(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Map$1.include({openTooltip:function(t,e,o){return this._initOverlay(Tooltip,t,e,o).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Layer.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Tooltip,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[e](o),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof FeatureGroup||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(on(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),on(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)})}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,o,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),o=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(o)),this._tooltip.setLatLng(i)}});var DivIcon=Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),o=this.options;if(o.html instanceof Element?(empty(e),e.appendChild(o.html)):e.innerHTML=!1!==o.html?o.html:"",o.bgPos){var i=toPoint(o.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Icon.Default=IconDefault;var GridLayer=Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof Point?t:new Point(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,o=this.getPane().children,i=-t(-1/0,1/0),n=0,r=o.length;n<r;n++)e=o[n].style.zIndex,o[n]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Browser.ielt9){setOpacity(this._container,this.options.opacity);var t=+new Date,e=!1,o=!1;for(var i in this._tiles){var n=this._tiles[i];if(n.current&&n.loaded){var r=Math.min(1,(t-n.loaded)/200);setOpacity(n.el,r),r<1?e=!0:(n.active?o=!0:this._onOpaqueTile(n),n.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),e&&(cancelAnimFrame(this._fadeFrame),this._fadeFrame=requestAnimFrame(this._updateOpacity,this))}},_onOpaqueTile:falseFn,_initContainer:function(){this._container||(this._container=create$1("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===t?(this._levels[o].el.style.zIndex=e-Math.abs(t-o),this._onUpdateLevel(o)):(remove(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var i=this._levels[t],n=this._map;return i||((i=this._levels[t]={}).el=create$1("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=n.project(n.unproject(n.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,n.getCenter(),n.getZoom()),falseFn(i.el.offsetWidth),this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:falseFn,_onRemoveLevel:falseFn,_onCreateLevel:falseFn,_pruneTiles:function(){if(this._map){var t,e,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)remove(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,o,i){var n=Math.floor(t/2),r=Math.floor(e/2),a=o-1,s=new Point(+n,+r);s.z=+a;var l=this._tileCoordsToKey(s),h=this._tiles[l];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),a>i&&this._retainParent(n,r,a,i))},_retainChildren:function(t,e,o,i){for(var n=2*t;n<2*t+2;n++)for(var r=2*e;r<2*e+2;r++){var a=new Point(n,r);a.z=o+1;var s=this._tileCoordsToKey(a),l=this._tiles[s];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),o+1<i&&this._retainChildren(n,r,o+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,o,i){var n=Math.round(e);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var r=this.options.updateWhenZooming&&n!==this._tileZoom;i&&!r||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(t),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var o in this._levels)this._setZoomTransform(this._levels[o],t,e)},_setZoomTransform:function(t,e,o){var i=this._map.getZoomScale(o,t.zoom),n=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,o)).round();Browser.any3d?setTransform(t.el,n,i):setPosition(t.el,n)},_resetGrid:function(){var t=this._map,e=t.options.crs,o=this._tileSize=this.getTileSize(),i=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/o.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/o.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/o.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/o.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,o=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(o,this._tileZoom),n=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*i);return new Bounds(n.subtract(r),n.add(r))},_update:function(t){var e=this._map;if(e){var o=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(i),r=n.getCenter(),a=[],s=this.options.keepBuffer,l=new Bounds(n.getBottomLeft().subtract([s,-s]),n.getTopRight().add([s,-s]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var h in this._tiles){var d=this._tiles[h].coords;d.z===this._tileZoom&&l.contains(new Point(d.x,d.y))||(this._tiles[h].current=!1)}if(Math.abs(o-this._tileZoom)>1)this._setView(t,o);else{for(var c=n.min.y;c<=n.max.y;c++)for(var u=n.min.x;u<=n.max.x;u++){var p=new Point(u,c);if(p.z=this._tileZoom,this._isValidTile(p)){var m=this._tiles[this._tileCoordsToKey(p)];m?m.current=!0:a.push(p)}}if(a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var g=document.createDocumentFragment();for(u=0;u<a.length;u++)this._addTile(a[u],g);this._level.el.appendChild(g)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var o=this._globalTileRange;if(!e.wrapLng&&(t.x<o.min.x||t.x>o.max.x)||!e.wrapLat&&(t.y<o.min.y||t.y>o.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return toLatLngBounds(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,o=this.getTileSize(),i=t.scaleBy(o),n=i.add(o);return[e.unproject(i,t.z),e.unproject(n,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),o=new LatLngBounds(e[0],e[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),o=new Point(+e[0],+e[1]);return o.z=+e[2],o},_removeTile:function(t){var e=this._tiles[t];e&&(remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){addClass(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=falseFn,t.onmousemove=falseFn,Browser.ielt9&&this.options.opacity<1&&setOpacity(t,this.options.opacity)},_addTile:function(t,e){var o=this._getTilePos(t),i=this._tileCoordsToKey(t),n=this.createTile(this._wrapCoords(t),bind(this._tileReady,this,t));this._initTile(n),this.createTile.length<2&&requestAnimFrame(bind(this._tileReady,this,t,null,n)),setPosition(n,o),this._tiles[i]={el:n,coords:t,current:!0},e.appendChild(n),this.fire("tileloadstart",{tile:n,coords:t})},_tileReady:function(t,e,o){e&&this.fire("tileerror",{error:e,tile:o,coords:t});var i=this._tileCoordsToKey(t);(o=this._tiles[i])&&(o.loaded=+new Date,this._map._fadeAnimated?(setOpacity(o.el,0),cancelAnimFrame(this._fadeFrame),this._fadeFrame=requestAnimFrame(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),e||(addClass(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Browser.ielt9||!this._map._fadeAnimated?requestAnimFrame(this._pruneTiles,this):setTimeout(bind(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new Point(this._wrapX?wrapNum(t.x,this._wrapX):t.x,this._wrapY?wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),TileLayer=GridLayer.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=setOptions(this,e)).detectRetina&&Browser.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var o=document.createElement("img");return on(o,"load",bind(this._tileOnLoad,this,e,o)),on(o,"error",bind(this._tileOnError,this,e,o)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(o.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(t),o},getTileUrl:function(t){var e={r:Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=o),e["-y"]=o}return template(this._url,extend(e,this.options))},_tileOnLoad:function(t,e){Browser.ielt9?setTimeout(bind(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,o){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(o,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=falseFn,e.onerror=falseFn,!e.complete)){e.src=emptyImageUrl;var o=this._tiles[t].coords;remove(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:o})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",emptyImageUrl),GridLayer.prototype._removeTile.call(this,t)},_tileReady:function(t,e,o){if(this._map&&(!o||o.getAttribute("src")!==emptyImageUrl))return GridLayer.prototype._tileReady.call(this,t,e,o)}}),TileLayerWMS=TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var o=extend({},this.defaultWmsParams);for(var i in e)i in this.options||(o[i]=e[i]);var n=(e=setOptions(this,e)).detectRetina&&Browser.retina?2:1,r=this.getTileSize();o.width=r.x*n,o.height=r.y*n,this.wmsParams=o},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),o=this._crs,i=toBounds(o.project(e[0]),o.project(e[1])),n=i.min,r=i.max,a=(this._wmsVersion>=1.3&&this._crs===EPSG4326?[n.y,n.x,r.y,r.x]:[n.x,n.y,r.x,r.y]).join(","),s=TileLayer.prototype.getTileUrl.call(this,t);return s+getParamString(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(t,e){return extend(this.wmsParams,t),e||this.redraw(),this}});TileLayer.WMS=TileLayerWMS;var Renderer=Layer.extend({options:{padding:.1},initialize:function(t){setOptions(this,t),stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var o=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,e),r=i.multiplyBy(-o).add(n).subtract(this._map._getNewPixelOrigin(t,e));Browser.any3d?setTransform(this._container,r,o):setPosition(this._container,r)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),o=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new Bounds(o,o.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Canvas=Renderer.extend({options:{tolerance:0},getEvents:function(){var t=Renderer.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");on(t,"mousemove",this._onMouseMove,this),on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),on(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){cancelAnimFrame(this._redrawRequest),delete this._ctx,remove(this._container),off(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Renderer.prototype._update.call(this);var t=this._bounds,e=this._container,o=t.getSize(),i=Browser.retina?2:1;setPosition(e,t.min),e.width=i*o.x,e.height=i*o.y,e.style.width=o.x+"px",e.style.height=o.y+"px",Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Renderer.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[stamp(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,o=e.next,i=e.prev;o?o.prev=i:this._drawLast=i,i?i.next=o:this._drawFirst=o,delete t._order,delete this._layers[stamp(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,o,i=t.options.dashArray.split(/[, ]+/),n=[];for(o=0;o<i.length;o++){if(e=Number(i[o]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Bounds,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var o=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var o,i,n,r,a=t._parts,s=a.length,l=this._ctx;if(s){for(l.beginPath(),o=0;o<s;o++){for(i=0,n=a[o].length;i<n;i++)r=a[o][i],l[i?"lineTo":"moveTo"](r.x,r.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,o=this._ctx,i=Math.max(Math.round(t._radius),1),n=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==n&&(o.save(),o.scale(1,n)),o.beginPath(),o.arc(e.x,e.y/n,i,0,2*Math.PI,!1),1!==n&&o.restore(),this._fillStroke(o,t)}},_fillStroke:function(t,e){var o=e.options;o.fill&&(t.globalAlpha=o.fillOpacity,t.fillStyle=o.fillColor||o.color,t.fill(o.fillRule||"evenodd")),o.stroke&&0!==o.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=o.opacity,t.lineWidth=o.weight,t.strokeStyle=o.color,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.stroke())},_onClick:function(t){for(var e,o,i=this._map.mouseEventToLayerPoint(t),n=this._drawFirst;n;n=n.next)(e=n.layer).options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(o=e);this._fireEvent(!!o&&[o],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(removeClass(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var o,i,n=this._drawFirst;n;n=n.next)(o=n.layer).options.interactive&&o._containsPoint(e)&&(i=o);i!==this._hoveredLayer&&(this._handleMouseOut(t),i&&(addClass(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(bind(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,o){this._map._fireDOMEvent(e,o||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;o&&(o.prev=i,i?i.next=o:o&&(this._drawFirst=o),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;i&&(i.next=o,o?o.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function canvas(t){return Browser.canvas?new Canvas(t):null}var vmlCreate=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),vmlMixin={_initContainer:function(){this._container=create$1("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=vmlCreate("shape");addClass(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=vmlCreate("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[stamp(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;remove(e),t.removeInteractiveTarget(e),delete this._layers[stamp(t)]},_updateStyle:function(t){var e=t._stroke,o=t._fill,i=t.options,n=t._container;n.stroked=!!i.stroke,n.filled=!!i.fill,i.stroke?(e||(e=t._stroke=vmlCreate("stroke")),n.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(n.removeChild(e),t._stroke=null),i.fill?(o||(o=t._fill=vmlCreate("fill")),n.appendChild(o),o.color=i.fillColor||i.color,o.opacity=i.fillOpacity):o&&(n.removeChild(o),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),o=Math.round(t._radius),i=Math.round(t._radiusY||o);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+o+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){toFront(t._container)},_bringToBack:function(t){toBack(t._container)}},create=Browser.vml?vmlCreate:svgCreate,SVG=Renderer.extend({_initContainer:function(){this._container=create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=create("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){remove(this._container),off(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Renderer.prototype._update.call(this);var t=this._bounds,e=t.getSize(),o=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,o.setAttribute("width",e.x),o.setAttribute("height",e.y)),setPosition(o,t.min),o.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=create("path");t.options.className&&addClass(e,t.options.className),t.options.interactive&&addClass(e,"leaflet-interactive"),this._updateStyle(t),this._layers[stamp(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){remove(t._path),t.removeInteractiveTarget(t._path),delete this._layers[stamp(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,o=t.options;e&&(o.stroke?(e.setAttribute("stroke",o.color),e.setAttribute("stroke-opacity",o.opacity),e.setAttribute("stroke-width",o.weight),e.setAttribute("stroke-linecap",o.lineCap),e.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?e.setAttribute("stroke-dasharray",o.dashArray):e.removeAttribute("stroke-dasharray"),o.dashOffset?e.setAttribute("stroke-dashoffset",o.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),o.fill?(e.setAttribute("fill",o.fillColor||o.color),e.setAttribute("fill-opacity",o.fillOpacity),e.setAttribute("fill-rule",o.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,pointsToPath(t._parts,e))},_updateCircle:function(t){var e=t._point,o=Math.max(Math.round(t._radius),1),i="a"+o+","+(Math.max(Math.round(t._radiusY),1)||o)+" 0 1,0 ",n=t._empty()?"M0 0":"M"+(e.x-o)+","+e.y+i+2*o+",0 "+i+2*-o+",0 ";this._setPath(t,n)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){toFront(t._path)},_bringToBack:function(t){toBack(t._path)}});function svg(t){return Browser.svg||Browser.vml?new SVG(t):null}Browser.vml&&SVG.include(vmlMixin),Map$1.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&canvas(t)||svg(t)}});var Rectangle=Polygon.extend({initialize:function(t,e){Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=toLatLngBounds(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});SVG.create=create,SVG.pointsToPath=pointsToPath,GeoJSON.geometryToLayer=geometryToLayer,GeoJSON.coordsToLatLng=coordsToLatLng,GeoJSON.coordsToLatLngs=coordsToLatLngs,GeoJSON.latLngToCoords=latLngToCoords,GeoJSON.latLngsToCoords=latLngsToCoords,GeoJSON.getFeature=getFeature,GeoJSON.asFeature=asFeature,Map$1.mergeOptions({boxZoom:!0});var BoxZoom=Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){remove(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),disableTextSelection(),disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),on(document,{contextmenu:stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=create$1("div","leaflet-zoom-box",this._container),addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new Bounds(this._point,this._startPoint),o=e.getSize();setPosition(this._box,e.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(remove(this._box),removeClass(this._container,"leaflet-crosshair")),enableTextSelection(),enableImageDrag(),off(document,{contextmenu:stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(bind(this._resetState,this),0);var e=new LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Map$1.addInitHook("addHandler","boxZoom",BoxZoom),Map$1.mergeOptions({doubleClickZoom:!0});var DoubleClickZoom=Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,o=e.getZoom(),i=e.options.zoomDelta,n=t.originalEvent.shiftKey?o-i:o+i;"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}});Map$1.addInitHook("addHandler","doubleClickZoom",DoubleClickZoom),Map$1.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Drag=Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){removeClass(this._map._container,"leaflet-grab"),removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=toLatLngBounds(this._map.options.maxBounds);this._offsetLimit=toBounds(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),o=this._initialWorldOffset,i=this._draggable._newPos.x,n=(i-e+o)%t+e-o,r=(i+e+o)%t-e-o,a=Math.abs(n+o)<Math.abs(r+o)?n:r;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,o=e.options,i=!o.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,a=o.easeLinearity,s=n.multiplyBy(a/r),l=s.distanceTo([0,0]),h=Math.min(o.inertiaMaxSpeed,l),d=s.multiplyBy(h/l),c=h/(o.inertiaDeceleration*a),u=d.multiplyBy(-c/2).round();u.x||u.y?(u=e._limitOffset(u,e.options.maxBounds),requestAnimFrame(function(){e.panBy(u,{duration:c,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});Map$1.addInitHook("addHandler","dragging",Drag),Map$1.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Keyboard=Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,o=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,o,i=this._panKeys={},n=this.keyCodes;for(e=0,o=n.left.length;e<o;e++)i[n.left[e]]=[-1*t,0];for(e=0,o=n.right.length;e<o;e++)i[n.right[e]]=[t,0];for(e=0,o=n.down.length;e<o;e++)i[n.down[e]]=[0,t];for(e=0,o=n.up.length;e<o;e++)i[n.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,o,i=this._zoomKeys={},n=this.keyCodes;for(e=0,o=n.zoomIn.length;e<o;e++)i[n.zoomIn[e]]=t;for(e=0,o=n.zoomOut.length;e<o;e++)i[n.zoomOut[e]]=-t},_addHooks:function(){on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,o=t.keyCode,i=this._map;if(o in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(e=this._panKeys[o],t.shiftKey&&(e=toPoint(e).multiplyBy(3)),i.options.maxBounds&&(e=i._limitOffset(toPoint(e),i.options.maxBounds)),i.options.worldCopyJump){var n=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(e)));i.panTo(n)}else i.panBy(e)}else if(o in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[o]);else{if(27!==o||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}stop(t)}}});Map$1.addInitHook("addHandler","keyboard",Keyboard),Map$1.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ScrollWheelZoom=Handler.extend({addHooks:function(){on(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){off(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=getWheelDelta(t),o=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(bind(this._performZoom,this),i),stop(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),o=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,r=o?Math.ceil(n/o)*o:n,a=t._limitZoom(e+(this._delta>0?r:-r))-e;this._delta=0,this._startTime=null,a&&("center"===t.options.scrollWheelZoom?t.setZoom(e+a):t.setZoomAround(this._lastMousePos,e+a))}});Map$1.addInitHook("addHandler","scrollWheelZoom",ScrollWheelZoom);var tapHoldDelay=600;Map$1.mergeOptions({tapHold:Browser.touchNative&&Browser.safari&&Browser.mobile,tapTolerance:15});var TapHold=Handler.extend({addHooks:function(){on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new Point(e.clientX,e.clientY),this._holdTimeout=setTimeout(bind(function(){this._cancel(),this._isTapValid()&&(on(document,"touchend",preventDefault),on(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),tapHoldDelay),on(document,"touchend touchcancel contextmenu",this._cancel,this),on(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){off(document,"touchend",preventDefault),off(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),off(document,"touchend touchcancel contextmenu",this._cancel,this),off(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new Point(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var o=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});o._simulated=!0,e.target.dispatchEvent(o)}});Map$1.addInitHook("addHandler","tapHold",TapHold),Map$1.mergeOptions({touchZoom:Browser.touch,bounceAtZoomLimits:!0});var TouchZoom=Handler.extend({addHooks:function(){addClass(this._map._container,"leaflet-touch-zoom"),on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){removeClass(this._map._container,"leaflet-touch-zoom"),off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(o.add(i)._divideBy(2))),this._startDist=o.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),on(document,"touchmove",this._onTouchMove,this),on(document,"touchend touchcancel",this._onTouchEnd,this),preventDefault(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]),n=o.distanceTo(i)/this._startDist;if(this._zoom=e.getScaleZoom(n,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&n<1||this._zoom>e.getMaxZoom()&&n>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===n)return}else{var r=o._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===n&&0===r.x&&0===r.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),cancelAnimFrame(this._animRequest);var a=bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=requestAnimFrame(a,this,!0),preventDefault(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,cancelAnimFrame(this._animRequest),off(document,"touchmove",this._onTouchMove,this),off(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Map$1.addInitHook("addHandler","touchZoom",TouchZoom),Map$1.BoxZoom=BoxZoom,Map$1.DoubleClickZoom=DoubleClickZoom,Map$1.Drag=Drag,Map$1.Keyboard=Keyboard,Map$1.ScrollWheelZoom=ScrollWheelZoom,Map$1.TapHold=TapHold,Map$1.TouchZoom=TouchZoom;class BackgroundWheelEL{constructor(){Object.freeze(this)}handleEvent(t){if(!t.target.classList.contains("travelnotes-background"))return;let e=theTravelNotesData.map.getZoom()+(0>t.deltaY?1:-1);e=Math.min(theTravelNotesData.map.getMaxZoom(),e),e=Math.max(theTravelNotesData.map.getMinZoom(),e),theTravelNotesData.map.setZoomAround(new Point(t.clientX,t.clientY),e)}}class BackgroundContextMenuEL{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault()}}class BackgroundDragOverEL{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(t){t.preventDefault(),Number.parseInt(t.dataTransfer.getData("ObjId"))===this.#Kt.objId&&(t.stopPropagation(),this.#Kt.moveDialog(t))}}class LatLng{#Y;#q;constructor(t,e){Object.freeze(this),this.#Y=t,this.#q=e}static clone(t){return new LatLng(t.lat,t.lng)}get latLng(){return[this.#Y,this.#q]}get lat(){return this.#Y}get lng(){return this.#q}}class LatLngDistance extends LatLng{#J;constructor(t,e,o){super(t,e),this.#J=o}get distance(){return this.#J}}class LatLngElevOnRoute extends LatLngDistance{#$;#nt;constructor(t,e,o,i,n){super(t,e,o),this.#$=i,this.#nt=n}get elev(){return this.#$}get ascent(){return this.#nt}}class Geometry{static get#Vt(){return 100}constructor(){Object.freeze(this)}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let o=0;const i=t.itinerary.itineraryPoints.iterator;for(;o<e&&!i.done;)o+=i.value.distance;const n=i.value;i.done;const r=(n.distance-o+e)/n.distance;return new LatLngElevOnRoute(n.lat+(i.value.lat-n.lat)*r,n.lng+(i.value.lng-n.lng)*r,e,n.elev+(i.value.elev-n.elev)*r,Geometry.#Vt*(i.value.elev-n.elev)/n.distance)}getClosestLatLngDistance(t,e){if(0===t.itinerary.itineraryPoints.length)return null;const o=t.itinerary.itineraryPoints.iterator;o.done;let i=Number.MAX_VALUE;const n=index.SphericalMercator.project(new LatLng$1(e[0],e[1]));let r=index.SphericalMercator.project(new LatLng$1(o.value.lat,o.value.lng)),a=null,s=DISTANCE.defaultValue,l=o.value.distance;for(;!o.done;){const t=index.SphericalMercator.project(new LatLng$1(o.value.lat,o.value.lng));let e=LineUtil.pointToSegmentDistance(n,r,t);e<i&&(i=e,a=index.SphericalMercator.unproject(LineUtil.closestPointOnSegment(n,r,t)),s=l-a.distanceTo(new LatLng$1(o.value.lat,o.value.lng))),l+=o.value.distance,r=t}return new LatLngDistance(a.lat,a.lng,s)}getLatLngBounds(t){const e=new LatLng$1(LAT_LNG.maxLat,LAT_LNG.maxLng),o=new LatLng$1(LAT_LNG.minLat,LAT_LNG.minLng);return t.forEach(t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),o.lat=Math.max(o.lat,t[0]),o.lng=Math.max(o.lng,t[1])}),new LatLngBounds(e,o)}getSquareBoundingBox(t,e){const o=t[0]*DEGREES.toRadians,i=e/6371e3*DEGREES.fromRadians,n=Math.acos((Math.cos(e/6371e3)-Math.sin(o)**2)/Math.cos(o)**2)*DEGREES.fromRadians;return new LatLngBounds(new LatLng$1(t[0]-i,t[1]-n),new LatLng$1(t[0]+i,t[1]+n))}project(t,e){const o=theTravelNotesData.map.project(new LatLng$1(t[0],t[1]),e);return[o.x,o.y]}screenCoordToLatLng(t,e){const o=theTravelNotesData.map.containerPointToLatLng(new Point(t,e));return[o.lat,o.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const theGeometry=new Geometry;class BackgroundTouchEL{#Ut;#Gt=!1;#Zt=!1;#Xt=0;#Yt=0;#qt;#Jt;#$t;#Qt;#te(t){if(this.#Gt&&(this.#Xt!==t.screenX||this.#Yt!==t.screenY)){theConfig.baseDialog.cancelTouchY>this.#Yt&&t.screenY<this.#Yt&&theConfig.baseDialog.cancelTouchX>this.#Xt&&this.#Ut.onCancel();const e=theGeometry.screenCoordToLatLng(this.#Xt,this.#Yt),o=theGeometry.screenCoordToLatLng(t.screenX,t.screenY);theTravelNotesData.map.panTo([this.#qt.lat+e[0]-o[0],this.#qt.lng+e[1]-o[1]])}}#ee(t){let e=Math.sqrt((t.item(0).clientX-t.item(1).clientX)**2+(t.item(0).clientY-t.item(1).clientY)**2),o=this.#Jt,i=e-this.#$t;theConfig.baseDialog.deltaZoomDistance<i?o++:-theConfig.baseDialog.deltaZoomDistance>i&&o--,o=Math.min(theTravelNotesData.map.getMaxZoom(),o),o=Math.max(theTravelNotesData.map.getMinZoom(),o),o!==this.#Jt&&(theTravelNotesData.map.setZoomAround(this.#Qt,o),this.#Jt=o,this.#$t=e)}#oe(t){this.#Gt&&1===t.changedTouches.length&&(this.#te(t.changedTouches.item(0)),this.#Gt=!1)}#ie(t){this.#Gt&&1===t.changedTouches.length?this.#te(t.changedTouches.item(0)):this.#Zt&&2===t.targetTouches.length&&this.#ee(t.targetTouches)}#ne(t){if(1===t.targetTouches.length){const e=t.changedTouches.item(0);this.#Xt=e.screenX,this.#Yt=e.screenY,this.#qt=theTravelNotesData.map.getCenter(),this.#Gt=!0,this.#Zt=!1}2===t.targetTouches.length&&(this.#Jt=theTravelNotesData.map.getZoom(),this.#Qt=new Point((t.targetTouches.item(0).clientX+t.targetTouches.item(1).clientX)/2,(t.targetTouches.item(0).clientY+t.targetTouches.item(1).clientY)/2),this.#$t=Math.sqrt((t.targetTouches.item(0).clientX-t.targetTouches.item(1).clientX)**2+(t.targetTouches.item(0).clientY-t.targetTouches.item(1).clientY)**2),this.#Gt=!1,this.#Zt=!0)}constructor(t){Object.freeze(this),this.#Ut=t}handleEvent(t){switch(t.currentTarget===t.target&&t.preventDefault(),t.type){case"touchstart":t.currentTarget===t.target&&this.#ne(t);break;case"touchmove":this.#ie(t);break;case"touchend":this.#oe(t)}}}class BackgroundMouseEL{static get LEFT_BUTTON(){return 0}#Gt=!1;#Xt=0;#Yt=0;#qt;#te(t){const e=theGeometry.screenCoordToLatLng(this.#Xt,this.#Yt),o=theGeometry.screenCoordToLatLng(t.screenX,t.screenY);theTravelNotesData.map.panTo([this.#qt.lat+e[0]-o[0],this.#qt.lng+e[1]-o[1]])}constructor(){Object.freeze(this)}handleEvent(t){switch(t.type){case"mousedown":t.button===BackgroundMouseEL.LEFT_BUTTON&&t.target===t.currentTarget&&(this.#Xt=t.screenX,this.#Yt=t.screenY,this.#qt=theTravelNotesData.map.getCenter(),this.#Gt=!0);break;case"mousemove":t.button===BackgroundMouseEL.LEFT_BUTTON&&this.#Gt&&(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),this.#te(t));break;case"mouseup":t.button!==BackgroundMouseEL.LEFT_BUTTON||!this.#Gt||this.#Xt===t.screenX&&this.#Yt===t.screenY||this.#te(t),this.#Gt=!1}}}let BaseDialogOptions$1=class{#re=null;#ae=null;#se=null;#le=null;#he=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#re=t.firstButtonText;break;case"secondButtonText":this.#ae=t.secondButtonText;break;case"selectOptionsData":this.#se=t.selectOptionsData;break;case"title":this.#le=t.title;break;case"text":this.#he=t.text}}get firstButtonText(){return this.#re}get secondButtonText(){return this.#ae}get selectOptionsData(){return this.#se}get title(){return this.#le}get text(){return this.#he}},TopBarDragStartEL$1=class{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(t){this.#Kt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Kt.objId)}},TopBarDragEndEL$1=class{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(t){this.#Kt.moveDialog(t)}},TopBarTouchEL$1=class{#Kt;#de;constructor(t){Object.freeze(this),this.#Kt=t,this.#de=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#de=!0,this.#Kt.setDragStartPoint(o);break;case"touchmove":this.#de=!1,t.preventDefault(),this.#Kt.moveDialog(o,e);break;case"touchend":this.#de||this.#Kt.moveDialog(o,e)}}}};class Device{static#ce="";setPointerType(t){t.isPrimary&&(Device.#ce=t.pointerType?t.pointerType:"")}static#ue(t){Device.#ce=t.pointerType,document.removeEventListener("pointerenter",Device.#ue,!0)}constructor(){Object.freeze(this),Device.#ce="",document.addEventListener("pointerenter",Device.#ue,!0)}get pointerType(){return Device.#ce}get screenAvailable(){const t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.right=0,t.style.height=1,t.style.width=1,document.body.appendChild(t);const e=t.getBoundingClientRect(),o=e.bottom,i=e.right;return document.body.removeChild(t),Object.freeze({height:o,width:i})}}const theDevice=new Device;let BaseDialogMover$1=class{#t;#pe;#me;#ge;#ve;#fe(t,e){const o=theDevice.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-40,n=o.height-this.dialogHTMLElement.offsetHeight-40;this.#ge=Math.max(Math.min(t,i),40),this.#ve=Math.max(Math.min(e,n),40)}#Te(){this.dialogHTMLElement.style.left=String(this.#ge)+"px",this.dialogHTMLElement.style.top=String(this.#ve)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#ge=40,this.#ve=40,this.#pe=0,this.#me=0,this.#t=ObjId.nextObjId}get onTop(){return 42>this.#ve}get objId(){return this.#t}centerDialog(){const t=theDevice.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(t.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(t.width-80,800))+"px",this.#ge=(t.width-this.dialogHTMLElement.clientWidth)/2,theConfig.baseDialog.touchTopScreen&&"touch"===theDevice.pointerType?this.#ve=40:this.#ve=(t.height-this.dialogHTMLElement.clientHeight)/2,this.#Te()}moveDialog(t,e){const o=this.#ge+t.screenX-this.#pe,i=this.#ve+t.screenY-this.#me;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#fe(t,e),this.#Te()}moveDialogToLastPosition(){this.moveDialogTo(this.#ge,this.#ve)}moveDialogToTopLeft(){this.#ge=40,this.#ve=40,this.#Te()}setDragStartPoint(t){this.#pe=t.screenX,this.#me=t.screenY}},BaseDialog$1=class{#ye;#Le;#Ee;#be;#_e;#Me;#we;#De;#Ce;#Ie=null;#Ne(){this.#ye=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-dialog-container"}),this.mover.dialogHTMLElement=this.#ye}#xe(){this.#Le=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-top-bar",draggable:!0},this.#ye),this.#De=new TopBarTouchEL$1(this.mover),this.#Le.addEventListener("touchstart",this.#De,!1),this.#Le.addEventListener("touchmove",this.#De,!1),this.#Le.addEventListener("touchend",this.#De,!1),this.#Le.addEventListener("touchcancel",this.#De,!1),this.#Me=new TopBarDragStartEL$1(this.mover),this.#Le.addEventListener("dragstart",this.#Me,!1),this.#we=new TopBarDragEndEL$1(this.mover),this.#Le.addEventListener("dragend",this.#we,!1),this.#Ee=theHTMLElementsFactory.create("div",{textContent:"âŒ",className:"travelnotes-base-dialog-cancel-button",title:theTranslator.getText("BaseDialog - Cancel")},this.#Le),theHTMLElementsFactory.create("div",{textContent:this.title,className:"travelnotes-base-dialog-title"},this.#Le),this.#Ce=new CancelButtonClickEL$1(this),this.#Ee.addEventListener("click",this.#Ce,!1),this.mover.topBarHTMLElement=this.#Le}#Pe(){this.toolbarHTMLElement&&theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-toolbar-container"},this.#ye).appendChild(this.toolbarHTMLElement)}#Se(){this.#be=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-content-container"},this.#ye),this.contentHTMLElements.forEach(t=>this.#be.appendChild(t))}#Oe(){this.#Ne(),this.#xe(),this.#Pe(),this.#Se()}constructor(t){Object.freeze(this),this.#Ie=new BaseDialogOptions$1(t)}#Ae(){this.#Le.removeEventListener("dragstart",this.#Me,!1),this.#Me=null,this.#Le.removeEventListener("dragend",this.#we,!1),this.#we=null,this.#Le.removeEventListener("touchstart",this.#De,!1),this.#Le.removeEventListener("touchmove",this.#De,!1),this.#Le.removeEventListener("touchend",this.#De,!1),this.#Le.removeEventListener("touchcancel",this.#De,!1),this.#De=null,this.#Ee.removeEventListener("click",this.#Ce,!1),this.#Ce=null,this.#_e&&(this.#_e=null)}get mover(){return this.#_e?this.#_e:this.#_e=new BaseDialogMover$1}onCancel(){this.#Ae()}onOk(){this.#Ae()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#Oe()}removeFromBackground(t){t.removeChild(this.#ye)}addToBackground(t){t.appendChild(this.#ye)}addToDialog(t){this.#ye.appendChild(t)}get options(){return this.#Ie}addCssClass(t){this.#ye.classList.add(t)}};class ModalBaseDialog extends BaseDialog$1{#Re;#ke;#Be;#je;#He;#Fe;#ze;#Ce;#Ue;#We;#Ke;#Ve;#Ge;#Ze;#Xe;#Ye;#qe(){this.#Re=theHTMLElementsFactory.create("div",{className:"travelnotes-background"})}#Je(){this.#Ve=new BackgroundDragOverEL(this.mover),this.#Re.addEventListener("dragover",this.#Ve,!1),this.#Xe=new BackgroundWheelEL,this.#Re.addEventListener("wheel",this.#Xe,{passive:!0}),this.#Ye=new BackgroundContextMenuEL,this.#Re.addEventListener("contextmenu",this.#Ye,!1),this.#Ge=new BackgroundTouchEL(this),this.#Re.addEventListener("touchstart",this.#Ge,!1),this.#Re.addEventListener("touchmove",this.#Ge,!1),this.#Re.addEventListener("touchend",this.#Ge,!1),this.#Re.addEventListener("touchcancel",this.#Ge,!1),this.#Ze=new BackgroundMouseEL,this.#Re.addEventListener("mouseup",this.#Ze,!1),this.#Re.addEventListener("mousemove",this.#Ze,!1),this.#Re.addEventListener("mousedown",this.#Ze,!1)}#$e(){this.#ke=theHTMLElementsFactory.create("div",{className:"travelnotes-modal-base-dialog-error-container travelnotes-hidden"}),this.addToDialog(this.#ke)}#Qe(){theHTMLElementsFactory.create("div",{className:"travelnotes-wait-animation-bullet"},theHTMLElementsFactory.create("div",{className:"travelnotes-wait-animation"},this.#Be=theHTMLElementsFactory.create("div",{className:"travelnotes-modal-base-dialog-wait-container travelnotes-hidden"}))),this.addToDialog(this.#Be)}#to(){const t=theHTMLElementsFactory.create("div",{className:"travelnotes-modal-base-dialog-footer-container"});this.addToDialog(t),this.#He=theHTMLElementsFactory.create("div",{textContent:this.options.firstButtonText||"ðŸ†—",className:"travelnotes-base-dialog-button"},t),this.#ze=new OkButtonClickEL(this),this.#He.addEventListener("click",this.#ze,!1),this.options.secondButtonText?(this.#Fe=theHTMLElementsFactory.create("div",{textContent:this.options.secondButtonText,className:"travelnotes-base-dialog-button"},t),this.#Ce=new CancelButtonClickEL$1(this),this.#Fe.addEventListener("click",this.#Ce,!1)):this.#Fe=null,this.footerHTMLElements.forEach(e=>t.appendChild(e))}#Oe(){this.#qe(),this.#Je(),this.#$e(),this.#Qe(),this.#to()}#Ae(){this.#Re.removeEventListener("wheel",this.#Xe,{passive:!0}),this.#Xe=null,this.#Re.removeEventListener("contextmenu",this.#Ye,!1),this.#Ye=null,this.#Re.removeEventListener("dragover",this.#Ve,!1),this.#Ve=null,this.#Re.removeEventListener("touchstart",this.#Ge,!1),this.#Re.removeEventListener("touchmove",this.#Ge,!1),this.#Re.removeEventListener("touchend",this.#Ge,!1),this.#Re.removeEventListener("touchcancel",this.#Ge,!1),this.#Ge=null,this.#Re.removeEventListener("mouseup",this.#Ze,!1),this.#Re.removeEventListener("mousemove",this.#Ze,!1),this.#Re.removeEventListener("mousedown",this.#Ze,!1),this.#Ze=null,document.removeEventListener("keydown",this.#Ke,{capture:!0}),this.#Ke=null,this.#He.removeEventListener("click",this.#ze,!1),this.#ze=null,this.options.secondButtonText&&(this.#Fe.removeEventListener("click",this.#Ce,!1),this.#Ce=null),document.body.removeChild(this.#Re)}#eo(t,e){this.#Ue=t,this.#We=e}constructor(t){super(t),this.#je=!0}show(){return super.show(),this.#Oe(),this.addCssClass("travelnotes-modal-base-dialog"),document.body.appendChild(this.#Re),this.addToBackground(this.#Re),this.#Ke=new ModalDialogKeyboardKeydownEL(this),document.addEventListener("keydown",this.#Ke,{capture:!0}),this.mover.centerDialog(),new Promise((t,e)=>this.#eo(t,e))}onCancel(){this.#Ae(),super.onCancel(),this.#We("Canceled by user")}canClose(){return!0}onOk(t){return!!this.canClose()&&(this.#Ue(t),this.#Ae(),super.onOk(),!0)}showWait(){this.#Be.classList.remove("travelnotes-hidden"),this.#He.classList.add("travelnotes-hidden")}hideWait(){this.#Be.classList.add("travelnotes-hidden"),this.#He.classList.remove("travelnotes-hidden")}showError(t){this.#ke.textContent="",theHTMLSanitizer.sanitizeToHtmlElement(t,this.#ke),this.#ke.classList.remove("travelnotes-hidden")}hideError(){this.#ke.textContent="",this.#ke.classList.add("travelnotes-hidden")}get footerHTMLElements(){return[]}get keyboardELEnabled(){return this.#je}set keyboardELEnabled(t){this.#je=t}}class OpenUnsecureFileChangeEL{#oo;constructor(t){Object.freeze(this),this.#oo=t}destructor(){this.#oo=null}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{this.#oo.addApiKeys(JSON.parse(e.result))}catch(t){this.#oo.showError(t.message),t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class RestoreFromUnsecureFileButtonClickEL{#oo;#io;constructor(t){Object.freeze(this),this.#oo=t,this.#io=new OpenUnsecureFileChangeEL(this.#oo)}destructor(){this.#oo=null,this.#io.destructor()}handleEvent(t){t.stopPropagation(),this.#oo.hideError(),theUtilities.openFile(this.#io,".json")}}class BaseControl{#no;constructor(){Object.freeze(this),this.#no=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-data-container"})}get controlHTMLElement(){return this.#no}}class EyePointerDownEL{#ro=null;constructor(t){Object.freeze(this),this.#ro=t}handleEvent(t){t.currentTarget.textContent="ðŸ‘€",t.preventDefault(),t.stopPropagation(),this.#ro.type="text"}}class EyePointerUpEL{#ro;constructor(t){Object.freeze(this),this.#ro=t}handleEvent(t){t.currentTarget.textContent="ðŸ‘ï¸",t.preventDefault(),t.stopPropagation(),this.#ro.type="password",this.#ro.focus()}}class PasswordControl extends BaseControl{#ro;#ao;#so;#lo;constructor(t){super(),this.#ro=theHTMLElementsFactory.create("input",{type:"password",dataset:{Name:t?.datasetName||"PasswordControl"}},this.controlHTMLElement),this.#ao=theHTMLElementsFactory.create("span",{id:"travelnotes-password-control-eye",textContent:"ðŸ‘ï¸"},this.controlHTMLElement),this.#so=new EyePointerDownEL(this.#ro),this.#lo=new EyePointerUpEL(this.#ro),this.#ao.addEventListener("pointerdown",this.#so,!1),this.#ao.addEventListener("pointerup",this.#lo,!1),this.#ao.addEventListener("pointerleave",this.#lo,!1),this.#ro.focus()}destructor(){this.#ao.removeEventListener("pointerdown",this.#so,!1),this.#ao.removeEventListener("pointerup",this.#lo,!1),this.#ao.removeEventListener("pointerleave",this.#lo,!1),this.#so=null,this.#lo=null}get value(){return this.#ro.value}focus(){this.#ro.focus()}}class PasswordDialog extends ModalBaseDialog{#ho;#do;static get#co(){return 12}constructor(t){super(),this.#do=t}#Ae(){this.#ho.destructor()}createContentHTML(){this.#ho=new PasswordControl}show(){const t=super.show();return this.#ho.focus(),t}canClose(){return this.hideError(),!(this.#do&&(this.#ho.value.length<PasswordDialog.#co||!this.#ho.value.match(/[0-9]+/)||!this.#ho.value.match(/[a-z]+/)||!this.#ho.value.match(/[A-Z]+/)||!this.#ho.value.match(/[^0-9a-zA-Z]/)))||(this.showError("<p>"+theTranslator.getText("PasswordDialog - Password rules1")+"</p><ul><li>"+theTranslator.getText("PasswordDialog - Password rules2")+"</li><li>"+theTranslator.getText("PasswordDialog - Password rules3")+"</li><li>"+theTranslator.getText("PasswordDialog - Password rules4")+"</li><li>"+theTranslator.getText("PasswordDialog - Password rules5")+"</li><li>"+theTranslator.getText("PasswordDialog - Password rules6")+"</li></ul>"),this.#ho.focus(),!1)}onCancel(){this.#Ae(),super.onCancel()}onOk(){super.onOk((new window.TextEncoder).encode(this.#ho.value))&&this.#Ae()}get contentHTMLElements(){return[this.#ho.controlHTMLElement]}get title(){return theTranslator.getText("PasswordDialog - password")}}class DataEncryptor{#uo;#po(t){return window.crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"])}#mo(t,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode(e),iterations:1e6,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}#go(t,e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(e.slice(0,16))},t,new Uint8Array(e.slice(16)))}#vo(t,e,o){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,o)}constructor(t){this.#uo=t||"Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette.",Object.freeze(this)}encryptData(t,e,o,i){let n=window.crypto.getRandomValues(new Uint8Array(16));i.then(t=>this.#po(t)).then(t=>this.#mo(t,this.#uo)).then(e=>this.#vo(e,n,t)).then(t=>{e(new Blob([n,new Uint8Array(t)],{type:"application/octet-stream"}))}).catch(o)}decryptData(t,e,o,i){i.then(t=>this.#po(t)).then(t=>this.#mo(t,this.#uo)).then(e=>this.#go(e,t)).then(e).catch(o)}}class DataEncryptorHandlers{#fo;constructor(t){this.#fo=t,Object.freeze(this)}destructor(){this.#fo=null}onErrorDecrypt(t){this.#fo.hideWait(),this.#fo.keyboardELEnabled=!0,t&&"Canceled by user"!==t&&this.#fo.showError(theTranslator.getText("DataEncryptorHandlers - An error occurs when reading the file"))}onOkDecrypt(t){try{this.#fo.addApiKeys(JSON.parse((new TextDecoder).decode(t)))}catch(t){return void this.onErrorDecrypt(t)}this.#fo.hideWait(),this.#fo.hideError(),this.#fo.keyboardELEnabled=!0}onOkEncrypt(t){this.#fo.hideError(),this.#fo.hideWait(),theUtilities.saveFile("ApiKeys",t),this.#fo.keyboardELEnabled=!0}onErrorEncrypt(){this.#fo.showError(theTranslator.getText("DataEncryptorHandlers - An error occurs when saving the keys")),this.#fo.hideWait(),this.#fo.keyboardELEnabled=!0}}class ReloadFromServerButtonClickEL{#oo;#To;constructor(t){Object.freeze(this),this.#oo=t,this.#To=new DataEncryptorHandlers(this.#oo)}destructor(){this.#To.destructor(),this.#oo=null}handleEvent(t){t.stopPropagation(),this.#oo.hideError(),this.#oo.showWait(),this.#oo.keyboardELEnabled=!1,fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then(t=>{200===t.status&&t.ok?t.arrayBuffer().then(t=>{(new DataEncryptor).decryptData(t,t=>{this.#To.onOkDecrypt(t)},t=>{this.#To.onErrorDecrypt(t)},new PasswordDialog(!1).show())}):this.#To.onErrorDecrypt(new Error("Invalid http status"))}).catch(t=>{this.#To.onErrorDecrypt(t),t instanceof Error&&console.error(t)})}}class OpenSecureFileChangeEL{#oo;#To;constructor(t){Object.freeze(this),this.#oo=t,this.#To=new DataEncryptorHandlers(this.#oo)}destructor(){this.#To.destructor(),this.#oo=null}handleEvent(t){t.stopPropagation(),this.#oo.showWait(),this.#oo.keyboardELEnabled=!1;const e=new FileReader;e.onload=()=>{(new DataEncryptor).decryptData(e.result,t=>{this.#To.onOkDecrypt(t)},t=>{this.#To.onErrorDecrypt(t)},new PasswordDialog(!1).show())},e.readAsArrayBuffer(t.target.files[0])}}class RestoreFromSecureFileButtonClickEL{#oo;#yo;constructor(t){Object.freeze(this),this.#oo=t,this.#yo=new OpenSecureFileChangeEL(this.#oo)}destructor(){this.#oo=null,this.#yo.destructor()}handleEvent(t){t.stopPropagation(),this.#oo.hideError(),theUtilities.openFile(this.#yo)}}class SaveToSecureFileButtonClickEL{#oo;#To;constructor(t){Object.freeze(this),this.#oo=t,this.#To=new DataEncryptorHandlers(this.#oo)}destructor(){this.#To.destructor(),this.#oo=null}handleEvent(t){t.stopPropagation(),this.#oo.validateApiKeys()&&(this.#oo.showWait(),this.#oo.keyboardELEnabled=!1,(new DataEncryptor).encryptData((new window.TextEncoder).encode(this.#oo.apiKeysJSON),t=>this.#To.onOkEncrypt(t),()=>this.#To.onErrorEncrypt(),new PasswordDialog(!0).show()))}}class SaveToUnsecureFileButtonClickEL{#oo;constructor(t){Object.freeze(this),this.#oo=t}destructor(){this.#oo=null}handleEvent(t){t.stopPropagation(),this.#oo.validateApiKeys()&&theUtilities.saveFile("ApiKeys.json",this.#oo.apiKeysJSON,"application/json")}}class NewApiKeyButtonClickEL{#Lo;constructor(t){Object.freeze(this),this.#Lo=t}destructor(){this.#Lo=null}handleEvent(t){t.stopPropagation(),this.#Lo.newApiKey()}}class ApiKeysDialogToolbar{#oo;#Lo;#Eo;#bo;#_o;#Mo;#wo;#Do;#Co;#Io;#No;#xo;#Po;#So;#Oo;#Ao;#Ro(){this.#bo=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("ApiKeysDialogToolbar - Reload from server"),textContent:"ðŸ”„"},this.#Eo),this.#No=new ReloadFromServerButtonClickEL(this.#oo),this.#bo.addEventListener("click",this.#No,!1)}#ko(){this.#_o=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("ApiKeysDialogToolbar - Save to file"),textContent:"ðŸ’¾"},this.#Eo),this.#xo=new SaveToSecureFileButtonClickEL(this.#oo),this.#_o.addEventListener("click",this.#xo,!1)}#Bo(){this.#Mo=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("ApiKeysDialogToolbar - Open file"),textContent:"ðŸ“‚"},this.#Eo),this.#Po=new RestoreFromSecureFileButtonClickEL(this.#oo),this.#Mo.addEventListener("click",this.#Po,!1)}#jo(){this.#wo=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("ApiKeysDialogToolbar - new api key"),textContent:"+"},this.#Eo),this.#So=new NewApiKeyButtonClickEL(this.#Lo),this.#wo.addEventListener("click",this.#So,!1)}#Ho(){this.#Do=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button travelnotes-api-keys-dialog-at-right-button",title:theTranslator.getText("ApiKeysDialogToolbar - Save to json file"),textContent:"ðŸ’¾"},this.#Eo),this.#Oo=new SaveToUnsecureFileButtonClickEL(this.#oo),this.#Do.addEventListener("click",this.#Oo,!1)}#Fo(){this.#Co=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("ApiKeysDialogToolbar - Open json file"),textContent:"ðŸ“‚"},this.#Eo),this.#Ao=new RestoreFromUnsecureFileButtonClickEL(this.#oo),this.#Co.addEventListener("click",this.#Ao,!1)}#zo(){window?.crypto?.subtle?.importKey&&window.isSecureContext&&(this.#Io&&this.#Ro(),this.#ko(),this.#Bo()),this.#jo(),theConfig.ApiKeysDialog.haveUnsecureButtons&&(this.#Ho(),this.#Fo())}constructor(t,e,o){this.#oo=t,this.#Lo=e,this.#Io=o,this.#Eo=theHTMLElementsFactory.create("div",{id:"travelnotes-api-keys-dialog-toolbar-container"}),this.#zo(),Object.freeze(this)}destructor(){this.#bo&&(this.#bo.removeEventListener("click",this.#No,!1),this.#No.destructor(),this.#No=null),this.#_o&&(this.#_o.removeEventListener("click",this.#xo,!1),this.#xo.destructor(),this.#xo=null),this.#Mo&&(this.#Mo.removeEventListener("click",this.#Po,!1),this.#Po.destructor(),this.#Po=null),this.#wo&&(this.#wo.removeEventListener("click",this.#So,!1),this.#So.destructor(),this.#So=null),this.#Do&&(this.#Do.removeEventListener("click",this.#Oo,!1),this.#Oo.destructor(),this.#Oo=null),this.#Co&&(this.#Co.removeEventListener("click",this.#Ao,!1),this.#Ao.destructor(),this.#Ao=null)}get toolbarHTMLElement(){return this.#Eo}}class ApiKeyControlRow{#Uo;#Wo;#Ko;#t;#Vo;#Go;constructor(t,e){Object.freeze(this),this.#Vo=e,this.#t=ObjId.nextObjId,this.#Uo=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"}),this.#Wo=theHTMLElementsFactory.create("input",{className:"travelnotes-api-keys-dialog-api-key-name travelnotes-api-keys-dialog-input",value:t.providerName,placeholder:theTranslator.getText("ApiKeyControlRow - provider name")},this.#Uo),this.#Ko=theHTMLElementsFactory.create("input",{className:"travelnotes-api-keys-dialog-api-key-value travelnotes-api-keys-dialog-input",value:t.providerKey,placeholder:theTranslator.getText("ApiKeyControlRow - api key"),type:theConfig.ApiKeysDialog.showApiKeys?"text":"password"},this.#Uo),this.#Go=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button travelnotes-api-keys-dialog-at-right-button",title:theTranslator.getText("ApiKeyControlRow - delete api key"),textContent:"âŒ",dataset:{ObjId:this.#t}},this.#Uo),this.#Go.addEventListener("click",this.#Vo,!1)}destructor(){this.#Go.removeEventListener("click",this.#Vo,!1)}get objId(){return this.#t}get HTMLElement(){return this.#Uo}get providerName(){return this.#Wo.value}get providerKey(){return this.#Ko.value}get apiKey(){return new ApiKey(this.#Wo.value,this.#Ko.value)}}class DeleteApiKeyButtonClickEL{#Lo;constructor(t){Object.freeze(this),this.#Lo=t}destructor(){this.#Lo=null}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#Lo.deleteApiKey(Number.parseInt(t.target.dataset.tanObjId))}}class ApiKeysControl extends BaseControl{#Zo;#Vo;constructor(){super(),this.#Zo=new Map,this.#Vo=new DeleteApiKeyButtonClickEL(this)}destructor(){this.#Zo.forEach(t=>t.destructor()),this.#Zo.clear(),this.#Vo.destructor(),this.#Vo=null}haveEmptyOrDuplicateValues(){let t=!1;const e=[];this.#Zo.forEach(o=>{t=t||""===o.providerName||""===o.providerKey,e.push(o.providerName)});let o=!1;return e.forEach(t=>{o=o||e.indexOf(t)!==e.lastIndexOf(t)}),{haveEmpty:t,haveDuplicate:o}}addApiKeys(t){this.#Zo.clear(),t.forEach(t=>{const e=new ApiKeyControlRow(t,this.#Vo);this.#Zo.set(e.objId,e)}),this.refreshApiKeys()}newApiKey(){const t=new ApiKey,e=new ApiKeyControlRow(t,this.#Vo);this.#Zo.set(e.objId,e),this.refreshApiKeys()}deleteApiKey(t){this.#Zo.get(t).destructor(),this.#Zo.delete(t),this.refreshApiKeys()}refreshApiKeys(){for(;this.controlHTMLElement.firstChild;)this.controlHTMLElement.removeChild(this.controlHTMLElement.firstChild);this.#Zo.forEach(t=>{this.controlHTMLElement.appendChild(t.HTMLElement)})}get apiKeys(){const t=[];return this.#Zo.forEach(e=>t.push(e.apiKey)),t}get apiKeysJSON(){const t=[];return this.#Zo.forEach(e=>t.push(e.apiKey.jsonObject)),JSON.stringify(t)}}class ErrorsUI{#Xo;#Yo;#qo;#Jo;#$o;#Qo;#ti(){this.#qo&&(clearTimeout(this.#qo),this.#qo=null),this.#Xo.classList.remove("travelnotes-errors-ui-"+this.#Qo),this.#Xo.classList.add("travelnotes-hidden"),this.#$o.classList.add("travelnotes-hidden"),this.#Yo.textContent=""}#eo(t,e){if(this.#Qo=e,!theConfig.errorsUI["show"+this.#Qo]||"Help"===e&&this.#Jo.checked)return;this.#qo&&(clearTimeout(this.#qo),this.#qo=null),this.#Yo.textContent="",theHTMLSanitizer.sanitizeToHtmlElement(t,this.#Yo),this.#Xo.classList.add("travelnotes-errors-ui-"+this.#Qo),this.#Xo.classList.remove("travelnotes-hidden");let o=theConfig.errorsUI.timeOut;"Help"===this.#Qo&&(this.#$o.classList.remove("travelnotes-hidden"),o=theConfig.errorsUI.helpTimeOut),this.#qo=setTimeout(()=>this.#ti(),o)}constructor(){Object.freeze(this)}createUI(){if(this.#Xo)return;this.#Xo=theHTMLElementsFactory.create("div",{id:"travelnotes-errors-ui",className:"travelnotes-hidden"},document.body);const t=theHTMLElementsFactory.create("div",null,this.#Xo);theHTMLElementsFactory.create("span",{id:"travelnotes-errors-ui-cancel-button",textContent:"âŒ"},t).addEventListener("click",()=>this.#ti(),!1),this.#Yo=theHTMLElementsFactory.create("div",{id:"travelnotes-errors ui-message"},this.#Xo),this.#$o=theHTMLElementsFactory.create("div",{id:"travelnotes-errors-ui-hide-help-checkbox-container",className:"travelnotes-hidden"},this.#Xo),this.#Jo=theHTMLElementsFactory.create("input",{id:"travelnotes-errors-ui-hide-help-checkbox",type:"checkbox",checked:!theConfig.errorsUI.showHelp},this.#$o),theHTMLElementsFactory.create("label",{id:"travelnotes-errors-ui-hide-help-label",htmlFor:"travelnotes-errors-ui-hide-help-checkbox",textContent:"Don't show help again"},this.#$o)}showError(t){this.#eo(t,"Error")}showWarning(t){this.#eo(t,"Warning")}showInfo(t){this.#eo(t,"Info")}showHelp(t){this.#eo(t,"Help")}}const theErrorsUI$1=new ErrorsUI;class ApiKeysDialog extends ModalBaseDialog{#ei;#Lo;#oi;#Io;constructor(t,e){super(),this.#oi=t,this.#Io=e}createContentHTML(){this.#Lo=new ApiKeysControl,this.#ei=new ApiKeysDialogToolbar(this,this.#Lo,this.#Io),this.#Lo.addApiKeys(this.#oi)}#Ae(){this.#Lo.destructor(),this.#ei.destructor(),this.#ei=null}validateApiKeys(){this.hideError();const t=this.#Lo.haveEmptyOrDuplicateValues();return t.haveEmpty?(this.showError(theTranslator.getText("ApiKeysDialog - empty api key name or value")),!1):!t.haveDuplicate||(this.showError(theTranslator.getText("ApiKeysDialog - duplicate api key name found")),!1)}show(){return theErrorsUI$1.showHelp("<p>"+theTranslator.getText("Help - Complete the ApiKeys1")+"</p><p>"+theTranslator.getText("Help - Complete the ApiKeys2")+"</p><p>"+theTranslator.getText("Help - Complete the ApiKeys3")+"</p>"),super.show()}canClose(){return this.validateApiKeys()}onCancel(){this.#Ae(),super.onCancel()}onOk(){super.onOk(this.#Lo.apiKeys)&&this.#Ae()}get title(){return theTranslator.getText("ApiKeysDialog - api keys")}get toolbarHTMLElement(){return this.#ei.toolbarHTMLElement}get contentHTMLElements(){return[this.#Lo.controlHTMLElement]}get apiKeysJSON(){return this.#Lo.apiKeysJSON}addApiKeys(t){this.#Lo.addApiKeys(t)}}class EventDispatcher{constructor(){Object.freeze(this)}dispatch(t,e){const o=new Event(t);e&&(o.data=e),document.dispatchEvent(o)}}const theEventDispatcher=new EventDispatcher;class PluginsManager{#ii;get providers(){return this.#ii}addProvider(t){const e=new t,o=e.name.toLowerCase();this.#ii.get(o)||this.#ii.set(o,e)}constructor(){Object.freeze(this),this.#ii=new Map}}const thePluginsManager=new PluginsManager;class ApiKeysManager{#Io=!1;#ni=new Map;#ri(t){this.#ai(JSON.parse((new TextDecoder).decode(t)))}#si(t){t instanceof Error&&console.error(t),t&&"Canceled by user"!==t&&theErrorsUI$1.showError(theTranslator.getText("ApiKeysManager - An error occurs when reading the ApiKeys file"))}#li(t){window.isSecureContext&&window?.crypto?.subtle?.importKey&&(new DataEncryptor).decryptData(t,t=>this.#ri(t),t=>this.#si(t),new PasswordDialog(!1).show())}#hi(t){return this.#ni.get(t.toLowerCase())}#di(t,e){this.#ni.set(t.toLowerCase(),e)}#ci(){if(!theUtilities.storageAvailable("sessionStorage"))return 0;let t=0;for(let e=0;e<sessionStorage.length;e++){const o=sessionStorage.key(e);o.match(/^\w*ProviderKey$/)&&(this.#di(o.replace("ProviderKey",""),atob(sessionStorage.getItem(o))),t++)}return thePluginsManager.providers.forEach(t=>{t.providerKeyNeeded&&(t.providerKey=this.#hi(t.name)||"")}),t}#ai(t){this.#ni.clear();const e=theUtilities.storageAvailable("sessionStorage")&&theConfig.ApiKeys.saveToSessionStorage;e&&sessionStorage.clear(),t.forEach(t=>{e&&sessionStorage.setItem(t.providerName.toLowerCase()+"ProviderKey",btoa(t.providerKey)),this.#di(t.providerName,t.providerKey)}),thePluginsManager.providers.forEach(t=>{t.providerKeyNeeded&&(t.providerKey=this.#hi(t.name)||"")}),theEventDispatcher.dispatch("providersadded")}constructor(){Object.freeze(this)}hasKey(t){return this.#ni.has(t.toLowerCase())}getUrl(t){if(t.providerKeyNeeded){const e=this.#ni.get(t.providerName.toLowerCase());return e?t.url.replace("{providerKey}",e):null}return t.url}setKeysFromServerFile(){let t=!1;0!==this.#ci()&&(theEventDispatcher.dispatch("providersadded"),t=!0),fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then(e=>{200===e.status&&e.ok&&(this.#Io=!0,t||e.arrayBuffer().then(t=>this.#li(t)))}).catch(t=>{t instanceof Error&&console.error(t)})}setKeysFromDialog(){const t=[];this.#ni.forEach((e,o)=>{t.push(new ApiKey(o,e))}),t.sort((t,e)=>t.providerName.localeCompare(e.providerName)),new ApiKeysDialog(t,this.#Io).show().then(t=>this.#ai(t)).catch(t=>{t instanceof Error&&console.error(t)})}addProvidersKeys(){thePluginsManager.providers.forEach((t,e)=>{t.userLanguage=theConfig.travelNotes.language,this.#ui(t,e)})}#ui(t,e){let o=this.#hi(e);t.providerKeyNeeded&&!o&&theUtilities.storageAvailable("sessionStorage")&&(o=sessionStorage.getItem(e),o&&(o=atob(o))),t.providerKeyNeeded&&o&&(t.providerKey=o)}}const theApiKeysManager=new ApiKeysManager;class SphericalTrigonometry{#pi(t){return(t+DEGREES.d540)%DEGREES.d360-DEGREES.d180}constructor(){Object.freeze(this)}arcFromSummitArcArc(t,e,o){return Math.acos(Math.cos(e)*Math.cos(o)+Math.sin(e)*Math.sin(o)*Math.cos(t))}summitFromArcArcArc(t,e,o){return Math.acos((Math.cos(o)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(t,e){if(t[0]===e[0]&&t[1]===e[1])return 0;const o=t[0]*DEGREES.toRadians,i=e[0]*DEGREES.toRadians,n=(this.#pi(e[1])-this.#pi(t[1]))*DEGREES.toRadians;return 6371e3*Math.acos(Math.sin(o)*Math.sin(i)+Math.cos(o)*Math.cos(i)*Math.cos(n))}}const theSphericalTrigonometry=new SphericalTrigonometry;class NoteAndRoute{#mi;#gi;constructor(t,e){Object.freeze(this),this.#mi=t,this.#gi=e}get note(){return this.#mi}get route(){return this.#gi}}class DataSearchEngineNearestRouteData{constructor(){Object.seal(this)}distance=Number.MAX_VALUE;route=null;distanceOnRoute=0;latLngOnRoute=[LAT_LNG.defaultValue,LAT_LNG.defaultValue]}class DataSearchEngine{#vi(t,e,o){if(t.objId!==theTravelNotesData.editedRouteObjId){const i=theGeometry.getClosestLatLngDistance(t,e);if(i){const n=theSphericalTrigonometry.pointsDistance(e,i.latLng);n<o.distance&&(o.route=t,o.distance=n,o.latLngOnRoute=i.latLng,o.distanceOnRoute=i.distance)}}}constructor(){Object.freeze(this)}getNearestRouteData(t){const e=new DataSearchEngineNearestRouteData;return theTravelNotesData.travel.routes.forEach(o=>this.#vi(o,t,e)),-1!==theTravelNotesData.editedRouteObjId&&this.#vi(theTravelNotesData.travel.editedRoute,t,e),Object.freeze(e)}getRoute(t){let e=null;return e=theTravelNotesData.travel.routes.getAt(t),e||t===theTravelNotesData.travel.editedRoute.objId&&(e=theTravelNotesData.travel.editedRoute),e}getNoteAndRoute(t){let e=null,o=null;if(e=theTravelNotesData.travel.notes.getAt(t),!e){const i=theTravelNotesData.travel.routes.iterator;for(;!i.done&&!e;)e=i.value.notes.getAt(t),e&&(o=i.value);e||(e=theTravelNotesData.travel.editedRoute.notes.getAt(t),e&&(o=theTravelNotesData.travel.editedRoute))}return new NoteAndRoute(e,o)}getWayPoint(t){let e=theTravelNotesData.travel.editedRoute.wayPoints.getAt(t);if(!e){const o=theTravelNotesData.travel.routes.iterator;for(;!o.done&&!e;)e=o.value.wayPoints.getAt(t)}return e}}const theDataSearchEngine=new DataSearchEngine;class GpxFactory{#fi;#Ti;#gi;static get#yi(){return"\n"}static get#Li(){return"\n\t"}static get#Ei(){return"\n\t\t"}static get#bi(){return"\n\t\t\t"}static get#_i(){return"\n\t\t\t\t"}#Mi(){this.#fi='<?xml version="1.0"?>'+GpxFactory.#yi,this.#fi+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="TravelNotes">'}#wi(t){return t.replaceAll("&","&amp;").replaceAll(/\u0027/g,"&apos;").replaceAll(/"/g,"&quot;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;")}#Di(){const t=this.#gi.wayPoints.iterator;for(;!t.done;)this.#fi+=GpxFactory.#Li+'<wpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+GpxFactory.#Ei+this.#Ti+GpxFactory.#Ei+"<name>"+this.#wi(t.value.fullName)+"</name>"+GpxFactory.#Li+"</wpt>"}#Ci(){this.#fi+=GpxFactory.#Li+"<rte>",this.#fi+=GpxFactory.#Ei+"<name>"+this.#wi(this.#gi.computedName)+"</name>";const t=this.#gi.itinerary.maneuvers.iterator;for(;!t.done;){const e=this.#gi.itinerary.itineraryPoints.getAt(t.value.itineraryPointObjId);this.#fi+=GpxFactory.#Ei+'<rtept lat="'+e.lat+'" lon="'+e.lng+'">'+GpxFactory.#bi+this.#Ti+GpxFactory.#bi+"<desc>"+this.#wi(t.value.instruction)+"</desc>"+GpxFactory.#Ei+"</rtept>"}this.#fi+=GpxFactory.#Li+"</rte>"}#Ii(){this.#fi+=GpxFactory.#Li+"<trk>",this.#fi+=GpxFactory.#Ei+"<name>"+this.#wi(this.#gi.computedName)+"</name>",this.#fi+=GpxFactory.#Ei+"<trkseg>";const t=this.#gi.itinerary.itineraryPoints.iterator;for(;!t.done;)this.#fi+=GpxFactory.#bi+'<trkpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+GpxFactory.#_i+this.#Ti+GpxFactory.#_i+"<ele>"+t.value.elev+"</ele>"+GpxFactory.#bi+"</trkpt>";this.#fi+=GpxFactory.#Ei+"</trkseg>",this.#fi+=GpxFactory.#Li+"</trk>"}#Ni(){this.#fi+=GpxFactory.#yi+"</gpx>"}#xi(){let t=(""===theTravelNotesData.travel.name?"":theTravelNotesData.travel.name+" - ")+this.#gi.computedName;""===t&&(t="TravelNote"),t+=".gpx",theUtilities.saveFile(t,this.#fi,"application/xml")}constructor(){Object.freeze(this)}routeToGpx(t){this.#gi=theDataSearchEngine.getRoute(t),this.#gi&&(this.#Ti="<time>"+(new Date).toISOString()+"</time>",this.#Mi(),this.#Di(),this.#Ci(),this.#Ii(),this.#Ni(),this.#xi())}}class CheckboxInputControl extends BaseControl{#Pi;constructor(t){super(),theHTMLElementsFactory.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Pi=theHTMLElementsFactory.create("input",{type:"checkbox",className:"travelnotes-checkbox-input-control-checkbox",checked:t?.checked,dataset:{Name:t?.datasetName||"CheckboxInputControl"}},this.controlHTMLElement),theHTMLElementsFactory.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get checked(){return this.#Pi.checked}set checked(t){this.#Pi.checked=t}}class Color{#Si;#Oi;#Ai;constructor(t,e,o){Object.freeze(this),this.#Si="number"==typeof t&&Color.MAX_COLOR>=t&&Color.MIN_COLOR<=t?t:Color.MAX_COLOR,this.#Oi="number"==typeof e&&Color.MAX_COLOR>=e&&Color.MIN_COLOR<=e?e:Color.MAX_COLOR,this.#Ai="number"==typeof o&&Color.MAX_COLOR>=o&&Color.MIN_COLOR<=o?o:Color.MAX_COLOR}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 255}static fromCss(t){let e=new Color;return e.cssColor=t,e}get red(){return this.#Si}set red(t){"number"==typeof t&&Color.MAX_COLOR>=t&&Color.MIN_COLOR<=t&&(this.#Si=t)}get green(){return this.#Oi}set green(t){"number"==typeof t&&Color.MAX_COLOR>=t&&Color.MIN_COLOR<=t&&(this.#Oi=t)}get blue(){return this.#Ai}set blue(t){"number"==typeof t&&Color.MAX_COLOR>=t&&Color.MIN_COLOR<=t&&(this.#Ai=t)}get cssColor(){return"#"+this.#Si.toString(16).padStart(2,"0")+this.#Oi.toString(16).padStart(2,"0")+this.#Ai.toString(16).padStart(2,"0")}set cssColor(t){"#"===t[0]?(this.#Si=Number.parseInt(t.substring(1,3),16),this.#Oi=Number.parseInt(t.substring(3,5),16),this.#Ai=Number.parseInt(t.substring(5,7),16)):"rgb"===t.substring(0,3)&&([this.#Si,this.#Oi,this.#Ai]=Array.from(t.match(/[0-9]{1,3}/g),t=>Number.parseInt(t)))}}class ColorButtonClickEL{#Ri=null;constructor(t){Object.freeze(this),this.#Ri=t}handleEvent(t){t.stopPropagation(),this.#Ri.onColorButtonClick(t.target.style["background-color"])}}class ColorButtonsControlElement{#ki;#Bi;#ji;static get#Hi(){return 6}static get#Fi(){return 6}static get#zi(){return 51}constructor(t){Object.freeze(this),this.#Bi=[],this.#ji=new ColorButtonClickEL(t),this.#ki=theHTMLElementsFactory.create("div",null,t.controlHTMLElement);for(let t=0;t<ColorButtonsControlElement.#Hi;++t){const t=theHTMLElementsFactory.create("div",null,this.#ki);for(let e=0;e<ColorButtonsControlElement.#Fi;++e){let e=theHTMLElementsFactory.create("div",{className:"travelnotes-color-control-cell-color"},t);e.addEventListener("click",this.#ji,!1),this.#Bi.push(e)}}}destructor(){this.#Bi.forEach(t=>{t.removeEventListener("click",this.#ji,!1)}),this.#ji=null}set red(t){let e=new Color(t,Color.MIN_COLOR,Color.MIN_COLOR);this.#Bi.forEach(t=>{t.style["background-color"]=e.cssColor,Color.MAX_COLOR<=e.green?(e.green=Color.MIN_COLOR,e.blue+=ColorButtonsControlElement.#zi):e.green+=ColorButtonsControlElement.#zi})}}class RedSliderInputEL{#Ri;#Ui;constructor(t,e){Object.freeze(this),this.#Ri=t,this.#Ui=e}handleEvent(t){t.stopPropagation();let e=t.target.valueAsNumber*this.#Ui;e=e-Math.floor(e)<Math.ceil(e)-e?Math.floor(e):Math.ceil(e),this.#Ri.onRedSliderInput(e)}}class RedSliderControlElement{#Wi;#Ki;static get#Vi(){return 100}static get#Gi(){return 20}constructor(t){this.#Ki=new RedSliderInputEL(t,Color.MAX_COLOR/RedSliderControlElement.#Vi),this.#Wi=theHTMLElementsFactory.create("input",{type:"range",value:0,min:0,max:RedSliderControlElement.#Vi,step:RedSliderControlElement.#Gi},theHTMLElementsFactory.create("div",null,t.controlHTMLElement)),this.#Wi.addEventListener("input",this.#Ki,!1),this.#Wi.focus()}destructor(){this.#Wi.removeEventListener("input",this.#Ki,!1),this.#Ki=null}}class RgbInputEL{#Ri;#Zi;constructor(t,e){Object.freeze(this),this.#Ri=t,this.#Zi=e}handleEvent(t){t.stopPropagation(),this.#Ri.onRgbInput(this.#Zi.cssColor)}}class RgbInputsControlElement{#Xi;#Yi;#qi;#Ji;#$i;#Qi(t){theHTMLElementsFactory.create("text",{value:t},this.#Xi);const e=theHTMLElementsFactory.create("input",{type:"number",className:"travelnotes-color-control-number-input",min:Color.MIN_COLOR,max:Color.MAX_COLOR},this.#Xi);return e.addEventListener("input",this.#$i,!1),e}constructor(t){Object.freeze(this),this.#$i=new RgbInputEL(t,this),this.#Xi=theHTMLElementsFactory.create("div",null,t.controlHTMLElement),this.#Yi=this.#Qi(theTranslator.getText("ColorControl - Red")),this.#qi=this.#Qi(theTranslator.getText("ColorControl - Green")),this.#Ji=this.#Qi(theTranslator.getText("ColorControl - Blue"))}destructor(){this.#Yi.removeEventListener("input",this.#$i,!1),this.#qi.removeEventListener("input",this.#$i,!1),this.#Ji.removeEventListener("input",this.#$i,!1),this.#$i=null}get cssColor(){return new Color(Number.parseInt(this.#Yi.value),Number.parseInt(this.#qi.value),Number.parseInt(this.#Ji.value)).cssColor}set cssColor(t){let e=Color.fromCss(t);this.#Yi.value=e.red,this.#qi.value=e.green,this.#Ji.value=e.blue}}class SampleControlElement{#tn;constructor(t){Object.freeze(this),this.#tn=theHTMLElementsFactory.create("div",{id:"travelnotes-color-control-color-sample"},t.controlHTMLElement)}get cssColor(){return this.#tn.style["background-color"]}set cssColor(t){this.#tn.style["background-color"]=t}}class ColorControl extends BaseControl{#en;#on;#Zi;#in;constructor(t){super(),t?.headerText&&""!==t.headerText&&theHTMLElementsFactory.create("div",{textContent:t.headerText},this.controlHTMLElement),this.controlHTMLElement.classList.add("travelnotes-color-control-container"),this.#en=new ColorButtonsControlElement(this),this.#en.red=0,this.#on=new RedSliderControlElement(this),this.#Zi=new RgbInputsControlElement(this),this.#Zi.cssColor=t?.cssColor||"#ff0000",this.#in=new SampleControlElement(this),this.#in.cssColor=t?.cssColor||"#ff0000"}destructor(){this.#en.destructor(),this.#on.destructor(),this.#Zi.destructor()}get cssColor(){return Color.fromCss(this.#in.cssColor).cssColor}onRedSliderInput(t){this.#en.red=t}onColorButtonClick(t){this.#Zi.cssColor=t,this.#in.cssColor=t}onRgbInput(t){this.#in.cssColor=t}}class NumberInputControl extends BaseControl{#Pi;constructor(t){super(),theHTMLElementsFactory.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Pi=theHTMLElementsFactory.create("input",{type:"number",className:"travelnotes-number-input-control-number-input",value:t?.value||0,min:t?.min||0,max:t?.max||Number.MAX_VALUE,dataset:{Name:t?.datasetName||"NumberInputControl"}},this.controlHTMLElement),theHTMLElementsFactory.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get value(){return Number.parseInt(this.#Pi.value)}set value(t){this.#Pi.value=t}}class TextInputControl extends BaseControl{#Pi;constructor(t,e){super(),theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row",textContent:t?.headerText||""},this.controlHTMLElement),this.#Pi=theHTMLElementsFactory.create("input",{className:"travelnotes-text-input-control-text-input",type:"text",dataset:{Name:t?.datasetName||"TextInputControl"},value:t?.value||""},theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),e?.controlFocus&&this.#Pi.addEventListener("focus",e.controlFocus),e?.controlInput&&this.#Pi.addEventListener("input",e.controlInput),e?.controlChange&&this.#Pi.addEventListener("change",e.controlChange)}destructor(t){t?.controlFocus&&this.#Pi.removeEventListener("focus",t.controlFocus),t?.controlInput&&this.#Pi.removeEventListener("input",t.controlInput)}get value(){return this.#Pi.value}set value(t){this.#Pi.value=t}}class SelectControl extends BaseControl{#nn;constructor(t){super(),theHTMLElementsFactory.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#nn=theHTMLElementsFactory.create("select",null,this.controlHTMLElement),t?.elements.forEach(t=>{this.#nn.add(theHTMLElementsFactory.create("option",{text:t}))})}get selectedIndex(){return this.#nn.selectedIndex}set selectedIndex(t){this.#nn.selectedIndex=t}}class RoutePropertiesDialog extends ModalBaseDialog{#gi;#Ri;#rn;#an;#sn;#ln;static get#hn(){return 1}static get#dn(){return 40}constructor(t){super(),this.#gi=t}createContentHTML(){this.#rn=new TextInputControl({headerText:theTranslator.getText("RoutePropertiesDialog - Name"),value:this.#gi.computedName}),this.#an=new NumberInputControl({beforeText:theTranslator.getText("RoutePropertiesDialog - Width"),value:this.#gi.width,min:RoutePropertiesDialog.#hn,max:RoutePropertiesDialog.#dn}),this.#sn=new SelectControl({beforeText:theTranslator.getText("RoutePropertiesDialog - Linetype"),elements:Array.from(theConfig.route.dashChoices,t=>t.text)}),this.#sn.selectedIndex=this.#gi.dashIndex<theConfig.route.dashChoices.length?this.#gi.dashIndex:0,this.#ln=new CheckboxInputControl({beforeText:theTranslator.getText("RoutePropertiesDialog - Chained route"),checked:this.#gi.chain}),this.#Ri=new ColorControl({cssColor:this.#gi.color,headerText:theTranslator.getText("RoutePropertiesDialog - Color")})}show(){let t=super.show();return this.addCssClass("travelNotes-route-properties-dialog"),t}onCancel(){this.#Ri.destructor(),super.onCancel()}onOk(){this.#gi.color=this.#Ri.cssColor,this.#gi.computedName!==this.#rn.value&&(this.#gi.name=this.#rn.value),this.#gi.width=this.#an.value,this.#gi.chain=this.#ln.checked,this.#gi.dashIndex=this.#sn.selectedIndex,this.#Ri.destructor(),super.onOk()}get title(){return theTranslator.getText("RoutePropertiesDialog - Route properties")}get contentHTMLElements(){return[this.#rn.controlHTMLElement,this.#an.controlHTMLElement,this.#sn.controlHTMLElement,this.#ln.controlHTMLElement,this.#Ri.controlHTMLElement]}}class RadioInputControl extends BaseControl{static#t=0;#cn;constructor(t){super(),this.#cn=[],theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row",textContent:t?.headerText||""},this.controlHTMLElement);let e="controlName"+ ++RadioInputControl.#t,o=0;t.buttons.forEach(i=>{let n="buttonId"+ ++RadioInputControl.#t,r=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement);this.#cn.push(theHTMLElementsFactory.create("input",{type:"radio",className:"travelnotes-radio-input-control-radio",checked:i.checked,id:n,name:e,value:String(o++),dataset:{Name:t?.datasetName||"RadioInputControl"}},r)),theHTMLElementsFactory.create("label",{htmlFor:n,innerText:i.label},r)})}get value(){let t=-1;return this.#cn.forEach(e=>{t=e.checked?Number.parseInt(e.value):t}),t}}class PrintRouteMapOptions{constructor(){Object.seal(this)}paperWidth=0;paperHeight=0;borderWidth=0;zoomFactor=0;printNotes=!1;firefoxBrowser=!0}class PrintRouteMapDialog extends ModalBaseDialog{#un;#pn;#mn;#gn;#vn;#fn;static get#Tn(){return 15}constructor(){super()}createContentHTML(){this.#un=new NumberInputControl({beforeText:theTranslator.getText("PrintRouteMapDialog - Paper width"),afterText:theTranslator.getText("PrintRouteMapDialog - Paper width units"),value:theConfig.printRouteMap.paperWidth}),this.#pn=new NumberInputControl({beforeText:theTranslator.getText("PrintRouteMapDialog - Paper height"),afterText:theTranslator.getText("PrintRouteMapDialog - Paper height units"),value:theConfig.printRouteMap.paperHeight}),this.#mn=new NumberInputControl({beforeText:theTranslator.getText("PrintRouteMapDialog - Border width"),afterText:theTranslator.getText("PrintRouteMapDialog - Border width units"),value:theConfig.printRouteMap.borderWidth}),this.#gn=new NumberInputControl({beforeText:theTranslator.getText("PrintRouteMapDialog - Zoom factor"),value:Math.min(theConfig.printRouteMap.zoomFactor,PrintRouteMapDialog.#Tn),min:theTravelNotesData.map.getMinZoom(),max:Math.min(theTravelNotesData.map.getMaxZoom(),PrintRouteMapDialog.#Tn)}),this.#vn=new CheckboxInputControl({afterText:theTranslator.getText("PrintRouteMapDialog - Print notes"),checked:theConfig.printRouteMap.printNotes}),this.#fn=new RadioInputControl({headerText:theTranslator.getText("PrintRouteMapDialog - Print with"),buttons:[{label:"Firefox",checked:theConfig.printRouteMap.firefoxBrowser},{label:theTranslator.getText("PrintRouteMapDialog - Another browser"),checked:!theConfig.printRouteMap.firefoxBrowser}]})}show(){let t=super.show();return this.addCssClass("travelnotes-print-route-map-dialog"),t}onOk(){const t=new PrintRouteMapOptions;t.paperWidth=this.#un.value,t.paperHeight=this.#pn.value,t.borderWidth=this.#mn.value,t.zoomFactor=this.#gn.value,t.printNotes=this.#vn.checked,t.firefoxBrowser=0===this.#fn.value,Object.freeze(t),super.onOk(t)}get contentHTMLElements(){return[this.#un.controlHTMLElement,this.#pn.controlHTMLElement,this.#mn.controlHTMLElement,this.#gn.controlHTMLElement,this.#vn.controlHTMLElement,this.#fn.controlHTMLElement]}get title(){return theTranslator.getText("PrintRouteMapDialog - Print")}}class BaseDialogOptions{#re=null;#ae=null;#se=null;#le=null;#he=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#re=t.firstButtonText;break;case"secondButtonText":this.#ae=t.secondButtonText;break;case"selectOptionsData":this.#se=t.selectOptionsData;break;case"title":this.#le=t.title;break;case"text":this.#he=t.text}}get firstButtonText(){return this.#re}get secondButtonText(){return this.#ae}get selectOptionsData(){return this.#se}get title(){return this.#le}get text(){return this.#he}}class CancelButtonClickEL{#Ut;constructor(t){Object.freeze(this),this.#Ut=t}handleEvent(){this.#Ut.onCancel()}}class TopBarDragStartEL{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(t){this.#Kt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Kt.objId)}}class TopBarDragEndEL{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(t){this.#Kt.moveDialog(t)}}class TopBarTouchEL{#Kt;#de;constructor(t){Object.freeze(this),this.#Kt=t,this.#de=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#de=!0,this.#Kt.setDragStartPoint(o);break;case"touchmove":this.#de=!1,t.preventDefault(),this.#Kt.moveDialog(o,e);break;case"touchend":this.#de||this.#Kt.moveDialog(o,e)}}}}class BaseDialogMover{#t;#pe;#me;#ge;#ve;#fe(t,e){const o=theDevice.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-40,n=o.height-this.dialogHTMLElement.offsetHeight-40;this.#ge=Math.max(Math.min(t,i),40),this.#ve=Math.max(Math.min(e,n),40)}#Te(){this.dialogHTMLElement.style.left=String(this.#ge)+"px",this.dialogHTMLElement.style.top=String(this.#ve)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#ge=40,this.#ve=40,this.#pe=0,this.#me=0,this.#t=ObjId.nextObjId}get onTop(){return 42>this.#ve}get objId(){return this.#t}centerDialog(){const t=theDevice.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(t.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(t.width-80,800))+"px",this.#ge=(t.width-this.dialogHTMLElement.clientWidth)/2,theConfig.baseDialog.touchTopScreen&&"touch"===theDevice.pointerType?this.#ve=40:this.#ve=(t.height-this.dialogHTMLElement.clientHeight)/2,this.#Te()}moveDialog(t,e){const o=this.#ge+t.screenX-this.#pe,i=this.#ve+t.screenY-this.#me;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#fe(t,e),this.#Te()}moveDialogToLastPosition(){this.moveDialogTo(this.#ge,this.#ve)}moveDialogToTopLeft(){this.#ge=40,this.#ve=40,this.#Te()}setDragStartPoint(t){this.#pe=t.screenX,this.#me=t.screenY}}class BaseDialog{#ye;#Le;#Ee;#be;#_e;#Me;#we;#De;#Ce;#Ie=null;#Ne(){this.#ye=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-dialog-container"}),this.mover.dialogHTMLElement=this.#ye}#xe(){this.#Le=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-top-bar",draggable:!0},this.#ye),this.#De=new TopBarTouchEL(this.mover),this.#Le.addEventListener("touchstart",this.#De,!1),this.#Le.addEventListener("touchmove",this.#De,!1),this.#Le.addEventListener("touchend",this.#De,!1),this.#Le.addEventListener("touchcancel",this.#De,!1),this.#Me=new TopBarDragStartEL(this.mover),this.#Le.addEventListener("dragstart",this.#Me,!1),this.#we=new TopBarDragEndEL(this.mover),this.#Le.addEventListener("dragend",this.#we,!1),this.#Ee=theHTMLElementsFactory.create("div",{textContent:"âŒ",className:"travelnotes-base-dialog-cancel-button",title:theTranslator.getText("BaseDialog - Cancel")},this.#Le),theHTMLElementsFactory.create("div",{textContent:this.title,className:"travelnotes-base-dialog-title"},this.#Le),this.#Ce=new CancelButtonClickEL(this),this.#Ee.addEventListener("click",this.#Ce,!1),this.mover.topBarHTMLElement=this.#Le}#Pe(){this.toolbarHTMLElement&&theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-toolbar-container"},this.#ye).appendChild(this.toolbarHTMLElement)}#Se(){this.#be=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-content-container"},this.#ye),this.contentHTMLElements.forEach(t=>this.#be.appendChild(t))}#Oe(){this.#Ne(),this.#xe(),this.#Pe(),this.#Se()}constructor(t){Object.freeze(this),this.#Ie=new BaseDialogOptions(t)}#Ae(){this.#Le.removeEventListener("dragstart",this.#Me,!1),this.#Me=null,this.#Le.removeEventListener("dragend",this.#we,!1),this.#we=null,this.#Le.removeEventListener("touchstart",this.#De,!1),this.#Le.removeEventListener("touchmove",this.#De,!1),this.#Le.removeEventListener("touchend",this.#De,!1),this.#Le.removeEventListener("touchcancel",this.#De,!1),this.#De=null,this.#Ee.removeEventListener("click",this.#Ce,!1),this.#Ce=null,this.#_e&&(this.#_e=null)}get mover(){return this.#_e?this.#_e:this.#_e=new BaseDialogMover}onCancel(){this.#Ae()}onOk(){this.#Ae()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#Oe()}removeFromBackground(t){t.removeChild(this.#ye)}addToBackground(t){t.appendChild(this.#ye)}addToDialog(t){this.#ye.appendChild(t)}get options(){return this.#Ie}addCssClass(t){this.#ye.classList.add(t)}}class NonModalBaseDialog extends BaseDialog{#Ve;#Je(){this.#Ve=new BackgroundDragOverEL(this.mover),document.body.addEventListener("dragover",this.#Ve,!1)}constructor(){super()}onCancel(){document.body.removeEventListener("dragover",this.#Ve,!1),this.#Ve=null,super.onCancel(),this.removeFromBackground(document.body)}show(){super.show(),this.#Je(),this.addToBackground(document.body)}}class SvgProfileBuilder{#gi;#yn;#Ln;#En;#bn;#_n;#Mn;static get PROFILE_MARGIN(){return 100}static get PROFILE_HEIGHT(){return 500}static get PROFILE_WIDTH(){return 1e3}static get X_DELTA_TEXT(){return 10}static get Y_DELTA_TEXT(){return 30}static get#wn(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}static get#Dn(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3]}static get#Cn(){return 8}static get#In(){return 4}static get#Nn(){return SvgProfileBuilder.PROFILE_MARGIN.toFixed(0)}static get#xn(){return(SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_WIDTH).toFixed(0)}static get#Pn(){return SvgProfileBuilder.PROFILE_MARGIN.toFixed(0)}static get#Sn(){return(SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_HEIGHT).toFixed(0)}static get#On(){return(SvgProfileBuilder.PROFILE_MARGIN-SvgProfileBuilder.X_DELTA_TEXT).toFixed(0)}static get#An(){return(SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_WIDTH+SvgProfileBuilder.X_DELTA_TEXT).toFixed(0)}static get#Rn(){return SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_HEIGHT+SvgProfileBuilder.PROFILE_MARGIN/2}#kn(){let t="",e=0,o=0,i=0;this.#gi.itinerary.itineraryPoints.forEach(n=>{o=(SvgProfileBuilder.PROFILE_MARGIN+this.#En*e).toFixed(0),i=(SvgProfileBuilder.PROFILE_MARGIN+this.#Ln*(this.#_n-n.elev)).toFixed(0),t+=o+","+i+" ",e+=n.distance});const n=document.createElementNS(SVG_NS,"polyline");n.setAttributeNS(null,"points",t),n.setAttributeNS(null,"class","travelnotes-route-svg-profile-profile-polyline"),this.#yn.appendChild(n)}#Bn(){const t=SvgProfileBuilder.#Nn+","+SvgProfileBuilder.#Pn+" "+SvgProfileBuilder.#Nn+","+SvgProfileBuilder.#Sn+" "+SvgProfileBuilder.#xn+","+SvgProfileBuilder.#Sn+" "+SvgProfileBuilder.#xn+","+SvgProfileBuilder.#Pn,e=document.createElementNS(SVG_NS,"polyline");e.setAttributeNS(null,"points",t),e.setAttributeNS(null,"class","travelnotes-route-svg-profile-frame-polyline"),this.#yn.appendChild(e)}#jn(){let t=Number.MAX_VALUE,e=0;SvgProfileBuilder.#wn.forEach(o=>{const i=Math.abs(this.#gi.distance/SvgProfileBuilder.#Cn-o);i<t&&(t=i,e=o)});let o=Math.ceil(this.#gi.chainedDistance/e)*e;for(;o<this.#gi.distance+this.#gi.chainedDistance;){const t=document.createElementNS(SVG_NS,"text");t.appendChild(document.createTextNode(DISTANCE.metersInKm<e||0<this.#gi.chainedDistance?o/DISTANCE.metersInKm+" km":o+" m ")),t.setAttributeNS(null,"class","travelnotes-route-svg-profile-dist-legend"),t.setAttributeNS(null,"x",SvgProfileBuilder.PROFILE_MARGIN+(o-this.#gi.chainedDistance)*this.#En),t.setAttributeNS(null,"y",SvgProfileBuilder.#Rn),t.setAttributeNS(null,"text-anchor","start"),this.#yn.appendChild(t),o+=e}}#Hn(){let t=Number.MAX_VALUE,e=0;SvgProfileBuilder.#Dn.forEach(o=>{const i=Math.abs(this.#Mn/SvgProfileBuilder.#In-o);i<t&&(t=i,e=o)});let o=Math.ceil(this.#bn/e)*e;for(;o<this.#_n;){const t=SvgProfileBuilder.PROFILE_MARGIN+(this.#_n-o)*this.#Ln,i=document.createElementNS(SVG_NS,"text");i.appendChild(document.createTextNode(o.toFixed(0))),i.setAttributeNS(null,"class","travelnotes-route-svg-profile-elev-legend"),i.setAttributeNS(null,"x",SvgProfileBuilder.#An),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"text-anchor","start"),this.#yn.appendChild(i);const n=document.createElementNS(SVG_NS,"text");n.appendChild(document.createTextNode(o.toFixed(0))),n.setAttributeNS(null,"class","travelnotes-route-svg-profile-elev-legend"),n.setAttributeNS(null,"x",SvgProfileBuilder.#On),n.setAttributeNS(null,"y",t),n.setAttributeNS(null,"text-anchor","end"),this.#yn.appendChild(n),o+=e}}#Fn(){this.#yn=document.createElementNS(SVG_NS,"svg"),this.#yn.setAttributeNS(null,"viewBox","0 0 "+(SvgProfileBuilder.PROFILE_WIDTH+2*SvgProfileBuilder.PROFILE_MARGIN)+" "+(SvgProfileBuilder.PROFILE_HEIGHT+2*SvgProfileBuilder.PROFILE_MARGIN)),this.#yn.setAttributeNS(null,"class","travelnotes-route-svg-profile-container")}constructor(){Object.freeze(this)}createSvg(t){return this.#gi=t,this.#bn=Number.MAX_VALUE,this.#_n=0,this.#gi.itinerary.itineraryPoints.forEach(t=>{this.#_n=Math.max(this.#_n,t.elev),this.#bn=Math.min(this.#bn,t.elev)}),this.#Mn=this.#_n-this.#bn,this.#Ln=SvgProfileBuilder.PROFILE_HEIGHT/this.#Mn,this.#En=SvgProfileBuilder.PROFILE_WIDTH/this.#gi.distance,this.#Fn(),this.#kn(),this.#Bn(),this.#Hn(),this.#jn(),this.#yn}}class ContextMenuKeyboardKeydownEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onKeydownKeyboard(t.key)}}class ContextMenuCancelButtonClickEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onCancelMenu()}}class MenuItemPointerLeaveEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onPointerLeaveMenuItem(t.currentTarget)}}class MenuItemPointerEnterEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onPointerEnterMenuItem(t.currentTarget)}}class MenuItemPointerDownEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onPointerDownMenuItem(t.currentTarget)}}class MenuItemPointerUpEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onPointerUpMenuItem(t.currentTarget)}}class MenuContainerPointerLeaveEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onPointerLeaveContainer()}}class MenuContainerPointerEnterEL{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onPointerEnterContainer()}}class BaseContextMenuOperator{static#Un=Object.freeze({get previousItem(){return-1},get firstItem(){return 0},get nextItem(){return 1},get lastItem(){return 2}});#Wn=null;#Kn;#Vn;#Gn;#Zn;#Xn;#Yn;#qn;#Jn;#$n=-1;#Qn=-1;#qo=null;#tr(){this.#Wn.menuItemHTMLElements.forEach(t=>{t.classList.remove("travelnotes-context-menu-menu-item-selected")})}#er(t){switch(this.#tr(),t){case BaseContextMenuOperator.#Un.previousItem:case BaseContextMenuOperator.#Un.nextItem:this.#$n+=t,-1===this.#$n&&(this.#$n=this.#Wn.menuItemHTMLElements.length-1),this.#Wn.menuItemHTMLElements.length===this.#$n&&(this.#$n=0);break;case BaseContextMenuOperator.#Un.firstItem:this.#$n=0;break;case BaseContextMenuOperator.#Un.lastItem:this.#$n=this.#Wn.menuItemHTMLElements.length-1}this.#Wn.menuItemHTMLElements[this.#$n].classList.add("travelnotes-context-menu-menu-item-selected")}constructor(t){Object.freeze(this),this.#Wn=t,this.#Kn=new ContextMenuKeyboardKeydownEL(this),this.#Vn=new MenuContainerPointerLeaveEL(this),this.#Gn=new MenuContainerPointerEnterEL(this),this.#Zn=new ContextMenuCancelButtonClickEL(this),this.#Xn=new MenuItemPointerLeaveEL(this),this.#Yn=new MenuItemPointerEnterEL(this),this.#qn=new MenuItemPointerDownEL(this),this.#Jn=new MenuItemPointerUpEL(this),document.addEventListener("keydown",this.#Kn,!0),this.#Wn.contextMenuContainer.addEventListener("pointerleave",this.#Vn),this.#Wn.contextMenuContainer.addEventListener("pointerenter",this.#Gn),this.#Wn.cancelButton.addEventListener("click",this.#Zn),this.#Wn.menuItemHTMLElements.forEach(t=>{t.addEventListener("pointerleave",this.#Xn),t.addEventListener("pointerenter",this.#Yn),t.addEventListener("pointerdown",this.#qn),t.addEventListener("pointerup",this.#Jn)})}destructor(){this.#qo&&(clearTimeout(this.#qo),this.#qo=null),document.removeEventListener("keydown",this.#Kn,!0),this.#Wn.contextMenuContainer.removeEventListener("pointerleave",this.#Vn),this.#Wn.contextMenuContainer.removeEventListener("pointerenter",this.#Gn),this.#Wn.cancelButton.removeEventListener("click",this.#Zn),this.#Wn.menuItemHTMLElements.forEach(t=>{t.removeEventListener("pointerleave",this.#Xn),t.removeEventListener("pointerenter",this.#Yn),t.removeEventListener("pointerdown",this.#qn),t.removeEventListener("pointerup",this.#Jn)}),this.#Kn=null,this.#Vn=null,this.#Gn=null,this.#Zn=null,this.#Xn=null,this.#Yn=null,this.#qn=null,this.#Jn=null,document.body.removeChild(this.#Wn.contextMenuContainer),this.#Wn=null}onPointerLeaveContainer(){this.#qo=setTimeout(()=>this.onCancelMenu(),theConfig.contextMenu.timeout)}onPointerEnterContainer(){this.#qo&&(clearTimeout(this.#qo),this.#qo=null)}onKeydownKeyboard(t){switch(t){case"Escape":case"Esc":this.onCancelMenu();break;case"ArrowDown":case"ArrowRight":case"Tab":this.#er(BaseContextMenuOperator.#Un.nextItem);break;case"ArrowUp":case"ArrowLeft":this.#er(BaseContextMenuOperator.#Un.previousItem);break;case"Home":this.#er(BaseContextMenuOperator.#Un.firstItem);break;case"End":this.#er(BaseContextMenuOperator.#Un.lastItem);break;case"Enter":if(-1===this.#$n||this.#Wn.menuItemHTMLElements[this.#$n].classList.contains("travelnotes-context-menu-menu-item-disabled"))return;this.#Wn.onOk(this.#$n)}}onCancelMenu(){this.#Wn.onCancel("Canceled by user")}selectItem(t){this.#Wn.menuItemHTMLElements[t].classList.contains("travelnotes-context-menu-menu-item-disabled")||this.#Wn.onOk(t)}onPointerLeaveMenuItem(t){t.classList.remove("travelnotes-context-menu-menu-item-selected"),this.#Qn=-1}onPointerEnterMenuItem(t){this.#tr(),this.#Qn=-1,this.#$n=Number.parseInt(t.dataset.tanObjId),t.classList.add("travelnotes-context-menu-menu-item-selected")}onPointerDownMenuItem(t){this.#Qn=Number.parseInt(t.dataset.tanObjId)}onPointerUpMenuItem(t){const e=Number.parseInt(t.dataset.tanObjId);e===this.#Qn&&this.selectItem(e)}}class BaseContextMenu{#or;#ir;#nr;#rr;#ar;static#sr=null;#lr;#hr;#dr;#Ee;#cr;#zn;static get#ur(){return 20}static get isActive(){return Boolean(BaseContextMenu.#sr)}#pr(){this.#dr=theHTMLElementsFactory.create("div",{className:"travelnotes-context-menu-container"},document.body)}#mr(){this.#Ee=theHTMLElementsFactory.create("div",{textContent:"âŒ",className:"travelnotes-context-menu-cancel-button",title:theTranslator.getText("BaseContextMenu - Close")},this.#dr)}#gr(){this.#cr=[],this.menuItems.forEach((t,e)=>{const o=theHTMLElementsFactory.create("div",{textContent:t.itemText,className:"travelnotes-context-menu-menu-item",dataset:{ObjId:String(e)}},this.#dr);t.isActive||o.classList.add("travelnotes-context-menu-menu-item-disabled"),this.#cr.push(o)})}#vr(){const t=theDevice.screenAvailable,e=Math.min(this.#ir,t.height-this.#dr.clientHeight-BaseContextMenu.#ur);this.#dr.style.top=String(e)+"px";const o=Math.min(this.#or,t.width-this.#dr.clientWidth-BaseContextMenu.#ur);this.#dr.style.left=String(o)+"px"}#fr(t,e){this.#lr=t,this.#hr=e,this.#pr(),this.#mr(),this.#gr(),this.#vr(),this.#zn=new BaseContextMenuOperator(this)}constructor(t,e){Object.freeze(this),BaseContextMenu.#sr?BaseContextMenu.#sr.onCancel():(this.#or=t.clientX||t.originalEvent.clientX||0,this.#ir=t.clientY||t.originalEvent.clientY||0,this.#nr=[t.latlng?t.latlng.lat:LAT_LNG.defaultValue,t.latlng?t.latlng.lng:LAT_LNG.defaultValue],this.#rr=t.target?.objId??(Number.parseInt(t?.currentTarget?.dataset?.tanObjId)||-1),this.#ar=Boolean(e),BaseContextMenu.#sr=this)}onOk(t){this.#zn.destructor(),BaseContextMenu.#sr=null,this.#lr(t)}onCancel(){this.#zn.destructor(),BaseContextMenu.#sr=null,this.#hr()}show(){BaseContextMenu.#sr&&new Promise((t,e)=>{this.#fr(t,e)}).then(t=>this.menuItems[t].doAction()).catch(t=>{t&&console.error(t)})}get menuItems(){return[]}get contextMenuContainer(){return this.#dr}get cancelButton(){return this.#Ee}get menuItemHTMLElements(){return this.#cr}get clientX(){return this.#or}get clientY(){return this.#ir}get latLng(){return this.#nr}get targetObjId(){return this.#rr}get haveParentNode(){return this.#ar}}class MenuItem{#Tr;#yr;#Lr;constructor(t,e,o){Object.freeze(this),this.#Tr=t,this.#yr=e,this.#Lr=o}get itemText(){return this.#Tr}get isActive(){return this.#yr}doAction(){this.#Lr()}}class PredefinedIconData{#Z;#Er;#br;#bt;#_r;constructor(t){this.#Z="string"==typeof t?.name?theHTMLSanitizer.sanitizeToJsString(t.name):"?",this.#Er="string"==typeof t.icon?theHTMLSanitizer.sanitizeToHtmlString(t?.icon).htmlString:"?",this.#br="string"==typeof t?.tooltip?theHTMLSanitizer.sanitizeToHtmlString(t.tooltip).htmlString:"?",this.#bt="number"==typeof t?.width?t.width:ICON_DIMENSIONS.width,this.#_r="number"==typeof t?.height?t.height:ICON_DIMENSIONS.height}get name(){return this.#Z}get icon(){return this.#Er}get tooltip(){return this.#br}get width(){return this.#bt}get height(){return this.#_r}}class EditionButtonData{#le;#Mr;#wr;constructor(t){if(Object.freeze(this),"string"!=typeof t?.title||"string"!=typeof t?.htmlBefore||t.htmlAfter&&"string"!=typeof t.htmlAfter)throw new Error("Invalid toolbar button");let e=(t.htmlBefore||"")+(t.htmlAfter||""),o=theHTMLSanitizer.sanitizeToHtmlString(e).errorsString;if(""!==o)throw new Error("Invalid toolbar button : "+e+o);this.#le=theHTMLSanitizer.sanitizeToHtmlString(t.title).htmlString,""===this.title&&(this.title="?"),this.#Mr=t.htmlBefore||"",this.#wr=t.htmlAfter||""}get title(){return this.#le}get htmlBefore(){return this.#Mr}get htmlAfter(){return this.#wr}}class NoteDialogToolbarData{#Dr;#Cr;#Ir;constructor(){Object.freeze(this),this.#Dr=[],this.#Cr=new Map,this.#Ir=[]}get editionButtonsData(){return this.#Dr}get preDefinedIconsData(){return this.#Ir}preDefinedIconDataAt(t){return this.#Ir[t]}preDefinedIconDataFromName(t){const e=this.#Cr.get(t);return e?e.icon:""}loadJson(t){if(t.editionButtons&&t.editionButtons.forEach(t=>{try{let e=new EditionButtonData(t);this.#Dr.push(e)}catch(t){console.error(t.message)}}),t.preDefinedIconsList){t.preDefinedIconsList.forEach(t=>{const e=new PredefinedIconData(t);this.#Cr.set(e.name,e)}),this.#Ir.length=0;for(const t of this.#Cr)this.#Ir.push(t[1]);this.#Ir=this.#Ir.sort((t,e)=>t.name.localeCompare(e.name))}}}const theNoteDialogToolbarData=new NoteDialogToolbarData;class NoteDialogToolbar{#Nr;#xr;#Pr;#Sr;#Or(){this.#xr=theHTMLElementsFactory.create("select",{className:"travelnotes-note-dialog-select",id:"travelnotes-note-dialog-icon-selector"},this.#Nr),theNoteDialogToolbarData.preDefinedIconsData.forEach(t=>{this.#xr.add(theHTMLElementsFactory.create("option",{text:t.name}))}),this.#xr.selectedIndex=-1}#zo(){this.#Pr=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("NoteDialogToolbar - Open a configuration file"),textContent:"ðŸ“‚"},this.#Nr)}#Ar(){theNoteDialogToolbarData.editionButtonsData.forEach(t=>{const e=theHTMLElementsFactory.create("div",{dataset:{HtmlBefore:t.htmlBefore,HtmlAfter:t.htmlAfter},className:"travelnotes-note-dialog-editor-button"},this.#Nr);theHTMLSanitizer.sanitizeToHtmlElement(t.title,e),this.#Sr.push(e)})}#Rr(){this.#Or(),this.#zo(),this.#Ar()}#kr(t){this.#xr.addEventListener("change",t.iconSelectorChange),this.#Sr.forEach(e=>{e.addEventListener("click",t.editionButtonsClick)}),this.#Pr.addEventListener("click",t.openCfgFileButtonClick,!1)}#Br(t){this.#xr.removeEventListener("change",t.iconSelectorChange),this.#Sr.forEach(e=>{e.removeEventListener("click",t.editionButtonsClick)}),this.#Pr.removeEventListener("click",t.openCfgFileButtonClick,!1)}constructor(t){Object.freeze(this),this.#Sr=[],this.#Nr=theHTMLElementsFactory.create("div",{id:"travelnotes-note-dialog-toolbar-container"}),this.#Rr(),this.#kr(t)}destructor(t){this.#Br(t)}update(t){this.#Br(t),this.#Nr.textContent="",this.#Sr=[],this.#Rr(),this.#kr(t)}get rootHTMLElement(){return this.#Nr}}class MapIconData{#nr;#gi;constructor(t,e){Object.freeze(this),this.#nr=t,this.#gi=e}get latLng(){return this.#nr}get route(){return this.#gi}}class TextAreaControl extends BaseControl{#jr;constructor(t,e){super(),theHTMLElementsFactory.create("div",{textContent:t?.headerText||"",className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement),this.#jr=theHTMLElementsFactory.create("textarea",{className:"travelnotes-text-area-control-text-area",placeholder:t?.placeholder||"",rows:t.rows||2,dataset:{Name:t?.datasetName||"TextAreaControl"}},theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),e.controlFocus&&this.#jr.addEventListener("focus",e.controlFocus),e.controlInput&&this.#jr.addEventListener("input",e.controlInput)}destructor(t){t.controlFocus&&this.#jr.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#jr.removeEventListener("input",t.controlInput)}get value(){return this.#jr.value}set value(t){this.#jr.value=t}}class AddressControl extends BaseControl{#Hr;#Fr;constructor(t){super();const e=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement);this.#Fr=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("AddressControl - Reset address"),textContent:"ðŸ”„"},e),theHTMLElementsFactory.create("text",{value:theTranslator.getText("AddressControl - Address")},e),this.#Hr=theHTMLElementsFactory.create("input",{type:"text",className:"travelnotes-adress-control-input-text",dataset:{Name:"address"}},theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),t.controlFocus&&this.#Hr.addEventListener("focus",t.controlFocus),t.controlInput&&this.#Hr.addEventListener("input",t.controlInput),t.addressButtonClick&&this.#Fr.addEventListener("click",t.addressButtonClick)}destructor(t){t.controlFocus&&this.#Hr.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#Hr.removeEventListener("input",t.controlInput),t.addressButtonClick&&this.#Fr.removeEventListener("click",t.addressButtonClick)}get address(){return this.#Hr.value}set address(t){this.#Hr.value=t}}class OverpassAPIDataLoaderOptions{searchPlaces=!0;searchWays=!0;searchRelations=!0;setGeometry=!0;constructor(){Object.seal(this)}}class OverpassAPIDataLoader{#Ie;#zr;#Ur;#Wr;#Kr;#Vr;#Gr;#nr;#Zr;#Xr;#Yr;#qr(){this.#Ur.forEach(t=>{t.geometry=[[]],t.lat=LAT_LNG.defaultValue,t.lon=LAT_LNG.defaultValue;let e=0;t.nodes.forEach(o=>{const i=this.#zr.get(o);t.geometry[0].push([i.lat,i.lon]),t.lat+=i.lat,t.lon+=i.lon,e++}),0!==e&&(t.lat/=e,t.lon/=e)}),this.#Wr.forEach(t=>{t.geometry=[[]],t.lat=LAT_LNG.defaultValue,t.lon=LAT_LNG.defaultValue;let e=0;t.members.forEach(o=>{if("way"===o.type){const i=this.#Ur.get(o.ref);t.geometry.push(i.geometry[0]),t.lat+=i.lat,t.lon+=i.lon,e++}}),0!==e&&(t.lat/=e,t.lon/=e)})}#Jr(t){t.forEach(t=>{switch(t.type){case"node":if(this.#zr.set(t.id,t),t?.tags?.place&&this.#Ie.searchPlaces&&this.#Gr[t.tags.place]&&t?.tags?.name){const e=theSphericalTrigonometry.pointsDistance(this.#nr,[t.lat,t.lon]),o=this.#Gr[t.tags.place];o.maxDistance>e&&o.distance>e&&(o.distance=e,o.name=t.tags.name)}break;case"way":this.#Ie.searchWays&&this.#Ur.set(t.id,t);break;case"relation":this.#Ie.searchRelations&&this.#Wr.set(t.id,t);break;case"area":if(this.#Ie.searchPlaces){let e=t.tags.name;"*"!==theConfig.nominatim.language&&t.tags["name:"+theConfig.nominatim.language]&&(e=t.tags["name:"+theConfig.nominatim.language]),this.#Kr[Number.parseInt(t.tags.admin_level)]=e,"2"===t.tags.admin_level&&(this.#Vr=theConfig.geoCoder.osmCityAdminLevel[t.tags["ISO3166-1"]]||this.#Vr)}}}),this.#Ie.setGeometry&&this.#qr(),this.#Ie.searchPlaces&&this.#$r()}#$r(){let t=null;for(let e=2;e<this.#Kr.length;e++)void 0!==this.#Kr[e]&&(this.#Vr>=e?this.#Xr=this.#Kr[e]:t=this.#Kr[e]);let e=Number.MAX_VALUE;Object.values(this.#Gr).forEach(t=>{t.distance<e&&(e=t.distance,this.#Zr=t.name)}),this.#Zr=t||this.#Zr,this.#Zr===this.#Xr&&(this.#Zr=null)}async#Qr(t){for(let e=0;e<t.length;e++)if("fulfilled"===t[e].status&&200===t[e].value.status&&t[e].value.ok){const o=await t[e].value.json();this.#Jr(o.elements)}else this.#Yr=!1,console.error("An error occurs when calling theOverpassAPI: "),console.error(t[e])}constructor(t){if(Object.freeze(this),this.#Ie=new OverpassAPIDataLoaderOptions,t)for(const[e,o]of Object.entries(t))this.#Ie[e]&&(this.#Ie[e]=o);this.#zr=new Map,this.#Ur=new Map,this.#Wr=new Map}async loadData(t,e){this.#nr=e,this.#Yr=!0,this.#Kr=[],this.#Vr=theConfig.geoCoder.osmCityAdminLevel.DEFAULT,this.#Gr=Object.freeze({hamlet:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:theConfig.geoCoder.distances.hamlet}),village:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:theConfig.geoCoder.distances.village}),city:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:theConfig.geoCoder.distances.city}),town:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:theConfig.geoCoder.distances.town})}),this.#Zr=null,this.#Xr=null,this.#zr.clear(),this.#Ur.clear(),this.#Wr.clear();const o=[];t.forEach(t=>{o.push(fetch(theConfig.overpassApi.url+"?data=[out:json][timeout:"+theConfig.overpassApi.timeOut+"];"+t))}),await Promise.allSettled(o).then(t=>this.#Qr(t))}get nodes(){return this.#zr}get ways(){return this.#Ur}get relations(){return this.#Wr}get place(){return this.#Zr}get city(){return this.#Xr}get country(){return this.#Kr[2]}get statusOk(){return this.#Yr}}class NominatimDataLoader{#ta=!1;#Z="";#ea="";#Xr="";#oa="";#ia(t,e){t.error||e.error?this.#ta=!1:(this.#Z=e?.namedetails?.name??"",e.address.house_number&&(this.#ea=e.address.house_number+" "),e.address.road?this.#ea+=e.address.road+" ":e.address.pedestrian&&(this.#ea+=e.address.pedestrian+" "),this.#Xr=t.address.city||t.address.town||t.address.municipality||t.address.village||"",this.#oa=e.address.country,this.#ta=!0)}constructor(){Object.freeze(this)}async loadData(t){this.#ta=!1;const e=theConfig.nominatim.url+"reverse?format=json&lat="+t[0]+"&lon="+t[1];let o=e+"&zoom=10&addressdetails=1&namedetails=0",i=e+"&zoom=18&addressdetails=1&namedetails=1";const n=theConfig.nominatim.language;n&&"*"!==n&&(o+="&accept-language="+n,i+="&accept-language="+n);const r=new Headers;n&&"*"===n&&r.append("accept-language","");const a=await fetch(o,{headers:r}),s=await fetch(i,{headers:r});200===a.status&&a.ok&&200===s.status&&s.ok?this.#ia(await a.json(),await s.json()):this.#ta=!1}get name(){return this.#ta?this.#Z:null}get street(){return this.#ta?this.#ea:null}get city(){return this.#ta?this.#Xr:null}get country(){return this.#ta?this.#oa:null}}class GeoCoderAddress{#Z;#ea;#Xr;constructor(t,e,o){Object.freeze(this),this.#Z=theHTMLSanitizer.sanitizeToJsString(t),this.#ea=theHTMLSanitizer.sanitizeToJsString(e),this.#Xr=theHTMLSanitizer.sanitizeToJsString(o)}get name(){return this.#Z}get street(){return this.#ea}get city(){return this.#Xr}}class GeoCoder{static get#na(){return Math.max(theConfig.geoCoder.distances.hamlet,theConfig.geoCoder.distances.village,theConfig.geoCoder.distances.city,theConfig.geoCoder.distances.town)}#nr;#ra;#aa;#sa(){let t=this.#aa.city||this.#aa.country||"";const e=this.#ra.place;e&&e!==t&&(t+=" ("+e+")");let o=(this.#aa.street||"").replaceAll(";"," "),i=this.#aa.name||"";return(o.includes(i)||t.includes(i))&&(i=""),new GeoCoderAddress(i,o,t)}#la(){return["node(around:"+GeoCoder.#na+","+this.#nr[0]+","+this.#nr[1]+")[place];out;"]}async#ha(){return await this.#ra.loadData(this.#la(),this.#nr),await this.#aa.loadData(this.#nr),this.#sa()}async#da(t,e){t(await this.#ha())}constructor(){Object.freeze(this),this.#ra=new OverpassAPIDataLoader({searchWays:!1,searchRelations:!1,setGeometry:!0}),this.#aa=new NominatimDataLoader({searchPlaces:!0,searchWays:!1,searchRelations:!1,setGeometry:!1})}async getAddressAsync(t){return this.#nr=t,this.#ha()}getAddressWithPromise(t){return this.#nr=t,new Promise((t,e)=>this.#da(t,e))}}class GeoCoderHelper{#ca;#ua(t){this.#ca.hideWait();let e=t.street;""!==t.city&&(e+=" "+t.city),this.#ca.setControlsValues({address:e,name:t.name}),this.#ca.updatePreview&&this.#ca.updatePreview({address:e})}constructor(t){Object.freeze(this),this.#ca=t}setAddressWithGeoCoder(t){this.#ca.showWait(),this.#ca.hideError(),(new GeoCoder).getAddressWithPromise(t).then(t=>{this.#ua(t)}).catch(t=>{t&&console.error(t),this.#ca.hideWait(),this.#ca.showError(theTranslator.getText("NoteDialogGeoCoderHelper - an error occurs when searching the adress"))})}}class NoteDialogIconDimsControl extends BaseControl{#pa=null;#ma=null;constructor(t){super(),theHTMLElementsFactory.create("text",{value:theTranslator.getText("NoteDialogIconDimsControl - Icon width")},this.controlHTMLElement),this.#pa=theHTMLElementsFactory.create("input",{type:"number",className:"travelnotes-note-dialog-number-input",value:ICON_DIMENSIONS.width,dataset:{Name:"iconWidth"}},this.controlHTMLElement),theHTMLElementsFactory.create("text",{value:theTranslator.getText("NoteDialogIconDimsControl - Icon height")},this.controlHTMLElement),this.#ma=theHTMLElementsFactory.create("input",{type:"number",className:"travelnotes-note-dialog-number-input",value:ICON_DIMENSIONS.height,dataset:{Name:"iconHeight"}},this.controlHTMLElement),this.#pa.addEventListener("input",t.controlInput),this.#ma.addEventListener("input",t.controlInput)}destructor(t){this.#pa.removeEventListener("input",t.controlInput),this.#ma.removeEventListener("input",t.controlInput)}get iconWidth(){return Number.parseInt(this.#pa.value)}set iconWidth(t){this.#pa.value=t}get iconHeight(){return Number.parseInt(this.#ma.value)}set iconHeight(t){this.#ma.value=t}}class NoteDialogLinkControl extends BaseControl{#ga;#va(t,e){theConfig.noteDialog.theDevil.addButton&&theHTMLElementsFactory.create("text",{value:"ðŸ‘¿"},theHTMLElementsFactory.create("a",{href:"https://www.google.com/maps/@"+t[0].toFixed(LAT_LNG.fixed)+","+t[1].toFixed(LAT_LNG.fixed)+","+theConfig.noteDialog.theDevil.zoomFactor+"z",target:"_blank",title:"Reminder! The devil will know everything about you"},theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:"Reminder! The devil will know everything about you"},e)))}constructor(t,e){super();const o=theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement);this.#va(e,o),theHTMLElementsFactory.create("text",{value:theTranslator.getText("NoteDialogLinkControl - Link")},o),this.#ga=theHTMLElementsFactory.create("input",{type:"text",className:"travelnotes-note-dialog-input-text",dataset:{Name:"url"}},theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),this.#ga.addEventListener("focus",t.controlFocus),this.#ga.addEventListener("input",t.controlInput),this.#ga.addEventListener("blur",t.urlInputBlur)}destructor(t){this.#ga.removeEventListener("focus",t.controlFocus),this.#ga.removeEventListener("input",t.controlInput),this.#ga.removeEventListener("blur",t.urlInputBlur)}get url(){return this.#ga.value}set url(t){this.#ga.value=t}}class NoteHTMLViewsFactory{static get#fa(){return 40}static get#Ta(){return 40}constructor(){Object.freeze(this)}getNoteTextAndIconHTML(t,e){const o=theHTMLElementsFactory.create("div",{dataset:{ObjId:e.note.objId}}),i=theHTMLElementsFactory.create("div",{className:t+(e.route?"route-maneuvers-and-notes-icon-cell":"travel-notes-icon-cell")},o);let n=1;theHTMLSanitizer.sanitizeToHtmlElement(e.note.iconContent,i),"travelnotes-roadbook-"===t&&i.firstChild&&("svg"===i.firstChild.tagName?(i.firstChild.setAttributeNS(null,"viewBox","0 0 "+ICON_DIMENSIONS.svgViewboxDim+" "+ICON_DIMENSIONS.svgViewboxDim),n=theConfig.note.svgIcon.roadbookFactor):i?.firstChild?.classList?.contains("travelnotes-map-note-category-0073")&&(n=theConfig.note.svgIcon.roadbookFactor)),i.dataset.tanWidth=String(e.note.iconWidth*n)+"px",i.dataset.tanHeight=String(e.note.iconHeight*n)+"px",i.style.width=String(e.note.iconWidth*n)+"px",i.style.height=String(e.note.iconHeight*n)+"px";const r=this.getNoteTextHTML(t,e);return r.className=t+(e.route?"route-maneuvers-and-notes-cell":"travel-notes-cell"),o.appendChild(r),o}getNoteTextHTML(t,e){const o=e.note,i=theHTMLElementsFactory.create("div");if(0!==o.tooltipContent.length&&theHTMLSanitizer.sanitizeToHtmlElement(o.tooltipContent,theHTMLElementsFactory.create("div",{className:t+"note-html-tooltip-content"},i)),0!==o.popupContent.length&&theHTMLSanitizer.sanitizeToHtmlElement(o.popupContent,theHTMLElementsFactory.create("div",{className:t+"note-html-popup-content"},i)),0!==o.address.length&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("NoteHTMLViewsFactory - Address")+"</span>Â :Â "+o.address,theHTMLElementsFactory.create("div",{className:t+"note-html-address"},i)),0!==o.url.length&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("NoteHTMLViewsFactory - Link")+"</span><a href="+o.url+' target="_blank" >'+o.url.substring(0,NoteHTMLViewsFactory.#fa)+"...</a>",theHTMLElementsFactory.create("div",{className:t+"note-html-url"},i)),0!==o.phone.length){let e=o.phone;if(o.phone.match(/^\+[0-9, ,*,\u0023]*$/)){const t=o.phone.replaceAll(/\u0020/g,""),i=o.phone.replaceAll(/\u0020/g,"Â ");e=theTranslator.getText("NoteHTMLViewsFactory - Phone")+"Â :Â "+theTranslator.getText("NoteHTMLViewsFactory - call")+'<a target="_blank" href="tel:'+t+'" >'+i+"</a>"+theTranslator.getText("NoteHTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+t+'" >'+i+"</a>"}else e=theTranslator.getText("NoteHTMLViewsFactory - Phone")+"Â :Â "+o.phone;theHTMLSanitizer.sanitizeToHtmlElement(e,theHTMLElementsFactory.create("div",{className:t+"note-html-phone"},i))}if(theHTMLSanitizer.sanitizeToHtmlElement(theUtilities.formatLatLng(o.latLng),theHTMLElementsFactory.create("div",{className:t+"note-html-lat-lng"},i)),e.route){e.route.chain&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("NoteHTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+theUtilities.formatDistance(o.chainedDistance+o.distance),theHTMLElementsFactory.create("div",{className:t+"note-html-travel-distance"},i)),theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("NoteHTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+theUtilities.formatDistance(o.distance),theHTMLElementsFactory.create("div",{className:t+"note-html-route-distance"},i));const n=e.route.notes.next(o.objId);if(n){const e=n.distance-o.distance;NoteHTMLViewsFactory.#Ta<e&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("NoteHTMLViewsFactory - Next note after")+"</span>Â :Â "+theUtilities.formatDistance(e),theHTMLElementsFactory.create("div",{className:t+"note-html-next-distance"},i))}}return i}getTravelNotesHTML(t){const e=theHTMLElementsFactory.create("div",{className:t+"travel-notes"}),o=theTravelNotesData.travel.notes.iterator;for(;!o.done;){const i=this.getNoteTextAndIconHTML(t,{note:o.value,route:null});i.className=t+"travel-notes-row",e.appendChild(i)}return e}}const theNoteHTMLViewsFactory=new NoteHTMLViewsFactory;class NoteDialogPreviewControl{#ya;#La;constructor(t){Object.freeze(this),this.#La=t,this.#ya=theHTMLElementsFactory.create("div",{className:"travelnotes-note-dialog-preview-container"}),this.#ya.appendChild(theNoteHTMLViewsFactory.getNoteTextAndIconHTML("travelnotes-note-dialog-",new NoteAndRoute(this.#La,null)))}update(){this.#ya.textContent="",this.#ya.appendChild(theNoteHTMLViewsFactory.getNoteTextAndIconHTML("travelnotes-note-dialog-",{note:this.#La,route:null}))}get HTMLElements(){return[this.#ya]}}class AllControlsFocusEL{#Ea;constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){t.stopPropagation(),"url"===t.target.dataset.tanName?this.#Ea.focusControl=null:this.#Ea.focusControl=t.target}}class AllControlsInputEL{#Ea;constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){t.stopPropagation();const e={};"iconWidth"===t.target.dataset.tanName||"iconHeight"===t.target.dataset.tanName?e[t.target.dataset.tanName]=Number.parseInt(t.target.value):e[t.target.dataset.tanName]=t.target.value,this.#Ea.updatePreview(e)}}class AddressButtonClickEL{#ca;#nr;constructor(t,e){Object.freeze(this),this.#ca=t,this.#nr=e}handleEvent(t){t.stopPropagation(),new GeoCoderHelper(this.#ca).setAddressWithGeoCoder(this.#nr)}}class UrlInputBlurEL{#Ea;constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){if(t.stopPropagation(),""===t.target.value)return void this.#Ea.hideError();""===theHTMLSanitizer.sanitizeToUrl(t.target.value).errorsString?this.#Ea.hideError():this.#Ea.showError(theTranslator.getText("UrlInputBlurEL - invalidUrl"))}}class EditionButtonsClickEL{#Ea;constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){if(!this.#Ea.focusControl)return;const e=t.currentTarget;let o=this.#Ea.focusControl.selectionStart,i=this.#Ea.focusControl.selectionEnd;this.#Ea.focusControl.value=this.#Ea.focusControl.value.slice(0,o)+e.dataset.tanHtmlBefore+(0===e.dataset.tanHtmlAfter.length?"":this.#Ea.focusControl.value.slice(o,i))+e.dataset.tanHtmlAfter+this.#Ea.focusControl.value.slice(i),o===i||0===e.dataset.tanHtmlAfter.length?(o+=e.dataset.tanHtmlBefore.length,i=o):i+=e.dataset.tanHtmlBefore.length+e.dataset.tanHtmlAfter.length,this.#Ea.focusControl.setSelectionRange(o,i),this.#Ea.focusControl.focus();const n={};n[this.#Ea.focusControl.dataset.tanName]=this.#Ea.focusControl.value,this.#Ea.updatePreview(n)}}class SvgBuilder{#ba;#ra;#_a;#Ma(){this.#_a=document.createElementNS(SVG_NS,"svg"),this.#_a.setAttributeNS(null,"viewBox",String(ICON_DIMENSIONS.svgViewboxDim/4)+" "+ICON_DIMENSIONS.svgViewboxDim/4+" "+ICON_DIMENSIONS.svgViewboxDim/2+" "+ICON_DIMENSIONS.svgViewboxDim/2),this.#_a.setAttributeNS(null,"class","travelnotes-svg-icon")}#wa(){let t=-1,e=-1,o=-1;const i=[];if(this.#ba.route.itinerary.itineraryPoints.forEach(n=>{t++;const r=theGeometry.addPoints(theGeometry.project(n.latLng,theConfig.note.svgIcon.zoom),this.#ba.translation);i.push(r);r[0]>=0&&r[1]>=0&&r[0]<=ICON_DIMENSIONS.svgViewboxDim&&r[1]<=ICON_DIMENSIONS.svgViewboxDim&&(-1===e&&(e=t),o=t)}),-1!==e&&-1!==o){0<e&&e--,this.#ba.route.itinerary.itineraryPoints.length-1>o&&o++;let n="";for(t=e;t<=o;t++)n+=i[t][0].toFixed(0)+","+i[t][1].toFixed(0)+" ";const r=document.createElementNS(SVG_NS,"polyline");r.setAttributeNS(null,"points",n),r.setAttributeNS(null,"class","travelnotes-osm-itinerary"),r.setAttributeNS(null,"transform","rotate("+this.#ba.rotation+","+ICON_DIMENSIONS.svgViewboxDim/2+","+ICON_DIMENSIONS.svgViewboxDim/2+")"),this.#_a.appendChild(r)}}#Da(){this.#ra.ways.forEach(t=>{let e=-1,o=-1,i=-1;const n=[];if(t.nodes.forEach(t=>{i++;const r=this.#ra.nodes.get(t),a=theGeometry.addPoints(theGeometry.project([r.lat,r.lon],theConfig.note.svgIcon.zoom),this.#ba.translation);n.push(a);a[0]>=0&&a[1]>=0&&a[0]<=ICON_DIMENSIONS.svgViewboxDim&&a[1]<=ICON_DIMENSIONS.svgViewboxDim&&(-1===e&&(e=i),o=i)}),-1!==e&&-1!==o){0<e&&e--,t.nodes.length-1>o&&o++;let r="";for(i=e;i<=o;i++)r+=n[i][0].toFixed(0)+","+n[i][1].toFixed(0)+" ";const a=document.createElementNS(SVG_NS,"polyline");a.setAttributeNS(null,"points",r),a.setAttributeNS(null,"class","travelnotes-osm-highway travelnotes-osm-highway-"+t.tags.highway.replaceAll(/_/g,"-")),a.setAttributeNS(null,"transform","rotate("+this.#ba.rotation+","+ICON_DIMENSIONS.svgViewboxDim/2+","+ICON_DIMENSIONS.svgViewboxDim/2+")"),this.#_a.appendChild(a)}})}#Ca(){if(""===this.#ba.rcnRef)return;const t=document.createElementNS(SVG_NS,"text");t.textContent=this.#ba.rcnRef,t.setAttributeNS(null,"x",String(ICON_DIMENSIONS.svgViewboxDim/2)),t.setAttributeNS(null,"y",String(ICON_DIMENSIONS.svgViewboxDim/2)),t.setAttributeNS(null,"class","travelnotes-osm-rcn-ref"),this.#_a.appendChild(t)}constructor(){Object.freeze(this)}buildSvg(t,e,o){this.#ba=t,this.#ra=o,this.#Ma(),this.#wa(),this.#Da(),this.#Ca(),e.iconContent=this.#_a.outerHTML}}class RoundaboutData{isMini;isEntry;isExit;constructor(){Object.seal(this),this.isMini=!1,this.isEntry=!1,this.isExit=!1}}class StreetFinder{#ba;#Ia;#ra;#Na;#xa;#Pa;#Sa;#Oa;#Aa;#Ra;#ka;#Ba(t){return(t.tags.name?t.tags.name:"")+(t.tags.name&&t.tags.ref?" ":"")+(t.tags.ref?"["+t.tags.ref+"]":"")}#ja(t){const e=5e-6;let o=!1;return this.#ba.route.wayPoints.forEach(i=>{Math.abs(t.lat-i.lat)<e&&Math.abs(t.lng-i.lng)<e&&(o=!0)}),!o&&(this.#Ia.latLng[0]!==t.lat||this.#Ia.latLng[1]!==t.lng)}#Ha(){const t=this.#ba.route.itinerary.itineraryPoints.previous(this.#ba.nearestItineraryPointObjId,t=>this.#ja(t)),e=this.#ba.route.itinerary.itineraryPoints.next(this.#ba.nearestItineraryPointObjId,t=>this.#ja(t));let o=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE,a=DISTANCE.defaultValue;this.#ra.nodes.forEach(s=>{a=theSphericalTrigonometry.pointsDistance([s.lat,s.lon],this.#Ia.latLng),"bike"===this.#ba.route.itinerary.transitMode&&s?.tags?.rcn_ref&&s.tags["network:type"]&&"node_network"===s.tags["network:type"]&&a<theConfig.note.svgIcon.rcnRefDistance&&a<i&&(this.#Na=s,i=a),a<o&&(this.#Pa=s.id,o=a),t&&(a=theSphericalTrigonometry.pointsDistance([s.lat,s.lon],t.latLng),a<n&&(this.#Sa=s.id,n=a)),e&&(a=theSphericalTrigonometry.pointsDistance([s.lat,s.lon],e.latLng),a<r&&(this.#Oa=s.id,r=a))}),this.#xa=this.#ra.nodes.get(this.#Pa)}#Fa(){this.#ka.isMini="mini_roundabout"===this?.#xa?.tags?.highway}#za(){this.#Na&&(this.#ba.rcnRef=this.#Na.tags.rcn_ref,this.#Ia.tooltipContent+=theTranslator.getText("StreetFinder - rcnRef",{rcnRef:this.#ba.rcnRef}))}#Ua(){this.#ra.ways.forEach(t=>{if(!t.nodes.includes(this.#Pa))return;const e=this.#Ba(t),o=""!==e,i=t.nodes.includes(this.#Sa),n=t.nodes.includes(this.#Oa);let r=2*t.nodes.filter(t=>t===this.#Pa).length;if(t.nodes[0]===this.#Pa&&r--,t.nodes[t.nodes.length-1]===this.#Pa&&r--,i&&(this.#Aa=o?e:"???",r--,"roundabout"===t?.tags?.junction&&(this.#ka.isExit=!0)),0!==r&&(n&&(this.#Ra=o?e:"???",r--,"roundabout"===t?.tags?.junction&&(this.#ka.isEntry=!0)),0!==r&&o))for(;0!==r;)this.#Ia.address=""===this.#Ia.address?e:this.#Ia.address+" âª¥  "+e,r--})}#Wa(){""!==this.#ra.city&&(this.#Ia.address+=' <span class="travelnotes-note-html-address-city">'+this.#ra.city+"</span>"),this.#ra.place&&this.#ra.place!==this.#ra.city&&(this.#Ia.address+=" ("+this.#ra.place+")")}#Ka(){ICON_POSITION.atStart===this.#ba.positionOnRoute?(this.#Ia.address="ðŸŸ¢ "+this.#Ra,this.#Wa()):ICON_POSITION.atEnd===this.#ba.positionOnRoute?(this.#Wa(),this.#Ia.address=this.#Aa,this.#Wa(),this.#Ia.address+=" ðŸ”´ "):(this.#Ia.address=this.#Aa+(""===this.#Ia.address?"":" âª¥  "+this.#Ia.address)+" "+this.#ba.directionArrow+" "+this.#Ra,this.#Wa())}#Va(){this.#ka.isEntry&&!this.#ka.isExit?this.#Ia.tooltipContent+=theTranslator.getText("StreetFinder - entry roundabout"):!this.#ka.isEntry&&this.#ka.isExit?this.#Ia.tooltipContent+=theTranslator.getText("StreetFinder - exit roundabout"):this.#ka.isEntry&&this.#ka.isExit&&(this.#Ia.tooltipContent+=theTranslator.getText("StreetFinder - continue roundabout")),this.#ka.isMini&&(this.#Ia.tooltipContent+=theTranslator.getText("StreetFinder - at the small roundabout on the ground"))}constructor(){Object.freeze(this)}findData(t,e,o){this.#ba=t,this.#Ia=e,this.#ra=o,this.#Pa=-1,this.#Sa=-1,this.#Oa=-1,this.#Aa="",this.#Ra="",this.#ka=new RoundaboutData,this.#Ha(),this.#Fa(),this.#za(),this.#Ua(),this.#Ka(),this.#Va()}}class ArrowAndTooltipFinder{constructor(){Object.freeze(this)}findData(t,e){null!==t.direction&&(t.direction<theConfig.note.svgIcon.angleDirection.right?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn right"),t.directionArrow="ðŸ¢‚"):t.direction<theConfig.note.svgIcon.angleDirection.slightRight?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn slight right"),t.directionArrow="ðŸ¢…"):t.direction<theConfig.note.svgIcon.angleDirection.continue?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Continue"),t.directionArrow="ðŸ¢"):t.direction<theConfig.note.svgIcon.angleDirection.slightLeft?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn slight left"),t.directionArrow="ðŸ¢„"):t.direction<theConfig.note.svgIcon.angleDirection.left?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn left"),t.directionArrow="ðŸ¢€"):t.direction<theConfig.note.svgIcon.angleDirection.sharpLeft?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn sharp left"),t.directionArrow="ðŸ¢‡"):t.direction<theConfig.note.svgIcon.angleDirection.sharpRight?(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn sharp right"),t.directionArrow="ðŸ¢†"):(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Turn right"),t.directionArrow="ðŸ¢‚")),ICON_POSITION.atStart===t.positionOnRoute?e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Start"):ICON_POSITION.atEnd===t.positionOnRoute&&(e.tooltipContent=theTranslator.getText("ArrowAndTooltipFinder - Stop"))}}class TranslationRotationFinder{#ba;#Ia;#Ga;#Za;#Xa;#Ya(){this.#ba.translation=theGeometry.subtrackPoints([ICON_DIMENSIONS.svgViewboxDim/2,ICON_DIMENSIONS.svgViewboxDim/2],theGeometry.project(this.#Ia.latLng,theConfig.note.svgIcon.zoom))}#qa(){this.#Ga=this.#ba.route.itinerary.itineraryPoints.previous(this.#ba.nearestItineraryPointObjId,t=>theSphericalTrigonometry.pointsDistance(t.latLng,this.#Ia.latLng)>theConfig.note.svgIcon.angleDistance)||this.#ba.route.itinerary.itineraryPoints.first}#Ja(){this.#Za=this.#ba.route.itinerary.itineraryPoints.next(this.#ba.nearestItineraryPointObjId,t=>theSphericalTrigonometry.pointsDistance(t.latLng,this.#Ia.latLng)>theConfig.note.svgIcon.angleDistance)||this.#ba.route.itinerary.itineraryPoints.last}#$a(){this.#Xa=theGeometry.addPoints(theGeometry.project(this.#Ia.latLng,theConfig.note.svgIcon.zoom),this.#ba.translation)}#Qa(){if(this.#ba.nearestItineraryPointObjId!==this.#ba.route.itinerary.itineraryPoints.first.objId){const t=theGeometry.addPoints(theGeometry.project(this.#Ga.latLng,theConfig.note.svgIcon.zoom),this.#ba.translation);this.#ba.rotation=Math.atan((this.#Xa[1]-t[1])/(t[0]-this.#Xa[0]))*DEGREES.d180/Math.PI,0>this.#ba.rotation&&(this.#ba.rotation+=DEGREES.d360),this.#ba.rotation-=DEGREES.d270,0>t[0]-this.#Xa[0]&&(this.#ba.rotation+=DEGREES.d180)}}#ts(){if(this.#ba.nearestItineraryPointObjId!==this.#ba.route.itinerary.itineraryPoints.last.objId){const t=theGeometry.addPoints(theGeometry.project(this.#Za.latLng,theConfig.note.svgIcon.zoom),this.#ba.translation);for(this.#ba.direction=Math.atan((this.#Xa[1]-t[1])/(t[0]-this.#Xa[0]))*DEGREES.d180/Math.PI,0>t[0]-this.#Xa[0]&&(this.#ba.direction+=DEGREES.d180),this.#ba.direction-=this.#ba.rotation;DEGREES.d0>this.#ba.direction;)this.#ba.direction+=DEGREES.d360;for(;DEGREES.d360<this.#ba.direction;)this.#ba.direction-=DEGREES.d360}}#es(){this.#ba.nearestItineraryPointObjId===this.#ba.route.itinerary.itineraryPoints.first.objId&&(this.#ba.rotation=-this.#ba.direction-DEGREES.d90,this.#ba.direction=null,this.#ba.positionOnRoute=ICON_POSITION.atStart),this.#Ia.latLng[0]===this.#ba.route.itinerary.itineraryPoints.last.lat&&this.#Ia.latLng[1]===this.#ba.route.itinerary.itineraryPoints.last.lng&&(this.#ba.direction=null,this.#ba.positionOnRoute=ICON_POSITION.atEnd)}constructor(){Object.freeze(this)}findData(t,e){this.#ba=t,this.#Ia=e,this.#Ya(),this.#qa(),this.#Ja(),this.#$a(),this.#Qa(),this.#ts(),this.#es()}}class NoteDataForMapIcon{constructor(){Object.seal(this)}iconContent="";tooltipContent="";address="";latLng=[LAT_LNG.defaultValue,LAT_LNG.defaultValue]}class ComputeDataForMapIcon{constructor(){Object.seal(this)}nearestItineraryPointObjId=-1;route=null;positionOnRoute=ICON_POSITION.onRoute;direction=null;directionArrow=" ";rcnRef="";rotation=0;translation=[0,0]}class MapIconFromOsmFactory{#Ia;#ba;#ra;#na;#os;static get#is(){return 1.5}#ns(){let t=null,e=Number.MAX_VALUE;this.#ba.route.itinerary.itineraryPoints.forEach(o=>{const i=theSphericalTrigonometry.pointsDistance(this.#Ia.latLng,o.latLng);e>i&&(e=i,t=o)}),this.#Ia.latLng=t.latLng,this.#ba.nearestItineraryPointObjId=t.objId}#rs(){return(new TranslationRotationFinder).findData(this.#ba,this.#Ia),(new ArrowAndTooltipFinder).findData(this.#ba,this.#Ia),(new StreetFinder).findData(this.#ba,this.#Ia,this.#ra),(new SvgBuilder).buildSvg(this.#ba,this.#Ia,this.#ra),this.#os=!1,this.#Ia}async#as(){if(this.#os)return null;this.#os=!0,this.#ba.nearestItineraryPointObjId=-1,this.#ba.positionOnRoute=ICON_POSITION.onRoute,this.#ba.direction=null,this.#ba.directionArrow=" ",this.#ba.translation=[0,0],this.#ba.rotation=0,this.#ba.rcnRef="",this.#Ia.iconContent="",this.#Ia.tooltipContent="",this.#Ia.address="",this.#ns();const t=this.#Ia.latLng[0].toFixed(LAT_LNG.fixed)+","+this.#Ia.latLng[1].toFixed(LAT_LNG.fixed),e=["way[highway](around:"+(ICON_DIMENSIONS.svgViewboxDim*MapIconFromOsmFactory.#is).toFixed(0)+","+t+")->.a;(.a >;.a;)->.a;.a out;is_in("+t+')->.e;area.e[admin_level][boundary="administrative"];out;node(around:'+this.#na+","+t+")[place];out;"];return await this.#ra.loadData(e,this.#Ia.latLng),this.#ra.statusOk?this.#rs():null}async#ss(t,e){const o=await this.#as();o?t(o):e("An error occurs...")}constructor(){Object.freeze(this),this.#Ia=new NoteDataForMapIcon,this.#ba=new ComputeDataForMapIcon,this.#ra=new OverpassAPIDataLoader({searchRelations:!1,setGeometry:!1}),this.#na=Math.max(theConfig.geoCoder.distances.hamlet,theConfig.geoCoder.distances.village,theConfig.geoCoder.distances.city,theConfig.geoCoder.distances.town),this.#os=!1}async getIconAndAdressAsync(t,e){return this.#Ia.latLng=t,this.#ba.route=e,this.#as()}getIconAndAdressWithPromise(t){return this.#Ia.latLng=t.latLng,this.#ba.route=t.route,new Promise((t,e)=>this.#ss(t,e))}}class IconSelectorChangeEL{#Ea;#ls(t){this.#Ea.setControlsValues(t),this.#Ea.updatePreview(t)}#hs(){const t=this.#Ea.mapIconData;t.route?(this.#Ea.hideError(),this.#Ea.showWait(),(new MapIconFromOsmFactory).getIconAndAdressWithPromise(t).then(t=>{this.#Ea.hideWait(),this.#ls(t)}).catch(t=>{t instanceof Error&&console.error(t),this.#Ea.hideWait(),this.#Ea.showError(theTranslator.getText("IconSelectorChangeEL - an error occurs when creating the SVG icon"))})):this.#Ea.showError(theTranslator.getText("IconSelectorChangeEL - not possible to create a SVG icon for a travel note"))}constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){t.stopPropagation();const e=theNoteDialogToolbarData.preDefinedIconDataAt(t.target.selectedIndex);"SvgIcon"!==e.icon?(this.#ls({iconContent:e.icon,iconHeight:e.height,iconWidth:e.width,tooltipContent:e.tooltip}),this.#Ea.setAddress()):this.#hs()}}class OpenCfgFileInputChangeEL{#Ea;constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{theNoteDialogToolbarData.loadJson(JSON.parse(e.result)),this.#Ea.updateToolbar()}catch(t){t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class OpenCfgFileButtonClickEL{#Ea;constructor(t){Object.freeze(this),this.#Ea=t}handleEvent(t){t.stopPropagation(),theUtilities.openFile(new OpenCfgFileInputChangeEL(this.#Ea),".json")}}class NoteDialogEventListeners{#ds;#cs;#us;#ps;#ms;#gs;#vs;constructor(t,e){Object.freeze(this),this.#ds=new AllControlsFocusEL(t),this.#cs=new AllControlsInputEL(t),this.#us=new AddressButtonClickEL(t,e),this.#ps=new UrlInputBlurEL(t),this.#ms=new EditionButtonsClickEL(t),this.#gs=new IconSelectorChangeEL(t),this.#vs=new OpenCfgFileButtonClickEL(t)}destructor(){this.#ds=null,this.#cs=null,this.#us=null,this.#ps=null,this.#ms=null,this.#gs=null,this.#vs=null}get controlFocus(){return this.#ds}get controlInput(){return this.#cs}get addressButtonClick(){return this.#us}get urlInputBlur(){return this.#ps}get editionButtonsClick(){return this.#ms}get iconSelectorChange(){return this.#gs}get openCfgFileButtonClick(){return this.#vs}}class NoteDialog extends ModalBaseDialog{#mi;#gi;#La;#fs;#Ts;#ys;#Ls;#Es;#bs;#_s;#Ms;#ei;#ws;#Ds;#Ae(){this.#ei.destructor(this.#Ds),this.#fs.destructor(this.#Ds),this.#Ts.destructor(this.#Ds),this.#ys.destructor(this.#Ds),this.#Ls.destructor(this.#Ds),this.#Es.destructor(this.#Ds),this.#bs.destructor(this.#Ds),this.#_s.destructor(this.#Ds),this.#Ds.destructor()}constructor(t,e){super(),this.#ws=null,this.#mi=t,this.#gi=e,this.#La=new Note,this.#La.jsonObject=t.jsonObject}createContentHTML(){this.#Ds=new NoteDialogEventListeners(this,this.#La.latLng),this.#ei=new NoteDialogToolbar(this.#Ds),this.#fs=new NoteDialogIconDimsControl(this.#Ds),this.#Ts=new TextAreaControl({placeholder:"?????",datasetName:"iconContent",headerText:theTranslator.getText("NoteDialogIconControl - Icon content")},this.#Ds),this.#ys=new TextInputControl({headerText:theTranslator.getText("NoteDialogTooltipControl - Tooltip content"),datasetName:"tooltipContent"},this.#Ds),this.#Ls=new TextAreaControl({rows:theConfig.noteDialog.areaHeight.popupContent,datasetName:"popupContent",headerText:theTranslator.getText("NoteDialogPopupControl - Text")},this.#Ds),this.#Es=new AddressControl(this.#Ds),this.#bs=new NoteDialogLinkControl(this.#Ds,this.#La.latLng),this.#_s=new TextInputControl({headerText:theTranslator.getText("NoteDialogPhoneControl - Phone"),datasetName:"phone"},this.#Ds),this.#Ms=new NoteDialogPreviewControl(this.#La),this.setControlsValues(this.#La)}get focusControl(){return this.#ws}set focusControl(t){this.#ws=t}get mapIconData(){return new MapIconData(this.#La.latLng,this.#gi)}updatePreview(t){for(const e in t)this.#La[e]=t[e];this.#Ms.update()}setAddress(){""===this.#mi.address&&new GeoCoderHelper(this).setAddressWithGeoCoder(this.#La.latLng)}canClose(){return""===this.#Ts.value?(this.showError(theTranslator.getText("Notedialog - The icon content cannot be empty")),!1):""===this.#bs.url||""!==theHTMLSanitizer.sanitizeToUrl(this.#bs.url).url||(this.showError(theTranslator.getText("NoteDialog - invalidUrl")),!1)}onCancel(){this.#Ae(),super.onCancel()}onOk(){super.onOk()&&(this.#mi.iconWidth=this.#fs.iconWidth,this.#mi.iconHeight=this.#fs.iconHeight,this.#mi.iconContent=this.#Ts.value,this.#mi.tooltipContent=this.#ys.value,this.#mi.popupContent=this.#Ls.value,this.#mi.address=this.#Es.address,this.#mi.url=this.#bs.url,this.#mi.phone=this.#_s.value,this.#mi.latLng=this.#La.latLng,this.#Ae())}get title(){return theTranslator.getText("NoteDialog - Note")}get toolbarHTMLElement(){return this.#ei.rootHTMLElement}get contentHTMLElements(){return[this.#fs.controlHTMLElement,this.#Ts.controlHTMLElement,this.#ys.controlHTMLElement,this.#Ls.controlHTMLElement,this.#Es.controlHTMLElement,this.#bs.controlHTMLElement,this.#_s.controlHTMLElement]}get footerHTMLElements(){return this.#Ms.HTMLElements}setControlsValues(t){this.#fs.iconHeight=t.iconHeight||this.#fs.iconHeight,this.#fs.iconWidth=t.iconWidth||this.#fs.iconWidth,this.#Ts.value=t.iconContent||this.#Ts.value,this.#ys.value=t.tooltipContent||this.#ys.value,this.#Ls.value=t.popupContent||this.#Ls.value,this.#Es.address=t.address||this.#Es.address,this.#bs.url=t.url||this.#bs.url,this.#_s.value=t.phone||this.#_s.value}updateToolbar(){this.#ei.update(this.#Ds)}}class WaitUI{#Cs;#Is;constructor(){Object.freeze(this)}createUI(){if(this.#Cs)return;this.#Cs=theHTMLElementsFactory.create("div",{className:"travelnotes-background"},document.body);const t=theHTMLElementsFactory.create("div",{id:"travelnotes-wait-ui"},this.#Cs);this.#Is=theHTMLElementsFactory.create("div",{id:"travelnotes-wait-ui-message"},t),theHTMLElementsFactory.create("div",{className:"travelnotes-wait-animation-bullet"},theHTMLElementsFactory.create("div",{className:"travelnotes-wait-animation"},t))}showInfo(t){this.#Is.textContent=t}close(){document.body.removeChild(this.#Cs),this.#Cs=null}}class Zoomer{#Ns=[];#xs(t){this.#Ns.push(t.latLng),this.#Ns.push(t.iconLatLng)}#Ps(t){t.itinerary.itineraryPoints.forEach(t=>this.#Ns.push(t.latLng)),t.notes.forEach(t=>this.#xs(t))}constructor(){Object.freeze(this)}zoomToLatLng(t){theEventDispatcher.dispatch("zoomto",{latLng:t})}zoomToNote(t){this.#Ns=[],this.#xs(theDataSearchEngine.getNoteAndRoute(t).note),theEventDispatcher.dispatch("zoomto",{geometry:[this.#Ns]})}zoomToRoute(t){this.#Ns=[],this.#Ps(theDataSearchEngine.getRoute(t)),theEventDispatcher.dispatch("zoomto",{geometry:[this.#Ns]})}zoomToTravel(){this.#Ns=[],theTravelNotesData.travel.routes.forEach(t=>this.#Ps(t)),-1!==theTravelNotesData.travel.editedRouteObjId&&this.#Ps(theTravelNotesData.travel.editedRoute),theTravelNotesData.travel.notes.forEach(t=>this.#xs(t)),theEventDispatcher.dispatch("zoomto",{geometry:[this.#Ns]})}zoomToPoi(t){theEventDispatcher.dispatch("zoomto",t)}}class NoteEditor{#mi=null;#gi=null;#Ss=!0;#Os=null;#As(){this.#Ss?this.#gi?(this.#gi.notes.add(this.#mi),this.#mi.chainedDistance=this.#gi.chainedDistance,this.#gi.notes.sort((t,e)=>t.distance-e.distance)):(theTravelNotesData.travel.notes.add(this.#mi),theEventDispatcher.dispatch("updatetravelnotes")):this.#gi||theEventDispatcher.dispatch("updatetravelnotes"),theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:this.#mi.objId,addedNoteObjId:this.#mi.objId}),theEventDispatcher.dispatch("updateroadbook")}#Ea(){new NoteDialog(this.#mi,this.#gi).show().then(()=>this.#As()).catch(t=>{console.error(t)})}#Rs(t){this.#Ss=!0,this.#mi=new Note,this.#mi.latLng=t,this.#mi.iconLatLng=t}async#ks(t){if(t.tags.rcn_ref?this.#mi.iconContent="<div class='travenNotes-map-note travelnotes-map-note-category-0073'><svg viewBox='0 0 20 20'><text x='10' y='14'>"+t.tags.rcn_ref+"</text></svg></div>":this.#mi.iconContent=theNoteDialogToolbarData.preDefinedIconDataFromName(t.description),this.#mi.url=t.tags.website||"",this.#mi.phone=t.tags.phone||"",this.#mi.tooltipContent=t.description||"",this.#mi.popupContent=t.tags.name||"",t.tags["addr:street"]&&t.tags["addr:city"])this.#mi.address=(t.tags["addr:housenumber"]?t.tags["addr:housenumber"]+" ":"")+t.tags["addr:street"]+' <span class="tavelnotes-note-html-address-city">'+t.tags["addr:city"]+"</span>";else{const e=new WaitUI;e.createUI(),e.showInfo("Creating address");let o=null;try{o=await(new GeoCoder).getAddressAsync([t.lat,t.lon])}catch(t){console.error(t)}e.close(),this.#mi.address=o.street,""!==o.city&&(this.#mi.address+=' <span class="travelnotes-note-html-address-city">'+o.city+"</span>")}this.osmSearchNoteDialog||""===this.#mi.iconContent?this.#Ea():this.#As()}constructor(){Object.freeze(this)}get osmSearchNoteDialog(){return null===this.#Os&&(this.#Os=theConfig.osmSearch.showSearchNoteDialog),this.#Os}changeOsmSearchNoteDialog(){this.#Os=!this.osmSearchNoteDialog}newRouteNote(t,e){this.#gi=theDataSearchEngine.getRoute(t);const o=theGeometry.getClosestLatLngDistance(this.#gi,e);this.#Rs(o.latLng),this.#mi.distance=o.distance,this.#Ea()}newSearchRouteNote(t){const e=theDataSearchEngine.getNearestRouteData([t.lat,t.lon]);e.route?(this.#Rs(e.latLngOnRoute),this.#mi.iconLatLng=[t.lat,t.lon],this.#mi.distance=e.distanceOnRoute,this.#gi=e.route,this.#ks(t)):theErrorsUI$1.showError(theTranslator.getText("NoteEditor - No route was found"))}newSearchTravelNote(t){this.#gi=null,this.#Rs([t.lat,t.lon]),this.#ks(t)}newTravelNote(t){this.#gi=null,this.#Rs(t),this.#Ea()}newUrlNote(t){this.#gi=null,this.#Rs(t),this.#mi.iconContent='<div class="travenNotes-map-note travelnotes-map-note-category-0074"></div>',this.#mi.tooltipContent="Here",this.#As(),(new Zoomer).zoomToLatLng(t)}editNote(t){this.#Ss=!1;const e=theDataSearchEngine.getNoteAndRoute(t);this.#gi=e.route,this.#mi=e.note,this.#Ea()}removeNote(t){const e=theDataSearchEngine.getNoteAndRoute(t);e.route?e.route.notes.remove(t):(theTravelNotesData.travel.notes.remove(t),theEventDispatcher.dispatch("updatetravelnotes")),theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:-1}),theEventDispatcher.dispatch("updateroadbook")}hideNotes(){let t=theTravelNotesData.travel.notes.iterator;for(;!t.done;)theEventDispatcher.dispatch("removeobject",{objId:t.value.objId});const e=theTravelNotesData.travel.routes.iterator;for(;!e.done;)for(t=e.value.notes.iterator;!t.done;)theEventDispatcher.dispatch("removeobject",{objId:t.value.objId});if(-1!==theTravelNotesData.editedRouteObjId)for(t=theTravelNotesData.travel.editedRoute.notes.iterator;!t.done;)theEventDispatcher.dispatch("removeobject",{objId:t.value.objId})}showNotes(){this.hideNotes();const t=theTravelNotesData.travel.notes.iterator;for(;!t.done;)theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:t.value.objId});const e=theTravelNotesData.travel.routes.iterator;for(;!e.done;)e.value.hidden||theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:e.value.objId,addedRouteObjId:e.value.objId})}attachNoteToRoute(t){const e=theDataSearchEngine.getNoteAndRoute(t).note,o=theDataSearchEngine.getNearestRouteData(e.latLng);o.route&&(theTravelNotesData.travel.notes.remove(t),e.distance=o.distanceOnRoute,e.latLng=o.latLngOnRoute,e.chainedDistance=o.route.chainedDistance,o.route.notes.add(e),o.route.notes.sort((t,e)=>t.distance-e.distance),theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:t}),theEventDispatcher.dispatch("updatetravelnotes"),theEventDispatcher.dispatch("updateroadbook"))}detachNoteFromRoute(t){const e=theDataSearchEngine.getNoteAndRoute(t);e.route.notes.remove(t),e.note.distance=DISTANCE.invalid,e.note.chainedDistance=DISTANCE.defaultValue,theTravelNotesData.travel.notes.add(e.note),theEventDispatcher.dispatch("updatetravelnotes"),theEventDispatcher.dispatch("updateroadbook")}travelNoteDropped(t,e,o){theTravelNotesData.travel.notes.moveTo(t,e,o),theEventDispatcher.dispatch("updatetravelnotes"),theEventDispatcher.dispatch("updateroadbook")}}const theNoteEditor=new NoteEditor;class ProfileContextMenu extends BaseContextMenu{constructor(t,e){super(t,e)}get menuItems(){return[new MenuItem(theTranslator.getText("ProfileContextMenu - Add a note to the route at this point"),!0,()=>theNoteEditor.newRouteNote(this.targetObjId,this.latLng)),new MenuItem(theTranslator.getText("ProfileContextMenu - Zoom to this point"),!0,()=>(new Zoomer).zoomToLatLng(this.latLng))]}}class BaseSvgEL{constructor(){Object.freeze(this)}getlatLngElevOnRouteAtMousePosition(t){const e=theDataSearchEngine.getRoute(Number.parseInt(t.currentTarget.dataset.tanObjId)),o=t.currentTarget.getBoundingClientRect(),i=(t.clientX-o.x-SvgProfileBuilder.PROFILE_MARGIN/(2*SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_WIDTH)*o.width)/(SvgProfileBuilder.PROFILE_WIDTH/(2*SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_WIDTH)*o.width)*e.distance;return 0<i&&i<e.distance?theGeometry.getLatLngElevAtDist(e,i):null}}class SvgContextMenuEL extends BaseSvgEL{constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation();const e=this.getlatLngElevOnRouteAtMousePosition(t);e&&(t.latlng={lat:e.latLng[0],lng:e.latLng[1]},new ProfileContextMenu(t).show())}}class SvgMouseLeaveEL{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault(),t.stopPropagation(),theEventDispatcher.dispatch("removeobject",{objId:Number.parseInt(t.currentTarget.dataset.tanMarkerObjId)})}}class SvgMouseMoveEL extends BaseSvgEL{#Bs;#js;#Hs;#Fs;#zs;#Us;#Ws;#Ks(t,e){const o=document.createElementNS(SVG_NS,"text");return o.appendChild(document.createTextNode(t)),o.setAttributeNS(null,"class","travelnotes-route-svg-profile-elev-text"),o.setAttributeNS(null,"x",this.#Us),o.setAttributeNS(null,"y",e),o.setAttributeNS(null,"text-anchor",this.#zs),this.#Ws.appendChild(o),o}constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#Ws=t.currentTarget;const e=this.getlatLngElevOnRouteAtMousePosition(t);if(e){const o=Number.parseInt(this.#Ws.dataset.tanMarkerObjId);theEventDispatcher.dispatch("removeobject",{objId:o}),theEventDispatcher.dispatch("additinerarypointmarker",{objId:o,latLng:e.latLng}),this.#Bs&&this.#Ws.contains(this.#Bs)?(this.#Ws.removeChild(this.#Bs),this.#Ws.removeChild(this.#js),this.#Ws.removeChild(this.#Hs),this.#Ws.removeChild(this.#Fs)):(this.#Bs=null,this.#js=null,this.#Hs=null,this.#Fs=null);const i=this.#Ws.getBoundingClientRect();this.#Us=(2*SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_WIDTH)*(t.clientX-i.x)/i.width;const n=SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.PROFILE_HEIGHT;this.#Bs=document.createElementNS(SVG_NS,"polyline"),this.#Bs.setAttributeNS(null,"points",String(this.#Us)+","+SvgProfileBuilder.PROFILE_MARGIN+" "+this.#Us+","+n),this.#Bs.setAttributeNS(null,"class","travelnotes-route-svg-profile-marker-polyline"),this.#Ws.appendChild(this.#Bs);const r=theDataSearchEngine.getRoute(Number.parseInt(this.#Ws.dataset.tanObjId));this.#zs=e.distance>r.distance/2?"end":"start",this.#Us+=e.distance>r.distance/2?-10:SvgProfileBuilder.X_DELTA_TEXT,this.#js=this.#Ks(theUtilities.formatDistance(e.distance),SvgProfileBuilder.PROFILE_MARGIN+SvgProfileBuilder.Y_DELTA_TEXT),this.#Hs=this.#Ks("Alt. "+e.elev.toFixed(0)+" m.",SvgProfileBuilder.PROFILE_MARGIN+2*SvgProfileBuilder.Y_DELTA_TEXT),this.#Fs=this.#Ks("Pente "+e.ascent.toFixed(0)+" % ",SvgProfileBuilder.PROFILE_MARGIN+3*SvgProfileBuilder.Y_DELTA_TEXT)}}}class ProfileDialog extends NonModalBaseDialog{#yn=null;#Vs;#Gs;#Zs;#Xs=null;#Ys=null;#qs=null;#Js=ObjId.nextObjId;#$s;#Qs(){this.#yn&&(this.#yn.removeEventListener("contextmenu",this.#Xs,!1),this.#yn.removeEventListener("mousemove",this.#Ys,!1),this.#yn.removeEventListener("mouseleave",this.#qs,!1),this.#Vs.removeChild(this.#yn),this.#yn=null,theEventDispatcher.dispatch("removeobject",{objId:this.#Js}),this.#Zs.textContent="",this.#Gs.textContent="")}setContent(t){this.#$s=t.objId,this.#Qs(),this.#yn=(new SvgProfileBuilder).createSvg(t),this.#yn.dataset.tanObjId=t.objId,this.#yn.dataset.tanMarkerObjId=this.#Js,this.#yn.addEventListener("contextmenu",this.#Xs,!1),this.#yn.addEventListener("mousemove",this.#Ys,!1),this.#yn.addEventListener("mouseleave",this.#qs,!1),this.#Vs.appendChild(this.#yn),this.setContentName(t)}setContentName(t){this.#Zs.textContent=theTranslator.getText("ProfileWindow - Route {name}",{name:t.computedName}),this.#Gs.textContent=theTranslator.getText("ProfileWindow - Ascent: {ascent} m. - Descent: {descent} m. - Distance: {distance}",{ascent:t.itinerary.ascent.toFixed(0),descent:t.itinerary.descent.toFixed(0),distance:theUtilities.formatDistance(t.distance)})}constructor(){super(),this.#Xs=new SvgContextMenuEL,this.#Ys=new SvgMouseMoveEL,this.#qs=new SvgMouseLeaveEL,this.#Vs=theHTMLElementsFactory.create("div",{className:"travelnotes-profile-dialog-svg-container"}),this.#Zs=theHTMLElementsFactory.create("div",{className:"travelnotes-profile-dialog-name-container"}),this.#Gs=theHTMLElementsFactory.create("div",{className:"travelnotes-profile-dialog-ascent-container"})}createContentHTML(){}onCancel(){this.#Qs(),super.onCancel(),theEventDispatcher.dispatch("profileclosed",{objId:this.#$s})}show(){super.show(),this.mover.moveDialogToTopLeft()}get contentHTMLElements(){return[this.#Vs,this.#Zs,this.#Gs]}get title(){return theTranslator.getText("ProfileWindow - Profile")}}class ProfileSmoothingIron{#gi;#tl;#el;get#ol(){return theConfig.route.elev.smoothPoints}#il(){this.#el=[],this.#el.push({distance:0,elev:this.#gi.itinerary.itineraryPoints.first.elev,smoothElev:this.#gi.itinerary.itineraryPoints.first.elev});const t=this.#gi.itinerary.itineraryPoints.iterator;t.done;let e=0,o=t.value.distance,i=t.value.elev;t.done;let n=this.#tl;for(;n<this.#gi.distance;){if(o<n)for(e=o,i=t.value.elev;o<n;)o+=t.value.distance,t.done;const r=i+(n-e)*((t.value.elev-i)/(o-e));this.#el.push({distance:n,elev:r,smoothElev:0}),n+=this.#tl}this.#el.push({distance:this.#gi.distance,elev:this.#gi.itinerary.itineraryPoints.last.elev,smoothElev:this.#gi.itinerary.itineraryPoints.last.elev})}#nl(){let t=(this.#el[this.#ol-1].elev-this.#el[0].elev)/(this.#ol-1),e=0;for(e=0;e<this.#ol;e++)this.#el[e].smoothElev=this.#el[0].elev+t*e;for(e=this.#ol;e<this.#el.length-this.#ol;e++){let t=0;for(let o=e-this.#ol;o<=e+this.#ol;o++)t+=this.#el[o].elev;this.#el[e].smoothElev=t/(2*this.#ol+1)}e--;const o=(this.#el[e+this.#ol].smoothElev-this.#el[e].smoothElev)/this.#ol;let i=this.#el[e].smoothElev,n=1;for(e++;e<this.#el.length-1;n++,e++)this.#el[e].smoothElev=i+o*n}#rl(){const t=this.#gi.itinerary.itineraryPoints.iterator;let e=0;for(;!t.done;)e+=t.next?Math.abs(t.value.elev-t.next.elev):0;this.#tl=Math.floor(Math.min(theConfig.route.elev.smoothCoefficient*this.#gi.distance/e,this.#gi.distance/(3*this.#ol)))}#al(){const t=this.#gi.itinerary.itineraryPoints.iterator;t.done;let e=t.value.distance;for(;!t.done;){const o=this.#el[Math.floor(e/this.#tl)],i=this.#el[Math.ceil(e/this.#tl)];if(o&&i){const n=e-o.distance,r=(i.elev-o.elev)/(i.distance-o.distance);t.value.elev=o.elev+n*r}e+=t.value.distance}}constructor(){Object.freeze(this)}smooth(t){this.#gi=t,this.#rl(),this.#il(),this.#nl(),this.#al()}}class ProfileDialogsManager{#sl=new Map;constructor(){Object.freeze(this)}createProfile(t){const e=this.#sl.get(t.objId);if(t.itinerary.hasProfile){theConfig.route.elev.smooth&&(new ProfileSmoothingIron).smooth(t);let o=0,i=0,n=t.itinerary.itineraryPoints.first.elev;t.itinerary.itineraryPoints.forEach(t=>{let e=t.elev-n;0>e?i-=e:o+=e,n=t.elev}),t.itinerary.ascent=o,t.itinerary.descent=i,e&&e.setContent(t)}else e&&e.onCancel()}updateProfileName(t){const e=this.#sl.get(t);if(e){const o=theDataSearchEngine.getRoute(t);o&&e.setContentName(o)}}updateProfile(t,e){const o=this.#sl.get(t);o&&(this.#sl.delete(t),e&&e.itinerary.hasProfile?(o.setContent(e),this.#sl.set(e.objId,o)):o.onCancel())}deleteProfile(t){const e=this.#sl.get(t);e&&e.onCancel()}deleteAllProfiles(){this.#sl.forEach(t=>t.onCancel())}showProfile(t){const e=theDataSearchEngine.getRoute(t);let o=this.#sl.get(t);o||(o=new ProfileDialog,o.setContent(e),o.show(),this.#sl.set(t,o))}onProfileClosed(t){this.#sl.delete(t)}}const theProfileDialogsManager=new ProfileDialogsManager;class PrintView{constructor(){Object.seal(this)}bottomLeft;upperRight;entryPoint;exitPoint}class PrintViewsFactory{#ll;#gi;#hl;#dl(t,e,o){return e.lng===o.lng?new LatLng(e.lat>o.lat?t.bottomLeft.lat:t.upperRight.lat,e.lng):e.lat===o.lat?new LatLng(e.lat,e.lng<o.lng?t.upperRight.lng:t.bottomLeft.lng):null}#cl(t,e){const o=1e-6;return e.lat-t.bottomLeft.lat<o||t.upperRight.lat-e.lat<o||e.lng-t.bottomLeft.lng<o||t.upperRight.lng-e.lng<o?LatLng.clone(e):null}#ul(t,e,o){if(t.bottomLeft.lat===t.upperRight.lat&&t.bottomLeft.lng===t.upperRight.lng){const t=Math.min(Math.abs(this.#hl.height/(o.lat-e.lat)),Math.abs(this.#hl.width/(o.lng-e.lng)));return new LatLng(e.lat+t*(o.lat-e.lat),e.lng+t*(o.lng-e.lng))}return null}#pl(t,e,o){let i=this.#ul(t,e,o);if(i)return i;if(i=this.#cl(t,e),i)return i;if(i=this.#dl(t,e,o),i)return i;const n=(e.lat-o.lat)/(e.lng-o.lng),r=e.lat-n*e.lng;if(i=new LatLng(n*t.upperRight.lng+r,t.upperRight.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng<o.lng)return i;if(i=new LatLng(t.upperRight.lat,(t.upperRight.lat-r)/n),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat<o.lat)return i;if(i=new LatLng(n*t.bottomLeft.lng+r,t.bottomLeft.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng>o.lng)return i;if(i=new LatLng(t.bottomLeft.lat,(t.bottomLeft.lat-r)/n),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat>o.lat)return i;throw new Error("intermediate point not found")}#ml(){this.#ll=[];const t=this.#gi.itinerary.itineraryPoints.iterator;let e=t.done,o=new PrintView;o.bottomLeft=LatLng.clone(t.value),o.upperRight=LatLng.clone(t.value),o.entryPoint=LatLng.clone(t.value);let i=t.value,n=LatLng.clone(t.value);e=t.done;let r=t.value;for(;!e;){const a=new PrintView;a.bottomLeft=new LatLng(Math.min(o.bottomLeft.lat,r.lat),Math.min(o.bottomLeft.lng,r.lng)),a.upperRight=new LatLng(Math.max(o.upperRight.lat,r.lat),Math.max(o.upperRight.lng,r.lng)),a.entryPoint=LatLng.clone(o.entryPoint),this.#hl.height>a.upperRight.lat-a.bottomLeft.lat&&this.#hl.width>a.upperRight.lng-a.bottomLeft.lng?(o=a,i=t.value,n=LatLng.clone(t.value),e=t.done,r=t.value,e&&(o.exitPoint=n,this.#ll.push(Object.freeze(o)))):(n=this.#pl(o,i,r),o.bottomLeft=new LatLng(Math.min(o.bottomLeft.lat,n.lat),Math.min(o.bottomLeft.lng,n.lng)),o.upperRight=new LatLng(Math.max(o.upperRight.lat,n.lat),Math.max(o.upperRight.lng,n.lng)),o.exitPoint=n,this.#ll.push(Object.freeze(o)),o=new PrintView,o.bottomLeft=LatLng.clone(n),o.upperRight=LatLng.clone(n),o.entryPoint=LatLng.clone(n))}}constructor(t,e){Object.freeze(this),this.#gi=t,this.#hl=e,this.#ml()}get printViews(){return this.#ll}}class ViewSize{#bt;#_r;constructor(t,e){Object.freeze(this),this.#bt=t,this.#_r=e}get width(){return this.#bt}get height(){return this.#_r}}class LayerToolbarButtonData{#he;#_t;#gl;constructor(t){if("string"!=typeof t?.text||"string"!=typeof t?.color||"string"!=typeof t?.backgroundColor)throw new Error("invalid toolbar for layer");Object.freeze(this),this.#he=theHTMLSanitizer.sanitizeToJsString(t.text),this.#_t=theHTMLSanitizer.sanitizeToColor(t.color),this.#gl=theHTMLSanitizer.sanitizeToColor(t.backgroundColor)}get text(){return this.#he}get color(){return this.#_t}get backgroundColor(){return this.#gl}}class MapLayer{#Z=null;#vl=null;#m=null;#fl=null;#Tl=null;#yl=null;#Ll=null;#El=null;#Ht=null;#bl=!1;#_l=null;#Ml=null;#wl(){if("string"!=typeof this.#Ml?.name)throw new Error("invalid name for layer");this.#Z=theHTMLSanitizer.sanitizeToJsString(this.#Ml.name)}#Dl(){if("wms"!==this.#Ml?.service&&"wmts"!==this.#Ml?.service)throw new Error("invalid service for layer "+this.#Z);this.#vl=this.#Ml.service}#Cl(){if("string"!=typeof this.#Ml?.url)throw new Error("invalid url for layer "+this.#Z);this.#m=this.#Ml.url}#Il(){if("wms"===this.#vl){if("string"!=typeof this.#Ml?.wmsOptions?.layers||"string"!=typeof this.#Ml?.wmsOptions?.format||"boolean"!=typeof this.#Ml?.wmsOptions?.transparent)throw new Error("invalid wmsOptions for layer "+this.#Z);this.#fl=this.#Ml.wmsOptions,this.#fl.layers=theHTMLSanitizer.sanitizeToJsString(this.#fl.layers),this.#fl.format=theHTMLSanitizer.sanitizeToJsString(this.#fl.format)}}#Nl(){try{this.#Ml.bounds&&"number"==typeof this.#Ml.bounds[0][0]&&"number"==typeof this.#Ml.bounds[0][1]&&"number"==typeof this.#Ml.bounds[1][0]&&"number"==typeof this.#Ml.bounds[1][1]&&(this.#Tl=this.#Ml.bounds)}catch{throw new Error("invalid bounds for layer "+this.#Z)}}#xl(){if(this.#Ml.minZoom){if("number"!=typeof this.#Ml.minZoom)throw new Error("invalid minZoom for layer "+this.#Z);this.#yl=this.#Ml.minZoom}if(this.#Ml.maxZoom){if("number"!=typeof this.#Ml.maxZoom)throw new Error("invalid maxZoom for layer "+this.#Z);this.#Ll=this.#Ml.maxZoom}}#Pl(){this.#El=new LayerToolbarButtonData(this.#Ml.toolbar)}#Sl(){if("string"!=typeof this.#Ml?.providerName)throw new Error("invalid providerName for layer "+this.#Z);this.#Ht=theHTMLSanitizer.sanitizeToJsString(this.#Ml.providerName)}#Ol(){if("boolean"!=typeof this.#Ml.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this.#Z);this.#bl=this.#Ml.providerKeyNeeded}#Al(){if(""===this.#Ml.attribution)this.#_l="";else{if("string"!=typeof this.#Ml?.attribution)throw new Error("invalid attribution for map layer "+this.#Z);this.#_l=theHTMLSanitizer.sanitizeToHtmlString(this.#Ml.attribution).htmlString}}constructor(t){Object.freeze(this),this.#Ml=t,this.#wl(),this.#Dl(),this.#Cl(),this.#Il(),this.#Nl(),this.#xl(),this.#Pl(),this.#Sl(),this.#Ol(),this.#Al(),this.#Ml=null}get name(){return this.#Z}get service(){return this.#vl}get url(){return this.#m}get wmsOptions(){return this.#fl}get bounds(){return this.#Tl}get minZoom(){return this.#yl}get maxZoom(){return this.#Ll}get toolbarButtonData(){return this.#El}get providerName(){return this.#Ht}get providerKeyNeeded(){return this.#bl}get attribution(){return this.#_l}}class MapLayersCollection{#Rl;#kl;#Bl;constructor(){Object.freeze(this),this.#Rl=new Map,this.#Bl=!1,this.#kl=new MapLayer({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}),this.#Rl.set(this.#kl.name,this.#kl)}getMapLayer(t){let e=this.#Rl.get(t)||this.#kl;return e.providerKeyNeeded&&(theApiKeysManager.hasKey(e.providerName.toLowerCase())||(e=this.#kl)),e}forEach(t){this.#Rl.forEach(t)}addMapLayers(t){this.#Bl||(t.forEach(t=>{const e=new MapLayer(t);this.#Rl.get(e.name)||this.#Rl.set(e.name,e)}),this.#Bl=!0)}get defaultMapLayer(){return this.#kl}}const theMapLayersCollection=new MapLayersCollection;class PrintEL{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class AfterPrintEL{#jl=null;constructor(t){Object.freeze(this),this.#jl=t}handleEvent(){this.#jl.onAfterPrint(),this.#jl=null}}class PrintPageBuilder{#Hl;#gi;#ll;#Fl;#zl;#Ee;#Ul;#Wl;#Kl;#Vl;#Gl;onAfterPrint(){this.#Wl.forEach(t=>document.body.removeChild(t)),this.#Wl.length=0,this.#zl.removeEventListener("click",this.#Vl,!1),this.#Ee.removeEventListener("click",this.#Gl,!1),document.body.removeChild(this.#Fl);const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.remove("travelnotes-hidden");theTravelNotesData.map.invalidateSize(!1),document.title="Travel & Notes"+(""===theTravelNotesData.travel.name?"":" - "+theTravelNotesData.travel.name),window.removeEventListener("afterprint",this.#Gl,!0),this.#Gl=null,this.#Vl=null}#Zl(){const t=theMapLayersCollection.getMapLayer(theTravelNotesData.travel.layerName),e=theApiKeysManager.getUrl(t),o="wmts"===t.service.toLowerCase()?new TileLayer(e):new TileLayer.WMS(e,t.wmsOptions);return o.options.attribution=theHTMLSanitizer.sanitizeToHtmlString(' Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t.attribution+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> ').htmlString,o}#Xl(){const t=[];return this.#gi.notes.forEach(e=>{const o=new DivIcon({iconSize:[e.iconWidth,e.iconHeight],iconAnchor:[e.iconWidth/2,e.iconHeight/2],popupAnchor:[0,-e.iconHeight/2],html:e.iconContent,className:"travelnotes-map-all-notes"}),i=new Marker(e.iconLatLng,{zIndexOffset:100,icon:o,draggable:!0});t.push(i)}),t}#Yl(t){this.#Ul++;const e="travelnotes-route-view-container-"+this.#Ul,o=document.createElement("div");o.className="travelnotes-route-view-container",o.id=e,document.body.appendChild(o),this.#Wl.push(o),o.style.width=String(this.#Hl.paperWidth)+"mm",o.style.height=String(this.#Hl.paperHeight)+"mm";const i=this.#Hl.printNotes?this.#Xl():[];i.push(this.#Zl()),i.push(new CircleMarker([t.entryPoint.lat,t.entryPoint.lng],theConfig.printRouteMap.entryPointMarker)),i.push(new CircleMarker([t.exitPoint.lat,t.exitPoint.lng],theConfig.printRouteMap.exitPointMarker)),i.push(this.#Kl),new Map$1(e,{attributionControl:!0,zoomControl:!1,center:[(t.bottomLeft.lat+t.upperRight.lat)/2,(t.bottomLeft.lng+t.upperRight.lng)/2],zoom:this.#Hl.zoomFactor,minZoom:this.#Hl.zoomFactor,maxZoom:this.#Hl.zoomFactor,layers:i})}#ql(){this.#Fl=theHTMLElementsFactory.create("div",{id:"travelnotes-print-toolbar"},document.body),this.#zl=theHTMLElementsFactory.create("div",{className:"travelnotes-ui-button",title:theTranslator.getText("PrintPageBuilder - Print"),textContent:"ðŸ–¨ï¸"},this.#Fl),this.#zl.addEventListener("click",this.#Vl,!1),this.#Ee=theHTMLElementsFactory.create("div",{className:"travelnotes-ui-button",title:theTranslator.getText("PrintPageBuilder - Cancel print"),textContent:"âŒ"},this.#Fl),this.#Ee.addEventListener("click",this.#Gl,!1)}constructor(t,e,o){Object.freeze(this),this.#gi=t,this.#ll=e,this.#Hl=o,this.#Ul=0,this.#Wl=[],this.#Vl=new PrintEL,this.#Gl=new AfterPrintEL(this)}preparePage(){this.#Hl.firefoxBrowser?document.body.classList.add("travelnotes-maps-firefox-browser"):document.body.classList.remove("travelnotes-maps-firefox-browser");const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.add("travelnotes-hidden");document.title=""===theTravelNotesData.travel.name?"maps":theTravelNotesData.travel.name+" - "+this.#gi.computedName+" - maps",this.#ql(),window.addEventListener("afterprint",this.#Gl,!0);const e=[],o=this.#gi.itinerary.itineraryPoints.iterator;for(;!o.done;)e.push(o.value.latLng);this.#Kl=new Polyline(e,{color:this.#gi.color,weight:this.#gi.width,dashArray:this.#gi.dashString}),this.#Ul=0,this.#ll.forEach(t=>this.#Yl(t))}}class RoutePrinter{#Jl=0;static get#$l(){return 256}#Ql(t){const e=theHTMLElementsFactory.create("div",{},document.body);e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width=String(t.paperWidth-2*t.borderWidth)+"mm",e.style.height=String(t.paperHeight-2*t.borderWidth)+"mm";const o=theGeometry.screenCoordToLatLng(0,0),i=theGeometry.screenCoordToLatLng(e.clientWidth,e.clientHeight);this.#Jl=Math.ceil(e.clientWidth/RoutePrinter.#$l)*Math.ceil(e.clientHeight/RoutePrinter.#$l),document.body.removeChild(e);const n=theTravelNotesData.map.getZoomScale(theTravelNotesData.map.getZoom(),t.zoomFactor);return new ViewSize(Math.abs(o[1]-i[1])*n,Math.abs(o[0]-i[0])*n)}constructor(){Object.freeze(this)}print(t,e){const o=theDataSearchEngine.getRoute(e);if(!o)return;const i=new PrintViewsFactory(o,this.#Ql(t));if(theConfig.printRouteMap.maxTiles<i.printViews.length*this.#Jl)return void theErrorsUI$1.showError(theTranslator.getText("RoutePrinter - The maximum of allowed pages is reached."));new PrintPageBuilder(o,i.printViews,t).preparePage()}}class TempWayPointMarkerELData{static marker=null;static initialLatLng=null}class TempWayPointMarkerMouseOutEL{static handleEvent(){TempWayPointMarkerELData.marker&&(DomEvent.off(TempWayPointMarkerELData.marker),theTravelNotesData.map.removeLayer(TempWayPointMarkerELData.marker),TempWayPointMarkerELData.marker=null)}}class RouteEditor{constructor(){Object.freeze(this)}addRoute(){const t=new Route;theTravelNotesData.travel.routes.add(t),this.chainRoutes(),ROUTE_EDITION_STATUS.editedChanged===theTravelNotesData.travel.editedRoute.editionStatus?(theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook")):this.editRoute(t.objId)}editRoute(t){const e=theDataSearchEngine.getRoute(t),o=e.itinerary.provider,i=thePluginsManager.providers.get(o.toLowerCase());if(o&&""!==o&&(!i||i.providerKeyNeeded&&!theApiKeysManager.hasKey(o)))return void theErrorsUI$1.showError(theTranslator.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:o}));-1!==theTravelNotesData.editedRouteObjId&&this.cancelEdition(),o&&""!==o&&theEventDispatcher.dispatch("setprovider",{provider:o});const n=e.itinerary.transitMode;n&&""!==n&&theEventDispatcher.dispatch("settransitmode",{transitMode:n}),theTravelNotesData.travel.editedRoute=new Route,e.editionStatus=ROUTE_EDITION_STATUS.editedNoChange,theTravelNotesData.travel.editedRoute.jsonObject=e.jsonObject,theTravelNotesData.editedRouteObjId=e.objId,theTravelNotesData.travel.editedRoute.hidden=!1,e.hidden=!1,theProfileDialogsManager.updateProfile(theTravelNotesData.editedRouteObjId,theTravelNotesData.travel.editedRoute),this.chainRoutes(),theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:e.objId,addedRouteObjId:theTravelNotesData.travel.editedRoute.objId}),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updatetravelproperties")}removeRoute(t){let e=t;e!==theTravelNotesData.editedRouteObjId&&e!==theTravelNotesData.travel.editedRoute.objId||(e=theTravelNotesData.editedRouteObjId,this.cancelEdition()),theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:-1}),theTravelNotesData.travel.routes.remove(e),theProfileDialogsManager.deleteProfile(e),this.chainRoutes(),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updatetravelproperties")}saveGpx(t){(new GpxFactory).routeToGpx(t)}chainRoutes(){const t=theTravelNotesData.travel.routes.iterator;let e=DISTANCE.defaultValue;for(;!t.done;){t.value.chain?(t.value.chainedDistance=e,e+=t.value.distance):t.value.chainedDistance=DISTANCE.defaultValue;const o=t.value.notes.iterator;for(;!o.done;)o.value.chainedDistance=t.value.chainedDistance;if(t.value.objId===theTravelNotesData.editedRouteObjId){theTravelNotesData.travel.editedRoute.chainedDistance=theTravelNotesData.travel.editedRoute.chain?t.value.chainedDistance:DISTANCE.defaultValue;const e=theTravelNotesData.travel.editedRoute.notes.iterator;for(;!e.done;)e.value.chainedDistance=theTravelNotesData.travel.editedRoute.chainedDistance}}}saveEdition(){const t=new Route;t.jsonObject=theTravelNotesData.travel.editedRoute.jsonObject,theTravelNotesData.travel.routes.replace(theTravelNotesData.editedRouteObjId,t),theTravelNotesData.editedRouteObjId=t.objId,this.cancelEdition()}cancelEdition(){TempWayPointMarkerMouseOutEL.handleEvent();const t=theDataSearchEngine.getRoute(theTravelNotesData.editedRouteObjId);t.editionStatus=ROUTE_EDITION_STATUS.notEdited,theProfileDialogsManager.updateProfile(theTravelNotesData.travel.editedRoute.objId,t),theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:theTravelNotesData.travel.editedRoute.objId,addedRouteObjId:theTravelNotesData.editedRouteObjId}),theTravelNotesData.editedRouteObjId=-1,theTravelNotesData.travel.editedRoute=new Route,this.chainRoutes(),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updatetravelproperties")}routeProperties(t){const e=theDataSearchEngine.getRoute(t);new RoutePropertiesDialog(e).show().then(()=>{this.chainRoutes(),e.haveValidWayPoints()&&theEventDispatcher.dispatch("routepropertiesupdated",{routeObjId:e.objId}),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateprofilename",{routeObjId:t})}).catch(t=>{t instanceof Error&&console.error(t)})}printRouteMap(t){(new PrintRouteMapDialog).show().then(e=>(new RoutePrinter).print(e,t)).catch(t=>{t instanceof Error&&console.error(t)})}showRoute(t){theDataSearchEngine.getRoute(t).hidden=!1,theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:t}),theEventDispatcher.dispatch("updatetravelproperties")}hideRoute(t){theDataSearchEngine.getRoute(t).hidden=!0,theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:-1}),theEventDispatcher.dispatch("updatetravelproperties")}showRoutes(){const t=theTravelNotesData.travel.routes.iterator;for(;!t.done;)t.value.hidden&&(t.value.hidden=!1,theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:t.value.objId}));theEventDispatcher.dispatch("updatetravelproperties")}hideRoutes(){const t=theTravelNotesData.travel.routes.iterator;for(;!t.done;)t.value.hidden||t.value.objId===theTravelNotesData.editedRouteObjId||(t.value.hidden=!0,theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:t.value.objId,addedRouteObjId:-1}));theEventDispatcher.dispatch("updatetravelproperties")}}const theRouteEditor=new RouteEditor;class PolylineEncoder{static get#th(){return.5}static get#eh(){return 5}static get#oh(){return 10}static get#ih(){return 31}static get#nh(){return 32}static get#rh(){return 63}#ah(t){return Math.floor(Math.abs(t)+PolylineEncoder.#th)*(0<=t?1:-1)}#sh(t,e,o){const i=this.#ah(t*o),n=this.#ah(e*o);let r=i-n;r<<=1,0>i-n&&(r=~r);let a="";for(;PolylineEncoder.#nh<=r;)a+=String.fromCharCode((PolylineEncoder.#nh|r&PolylineEncoder.#ih)+PolylineEncoder.#rh),r>>=PolylineEncoder.#eh;return a+=String.fromCharCode(r+PolylineEncoder.#rh),a}#r;#lh(t){let e=null,o=0,i=0;do{e=t.charCodeAt(this.#r++)-PolylineEncoder.#rh,i|=(e&PolylineEncoder.#ih)<<o,o+=PolylineEncoder.#eh}while(PolylineEncoder.#nh<=e);return 1&i?~(i>>1):i>>1}constructor(){Object.freeze(this)}encode(t,e){if(!t.length)return"";const o=e.length,i=Array.from(e,t=>Math.pow(PolylineEncoder.#oh,t));let n="";for(let e=0;e<o;e++)n+=this.#sh(t[0][e],0,i[e]);for(let e=1;e<t.length;e++){const r=t[e],a=t[e-1];for(let t=0;t<o;t++)n+=this.#sh(r[t],a[t],i[t])}return n}decode(t,e){const o=e.length;if(!t||0===t.length)return[];this.#r=0;const i=[],n=Array.from(e,t=>Math.pow(PolylineEncoder.#oh,t)),r=new Array(o).fill(0);for(;this.#r<t.length;){const e=new Array(o).fill(0);for(let i=0;i<o;i++)r[i]+=this.#lh(t),e[i]=r[i]/n[i];i.push(e)}return i}}class FileCompactor{#hh(t){const e={values:"",objType:(new ItineraryPoint).objType.jsonObject},o=[];t.itinerary.itineraryPoints.forEach(t=>{o.push([t.lat,t.lng,t.distance,t.elev,t.objId])}),e.values=(new PolylineEncoder).encode(o,[LAT_LNG.fixed,LAT_LNG.fixed,2,2,0]),t.itinerary.itineraryPoints=e}#dh(t){const e=[];if(t.itinerary.itineraryPoints.values)(new PolylineEncoder).decode(t.itinerary.itineraryPoints.values,[LAT_LNG.fixed,LAT_LNG.fixed,2,2,0]).forEach(o=>{const i={lat:LAT_LNG.defaultValue,lng:LAT_LNG.defaultValue,distance:DISTANCE.defaultValue,elev:ELEV.defaultValue,objId:-1};[i.lat,i.lng,i.distance,i.elev,i.objId]=o,i.objType=t.itinerary.itineraryPoints.objType,e.push(i)});else{t.itinerary.itineraryPoints.latLngs=(new PolylineEncoder).decode(t.itinerary.itineraryPoints.latLngs,[LAT_LNG.fixed,LAT_LNG.fixed]);let o=0;t.itinerary.itineraryPoints.latLngs.forEach(i=>{const n={};n.lat=i[0],n.lng=i[1],n.distance=t.itinerary.itineraryPoints.distances[o],t.itinerary.itineraryPoints.elevs?n.elev=t.itinerary.itineraryPoints.elevs[o]:n.elev=ELEV.defaultValue,n.objId=t.itinerary.itineraryPoints.objIds[o],n.objType=t.itinerary.itineraryPoints.objType,e.push(n),o++})}t.itinerary.itineraryPoints=e}constructor(){Object.freeze(this)}decompress(t){t.routes.forEach(this.#dh),t.editedRoute&&this.#dh(t.editedRoute)}compress(t){const e=t.jsonObject;return e.routes.forEach(t=>this.#hh(t)),this.#hh(e.editedRoute),e}}class ViewerFileLoader{constructor(){Object.freeze(this)}openDistantFile(t){(new FileCompactor).decompress(t),theTravelNotesData.travel.jsonObject=t,theTravelNotesData.travel.readOnly=!0,document.title="Travel & Notes"+(""===theTravelNotesData.travel.name?"":" - "+theTravelNotesData.travel.name);const e=theTravelNotesData.travel.routes.iterator;for(;!e.done;)ROUTE_EDITION_STATUS.notEdited===e.value.editionStatus?theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:e.value.objId}):theTravelNotesData.editedRouteObjId=e.value.objId;-1!==theTravelNotesData.editedRouteObjId&&theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:theTravelNotesData.travel.editedRoute.objId});const o=theTravelNotesData.travel.notes.iterator;for(;!o.done;)theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:o.value.objId});(new Zoomer).zoomToTravel()}}class AttributionsUI{#Xo=null;constructor(){Object.freeze(this)}createUI(){this.#Xo=theHTMLElementsFactory.create("div",{id:"travelnotes-attributions-ui"},document.body)}set attributions(t){const e='Â© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>';for(;this.#Xo.firstChild;)this.#Xo.removeChild(this.#Xo.firstChild);theHTMLSanitizer.sanitizeToHtmlElement(e,this.#Xo)}}const theAttributionsUI=new AttributionsUI;class MapLayersManager{constructor(){Object.freeze(this)}setMapLayer(t){const e=theMapLayersCollection.getMapLayer(t);theEventDispatcher.dispatch("layerchange",{layer:e}),theAttributionsUI.attributions=e.attribution,theTravelNotesData.travel.layerName=e.name}}const theMapLayersManager=new MapLayersManager;class ToolbarItemsCollection{toolbarItemsArray;constructor(){Object.seal(this),this.toolbarItemsArray=[]}}class ButtonHTMLElementPointerEL{#ch;#uh=0;#ph;#mh;constructor(t,e){Object.freeze(this),this.#ph=e,this.#ch=t}handleEvent(t){switch(t.type){case"pointerdown":this.#mh=t.target.dataset.tanItemId,this.#uh=t.screenY;break;case"pointerup":this.#mh===t.target.dataset.tanItemId&&this.#uh===t.screenY&&(this.#ph.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].doAction(),this.#ch.hide());break;case"pointerenter":case"pointerleave":this.#mh=-1}}}class ButtonsContainerWheelEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.currentTarget.scrollTop+=t.deltaY*MOUSE_WHEEL_FACTORS[t.deltaMode])}}class ButtonsContainerPointerEL{#gh=!1;#uh=0;constructor(){Object.freeze(this)}handleEvent(t){switch(t.type){case"pointerdown":this.#gh=!0,this.#uh=t.screenY;break;case"pointerup":this.#gh=!1,this.#uh=0;break;case"pointermove":if(this.#gh){const e=this.#uh-t.screenY;t.currentTarget.scrollTop+=e,this.#uh=t.screenY}}}}class BaseToolbar{#vh;#fh;#Th;#qo;#yh;#Lh;#Eh;#bh(t){switch(theDevice.setPointerType(t),theDevice.pointerType){case"mouse":break;case"touch":this.#_h?this.hide():this.#eo()}}#Mh(t){if(theDevice.setPointerType(t),this.#qo&&(clearTimeout(this.#qo),this.#qo=null),"mouse"===theDevice.pointerType)this.#_h||this.#eo()}#wh(t){if(theDevice.setPointerType(t),"mouse"===theDevice.pointerType)this.#_h&&(this.#qo=setTimeout(()=>this.hide(),theConfig.toolbars.timeOut))}#_h;#ph;#Dh(t,e){const o=theHTMLElementsFactory.create("div",{className:"travelnotes-base-toolbar-button",textContent:t.textContent,title:t.title,dataset:{ItemId:e}},this.#Th);o.addEventListener("pointerdown",this.#Eh,!1),o.addEventListener("pointerup",this.#Eh,!1),o.addEventListener("pointerenter",this.#Eh,!1),o.addEventListener("pointerleave",this.#Eh,!1)}#eo(){this.#Th=theHTMLElementsFactory.create("div",{className:"travelnotes-base-toolbar-buttons-container"},this.#vh),this.#ph.toolbarItemsArray=[],this.addToolbarItems(),this.#ph.toolbarItemsArray.forEach((t,e)=>{this.#Dh(t,e)}),this.#Th.addEventListener("wheel",this.#yh,{passive:!0}),this.#Th.addEventListener("pointerdown",this.#Lh,!1),this.#Th.addEventListener("pointerup",this.#Lh,!1),this.#Th.addEventListener("pointermove",this.#Lh,!1),this.#_h=!0}constructor(){Object.freeze(this)}addToolbarItems(){}hide(){for(this.#qo&&(clearTimeout(this.#qo),this.#qo=null);this.#Th.firstChild;){const t=this.#Th.firstChild;t.removeEventListener("pointerdown",this.#Eh,!1),t.removeEventListener("pointerup",this.#Eh,!1),t.removeEventListener("pointerenter",this.#Eh,!1),t.removeEventListener("pointerleave",this.#Eh,!1),this.#Th.removeChild(t)}this.#Th.removeEventListener("wheel",this.#yh,{passive:!0}),this.#Th.removeEventListener("pointerdown",this.#Lh,!1),this.#Th.removeEventListener("pointerup",this.#Lh,!1),this.#Th.removeEventListener("pointermove",this.#Lh,!1),this.#vh.removeChild(this.#Th),this.#Th=null,this.#_h=!1}createUI(t,e){if(this.#vh)return!1;this.#qo=null,this.#_h=!1,this.#ph=new ToolbarItemsCollection,this.#yh=new ButtonsContainerWheelEL,this.#Lh=new ButtonsContainerPointerEL,this.#Eh=new ButtonHTMLElementPointerEL(this,this.#ph),this.#vh=theHTMLElementsFactory.create("div",{className:"travelnotes-base-toolbar-container "+e},document.body),this.#vh.addEventListener("pointerenter",t=>this.#Mh(t),!1),this.#vh.addEventListener("pointerleave",t=>this.#wh(t),!1),this.#fh=theHTMLElementsFactory.create("div",{className:"travelnotes-base-toolbar-header"},this.#vh),this.#fh.addEventListener("pointerenter",t=>this.#bh(t),!1),theHTMLElementsFactory.create("div",{className:"travelnotes-base-toolbar-header-text",textContent:t},this.#fh)}addToolbarItem(t){this.#ph.toolbarItemsArray.push(t)}addCssClass(t){this.#vh.classList.add(t)}}class ToolbarItem{#Ch;#le;#Lr;constructor(t,e,o){this.#Ch=t,this.#Ch="function"==typeof t?t():t,this.#le=e,this.#Lr=o}get textContent(){return this.#Ch}get title(){return this.#le}doAction(){switch(typeof this.#Lr){case"string":{const t=document.createElement("a");t.href=this.#Lr,t.target="_blank",t.click()}break;case"function":this.#Lr()}}}class MapLayersToolbar extends BaseToolbar{constructor(){super()}createUI(){super.createUI(theTranslator.getText("MapLayersToolbar - Layers"),TOOLBAR_POSITION.topLeft),this.addCssClass(".travelnotes-maplayers-toolbar-container")}addToolbarItems(){theMapLayersCollection.forEach(t=>{(t.providerKeyNeeded&&theApiKeysManager.hasKey(t.providerName.toLowerCase())||!t.providerKeyNeeded)&&this.addToolbarItem(new ToolbarItem(t.toolbarButtonData.text,t.name,()=>{theMapLayersManager.setMapLayer(t.name)}))}),theConfig.mapLayersToolbar?.theDevil?.addButton&&this.addToolbarItem(new ToolbarItem("ðŸ‘¿","Reminder! The devil will know everything about you","https://www.google.com/maps/@"+theTravelNotesData.map.getCenter().lat+","+theTravelNotesData.map.getCenter().lng+","+theTravelNotesData.map.getZoom()+"z"))}}const theMapLayersToolbar=new MapLayersToolbar;class MouseUI{#Ih;#Nh;#xh;#Ph;#Sh;#Oh;#Ah;static get#Rh(){return 3e5}#kh(t){theTravelNotesData.map.setZoom(theTravelNotesData.map.getZoom()+t)}#Bh(){this.#Ih&&(this.#Ih.textContent="Â "+this.#Ph+"Â "+this.#Sh+"Â -Â ZoomÂ :Â "+String(this.#Oh)+"Â ");const t=theTravelNotesData.map;t.getMaxZoom()===this.#Oh?this.#Nh.classList.add("travelnotes-mouse-ui-disabled"):this.#Nh.classList.remove("travelnotes-mouse-ui-disabled"),t.getMinZoom()===this.#Oh?this.#xh.classList.add("travelnotes-mouse-ui-disabled"):this.#xh.classList.remove("travelnotes-mouse-ui-disabled")}constructor(){Object.freeze(this),this.#Ph=SAVE_STATUS.saved,this.#Sh="",this.#Oh=0,this.#Ah=null}set saveStatus(t){SAVE_STATUS.modified===t&&SAVE_STATUS.notSaved===this.#Ph||(this.#Ph=t,SAVE_STATUS.modified!==t||this.#Ah?SAVE_STATUS.saved===t&&this.#Ah&&(clearTimeout(this.#Ah),this.#Ah=null):this.#Ah=setTimeout(()=>this.#Ph=SAVE_STATUS.notSaved,MouseUI.#Rh),this.#Bh())}createUI(){const t=theHTMLElementsFactory.create("div",{id:"travelnotes-mouse-ui"},document.body);this.#xh=theHTMLElementsFactory.create("span",{id:"travelnotes-mouse-ui-zoom-minus",textContent:"â–¼"},t),this.#xh.addEventListener("click",()=>this.#kh(-1)),this.#Ih=theHTMLElementsFactory.create("span",null,t),this.#Nh=theHTMLElementsFactory.create("span",{id:"travelnotes-mouse-ui-zoom-plus",textContent:"â–²"},t),this.#Nh.addEventListener("click",()=>this.#kh(1)),this.#Oh=theTravelNotesData.map.getZoom(),this.#Sh=theUtilities.formatLat(theConfig.map.center.lat)+"Â -Â "+theUtilities.formatLng(theConfig.map.center.lng),theTravelNotesData.map.on("mousemove",t=>{this.#Sh=theUtilities.formatLatLng([t.latlng.lat,t.latlng.lng]),this.#Bh()}),theTravelNotesData.map.on("zoomend",()=>{this.#Oh=theTravelNotesData.map.getZoom(),this.#Bh()})}}const theMouseUI=new MouseUI;class AboutDialog extends NonModalBaseDialog{#jh=null;constructor(){super()}createContentHTML(){this.#jh=theHTMLElementsFactory.create("div",{id:"travelnotes-about-dialog-about"}),theHTMLSanitizer.sanitizeToHtmlElement('<p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2023 - wwwouaiebe</p><p>Contact : <a href="https://www.ouaie.be/pages/Contact" target="_blank">https://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank">https://github.com/wwwouaiebe/TravelNotes</a></p><p>Version : v5.0.0-dev.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p>',this.#jh)}show(){super.show(),this.mover.centerDialog()}get contentHTMLElements(){return[this.#jh]}get title(){return theTranslator.getText("AboutDialog - About Travel & Notes")}}class GeoLocator{#Hh=navigator.geolocation?GEOLOCATION_STATUS.inactive:GEOLOCATION_STATUS.disabled;#Fh=null;#zh(t){theEventDispatcher.dispatch("geolocationpositionchanged",{position:t})}#Uh(){GEOLOCATION_STATUS.active===this.#Hh&&(this.#Hh=GEOLOCATION_STATUS.inactive),theEventDispatcher.dispatch("geolocationstatuschanged",{status:this.#Hh}),this.#Fh&&(navigator.geolocation.clearWatch(this.#Fh),this.#Fh=null)}#Wh(t){1===t.code&&(this.#Hh=GEOLOCATION_STATUS.refusedByUser),2===t.code&&theErrorsUI$1.showError(theTranslator.getText("GeoLocator - Geolocation disabled on the device")),this.#Uh()}#Kh(){this.#Hh=GEOLOCATION_STATUS.active,theEventDispatcher.dispatch("geolocationstatuschanged",{status:this.#Hh}),theConfig.geoLocation.watch?this.#Fh=navigator.geolocation.watchPosition(t=>this.#zh(t),t=>this.#Wh(t),theConfig.geoLocation.options):navigator.geolocation.getCurrentPosition(t=>this.#zh(t),t=>this.#Wh(t),theConfig.geoLocation.options)}constructor(){Object.freeze(this)}get status(){return this.#Hh}switch(){switch(this.#Hh){case GEOLOCATION_STATUS.inactive:this.#Kh();break;case GEOLOCATION_STATUS.active:this.#Uh()}return this.#Hh}}const theGeoLocator=new GeoLocator;class SaveAsDialogData{#Vh;#Gh;#Zh;constructor(t,e,o){Object.freeze(this),this.#Vh=t,this.#Gh=e,this.#Zh=o}get removeTravelNotes(){return this.#Vh}get removeRoutesNotes(){return this.#Gh}get removeManeuvers(){return this.#Zh}}class SaveAsDialog extends ModalBaseDialog{#Xh;#Yh;#qh;constructor(t){super(t)}createContentHTML(){this.#Xh=new CheckboxInputControl({afterText:theTranslator.getText("SaveAsDialog - Remove Travel Notes"),checked:!1}),this.#Yh=new CheckboxInputControl({afterText:theTranslator.getText("SaveAsDialog - Remove Routes Notes"),checked:!1}),this.#qh=new CheckboxInputControl({afterText:theTranslator.getText("SaveAsDialog - Remove Maneuvers"),checked:!1})}onOk(){super.onOk(new SaveAsDialogData(this.#Xh.checked,this.#Yh.checked,this.#qh.checked))}get contentHTMLElements(){return[this.#Xh.controlHTMLElement,this.#Yh.controlHTMLElement,this.#qh.controlHTMLElement]}get title(){return theTranslator.getText("SaveAsDialog - SaveAs")}}class TravelEditor{#Jh(t){const e=new Travel;e.jsonObject=theTravelNotesData.travel.jsonObject,e.name+="-partial";let o=e.routes.iterator;for(;!o.done;)o.value.hidden=!1;if(t.removeTravelNotes&&e.notes.removeAll(),t.removeRoutesNotes)for(o=e.routes.iterator;!o.done;)o.value.notes.removeAll();if(t.removeManeuvers)for(o=e.routes.iterator;!o.done;)o.value.itinerary.maneuvers.removeAll();const i=(new FileCompactor).compress(e);theUtilities.saveFile(i.name+".json",JSON.stringify(i),"application/json")}#$h(){return""!==theTravelNotesData.travel.name||(theErrorsUI$1.showError(theTranslator.getText("TravelEditor - Gives a name to the travel")),theEventDispatcher.dispatch("showtravelproperties"),!1)}constructor(){Object.freeze(this)}routeDropped(t,e,o){const i=t===theTravelNotesData.travel.editedRoute.objId?theTravelNotesData.editedRouteObjId:t,n=e===theTravelNotesData.travel.editedRoute.objId?theTravelNotesData.editedRouteObjId:e;theTravelNotesData.travel.routes.moveTo(i,n,o),theRouteEditor.chainRoutes(),theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook")}saveAsTravel(){if(this.#$h())return-1!==theTravelNotesData.editedRouteObjId?(theErrorsUI$1.showError(theTranslator.getText("TravelEditor - Not possible to partial save when a route is edited.")),void theEventDispatcher.dispatch("showtravelproperties")):void(new SaveAsDialog).show().then(t=>{this.#Jh(t)}).catch(t=>{t instanceof Error&&console.error(t)})}saveTravel(){if(!this.#$h())return;const t=theTravelNotesData.travel.routes.iterator;for(;!t.done;)t.value.hidden=!1;const e=(new FileCompactor).compress(theTravelNotesData.travel);theUtilities.saveFile(e.name+".json",JSON.stringify(e),"application/json"),theMouseUI.saveStatus=SAVE_STATUS.saved}newTravel(){theConfig.travelNotes.haveBeforeUnloadWarning&&!window.confirm(theTranslator.getText("TravelEditor - This page ask to close; data are perhaps not saved."))||(theProfileDialogsManager.deleteAllProfiles(),theEventDispatcher.dispatch("removeallobjects"),theTravelNotesData.editedRouteObjId=-1,theTravelNotesData.travel.jsonObject=(new Travel).jsonObject,theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updatetravelnotes"),theConfig.travelNotes.startupRouteEdition&&theRouteEditor.editRoute(theTravelNotesData.travel.routes.first.objId),theMouseUI.saveStatus=SAVE_STATUS.saved)}}const theTravelEditor=new TravelEditor;class DockableBaseDialogMover extends BaseDialogMover$1{#Qh;#td(){this.onTop?(this.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-docked"),this.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-hidden-content"),this.dialogHTMLElement.style.top="0px",this.#Qh=!0):(this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-docked"),this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-hidden-content"),this.#Qh=!1)}constructor(){super(),this.#Qh=!1}get dialogDocked(){return this.#Qh}centerDialog(){this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-docked"),this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-hidden-content"),super.centerDialog()}moveDialogTo(t,e,o){super.moveDialogTo(t,e,o),o&&"touchmove"===o||this.#td()}}class DockableBaseDialog extends NonModalBaseDialog{#ge;#ve;#ed;#od;#id;#_h;static get#nd(){return 100}static get#rd(){return 1500}#ad(){this.mover.dialogDocked&&(BaseContextMenu.isActive?this.#ed=setTimeout(()=>{this.#ad()},Math.max(DockableBaseDialog.#rd,theConfig.dockableBaseDialog.timeout)):this.mover.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-hidden-content"))}#sd(t){this.#id=t.timeStamp,this.#ed&&(clearTimeout(this.#ed),this.#ed=null),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-hidden-content")}#ld(){this.mover.dialogDocked&&(this.#ed=setTimeout(()=>{this.#ad()},Math.max(DockableBaseDialog.#rd,theConfig.dockableBaseDialog.timeout)))}#hd(t){t.preventDefault(),DockableBaseDialog.#nd>t.timeStamp-this.#id||this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.toggle("travelnotes-dockable-base-dialog-hidden-content")}constructor(t,e){super(),this.#ge=t,this.#ve=e,this.#ed=null,this.#od=null,this.#id=0,this.#_h=!1}get mover(){return this.#od?this.#od:this.#od=new DockableBaseDialogMover}onCancel(){super.onCancel(),this.#_h=!1,this.#od&&(this.#od=null)}show(){this.#_h||(super.show(),this.addCssClass("travelnotes-dockable-base-dialog"),this.updateContent(),null!==this.#ge&&null!==this.#ve?(this.mover.moveDialogTo(this.#ge,this.#ve),this.#ge=null,this.#ve=null):this.mover.moveDialogToLastPosition(),this.mover.dialogHTMLElement.addEventListener("mouseenter",t=>this.#sd(t),!1),theConfig.dockableBaseDialog.hideOnMouseLeave&&this.mover.dialogHTMLElement.addEventListener("mouseleave",()=>this.#ld(),!1),this.mover.topBarHTMLElement.addEventListener("click",t=>this.#hd(t),!1),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-hidden-content"),this.#_h=!0)}}class DictionaryItem{#Z="";#dd=!1;#cd=[];#ud=["node","way","relation"];#pd=[];#md=!1;#gd=!1;#t=-1;constructor(t,e){this.#Z=theHTMLSanitizer.sanitizeToJsString(t),e&&(this.#gd=!0,this.#dd=!0),this.#t=ObjId.nextObjId,Object.freeze(this)}get name(){return this.#Z}get isRoot(){return this.#dd}get items(){return this.#cd}get elementTypes(){return this.#ud}setElementType(t){-1!==["node","way","relation"].indexOf(t)&&(this.#ud=[t])}get filterTagsArray(){return this.#pd}get isSelected(){return this.#md}set isSelected(t){this.#md=t,this.items.forEach(e=>{e.isSelected=t})}get isExpanded(){return this.#gd}set isExpanded(t){this.#gd=t}get objId(){return this.#t}}class OsmSearchDictionary{#vd;#fd;#Td;#yd;#Ld(t){const e=t.split(";");for(;""===e[e.length-1];)e.pop();let o=0;const i=[];e.forEach(t=>{if(""!==t)if(-1===t.indexOf("="))this.#Td=new DictionaryItem(t),this.#fd.set(this.#Td.objId,this.#Td),this.#yd[o].push(this.#Td),this.#yd[o+1]=this.#Td.items;else{let e=t.split("=");if("element"===e[0])this.#Td.setElementType(e[1]);else{let t={};t[e[0]]="*"===e[1]?null:e[1],i.push(t)}}o++}),0!==i.length&&this.#Td.filterTagsArray.push(i)}#Ed(t){t.items.forEach(t=>{this.#Ed(t)}),t.isExpanded=!0}#bd(t){t.items.forEach(t=>{this.#bd(t)}),t.isExpanded=!1}constructor(){this.#vd=new DictionaryItem("",!0),this.#fd=new Map,this.#fd.set(this.#vd.objId,this.#vd),this.#yd=[this.#vd.items],Object.freeze(this)}get dictionary(){return this.#vd}parseDictionary(t){t.split(/\r\n|\r|\n/).forEach(t=>{""!==t&&this.#Ld(t)})}selectItem(t,e){this.#fd.get(t).isSelected=e}unselectAll(){this.#vd.isSelected=!1}expandItem(t){let e=this.#fd.get(t);e.isExpanded=!e.isExpanded}expand(){this.#Ed(this.#vd)}collapse(){this.#vd.items.forEach(t=>this.#bd(t))}}const theOsmSearchDictionary=new OsmSearchDictionary;class ClearButtonClickEL{#_d;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),theOsmSearchDictionary.unselectAll(),this.#_d.redraw()}}class CollapseButtonClickEL{#_d;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),theOsmSearchDictionary.collapse(),this.#_d.redraw()}}class ExpandTreeButtonClickEL{#_d;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),theOsmSearchDictionary.expand(),this.#_d.redraw()}}class OsmSearchEngine{#Md;#wd;#Dd;static get#Cd(){return 5e3}#Id(t,e){let o=!0;return e.forEach(e=>{const[i,n]=Object.entries(e)[0];o=o&&t.tags[i]&&(!n||t.tags[i]===n)}),o}#Nd(t,e){this.#wd.forEach(o=>{o.filterTagsArray.forEach(i=>{this.#Id(t,i)&&(t.description=o.name,e.set(t.id,t))})})}#xd(){const t=[],e=new Map;this.#wd.forEach(t=>{t.filterTagsArray.forEach(o=>{const[i,n]=Object.entries(o[0])[0];let r=e.get(i);r||(r={values:new Map,elements:new Map},e.set(i,r)),r.values.set(n,n),t.elementTypes.forEach(t=>{r.elements.set(t,t)})})});const o=this.#Pd();this.#Dd=o;const i="("+o.getSouthWest().lat.toFixed(LAT_LNG.fixed)+","+o.getSouthWest().lng.toFixed(LAT_LNG.fixed)+","+o.getNorthEast().lat.toFixed(LAT_LNG.fixed)+","+o.getNorthEast().lng.toFixed(LAT_LNG.fixed)+")";return e.forEach((e,o)=>{let n='"'+o+'"';if(1===e.values.size){const t=e.values.values().next().value;t&&(n+='="'+t+'"')}else 1<e.values.size&&(n+='~"',e.values.forEach(t=>{n+=t+"|"}),n=n.substring(0,n.length-1)+'"');if(theConfig.overpassApi.useNwr){const o=1===e.elements.size?e.elements.values().next().value:"nwr";t.push(o+"["+n+"]"+i+";"+("node"===o?"":"(._;>;);")+"out;")}else{let o=[];1===e.elements.size?o.push(e.elements.values().next().value):o=["node","way","rel"],o.forEach(e=>{t.push(e+"["+n+"]"+i+";"+("node"===e?"":"(._;>;);")+"out;")})}}),t}#Sd(t){t.isSelected&&0<t.filterTagsArray.length&&this.#wd.push(t),t.items.forEach(t=>this.#Sd(t))}#Pd(){const t=theTravelNotesData.map.getCenter(),e=theTravelNotesData.map.getBounds(),o=theGeometry.getSquareBoundingBox([t.lat,t.lng],OsmSearchEngine.#Cd);return e.getSouthWest().lat=Math.max(e.getSouthWest().lat,o.getSouthWest().lat),e.getSouthWest().lng=Math.max(e.getSouthWest().lng,o.getSouthWest().lng),e.getNorthEast().lat=Math.min(e.getNorthEast().lat,o.getNorthEast().lat),e.getNorthEast().lng=Math.min(e.getNorthEast().lng,o.getNorthEast().lng),e}constructor(){Object.freeze(this),this.#Md=!1,this.#wd=[],this.#Dd=null}async search(){if(this.#Md)return;this.#Md=!0,this.#wd=[],this.#Sd(theOsmSearchDictionary.dictionary);const t=new OverpassAPIDataLoader({searchPlaces:!1});await t.loadData(this.#xd());const e=new Map;t.statusOk||theErrorsUI$1.showError(theTranslator.getText("OsmSearchEngine - incomplete results")),[t.nodes,t.ways,t.relations].forEach(t=>{t.forEach(t=>{t.tags&&this.#Nd(t,e)})}),theTravelNotesData.searchData.length=0,Array.from(e.values()).sort((t,e)=>t.description>e.description).forEach(t=>theTravelNotesData.searchData.push(t)),this.#Md=!1,theEventDispatcher.dispatch("updateosmsearch")}get searchBounds(){return this.#Pd()}get previousSearchBounds(){return this.#Dd}}const theOsmSearchEngine=new OsmSearchEngine;class SearchButtonClickEL{#_d;#Od;constructor(t,e){Object.freeze(this),this.#_d=t,this.#Od=e}handleEvent(t){t.stopPropagation(),theOsmSearchDictionary.dictionary.isExpanded=!1,this.#_d.redraw(),theTravelNotesData.searchData.length=0,theEventDispatcher.dispatch("updateosmsearch"),this.#Od.showWait(),theOsmSearchEngine.search()}}class OsmSearchToolbarButtons{#Ad;constructor(t,e){Object.freeze(this),this.#Ad=theHTMLElementsFactory.create("div"),theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("OsmSearchToolbarButtons - Start the search"),textContent:"ðŸ”Ž"},this.#Ad).addEventListener("click",new SearchButtonClickEL(t,e),!1),theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("OsmSearchToolbarButtons - Expand the tree"),textContent:"â–¼"},this.#Ad).addEventListener("click",new ExpandTreeButtonClickEL(t),!1),theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("OsmSearchToolbarButtons - Collapse the tree"),textContent:"â–¶"},this.#Ad).addEventListener("click",new CollapseButtonClickEL(t),!1),theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button",title:theTranslator.getText("OsmSearchToolbarButtons - Clear the tree"),textContent:"âŒ"},this.#Ad).addEventListener("click",new ClearButtonClickEL(t),!1)}get toolbarButtonsHTMLElement(){return this.#Ad}}class TreeArrowClickEL{#_d=null;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),theOsmSearchDictionary.expandItem(Number.parseInt(t.target.parentNode.dataset.tanObjId)),this.#_d.redraw()}}class TreeWheelEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.target.scrollTop+=t.deltaY*MOUSE_WHEEL_FACTORS[t.deltaMode]),t.stopPropagation()}}class TreeCheckboxChangeEL{#_d=null;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),theOsmSearchDictionary.selectItem(Number.parseInt(t.target.parentNode.dataset.tanObjId),t.target.checked),this.#_d.redraw()}}class OsmSearchTree{#Rd;#kd;#Bd;#jd;#Hd(t){this.#jd++;const e=theHTMLElementsFactory.create("div",{className:"travelnotes-osm-search-dialog-search-item-margin"+this.#jd,dataset:{ObjId:t.objId}},this.#Rd);if(!t.isRoot){theHTMLElementsFactory.create("input",{type:"checkbox",checked:t.isSelected},e).addEventListener("change",this.#Bd,!1)}if(0===t.filterTagsArray.length){theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-button travelnotes-osm-search-dialog-tree-arrow",textContent:t.isExpanded?"â–¼":"â–¶"},e).addEventListener("click",this.#kd,!1)}theHTMLElementsFactory.create("text",{value:t.name},e),t.isExpanded&&t.items.forEach(t=>this.#Hd(t)),this.#jd--}constructor(){Object.freeze(this),this.#jd=0,this.#Rd=theHTMLElementsFactory.create("div",{id:"travelnotes-osm-search-dialog-search-tree"}),this.#Rd.addEventListener("wheel",new TreeWheelEL,{passive:!0}),this.#Bd=new TreeCheckboxChangeEL(this),this.#kd=new TreeArrowClickEL(this),this.#Hd(theOsmSearchDictionary.dictionary)}redraw(){this.#Rd.textContent="",this.#Hd(theOsmSearchDictionary.dictionary)}get treeHTMLElement(){return this.#Rd}}class OsmSearchWait{#Be;constructor(){this.#Be=theHTMLElementsFactory.create("div",{className:"travelnotes-wait-animation"}),theHTMLElementsFactory.create("div",{className:"travelnotes-wait-animation-bullet"},this.#Be),this.#Be.classList.add("travelnotes-hidden")}showWait(){this.#Be.classList.remove("travelnotes-hidden")}hideWait(){this.#Be.classList.add("travelnotes-hidden")}get waitHTMLElement(){return this.#Be}}class WayPointPropertiesDialogEventListeners{#us;constructor(t,e){Object.freeze(this),this.#us=new AddressButtonClickEL(t,e)}destructor(){this.#us=null}get addressButtonClick(){return this.#us}}class WayPointPropertiesDialog extends ModalBaseDialog{#Fd;#zd;#Es;#Ds;constructor(t){super(),this.#Fd=t,this.#Ds=new WayPointPropertiesDialogEventListeners(this,this.#Fd.latLng)}createContentHTML(){this.#zd=new TextInputControl({headerText:theTranslator.getText("WayPointPropertiesDialog - Name")},this.#Ds),this.#zd.value=this.#Fd.name,this.#Es=new AddressControl(this.#Ds),this.#Es.address=this.#Fd.address}onCancel(){this.#Ds.destructor(),super.onCancel()}onOk(){this.#Fd.address=this.#Es.address,this.#Fd.name=this.#zd.value,this.#Ds.destructor(),super.onOk()}get contentHTMLElements(){return[this.#zd.controlHTMLElement,this.#Es.controlHTMLElement]}set name(t){this.#zd.name=t}set address(t){this.#Es.address=t}get title(){return theTranslator.getText("WayPointPropertiesDialog - Waypoint properties")}get wayPoint(){return this.#Fd}setControlsValues(t){this.#Es.address=t.address,this.#zd.value=t.name}}class Router{#Ud;#Wd;#Kd(t){const e=t.itinerary.itineraryPoints.iterator,o=t.itinerary.maneuvers.iterator;for(e.done,o.done,o.value.distance=DISTANCE.defaultValue,o.done,t.distance=DISTANCE.defaultValue,t.duration=DISTANCE.defaultValue;!e.done;)e.previous.distance=theSphericalTrigonometry.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,o.previous.distance+=e.previous.distance,o.value.itineraryPointObjId===e.value.objId&&(t.duration+=o.previous.duration,o.value.distance=DISTANCE.defaultValue,o.next&&o.value.itineraryPointObjId===o.next.itineraryPointObjId&&(o.done,o.value.distance=DISTANCE.defaultValue),o.done)}#Vd(t){this.#Ud=!1,t instanceof Error?(console.error(t),theErrorsUI$1.showError(t.message)):theErrorsUI$1.showError("A network error occurs when calling the provider")}#Gd(){if(this.#Ud=!1,this.#Kd(theTravelNotesData.travel.editedRoute),"circle"!==theTravelNotesData.travel.editedRoute.itinerary.transitMode){const t=theTravelNotesData.travel.editedRoute.wayPoints.iterator;for(;!t.done;)t.first?t.value.latLng=theTravelNotesData.travel.editedRoute.itinerary.itineraryPoints.first.latLng:t.last?t.value.latLng=theTravelNotesData.travel.editedRoute.itinerary.itineraryPoints.last.latLng:t.value.latLng=theGeometry.getClosestLatLngDistance(theTravelNotesData.travel.editedRoute,t.value.latLng).latLng}const t=theTravelNotesData.travel.editedRoute.notes.iterator;for(;!t.done;){const e=theGeometry.getClosestLatLngDistance(theTravelNotesData.travel.editedRoute,t.value.latLng);t.value.latLng=e.latLng,t.value.distance=e.distance}theRouteEditor.chainRoutes(),theTravelNotesData.travel.editedRoute.notes.sort((t,e)=>t.distance-e.distance),this.#Wd&&(new Zoomer).zoomToRoute(theTravelNotesData.travel.editedRoute.objId),theProfileDialogsManager.createProfile(theTravelNotesData.travel.editedRoute),theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:theTravelNotesData.travel.editedRoute.objId,addedRouteObjId:theTravelNotesData.travel.editedRoute.objId}),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updatetravelproperties")}constructor(){Object.freeze(this)}startRouting(){if(!this.#Ud&&theTravelNotesData.travel.editedRoute.haveValidWayPoints()){this.#Wd=0===theTravelNotesData.travel.editedRoute.itinerary.itineraryPoints.length,this.#Ud=!0;const t=thePluginsManager.providers.get(theTravelNotesData.routing.provider.toLowerCase());theTravelNotesData.travel.editedRoute.itinerary.provider=t.name,theTravelNotesData.travel.editedRoute.itinerary.transitMode=theTravelNotesData.routing.transitMode,t.getPromiseRoute(theTravelNotesData.travel.editedRoute).then(()=>this.#Gd()).catch(()=>this.#Vd())}}}const theRouter=new Router;class WayPointEditor{async#Zd(t){if(!theConfig.wayPoint.reverseGeocoding)return theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook"),void theEventDispatcher.dispatch("updateprofilename",{routeObjId:theTravelNotesData.editedRouteObjId});const e=await(new GeoCoder).getAddressAsync(t.latLng);theTravelNotesData.editedRouteObjId===theTravelNotesData.travel.editedRoute.objId&&(theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged),t.address=e.street,""!==e.city&&(t.address+=" "+e.city),t.name="",theConfig.wayPoint.geocodingIncludeName&&(t.name=e.name),theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook"),theEventDispatcher.dispatch("updateprofilename",{routeObjId:theTravelNotesData.travel.editedRoute.objId})}#Xd(t){const e=theTravelNotesData.travel.editedRoute.wayPoints.first;e.latLng=t,this.#Zd(e),theEventDispatcher.dispatch("addwaypoint",{wayPoint:e,letter:"A"})}#Yd(t){const e=theTravelNotesData.travel.editedRoute.wayPoints.last;e.latLng=t,this.#Zd(e),theEventDispatcher.dispatch("addwaypoint",{wayPoint:e,letter:"B"})}constructor(){Object.freeze(this)}addWayPoint(t){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged;const e=new WayPoint;e.latLng=t,theTravelNotesData.travel.editedRoute.wayPoints.add(e),this.#Zd(e),theEventDispatcher.dispatch("addwaypoint",{wayPoint:theTravelNotesData.travel.editedRoute.wayPoints.last,letter:theTravelNotesData.travel.editedRoute.wayPoints.length-2}),theTravelNotesData.travel.editedRoute.wayPoints.swap(e.objId,!0),theRouter.startRouting()}addWayPointOnRoute(t,e){const o=theGeometry.getClosestLatLngDistance(theTravelNotesData.travel.editedRoute,t).distance;theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged;const i=new WayPoint;i.latLng=e;let n="";const r=theTravelNotesData.travel.editedRoute.wayPoints.iterator;for(;!r.done;){if(o<theGeometry.getClosestLatLngDistance(theTravelNotesData.travel.editedRoute,r.value.latLng).distance){n=String(r.index),theTravelNotesData.travel.editedRoute.wayPoints.add(i),theTravelNotesData.travel.editedRoute.wayPoints.moveTo(i.objId,r.value.objId,!0),this.#Zd(i),theEventDispatcher.dispatch("addwaypoint",{wayPoint:i,letter:n}),theRouter.startRouting();break}}}reverseWayPoints(){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged;let t=theTravelNotesData.travel.editedRoute.wayPoints.iterator;for(;!t.done;)theEventDispatcher.dispatch("removeobject",{objId:t.value.objId});for(theTravelNotesData.travel.editedRoute.wayPoints.reverse(),t=theTravelNotesData.travel.editedRoute.wayPoints.iterator;!t.done;)theEventDispatcher.dispatch("addwaypoint",{wayPoint:t.value,letter:t.first?"A":t.last?"B":String(t.index)});theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook"),theRouter.startRouting()}removeWayPoint(t){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged,theEventDispatcher.dispatch("removeobject",{objId:t}),theTravelNotesData.travel.editedRoute.wayPoints.remove(t),theRouter.startRouting()}setStartPoint(t){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged,this.#Xd(t),theRouter.startRouting()}setEndPoint(t){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged,this.#Yd(t),theRouter.startRouting()}setStartAndEndPoint(t){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged,this.#Xd(t),this.#Yd(t),2<theTravelNotesData.travel.editedRoute.wayPoints.length&&theRouter.startRouting()}wayPointDragEnd(t){theTravelNotesData.travel.editedRoute.editionStatus=ROUTE_EDITION_STATUS.editedChanged;const e=theTravelNotesData.travel.editedRoute.wayPoints.getAt(t.target.objId),o=t.target.getLatLng();e.latLng=[o.lat,o.lng],this.#Zd(e),theRouter.startRouting()}wayPointProperties(t){const e=theTravelNotesData.travel.editedRoute.wayPoints.getAt(t);new WayPointPropertiesDialog(e).show().then(()=>{theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook")}).catch(t=>{t instanceof Error&&console.error(t)})}}const theWayPointEditor=new WayPointEditor;class PoiData{#nr;#Ns;constructor(t,e){this.#nr=t,this.#Ns=e}get latLng(){return this.#nr}get geometry(){return this.#Ns}}class OsmSearchContextMenu extends BaseContextMenu{#qd;#nr;constructor(t,e){super(t,e),this.#qd=theTravelNotesData.searchData[Number.parseInt(t.currentTarget.dataset.tanElementIndex)],this.#nr=[this.#qd.lat,this.#qd.lon],theEventDispatcher.dispatch("removeobject",{objId:this.targetObjId})}get menuItems(){return[new MenuItem(theTranslator.getText("OsmSearchContextMenu - Select this point as start point"),-1!==theTravelNotesData.editedRouteObjId&&LAT_LNG.defaultValue===theTravelNotesData.travel.editedRoute.wayPoints.first.lat,()=>theWayPointEditor.setStartPoint(this.#nr)),new MenuItem(theTranslator.getText("OsmSearchContextMenu - Select this point as way point"),-1!==theTravelNotesData.editedRouteObjId,()=>theWayPointEditor.addWayPoint(this.#nr)),new MenuItem(theTranslator.getText("OsmSearchContextMenu - Select this point as end point"),-1!==theTravelNotesData.editedRouteObjId&&LAT_LNG.defaultValue===theTravelNotesData.travel.editedRoute.wayPoints.last.lat,()=>theWayPointEditor.setEndPoint(this.#nr)),new MenuItem(theTranslator.getText("OsmSearchContextMenu - Create a route note with this result"),!0,()=>theNoteEditor.newSearchRouteNote(this.#qd)),new MenuItem(theTranslator.getText("OsmSearchContextMenu - Create a travel note with this result"),!0,()=>theNoteEditor.newSearchTravelNote(this.#qd)),new MenuItem(theTranslator.getText(theNoteEditor.osmSearchNoteDialog?"OsmSearchContextMenu - Hide note dialog":"OsmSearchContextMenu - Show note dialog"),!0,()=>theNoteEditor.changeOsmSearchNoteDialog()),new MenuItem(theTranslator.getText("OsmSearchContextMenu - Zoom to this result"),!0,()=>(new Zoomer).zoomToPoi(new PoiData(this.#nr,this.#qd.geometry)))]}}class TouchListItemEL{#Jd;#$d;#Qd;#tc;#ec;#oc;#ic;#nc;#rc;#ac;#sc;#lc;#hc;#dc;static get#cc(){return 1e3}static get#uc(){return 40}static get#pc(){return 5}static get#mc(){return 200}static get#gc(){return 100}#vc(t){t!==this.#tc&&TouchListItemEL.#uc<t-this.#tc&&(this.#ic.scrollTop-=TouchListItemEL.#pc,this.#tc=t),this.#nc>this.#ac&&0<this.#ic.scrollTop&&window.requestAnimationFrame(t=>{this.#vc(t)})}#fc(t){t!==this.#tc&&TouchListItemEL.#uc<t-this.#tc&&(this.#ic.scrollTop+=TouchListItemEL.#pc,this.#tc=t);let e=1>Math.abs(this.#ic.scrollHeight-this.#ic.clientHeight-this.#ic.scrollTop);this.#rc<this.#ac&&!e&&window.requestAnimationFrame(t=>{this.#fc(t)})}#ne(t){const e=t.changedTouches.item(0);if(1===t.touches.length){if(TouchListItemEL.#cc<t.timeStamp-this.#Qd||0===this.#Qd)return void(this.#Qd=t.timeStamp);t.preventDefault(),this.#$d=!0,this.#oc=t.currentTarget.parentNode,this.#ic=t.currentTarget.parentNode.parentNode.parentNode,this.#ac=e.screenY;const o=t.currentTarget.getBoundingClientRect();this.#hc=e.screenX-o.left,this.#dc=e.screenY-o.top,this.#ec=t.currentTarget.cloneNode(!0),this.#ec.classList.add("travelnotes-sortable-list-dragged-item"),document.body.appendChild(this.#ec),this.#ec.style.left=String(e.screenX-this.#hc)+"px",this.#ec.style.top=String(e.screenY-this.#dc)+"px",this.#nc=this.#oc.getBoundingClientRect().y-this.#ic.getBoundingClientRect().y+this.#ic.scrollTop+TouchListItemEL.#mc,this.#rc=this.#ic.getBoundingClientRect().bottom-TouchListItemEL.#gc}}#ie(t){if(!this.#$d)return;const e=t.changedTouches.item(0);if(1===t.touches.length&&this.#ec){this.#ec.style.left=String(e.screenX-this.#hc)+"px",this.#ec.style.top=String(e.screenY-this.#dc)+"px",this.#ac=e.screenY,this.#nc>this.#ac&&0<this.#ic.scrollTop&&window.requestAnimationFrame(t=>{this.#vc(t)});let t=1>Math.abs(this.#ic.scrollHeight-this.#ic.clientHeight-this.#ic.scrollTop);this.#rc<this.#ac&&!t&&window.requestAnimationFrame(t=>{this.#fc(t)})}}#Tc(t){this.#oc.childNodes.forEach(e=>{let o=e.getBoundingClientRect();o.left<t.clientX&&o.right>t.clientX&&o.top<t.clientY&&o.bottom>t.clientY&&(this.#sc=e,this.#lc=t.clientY-o.top<o.height/2)})}#oe(t){if(this.#$d){let e=t.changedTouches.item(0);if(this.#Tc(e),this.#sc)try{this.#Jd(Number.parseInt(t.currentTarget.dataset.tanObjId),Number.parseInt(this.#sc.dataset.tanObjId),this.#lc)}catch{}}this.#yc()}#yc(){this.#ec&&document.body.removeChild(this.#ec),this.#ec=null,this.#ic=null,this.#$d=!1,this.#tc=0,this.#oc=null,this.#nc=0,this.#rc=0,this.#ac=0,this.#sc=null,this.#lc=!0}constructor(t){Object.freeze(this),this.#Jd=t,this.#ec=null,this.#Qd=0,this.#yc()}handleEvent(t){switch(t.type){case"touchstart":this.#ne(t);break;case"touchmove":this.#ie(t);break;case"touchend":this.#oe(t);break;case"touchcancel":this.#yc()}}}class DragStartListItemEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();try{t.dataTransfer.setData("ObjId",t.target.dataset.tanObjId),t.dataTransfer.dropEffect="move"}catch(t){t instanceof Error&&console.error(t)}}}class DropListItemEL{#Jd;constructor(t){Object.freeze(this),this.#Jd=t}handleEvent(t){t.preventDefault();const e=t.currentTarget.getBoundingClientRect();try{this.#Jd(Number.parseInt(t.dataTransfer.getData("ObjId")),Number.parseInt(t.currentTarget.dataset.tanObjId),t.clientY-e.top<e.bottom-t.clientY)}catch{}}}class ContextMenuListItemEL{#Lc;constructor(t){Object.freeze(this),this.#Lc=t}handleEvent(t){t.stopPropagation(),t.preventDefault(),new this.#Lc(t,t.target.parentNode).show()}}class SortableListControl extends BaseControl{#Ec;#bc;#_c;#Mc;#oc;constructor(t,e,o){super(),this.#Ec=new DragStartListItemEL,this.#bc=new DropListItemEL(t),this.#_c=new ContextMenuListItemEL(e),this.#Mc=new TouchListItemEL(t),o&&theHTMLElementsFactory.create("div",{className:"travelnotes-base-dialog-flex-row",textContent:o},this.controlHTMLElement),this.#oc=theHTMLElementsFactory.create("div",{className:"travelnotes-sortable-list-container"},this.controlHTMLElement)}updateContent(t){for(;this.#oc.firstChild;)this.#oc.firstChild.removeEventListener("dragstart",this.#Ec,!1),this.#oc.firstChild.removeEventListener("drop",this.#bc,!1),this.#oc.firstChild.removeEventListener("contextmenu",this.#_c,!1),this.#oc.firstChild.removeEventListener("touchstart",this.#Mc,!1),this.#oc.firstChild.removeEventListener("touchmove",this.#Mc,!1),this.#oc.firstChild.removeEventListener("touchend",this.#Mc,!1),this.#oc.removeChild(this.#oc.firstChild);t.forEach(t=>{t.draggable=!0,t.addEventListener("dragstart",this.#Ec,!1),t.addEventListener("drop",this.#bc,!1),t.addEventListener("contextmenu",this.#_c,!1),t.addEventListener("touchstart",this.#Mc,!1),t.addEventListener("touchmove",this.#Mc,!1),t.addEventListener("touchend",this.#Mc,!1),this.#oc.appendChild(t),t.classList.add("travelnotes-sortable-list-item")})}}class OsmSearchResultsHTMLBuilder{#wc;#qd;#Dc;static get#fa(){return 40}#Cc(){let t="";t=this.#qd.tags.rcn_ref?"<div class='travenNotes-map-note travenNotes-map-note-category-0073'><svg viewBox='0 0 20 20'><text class='' x=10 y=14>"+this.#qd.tags.rcn_ref+"</text></svg></div>":theNoteDialogToolbarData.preDefinedIconDataFromName(this.#qd.description)||"";const e=theHTMLElementsFactory.create("div",{className:"travelnotes-osm-search-dialog-search-result-icon-cell"},this.#wc);theHTMLSanitizer.sanitizeToHtmlElement(t,e)}#Ic(t){t&&theHTMLElementsFactory.create("div",{textContent:t},this.#Dc)}#Ka(){const t=(this.#qd.tags["addr:street"]?(this.#qd.tags["addr:housenumber"]?this.#qd.tags["addr:housenumber"]+" ":"")+this.#qd.tags["addr:street"]+" ":"")+(this.#qd.tags["addr:city"]?(this.#qd.tags["addr:postcode"]?this.#qd.tags["addr:postcode"]+" ":"")+this.#qd.tags["addr:city"]:"");""!==t&&this.#Ic(t)}#Nc(){this.#qd.tags.phone&&this.#Ic("â˜Žï¸ : "+this.#qd.tags.phone,this.#Dc)}#xc(){this.#qd.tags.email&&theHTMLElementsFactory.create("a",{href:"mailto:"+this.#qd.tags.email,textContent:this.#qd.tags.email},theHTMLElementsFactory.create("div",{textContent:"ðŸ“§ : "},this.#Dc))}#Pc(){this.#qd.tags.website&&theHTMLElementsFactory.create("a",{href:this.#qd.tags.website,target:"_blank",textContent:this.#qd.tags.website.length>OsmSearchResultsHTMLBuilder.#fa?this.#qd.tags.website.substring(0,OsmSearchResultsHTMLBuilder.#fa)+"...":this.#qd.tags.website},theHTMLElementsFactory.create("div",null,this.#Dc))}#Sc(){this.#Dc=theHTMLElementsFactory.create("div",{className:"travelnotes-osm-search-dialog-search-result-cell"},this.#wc),this.#Ic(this.#qd.description),this.#Ic(this.#qd.tags.name),this.#Ic(this.#qd.tags.rcn_ref),this.#Ka(),this.#Nc(),this.#xc(),this.#Pc()}#Oc(){for(const[t,e]of Object.entries(this.#qd.tags))this.#wc.title+=t+"="+e+"\n"}constructor(){Object.freeze(this)}buildHTMLElement(t,e){return this.#qd=t,this.#wc=theHTMLElementsFactory.create("div",{className:"travelnotes-osm-search-dialog-search-result-row",dataset:{ObjId:ObjId.nextObjId,ElementIndex:e}}),this.#Cc(),this.#Sc(),this.#Oc(),this.#wc}}class OsmSearchLimits{#Ac;#Rc;#kc(){-1===this.#Rc?this.#Rc=ObjId.nextObjId:theEventDispatcher.dispatch("removeobject",{objId:this.#Rc}),theEventDispatcher.dispatch("addrectangle",{objId:this.#Rc,bounds:theOsmSearchEngine.searchBounds,properties:theConfig.osmSearch.nextSearchLimit})}#Bc(){const t=theOsmSearchEngine.previousSearchBounds;t&&(-1===this.#Ac?this.#Ac=ObjId.nextObjId:theEventDispatcher.dispatch("removeobject",{objId:this.#Ac}),theEventDispatcher.dispatch("addrectangle",{objId:this.#Ac,bounds:[[t.getSouthWest().lat,t.getSouthWest().lng],[t.getNorthEast().lat,t.getNorthEast().lng]],properties:theConfig.osmSearch.previousSearchLimit}))}constructor(){Object.freeze(this),this.#Ac=-1,this.#Rc=-1}show(){theTravelNotesData.map.on("zoom",this.#kc,this),theTravelNotesData.map.on("move",this.#kc,this),this.#kc(),this.#Bc()}hide(){theTravelNotesData.map.off("zoom",this.#kc,this),theTravelNotesData.map.off("move",this.#kc,this),-1!==this.#Rc&&(theEventDispatcher.dispatch("removeobject",{objId:this.#Rc}),this.#Rc=-1),-1!==this.#Ac&&(theEventDispatcher.dispatch("removeobject",{objId:this.#Ac}),this.#Ac=-1)}}class SearchResultMouseEnterEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();const e=theTravelNotesData.searchData[Number.parseInt(t.target.dataset.tanElementIndex)];theEventDispatcher.dispatch("addsearchpointmarker",{objId:Number.parseInt(t.target.dataset.tanObjId),latLng:[e.lat,e.lon],geometry:e.geometry})}}class SearchResultMouseLeaveEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theEventDispatcher.dispatch("removeobject",{objId:Number.parseInt(t.target.dataset.tanObjId)})}}class OsmSearchDialog extends DockableBaseDialog{#jc;#Eo;#Hc;#_d;#Od;#Fc;#zc;#Uc;#ql(){this.#Eo=theHTMLElementsFactory.create("div"),this.#_d=new OsmSearchTree,this.#Od=new OsmSearchWait;const t=new OsmSearchToolbarButtons(this.#_d,this.#Od);this.#Eo.appendChild(t.toolbarButtonsHTMLElement),this.#Eo.appendChild(this.#_d.treeHTMLElement),this.#Eo.appendChild(this.#Od.waitHTMLElement)}constructor(){super(theConfig.osmSearchDialog.dialogX,theConfig.osmSearchDialog.dialogY)}createContentHTML(){this.#ql(),this.#Hc=new SortableListControl(null,OsmSearchContextMenu),this.#Fc=new OsmSearchResultsHTMLBuilder,this.#jc=new OsmSearchLimits,this.#zc=new SearchResultMouseEnterEL,this.#Uc=new SearchResultMouseLeaveEL}get contentHTMLElements(){return[].concat(this.#Hc.controlHTMLElement)}get title(){return theTranslator.getText("OsmSearchDialog - Searching OpenStreetMap")}get toolbarHTMLElement(){return this.#Eo}onCancel(){this.#jc.hide(),super.onCancel()}show(){super.show(),this.#jc.show()}updateContent(){this.#Od.hideWait(),this.#jc.hide(),this.#jc.show();const t=[];theTravelNotesData.searchData.forEach((e,o)=>{const i=this.#Fc.buildHTMLElement(e,o);i.addEventListener("mouseenter",this.#zc,!1),i.addEventListener("mouseleave",this.#Uc,!1),t.push(i)}),this.#Hc.updateContent(t)}}class TwoButtonsDialog extends ModalBaseDialog{#Wc;constructor(t){super(t)}createContentHTML(){this.#Wc=theHTMLElementsFactory.create("div",{textContent:this.options.text||""})}get contentHTMLElements(){return[this.#Wc]}get title(){return this.options.title||""}}class AllManeuverNotesBuilder{#gi=null;#Kc=0;#Vc(t){const e=new Note;for(const o in t)e[o]=t[o];e.iconLatLng=e.latLng,e.distance=theGeometry.getClosestLatLngDistance(this.#gi,e.latLng).distance,e.chainedDistance=this.#gi.chainedDistance,this.#gi.notes.add(e),theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:e.objId})}async#Gc(){const t=new WaitUI;t.createUI();const e=new MapIconFromOsmFactory,o=this.#gi.itinerary.maneuvers.iterator;for(;!o.done;){t.showInfo(theTranslator.getText("AllManeuverNotesBuilder - Creating note",{noteNumber:o.index+1,notesLength:this.#Kc}));const i=this.#gi.itinerary.itineraryPoints.getAt(o.value.itineraryPointObjId).latLng,n=await e.getIconAndAdressAsync(i,this.#gi);n?this.#Vc(n):console.error("An error occurs when creating the svg icon "+o.index)}this.#gi.notes.sort((t,e)=>t.distance-e.distance),theEventDispatcher.dispatch("updateroadbook"),t.close()}constructor(){Object.freeze(this)}addAllManeuverNotes(t){this.#gi=theDataSearchEngine.getRoute(t),this.#Kc=this.#gi.itinerary.maneuvers.length,theConfig.note.maxManeuversNotes<this.#Kc?theErrorsUI$1.showError(theTranslator.getText("AllManeuverNotesBuilder - max maneuvers notes reached {maneuversLength}{maxManeuversNotes}",{maneuversLength:this.#Kc,maxManeuversNotes:theConfig.note.maxManeuversNotes})):new TwoButtonsDialog({title:theTranslator.getText("AllManeuverNotesBuilder - Add a note for each maneuver"),text:theTranslator.getText("AllManeuverNotesBuilder - Add a note for each maneuver. Are you sure?",{noteLength:this.#Kc}),secondButtonText:"âŒ"}).show().then(()=>this.#Gc()).catch(t=>{t instanceof Error&&console.error(t)})}}class RouteContextMenu extends BaseContextMenu{#gi=null;constructor(t,e){super(t,e),this.#gi=theDataSearchEngine.getRoute(this.targetObjId)}get menuItems(){return[new MenuItem(theTranslator.getText("RouteContextMenu - Edit this route"),this.targetObjId!==theTravelNotesData.travel.editedRoute.objId&&ROUTE_EDITION_STATUS.editedChanged!==theTravelNotesData.travel.editedRoute.editionStatus,()=>theRouteEditor.editRoute(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - Delete this route"),this.targetObjId!==theTravelNotesData.travel.editedRoute.objId||ROUTE_EDITION_STATUS.editedChanged!==theTravelNotesData.travel.editedRoute.editionStatus,()=>theRouteEditor.removeRoute(this.targetObjId)),new MenuItem(theTranslator.getText(this.#gi.hidden?"RouteContextMenu - Show this route":"RouteContextMenu - Hide this route"),this.#gi.hidden||theTravelNotesData.travel.editedRoute.objId!==this.targetObjId,()=>{this.#gi.hidden?theRouteEditor.showRoute(this.targetObjId):theRouteEditor.hideRoute(this.targetObjId)}),new MenuItem(theTranslator.getText("RouteContextMenu - Properties"),!this.#gi.hidden,()=>theRouteEditor.routeProperties(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - Zoom to route"),!this.#gi.hidden,()=>(new Zoomer).zoomToRoute(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - View the elevation"),this.#gi.itinerary.hasProfile,()=>theProfileDialogsManager.showProfile(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - Print route map"),theConfig.printRouteMap.isEnabled,()=>theRouteEditor.printRouteMap(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - Save this route in a GPX file"),0<this.#gi.itinerary.itineraryPoints.length,()=>theRouteEditor.saveGpx(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - Invert waypoints"),theTravelNotesData.travel.editedRoute.objId===this.targetObjId,()=>theWayPointEditor.reverseWayPoints()),new MenuItem(theTranslator.getText("RouteContextMenu - Add a note on the route"),!this.haveParentNode,()=>theNoteEditor.newRouteNote(this.targetObjId,this.latLng)),new MenuItem(theTranslator.getText("RouteContextMenu - Create a note for each route maneuver"),!this.#gi.hidden,()=>(new AllManeuverNotesBuilder).addAllManeuverNotes(this.targetObjId)),new MenuItem(theTranslator.getText("RouteContextMenu - Save modifications on this route"),theTravelNotesData.travel.editedRoute.objId===this.targetObjId,()=>theRouteEditor.saveEdition()),new MenuItem(theTranslator.getText("RouteContextMenu - Cancel modifications on this route"),theTravelNotesData.travel.editedRoute.objId===this.targetObjId,()=>theRouteEditor.cancelEdition())]}}class TravelNameChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theTravelNotesData.travel.name=theHTMLSanitizer.sanitizeToJsString(t.target.value),document.title="Travel & Notes"+(""===theTravelNotesData.travel.name?"":" - "+theTravelNotesData.travel.name),theEventDispatcher.dispatch("updateroadbook")}}class TravelPropertiesDialog extends DockableBaseDialog{#Zc=null;#Xc=null;constructor(){super(theConfig.travelPropertiesDialog.dialogX,theConfig.travelPropertiesDialog.dialogY)}createContentHTML(){this.#Zc=new TextInputControl(theTranslator.getText("TravelPropertiesDialog - Name"),{controlChange:new TravelNameChangeEL}),this.#Zc.value=theTravelNotesData.travel.name,this.#Xc=new SortableListControl(theTravelEditor.routeDropped,RouteContextMenu,theTranslator.getText("TravelPropertiesDialog - Routes"))}get contentHTMLElements(){return[this.#Zc.controlHTMLElement,this.#Xc.controlHTMLElement]}get title(){return theTranslator.getText("TravelPropertiesDialog - Travel properties")}#Ci(t,e){const o=(t.editionStatus===ROUTE_EDITION_STATUS.notEdited?"":"ðŸ”´Â ")+(t.chain?"â›“Â ":"")+(t.objId===theTravelNotesData.editedRouteObjId?theTravelNotesData.travel.editedRoute.computedName:t.computedName);e.push(theHTMLElementsFactory.create("div",{textContent:o,dataset:{ObjId:String(t.objId)}}))}updateContent(){if(!this.#Xc)return;const t=[];theTravelNotesData.travel.routes.forEach(e=>{e.objId===theTravelNotesData.editedRouteObjId?this.#Ci(theTravelNotesData.travel.editedRoute,t):this.#Ci(e,t)}),this.#Xc.updateContent(t),this.#Zc.value=theTravelNotesData.travel.name}}class NoteContextMenu extends BaseContextMenu{#gi;constructor(t,e){super(t,e),this.#gi=theDataSearchEngine.getNoteAndRoute(this.targetObjId).route}get menuItems(){return[new MenuItem(theTranslator.getText("NoteContextMenu - Edit this note"),!0,()=>theNoteEditor.editNote(this.targetObjId)),new MenuItem(theTranslator.getText("NoteContextMenu - Delete this note"),!0,()=>theNoteEditor.removeNote(this.targetObjId)),new MenuItem(theTranslator.getText("NoteContextMenu - Zoom to note"),!0,()=>(new Zoomer).zoomToNote(this.targetObjId)),new MenuItem(theTranslator.getText(this.#gi?"NoteContextMenu - Detach note from route":"NoteContextMenu - Attach note to route"),-1===theTravelNotesData.editedRouteObjId,()=>{this.#gi?theNoteEditor.detachNoteFromRoute(this.targetObjId):theNoteEditor.attachNoteToRoute(this.targetObjId)})]}}class TravelNotesDialog extends DockableBaseDialog{#Yc;constructor(){super(theConfig.travelNotesDialog.dialogX,theConfig.travelNotesDialog.dialogY)}createContentHTML(){this.#Yc=new SortableListControl(theNoteEditor.travelNoteDropped,NoteContextMenu)}get contentHTMLElements(){return[this.#Yc.controlHTMLElement]}get title(){return theTranslator.getText("TravelNotesDialog - Travel notes dialog")}updateContent(){if(!this.#Yc)return;let t=theNoteHTMLViewsFactory.getTravelNotesHTML("travelnotes-travel-notes-dialog-");this.#Yc.updateContent(Array.from(t.childNodes))}}class DockableDialogsManager{#qc=null;#Jc=null;#$c=null;constructor(){Object.freeze(this)}get osmSearchDialog(){return this.#qc||(this.#qc=new OsmSearchDialog(theConfig.osmSearchDialog.dialogX,theConfig.osmSearchDialog.dialogY)),this.#qc}get travelPropertiesDialog(){return this.#Jc||(this.#Jc=new TravelPropertiesDialog(theConfig.travelPropertiesDialog.dialogX,theConfig.travelPropertiesDialog.dialogY)),this.#Jc}get travelNotesDialog(){return this.#$c||(this.#$c=new TravelNotesDialog(theConfig.travelNotesDialog.dialogX,theConfig.travelNotesDialog.dialogY)),this.#$c}showTravelProperties(){this.travelPropertiesDialog.show(),this.travelPropertiesDialog.mover.centerDialog()}}const theDockableDialogsManager=new DockableDialogsManager;class FullScreenUI{constructor(){Object.freeze(this)}async toggle(){document.fullscreenElement?await document.exitFullscreen():await document.body.requestFullscreen()}}const theFullScreenUI=new FullScreenUI;class FontSizeManager{#Qc;constructor(){Object.freeze(this),this.#Qc=null}increment(){this.#Qc||(this.#Qc=theConfig.fontSize.initialValue),this.#Qc+=theConfig.fontSize.incrementValue,document.body.style["font-size"]=String(this.#Qc)+"mm"}decrement(){this.#Qc||(this.#Qc=theConfig.fontSize.initialValue),this.#Qc-=theConfig.fontSize.incrementValue,document.body.style["font-size"]=String(this.#Qc)+"mm"}}const theFontSizeManager=new FontSizeManager;class GpxParser{#tu;#kt;#gi;#eu;#ou(t){let e=new ItineraryPoint;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("ele"===o[t].nodeName)e.elev=Number.parseFloat(o[t].textContent),0!==e.elev&&(this.#gi.itinerary.hasProfile=!0);this.#gi.itinerary.itineraryPoints.add(e)}#iu(t){const e=t.childNodes;for(let t=0;t<e.length;t++)if("trkpt"===e[t].nodeName)this.#ou(e[t])}#nu(){let t=0,e=0,o=this.#gi.itinerary.itineraryPoints.iterator;for(o.done;!o.done;){let i=o.value.elev-o.previous.elev;0>i?e-=i:t+=i}this.#gi.itinerary.ascent=t,this.#gi.itinerary.descent=e}#ru(t){this.#gi=new Route;const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#gi.name=e[t].textContent;break;case"trkseg":this.#iu(e[t])}this.#gi.itinerary.hasProfile&&this.#nu(),this.#kt.routes.add(this.#gi)}#au(t){let e=Number.MAX_VALUE,o=-1;return this.#gi.itinerary.itineraryPoints.forEach(i=>{const n=theSphericalTrigonometry.pointsDistance(t,i.latLng);n<e&&(e=n,o=i.objId)}),o}#su(t){const e=new Maneuver;e.iconName="kUndefined";const o=Number.parseFloat(t.getAttributeNS(null,"lat")),i=Number.parseFloat(t.getAttributeNS(null,"lon"));e.itineraryPointObjId=this.#au([o,i]);const n=t.childNodes;for(let t=0;t<n.length;t++)if("desc"===n[t].nodeName)e.instruction=n[t].textContent;this.#gi.itinerary.maneuvers.add(e)}#lu(t){const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#gi.name=e[t].textContent;break;case"rtept":this.#su(e[t])}}#hu(t){const e=new Note;e.latLng=t.latLng,e.iconLatLng=t.latLng;const o=t.name.split("+");e.iconContent='<div class="travenNotes-map-note travelnotes-map-note-category-0073"><svg viewBox="0 0 20 20"><text x="10" y="14">'+o[0]+"</text></svg></div>",e.tooltipContent=theTranslator.getText("GpxParser - Network node")+o[0],o[1]&&(e.tooltipContent+=theTranslator.getText("GpxParser - Go to network node")+o[1]),e.distance=theGeometry.getClosestLatLngDistance(this.#gi,e.latLng).distance,this.#gi.notes.add(e)}#du(t){let e=new WayPoint;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("name"===o[t].nodeName)e.name=o[t].textContent;this.#gi.wayPoints.add(e),this.#eu&&this.#hu(e)}#cu(t){for(let e=0;e<t.length;e++)this.#du(t[e])}#uu(){this.#kt.routes.forEach(t=>{t.wayPoints.remove(t.wayPoints.first.objId),t.wayPoints.remove(t.wayPoints.last.objId);const e=new WayPoint;e.latLng=t.itinerary.itineraryPoints.first.latLng,t.wayPoints.add(e);const o=new WayPoint;o.latLng=t.itinerary.itineraryPoints.last.latLng,t.wayPoints.add(o)})}#Kd(t){const e=t.itinerary.itineraryPoints.iterator,o=t.itinerary.maneuvers.iterator;e.done;let i=o.done;for(i||(o.value.distance=DISTANCE.defaultValue,i=o.done),t.distance=DISTANCE.defaultValue,t.duration=DISTANCE.defaultValue;!e.done;)e.previous.distance=theSphericalTrigonometry.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,i||(o.previous.distance+=e.previous.distance,o.value.itineraryPointObjId===e.value.objId&&(t.duration+=o.previous.duration,o.value.distance=DISTANCE.defaultValue,o.next&&o.value.itineraryPointObjId===o.next.itineraryPointObjId&&(i=o.done,o.value.distance=DISTANCE.defaultValue),i=o.done))}constructor(){Object.freeze(this)}parse(t){this.#tu=(new DOMParser).parseFromString(t,"text/xml"),this.#eu=Boolean(this.#tu.querySelector("gpx").getAttributeNS(null,"creator").match(/fietsnet|knooppuntnet/g)),this.#kt=new Travel,this.#kt.routes.remove(this.#kt.routes.first.objId);const e=this.#tu.querySelectorAll("trk");for(let t=0;t<e.length;t++)this.#ru(e[t]);const o=this.#tu.querySelectorAll("rte");1===o.length&&1===this.#kt.routes.length&&this.#lu(o[0]),this.#kt.routes.forEach(t=>this.#Kd(t));const i=this.#tu.querySelectorAll("wpt");return 0<i.length&&1===this.#kt.routes.length?(this.#gi.wayPoints.remove(this.#gi.wayPoints.first.objId),this.#gi.wayPoints.remove(this.#gi.wayPoints.last.objId),this.#cu(i)):this.#uu(),this.#kt}}class FileLoader{#pu(){theEventDispatcher.dispatch("removeallobjects"),document.title="Travel & Notes"+(""===theTravelNotesData.travel.name?"":" - "+theTravelNotesData.travel.name);const t=theTravelNotesData.travel.routes.iterator;for(;!t.done;)ROUTE_EDITION_STATUS.notEdited===t.value.editionStatus&&theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:t.value.objId});-1!==theTravelNotesData.editedRouteObjId&&theEventDispatcher.dispatch("routeupdated",{removedRouteObjId:-1,addedRouteObjId:theTravelNotesData.travel.editedRoute.objId});const e=theTravelNotesData.travel.notes.iterator;for(;!e.done;)theEventDispatcher.dispatch("noteupdated",{removedNoteObjId:-1,addedNoteObjId:e.value.objId});if(theEventDispatcher.dispatch("updatetravelnotes"),(new Zoomer).zoomToTravel(),theMapLayersManager.setMapLayer(theTravelNotesData.travel.layerName),-1!==theTravelNotesData.editedRouteObjId){const t=theTravelNotesData.travel.editedRoute.itinerary.provider;if(""===t||thePluginsManager.providers.get(t.toLowerCase())){theEventDispatcher.dispatch("setprovider",{provider:t});const e=theTravelNotesData.travel.editedRoute.itinerary.transitMode;""!==e&&theEventDispatcher.dispatch("settransitmode",{transitMode:e})}else theErrorsUI$1.showError(theTranslator.getText("FileLoader - Not possible to select as provider",{provider:t}))}theRouteEditor.chainRoutes(),theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook")}constructor(){Object.freeze(this)}openLocalGpxFile(t){theProfileDialogsManager.deleteAllProfiles(),theTravelNotesData.travel.jsonObject=(new GpxParser).parse(t).jsonObject,theTravelNotesData.editedRouteObjId=-1,this.#pu(),theMouseUI.saveStatus=SAVE_STATUS.saved}openLocalTrvFile(t){theProfileDialogsManager.deleteAllProfiles();const e=JSON.parse(t);(new FileCompactor).decompress(e),theTravelNotesData.travel.jsonObject=e,theTravelNotesData.editedRouteObjId=-1,theTravelNotesData.travel.routes.forEach(t=>{ROUTE_EDITION_STATUS.notEdited!==t.editionStatus&&(theTravelNotesData.editedRouteObjId=t.objId)}),this.#pu(),theMouseUI.saveStatus=SAVE_STATUS.saved}#mu(t){const e=t.routes.iterator;for(;!e.done;)theTravelNotesData.travel.routes.add(e.value);const o=t.notes.iterator;for(;!o.done;)theTravelNotesData.travel.notes.add(o.value);this.#pu(),theMouseUI.saveStatus=SAVE_STATUS.modified}mergeLocalGpxFile(t){this.#mu((new GpxParser).parse(t))}mergeLocalTrvFile(t){const e=JSON.parse(t);(new FileCompactor).decompress(e);const o=new Travel;o.jsonObject=e,this.#mu(o)}}class OpenInputChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();const e=t.target.files[0].name,o=e.split(".").pop().toLowerCase(),i=new FileReader;i.onload=()=>{try{-1!==theConfig.files.openTaN.indexOf(o)?(new FileLoader).openLocalTrvFile(i.result):-1!==theConfig.files.openGpx.indexOf(o)&&(new FileLoader).openLocalGpxFile(i.result)}catch(t){t instanceof Error&&(console.error(t),theErrorsUI$1.showError("An error occurs when reading the file "+e))}},i.readAsText(t.target.files[0])}}class ImportInputChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();const e=t.target.files[0].name,o=e.split(".").pop().toLowerCase(),i=new FileReader;i.onload=()=>{try{-1!==theConfig.files.openTaN.indexOf(o)?(new FileLoader).mergeLocalTrvFile(i.result):-1!==theConfig.files.openGpx.indexOf(o)&&(new FileLoader).mergeLocalGpxFile(i.result)}catch(t){t instanceof Error&&(console.error(t),theErrorsUI$1.showError("An error occurs when reading the file "+e))}},i.readAsText(t.target.files[0])}}class TravelNotesToolbar extends BaseToolbar{constructor(){super()}createUI(){super.createUI("Travel & Notes",TOOLBAR_POSITION.topRight)}addToolbarItems(){const t="json",e=Object.seal({openTaN:"",openGpx:""});theConfig.files.openTaN.forEach(t=>e.openTaN+="."+t+","),theConfig.files.openGpx.forEach(t=>e.openGpx+="."+t+",");const o=(e.openTaN+e.openGpx).slice(0,-1);e.openTaN=e.openTaN.slice(0,-1),e.openGpx=e.openGpx.slice(0,-1),e.openTaN.replaceAll(",",", "),e.openGpx.replaceAll(",",", "),this.addToolbarItem(theGeoLocator.status===GEOLOCATION_STATUS.active?new ToolbarItem("ðŸ€",theTranslator.getText("TravelNotesToolbar - Stop Geo location"),()=>{theGeoLocator.switch()}):new ToolbarItem("ðŸŒ",theTranslator.getText("TravelNotesToolbar - Start Geo location"),()=>{theGeoLocator.switch()})),this.addToolbarItem(new ToolbarItem("âŒ",theTranslator.getText("TravelNotesToolbar - Cancel travel"),()=>{theTravelEditor.newTravel(),document.title="Travel & Notes"+(""===theTravelNotesData.travel.name?"":" - "+theTravelNotesData.travel.name)})),this.addToolbarItem(new ToolbarItem("ðŸ’¾",theTranslator.getText("TravelNotesToolbar - Save travel",{extension:t}),()=>{theTravelEditor.saveTravel()})),this.addToolbarItem(new ToolbarItem("ðŸ“‚",theTranslator.getText("TravelNotesToolbar - Open travel",e),()=>{theConfig.travelNotes.haveBeforeUnloadWarning&&!window.confirm(theTranslator.getText("TravelNotesToolbar - This page ask to close; data are perhaps not saved."))||theUtilities.openFile(new OpenInputChangeEL,o)})),this.addToolbarItem(new ToolbarItem("ðŸŒ",theTranslator.getText("TravelNotesToolbar - Import travel",e),()=>{-1===theTravelNotesData.editedRouteObjId?theUtilities.openFile(new ImportInputChangeEL,o):theErrorsUI$1.showError(theTranslator.getText("TravelNotesToolbar - Not possible to merge a travel when a route is edited"))})),this.addToolbarItem(new ToolbarItem("ðŸ“™",theTranslator.getText("TravelNotesToolbar - Open travel roadbook"),"TravelNotesRoadbook.html?lng="+theConfig.travelNotes.language+"&page="+theTravelNotesData.UUID)),theConfig.ApiKeysDialog.showButton&&this.addToolbarItem(new ToolbarItem("ðŸ”‘",theTranslator.getText("TravelNotesToolbar - api keys"),()=>{theApiKeysManager.setKeysFromDialog()})),this.addToolbarItem(new ToolbarItem("ðŸ›„",theTranslator.getText("TravelNotesToolbar - Travel properties"),()=>{theDockableDialogsManager.travelPropertiesDialog.show()})),this.addToolbarItem(new ToolbarItem("ðŸ—¨ï¸",theTranslator.getText("TravelNotesToolbar - Travel notes"),()=>{theDockableDialogsManager.travelNotesDialog.show()})),this.addToolbarItem(new ToolbarItem("ðŸ”",theTranslator.getText("Search with OpenStreetMap"),()=>{theDockableDialogsManager.osmSearchDialog.show()})),this.addToolbarItem(new ToolbarItem("â˜¢ï¸",theTranslator.getText("TravelNotesToolbar - Save as travel",{extension:t}),()=>{theTravelEditor.saveAsTravel()})),this.addToolbarItem(new ToolbarItem("ðŸ› ï¸",theTranslator.getText("TravelNotesToolbar - About Travel & Notes"),()=>(new AboutDialog).show())),document.fullscreenEnabled&&this.addToolbarItem(document.fullscreenElement?new ToolbarItem("ðŸ”»",theTranslator.getText("TravelNotesToolbar - disable fullscreen"),()=>theFullScreenUI.toggle()):new ToolbarItem("ðŸ”º",theTranslator.getText("TravelNotesToolbar - enable fullscreen"),()=>theFullScreenUI.toggle())),this.addToolbarItem(new ToolbarItem("+",theTranslator.getText("TravelNotesToolbar - Increment the font size"),()=>{theFontSizeManager.increment()})),this.addToolbarItem(new ToolbarItem("-",theTranslator.getText("TravelNotesToolbar - Decrement the font size"),()=>{theFontSizeManager.decrement()})),this.addToolbarItem(new ToolbarItem("ðŸ ","Home",window.location.origin)),this.addToolbarItem(new ToolbarItem("?","Help","https://wwwouaiebe.github.io/TravelNotes/userGuides/README.html#")),this.addToolbarItem(new ToolbarItem("@","Contact",theConfig.travelNotesToolbar.contactMail.url||window.location.origin))}}const theTravelNotesToolbar=new TravelNotesToolbar;class TransitModeButton{#gu=-1;#uh=-1;#vu;#st;#fu;static get#Tu(){return Object.freeze({bike:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <path fill="rgb(0,0,191)" d="m 11.25,3.125 v 1.09375 l 1.5625,0.9765625 V 6.5625 H 7.4999999 V 5.625 h 0.625 c 1.25,0 1.25,-1.25 0,-1.25 h -2.5 c -1.25,0 -1.25,1.25 0,1.25 h 0.625 V 6.5625 L 5.0781249,8.75 c -0.026125,-5.821e-4 -0.0519,0 -0.078125,0 -2.0153538,0 -3.75,1.734646 -3.75,3.75 0,2.015354 1.7346462,3.75 3.75,3.75 2.0153537,0 3.75,-1.734646 3.75,-3.75 0,-0.432461 -0.089462,-0.858226 -0.234375,-1.25 h 0.546875 c 0.9375,0 1.1534331,-0.567495 1.4843751,-0.898437 L 12.773438,7.8125 13.4375,9.1015625 C 12.159328,9.7073948 11.25,11.031094 11.25,12.5 c 0,2.015354 1.734646,3.75 3.75,3.75 2.015354,0 3.75,-1.734646 3.75,-3.75 0,-2.015354 -1.734646,-3.75 -3.75,-3.75 -0.03934,0 -0.07808,-0.00131 -0.117187,0 L 13.75,6.5625 V 4.5703125 Z M 7.2265624,7.8125 H 11.132813 L 9.1796874,10 h -1.40625 c -0.0231,0 -0.054487,0.0026 -0.078125,0 C 7.3660586,9.6463159 6.9994024,9.3504739 6.5624999,9.140625 6.5471874,9.1173375 6.5373874,9.0856825 6.5234374,9.0625 Z M 4.9999999,10 c 1.2571387,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.2428613,2.5 -2.5,2.5 -1.2571388,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.2428612,-2.5 2.5,-2.5 z M 15,10 c 1.257137,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.242863,2.5 -2.5,2.5 -1.257139,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.242861,-2.5 2.5,-2.5 z" /> </svg>',pedestrian:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20"  xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)" transform="matrix(0.15866777,0,0,0.12627988,148.47251,-116.69398)"> <path d="m -875.5,962.4 c 2,-1.5 4.6,-2.3 7.4,-2.2 3.6,0.3 6.7,2.5 8.4,5.2 l 10.7,21.2 14.5,10.1 c 1.2,1 2,2.5 1.9,4.2 -0.1,2.6 -2.5,4.6 -5.2,4.3 -0.7,0 -1.5,-0.3 -2.2,-0.7 l -15.6,-10.7 c -0.4,-0.4 -0.9,-0.9 -1.2,-1.5 l -4.1,-7.9 -4.8,21.1 18.9,22.3 c 0.4,0.7 0.7,1.5 0.9,2.2 l 5.1,26.9 c 0,0.6 0,1 0,1.5 -0.3,4.1 -3.8,6.8 -7.7,6.7 -3.2,-0.3 -5.7,-2.6 -6.5,-5.7 l -4.8,-25.1 -15.3,-17 -3.6,16.3 c -0.1,0.7 -1.2,2.3 -1.5,2.9 l -14.6,24.9 c -1.5,2.2 -3.9,3.8 -6.7,3.4 -4.1,-0.3 -7,-3.8 -6.7,-7.7 0.1,-1.2 0.6,-2.2 1,-3.1 l 13.7,-22.8 11.4,-50.4 -7.4,6 -4.1,18 c -0.4,2.2 -2.6,4.2 -5.1,4.1 -2.6,-0.1 -4.6,-2.5 -4.5,-5.2 0,-0.1 0,-0.4 0.1,-0.6 l 4.6,-20.9 c 0.3,-0.9 0.7,-1.6 1.5,-2.2 z" /> <path d="m -884.5,943.5 c 1.3,8.6 8.7,15.3 17.8,15.3 5.7,0 10.2,-4.6 10.2,-10.2 0,-5.6 -4.6,-10.2 -10.2,-10.2 -3.9,0 -7.2,2 -8.9,5.2 -0.2,0.4 -0.5,0.7 -0.8,1 -2,2 -5.3,2 -7.3,0 -0.4,-0.4 -0.6,-0.7 -0.8,-1.1 z" /> </g> </svg>',car:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" > <g fill="rgb(0,0,191)"> <path d="m 2,13 a 1.7142857,1.7142857 0 0 0 1.7142857,1.714286 H 16.285714 A 1.7142857,1.7142857 0 0 0 18,13 V 9.5714286 A 1.7142857,1.7142857 0 0 0 16.285714,7.8571429 H 3.7142857 A 1.7142857,1.7142857 0 0 0 2,9.5714286 Z m 1.8285714,-2.285714 a 1.0285714,1.0285714 0 1 1 0,0.01143 z m 10.2857146,0 a 1.0285714,1.0285714 0 1 1 0,0.01143 z" /> <path d="M 4.2857143,7.8571429 V 5 A 1.7142857,1.7142857 0 0 1 6,3.2857143 h 8 A 1.7142857,1.7142857 0 0 1 15.714286,5 V 7.8571429 H 14 V 6.1428571 A 1.1428571,1.1428571 0 0 0 12.857143,5 H 7.1428571 A 1.1428571,1.1428571 0 0 0 6,6.1428571 v 1.7142858 z" /> <g transform="matrix(1.1428571,0,0,1.1428571,2,2.1428571)"> <rect x="1" y="10" width="2" height="3" /> <rect x="11" y="10" width="2" height="3" /> </g> </g> </svg>',train:'data:image/svg+xml;utf8,<svg viewBox="-3 -3 20 20" xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)"> <path d="M 5,0 C 3.025911,-0.0084 1,3 1,7 l 0,2 c 0,1 1,2 2,2 l 8,0 c 1,0 2,-1 2,-2 L 13,7 C 13,3 11,0 9,0 z m -1,3 6,0 c 0,0 1,1 1,3 L 3.03125,6 C 2.994661,3.9916 4,3 4,3 z M 3,8 6,8 6,9 3,9 z m 5,0 3,0 0,1 -3,0 z m -6,4 -1,2 3,0 1,-2 z m 7,0 1,2 3,0 -1,-2 z"/></g></svg>',line:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <line x1="5" y1="17" x2= "11" y2="2" stroke="rgb(0,0,0)" /> <line x1="3" y1="6" x2="17" y2="9" stroke="rgb(191,0,0)" /> <line x1="3" y1= "16" x2="17" y2="5" stroke="rgb(255,204,0)" /> </svg>',circle:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <g fill="transparent"> <circle cx="8" cy="6" r="5" stroke="rgb(0,0,0)" /> <circle cx="12" cy="12" r="4" stroke="rgb(255,204,0)" /> <circle cx="14" cy="8" r="3" stroke="rgb(191,0,0)" /> </g> </svg>'})}constructor(t,e){Object.freeze(this),this.#vu=t,this.#st=e,this.#fu=theHTMLElementsFactory.create("img",{src:TransitModeButton.#Tu[e],id:"travelnotes-providers-toolbar-"+e+"img-button",className:"travelnotes-providers-toolbar-img-button",title:theTranslator.getText("ProvidersToolbar - TransitMode "+e)}),this.#fu.addEventListener("pointerdown",this),this.#fu.addEventListener("pointerup",this),this.visible=!1}handleEvent(t){switch(t.type){case"pointerdown":this.#gu=t.screenX,this.#uh=t.screenY;break;case"pointerup":this.#gu===t.screenX&&this.#uh===t.screenY&&(this.#vu.transitMode=this.#st,this.#vu.hide(),theRouter.startRouting()),this.#gu=-1,this.#uh=-1}}get buttonHTMLElement(){return this.#fu}get transitMode(){return this.#st}set active(t){t?this.#fu.classList.add("travelnotes-providers-toolbar-active-transit-mode-img-button"):this.#fu.classList.remove("travelnotes-providers-toolbar-active-transit-mode-img-button")}set visible(t){t?this.#fu.classList.remove("travelnotes-hidden"):this.#fu.classList.add("travelnotes-hidden")}}class ProviderButton{#gu=-1;#uh=-1;#vu;#at;#fu;constructor(t,e){Object.freeze(this),this.#vu=t,this.#at=e,this.#fu=theHTMLElementsFactory.create("img",{src:e.icon,id:"travelnotes-providers-toolbar-"+e.name+"img-button",className:"travelnotes-providers-toolbar-img-button",title:e.title||e.name}),this.#fu.addEventListener("pointerdown",this),this.#fu.addEventListener("pointerup",this)}handleEvent(t){switch(t.type){case"pointerdown":this.#gu=t.screenX,this.#uh=t.screenY;break;case"pointerup":this.#gu===t.screenX&&this.#uh===t.screenY&&(this.#vu.provider=this.#at.name,theRouter.startRouting()),this.#gu=-1,this.#uh=-1}}get buttonHTMLElement(){return this.#fu}get provider(){return this.#at}set active(t){t?this.#fu.classList.add("travelnotes-providers-toolbar-active-provider-img-button"):this.#fu.classList.remove("travelnotes-providers-toolbar-active-provider-img-button")}}class ProvidersToolbar{#yu=-1;#Lu=-1;#Eo;#Eu;#bu;#_u;#Mu;#wu;#Du;#_h;#Cu;static get#Iu(){return 100}#Nu(){["bike","pedestrian","car","train","line","circle"].forEach(t=>{const e=new TransitModeButton(this,t);this.#_u.set(t,e),this.#bu.appendChild(e.buttonHTMLElement)})}#xu(){thePluginsManager.providers.forEach(t=>{if(!t.providerKeyNeeded||theApiKeysManager.hasKey(t.name)){const e=new ProviderButton(this,t);this.#Mu.set(t.name,e),this.#bu.appendChild(e.buttonHTMLElement)}})}#eo(){this.#_h=!0,setTimeout(()=>this.#Pu(),ProvidersToolbar.#Iu)}#Pu(){this.#Eo.style.top=0,this.#bu.classList.remove("travelnotes-hidden"),this.centerToolbar()}#Su(t){if(t.preventDefault(),theDevice.setPointerType(t),"touch"===theDevice.pointerType)this.#yu=t.screenX,this.#Lu=t.screenY}#Ou(t){if(t.preventDefault(),theDevice.setPointerType(t),"touch"===theDevice.pointerType)this.#yu===t.screenX&&this.#Lu===t.screenY&&(this.#_h?this.hide():this.#eo())}#Au(t){if(theDevice.setPointerType(t),"mouse"===theDevice.pointerType)this.#Cu&&(clearTimeout(this.#Cu),this.#Cu=null),this.#eo()}#Ru(t){if(theDevice.setPointerType(t),"mouse"===theDevice.pointerType)this.#Cu=setTimeout(()=>this.hide(),theConfig.toolbars.timeOut)}hide(){this.#Cu&&(clearTimeout(this.#Cu),this.#Cu=null),this.#bu.classList.add("travelnotes-hidden"),this.centerToolbar(),this.#_h=!1}constructor(){Object.freeze(this),this.#_u=new Map,this.#Mu=new Map}centerToolbar(){this.#Eu.textContent=theTranslator.getText("ProvidersToolbar - Computed by {provider} for {transitMode}",{provider:theTravelNotesData.routing.provider,transitMode:theTranslator.getText("ProvidersToolbar - TransitMode "+theTravelNotesData.routing.transitMode)}),this.#Eo.style.left=String((window.visualViewport.width-this.#Eo.clientWidth)/2)+"px",this.#Eo.style.top=String(window.visualViewport.height-this.#Eo.clientHeight-2)+"px"}createUI(){this.#Eo=theHTMLElementsFactory.create("div",{id:"travelnotes-providers-toolbar-container"},document.body),this.#Eo.addEventListener("pointerenter",t=>this.#Au(t),!1),this.#Eo.addEventListener("pointerleave",t=>this.#Ru(t),!1),this.#Eu=theHTMLElementsFactory.create("div",{className:"travelnotes-providers-toolbar-top-bar",textContent:theTranslator.getText("TravelNotes-ProvidersToolbar - Providers")},this.#Eo),this.#Eu.addEventListener("pointerdown",t=>this.#Su(t),!1),this.#Eu.addEventListener("pointerup",t=>this.#Ou(t),!1),this.#bu=theHTMLElementsFactory.create("div",{className:"travelnotes-providers-toolbar-img-buttons travelnotes-hidden"},this.#Eo),this.#Nu(),this.#xu(),this.provider=this.#Mu.keys().next().value,this.centerToolbar()}set provider(t){theTravelNotesData.routing.provider=t,this.#Du&&(this.#Du.active=!1),this.#Du=this.#Mu.get(t),this.#Du.active=!0;const e=thePluginsManager.providers.get(t.toLowerCase());this.#_u.forEach(t=>{t.visible=-1!==e.transitModes.indexOf(t.transitMode)}),this.#wu&&-1!==e.transitModes.indexOf(this.#wu.transitMode)||(this.#wu=null,this.#_u.forEach(t=>{this.#wu||-1===e.transitModes.indexOf(t.transitMode)?t.active=!1:(this.#wu=t,t.active=!0,theTravelNotesData.routing.transitMode=t.transitMode)})),this.centerToolbar()}set transitMode(t){theTravelNotesData.routing.transitMode=t,this.#wu&&(this.#wu.active=!1),this.#wu=this.#_u.get(t),this.#wu.active=!0,this.centerToolbar()}providersAdded(){for(;this.#bu.firstChild;)this.#bu.removeChild(this.#bu.firstChild);this.#_u.clear(),this.#Mu.clear(),this.#Nu(),this.#xu(),this.provider=this.#Mu.keys().next().value;const t=this.#Mu.keys().next().value;this.provider=t,this.transitMode=thePluginsManager.providers.get(t.toLowerCase()).transitModes[0],this.centerToolbar()}}const theProvidersToolbar=new ProvidersToolbar;class MapContextMenu extends BaseContextMenu{constructor(t,e){super(t,e)}get menuItems(){return[new MenuItem(theTranslator.getText("MapContextMenu - Select this point as start point"),-1!==theTravelNotesData.editedRouteObjId&&LAT_LNG.defaultValue===theTravelNotesData.travel.editedRoute.wayPoints.first.lat,()=>theWayPointEditor.setStartPoint(this.latLng)),new MenuItem(theTranslator.getText("MapContextMenu - Select this point as way point"),-1!==theTravelNotesData.editedRouteObjId,()=>theWayPointEditor.addWayPoint(this.latLng)),new MenuItem(theTranslator.getText("MapContextMenu - Select this point as end point"),-1!==theTravelNotesData.editedRouteObjId&&LAT_LNG.defaultValue===theTravelNotesData.travel.editedRoute.wayPoints.last.lat,()=>theWayPointEditor.setEndPoint(this.latLng)),new MenuItem(theTranslator.getText("MapContextMenu - Select this point as start and end point"),-1!==theTravelNotesData.editedRouteObjId&&LAT_LNG.defaultValue===theTravelNotesData.travel.editedRoute.wayPoints.first.lat&&LAT_LNG.defaultValue===theTravelNotesData.travel.editedRoute.wayPoints.last.lat,()=>theWayPointEditor.setStartAndEndPoint(this.latLng)),new MenuItem(theTranslator.getText("MapContextMenu - Add a route"),!0,()=>theRouteEditor.addRoute()),new MenuItem(theTranslator.getText("MapContextMenu - Hide all routes"),!0,()=>theRouteEditor.hideRoutes()),new MenuItem(theTranslator.getText("MapContextMenu - Show all routes"),!0,()=>theRouteEditor.showRoutes()),new MenuItem(theTranslator.getText("MapContextMenu - New travel note"),!0,()=>theNoteEditor.newTravelNote(this.latLng)),new MenuItem(theTranslator.getText("MapContextMenu - Hide all notes"),!0,()=>theNoteEditor.hideNotes()),new MenuItem(theTranslator.getText("MapContextMenu - Show all notes"),!0,()=>theNoteEditor.showNotes()),new MenuItem(theTranslator.getText("MapContextMenu - Zoom to travel"),!0,()=>(new Zoomer).zoomToTravel()),new MenuItem("What the fuck?",!0,()=>{const t=document.createElement("a");t.href="https://www.openstreetmap.org/query?lat="+this.latLng[0].toFixed(LAT_LNG.fixed)+"&lon="+this.latLng[1].toFixed(LAT_LNG.fixed)+"#map="+theTravelNotesData.map.getZoom()+"/"+this.latLng[0].toFixed(LAT_LNG.fixed)+"/"+this.latLng[1].toFixed(LAT_LNG.fixed),t.target="_blank",t.click()})]}}class TempWayPointMarkerDragStartEL{static handleEvent(){DomEvent.off(TempWayPointMarkerELData.marker,"mouseout",TempWayPointMarkerMouseOutEL.handleEvent)}}class TempWayPointMarkerContextMenuEL{static handleEvent(t){t.latlng.lat=TempWayPointMarkerELData.initialLatLng[0],t.latlng.lng=TempWayPointMarkerELData.initialLatLng[1],t.target.objId=theTravelNotesData.travel.editedRoute.objId,new RouteContextMenu(t).show()}}class TempWayPointMarkerClickEL{static handleEvent(t){theTravelNotesData.mapObjects.get(theTravelNotesData.travel.editedRoute.objId).openPopup(t.latlng)}}class TempWayPointMarkerDragEndEL{static handleEvent(t){theWayPointEditor.addWayPointOnRoute(TempWayPointMarkerELData.initialLatLng,[t.target.getLatLng().lat,t.target.getLatLng().lng]),TempWayPointMarkerELData.marker&&(DomEvent.off(TempWayPointMarkerELData.marker,"dragstart",TempWayPointMarkerDragStartEL.handleEvent),DomEvent.off(TempWayPointMarkerELData.marker,"dragend",TempWayPointMarkerDragEndEL.handleEvent),DomEvent.off(TempWayPointMarkerELData.marker,"contextmenu",TempWayPointMarkerContextMenuEL.handleEvent),theTravelNotesData.map.removeLayer(TempWayPointMarkerELData.marker),TempWayPointMarkerELData.marker=null)}}class EditedRouteMouseOverEL{static#ku=1;static handleEvent(t){const e=theDataSearchEngine.getRoute(t.target.objId);if(TempWayPointMarkerELData.initialLatLng=[t.latlng.lat,t.latlng.lng],TempWayPointMarkerELData.marker)TempWayPointMarkerELData.marker.setLatLng(t.latlng);else{TempWayPointMarkerELData.marker=new Marker(t.latlng,{icon:new DivIcon({iconSize:[20,20],iconAnchor:[10,20],html:'<div class="travelnotes-map-way-point travelnotes-map-way-point-tmp"></div><div class="travelnotes-map-way-point-text">?</div>',className:"travelnotes-map-way-point-style"}),draggable:!0});let o="";(-1===theConfig.route.showDragTooltip||EditedRouteMouseOverEL.#ku<=theConfig.route.showDragTooltip)&&(EditedRouteMouseOverEL.#ku++,o=theTranslator.getText("EditedRouteMouseOverEL - Drag and drop to add a waypoint")+" - "),o+=e.computedName+" - ";let i=theGeometry.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;i+=e.chainedDistance,o+=theUtilities.formatDistance(i),TempWayPointMarkerELData.marker.bindTooltip(o),TempWayPointMarkerELData.marker.getTooltip().options.offset=[0,0],TempWayPointMarkerELData.marker.addTo(theTravelNotesData.map),DomEvent.on(TempWayPointMarkerELData.marker,"mouseout",TempWayPointMarkerMouseOutEL.handleEvent),DomEvent.on(TempWayPointMarkerELData.marker,"dragstart",TempWayPointMarkerDragStartEL.handleEvent),DomEvent.on(TempWayPointMarkerELData.marker,"dragend",TempWayPointMarkerDragEndEL.handleEvent),DomEvent.on(TempWayPointMarkerELData.marker,"contextmenu",TempWayPointMarkerContextMenuEL.handleEvent),DomEvent.on(TempWayPointMarkerELData.marker,"click",TempWayPointMarkerClickEL.handleEvent)}}}class MapMouseELs{static createFakeEvent(t){const e=theDataSearchEngine.getNearestRouteData([t.latlng.lat,t.latlng.lng]);if(!e.route)return;const o=new LatLng$1(e.latLngOnRoute[0],e.latLngOnRoute[1]),i=theTravelNotesData.map.latLngToContainerPoint(o);return i.distanceTo(t.containerPoint)>("touch"===theDevice.pointerType?theConfig.mapContextMenu.touchMaxRouteDistance:theConfig.mapContextMenu.mouseMaxRouteDistance)?void 0:Object.freeze({clientX:i.x,clientY:i.y,latlng:o,target:e.route})}static handleClickEvent(t){const e=MapMouseELs.createFakeEvent(t);e&&"touch"===theDevice.pointerType&&e.target.editionStatus!==ROUTE_EDITION_STATUS.notEdited&&EditedRouteMouseOverEL.handleEvent(e)}static handleContextMenuEvent(t){const e=MapMouseELs.createFakeEvent(t);e?new RouteContextMenu(e).show():new MapContextMenu(t).show()}}class BaseRouteProvider{#Bu;#gi;#ju(t,e){}constructor(){Object.freeze(this),this.#Bu="fr"}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAArSURBVEhL7cyxDQAgAAQh91/67ektTI4BOHumGtWoRjWqUY1qVKMaP9bbBZKXggu6NeCUAAAAAElFTkSuQmCC"}get name(){return""}get title(){return""}get transitModes(){return[]}get providerKeyNeeded(){return!0}get userLanguage(){return this.#Bu}set userLanguage(t){this.#Bu=t}}class GraphHopperRouteProvider extends BaseRouteProvider{#Ft;#gi;static get#Hu(){return 5}static get#Fu(){return["turn-sharp-left","turn-left","turn-slight-left","continue-straight","turn-slight-right","turn-right","turn-sharp-right","arrive-default","arrive-default","roundabout-right"]}#zu(t,e,o){if(0===t.paths.length)return void o("Route not found");const i=new PolylineEncoder;this.#gi.itinerary.itineraryPoints.removeAll(),this.#gi.itinerary.maneuvers.removeAll(),this.#gi.itinerary.hasProfile=!0,this.#gi.itinerary.ascent=0,this.#gi.itinerary.descent=0,t.paths.forEach(t=>{t.points=i.decode(t.points,[GraphHopperRouteProvider.#Hu,GraphHopperRouteProvider.#Hu,2]),t.snapped_waypoints=i.decode(t.snapped_waypoints,[GraphHopperRouteProvider.#Hu,GraphHopperRouteProvider.#Hu,2]);const e=[];for(let o=0;o<t.points.length;o++){const i=new ItineraryPoint;i.lat=t.points[o][0],i.lng=t.points[o][1],i.elev=t.points[o][2],e.push(i),this.#gi.itinerary.itineraryPoints.add(i)}let o="";t.instructions.forEach(t=>{const i=new Maneuver;i.iconName=GraphHopperRouteProvider.#Fu[t.sign+3]||"undefined","arrive-default"===o&&"continue-straight"===i.iconName&&(i.iconName="depart-default"),o=i.iconName,i.instruction=t.text||"",i.duration=t.time/DISTANCE.metersInKm,i.distance=t.distance,i.itineraryPointObjId=e[t.interval[0]].objId,this.#gi.itinerary.maneuvers.add(i)});const n=this.#gi.wayPoints.iterator;t.snapped_waypoints.forEach(t=>{n.done||(n.value.lat=t[0],n.value.lng=t[1])})}),e(this.#gi)}#Uu(){let t=null;this.#gi.wayPoints.forEach(e=>{t=t?t+"&":"",t+="point="+e.lat.toFixed(LAT_LNG.fixed)+","+e.lng.toFixed(LAT_LNG.fixed)});let e="";switch(this.#gi.itinerary.transitMode){case"bike":e="bike";break;case"pedestrian":e="foot";break;case"car":e="car"}return"https://graphhopper.com/api/1/route?"+t+"&instructions=true&elevation=true&type=json&key="+this.#Ft+"&locale="+this.userLanguage+"&vehicle="+e}#ju(t,e){fetch(this.#Uu()).then(o=>{200===o.status&&o.ok?o.json().then(o=>this.#zu(o,t,e)):e(new Error("Invalid status "+o.status))}).catch(()=>{e()})}constructor(){super(),this.#Ft=""}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAIAAAC0Ujn1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AocDyYTxtPEYwAABGtJREFUSMedVU1MXFUUPue+9+bNAMMUZrCFVAsiDEGpJlpdtCY0sTU1xIA1QNSNIcYGuyAuxBp1oU1DYu2iNlKsJopVYy2lkpiyoCCptLWF1DKFkpb/YShvmBmYX97/dUECw5sBpj2r97577pdzv3vud/BLzw8XF3s5ZGG9QAQA0CggAEGgFDYLRVffsu/HUlcNAyQ5J0NApzGXXxwLKvNLhCNcbrqlNJvfYaWavjE7hyzLIUuTFYIskd2RByduRfu9im9pBed3ZG79oCzr9QKqrMtOgXLIrquDOBqcONQjeyIGXJoKTX/URyUtu6aIStoGhZOk4mpBeeL97kTelXB/dj3QPoYseThq5HD6yFV5Npq4xMadcvZof8zlRwZTpUYTE7w0Fb4ya8CLi4vb2toGBgZ6enpqa2sBQAvLvtYRLaauR52gNaW+s/cMWGFhYUdHh9PpXP4tLy/Pz89vamqSugXze7r8JJMCNcGl4YDkDq/BCGloaHA6nVPy3GnvhZvRYQdrq/n0QFrzqVgw8sQV03gh6lTfRBBEEO8F1YAYD9rt9sP1hyflB4cmm9oDPYLsd8XGjkyfsrxgB4DB367tztipUHUTaqqDNBMxNGxlZSUQOOO96JG9PDERJCwyZjSpqAPAqGd898xTKtE2o1Z1bUE0ZFRUVLiptz96FyC+GVAcCy5/3fnr5nO2Ei1BE2K4w8Q3VlJSMhpzT8tzGHclakCUJkLLf5c6O19z7EnUhBhMg8ngDBnhaOSuOBlvBsTC+n9d7aKhoaFnYAcibkjNoml7BqzNOd92PsyKqzsJKt6Y7+eRlQRZlsNTC9t4OwW6vtYULE9ncw5LPPj18eOuvluEEkAABH1Jnfn8XzUsx+f4Zrx55hy6UV/rNG2nw7onN9A+vmq+kvLLmydyDjotpVm6rC92TkWuzxnOHvWHHivNAqDxV218jVSneY3PZ4+yo664N7lE58+ObOT9MdnGWuka5kR70qmeTvb9/u6B8lch5WCBSSPmzTwEgAWmV/3vWPsnb5w72NxyWhAERVEopQzD8DwviqIgCIYtNmtmAOQU/BqARebY7I+Z7xQODAy4+m/3Xv67u6v7Wt9V1+3B6urqxPxtubmJNoLP3nk76QBbHkIFfN5e264XM0rzTA4GiFvwvOJ8ORQJGZIDiwsnY21/+LoYJMt704h53QGGgCrV7ovu+6L7O+HC8rQUml2JvEVFRVm2LYvBEKYiSLKZgap/Sfh2MHGlvr4+CpJXCcDaB5kqNTEznqP9VDVKl5OTU1dXJ8i+McnziFVTSdtaXwZ5vAFvaWmxWq03wsMLagjhkaqmGiX56Sdv/PTxh422TBvP8w6Ho7W1taqqSqHKGV+7CblUOyRpZLOZXxU3lGkF8x5he/7jAKBQ9YvZ78/5u8yEj++uNGLGUlcNC0yK1DpQC5r2btm13/ZSHueYleb/XOi9HOpnkVnbuGBCBhvd33Qs/MMhAw8TPHIssirVJConsRSq1tr3/Q+O4QqEHeMWIQAAAABJRU5ErkJggg=="}get name(){return"GraphHopper"}get title(){return"GraphHopper"}get transitModes(){return["bike","pedestrian","car"]}get providerKeyNeeded(){return!0}set providerKey(t){this.#Ft=t}}const OUR_OSRM_LANGUAGES=["ar","da","de","en","eo","es","es-ES","fi","fr","he","hu","id","it","ja","ko","my","nl","no","pl","pt-BR","pt-PT","ro","ru","sl","sv","tr","uk","vi","yo","zh-Hans"],OUR_VERSION="v5",languages={supportedCodes:[],instructions:{},grammars:{},abbreviations:{}},instructions=languages.instructions,grammars=languages.grammars,abbreviations=languages.abbreviations;class OsrmTextInstructions{#Wu(t,e){if(e||0===e){if(0>e&&360<e)throw new Error("Degree "+e+" invalid");return 20>=e?instructions[t].v5.constants.direction.north:70>e?instructions[t].v5.constants.direction.northeast:110>=e?instructions[t].v5.constants.direction.east:160>e?instructions[t].v5.constants.direction.southeast:200>=e?instructions[t].v5.constants.direction.south:250>e?instructions[t].v5.constants.direction.southwest:290>=e?instructions[t].v5.constants.direction.west:340>e?instructions[t].v5.constants.direction.northwest:instructions[t].v5.constants.direction.north}return""}async#Ku(t,e){const o=await fetch("TravelNotesProviders/languages/"+t+"/"+e+".json");if(200===o.status&&o.ok){const i=await o.json();languages[t][e]=i}}constructor(){this.abbreviations=abbreviations,Object.freeze(this)}loadLanguage(t){const e=-1===OUR_OSRM_LANGUAGES.indexOf(t)?"en":t;return["instructions","grammars","abbreviations"].forEach(t=>this.#Ku(t,e)),e}capitalizeFirstLetter(t,e){return e.charAt(0).toLocaleUpperCase(t)+e.slice(1)}ordinalize(t,e){return instructions[t].v5.constants.ordinalize[e.toString()]||""}directionFromDegree(t,e){return this.#Wu(t,e)}laneConfig(t){if(!t.intersections||!t.intersections[0].lanes)throw new Error("No lanes object");const e=[];let o=null;return t.intersections[0].lanes.forEach(function(t){null!==o&&o===t.valid||(t.valid?e.push("o"):e.push("x"),o=t.valid)}),e.join("")}getWayName(t,e,o){const i=o&&o.classes||[];if("object"!=typeof e)throw new Error("step must be an Object");if(!Array.isArray(i))throw new Error("classes must be an Array or undefined");let n="",r=e.name||"";const a=(e.ref||"").split(";")[0];r===e.ref&&(r=""),r=r.replace(" ("+e.ref+")","");const s=-1!==i.indexOf("motorway");if(r&&a&&r!==a&&!s){const e=instructions[t].v5.phrase["name and ref"]||instructions.en.v5.phrase["name and ref"];n=this.tokenize(t,e,{name:r,ref:a},o)}else n=r&&a&&s&&/\d/.test(a)||!r&&a?o&&o.formatToken?o.formatToken("ref",a):a:o&&o.formatToken?o.formatToken("name",r):r;return n}compile(t,e,o){if(!e.maneuver)throw new Error("No step maneuver provided");const i=o||{};let n=e.maneuver.type;const r=e.maneuver.modifier,a=e.mode,s=e.driving_side;if(!n)throw new Error("Missing step maneuver type");if("depart"!==n&&"arrive"!==n&&!r)throw new Error("Missing step maneuver modifier");instructions[t].v5[n]||(console.log("Encountered unknown instruction type: "+n),n="turn");let l=null;if(instructions[t].v5.modes[a])l=instructions[t].v5.modes[a];else{const e="off ramp"===n&&0<=r.indexOf(s);l=instructions[t].v5[n][r]&&!e?instructions[t].v5[n][r]:instructions[t].v5[n].default}let h=null;switch(n){case"use lane":h=instructions[t].v5.constants.lanes[this.laneConfig(e)],h||(l=instructions[t].v5["use lane"].no_lanes);break;case"rotary":case"roundabout":l=e.rotary_name&&e.maneuver.exit&&l.name_exit?l.name_exit:e.rotary_name&&l.name?l.name:e.maneuver.exit&&l.exit?l.exit:l.default}const d=this.getWayName(t,e,i);let c=l.default;e.destinations&&e.exits&&l.exit_destination?c=l.exit_destination:e.destinations&&l.destination?c=l.destination:e.exits&&l.exit?c=l.exit:d&&l.name?c=l.name:i.waypointName&&l.named&&(c=l.named);const u=e.destinations&&e.destinations.split(": "),p=u&&u[0].split(",")[0],m=u&&u[1]&&u[1].split(",")[0];let g="";g=m&&p?p+": "+m:p||m||"";const v=0<=i.legIndex&&i.legIndex!==i.legCount-1?this.ordinalize(t,i.legIndex+1):"",f={way_name:d,destination:g,exit:(e.exits||"").split(";")[0],exit_number:this.ordinalize(t,e.maneuver.exit||1),rotary_name:e.rotary_name,lane_instruction:h,modifier:instructions[t].v5.constants.modifier[r],direction:this.directionFromDegree(t,e.maneuver.bearing_after),nth:v,waypoint_name:i.waypointName};return this.tokenize(t,c,f,i)}grammarize(t,e,o){if(o&&grammars&&grammars[t]&&grammars[t].v5){const i=grammars[t].v5[o];if(i){let o=" "+e+" ";const n=grammars[t].meta.regExpFlags||"";return i.forEach(function(t){const e=new RegExp(t[0],n);o=o.replace(e,t[1])}),o.trim()}}return e}tokenize(t,e,o,i){const n=this;let r=!1;const a=e.replace(/\{(\w+)(?::(\w+))?\}/g,function(e,a,s,l){let h=o[a];return void 0===h?e:(h=n.grammarize(t,h,s),0===l&&instructions[t].meta.capitalizeFirstLetter&&(r=!0,h=n.capitalizeFirstLetter(t,h)),i&&i.formatToken&&(h=i.formatToken(a,h)),h)}).replace(/ {2}/g," ");return!r&&instructions[t].meta.capitalizeFirstLetter?this.capitalizeFirstLetter(t,a):a}}const theOsrmTextInstructions=new OsrmTextInstructions,ICON_LIST=Object.freeze({turn:Object.freeze({default:"undefined","sharp left":"turn-sharp-left",left:"turn-left","slight left":"turn-slight-left",straight:"turn-straight","slight right":"turn-slight-right",right:"turn-right","sharp right":"turn-sharp-right",uturn:"turn-u-turn"}),"new name":Object.freeze({default:"undefined","sharp left":"new-name-sharp-left",left:"new-name-left","slight left":"new-name-slight-left",straight:"new-name-straight","slight right":"new-name-slight-right",right:"new-name-right","sharp right":"new-name-sharp-right"}),depart:Object.freeze({default:"depart-default","sharp left":"depart-left",left:"depart-left","slight left":"depart-left",straight:"depart-default","slight right":"depart-right",right:"depart-right","sharp right":"depart-right"}),arrive:Object.freeze({default:"arrive-default","sharp left":"arrive-left",left:"arrive-left","slight left":"arrive-left",straight:"arrive-default","slight right":"arrive-right",right:"arrive-right","sharp right":"arrive-right"}),merge:Object.freeze({default:"merge-default","sharp left":"merge-left",left:"merge-left","slight left":"merge-left",straight:"merge-default","slight right":"merge-right",right:"merge-right","sharp right":"merge-right"}),"on ramp":Object.freeze({default:"undefined","sharp left":"on-ramp-left",left:"on-ramp-left","slight left":"on-ramp-left","slight right":"on-ramp-right",right:"on-ramp-right","sharp right":"on-ramp-right"}),"off ramp":Object.freeze({default:"undefined","sharp left":"off-ramp-left",left:"off-ramp-left","slight left":"off-ramp-left","slight right":"off-ramp-right",right:"off-ramp-right","sharp right":"off-ramp-right"}),fork:Object.freeze({default:"undefined","sharp left":"fork-left",left:"fork-left","slight left":"fork-left","slight right":"fork-right",right:"fork-right","sharp right":"fork-right"}),"end of road":Object.freeze({default:"undefined","sharp left":"end-of-road-left",left:"end-of-road-left","slight left":"end-of-road-left","slight right":"end-of-road-right",right:"end-of-road-right","sharp right":"end-of-road-right"}),continue:Object.freeze({default:"undefined","sharp left":"continue-sharp-left",left:"continue-left","slight left":"continue-slight-left",straight:"continue-straight","slight right":"continue-slight-right",right:"continue-right","sharp right":"continue-sharp-right"}),roundabout:Object.freeze({default:"undefined","sharp left":"roundabout-left",left:"roundabout-left","slight left":"roundabout-left","slight right":"roundabout-right",right:"roundabout-right","sharp right":"roundabout-right"}),"exit roundabout":Object.freeze({default:"undefined",left:"roundabout-exit","sharp left":"roundabout-exit","slight left":"roundabout-exit",right:"roundabout-exit","sharp right":"roundabout-exit","slight right":"roundabout-exit",straight:"roundabout-exit"}),rotary:Object.freeze({default:"undefined","sharp left":"rotary-left",left:"rotary-left","slight left":"rotary-left","slight right":"rotary-right",right:"rotary-right","sharp right":"rotary-right"}),"roundabout turn":Object.freeze({default:"undefined","sharp left":"roundabout-turn-sharp-left",left:"roundabout-turn-left","slight left":"roundabout-turn-slight-left",straight:"roundabout-turn-straight","slight right":"roundabout-turn-slight-right",right:"roundabout-turn-right","sharp right":"roundabout-turn-sharp-right"}),notification:Object.freeze({default:"undefined"}),default:Object.freeze({default:"undefined"})});class MapboxRouteProvider extends BaseRouteProvider{#Ft;#gi;static get#Hu(){return 6}#zu(t,e,o){if("Ok"!==t.code)return void o(new Error("Response code not ok"));if(0===t.routes.length)return void o(new Error("Route not found"));const i=new PolylineEncoder;this.#gi.itinerary.itineraryPoints.removeAll(),this.#gi.itinerary.maneuvers.removeAll(),this.#gi.itinerary.hasProfile=!1,this.#gi.itinerary.ascent=0,this.#gi.itinerary.descent=0,t.routes[0].geometry=i.decode(t.routes[0].geometry,[MapboxRouteProvider.#Hu,MapboxRouteProvider.#Hu]),t.routes[0].legs.forEach(t=>{let e=0;t.steps.forEach(o=>{o.geometry=i.decode(o.geometry,[MapboxRouteProvider.#Hu,MapboxRouteProvider.#Hu]),"arrive"===o.maneuver.type&&2===o.geometry.length&&o.geometry[0][0]===o.geometry[1][0]&&o.geometry[0][1]===o.geometry[1][1]&&o.geometry.pop();const n=new Maneuver;n.iconName=ICON_LIST[o.maneuver.type]?ICON_LIST[o.maneuver.type][o.maneuver.modifier]||ICON_LIST[o.maneuver.type].default:ICON_LIST.default.default,n.instruction=theOsrmTextInstructions.compile(this.userLanguage,o),n.duration=o.duration;let r=0;for(let i=0;1===o.geometry.length?1>i:i<o.geometry.length;i++){const a=new ItineraryPoint;a.latLng=[o.geometry[i][0],o.geometry[i][1]],a.distance=t.annotation.distance[e]?t.annotation.distance[e]:0,this.#gi.itinerary.itineraryPoints.add(a),i!==o.geometry.length-1&&(r+=a.distance,e++),0===i&&(n.itineraryPointObjId=a.objId)}n.distance=r,this.#gi.itinerary.maneuvers.add(n)})});const n=this.#gi.wayPoints.iterator;t.waypoints.forEach(t=>{n.done||(n.value.latLng=[t.location[1],t.location[0]])}),e(this.#gi)}#Uu(){let t=null;this.#gi.wayPoints.forEach(e=>{t=t?t+";":"",t+=e.lng.toFixed(LAT_LNG.fixed)+","+e.lat.toFixed(LAT_LNG.fixed)});let e="";switch(this.#gi.itinerary.transitMode){case"car":e="mapbox/driving/";break;case"bike":e="mapbox/cycling/";break;case"pedestrian":e="mapbox/walking/";break;default:return}return"https://api.mapbox.com/directions/v5/"+e+t+"?geometries=polyline6&overview=full&steps=true&annotations=distance&access_token="+this.#Ft}#ju(t,e){fetch(this.#Uu()).then(o=>{200===o.status&&o.ok?o.json().then(o=>this.#zu(o,t,e)):e(new Error("Invalid status "+o.status))}).catch(()=>{e()})}constructor(){super(),this.#Ft=""}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AocEwcBrMn63AAAAk1JREFUSMftlj9oU1EUxn8neQ0thE6lgpO1TiptHhShJiIu2qHJA6FudtBRUBcpouJUnRyqgpODVcG62LROHfzHexGiJWkEQbCr0IqVYKPStDkOpuYRfW1eTNCh33Tvufec717udz8ObOFfITqV3XA9Njn3W+xAMuO7pnhs7AQiwCqwpvBNVN47Vu8SQDSZwbFMqsexyUyHinQjtAEBwACyTiKyWM1heBzyMHDXdbplRCeiyexVCei8HTfpf5gCwLFM9k/lEF3bpSIXgWNAm6vWceBercQrVfMwcBKhvVRcOwEst2zbXlldXQljGFeAoRpqbUjshSExgo9iM6kHLw7uUIDYTEr0ezDuQeoJw7/8ZLRUCD/ZNz6/AFAqFDolWBr1WyVQh/C7JKgj6eFu0sPdSFBHgC6/RWq7sbCI0g60/gzoqWhy7v762LXzC/AR2NmQG6tyE3jnCoUQHUN0DAi54m+BGw27sUAGyAOjZYUD9Fdty4vqLRX51Mg3bnUSkevAm6rc9XwFXtuWeafyHI0hDgCI6AXg8x/WlwTO+6npS9V23HwKJMtW+ss+FCbsRORVU79TMdByFlhwhT60hELnmvqP+6dzpAf35BG9DBSBoqheej6w+2vsca55xC/jPei04sTN20AKsG3LHN87cg17sKe5ztXHbFnHclrgDEDHwFGa41wuzMb7iCbncKzeHEBsKsuzQ74dsy6vxrF6K0pPROrqdOoibgT+O+LQJvONUFOul7hmgCNlhzKArA/i+nK92tvN2t6/zd1C0/ADiOy3l0UZHxAAAAAASUVORK5CYII="}get name(){return"Mapbox"}get title(){return"Mapbox"}get transitModes(){return["bike","pedestrian","car"]}get providerKeyNeeded(){return!0}set providerKey(t){this.#Ft=t}get userLanguage(){return super.userLanguage}set userLanguage(t){super.userLanguage=theOsrmTextInstructions.loadLanguage(t)}}class MapzenValhallaRouteProvider extends BaseRouteProvider{#Ft;#gi;static get#Hu(){return 6}static get#Fu(){return["undefined","depart-default","depart-right","depart-left","arrive-default","arrive-right","arrive-left","new-name-straight","continue-straight","turn-slight-right","turn-right","turn-sharp-right","u-turn-right","u-turn-left","turn-sharp-left","turn-left","turn-slight-left","undefined","on-ramp-right","on-ramp-left","off-ramp-right","off-ramp-left","stay-straight","stay-right","stay-left","merge-default","roundabout-right","roundabout-exit","ferry-enter","ferry-exit","undefined","undefined","undefined","undefined","undefined","undefined","undefined"]}#zu(t,e,o){if(0===t.trip.legs.length)return void o("Route not found");this.#gi.itinerary.itineraryPoints.removeAll(),this.#gi.itinerary.maneuvers.removeAll(),this.#gi.itinerary.hasProfile=!1,this.#gi.itinerary.ascent=0,this.#gi.itinerary.descent=0,t.trip.legs.forEach(t=>{t.shape=(new PolylineEncoder).decode(t.shape,[MapzenValhallaRouteProvider.#Hu,MapzenValhallaRouteProvider.#Hu]);const e=[];for(let o=0;o<t.shape.length;o++){let i=new ItineraryPoint;i.latLng=t.shape[o],e.push(i),this.#gi.itinerary.itineraryPoints.add(i)}t.maneuvers.forEach(t=>{const o=new Maneuver;o.iconName=MapzenValhallaRouteProvider.#Fu[t.type]||"undefined",o.instruction=t.instruction||"",o.distance=(t.length||0)*DISTANCE.metersInKm,o.duration=t.time||0,o.itineraryPointObjId=e[t.begin_shape_index].objId,this.#gi.itinerary.maneuvers.add(o)})});const i=this.#gi.wayPoints.iterator;t.trip.locations.forEach(t=>{i.done||(i.value.latLng=[t.lat,t.lon])}),e(this.#gi)}#Uu(){const t={locations:[],costing:"",directions_options:{language:this.userLanguage},costing_options:{}},e=this.#gi.wayPoints.iterator;for(;!e.done;)t.locations.push({lat:e.value.lat,lon:e.value.lng,type:e.first||e.last?"break":"through"});switch(this.#gi.itinerary.transitMode){case"bike":t.costing="bicycle",t.costing_options={bicycle:{maneuver_penalty:30,bicycle_type:"Cross",cycling_speed:"20.0",use_roads:"0.25",use_hills:"0.25"}};break;case"pedestrian":t.costing="pedestrian",t.costing_options={pedestrian:{walking_speed:"4.0"}};break;case"car":t.costing="auto",t.costing_options={auto:{country_crossing_cost:"60"}}}return"https://api.stadiamaps.com/route?json="+JSON.stringify(t)+"&api_key="+this.#Ft}#ju(t,e){fetch(this.#Uu()).then(o=>{200===o.status&&o.ok?o.json().then(o=>this.#zu(o,t,e)):e(new Error("Invalid status "+o.status))}).catch(()=>{e()})}constructor(){super(),this.#Ft=""}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wAAAAAzJ3zzAAAGTElEQVRIx+VXe1BU1xn/zjn7ugvL4sIuQnll5U0ELAQxig7WiQYz6NRHa6O206qdSXXSxs60dTK200zNY9q0dcRpMs1jkrRNWmaijCVoaUuHgJESg1JY2DfIQ4EFlr13797de87pH5VILamsnTZ/9Pfn7373/s73fb/7nXMQ55zDpwAMnxLuW/hyZ7frfy7MOY+91vi2TZKkwH9F+NpHfZNupzeoqlRczN+cuCXKkmJ2O73auxYUHvbfCHR/0BO6l7BmKZJSOk8ISXINeW3uId9c72WHuG33Jla+5kGlsDhP7+gfAgCA3g/7eHFpYcTt8kq9PX38z+91keKKPMw5CNU1VUBVGiIaYlpKAy3l6tM//oVXVWnyfFDU7NxTHyqrKE3x+4al/r5BnSAYxM72buIeGLFRykLffPrQtN87smJ1RUk0L99uDkzPhJ7/wWmhpLwg2na+c+Kdiy+XLDtj20prZlb2ZyaudF01vXr21xZjgkGu27oBr6ksU83mJPJ6Y5MNIQBCsMlqTYnk2rOh/7qDn/ttS7jvr06Wk5/BajZUTXucw+lxlVqr1eCMzHTLqoJcedtjm5XMrAw+6HBBS/MfNKVlRSJCd2IH+oe0gamZSK49W7v38R3Sl76sCZxrakm123NTrDZLclzmQhhHGWM6grGsKEowyZxkqa6ptBz5xleSXENe8z8Z8MN+9eDX9lkEo6C2XvijlmiITafXIUqZHmEkx5UxwTjMKE1NNCWkqioNLzJd5NK5DkIIBuDA6/fU3Vy/sQb/5NQZufeKI+27Pzo6yyijVltKqqqqgBGeAQDjsoUxxtFwWB7T6XUrGWN0gfd6/CFCsNVelCUdOLR31uv2G7539JQZY6RNSUsOF5cUCn7fCMMYRWKxWAhhROPKWKPVIEopzcnNCkXkiHi15xq9/tHfyKXz7+sOPbkvkJmVLv6y8S3LmO+WCeN/NLxhzyPhQYcTGwyGYFlFaRKlVEQI4WULcw6xwuJ84nH5cHNTa9Q9cCNzwUzb99TNY4KVZ77zMwEAzgLAFgCoZIzH8grs0oljz2UjBJaMHFtw45aa5LpHaqcYYzLGWFhSWI2p1OX0zPZdGyBtFzqILCm2j422yME166vmn/9+owUA9r/VfPbd/Q1PrACAqe2766S+awMCQoAAAMaHJ81vv9IMALCCUhbaurN2tqJyNS4oyjMIgqD/JFcvuU2uKs6enQ+G9LIYMQKA5TZtBgC8dn1lqPmdS6Z4ZvW/TC7OIebz+mc9Lh/vbL+C3AM3bAgBPHXyyPT537Vij2PEAgAKAFwCgOpVJdmoYdc2zU+feXlhMXC71CzXnj1fXFKYhjE23LPHCIHW5xnWr7Akhw8fPShE5MhoKCQmm0yJsscxknU7TM85PLbrwLaZNVXlkZd+/rp+7abyucrqcpaWnhZklCYJghBufrdVW/pgsWHZA0QOy0FCcHTYN2IOBGYTKz5blvhBV0/SorKHfvjit0eNCYLm6SefS3t0x+fY0aeOJK/bsNYCALbrvf0mhBGNKlEW7+4kGASDcWZmLmjW66KiKAVbmtqNACB//fjjYas1NfTS6Tes48OTCQghKF1dHP34gxoSZoxbDQZDLud8Kq6RyTjXazVagyzJQUKI3H25R123eY3U+MazMeAAp06czh0fnkxY6GdKqiXtzvAhyvjohB8TrDDGjXEJc8Z0mGCFUmoUBENqVk7m3I5dj/KO9i5GNCS8OHbjlhr+++aLEy6nJ0gpVTQagjgHPcE4yjnXxVVqxrgBYzwuimGhrfUvzOXwWwtKHlAf3ljNch7IVji/838XlRSIiqIIXR3d6gsnz4Qfqi1PlOUIRRgHlIiSEZfw1GRg/MSxZ40JJsG4+0B9pGFX/dTY6Hhye1snFBTdTMwvzZ5cOAhMTU7TP13s0KyrrYqefOG4Oj52M/bKmd+kH957nALAKADYly28dftmdvCrX+DvXWjTNb3ZEklN60rcUr9J88UDn+fpGStNgtEguQdGYOvOWlbz8EM5efn26YH+QfjVa03EMziiLyqzo2PHj5jcLq/0706Mnwifx39rbjY4czc/PjYxs7/hCd579Xrw7meSJM27nJ55fg8Avw8wxqKH931rThTFaX6fgPt9sev9K07+HwD9392d/g5xBCylN3zlQgAAAABJRU5ErkJggg=="}get name(){return"MapzenValhalla"}get title(){return"Mapzen Valhalla with Stadia Maps"}get transitModes(){return["bike","pedestrian","car"]}get providerKeyNeeded(){return!0}set providerKey(t){this.#Ft=t}}class OpenRouteServiceRouteProvider extends BaseRouteProvider{#Ft;#gi;static get#Hu(){return 5}static get#Fu(){return["turn-left","turn-right","turn-sharp-left","turn-sharp-right","turn-slight-left","turn-slight-right","continue-straight","roundabout-right","roundabout-exit","u-turn-left","arrive-default","depart-default","stay-left","stay-right"]}#zu(t,e,o){if(!t.routes||0===t.routes.length)return void o(new Error("Route not found"));t.routes[0].geometry=(new PolylineEncoder).decode(t.routes[0].geometry,[OpenRouteServiceRouteProvider.#Hu,OpenRouteServiceRouteProvider.#Hu,2]),this.#gi.itinerary.itineraryPoints.removeAll(),this.#gi.itinerary.maneuvers.removeAll(),this.#gi.itinerary.hasProfile=!0,this.#gi.itinerary.ascent=0,this.#gi.itinerary.descent=0;let i=0,n=new ItineraryPoint;n.lat=t.routes[0].geometry[i][0],n.lng=t.routes[0].geometry[i][1],n.elev=t.routes[0].geometry[i][2],this.#gi.itinerary.itineraryPoints.add(n),i++,t.routes[0].segments.forEach(e=>{e.steps.forEach(e=>{let o=new Maneuver;for(o.iconName=OpenRouteServiceRouteProvider.#Fu[e.type]||"kUndefined",o.instruction=e.instruction,o.duration=e.duration,o.distance=e.distance,o.itineraryPointObjId=this.#gi.itinerary.itineraryPoints.last.objId,this.#gi.itinerary.maneuvers.add(o);i<=e.way_points[1];)n.lat===t.routes[0].geometry[i][0]&&n.lng===t.routes[0].geometry[i][1]||(n=new ItineraryPoint,n.lat=t.routes[0].geometry[i][0],n.lng=t.routes[0].geometry[i][1],n.elev=t.routes[0].geometry[i][2],this.#gi.itinerary.itineraryPoints.add(n)),i++})});const r=this.#gi.wayPoints.iterator;t.routes[0].way_points.forEach(e=>{r.done||(r.value.latLng=t.routes[0].geometry[e])}),e(this.#gi)}#Uu(){let t="https://api.openrouteservice.org/v2/directions/";switch(this.#gi.itinerary.transitMode){case"car":t+="driving-car";break;case"bike":t+="cycling-regular";break;case"pedestrian":t+="foot-walking";break;default:return}return t}#Vu(){const t=new Headers;return t.append("Accept","application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8"),t.append("Content-Type","application/json"),t.append("Authorization",this.#Ft),t}#Gu(){let t=null;return this.#gi.wayPoints.forEach(e=>{t=t?t+",":'{"coordinates":[',t+="["+e.lng.toFixed(LAT_LNG.fixed)+","+e.lat.toFixed(LAT_LNG.fixed)+"]"}),t+='],"elevation":"true","language":"'+this.userLanguage+'"}',t}#ju(t,e){fetch(this.#Uu(),{method:"POST",headers:this.#Vu(),body:this.#Gu()}).then(o=>{200===o.status&&o.ok?o.json().then(o=>this.#zu(o,t,e)):e(new Error("Invalid status "+o.status))}).catch(()=>{e()})}constructor(){super(),this.#Ft=""}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QAzwBfAF8OMuGdAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAB3RJTUUH4QoBEgIhgj0YgQAAAmdJREFUSMftlk9LYlEYxn+WinqdaWga0owaa9RWFS2iTZt27YJu5K4bFNSqFkFEcaHvUNAmUjdCGdQHqE8QGVGRY1BpOZEFGepo+WcW43WySWYZAz6rc5/3HH7nfR84XJV/ZCTPO6iKd1IFXAFXwP8/WP3a0FutmEURQ2sr5PMkgkEi6+ukr64A6HS5SvZnUilSoRBht5v09TVVgoDF6eRDeztqg4FMPE48EODH5ibP0ejbHWvq6vg2O4umpobvskxAltHW1mKbn0drMpUADyQJvyRxubKC0W6naWwMgObxcT739nK5vMzhxARXHg+1PT20TE2VH7VZFKnW6Yj4fDzd3vIcjRLx+VDr9ZgGBv4alwqIn5wAoLNYADC2tQEg2O3kczke/X4OJInAwkJ5sHIoeXZW9JS1UnupvErFx44OAH5eXPzef34OQIMo4lhcRHA4/p2x2mgEIJtMFj1lrdQUvcz68fiYcOE7tLpKy/Q0+sZGDE1N2ObmeNjfJ+x2k43F3u5YgVQLQtGrLgAziUQJ2D86yvnSErlMhiqNhszDAwDPd3cEZJmwx8NTwfvU1cXXycnyo44HAsV8FAk2GwCJ09PSfPN5Ynt7XHu9GO12zENDf4q5HPe7u5zMzBDx+QAwWK3lwTdbW2TTacyiiNZkQltfj3lwkEwqxc329ptZ3e/skAyHqevrQ2syYZNlOl0uarq7IZcrZq40Vbz46z8QXXMzDaKIodBpMhgksrFBKhQqyfZAkopnvvT3YxkeJnZ4SHhtDYvTieBwoBYEsskkj0dHRLxesvF4eXDlra6AK+AKuAIup1+E4uxBnFG6zQAAAABJRU5ErkJggg=="}get name(){return"OpenRouteService"}get title(){return"OpenRouteService"}get transitModes(){return["bike","pedestrian","car"]}get providerKeyNeeded(){return!0}set providerKey(t){this.#Ft=t}}class OsrmRouteProvider extends BaseRouteProvider{#gi;static get#Hu(){return 6}#zu(t,e,o){if("Ok"!==t.code)return void o(new Error("Response code not ok"));if(0===t.routes.length)return void o(new Error("Route not found"));this.#gi.itinerary.itineraryPoints.removeAll(),this.#gi.itinerary.maneuvers.removeAll(),this.#gi.itinerary.hasProfile=!1,this.#gi.itinerary.ascent=0,this.#gi.itinerary.descent=0;const i=new PolylineEncoder;t.routes[0].geometry=i.decode(t.routes[0].geometry,[OsrmRouteProvider.#Hu,OsrmRouteProvider.#Hu]),t.routes[0].legs.forEach(t=>{let e=0;t.steps.forEach(o=>{o.geometry=i.decode(o.geometry,[OsrmRouteProvider.#Hu,OsrmRouteProvider.#Hu]);const n=new Maneuver;n.iconName=ICON_LIST[o.maneuver.type]?ICON_LIST[o.maneuver.type][o.maneuver.modifier]||ICON_LIST[o.maneuver.type].default:ICON_LIST.default.default,n.instruction=theOsrmTextInstructions.compile(this.userLanguage,o),n.duration=o.duration;let r=0;for(let i=0;1===o.geometry.length?1>i:i<o.geometry.length;i++){const a=new ItineraryPoint;a.latLng=[o.geometry[i][0],o.geometry[i][1]],a.distance=t.annotation.distance[e]?t.annotation.distance[e]:0,this.#gi.itinerary.itineraryPoints.add(a),i!==o.geometry.length-1&&(r+=a.distance,e++),0===i&&(n.itineraryPointObjId=a.objId)}n.distance=r,this.#gi.itinerary.maneuvers.add(n)})});const n=this.#gi.wayPoints.iterator;t.waypoints.forEach(t=>{n.done||(n.value.latLng=[t.location[1],t.location[0]])}),e(this.#gi)}#Uu(){let t=null;this.#gi.wayPoints.forEach(e=>{t=t?t+";":"",t+=e.lng.toFixed(LAT_LNG.fixed)+","+e.lat.toFixed(LAT_LNG.fixed)});let e="";switch(this.#gi.itinerary.transitMode){case"car":e="routed-car";break;case"bike":e="routed-bike";break;case"pedestrian":e="routed-foot";break;default:return}return"https://routing.openstreetmap.de/"+e+"/route/v1/driving/"+t+"?geometries=polyline6&overview=full&steps=true&annotations=distance"}#ju(t,e){fetch(this.#Uu()).then(o=>{200===o.status&&o.ok?o.json().then(o=>this.#zu(o,t,e)):e(new Error("Invalid status "+o.status))})}constructor(){super()}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAB3RJTUUH4QkaDwEMOImNWgAABTZJREFUSMftl21sFEUYx3+zu3ft9a7Q0tIXoKUCIkIVeYsECmgbBKIIEVC0QEs0UIEghA+CEkkIaCyJBhFBBC00qHxoQClvhgLyEonyckhbFKS90iK0FAqFHr273R0/XNlCymEREr44X3by7DPzm5n9z8x/hZRS8giKwiMqjwys3U/y/pIqdh0tp8RTS229F0yIaxtBz+R2jOjfhSFPJbW6L9Gab/zFdjfv5x/k2g0f4TYVISUCEJKmp8QfMGjjsLNoShozxvR7MHD1VS+D53+Pp/oqmqJYoEBAxzQlQoKmCMJUJTgAwDQkye0j2f1JJvHRzvsH/3m+jqfn5IOUICWGYZIY5WTScz1J751EYjsXArh45QZ73BV8W1RC7VUvNkVBEBzUoZXZPJEc03rwhboGkqettWYopeSb2SPIHPbkPZfvu6JSZizfidIExpQU5+eQ0M7VOnDS9LVcvNKAkBDtDOf35ZOIj3K2SjSXrnoZNDOPuvqbCCA+yklxfs6/g3O3HOXd/ANoikCakvPrphEfFWG9P1R6ni+3n6Ck4hJI6JUcS/YLqaQ/09nKuVx/kx6TVoGUmIZkYVYac18beG+wfeLnGIaBqZtseGckk59rXt7xH/5IwaHTRNjVO1Tt8wcY1b8rWxaPs3J/OHiarKVbsKkqqoCLW+eFPkB2uD0EfAEAOsa67oC+tHgzW387iyNMQ0qJ1xfA6wsgpSTcprHX7eHFBZus/DFp3XksMRoAX0Bn169nQ4N3HT+H0FQApqb3suLbj5Sx7UgZihA0Bgxmje5HeV4Ong05zB7bn8aAjhCCfSfOUfjLGatd5vBUkGDXVPYeKQ8NdldcCu7FgMHIPilWfMU2N2E2FVNK3pvwLLlvDqNzXBuS2rdh6dShfJCZhikldpvKmkK31e75vin4AjoAxWU1ocHV17zBimnS4bYtcKysGgC/T2feK/1bKHTu+AF4G4OfyH2m2oonxrgwTGmpPSRYms11VRFWPaA3vZCSMFvL4z3MpnFLorrZ3IkixG19y9DgmMjwWy34+0qDFe/RqR0AtjAbeUXFLcAbfjpJRHhwQI835QJU1zVYE4hqEx4anJocAwKEprK3uNKKZ6X3wjAlqiKYvXoP63c3wzfuKWHGil2oioJhSt7IaBbl/hPnsNuCYu2ZEhd6Hxcc/ovxuYUoqqB7QhSnVmRZid1z1lFZcx0BGLqB36+DBIddw6YKhITEaCen8qZbbQbmfE1ZVR2GYbBuwcuMHdrj7jMeN7CbVf+j8jI7jnmaBfbpZDrEuDClRFMVnA47LocdTVUwTUlctJPDK7Ot/KKj5ZSW1yIBw5R3QO/qQOaN7QcSNJvKq8sKaWhSq8th5+xXb7F40mA6xUbScNPPDa+fjjGRLMwczOm86bR1hgFw06eT/dFWwuzBZZ45bkDrLglX5kp8fh0hITk2kpOfTcFhb51ZafTrDJqZx7mL1xAED4+qzXMQrfFcB5ZMQPcbAFTWXichazU/3ya2UOVQcRXdMldRUX0teFT6DQo/ntgCek8jsPO4h1GLCrDbNZASv1+nX9d4sjJSyeidREJ00AhcqGtgn7uCjUUlHDt9AYdNQyDx+XQKlkxgxIAu9299jpbVMGT+JgzDsG4j2TQIacqgFhRBuKagCmHlaIpgZ+7r9O2e8N/NXsAwmbVmD2u2ubFpKpoiWpo9JNIIGr63R/dhWU4Gmqo8uMsE8OsG64tK2X3cQ7Gnhsv1jShS0L5tOL2SY8jok8Lk4anYm263h2Jv//+FeRjlHxKxS4in4X1YAAAAAElFTkSuQmCC"}get name(){return"OSRM"}get title(){return"OSRM"}get transitModes(){return["bike","pedestrian","car"]}get providerKeyNeeded(){return!1}get userLanguage(){return super.userLanguage}set userLanguage(t){super.userLanguage=theOsrmTextInstructions.loadLanguage(t)}}const OUR_HALF_PI=Math.PI/2;class PolylineRouteProvider extends BaseRouteProvider{#gi;static get#Zu(){return Object.freeze({en:Object.freeze({kStart:"Start",kContinue:"Continue",kEnd:"Stop"}),fr:Object.freeze({kStart:"DÃ©part",kContinue:"Continuer",kEnd:"ArrivÃ©e"})})}static get#Xu(){return Object.freeze({kStart:"depart-default",kContinue:"continue-straight",kEnd:"arrive-default"})}#Yu(t,e){const o=new Maneuver;o.iconName=PolylineRouteProvider.#Xu[e],o.instruction=PolylineRouteProvider.#Zu[this.userLanguage]?PolylineRouteProvider.#Zu[this.userLanguage][e]:PolylineRouteProvider.#Zu.en[e],o.duration=0,o.itineraryPointObjId=t,this.#gi.itinerary.maneuvers.add(o)}#qu(t){const e=new ItineraryPoint;return e.latLng=t,this.#gi.itinerary.itineraryPoints.add(e),e.objId}#Ju(t,e){const o=[t.lat*DEGREES.toRadians,t.lng*DEGREES.toRadians],i=[e.lat*DEGREES.toRadians,e.lng*DEGREES.toRadians],n=(e.lng-t.lng+DEGREES.d360)%DEGREES.d360>DEGREES.d180?-1:1,r=theSphericalTrigonometry.arcFromSummitArcArc(i[1]-o[1],OUR_HALF_PI-o[0],OUR_HALF_PI-i[0]);if(.1>r*DEGREES.fromRadians)return;const a=theSphericalTrigonometry.summitFromArcArcArc(OUR_HALF_PI-o[0],r,OUR_HALF_PI-i[0]),s=[];for(let t=1;t<=64;t++){const e=r*t/64,i=theSphericalTrigonometry.arcFromSummitArcArc(a,OUR_HALF_PI-o[0],e),l=theSphericalTrigonometry.summitFromArcArcArc(OUR_HALF_PI-o[0],i,e),h=new ItineraryPoint;h.latLng=[(OUR_HALF_PI-i)*DEGREES.fromRadians,(o[1]+n*l)*DEGREES.fromRadians],s.push(h)}e.lng=s.pop().lng,s.forEach(t=>this.#gi.itinerary.itineraryPoints.add(t))}#$u(){let t=this.#gi.wayPoints.iterator,e=null;for(;!t.done;)t.first?(e=t.value,this.#Yu(this.#qu(t.value.latLng),"kStart")):(this.#Ju(e,t.value),this.#Yu(this.#qu(t.value.latLng),t.last?"kEnd":"kContinue"),e=t.value);let o=-Number.MAX_VALUE,i=this.#gi.itinerary.itineraryPoints.iterator;for(;!i.done;)o=Math.max(o,i.value.lng);const n=o%DEGREES.d360-o;for(i=this.#gi.itinerary.itineraryPoints.iterator;!i.done;)i.value.lng+=n;for(t=this.#gi.wayPoints.iterator;!t.done;)t.value.lng+=n}#Qu(){const t=[this.#gi.wayPoints.first.lat*DEGREES.toRadians,this.#gi.wayPoints.first.lng*DEGREES.toRadians],e=[this.#gi.wayPoints.last.lat*DEGREES.toRadians,this.#gi.wayPoints.last.lng*DEGREES.toRadians],o=theSphericalTrigonometry.arcFromSummitArcArc(t[1]-e[1],OUR_HALF_PI-t[0],OUR_HALF_PI-e[0]),i=360,n=[];for(let e=0;e<=i;e++){const r=Math.PI/720+Math.PI*e/i,a=theSphericalTrigonometry.arcFromSummitArcArc(r,o,OUR_HALF_PI-t[0]),s=theSphericalTrigonometry.summitFromArcArcArc(OUR_HALF_PI-t[0],a,o);let l=new ItineraryPoint;l.latLng=[(OUR_HALF_PI-a)*DEGREES.fromRadians,(t[1]+s)*DEGREES.fromRadians],n.push(l),l=new ItineraryPoint,l.latLng=[(OUR_HALF_PI-a)*DEGREES.fromRadians,(t[1]-s)*DEGREES.fromRadians],n.unshift(l),e===i&&(this.#Yu(l.objId,"kStart"),l=new ItineraryPoint,l.latLng=[(OUR_HALF_PI-a)*DEGREES.fromRadians,(t[1]-s)*DEGREES.fromRadians],this.#Yu(l.objId,"kEnd"),n.push(l))}n.forEach(t=>this.#gi.itinerary.itineraryPoints.add(t))}#zu(t,e){try{switch(this.#gi.itinerary.itineraryPoints.removeAll(),this.#gi.itinerary.maneuvers.removeAll(),this.#gi.itinerary.hasProfile=!1,this.#gi.itinerary.ascent=0,this.#gi.itinerary.descent=0,this.#gi.itinerary.transitMode){case"line":this.#$u();break;case"circle":this.#Qu()}t(this.#gi)}catch(t){e(t)}}constructor(){super()}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#zu(t,e))}get icon(){return'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <circle cx="12" cy="12" r="3" stroke="rgb(0,0,0)" fill="transparent" /> <line x1="5" y1="17" x2="11" y2="2" stroke="rgb(0,0,0)" /> <line x1="3" y1="6" x2="17" y2="9" stroke="rgb(191,0,0)" /> <line x1="3" y1="16" x2="17" y2="5" stroke="rgb(255,204,0)" /> </svg>'}get name(){return"Polyline"}get title(){return"Polyline & Circle"}get transitModes(){return["line","circle"]}get providerKeyNeeded(){return!1}}class SelectOptionData{#he;#t;constructor(t,e){Object.freeze(this),this.#he=t,this.#t=e}get text(){return this.#he}get objId(){return this.#t}}class SelectDialog extends ModalBaseDialog{#tp;constructor(t){super(t)}createContentHTML(){this.#tp=new SelectControl({elements:Array.from(this.options.selectOptionsData,t=>t.text)})}get title(){return this.options.title||""}get contentHTMLElements(){return[this.#tp.controlHTMLElement]}onOk(){super.onOk(this.options.selectOptionsData[this.#tp.selectedIndex].objId)}}class PublicTransportData{#ep;#op;#ip;#np;#rp;#ap;constructor(t){Object.freeze(this),this.#ep=-1,this.#op=t,this.#ip=new Map,this.#np=new Map,this.#rp=new Map,this.#ap=0}get nodes3WaysCounter(){return this.#ap}set nodes3WaysCounter(t){this.#ap=t}get waysMap(){return this.#ip}get nodesMap(){return this.#np}get stopsMap(){return this.#rp}get newId(){return this.#ep--}firstOf(t){return t[0]}lastOf(t){return t[t.length-1]}removeFrom(t,e){t.splice(t.indexOf(e),1)}#sp(t){const e=this.#np.get(this.firstOf(t.nodesIds)),o=this.#np.get(this.lastOf(t.nodesIds));this.removeFrom(e.startingWaysIds,t.id),e.endingWaysIds.push(t.id),this.removeFrom(o.endingWaysIds,t.id),o.startingWaysIds.push(t.id),t.nodesIds.reverse()}mergeWays(t,e){const o=this.#ip.get(t),i=this.#ip.get(e);this.lastOf(o.nodesIds)===this.lastOf(i.nodesIds)?this.#sp(i):this.firstOf(o.nodesIds)===this.firstOf(i.nodesIds)?this.#sp(o):this.firstOf(o.nodesIds)===this.lastOf(i.nodesIds)&&(this.#sp(o),this.#sp(i));const n=this.#np.get(o.nodesIds.pop());n.startingWaysIds=[],n.endingWaysIds=[],o.nodesIds=o.nodesIds.concat(i.nodesIds),o.distance+=i.distance;const r=this.#np.get(this.lastOf(o.nodesIds));return this.removeFrom(r.endingWaysIds,i.id),r.endingWaysIds.push(o.id),this.#ip.delete(i.id),o.id}#D(t){const e=this.#np.get(t),o={id:this.newId,lat:e.lat,lon:e.lon,type:"node",startingWaysIds:[],endingWaysIds:[],isNode3Ways:e.isNode3Ways};return this.#np.set(o.id,o),o.id}cloneWay(t){const e=this.#ip.get(t),o={id:this.newId,type:"way",nodesIds:[],distance:e.distance};return e.nodesIds.forEach(t=>o.nodesIds.push(this.#D(t))),this.#np.get(this.firstOf(o.nodesIds)).startingWaysIds.push(o.id),this.#np.get(this.lastOf(o.nodesIds)).endingWaysIds.push(o.id),this.#ip.set(o.id,o),o.id}createMaps(t){this.#ip.clear(),this.#np.clear(),this.#rp.clear(),t.forEach(t=>{switch(t.type){case"way":t.nodesIds=t.nodes,delete t.nodes,2<=t.nodesIds.length&&(t.distance=0,this.#ip.set(t.id,t));break;case"node":t.startingWaysIds=[],t.endingWaysIds=[],t.isNode3Ways=!1,this.#np.set(t.id,t);break;case"relation":t.members.forEach(t=>{"node"===t.type&&t.role&&-1!==t.role.indexOf("stop")&&this.#rp.set(t.ref,t.ref)})}}),this.#rp.forEach(t=>{const e=this.#np.get(t);e?this.#rp.set(t,e):(theErrorsUI$1.showInfo("the relation "+this.#op+" have nodes not positionned on the railway ( node "+t+")."),this.#rp.delete(t))}),this.#ip.forEach(t=>{this.#np.get(this.firstOf(t.nodesIds)).startingWaysIds.push(t.id),this.#np.get(this.lastOf(t.nodesIds)).endingWaysIds.push(t.id);let e=null;t.nodesIds.forEach(o=>{const i=this.#np.get(o);e&&(t.distance+=theSphericalTrigonometry.pointsDistance([i.lat,i.lon],[e.lat,e.lon])),e=i})})}}class PublicTransportHolesRemover{#lp;#hp(t,e,o){t.isNode3Ways||e.isNode3Ways||o.push({distance:theSphericalTrigonometry.pointsDistance([t.lat,t.lon],[e.lat,e.lon]),nodesId:[t.id,e.id]})}#dp(){const t=[],e=Array.from(this.#lp.waysMap.values());let o=1;e.forEach(i=>{for(let n=o;n<e.length;n++){const o=[];o.push(this.#lp.nodesMap.get(this.#lp.firstOf(i.nodesIds))),o.push(this.#lp.nodesMap.get(this.#lp.lastOf(i.nodesIds))),o.push(this.#lp.nodesMap.get(this.#lp.firstOf(e[n].nodesIds))),o.push(this.#lp.nodesMap.get(this.#lp.lastOf(e[n].nodesIds))),this.#hp(o[0],o[2],t),this.#hp(o[0],o[3],t),this.#hp(o[1],o[2],t),this.#hp(o[1],o[3],t)}o++});let i=t[0];t.forEach(t=>{t.distance<i.distance&&(i=t)});const n={id:this.#lp.newId,type:"way",nodesIds:i.nodesId,distance:i.distance};this.#lp.waysMap.set(n.id,n);const r=this.#lp.nodesMap.get(i.nodesId[0]),a=r.startingWaysIds.concat(r.endingWaysIds)[0];r.startingWaysIds.push(n.id);const s=this.#lp.nodesMap.get(i.nodesId[1]),l=s.startingWaysIds.concat(s.endingWaysIds)[0];s.endingWaysIds.push(n.id),this.#lp.mergeWays(this.#lp.mergeWays(n.id,a),l),this.#lp.waysMap.size>2*this.#lp.nodes3WaysCounter+1&&this.#dp()}constructor(t){Object.freeze(this),this.#lp=t}removeHoles(){this.#dp()}}class PublicTransportRouteBuilder{#op;#cp;#gi;#lp;#up(){this.#cp.forEach(t=>{let e=Number.MAX_VALUE,o=null;const i=t.startingWaysIds.concat(t.endingWaysIds);i.forEach(t=>{const i=this.#lp.waysMap.get(t);i.distance<e&&(e=i.distance,o=i)}),this.#lp.removeFrom(i,o.id);const n=this.#lp.waysMap.get(this.#lp.cloneWay(o.id));let r=null;this.#lp.firstOf(o.nodesIds)===t.id?(n.nodesIds.pop(),n.nodesIds.push(this.#lp.lastOf(o.nodesIds)),r=this.#lp.firstOf(n.nodesIds)):(n.nodesIds.shift(),n.nodesIds.unshift(this.#lp.firstOf(o.nodesIds)),r=this.#lp.lastOf(n.nodesIds));const a=this.#lp.waysMap.get(i[1]);a.nodesIds[a.nodesIds.indexOf(t.id)]=r,this.#lp.mergeWays(this.#lp.mergeWays(this.#lp.mergeWays(o.id,n.id),i[0]),a.id)})}#wa(t){let e=null,o=null,i=Number.MAX_VALUE,n=Number.MAX_VALUE;this.#lp.stopsMap.forEach(t=>{let r=theSphericalTrigonometry.pointsDistance([t.lat,t.lon],this.#gi.wayPoints.first.latLng);r<i&&(i=r,e=t),r=theSphericalTrigonometry.pointsDistance([t.lat,t.lon],this.#gi.wayPoints.last.latLng),r<n&&(n=r,o=t)}),t.itinerary.itineraryPoints.removeAll(),t.itinerary.maneuvers.removeAll(),t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0;let r=0,a=!1;Array.from(this.#lp.waysMap.values())[0].nodesIds.forEach(i=>{if(0!==r||i!==e.id&&i!==o.id?2!==r||i!==e.id&&i!==o.id||(r=3):(r=1,a=i===o.id),0<r&&4>r){const n=new ItineraryPoint,r=this.#lp.nodesMap.get(i);n.latLng=[r.lat,r.lon],t.itinerary.itineraryPoints.add(n);const a=this.#lp.stopsMap.get(i);if(a){const i=new Maneuver;let r=null;a.tags&&a.tags.name&&(r=a.tags.name,i.instruction=r+"&nbsp;:&nbsp;"),a.id===e.id?(r&&(t.wayPoints.first.name=r),i.iconName="train-start",i.instruction+="Monter dans le train"):a.id===o.id?(r&&(t.wayPoints.last.name=r),i.iconName="train-end",i.instruction+="Descendre du train"):(i.iconName="train-continue",i.instruction+="Rester dans le train"),i.distance=0,i.duration=0,i.itineraryPointObjId=n.objId,t.itinerary.maneuvers.add(i)}}1===r&&(r=2),3===r&&(r=4)}),a&&(t.itinerary.itineraryPoints.reverse(),t.itinerary.maneuvers.reverse()),t.distance=0;const s=t.itinerary.maneuvers.iterator;s.done;let l=s.value;s.done;const h=t.itinerary.itineraryPoints.iterator;h.done;let d=h.value;for(;!h.done;)h.value.distance=0,d.distance=theSphericalTrigonometry.pointsDistance(d.latLng,h.value.latLng),t.distance+=d.distance,l.distance+=d.distance,s.value.itineraryPointObjId===h.value.objId&&(l=s.value,l.distance=0,s.done),d=h.value}constructor(t,e){Object.freeze(this),this.#gi=t,this.#op=e,this.#lp=new PublicTransportData(e),this.#cp=[]}buildRoute(t,e,o){this.#cp=[],this.#lp.nodes3WaysCounter=0,this.#lp.createMaps(t.elements);let i=!1;this.#lp.nodesMap.forEach(t=>{const e=t.startingWaysIds.concat(t.endingWaysIds);switch(e.length){case 0:case 1:break;case 2:this.#lp.mergeWays(e[0],e[1]);break;case 3:t.isNode3Ways=!0,this.#cp.push(t),this.#lp.nodes3WaysCounter++;break;default:i=!0,theErrorsUI.showInfo("A node with more than 3 ways is found : "+t.id+" - the relation "+this.#op+" - ways "+t.startingWaysIds.concat(t.endingWaysIds))}}),i?o(new Error("A node with more than 3 ways was found in the relation.See the console for more infos")):(this.#lp.waysMap.size>2*this.#lp.nodes3WaysCounter+1&&(new PublicTransportHolesRemover(this.#lp).removeHoles(),theErrorsUI.showInfo("Holes found in the OSM relation number "+this.#op+". Try to correct OSM data.")),0<this.#lp.nodes3WaysCounter&&this.#up(),this.#wa(this.#gi),e(this.#gi))}}class PublicTransportRouteProvider extends BaseRouteProvider{#gi;#zu(t,e,o){new PublicTransportRouteBuilder(this.#gi).buildRoute(t,e,o)}#pp(t){return theConfig.overpassApi.url+"?data=[out:json];rel("+t.toFixed(0)+');way(r)->.e;way.e["railway"="rail"];(._;>;rel('+t.toFixed(0)+"););out;"}#mp(t){if(0===t.elements.length)return Promise.reject(new Error("No relations found"));const e=[];t.elements.forEach(t=>{e.push(new SelectOptionData(t.tags.name,t.id))});return new SelectDialog({title:"Relations",text:"select a relation : ",selectOptionsData:e}).show()}get#gp(){return theConfig.overpassApi.url+'?data=[out:json];node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+this.#gi.wayPoints.first.lat.toFixed(LAT_LNG.fixed)+","+this.#gi.wayPoints.first.lng.toFixed(LAT_LNG.fixed)+')->.s;rel(bn.s)->.s;node["public_transport"="stop_position"]["train"="yes"](around:400.0,'+this.#gi.wayPoints.last.lat.toFixed(LAT_LNG.fixed)+","+this.#gi.wayPoints.last.lng.toFixed(LAT_LNG.fixed)+")->.e;rel(bn.e)->.e;rel.e.s;out tags;"}#ju(t,e){fetch(this.#gp).then(o=>{200===o.status&&o.ok?o.json().then(t=>this.#mp(t)).then(t=>fetch(this.#pp(t))).then(o=>{200===o.status&&o.ok?o.json().then(o=>this.#zu(o,t,e)):e(new Error("An error occurs..."))}).catch(()=>e(new Error("An error occurs..."))):e(new Error("An error occurs..."))}).catch(()=>{e()})}constructor(){super()}getPromiseRoute(t){return this.#gi=t,new Promise((t,e)=>this.#ju(t,e))}get icon(){return'data:image/svg+xml;utf8,<svg viewBox="-3 -3 20 20" xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(128,0,0)"><path d="M 5,0 C 3.025911,-0.0084 1,3 1,7 l 0,2 c 0,1 1,2 2,2 l 8,0 c 1,0 2,-1 2,-2 L 13,7 C 13,3 11,0 9,0 z m -1,3 6,0 c 0,0 1,1 1,3 L 3.03125,6 C 2.994661,3.9916 4,3 4,3 z M 3,8 6,8 6,9 3,9 z m 5,0 3,0 0,1 -3,0 z m -6,4 -1,2 3,0 1,-2 z m 7,0 1,2 3,0 -1,-2 z"/></g></svg>'}get name(){return"PublicTransport"}get title(){return"Public Transport on OpenStreetMap"}get transitModes(){return["train"]}get providerKeyNeeded(){return!1}}class TravelNotes{#vp=!1;constructor(){Object.freeze(this)}async addReadOnlyTravel(t){if(this.#vp)return;this.#vp=!0,theAttributionsUI.createUI(),theMapLayersManager.setMapLayer("OSM - Color");const e=await fetch(t);200===e.status&&e.ok?(new ViewerFileLoader).openDistantFile(await e.json()):(theTravelNotesData.map.setView([LAT_LNG.defaultValue,LAT_LNG.defaultValue],2),document.title="Travel & Notes")}addToolbarsMenusUIs(t,e){this.#vp||(this.#vp=!0,document.title="Travel & Notes",theTravelNotesData.map.on("contextmenu",MapMouseELs.handleContextMenuEvent),theTravelNotesData.map.on("click",MapMouseELs.handleClickEvent),theTravelNotesData.map.setView([theConfig.map.center.lat,theConfig.map.center.lng],theConfig.map.zoom),theAttributionsUI.createUI(),theMouseUI.createUI(),theMouseUI.saveStatus=SAVE_STATUS.saved,theErrorsUI$1.showHelp("<p>"+theTranslator.getText("Help - Continue with interface1")+"</p><p>"+theTranslator.getText("Help - Continue with interface2")+"</p>"),theMapLayersToolbar.createUI(),theMapLayersManager.setMapLayer("OSM - Color"),theTravelNotesToolbar.createUI(),thePluginsManager.addProvider(OpenRouteServiceRouteProvider),thePluginsManager.addProvider(MapzenValhallaRouteProvider),thePluginsManager.addProvider(MapboxRouteProvider),thePluginsManager.addProvider(GraphHopperRouteProvider),thePluginsManager.addProvider(OsrmRouteProvider),thePluginsManager.addProvider(PublicTransportRouteProvider),thePluginsManager.addProvider(PolylineRouteProvider),theApiKeysManager.addProvidersKeys(),theProvidersToolbar.createUI(),theApiKeysManager.setKeysFromServerFile(),theTravelNotesData.travel.jsonObject=(new Travel).jsonObject,theConfig.travelNotes.startupRouteEdition&&theRouteEditor.editRoute(theTravelNotesData.travel.routes.first.objId),theEventDispatcher.dispatch("updatetravelproperties"),theEventDispatcher.dispatch("updateroadbook"),t&&e&&theNoteEditor.newUrlNote([t,e]))}get version(){return"v5.0.0-dev"}}const theTravelNotes=new TravelNotes;class ConfigOverloader{#fp(t,e){if("object"==typeof t&&"object"==typeof e){for(const o in e)"object"==typeof e[o]?this.#fp(t[o],e[o]):typeof t[o]==typeof e[o]&&("string"==typeof e[o]?e[o]="color"===o?theHTMLSanitizer.sanitizeToColor(t[o])||e[o]:"url"===o?theHTMLSanitizer.sanitizeToUrl(t[o]).url:theHTMLSanitizer.sanitizeToJsString(t[o]):e[o]=t[o]||e[o]);for(const o in t)"object"==typeof t[o]?("[object Array]"===Object.prototype.toString.call(t[o])?e[o]=e[o]||[]:e[o]=e[o]||{},this.#fp(t[o],e[o])):"string"==typeof e.property?e[o]=theHTMLSanitizer.sanitizeToHtmlString(t[o],[]).htmlString:e[o]=t[o]}}#Tp(t){for(const e in t)"object"==typeof t[e]&&this.#Tp(t[e]);Object.freeze(t)}constructor(){Object.freeze(this)}overload(t){this.#fp(t,theConfig),this.#Tp(theConfig)}}class RouteHTMLViewsFactory{#yp(t,e){const o=theHTMLElementsFactory.create("div"),i=theHTMLElementsFactory.create("div",{className:t+"route-maneuvers-and-notes-icon-cell"},o);theHTMLElementsFactory.create("div",{className:"travelnotes-maneuver-note travelnotes-maneuver-note-"+e.maneuver.iconName},i),i.dataset.tanWidth=String(ICON_DIMENSIONS.width)+"px",i.dataset.tanHeight=String(ICON_DIMENSIONS.height)+"px";const n=theHTMLElementsFactory.create("div",{className:t+"route-maneuvers-and-notes-cell"},o);return theHTMLElementsFactory.create("div",{className:t+"maneuver-tooltip-content",textContent:theTranslator.getText("RouteHTMLViewsFactory - "+e.maneuver.iconName)},n),theHTMLSanitizer.sanitizeToHtmlElement(e.maneuver.instruction,theHTMLElementsFactory.create("div",{className:t+"route-maneuver-instruction"},n)),e.route.chain&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+theUtilities.formatDistance(e.route.chainedDistance+e.maneuverDistance),theHTMLElementsFactory.create("div",{className:t+"route-maneuver-travel-distance"},n)),theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+theUtilities.formatDistance(e.maneuverDistance),theHTMLElementsFactory.create("div",{className:t+"route-maneuver-route-distance"},n)),DISTANCE.defaultValue<e.maneuver.distance&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Next maneuver after")+"</span>Â :Â "+theUtilities.formatDistance(e.maneuver.distance),theHTMLElementsFactory.create("div",{className:t+"route-maneuver-next-distance"},n)),o}constructor(){Object.freeze(this)}getRouteProfileHTML(t,e){const o=theHTMLElementsFactory.create("div",{className:t+"route-profile"});return theHTMLSanitizer.sanitizeToHtmlElement(theTranslator.getText("RouteHTMLViewsFactory - Profile"),o),o.appendChild((new SvgProfileBuilder).createSvg(e)),o}getRouteManeuversAndNotesHTML(t,e,o){const i=[],n=e.notes.iterator;for(;!n.done;)i.push({data:n.value,distance:n.value.distance});const r=e.itinerary.maneuvers.iterator;let a=0;for(;!r.done;)i.push({data:r.value,distance:a}),a+=r.value.distance;i.sort((t,e)=>t.distance-e.distance);const s=theHTMLElementsFactory.create("div",{className:t+"route-maneuvers-and-notes"});return i.forEach(i=>{let n=null;"Note"===i.data.objType.name?(n=theNoteHTMLViewsFactory.getNoteTextAndIconHTML(t,{note:i.data,route:e}),n.className=t+"route-notes-row"):(n=this.#yp(t,{route:e,maneuver:i.data,maneuverDistance:i.distance}),n.className=t+"route-maneuvers-row"),o&&(n.dataset.tanObjId=i.data.objId,n.dataset.tanMarkerObjId=ObjId.nextObjId,n.dataset.tanObjType=i.data.objType.name),s.appendChild(n)}),s}getRouteHeaderHTML(t,e){const o=theHTMLElementsFactory.create("div",{className:t+"route-header",id:"route"+e.objId});return theHTMLSanitizer.sanitizeToHtmlElement(e.computedName,theHTMLElementsFactory.create("div",{className:t+"route-header-name"},o)),0!==e.distance&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Route distance")+"</span>Â :Â "+theUtilities.formatDistance(e.distance),theHTMLElementsFactory.create("div",{className:t+"route-header-distance"},o)),theTravelNotesData.travel.readOnly||"bike"===e.itinerary.transitMode||theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Duration")+"</span>Â :Â "+theUtilities.formatTime(e.duration),theHTMLElementsFactory.create("div",{className:t+"route-header-duration"},o)),e.itinerary.hasProfile&&(theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Ascent")+"</span>Â :Â "+String(e.itinerary.ascent.toFixed(0))+" m.",theHTMLElementsFactory.create("div",{className:t+"route-header-ascent"},o)),theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("RouteHTMLViewsFactory - Descent")+"</span>Â :Â "+String(e.itinerary.descent.toFixed(0))+" m.",theHTMLElementsFactory.create("div",{className:t+"route-header-descent"},o))),o}getRouteFooterHTML(t,e){let o=""!==e.itinerary.provider&&""!==e.itinerary.transitMode?theTranslator.getText("RouteHTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:theTranslator.getText("RouteHTMLViewsFactory - TransitMode "+e.itinerary.transitMode)}):"";const i=theHTMLElementsFactory.create("div",{className:t+"route-footer"});return theHTMLSanitizer.sanitizeToHtmlElement(o,i),i}}const theRouteHTMLViewsFactory=new RouteHTMLViewsFactory;class RouteMouseOverOrMoveEL{static handleEvent(t){const e=theDataSearchEngine.getRoute(t.target.objId);let o=theGeometry.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;o+=e.chainedDistance,o=theUtilities.formatDistance(o);const i=theTravelNotesData.mapObjects.get(t.target.objId);i.closeTooltip();let n=e.computedName;theTravelNotesData.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),i.setTooltipContent(n),i.openTooltip(t.latlng)}}class NoteLeafletObjects{#Bs;#Lp;#Ep;constructor(t,e,o){Object.freeze(this),this.#Bs=t,this.#Lp=e,this.#Ep=o}get marker(){return this.#Bs}get polyline(){return this.#Lp}get bullet(){return this.#Ep}}class MapEditorViewer{#bp;#_p;static get#Mp(){return 18}static get#wp(){return 0}static get#Dp(){return 100}constructor(){Object.freeze(this),this.#bp=null,this.#_p=null}addToMap(t,e){e.objId=t,e.addTo(theTravelNotesData.map),theTravelNotesData.mapObjects.set(t,e)}addRoute(t){const e=theDataSearchEngine.getRoute(t),o=[],i=e.itinerary.itineraryPoints.iterator;for(;!i.done;)o.push(i.value.latLng);const n=new Polyline(o,{color:e.color,weight:e.width,dashArray:e.dashString});this.addToMap(e.objId,n),"touch"!==theDevice.pointerType&&(n.bindPopup(t=>theHTMLSanitizer.clone(theRouteHTMLViewsFactory.getRouteHeaderHTML("travelnotes-map-",theDataSearchEngine.getRoute(t.objId)))),DomEvent.on(n,"click",t=>t.target.openPopup(t.latlng))),ROUTE_EDITION_STATUS.notEdited===e.editionStatus&&(n.bindTooltip(e.computedName,{sticky:!0,direction:"right"}),"touch"!==theDevice.pointerType&&(DomEvent.on(n,"mouseover",RouteMouseOverOrMoveEL.handleEvent),DomEvent.on(n,"mousemove",RouteMouseOverOrMoveEL.handleEvent)));const r=e.notes.iterator;for(;!r.done;)this.addNote(r.value.objId);return e}addNote(t){const e=theDataSearchEngine.getNoteAndRoute(t).note,o=new Marker(e.latLng,{icon:new DivIcon({iconSize:[theConfig.note.grip.size,theConfig.note.grip.size],iconAnchor:[theConfig.note.grip.size/2,theConfig.note.grip.size/2],html:"<div></div>",className:"travelnotes-map-note-bullet"}),opacity:theConfig.note.grip.opacity,draggable:!theTravelNotesData.travel.readOnly});o.objId=e.objId;const i=new Marker(e.iconLatLng,{zIndexOffset:MapEditorViewer.#Dp,icon:new DivIcon({iconSize:[e.iconWidth,e.iconHeight],iconAnchor:[e.iconWidth/2,e.iconHeight/2],popupAnchor:[0,-e.iconHeight/2],html:e.iconContent,className:"travelnotes-map-all-notes"}),draggable:!theTravelNotesData.travel.readOnly});i.objId=e.objId,i.bindPopup(t=>theHTMLSanitizer.clone(theNoteHTMLViewsFactory.getNoteTextHTML("travelnotes-map-",theDataSearchEngine.getNoteAndRoute(t.objId)))),0!==e.tooltipContent.length&&(i.bindTooltip(t=>theDataSearchEngine.getNoteAndRoute(t.objId).note.tooltipContent),i.getTooltip().options.offset[0]=e.iconWidth/2);const n=new Polyline([e.latLng,e.iconLatLng],theConfig.note.polyline);n.objId=e.objId;const r=new LayerGroup([i,n,o]);return r.markerId=Util.stamp(i),r.polylineId=Util.stamp(n),r.bulletId=Util.stamp(o),this.addToMap(e.objId,r),theConfig.note.haveBackground&&document.querySelectorAll(".travenNotes-map-note,.travelnotes-svg-icon").forEach(t=>t.classList.add("travelnotes-map-note-background")),new NoteLeafletObjects(i,n,o)}zoomTo(t,e){if(e){let t=[];e.forEach(e=>t=t.concat(e)),theTravelNotesData.map.fitBounds(theGeometry.getLatLngBounds(t))}else theTravelNotesData.map.setView(t,theConfig.itineraryPoint.zoomFactor)}setLayer(t,e){const o="wmts"===t.service.toLowerCase()?new TileLayer(e):new TileLayer.WMS(e,t.wmsOptions);this.#bp&&theTravelNotesData.map.removeLayer(this.#bp),theTravelNotesData.map.addLayer(o),this.#bp=o,theTravelNotesData.travel.readOnly||(theTravelNotesData.map.getZoom()<(t.minZoom||MapEditorViewer.#wp)&&theTravelNotesData.map.setZoom(t.minZoom||MapEditorViewer.#wp),theTravelNotesData.map.setMinZoom(t.minZoom||MapEditorViewer.#wp),theTravelNotesData.map.getZoom()>(t.maxZoom||MapEditorViewer.#Mp)&&theTravelNotesData.map.setZoom(t.maxZoom||MapEditorViewer.#Mp),theTravelNotesData.map.setMaxZoom(t.maxZoom||MapEditorViewer.#Mp),t.bounds?(theTravelNotesData.map.getBounds().intersects(t.bounds)&&!theTravelNotesData.map.getBounds().contains(t.bounds)||(theTravelNotesData.map.setMaxBounds(null),theTravelNotesData.map.fitBounds(t.bounds),theTravelNotesData.map.setZoom(t.minZoom||MapEditorViewer.#wp)),theTravelNotesData.map.setMaxBounds(t.bounds)):theTravelNotesData.map.setMaxBounds(null)),theTravelNotesData.map.fire("baselayerchange",o)}onGeolocationStatusChanged(t){GEOLOCATION_STATUS.active!==t&&this.#_p&&(theTravelNotesData.map.removeLayer(this.#_p),this.#_p=null)}#Cp(t){const e=theTranslator.getText("MapEditorViewer -Copied to clipboard"),o=t.target.getTooltip().getContent();-1===o.indexOf(e)&&navigator.clipboard.writeText(o.replaceAll("<br/>","\n")).then(()=>{t.target.getTooltip().setContent(o+"<br/><br/>"+theTranslator.getText("MapEditorViewer -Copied to clipboard"))}).catch(()=>console.error("Failed to copy to clipboard "))}onGeolocationPositionChanged(t){let e=theConfig.geoLocation.zoomToPosition;this.#_p&&(theTravelNotesData.map.removeLayer(this.#_p),e=!1);let o="Position (+/- "+t.coords.accuracy.toFixed(0)+" m) : <br/>"+theUtilities.formatLatLngDMS([t.coords.latitude,t.coords.longitude])+"<br/>"+theUtilities.formatLatLng([t.coords.latitude,t.coords.longitude])+"<br/>";t.coords.altitude&&(o+="<br/> Altitude  :<br/>"+t.coords.altitude.toFixed(0)+" m",t.coords.altitudeAccuracy&&(o+="(+/- "+t.coords.altitudeAccuracy.toFixed(0)+" m)")),0===theConfig.geoLocation.marker.radius?(this.#_p=new Circle(new LatLng$1(t.coords.latitude,t.coords.longitude),theConfig.geoLocation.marker),this.#_p.setRadius(t.coords.accuracy.toFixed(0))):this.#_p=new CircleMarker(new LatLng$1(t.coords.latitude,t.coords.longitude),theConfig.geoLocation.marker),this.#_p.bindTooltip(o).addTo(theTravelNotesData.map),theConfig.geoLocation.watch||this.#_p.bindPopup(o).openPopup(),this.#_p.on("click",t=>{this.#Cp(t)}),e&&theTravelNotesData.map.setView(new LatLng$1(t.coords.latitude,t.coords.longitude),theConfig.geoLocation.zoomFactor)}}class NoteBulletDragEndEL{static handleEvent(t){const e=theDataSearchEngine.getNoteAndRoute(t.target.objId),o=e.note,i=e.route,n=theTravelNotesData.mapObjects.get(t.target.objId);if(null===i)o.latLng=[t.target.getLatLng().lat,t.target.getLatLng().lng],theEventDispatcher.dispatch("updatetravelnotes");else{const e=theGeometry.getClosestLatLngDistance(i,[t.target.getLatLng().lat,t.target.getLatLng().lng]);o.latLng=e.latLng,o.distance=e.distance,i.notes.sort((t,e)=>t.distance-e.distance),n.getLayer(n.bulletId).setLatLng(e.latLng)}n.getLayer(n.polylineId).setLatLngs([o.latLng,o.iconLatLng]),theEventDispatcher.dispatch("updateroadbook")}}class NoteBulletDragEL{static handleEvent(t){const e=theDataSearchEngine.getNoteAndRoute(t.target.objId).note,o=theTravelNotesData.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([[t.latlng.lat,t.latlng.lng],e.iconLatLng])}}class NoteBulletMouseEnterEL{static handleEvent(t){t.originalEvent.target.style.opacity=theConfig.note.grip.moveOpacity}}class NoteBulletMouseLeaveEL{static handleEvent(t){t.originalEvent.target.style.opacity=theConfig.note.grip.opacity}}class NoteMarkerContextMenuEL{static handleEvent(t){new NoteContextMenu(t).show()}}class NoteMarkerDragEndEL{static handleEvent(t){const e=theDataSearchEngine.getNoteAndRoute(t.target.objId).note;e.iconLatLng=[t.target.getLatLng().lat,t.target.getLatLng().lng];const o=theTravelNotesData.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,e.iconLatLng])}}class NoteMarkerDragEL{static handleEvent(t){const e=theDataSearchEngine.getNoteAndRoute(t.target.objId).note,o=theTravelNotesData.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,[t.latlng.lat,t.latlng.lng]])}}class WayPointContextMenu extends BaseContextMenu{constructor(t,e){super(t,e)}get menuItems(){return[new MenuItem(theTranslator.getText("WayPointContextMenu - Delete this waypoint"),theTravelNotesData.travel.editedRoute.wayPoints.first.objId!==this.targetObjId&&theTravelNotesData.travel.editedRoute.wayPoints.last.objId!==this.targetObjId,()=>theWayPointEditor.removeWayPoint(this.targetObjId)),new MenuItem(theTranslator.getText("WayPointContextMenu - Modify properties"),!0,()=>theWayPointEditor.wayPointProperties(this.targetObjId))]}}class WayPointContextMenuEL{static handleEvent(t){new WayPointContextMenu(t).show()}}class WayPointDragEndEL{static handleEvent(t){theWayPointEditor.wayPointDragEnd(t)}}class RouteMapContextMenuEL{static handleEvent(t){DomEvent.stopPropagation(t),new RouteContextMenu(t).show()}}class MapEditor extends MapEditorViewer{static get#Ip(){return.01}#Np(t){const e=theTravelNotesData.mapObjects.get(t);e&&(DomEvent.off(e),theTravelNotesData.map.removeLayer(e),theTravelNotesData.mapObjects.delete(t))}constructor(){super()}updateRoute(t,e){if(-1!==t){const e=theDataSearchEngine.getRoute(t);this.#Np(e.objId);const o=e.notes.iterator;for(;!o.done;)this.#Np(o.value.objId);const i=e.wayPoints.iterator;for(;!i.done;)this.#Np(i.value.objId)}if(-1!==e){const t=this.addRoute(e),o=theTravelNotesData.mapObjects.get(e);if(!theTravelNotesData.travel.readOnly){DomEvent.on(o,"contextmenu",RouteMapContextMenuEL.handleEvent),ROUTE_EDITION_STATUS.notEdited!==t.editionStatus&&"touch"!==theDevice.pointerType&&DomEvent.on(o,"mouseover",EditedRouteMouseOverEL.handleEvent);const e=t.notes.iterator;for(;!e.done;){const t=theTravelNotesData.mapObjects.get(e.value.objId),o=t.getLayer(t.markerId),i=t.getLayer(t.bulletId);DomEvent.on(i,"dragend",NoteBulletDragEndEL.handleEvent),DomEvent.on(i,"drag",NoteBulletDragEL.handleEvent),DomEvent.on(i,"mouseenter",NoteBulletMouseEnterEL.handleEvent),DomEvent.on(i,"mouseleave",NoteBulletMouseLeaveEL.handleEvent),DomEvent.on(o,"contextmenu",NoteMarkerContextMenuEL.handleEvent),DomEvent.on(o,"dragend",NoteMarkerDragEndEL.handleEvent),DomEvent.on(o,"drag",NoteMarkerDragEL.handleEvent)}}if(!theTravelNotesData.travel.readOnly&&ROUTE_EDITION_STATUS.notEdited!==t.editionStatus){const t=theTravelNotesData.travel.editedRoute.wayPoints.iterator;for(;!t.done;)this.addWayPoint(t.value,t.first?"A":t.last?"B":t.index)}}}updateRouteProperties(t){const e=theTravelNotesData.mapObjects.get(t),o=theDataSearchEngine.getRoute(t);e.setStyle({color:o.color,weight:o.width,dashArray:o.dashString})}updateNote(t,e){let o=!1;if(-1!==t){const e=theTravelNotesData.mapObjects.get(t);e&&(o=e.getLayer(e.markerId).isPopupOpen()),this.#Np(t)}if(-1!==e){const t=this.addNote(e);o&&t.marker.openPopup(),theTravelNotesData.travel.readOnly||(DomEvent.on(t.bullet,"dragend",NoteBulletDragEndEL.handleEvent),DomEvent.on(t.bullet,"drag",NoteBulletDragEL.handleEvent),DomEvent.on(t.bullet,"mouseenter",NoteBulletMouseEnterEL.handleEvent),DomEvent.on(t.bullet,"mouseleave",NoteBulletMouseLeaveEL.handleEvent),DomEvent.on(t.marker,"contextmenu",NoteMarkerContextMenuEL.handleEvent),DomEvent.on(t.marker,"dragend",NoteMarkerDragEndEL.handleEvent),DomEvent.on(t.marker,"drag",NoteMarkerDragEL.handleEvent))}}removeObject(t){this.#Np(t)}removeAllObjects(){theTravelNotesData.mapObjects.forEach(t=>{DomEvent.off(t),theTravelNotesData.map.removeLayer(t)}),theTravelNotesData.mapObjects.clear()}addWayPoint(t,e){if(LAT_LNG.defaultValue===t.lat&&LAT_LNG.defaultValue===t.lng)return;const o='<div class="travelnotes-map-way-point travelnotes-map-way-point-'+("A"===e?"start":"B"===e?"end":"via")+'"></div><div class="travelnotes-map-way-point-text">'+e+"</div>",i=new Marker(t.latLng,{icon:new DivIcon({iconSize:[20,20],iconAnchor:[10,20],html:o,className:"travelnotes-map-way-point-style"}),draggable:!0});i.bindTooltip(t=>theDataSearchEngine.getWayPoint(t.objId).fullName),i.getTooltip().options.offset=[10,-10],DomEvent.on(i,"contextmenu",WayPointContextMenuEL.handleEvent),i.objId=t.objId,this.addToMap(t.objId,i),DomEvent.on(i,"dragend",WayPointDragEndEL.handleEvent)}addItineraryPointMarker(t,e){this.addToMap(t,new CircleMarker(e,theConfig.itineraryPoint.marker))}addSearchPointMarker(t,e,o){let i=!1;if(o){let t=[];o.forEach(e=>{t=t.concat(e)});const e=theGeometry.getLatLngBounds(t),n=theTravelNotesData.map.getBounds();i=(e.getEast()-e.getWest())/(n.getEast()-n.getWest())>MapEditor.#Ip&&(e.getNorth()-e.getSouth())/(n.getNorth()-n.getSouth())>MapEditor.#Ip}i?this.addToMap(t,new Polyline(o,theConfig.osmSearch.searchPointPolyline)):this.addToMap(t,new CircleMarker(e,theConfig.osmSearch.searchPointMarker))}addRectangle(t,e,o){this.addToMap(t,new Rectangle(e,o))}setLayer(t){const e=theApiKeysManager.getUrl(t);e&&super.setLayer(t,e)}}const theMapEditor=new MapEditor;class IndexedDb{#xp;#At;#Pp;static get#Sp(){return 1}#Op(t,e){if(this.#xp)return void t();const o=window.indexedDB.open("TravelNotesDb",IndexedDb.#Sp);o.onerror=()=>{this.#xp=null,e(new Error("Not possible to open the db"))},o.onsuccess=e=>{this.#xp=e.target.result,t()},o.onupgradeneeded=t=>{this.#xp=t.target.result,this.#xp.createObjectStore("Travels",{keyPath:"UUID"})}}#Ap(t,e){if(!this.#xp)return void e(new Error("Database not opened"));const o=this.#xp.transaction(["Travels"],"readonly");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").get(this.#At).onsuccess=e=>t(e.target.result?e.target.result.data:null)}#Rp(t,e){if(!this.#xp)return void e(new Error("Database not opened"));const o=this.#xp.transaction(["Travels"],"readwrite");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").put({UUID:this.#At,data:this.#Pp}).onsuccess=()=>t()}#kp(){this.#xp.close(),this.#xp=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise((t,e)=>this.#Op(t,e))}getReadPromise(t){return this.#At=t,new Promise((t,e)=>this.#Ap(t,e))}getWritePromise(t,e){return this.#At=t,this.#Pp=e,new Promise((t,e)=>this.#Rp(t,e))}closeDb(t){if(!this.#xp)return;if(!t)return void this.#kp();const e=this.#xp.transaction(["Travels"],"readwrite");e.onerror=()=>{};const o=e.objectStore("Travels").delete(t);o.onerror=()=>this.#kp(),o.onsuccess=()=>this.#kp()}}const theIndexedDb=new IndexedDb;class TravelHTMLViewsFactory{#Bp(t){const e=theHTMLElementsFactory.create("div",{className:t+"travel-header"});theHTMLSanitizer.sanitizeToHtmlElement(theTravelNotesData.travel.name,theHTMLElementsFactory.create("div",{className:t+"travel-header-name"},e));let o=DISTANCE.defaultValue,i=0,n=0;const r=theTravelNotesData.travel.routes.iterator;for(;!r.done;){const a=r.value.objId===theTravelNotesData.editedRouteObjId&&theConfig.routeEditor.showEditedRouteInRoadbook?theTravelNotesData.travel.editedRoute:r.value;theHTMLSanitizer.sanitizeToHtmlElement('<a href="#route'+a.objId+'" >'+a.computedName+"</a>Â :Â "+theUtilities.formatDistance(a.distance)+".",theHTMLElementsFactory.create("div",{className:t+"travel-header-route-name"},e)),a.chain&&(o+=a.distance,i+=a.itinerary.ascent,n+=a.itinerary.descent)}return theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("TravelHTMLViewsFactory - Travel distance")+"</span>Â :Â "+theUtilities.formatDistance(o),theHTMLElementsFactory.create("div",{className:t+"travel-header-travel-distance"},e)),0!==i&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("travelHTMLViewsFactory - Travel ascent")+"</span>Â :Â "+String(i.toFixed(0))+" m.",theHTMLElementsFactory.create("div",{className:t+"travel-header-travel-ascent"},e)),0!==n&&theHTMLSanitizer.sanitizeToHtmlElement("<span>"+theTranslator.getText("TravelHTMLViewsFactory - Travel descent")+"</span>Â :Â "+String(n.toFixed(0))+" m.",theHTMLElementsFactory.create("div",{className:t+"travel-header-travel-descent"},e)),e}#jp(t){const e=theTranslator.getText("TravelHTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/TravelNotes" >Travel & Notes</a>, Â© <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 '+new Date(Date.now()).getFullYear()+'</a> Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+theTranslator.getText("TravelHTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=theHTMLElementsFactory.create("div",{className:t+"travel-footer"});return theHTMLSanitizer.sanitizeToHtmlElement(e,o),o}constructor(){Object.freeze(this)}getTravelHTML(t){const e=theHTMLElementsFactory.create("div",{className:t+"travel"});e.appendChild(this.#Bp(t)),e.appendChild(theNoteHTMLViewsFactory.getTravelNotesHTML(t));const o=theTravelNotesData.travel.routes.iterator;for(;!o.done;){const i=theConfig.routeEditor.showEditedRouteInRoadbook&&o.value.objId===theTravelNotesData.editedRouteObjId?theTravelNotesData.travel.editedRoute:o.value;e.appendChild(theRouteHTMLViewsFactory.getRouteHeaderHTML(t,i)),i.itinerary.hasProfile&&e.appendChild(theRouteHTMLViewsFactory.getRouteProfileHTML(t,i)),e.appendChild(theRouteHTMLViewsFactory.getRouteManeuversAndNotesHTML(t,i,!1)),e.appendChild(theRouteHTMLViewsFactory.getRouteFooterHTML(t,i))}return e.appendChild(this.#jp(t)),e}}const theTravelHTMLViewsFactory=new TravelHTMLViewsFactory;class RoadbookUpdateEL{#Hp;constructor(){Object.freeze(this),this.#Hp=theUtilities.storageAvailable("localStorage")}handleEvent(){theMouseUI.saveStatus=SAVE_STATUS.modified,this.#Hp&&theIndexedDb.getOpenPromise().then(()=>{theIndexedDb.getWritePromise(theTravelNotesData.UUID,theTravelHTMLViewsFactory.getTravelHTML("travelnotes-roadbook-").outerHTML)}).then(()=>localStorage.setItem(theTravelNotesData.UUID,Date.now())).catch(t=>{t instanceof Error&&console.error(t)})}}class ResizeEL{#Fp=null;#zp(){theProvidersToolbar.centerToolbar(),this.#Fp=null}constructor(){Object.freeze(this)}handleEvent(){this.#Fp&&(clearTimeout(this.#Fp),this.#Fp=null),this.#Fp=setTimeout(()=>this.#zp(),theConfig.travelNotes.resizeDelay)}}class EventListenersLoader{static addEventsListeners(){document.addEventListener("additinerarypointmarker",t=>{t.data&&theMapEditor.addItineraryPointMarker(t.data.objId,t.data.latLng)}),document.addEventListener("addrectangle",t=>{t.data&&theMapEditor.addRectangle(t.data.objId,t.data.bounds,t.data.properties)}),document.addEventListener("addsearchpointmarker",t=>{t.data&&theMapEditor.addSearchPointMarker(t.data.objId,t.data.latLng,t.data.geometry)}),document.addEventListener("addwaypoint",t=>{t.data&&theMapEditor.addWayPoint(t.data.wayPoint,t.data.letter)}),document.addEventListener("geolocationpositionchanged",t=>{t.data&&theMapEditor.onGeolocationPositionChanged(t.data.position)}),document.addEventListener("geolocationstatuschanged",t=>{t.data&&theMapEditor.onGeolocationStatusChanged(t.data.status)}),document.addEventListener("layerchange",t=>{t.data&&theMapEditor.setLayer(t.data.layer)}),document.addEventListener("noteupdated",t=>{t.data&&theMapEditor.updateNote(t.data.removedNoteObjId,t.data.addedNoteObjId)}),document.addEventListener("profileclosed",t=>{t.data&&theProfileDialogsManager.onProfileClosed(t.data.objId)}),document.addEventListener("providersadded",()=>theProvidersToolbar.providersAdded()),document.addEventListener("removeallobjects",()=>theMapEditor.removeAllObjects()),document.addEventListener("removeobject",t=>{t.data&&theMapEditor.removeObject(t.data.objId)}),document.addEventListener("routepropertiesupdated",t=>{t.data&&theMapEditor.updateRouteProperties(t.data.routeObjId)}),document.addEventListener("routeupdated",t=>{t.data&&theMapEditor.updateRoute(t.data.removedRouteObjId,t.data.addedRouteObjId)}),document.addEventListener("setprovider",t=>{t?.data?.provider&&(theProvidersToolbar.provider=t.data.provider)}),document.addEventListener("settransitmode",t=>{t?.data?.transitMode&&(theProvidersToolbar.transitMode=t.data.transitMode)}),document.addEventListener("showtravelproperties",()=>theDockableDialogsManager.showTravelProperties()),document.addEventListener("updateosmsearch",()=>theDockableDialogsManager.osmSearchDialog.updateContent()),document.addEventListener("updateprofilename",t=>{t.data&&theProfileDialogsManager.updateProfileName(t.data.routeObjId)}),document.addEventListener("updateroadbook",new RoadbookUpdateEL),document.addEventListener("updatetravelnotes",()=>theDockableDialogsManager.travelNotesDialog.updateContent()),document.addEventListener("updatetravelproperties",()=>theDockableDialogsManager.travelPropertiesDialog.updateContent()),document.addEventListener("zoomto",t=>{t.data&&theMapEditor.zoomTo(t.data.latLng,t.data.geometry)}),window.visualViewport.addEventListener("resize",new ResizeEL)}static addUnloadEventsListeners(){window.addEventListener("unload",()=>localStorage.removeItem(theTravelNotesData.UUID)),window.addEventListener("beforeunload",t=>{if(theIndexedDb.closeDb(theTravelNotesData.UUID),theConfig.travelNotes.haveBeforeUnloadWarning)return t.returnValue="x","x"})}}class AppLoader{#Up;#Wp;#Kp;#Vp;#Gp;#Zp;#Xp(){const t=new URL(window.location);let e=t.searchParams.get("fil");if(e&&0!==e.length)try{if(e=atob(e),e.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");const o=new URL(e,t.protocol+"//"+t.hostname+(""===t.port?"":":"+t.port));if(!(Url=t.protocol&&o.protocol&&t.protocol===o.protocol&&t.hostname&&o.hostname&&t.hostname===o.hostname))throw new Error("The distant file is not on the same site than the app");this.#Up=encodeURI(o.href)}catch(t){t instanceof Error&&console.error(t)}const o=t.searchParams.get("lng");o&&o.match(/^[A-Z,a-z]{2}$/)&&(this.#Vp=o.toLowerCase());const i=t.searchParams.get("lat");i&&(this.#Wp=Number.parseFloat(i),Number.isNaN(this.#Wp)&&(this.#Wp=null));const n=t.searchParams.get("lon");n&&(this.#Kp=Number.parseFloat(n),Number.isNaN(this.#Kp)&&(this.#Kp=null))}async#Yp(){const t=await fetch(this.#Gp+"Config.json");if(200===t.status&&t.ok){const e=await t.json();return e.travelNotes.language=this.#Vp||e.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(e.ApiKeysDialog.haveUnsecureButtons=!0,e.errorsUI.showHelp=!0,e.mapLayersToolbar.theDevil.addButton=!1,e.note.maxManeuversNotes=12,e.note.haveBackground=!0,e.noteDialog.theDevil.addButton=!1,e.printRouteMap.maxTiles=10,e.route.showDragTooltip=-1),(new ConfigOverloader).overload(e),!0}return!1}async#qp(t,e){return"fulfilled"===t.status&&200===t.value.status&&t.value.ok?(theTranslator.setTranslations(await t.value.json()),!0):"fulfilled"===e.status&&200===e.value.status&&e.value.ok?(theTranslator.setTranslations(await e.value.json()),this.#Zp+="Not possible to load the TravelNotes"+this.#Vp.toUpperCase()+".json file. English will be used. ",!0):(this.#Zp+="Not possible to load the translations. ",!1)}async#Jp(t,e){if("fulfilled"===t.status&&200===t.value.status&&t.value.ok){const e=await t.value.json();return theNoteDialogToolbarData.loadJson(e),!0}if("fulfilled"===e.status&&200===e.value.status&&e.value.ok){const t=await e.value.json();return theNoteDialogToolbarData.loadJson(t),this.#Zp+="Not possible to load the TravelNotesNoteDialog"+this.#Vp.toUpperCase()+".json file. English will be used. ",!0}return this.#Zp+="Not possible to load the translations for the note dialog. ",!1}async#$p(t,e){return"fulfilled"===t.status&&200===t.value.status&&t.value.ok?(theOsmSearchDictionary.parseDictionary(await t.value.text()),!0):"fulfilled"===e.status&&200===e.value.status&&e.value.ok?(theOsmSearchDictionary.parseDictionary(await e.value.text()),this.#Zp+="Not possible to load the TravelNotesSearchDictionary"+this.#Vp.toUpperCase()+".csv file. English will be used. ",!0):(this.#Zp+="Not possible to load the search dictionary. OSM search will not be available.",!0)}async#Qp(t){return"fulfilled"===t.status&&200===t.value.status&&t.value.ok?(theMapLayersCollection.addMapLayers(await t.value.json()),!0):(this.#Zp+="Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",!0)}async#tm(){const t=await Promise.allSettled([fetch(this.#Gp+this.#Vp.toUpperCase()+".json"),fetch(this.#Gp+"EN.json"),fetch(this.#Gp+"NoteDialog"+this.#Vp.toUpperCase()+".json"),fetch(this.#Gp+"NoteDialogEN.json"),fetch(this.#Gp+"SearchDictionary"+this.#Vp.toUpperCase()+".csv"),fetch(this.#Gp+"SearchDictionaryEN.csv"),fetch(this.#Gp+"Layers.json")]),e=await this.#qp(t[0],t[1])&&await this.#Jp(t[2],t[3])&&await this.#$p(t[4],t[5])&&await this.#Qp(t[6]);return""!==this.#Zp&&e?theErrorsUI$1.showError(this.#Zp):""!==this.#Zp&&(document.body.textContent=this.#Zp),e}#em(){EventListenersLoader.addEventsListeners(),document.body.style["font-size"]=String(theConfig.fontSize.initialValue)+"mm";const t=document.createElement("div");t.id="travelnotes-map",document.body.appendChild(t),theTravelNotesData.map=new Map$1(t.id,{attributionControl:!1,zoomControl:!1}).setView([LAT_LNG.defaultValue,LAT_LNG.defaultValue],0),this.#Up?theTravelNotes.addReadOnlyTravel(this.#Up):(EventListenersLoader.addUnloadEventsListeners(),theTravelNotes.addToolbarsMenusUIs(this.#Wp,this.#Kp))}constructor(){Object.freeze(this),this.#Gp=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes",this.#Zp=""}async loadApp(){this.#Xp(),await this.#Yp()?(this.#Vp=this.#Vp||theConfig.travelNotes.language||"fr",theErrorsUI$1.createUI(),await this.#tm()&&this.#em()):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}}(new AppLoader).loadApp();export{thePluginsManager};
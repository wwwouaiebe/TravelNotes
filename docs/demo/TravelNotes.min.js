/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 4.4.0-dev
 * Build 00014 - 2025-09-17T07:57:02+0200 
 * Copyright 2017 2025 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";const t={ApiKeys:{saveToSessionStorage:!0},ApiKeysDialog:{haveUnsecureButtons:!0,showApiKeys:!1,showButton:!0},baseDialog:{cancelTouchX:100,cancelTouchY:150,deltaZoomDistance:75,touchTopScreen:!0},contextMenu:{timeout:1500},dockableBaseDialog:{timeout:1500,hideOnMouseLeave:!1},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!1,showInfo:!0,showWarning:!0,timeOut:1e4},files:{openGpx:["gpx"],openTaN:["json","trv"],writeTouch:"trv",writeOthers:"trv"},fontSize:{initialValue:3.5,incrementValue:.5},FullScreenUI:{timeOut:5e3,screenMaxWidth:1200},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:0},options:{enableHighAccuracy:!0,maximumAge:0,timeout:36e5},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},mapContextMenu:{mouseMaxRouteDistance:10,touchMaxRouteDistance:10},mapLayersToolbar:{theDevil:{addButton:!0}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:6,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},theDevil:{addButton:!0,zoomFactor:17}},osmSearchDialog:{dialogX:50,dialogY:0},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"——————",iDashArray:[0]},{text:"— — — — —",iDashArray:[4,2]},{text:"—‧—‧—‧—‧—",iDashArray:[4,2,0,2]},{text:"················",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:0,width:5},routeEditor:{showEditedRouteInRoadbook:!0},toolbars:{timeOut:1500},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr",startupRouteEdition:!0,resizeDelay:200},travelNotesToolbar:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},travelNotesDialog:{dialogX:250,dialogY:0},travelPropertiesDialog:{dialogX:50,dialogY:0},wayPoint:{reverseGeocoding:!0,geocodingIncludeName:!0}};class e{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class o{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class i{static get fixed(){return 2}static get defaultValue(){return 0}}class s{static get refusedByUser(){return-1}static get disabled(){return 0}static get inactive(){return 1}static get active(){return 2}}class n{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class r{static get atStart(){return-1}static get onRoute(){return 0}static get atEnd(){return 1}}class a{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class l{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}class h{static get notSaved(){return"🔴"}static get modified(){return"🟡"}static get saved(){return"🟢"}}class d{static get topLeft(){return"TravelNotes-BaseToolbar-TopLeft"}static get topRight(){return"TravelNotes-BaseToolbar-TopRight"}static get bottomLeft(){return"TravelNotes-BaseToolbar-BottomLeft"}static get bottomRight(){return"TravelNotes-BaseToolbar-BottomRight"}}const c=40,u=6371e3,m=16,p=200,g=-1,v=[.3,10,1],f=-1,y="http://www.w3.org/2000/svg",_=20;class T{static#t=0;static get nextObjId(){return++T.#t}}const b="2.4.0",L="v4.4.0-dev";class E{#e="";#o=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];#i=[];constructor(t,e){if(Object.freeze(this),f===this.#o.indexOf(t))throw new Error("Invalid ObjType name : "+t);this.#e=t,this.#i=e,Object.freeze(this.#i)}get name(){return this.#e}get version(){return b}get properties(){return this.#i}get jsonObject(){return{name:this.#e,version:b}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this.#e);if(this.#e!==t.name)throw new Error("Invalid name for "+this.#e);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this.#e)}}class w{#s=null;#n=f;constructor(t){Object.freeze(this),this.#s=t}get value(){return this.#n<this.#s.length?this.#s.at(this.#n):null}get previous(){return 0>=this.#n?null:this.#s.at(this.#n-1)}get next(){return this.#n<this.#s.length-1?this.#s.at(this.#n+1):null}get done(){return++this.#n>=this.#s.length}get first(){return 0===this.#n}get last(){return this.#n>=this.#s.length-1}get index(){return this.#n}}class M{#r;#a;#l;#h(t){return this.#r.findIndex(e=>e.objId===t)}#d(t,e,o){let i=this.#h(t);if(f===i)throw new Error("invalid objId for next or previous function");if(1!==o&&-1!==o)throw new Error("invalid direction");let s=e;for(s||(s=()=>!0),i+=o;f<i&&i<this.#r.length&&!s(this.#r[i]);)i+=o;return f===i||this.#r.length===i?null:this.#r[i]}constructor(t){Object.freeze(this),this.#r=[],this.#l=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this.#a=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this.#a)throw new Error("invalid object name for add function");this.#r.push(t)}at(t){return t<this.#r.length&&t>f?this.#r[t]:null}forEach(t){let e=null;const o=this.iterator;for(;!o.done;)e=t(o.value,e);return e}getAt(t){const e=this.#h(t);return f===e?null:this.#r[e]}moveTo(t,e,o){let i=this.#h(t),s=this.#h(e);if(f===i||f===s)throw new Error("invalid objId for function  myMoveTo");o||s++,this.#r.splice(s,0,this.#r[i]),s<i&&i++,this.#r.splice(i,1)}next(t,e){return this.#d(t,e,1)}previous(t,e){return this.#d(t,e,-1)}remove(t){const e=this.#h(t);if(f===e)throw new Error("invalid objId for remove function");this.#r.splice(e,1)}removeAll(t){t?this.#r.splice(1,this.#r.length-2):this.#r.length=0}replace(t,e){const o=this.#h(t);if(f===o)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this.#a)throw new Error("invalid object name for replace function");this.#r[o]=e}reverse(){this.#r.reverse()}sort(t){this.#r.sort(t)}swap(t,e){const o=this.#h(t);if(f===o||0===o&&e||this.#r.length-1===o&&!e)throw new Error("invalid objId for swap function");const i=e?-1:1,s=this.#r[o];this.#r[o]=this.#r[o+i],this.#r[o+i]=s}get first(){return this.#r[0]}get iterator(){return new w(this)}get last(){return this.#r[this.#r.length-1]}get length(){return this.#r.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this.#r.length=0,Array.isArray(t)&&t.forEach(t=>{const e=new this.#l;e.jsonObject=t,this.add(e)})}}class x{#c=new Map;constructor(){Object.freeze(this),this.#c.set("a",["href","target"]),this.#c.set("div",[]),this.#c.set("del",[]),this.#c.set("em",[]),this.#c.set("figcaption",[]),this.#c.set("figure",[]),this.#c.set("h1",[]),this.#c.set("h2",[]),this.#c.set("h3",[]),this.#c.set("h4",[]),this.#c.set("h5",[]),this.#c.set("h6",[]),this.#c.set("hr",[]),this.#c.set("img",["src","alt","width","height"]),this.#c.set("ins",[]),this.#c.set("li",[]),this.#c.set("mark",[]),this.#c.set("ol",[]),this.#c.set("p",[]),this.#c.set("s",[]),this.#c.set("small",[]),this.#c.set("strong",[]),this.#c.set("span",[]),this.#c.set("sub",[]),this.#c.set("sup",[]),this.#c.set("ul",[]),this.#c.set("svg",["xmlns","viewBox","class"]),this.#c.set("text",["x","y","text-anchor"]),this.#c.set("polyline",["points","class","transform"]),this.#c.set("#text",[])}getValidAttributesNames(t){return this.#c.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#c.get(e)?e:""}}class I{#u;#m;constructor(t,e){Object.freeze(this),this.#u=t,this.#m=e}get htmlString(){return this.#u}get errorsString(){return this.#m}}class C{#p;#m;constructor(t,e){Object.freeze(this),this.#p=t,this.#m=e}get url(){return this.#p}get errorsString(){return this.#m}}class N{#g="";#v="";static#f=new x;#y(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#_(t,e){const o=this.sanitizeToUrl(t,e).url;""===o&&""!==t?this.#v+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#g+=" "+e+'="'+o+'"'}#T(t,e){N.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(this.#g+=" "+e+'="'+this.#y(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))})}#b(t,e){t.hasAttribute("target")&&(this.#g+=' rel="noopener noreferrer"'),N.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#_(t.getAttribute(e),e):this.#g+=" "+e+'="'+this.#y(t.getAttribute(e))+'"',t.removeAttribute(e))})}#L(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#v+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#E(t){const e=t.childNodes;for(let o=0;o<e.length;o++){const e=t.childNodes[o],i=N.#f.getValidNodeName(e.nodeName);""===i?this.#v+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===i?this.#g+=this.#y(e.nodeValue):(this.#g+="<"+i,"svg"===i||"text"===i||"polyline"===i?this.#T(e,i):this.#b(e,i),this.#g+=">",this.#E(e),this.#g+="</"+i+">",e.attributes&&this.#L(e))}}#w(t,e){const o=document.createElementNS(y,e);return N.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(o.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))}),o}#M(t,e){const o=document.createElement(e);return N.#f.getValidAttributesNames(e).forEach(e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const i=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==i&&o.setAttribute(e,i)}else o.setAttribute(e,t.getAttribute(e))}),t.hasAttribute("target")&&o.setAttribute("rel","noopener noreferrer"),o}#x(t,e){const o=t.childNodes;for(let i=0;i<o.length;i++){const o=t.childNodes[i],s=N.#f.getValidNodeName(o.nodeName);if("#text"===s)e.appendChild(document.createTextNode(o.nodeValue));else if(""!==s){const t="svg"===s||"text"===s||"polyline"===s?this.#w(o,s):this.#M(o,s);e.appendChild(t),this.#x(o,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const o=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),i=new DocumentFragment;o&&"#document"===o.nodeName?(this.#x(o.body.firstChild,i),e.appendChild(i)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#x(t,e),e}sanitizeToHtmlString(t){this.#g="",this.#v="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","਀")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#E(e.body.firstChild),new I(this.#g,this.#v)):new I("","Parsing error")}sanitizeToUrl(t,e){const o=e||"href",i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!i||"#document"!==i.nodeName)return new C("","Parsing error");const s=i.body.firstChild;let n="";for(let t=0;t<s.childNodes.length;t++){if("#text"!==s.childNodes[t].nodeName)return new C("","Invalid characters found in the url");n+=s.childNodes[t].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==t)return new C("","Invalid characters found in the url");const r=["https:"];if("http:"!==window.location.protocol&&"href"!==o||r.push("http:"),"href"===o){r.push("mailto:"),r.push("sms:"),r.push("tel:");const t=n.match(/^\u0023\w*/);if(t&&n===t[0])return new C(n,"")}"src"===o&&r.push("data:");let a=null;try{a=new URL(n)}catch{return new C("","Invalid url string")}if(f===r.indexOf(a.protocol))return new C("","Invalid protocol "+a.protocol);if(f!==["sms:","tel:"].indexOf(a.protocol))return a.pathname.match(/^\+[0-9,*,\u0023]*$/)?new C(n,""):new C("","Invalid sms: or tel: url");try{encodeURIComponent(a.href)}catch{return new C("","Invalid character in url")}return new C(n,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const o=e.body.firstChild;let i="";for(let t=0;t<o.childNodes.length;t++){if("#text"!==o.childNodes[t].nodeName)return"";i+=o.childNodes[t].nodeValue}return i=i.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),i}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const P=new N;const O=new class{#I=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach(t=>this.#I.set(t.msgid,P.sanitizeToJsString(t.msgstr)))}getText(t,e){let o=this.#I.get(t);return e&&o&&Object.getOwnPropertyNames(e).forEach(t=>o=o.replace("{"+t+"}",e[t])),o||t}};const D=new class{constructor(){Object.freeze(this)}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let o="";for(let i=0;i<16;i++)o+=e[i].toString(m).padStart(2,"0")+t[i];return o}storageAvailable(t){try{const e=window[t],o="__storage_test__";return e.setItem(o,o),e.removeItem(o),!0}catch{return!1}}openFile(t,e){const o=document.createElement("input");o.type="file",e&&(o.accept=e),o.addEventListener("change",t,!1),o.click()}saveFile(t,e,o){try{const i=o?window.URL.createObjectURL(new File([e],t,{type:o})):URL.createObjectURL(e),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",t),s.click(),window.URL.revokeObjectURL(i)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const o=Math.floor(e/86400),i=Math.floor(e%86400/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return 0<o?o+" "+O.getText("Utilities - Day")+" "+i+" "+O.getText("Utilities - Hour"):0<i?i+" "+O.getText("Utilities - Hour")+" "+s+" "+O.getText("Utilities - Minute"):0<s?s+" "+O.getText("Utilities - Minute"):n+" "+O.getText("Utilities - Second")}formatDistance(t){const e=Math.floor(t);return 0>=e?"0 km":Math.floor(e/o.metersInKm)+","+Math.floor(e%o.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+" km"}numberToDMS(t){let e=t,o=Math.floor(t);e-=o;let i=Math.floor(60*e);e-=i/60,e*=3600;let s=Math.floor(e);return e-=s,e=Math.floor(100*e),o.toString()+"° "+i.toString()+"' "+s+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+" N":this.numberToDMS(-t)+" S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+" E":this.numberToDMS(-t)+" W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+" - "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(a.fixed)+" N":(-t).toFixed(a.fixed)+" S"}formatLng(t){return t>0?t.toFixed(a.fixed)+" E":(-t).toFixed(a.fixed)+" W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+" - "+this.formatLng(t[1])}};class S{#C;#N(){this.#C.routes.forEach(t=>{t.dashArray=0,t.hidden=!1})}#P(){this.#C.routes.forEach(t=>{t.edited=l.notEdited})}#O(){this.#P(),this.#C.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"#ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:l.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}#D(){if(this.#C.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"Lantmäteriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===this.#C.userData.layerId);this.#C.layerName=t?t.layerName:"OSM - Color"}else this.#C.layerName="OSM - Color"}#S(t){t.forEach(t=>{t.elev=i.defaultValue})}#j(){this.#C.routes.forEach(t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this.#S(t.itinerary.itineraryPoints)}),this.#C.editedRoute.itinerary.hasProfile=!1,this.#C.editedRoute.itinerary.ascent=0,this.#C.editedRoute.itinerary.descent=0,this.#S(this.#C.editedRoute.itinerary.itineraryPoints)}#A(t){t.itinerary.maneuvers.forEach(t=>{"kArriveDefault"===t.iconName&&(t.distance=o.defaultValue)})}#R(t){t.wayPoints.forEach(t=>{t.address=t.name,t.name=""})}#H(){this.#C.routes.forEach(t=>{t.editionStatus=t.edited,this.#A(t),this.#R(t)}),this.#C.editedRoute.editionStatus=this.#C.editedRoute.edited,this.#A(this.#C.editedRoute),this.#R(this.#C.editedRoute)}#k(){this.#C.routes.forEach(t=>{t.dashIndex=t.dashArray}),this.#C.editedRoute.dashIndex=this.#C.editedRoute.dashArray}#B(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}#z(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this.#B(t.iconContent),t.popupContent=this.#B(t.popupContent),t.tooltipContent=this.#B(t.tooltipContent),t.phone=this.#B(t.phone),t.address=this.#B(t.address)}#F(){this.#C.notes.forEach(t=>{this.#z(t)}),this.jsonTravel.routes.forEach(t=>{t.notes.forEach(t=>{this.#z(t)})})}#Z(){switch(this.#C.objType.version){case"1.0.0":this.#N();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this.#O();case"1.5.0":this.#D();case"1.6.0":this.#j();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this.#H();case"1.12.0":case"1.13.0":this.#F();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this.#k(),this.#C.objType.version="2.4.0";break;default:throw new Error("invalid version for travel")}}constructor(){Object.freeze(this)}update(t){t.objType.version!==b&&(this.#C=t,this.#Z())}}class j{constructor(){Object.freeze(this)}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new S).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach(t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)}),t}}class A extends j{static#K=new E("WayPoint",["address","name","lat","lng","objId"]);#U="";#W="";#V=a.defaultValue;#X=a.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get name(){return this.#U}set name(t){this.#U="string"==typeof t?P.sanitizeToJsString(t):""}get address(){return this.#W}set address(t){this.#W="string"==typeof t?P.sanitizeToJsString(t):""}get lat(){return this.#V}set lat(t){this.#V="number"==typeof t?t:a.defaultValue}get lng(){return this.#X}set lng(t){this.#X="number"==typeof t?t:a.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=D.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#V=t[0],this.#X=t[1]):(this.#V=a.defaultValue,this.#X=a.defaultValue)}get objId(){return this.#t}get objType(){return A.#K}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.#t=T.nextObjId}}class R extends j{static#K=new E("ItineraryPoint",["lat","lng","distance","elev","objId"]);#V=a.defaultValue;#X=a.defaultValue;#Y=o.defaultValue;#G=i.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get lat(){return this.#V}set lat(t){this.#V="number"==typeof t?t:a.defaultValue}get lng(){return this.#X}set lng(t){this.#X="number"==typeof t?t:a.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.defaultValue}get elev(){return this.#G}set elev(t){this.#G="number"==typeof t?t:a.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#V=t[0],this.#X=t[1]):(this.#V=a.defaultValue,this.#X=a.defaultValue)}get objType(){return R.#K}get objId(){return this.#t}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),elev:parseFloat(this.elev.toFixed(i.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this.#t=T.nextObjId}}class H extends j{static#K=new E("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);#q="";#$="";#J=g;#Y=o.defaultValue;#Q=o.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get iconName(){return this.#q}set iconName(t){this.#q="string"==typeof t?P.sanitizeToJsString(t):""}get instruction(){return this.#$}set instruction(t){this.#$="string"==typeof t?P.sanitizeToJsString(t):""}get itineraryPointObjId(){return this.#J}set itineraryPointObjId(t){this.#J="number"==typeof t?t:g}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.defaultValue}get duration(){return this.#Q}set duration(t){this.#Q="number"==typeof t?t:o.defaultValue}get objType(){return H.#K}get objId(){return this.#t}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this.#t=T.nextObjId}}class k extends j{static#K=new E("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);#t=g;#tt=!1;#et=0;#ot=0;#it="";#st="";#nt=new M(R);#rt=new M(H);constructor(){super(),this.#t=T.nextObjId}get hasProfile(){return this.#tt}set hasProfile(t){this.#tt="boolean"==typeof t&&t}get ascent(){return this.#et}set ascent(t){this.#et="number"==typeof t?Number.parseInt(t):0}get descent(){return this.#ot}set descent(t){this.#ot="number"==typeof t?Number.parseInt(t):0}get provider(){return this.#it}set provider(t){this.#it="string"==typeof t?P.sanitizeToJsString(t):""}get transitMode(){return this.#st}set transitMode(t){this.#st="string"==typeof t?P.sanitizeToJsString(t):""}get itineraryPoints(){return this.#nt}get maneuvers(){return this.#rt}get objType(){return k.#K}get objId(){return this.#t}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this.#t=T.nextObjId;const o=new Map;let i=0;const s=this.itineraryPoints.iterator;for(;!s.done;)o.set(e.itineraryPoints[i].objId,s.value.objId),i++;const n=this.maneuvers.iterator;for(;!n.done;)n.value.itineraryPointObjId=o.get(n.value.itineraryPointObjId)}}class B extends j{static#K=new E("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);#at=n.height;#lt=n.width;#ht="";#dt="";#ct="";#ut="";#p="";#W="";#mt=a.defaultValue;#pt=a.defaultValue;#V=a.defaultValue;#X=a.defaultValue;#Y=o.invalid;#gt=o.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get iconHeight(){return this.#at}set iconHeight(t){this.#at="number"==typeof t?t:n.height}get iconWidth(){return this.#lt}set iconWidth(t){this.#lt="number"==typeof t?t:n.width}get iconContent(){return this.#ht}set iconContent(t){this.#ht="string"==typeof t?P.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this.#dt}set popupContent(t){this.#dt="string"==typeof t?P.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this.#ct}set tooltipContent(t){this.#ct="string"==typeof t?P.sanitizeToHtmlString(t).htmlString:""}get phone(){return this.#ut}set phone(t){this.#ut="string"==typeof t?P.sanitizeToHtmlString(t).htmlString:""}get url(){return this.#p}set url(t){this.#p="string"==typeof t?encodeURI(P.sanitizeToUrl(t).url):""}get address(){return this.#W}set address(t){this.#W="string"==typeof t?P.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this.#mt}set iconLat(t){this.#mt="number"==typeof t?t:a.defaultValue}get iconLng(){return this.#pt}set iconLng(t){this.#pt="number"==typeof t?t:a.defaultValue}get lat(){return this.#V}set lat(t){this.#V="number"==typeof t?t:a.defaultValue}get lng(){return this.#X}set lng(t){this.#X="number"==typeof t?t:a.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.invalid}get chainedDistance(){return this.#gt}set chainedDistance(t){this.#gt="number"==typeof t?t:o.defaultValue}get isRouteNote(){return this.#Y!==o.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#mt=t[0],this.#pt=t[1]):(this.#mt=a.defaultValue,this.#pt=a.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#V=t[0],this.#X=t[1]):(this.#V=a.defaultValue,this.#X=a.defaultValue)}get objType(){return B.#K}get objId(){return this.#t}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(a.fixed)),iconLng:parseFloat(this.iconLng.toFixed(a.fixed)),lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this.#t=T.nextObjId}}class z extends j{static#K=new E("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);#U="";#vt=new M(A);#ft=new M(B);#yt=new k;#_t=t.route.width;#Tt=t.route.color;#bt=t.route.dashIndex;#Lt=!0;#gt=o.defaultValue;#Y=o.defaultValue;#Q=o.defaultValue;#Et=l.notEdited;#wt=!1;#t=g;constructor(){super(),this.#vt.add(new A),this.#vt.add(new A),this.#t=T.nextObjId}get name(){return this.#U}set name(t){this.#U="string"==typeof t?P.sanitizeToJsString(t):""}get wayPoints(){return this.#vt}get notes(){return this.#ft}get itinerary(){return this.#yt}get width(){return this.#_t}set width(e){this.#_t="number"==typeof e?e:t.route.width}get color(){return this.#Tt}set color(e){this.#Tt="string"==typeof e&&P.sanitizeToColor(e)||t.route.color}get dashIndex(){return this.#bt}set dashIndex(e){this.#bt="number"==typeof e&&t.route.dashChoices[e]?e:0}get dashString(){let e="";return t.route.dashChoices[this.#bt].iDashArray.forEach(t=>e+=String(t*this.#_t)+","),e.substring(0,e.length-1)}get chain(){return this.#Lt}set chain(t){this.#Lt="boolean"==typeof t&&t}get chainedDistance(){return this.#gt}set chainedDistance(t){this.#gt="number"==typeof t?t:o.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.defaultValue}get duration(){return this.#Q}set duration(t){this.#Q="number"==typeof t?t:o.defaultValue}get editionStatus(){return this.#Et}set editionStatus(t){this.#Et="number"==typeof t?t:l.notEdited}get hidden(){return this.#wt}set hidden(t){this.#wt="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" ⮞ "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this.#t}get objType(){return z.#K}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach(e=>{t=t&&a.defaultValue!==e.lat&&a.defaultValue!==e.lng}),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this.#t=T.nextObjId}}class F extends j{static#K=new E("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);#Mt=new z;#xt=new M(z);#ft=new M(B);#It="OSM - Color";#U="";#Ct=!1;#t=g;constructor(){super(),this.#xt.add(new z),this.#t=T.nextObjId}get editedRoute(){return this.#Mt}set editedRoute(t){this.#Mt="Route"===t?.objType?.name?t:new z}get routes(){return this.#xt}get notes(){return this.#ft}get layerName(){return this.#It}set layerName(t){this.#It="string"==typeof t?P.sanitizeToJsString(t):"OSM - Color"}get name(){return this.#U}set name(t){this.#U="string"==typeof t?P.sanitizeToJsString(t):""}get readOnly(){return this.#Ct}set readOnly(t){this.#Ct="boolean"!=typeof t||t}get objId(){return this.#t}get objType(){return F.#K}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this.#t=T.nextObjId}}class Z{#it="";#st="";constructor(){Object.freeze(this)}get provider(){return this.#it}set provider(t){this.#it="string"==typeof t?t:""}get transitMode(){return this.#st}set transitMode(t){this.#st="string"==typeof t?t:""}}const K=new class{#Nt;#Pt;#Ot;#Dt;#St;#jt;#At;#Rt;constructor(){Object.freeze(this),this.#Nt=new Map,this.#Pt=new Map,this.#Ot=new Z,this.#Dt=D.UUID,this.#St=null,this.#jt=new F,this.#At=g,this.#Rt=[]}get map(){return this.#St}set map(t){this.#St||(this.#St=t)}get travel(){return this.#jt}get editedRouteObjId(){return this.#At}set editedRouteObjId(t){this.#At="number"==typeof t?t:g}get searchData(){return this.#Rt}get providers(){return this.#Nt}get mapObjects(){return this.#Pt}get routing(){return this.#Ot}get UUID(){return this.#Dt}};class U{#Ht;#kt;constructor(t,e){Object.freeze(this),this.#Ht="string"==typeof t?t:"",this.#kt="string"==typeof e?e:""}get providerName(){return this.#Ht}get providerKey(){return this.#kt}get jsonObject(){return{providerName:this.providerName,providerKey:this.providerKey}}}const W=new class{#Bt(t,e){for(const o in e)try{if("dataset"===o){const o=e.dataset;for(const e in o)t.dataset["tan"+e]=o[e]}else t[o]=e[o]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){Object.freeze(this)}create(t,e,o){let i=null;return"text"===t.toLowerCase()?i=document.createTextNode(e.value||""):(i="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this.#Bt(i,e)),o&&o.appendChild(i),i}};class V{#zt;constructor(t){Object.freeze(this),this.#zt=t}handleEvent(){this.#zt.onCancel()}}class X{#Ft;constructor(t){Object.freeze(this),this.#Ft=t}handleEvent(t){this.#Ft.keyboardELEnabled&&("Escape"===t.key||"Esc"===t.key?this.#Ft.onCancel():"Enter"===t.key&&this.#Ft.onOk())}}class Y{#Ft;constructor(t){Object.freeze(this),this.#Ft=t}handleEvent(){this.#Ft.onOk()}}
/* @preserve
	 * Leaflet 2.0.0-alpha.1, a JS library for interactive maps. https://leafletjs.com
	 * (c) 2010-2025 Volodymyr Agafonkin, (c) 2010-2011 CloudMade
	 */let G=0;function q(t){return"_leaflet_id"in t||(t._leaflet_id=++G),t._leaflet_id}function $(t,e,o){let i,s;function n(){i=!1,s&&(r.apply(o,s),s=!1)}function r(...r){i?s=r:(t.apply(o,r),setTimeout(n,e),i=!0)}return r}function J(t,e,o){const i=e[1],s=e[0],n=i-s;return t===i&&o?t:((t-s)%n+n)%n+s}function Q(){return!1}function tt(t,e){if(!1===e)return t;const o=10**(void 0===e?6:e);return Math.round(t*o)/o}function et(t){return t.trim().split(/\s+/)}function ot(t,e){Object.hasOwn(t,"options")||(t.options=t.options?Object.create(t.options):{});for(const o in e)Object.hasOwn(e,o)&&(t.options[o]=e[o]);return t.options}const it=/\{ *([\w_ -]+) *\}/g;function st(t,e){return t.replace(it,(t,o)=>{let i=e[o];if(void 0===i)throw new Error(`No value provided for variable ${t}`);return"function"==typeof i&&(i=i(e)),i})}const nt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";var rt={__proto__:null,emptyImageUrl:nt,falseFn:Q,formatNum:tt,get lastId(){return G},setOptions:ot,splitWords:et,stamp:q,template:st,throttle:$,wrapNum:J};class at{static extend({statics:t,includes:e,...o}){const i=class extends(this){};Object.setPrototypeOf(i,this);const s=this.prototype,n=i.prototype;if(t&&Object.assign(i,t),Array.isArray(e))for(const t of e)Object.assign(n,t);else e&&Object.assign(n,e);return Object.assign(n,o),n.options&&(n.options=s.options?Object.create(s.options):{},Object.assign(n.options,o.options)),n._initHooks=[],i}static include(t){const e=this.prototype.options;return Object.assign(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this}static setDefaultOptions(t){return ot(this.prototype,t),this}static mergeOptions(t){return this.prototype.options??={},Object.assign(this.prototype.options,t),this}static addInitHook(t,...e){const o="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks??=[],this.prototype._initHooks.push(o),this}constructor(...t){this._initHooksCalled=!1,ot(this),this.initialize&&this.initialize(...t),this.callInitHooks()}initialize(){}callInitHooks(){if(this._initHooksCalled)return;const t=[];let e=this;for(;null!==(e=Object.getPrototypeOf(e));)t.push(e);t.reverse();for(const e of t)for(const t of e._initHooks??[])t.call(this);this._initHooksCalled=!0}}class lt extends at{on(t,e,o){if("object"==typeof t)for(const[o,i]of Object.entries(t))this._on(o,i,e);else for(const i of et(t))this._on(i,e,o);return this}off(t,e,o){if(arguments.length)if("object"==typeof t)for(const[o,i]of Object.entries(t))this._off(o,i,e);else{const i=1===arguments.length;for(const s of et(t))i?this._off(s):this._off(s,e,o)}else delete this._events;return this}_on(t,e,o,i){if("function"!=typeof e)return void console.warn("wrong listener type: "+typeof e);if(!1!==this._listens(t,e,o))return;o===this&&(o=void 0);const s={fn:e,ctx:o};i&&(s.once=!0),this._events??={},this._events[t]??=[],this._events[t].push(s)}_off(t,e,o){if(!this._events)return;let i=this._events[t];if(!i)return;if(1===arguments.length){if(this._firingCount)for(const t of i)t.fn=Q;return void delete this._events[t]}if("function"!=typeof e)return void console.warn("wrong listener type: "+typeof e);const s=this._listens(t,e,o);if(!1!==s){const e=i[s];this._firingCount&&(e.fn=Q,this._events[t]=i=i.slice()),i.splice(s,1)}}fire(t,e,o){if(!this.listens(t,o))return this;const i={...e,type:t,target:this,sourceTarget:e?.sourceTarget||this};if(this._events){const e=this._events[t];if(e){this._firingCount=this._firingCount+1||1;for(const o of e){const e=o.fn;o.once&&this.off(t,e,o.ctx),e.call(o.ctx||this,i)}this._firingCount--}}return o&&this._propagateEvent(i),this}listens(t,e,o,i){"string"!=typeof t&&console.warn('"string" type argument expected');let s=e;if("function"!=typeof e&&(i=!!e,s=void 0,o=void 0),this._events?.[t]?.length&&!1!==this._listens(t,s,o))return!0;if(i)for(const s of Object.values(this._eventParents??{}))if(s.listens(t,e,o,i))return!0;return!1}_listens(t,e,o){if(!this._events)return!1;const i=this._events[t]??[];if(!e)return!!i.length;o===this&&(o=void 0);const s=i.findIndex(t=>t.fn===e&&t.ctx===o);return-1!==s&&s}once(t,e,o){if("object"==typeof t)for(const[o,i]of Object.entries(t))this._on(o,i,e,!0);else for(const i of et(t))this._on(i,e,o,!0);return this}addEventParent(t){return this._eventParents??={},this._eventParents[q(t)]=t,this}removeEventParent(t){return this._eventParents&&delete this._eventParents[q(t)],this}_propagateEvent(t){for(const e of Object.values(this._eventParents??{}))e.fire(t.type,{propagatedFrom:t.target,...t},!0)}}class ht{constructor(t,e,o){if(!ht.validate(t,e))throw new Error(`Invalid Point object: (${t}, ${e})`);let i,s;if(t instanceof ht)return t;Array.isArray(t)?(i=t[0],s=t[1]):"object"==typeof t&&"x"in t&&"y"in t?(i=t.x,s=t.y):(i=t,s=e),this.x=o?Math.round(i):i,this.y=o?Math.round(s):s}static validate(t,e){return!!(t instanceof ht||Array.isArray(t))||(!!(t&&"object"==typeof t&&"x"in t&&"y"in t)||!(!t&&0!==t||!e&&0!==e))}clone(){const t=new ht(0,0);return t.x=this.x,t.y=this.y,t}add(t){return this.clone()._add(new ht(t))}_add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.clone()._subtract(new ht(t))}_subtract(t){return this.x-=t.x,this.y-=t.y,this}divideBy(t){return this.clone()._divideBy(t)}_divideBy(t){return this.x/=t,this.y/=t,this}multiplyBy(t){return this.clone()._multiplyBy(t)}_multiplyBy(t){return this.x*=t,this.y*=t,this}scaleBy(t){return new ht(this.x*t.x,this.y*t.y)}unscaleBy(t){return new ht(this.x/t.x,this.y/t.y)}round(){return this.clone()._round()}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}floor(){return this.clone()._floor()}_floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.clone()._ceil()}_ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}trunc(){return this.clone()._trunc()}_trunc(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}distanceTo(t){const e=(t=new ht(t)).x-this.x,o=t.y-this.y;return Math.sqrt(e*e+o*o)}equals(t){return(t=new ht(t)).x===this.x&&t.y===this.y}contains(t){return t=new ht(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)}toString(){return`Point(${tt(this.x)}, ${tt(this.y)})`}}class dt{constructor(t,e){if(!t)return;if(t instanceof dt)return t;const o=e?[t,e]:t;for(const t of o)this.extend(t)}extend(t){let e,o;if(!t)return this;if(t instanceof ht||"number"==typeof t[0]||"x"in t)e=o=new ht(t);else if(e=(t=new dt(t)).min,o=t.max,!e||!o)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)):(this.min=e.clone(),this.max=o.clone()),this}getCenter(t){return new ht((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)}getBottomLeft(){return new ht(this.min.x,this.max.y)}getTopRight(){return new ht(this.max.x,this.min.y)}getTopLeft(){return this.min}getBottomRight(){return this.max}getSize(){return this.max.subtract(this.min)}contains(t){let e,o;return(t="number"==typeof t[0]||t instanceof ht?new ht(t):new dt(t))instanceof dt?(e=t.min,o=t.max):e=o=t,e.x>=this.min.x&&o.x<=this.max.x&&e.y>=this.min.y&&o.y<=this.max.y}intersects(t){t=new dt(t);const e=this.min,o=this.max,i=t.min,s=t.max,n=s.x>=e.x&&i.x<=o.x,r=s.y>=e.y&&i.y<=o.y;return n&&r}overlaps(t){t=new dt(t);const e=this.min,o=this.max,i=t.min,s=t.max,n=s.x>e.x&&i.x<o.x,r=s.y>e.y&&i.y<o.y;return n&&r}isValid(){return!(!this.min||!this.max)}pad(t){const e=this.min,o=this.max,i=Math.abs(e.x-o.x)*t,s=Math.abs(e.y-o.y)*t;return new dt(new ht(e.x-i,e.y-s),new ht(o.x+i,o.y+s))}equals(t){return!!t&&(t=new dt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}}class ct{constructor(t,e){if(!t)return;if(t instanceof ct)return t;const o=e?[t,e]:t;for(const t of o)this.extend(t)}extend(t){const e=this._southWest,o=this._northEast;let i,s;if(t instanceof ut)i=t,s=t;else{if(!(t instanceof ct))return t?ut.validate(t)?this.extend(new ut(t)):this.extend(new ct(t)):this;if(i=t._southWest,s=t._northEast,!i||!s)return this}return e||o?(e.lat=Math.min(i.lat,e.lat),e.lng=Math.min(i.lng,e.lng),o.lat=Math.max(s.lat,o.lat),o.lng=Math.max(s.lng,o.lng)):(this._southWest=new ut(i.lat,i.lng),this._northEast=new ut(s.lat,s.lng)),this}pad(t){const e=this._southWest,o=this._northEast,i=Math.abs(e.lat-o.lat)*t,s=Math.abs(e.lng-o.lng)*t;return new ct(new ut(e.lat-i,e.lng-s),new ut(o.lat+i,o.lng+s))}getCenter(){return new ut((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)}getSouthWest(){return this._southWest}getNorthEast(){return this._northEast}getNorthWest(){return new ut(this.getNorth(),this.getWest())}getSouthEast(){return new ut(this.getSouth(),this.getEast())}getWest(){return this._southWest.lng}getSouth(){return this._southWest.lat}getEast(){return this._northEast.lng}getNorth(){return this._northEast.lat}contains(t){t=ut.validate(t)?new ut(t):new ct(t);const e=this._southWest,o=this._northEast;let i,s;return t instanceof ct?(i=t.getSouthWest(),s=t.getNorthEast()):i=s=t,i.lat>=e.lat&&s.lat<=o.lat&&i.lng>=e.lng&&s.lng<=o.lng}intersects(t){t=new ct(t);const e=this._southWest,o=this._northEast,i=t.getSouthWest(),s=t.getNorthEast(),n=s.lat>=e.lat&&i.lat<=o.lat,r=s.lng>=e.lng&&i.lng<=o.lng;return n&&r}overlaps(t){t=new ct(t);const e=this._southWest,o=this._northEast,i=t.getSouthWest(),s=t.getNorthEast(),n=s.lat>e.lat&&i.lat<o.lat,r=s.lng>e.lng&&i.lng<o.lng;return n&&r}toBBoxString(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")}equals(t,e){return!!t&&(t=new ct(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))}isValid(){return!(!this._southWest||!this._northEast)}}class ut{constructor(t,e,o){if(!ut.validate(t,e,o))throw new Error(`Invalid LatLng object: (${t}, ${e})`);let i,s,n;if(t instanceof ut)return t;Array.isArray(t)&&"object"!=typeof t[0]?3===t.length?(i=t[0],s=t[1],n=t[2]):2===t.length&&(i=t[0],s=t[1]):"object"==typeof t&&"lat"in t?(i=t.lat,s="lng"in t?t.lng:t.lon,n=t.alt):(i=t,s=e,n=o),this.lat=+i,this.lng=+s,void 0!==n&&(this.alt=+n)}static validate(t,e,o){return t instanceof ut||"object"==typeof t&&"lat"in t||(t&&Array.isArray(t)&&"object"!=typeof t[0]?3===t.length||2===t.length:!(!t&&0!==t||!e&&0!==e))}equals(t,e){if(!t)return!1;t=new ut(t);return Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(e??1e-9)}toString(t){return`LatLng(${tt(this.lat,t)}, ${tt(this.lng,t)})`}distanceTo(t){return pt.distance(this,new ut(t))}wrap(){return pt.wrapLatLng(this)}toBounds(t){const e=180*t/40075017,o=e/Math.cos(Math.PI/180*this.lat);return new ct([this.lat-e,this.lng-o],[this.lat+e,this.lng+o])}clone(){const t=new ut(0,0);return t.lat=this.lat,t.lng=this.lng,t.alt=this.alt,t}}class mt{static projection=void 0;static transformation=void 0;static latLngToPoint(t,e){const o=this.projection.project(t),i=this.scale(e);return this.transformation._transform(o,i)}static pointToLatLng(t,e){const o=this.scale(e),i=this.transformation.untransform(t,o);return this.projection.unproject(i)}static project(t){return this.projection.project(t)}static unproject(t){return this.projection.unproject(t)}static scale(t){return 256*2**t}static zoom(t){return Math.log(t/256)/Math.LN2}static getProjectedBounds(t){if(this.infinite)return null;const e=this.projection.bounds,o=this.scale(t),i=this.transformation.transform(e.min,o),s=this.transformation.transform(e.max,o);return new dt(i,s)}static infinite=!1;static wrapLatLng(t){t=new ut(t);const e=this.wrapLng?J(t.lng,this.wrapLng,!0):t.lng,o=this.wrapLat?J(t.lat,this.wrapLat,!0):t.lat,i=t.alt;return new ut(o,e,i)}static wrapLatLngBounds(t){const e=(t=new ct(t)).getCenter(),o=this.wrapLatLng(e),i=e.lat-o.lat,s=e.lng-o.lng;if(0===i&&0===s)return t;const n=t.getSouthWest(),r=t.getNorthEast(),a=new ut(n.lat-i,n.lng-s),l=new ut(r.lat-i,r.lng-s);return new ct(a,l)}}class pt extends mt{static wrapLng=[-180,180];static R=6371e3;static distance(t,e){const o=Math.PI/180,i=t.lat*o,s=e.lat*o,n=Math.sin((e.lat-t.lat)*o/2),r=Math.sin((e.lng-t.lng)*o/2),a=n*n+Math.cos(i)*Math.cos(s)*r*r,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}const gt=6378137,vt={R:gt,MAX_LATITUDE:85.0511287798,project(t){t=new ut(t);const e=Math.PI/180,o=this.MAX_LATITUDE,i=Math.max(Math.min(o,t.lat),-o),s=Math.sin(i*e);return new ht(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject(t){t=new ht(t);const e=180/Math.PI;return new ut((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(()=>{const t=gt*Math.PI;return new dt([-t,-t],[t,t])})()};class ft{constructor(t,e,o,i){if(Array.isArray(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=o,this._d=i}transform(t,e){return this._transform(t.clone(),e)}_transform(t,e){return e||=1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t}untransform(t,e){return e||=1,new ht((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}}class yt extends pt{static code="EPSG:3857";static projection=vt;static transformation=(()=>{const t=.5/(Math.PI*vt.R);return new ft(t,.5,-t,.5)})()}const _t=wt("chrome"),Tt=!_t&&wt("safari"),bt="undefined"!=typeof orientation||wt("mobile"),Lt="undefined"!=typeof window&&!!window.PointerEvent,Et="undefined"!=typeof window&&("ontouchstart"in window||!!window.TouchEvent);function wt(t){return"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t)}var Mt={chrome:_t,safari:Tt,mobile:bt,pointer:Lt,touch:Et||Lt,touchNative:Et,retina:"undefined"!=typeof window&&void 0!==window.devicePixelRatio&&window.devicePixelRatio>1,mac:"undefined"!=typeof navigator&&void 0!==navigator.platform&&navigator.platform.startsWith("Mac"),linux:"undefined"!=typeof navigator&&void 0!==navigator.platform&&navigator.platform.startsWith("Linux")};function xt(t,e){t.addEventListener("dblclick",e);let o,i=0;function s(t){if(1!==t.detail)return void(o=t.detail);if("mouse"===t.pointerType||t.sourceCapabilities&&!t.sourceCapabilities.firesTouchEvents)return;const e=pe(t);if(e.some(t=>t instanceof HTMLLabelElement&&t.attributes.for)&&!e.some(t=>t instanceof HTMLInputElement||t instanceof HTMLSelectElement))return;const s=Date.now();s-i<=200?(o++,2===o&&t.target.dispatchEvent(function(t){let e,o={bubbles:t.bubbles,cancelable:t.cancelable,composed:t.composed,detail:2,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,button:t.button,buttons:t.buttons,relatedTarget:t.relatedTarget,region:t.region};return t instanceof PointerEvent?(o={...o,pointerId:t.pointerId,width:t.width,height:t.height,pressure:t.pressure,tangentialPressure:t.tangentialPressure,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,pointerType:t.pointerType,isPrimary:t.isPrimary},e=new PointerEvent("dblclick",o)):e=new MouseEvent("dblclick",o),e}(t))):o=1,i=s}return t.addEventListener("click",s),{dblclick:e,simDblclick:s}}function It(t){return"string"==typeof t?document.getElementById(t):t}function Ct(t,e,o){const i=document.createElement(t);return i.className=e??"",o?.appendChild(i),i}function Nt(t){const e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function Pt(t){const e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function Ot(t,e,o){const i=e??new ht(0,0);t.style.transform=`translate3d(${i.x}px,${i.y}px,0)${o?` scale(${o})`:""}`}const Dt=new WeakMap;function St(t,e){Dt.set(t,e),Ot(t,e)}function jt(t){return Dt.get(t)??new ht(0,0)}const At="undefined"==typeof document?{}:document.documentElement.style,Rt=["userSelect","WebkitUserSelect"].find(t=>t in At);let Ht,kt,Bt;function zt(){const t=At[Rt];"none"!==t&&(Ht=t,At[Rt]="none")}function Ft(){void 0!==Ht&&(At[Rt]=Ht,Ht=void 0)}function Zt(){oe(window,"dragstart",ue)}function Kt(){se(window,"dragstart",ue)}function Ut(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Wt(),kt=t,Bt=t.style.outlineStyle,t.style.outlineStyle="none",oe(window,"keydown",Wt))}function Wt(){kt&&(kt.style.outlineStyle=Bt,kt=void 0,Bt=void 0,se(window,"keydown",Wt))}function Vt(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function Xt(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Yt={__proto__:null,create:Ct,disableImageDrag:Zt,disableTextSelection:zt,enableImageDrag:Kt,enableTextSelection:Ft,get:It,getPosition:jt,getScale:Xt,getSizedParentNode:Vt,preventOutline:Ut,restoreOutline:Wt,setPosition:St,setTransform:Ot,toBack:Pt,toFront:Nt};let Gt=new Map,qt=!1;function $t(){qt||(qt=!0,document.addEventListener("pointerdown",Jt,{capture:!0}),document.addEventListener("pointermove",Qt,{capture:!0}),document.addEventListener("pointerup",te,{capture:!0}),document.addEventListener("pointercancel",te,{capture:!0}),Gt=new Map)}function Jt(t){Gt.set(t.pointerId,t)}function Qt(t){Gt.has(t.pointerId)&&Gt.set(t.pointerId,t)}function te(t){Gt.delete(t.pointerId)}function ee(){return[...Gt.values()]}function oe(t,e,o,i){if(e&&"object"==typeof e)for(const[i,s]of Object.entries(e))ae(t,i,s,o);else for(const s of et(e))ae(t,s,o,i);return this}const ie="_leaflet_events";function se(t,e,o,i){if(1===arguments.length)ne(t),delete t[ie];else if(e&&"object"==typeof e)for(const[i,s]of Object.entries(e))le(t,i,s,o);else if(e=et(e),2===arguments.length)ne(t,t=>e.includes(t));else for(const s of e)le(t,s,o,i);return this}function ne(t,e){for(const o of Object.keys(t[ie]??{})){const i=o.split(/\d/)[0];e&&!e(i)||le(t,i,null,null,o)}}const re={pointerenter:"pointerover",pointerleave:"pointerout",wheel:"undefined"!=typeof window&&(!("onwheel"in window)&&"mousewheel")};function ae(t,e,o,i){const s=e+q(o)+(i?`_${q(i)}`:"");if(t[ie]&&t[ie][s])return this;let n=function(e){return o.call(i||t,e||window.event)};const r=n;Mt.touch&&"dblclick"===e?n=xt(t,n):"addEventListener"in t?"wheel"===e||"mousewheel"===e?t.addEventListener(re[e]||e,n,{passive:!1}):"pointerenter"===e||"pointerleave"===e?(n=function(e){e??=window.event,ye(t,e)&&r(e)},t.addEventListener(re[e],n,!1)):t.addEventListener(e,r,!1):t.attachEvent(`on${e}`,n),t[ie]??={},t[ie][s]=n}function le(t,e,o,i,s){s??=e+q(o)+(i?`_${q(i)}`:"");const n=t[ie]&&t[ie][s];if(!n)return this;Mt.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,n):"removeEventListener"in t?t.removeEventListener(re[e]||e,n,!1):t.detachEvent(`on${e}`,n),t[ie][s]=null}function he(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function de(t){return ae(t,"wheel",he),this}function ce(t){return oe(t,"pointerdown dblclick contextmenu",he),t._leaflet_disable_click=!0,this}function ue(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function me(t){return ue(t),he(t),this}function pe(t){return t.composedPath()}function ge(t,e){if(!e)return new ht(t.clientX,t.clientY);const o=Xt(e),i=o.boundingClientRect;return new ht((t.clientX-i.left)/o.x-e.clientLeft,(t.clientY-i.top)/o.y-e.clientTop)}function ve(){const t=window.devicePixelRatio;return Mt.linux&&Mt.chrome?t:Mt.mac?3*t:t>0?2*t:1}function fe(t){return t.deltaY&&0===t.deltaMode?-t.deltaY/ve():t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:(t.deltaX||t.deltaZ,0)}function ye(t,e){let o=e.relatedTarget;if(!o)return!0;try{for(;o&&o!==t;)o=o.parentNode}catch(t){return!1}return o!==t}var _e={__proto__:null,PointerEvents:{__proto__:null,cleanupPointers:function(){Gt.clear()},disablePointerDetection:function(){document.removeEventListener("pointerdown",Jt,{capture:!0}),document.removeEventListener("pointermove",Qt,{capture:!0}),document.removeEventListener("pointerup",te,{capture:!0}),document.removeEventListener("pointercancel",te,{capture:!0}),qt=!1},enablePointerDetection:$t,getPointers:ee},disableClickPropagation:ce,disableScrollPropagation:de,getPointerPosition:ge,getPropagationPath:pe,getWheelDelta:fe,getWheelPxFactor:ve,isExternalTarget:ye,off:se,on:oe,preventDefault:ue,stop:me,stopPropagation:he};class Te extends lt{run(t,e,o,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=o??.25,this._easeOutPower=1/Math.max(i??.5,.2),this._startPos=jt(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()}stop(){this._inProgress&&(this._step(!0),this._complete())}_animate(){this._animId=requestAnimationFrame(this._animate.bind(this)),this._step()}_step(t){const e=+new Date-this._startTime,o=1e3*this._duration;e<o?this._runFrame(this._easeOut(e/o),t):(this._runFrame(1),this._complete())}_runFrame(t,e){const o=this._startPos.add(this._offset.multiplyBy(t));e&&o._round(),St(this._el,o),this.fire("step")}_complete(){cancelAnimationFrame(this._animId),this._inProgress=!1,this.fire("end")}_easeOut(t){return 1-(1-t)**this._easeOutPower}}let be=class t extends lt{static{this.setDefaultOptions({crs:yt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0})}initialize(t,e){e=ot(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(new ut(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=this.options.zoomAnimation,this._zoomAnimated&&this._createAnimProxy(),this._addLayers(this.options.layers)}setView(t,e,o){if(e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(new ut(t),e,this.options.maxBounds),o??={},this._stop(),this._loaded&&!o.reset&&!0!==o){void 0!==o.animate&&(o.zoom={animate:o.animate,...o.zoom},o.pan={animate:o.animate,duration:o.duration,...o.pan});if(this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,o.zoom):this._tryAnimatedPan(t,o.pan))return clearTimeout(this._sizeTimer),this}return this._resetView(t,e,o.pan?.noMoveStart),this}setZoom(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)}zoomIn(t,e){return t??=this.options.zoomDelta,this.setZoom(this._zoom+t,e)}zoomOut(t,e){return t??=this.options.zoomDelta,this.setZoom(this._zoom-t,e)}setZoomAround(t,e,o){const i=this.getZoomScale(e),s=this.getSize().divideBy(2),n=(t instanceof ht?t:this.latLngToContainerPoint(t)).subtract(s).multiplyBy(1-1/i),r=this.containerPointToLatLng(s.add(n));return this.setView(r,e,{zoom:o})}_getBoundsCenterZoom(t,e){e??={},t=t.getBounds?t.getBounds():new ct(t);const o=new ht(e.paddingTopLeft||e.padding||[0,0]),i=new ht(e.paddingBottomRight||e.padding||[0,0]);let s=this.getBoundsZoom(t,!1,o.add(i));if(s="number"==typeof e.maxZoom?Math.min(e.maxZoom,s):s,s===1/0)return{center:t.getCenter(),zoom:s};const n=i.subtract(o).divideBy(2),r=this.project(t.getSouthWest(),s),a=this.project(t.getNorthEast(),s);return{center:this.unproject(r.add(a).divideBy(2).add(n),s),zoom:s}}fitBounds(t,e){if(!(t=new ct(t)).isValid())throw new Error("Bounds are not valid.");const o=this._getBoundsCenterZoom(t,e);return this.setView(o.center,o.zoom,e)}fitWorld(t){return this.fitBounds([[-90,-180],[90,180]],t)}panTo(t,e){return this.setView(t,this._zoom,{pan:e})}panBy(t,e){if(t=new ht(t).round(),e??={},!t.x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Te,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){this._mapPane.classList.add("leaflet-pan-anim");const o=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,o,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this}flyTo(t,e,o){if(o??={},!1===o.animate)return this.setView(t,e,o);this._stop();const i=this.project(this.getCenter()),s=this.project(t),n=this.getSize(),r=this._zoom;t=new ut(t),e=void 0===e?r:this._limitZoom(e);const a=Math.max(n.x,n.y),l=a*this.getZoomScale(r,e),h=s.distanceTo(i)||1,d=1.42,c=2.0164;function u(t){const e=(l*l-a*a+(t?-1:1)*c*c*h*h)/(2*(t?l:a)*c*h),o=Math.sqrt(e*e+1)-e;return o<1e-9?-18:Math.log(o)}function m(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}const g=u(0);function v(t){return a*(p(g)*(m(e=g+d*t)/p(e))-m(g))/c;var e}const f=Date.now(),y=(u(1)-g)/d,_=o.duration?1e3*o.duration:1e3*y*.8,T=()=>{const o=(Date.now()-f)/_,n=function(t){return 1-(1-t)**1.5}(o)*y;o<=1?(this._flyToFrame=requestAnimationFrame(T),this._move(this.unproject(i.add(s.subtract(i).multiplyBy(v(n)/h)),r),this.getScaleZoom(a/function(t){return a*(p(g)/p(g+d*t))}(n),r),{flyTo:!0})):this._move(t,e)._moveEnd(!0)};return this._moveStart(!0,o.noMoveStart),T(),this}flyToBounds(t,e){const o=this._getBoundsCenterZoom(t,e);return this.flyTo(o.center,o.zoom,e)}setMaxBounds(t){return t=new ct(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)}setMinZoom(t){const e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this}setMaxZoom(t){const e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this}panInsideBounds(t,e){this._enforcingBounds=!0;const o=this.getCenter(),i=this._limitCenter(o,this._zoom,new ct(t));return o.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this}panInside(t,e){e??={};const o=new ht(e.paddingTopLeft||e.padding||[0,0]),i=new ht(e.paddingBottomRight||e.padding||[0,0]),s=this.project(this.getCenter()),n=this.project(t),r=this.getPixelBounds(),a=new dt([r.min.add(o),r.max.subtract(i)]),l=a.getSize();if(!a.contains(n)){this._enforcingBounds=!0;const t=n.subtract(a.getCenter()),o=a.extend(n).getSize().subtract(l);s.x+=t.x<0?-o.x:o.x,s.y+=t.y<0?-o.y:o.y,this.panTo(this.unproject(s),e),this._enforcingBounds=!1}return this}invalidateSize(t){if(!this._loaded)return this;t={animate:!1,pan:!0,...!0===t?{animate:!0}:t};const e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;const o=this.getSize(),i=e.divideBy(2).round(),s=o.divideBy(2).round(),n=i.subtract(s);return n.x||n.y?(t.animate&&t.pan?this.panBy(n):(t.pan&&this._rawPanBy(n),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(this.fire.bind(this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:o})):this}stop(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()}locate(t){if(t=this._locateOptions={timeout:1e4,watch:!1,...t},!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;const e=this._handleGeolocationResponse.bind(this),o=this._handleGeolocationError.bind(this);return t.watch?(void 0!==this._locationWatchId&&navigator.geolocation.clearWatch(this._locationWatchId),this._locationWatchId=navigator.geolocation.watchPosition(e,o,t)):navigator.geolocation.getCurrentPosition(e,o,t),this}stopLocate(){return navigator.geolocation?.clearWatch?.(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this}_handleGeolocationError(t){if(!this._container._leaflet_id)return;const e=t.code,o=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:`Geolocation error: ${o}.`})}_handleGeolocationResponse(t){if(!this._container._leaflet_id)return;const e=t.coords.latitude,o=t.coords.longitude,i=new ut(e,o),s=i.toBounds(2*t.coords.accuracy),n=this._locateOptions;if(n.setView){const t=this.getBoundsZoom(s);this.setView(i,n.maxZoom?Math.min(t,n.maxZoom):t)}const r={latlng:i,bounds:s,timestamp:t.timestamp};for(const e in t.coords)"number"==typeof t.coords[e]&&(r[e]=t.coords[e]);this.fire("locationfound",r)}addHandler(t,e){if(!e)return this;const o=this[t]=new e(this);return this._handlers.push(o),this.options[t]&&o.enable(),this}remove(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");delete this._container._leaflet_id,delete this._containerId,void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),this._mapPane.remove(),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(cancelAnimationFrame(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),clearTimeout(this._transitionEndTimer),clearTimeout(this._sizeTimer),this._loaded&&this.fire("unload"),this._destroyAnimProxy();for(const t of Object.values(this._layers))t.remove();for(const t of Object.values(this._panes))t.remove();return this._layers={},this._panes={},delete this._mapPane,delete this._renderer,this}createPane(t,e){const o=Ct("div","leaflet-pane"+(t?` leaflet-${t.replace("Pane","")}-pane`:""),e||this._mapPane);return t&&(this._panes[t]=o),o}getCenter(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())}getZoom(){return this._zoom}getBounds(){const t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),o=this.unproject(t.getTopRight());return new ct(e,o)}getMinZoom(){return this.options.minZoom??this._layersMinZoom??0}getMaxZoom(){return this.options.maxZoom??this._layersMaxZoom??1/0}getBoundsZoom(t,e,o){t=new ct(t),o=new ht(o??[0,0]);let i=this.getZoom()??0;const s=this.getMinZoom(),n=this.getMaxZoom(),r=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(o),h=new dt(this.project(a,i),this.project(r,i)).getSize(),d=this.options.zoomSnap,c=l.x/h.x,u=l.y/h.y,m=e?Math.max(c,u):Math.min(c,u);return i=this.getScaleZoom(m,i),d&&(i=Math.round(i/(d/100))*(d/100),i=e?Math.ceil(i/d)*d:Math.floor(i/d)*d),Math.max(s,Math.min(n,i))}getSize(){return this._size&&!this._sizeChanged||(this._size=new ht(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()}getPixelBounds(t,e){const o=this._getTopLeftPoint(t,e);return new dt(o,o.add(this.getSize()))}getPixelOrigin(){return this._checkIfLoaded(),this._pixelOrigin}getPixelWorldBounds(t){return this.options.crs.getProjectedBounds(t??this.getZoom())}getPane(t){return"string"==typeof t?this._panes[t]:t}getPanes(){return this._panes}getContainer(){return this._container}getZoomScale(t,e){const o=this.options.crs;return e??=this._zoom,o.scale(t)/o.scale(e)}getScaleZoom(t,e){const o=this.options.crs;e??=this._zoom;const i=o.zoom(t*o.scale(e));return isNaN(i)?1/0:i}project(t,e){return e??=this._zoom,this.options.crs.latLngToPoint(new ut(t),e)}unproject(t,e){return e??=this._zoom,this.options.crs.pointToLatLng(new ht(t),e)}layerPointToLatLng(t){const e=new ht(t).add(this.getPixelOrigin());return this.unproject(e)}latLngToLayerPoint(t){return this.project(new ut(t))._round()._subtract(this.getPixelOrigin())}wrapLatLng(t){return this.options.crs.wrapLatLng(new ut(t))}wrapLatLngBounds(t){return this.options.crs.wrapLatLngBounds(new ct(t))}distance(t,e){return this.options.crs.distance(new ut(t),new ut(e))}containerPointToLayerPoint(t){return new ht(t).subtract(this._getMapPanePos())}layerPointToContainerPoint(t){return new ht(t).add(this._getMapPanePos())}containerPointToLatLng(t){const e=this.containerPointToLayerPoint(new ht(t));return this.layerPointToLatLng(e)}latLngToContainerPoint(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(new ut(t)))}pointerEventToContainerPoint(t){return ge(t,this._container)}pointerEventToLayerPoint(t){return this.containerPointToLayerPoint(this.pointerEventToContainerPoint(t))}pointerEventToLatLng(t){return this.layerPointToLatLng(this.pointerEventToLayerPoint(t))}_initContainer(t){const e=this._container=It(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");oe(e,"scroll",this._onScroll,this),this._containerId=q(e),$t()}_initLayout(){const t=this._container;this._fadeAnimated=this.options.fadeAnimation;const e=["leaflet-container","leaflet-touch"];Mt.retina&&e.push("leaflet-retina"),Mt.safari&&e.push("leaflet-safari"),this._fadeAnimated&&e.push("leaflet-fade-anim"),t.classList.add(...e);const{position:o}=getComputedStyle(t);"absolute"!==o&&"relative"!==o&&"fixed"!==o&&"sticky"!==o&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()}_initPanes(){const t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),St(this._mapPane,new ht(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(t.markerPane.classList.add("leaflet-zoom-hide"),t.shadowPane.classList.add("leaflet-zoom-hide"))}_resetView(t,e,o){St(this._mapPane,new ht(0,0));const i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");const s=this._zoom!==e;this._moveStart(s,o)._move(t,e)._moveEnd(s),this.fire("viewreset"),i&&this.fire("load")}_moveStart(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this}_move(t,e,o,i){void 0===e&&(e=this._zoom);const s=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?o?.pinch&&this.fire("zoom",o):((s||o?.pinch)&&this.fire("zoom",o),this.fire("move",o)),this}_moveEnd(t){return t&&this.fire("zoomend"),this.fire("moveend")}_stop(){return cancelAnimationFrame(this._flyToFrame),this._panAnim?.stop(),this}_rawPanBy(t){St(this._mapPane,this._getMapPanePos().subtract(t))}_getZoomSpan(){return this.getMaxZoom()-this.getMinZoom()}_panInsideMaxBounds(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)}_checkIfLoaded(){if(!this._loaded)throw new Error("Set map center and zoom first.")}_initEvents(t){this._targets={},this._targets[q(this._container)]=this;(t?se:oe)(this._container,"click dblclick pointerdown pointerup pointerover pointerout pointermove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&(t?this._resizeObserver.disconnect():(this._resizeObserver||(this._resizeObserver=new ResizeObserver(this._onResize.bind(this))),this._resizeObserver.observe(this._container))),this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)}_onResize(){cancelAnimationFrame(this._resizeRequest),this._resizeRequest=requestAnimationFrame(()=>{this.invalidateSize({debounceMoveend:!0})})}_onScroll(){this._container.scrollTop=0,this._container.scrollLeft=0}_onMoveEnd(){const t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())}_findEventTargets(t,e){let o,i=[],s=t.target||t.srcElement,n=!1;const r="pointerout"===e||"pointerover"===e;for(;s;){if(o=this._targets[q(s)],o&&("click"===e||"preclick"===e)&&this._draggableMoved(o)){n=!0;break}if(o&&o.listens(e,!0)){if(r&&!ye(s,t))break;if(i.push(o),r)break}if(s===this._container)break;s=s.parentNode}return i.length||n||r||!this.listens(e,!0)||(i=[this]),i}_isClickDisabled(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click||!t.parentNode)return!0;t=t.parentNode}}_handleDOMEvent(t){const e=t.target??t.srcElement;if(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))return;const o=t.type;"pointerdown"===o&&Ut(e),this._fireDOMEvent(t,o)}static _pointerEvents=["click","dblclick","pointerover","pointerout","contextmenu"];_fireDOMEvent(e,o,i){"click"===o&&this._fireDOMEvent(e,"preclick",i);let s=this._findEventTargets(e,o);if(i){s=i.filter(t=>t.listens(o,!0)).concat(s)}if(!s.length)return;"contextmenu"===o&&ue(e);const n=s[0],r={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){const t=n.getLatLng&&(!n._radius||n._radius<=10);r.containerPoint=t?this.latLngToContainerPoint(n.getLatLng()):this.pointerEventToContainerPoint(e),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=t?n.getLatLng():this.layerPointToLatLng(r.layerPoint)}for(const e of s)if(e.fire(o,r,!0),r.originalEvent._stopped||!1===e.options.bubblingPointerEvents&&t._pointerEvents.includes(o))return}_draggableMoved(t){return t=t.dragging?.enabled()?t:this,t.dragging?.moved()||this.boxZoom?.moved()}_clearHandlers(){for(const t of this._handlers)t.disable()}whenReady(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this}_getMapPanePos(){return jt(this._mapPane)}_moved(){const t=this._getMapPanePos();return t&&!t.equals([0,0])}_getTopLeftPoint(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())}_getNewPixelOrigin(t,e){const o=this.getSize()._divideBy(2);return this.project(t,e)._subtract(o)._add(this._getMapPanePos())._round()}_latLngToNewLayerPoint(t,e,o){const i=this._getNewPixelOrigin(o,e);return this.project(t,e)._subtract(i)}_latLngBoundsToNewLayerBounds(t,e,o){const i=this._getNewPixelOrigin(o,e);return new dt([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])}_getCenterLayerPoint(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))}_getCenterOffset(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())}_limitCenter(t,e,o){if(!o)return t;const i=this.project(t,e),s=this.getSize().divideBy(2),n=new dt(i.subtract(s),i.add(s)),r=this._getBoundsOffset(n,o,e);return Math.abs(r.x)<=1&&Math.abs(r.y)<=1?t:this.unproject(i.add(r),e)}_limitOffset(t,e){if(!e)return t;const o=this.getPixelBounds(),i=new dt(o.min.add(t),o.max.add(t));return t.add(this._getBoundsOffset(i,e))}_getBoundsOffset(t,e,o){const i=new dt(this.project(e.getNorthEast(),o),this.project(e.getSouthWest(),o)),s=i.min.subtract(t.min),n=i.max.subtract(t.max),r=this._rebound(s.x,-n.x),a=this._rebound(s.y,-n.y);return new ht(r,a)}_rebound(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))}_limitZoom(t){const e=this.getMinZoom(),o=this.getMaxZoom(),i=this.options.zoomSnap;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(o,t))}_onPanTransitionStep(){this.fire("move")}_onPanTransitionEnd(){this._mapPane.classList.remove("leaflet-pan-anim"),this.fire("moveend")}_tryAnimatedPan(t,e){const o=this._getCenterOffset(t)._trunc();return!(!0!==e?.animate&&!this.getSize().contains(o))&&(this.panBy(o,e),!0)}_createAnimProxy(){this._proxy=Ct("div","leaflet-proxy leaflet-zoom-animated"),this._panes.mapPane.appendChild(this._proxy),this.on("zoomanim",this._animateProxyZoom,this),this.on("load moveend",this._animMoveEnd,this),oe(this._proxy,"transitionend",this._catchTransitionEnd,this)}_animateProxyZoom(t){const e=this._proxy.style.transform;Ot(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),e===this._proxy.style.transform&&this._animatingZoom&&this._onZoomTransitionEnd()}_animMoveEnd(){const t=this.getCenter(),e=this.getZoom();Ot(this._proxy,this.project(t,e),this.getZoomScale(e,1))}_destroyAnimProxy(){this._proxy&&(se(this._proxy,"transitionend",this._catchTransitionEnd,this),this._proxy.remove(),this.off("zoomanim",this._animateProxyZoom,this),this.off("load moveend",this._animMoveEnd,this),delete this._proxy)}_catchTransitionEnd(t){this._animatingZoom&&t.propertyName.includes("transform")&&this._onZoomTransitionEnd()}_nothingToAnimate(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length}_tryAnimatedZoom(t,e,o){if(this._animatingZoom)return!0;if(o??={},!this._zoomAnimated||!1===o.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;const i=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==o.animate&&!this.getSize().contains(s))&&(requestAnimationFrame(()=>{this._moveStart(!0,o.noMoveStart??!1)._animateZoom(t,e,!0)}),!0)}_animateZoom(t,e,o,i){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,this._mapPane.classList.add("leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._transitionEndTimer=setTimeout(this._onZoomTransitionEnd.bind(this),250))}_onZoomTransitionEnd(){this._animatingZoom&&(this._mapPane?.classList.remove("leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}};const Le=be;class Ee extends at{static{this.setDefaultOptions({position:"topright"})}initialize(t){ot(this,t)}getPosition(){return this.options.position}setPosition(t){const e=this._map;return e?.removeControl(this),this.options.position=t,e?.addControl(this),this}getContainer(){return this._container}addTo(t){this.remove(),this._map=t;const e=this._container=this.onAdd(t),o=this.getPosition(),i=t._controlCorners[o];return e.classList.add("leaflet-control"),o.includes("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this}remove(){return this._map?(this._container.remove(),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this}_refocusOnMap(t){this._map&&t&&(0!==t.screenX||0!==t.screenY)&&this._map.getContainer().focus()}}be.include({addControl(t){return t.addTo(this),this},removeControl(t){return t.remove(),this},_initControlPos(){const t=this._controlCorners={},e="leaflet-",o=this._controlContainer=Ct("div",`${e}control-container`,this._container);function i(i,s){const n=`${e+i} ${e}${s}`;t[i+s]=Ct("div",n,o)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos(){for(const t of Object.values(this._controlCorners))t.remove();this._controlContainer.remove(),delete this._controlCorners,delete this._controlContainer}});class we extends Ee{static{this.setDefaultOptions({collapsed:!0,collapseDelay:0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:(t,e,o,i)=>o<i?-1:i<o?1:0})}initialize(t,e,o){ot(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(const[e,o]of Object.entries(t??{}))this._addLayer(o,e);for(const[t,o]of Object.entries(e??{}))this._addLayer(o,t,!0)}onAdd(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(const t of this._layers)t.layer.on("add remove",this._onLayerChange,this);return this.options.collapsed||t.on("resize",this._expandIfNotCollapsed,this),this._container}addTo(t){return Ee.prototype.addTo.call(this,t),this._expandIfNotCollapsed()}onRemove(){this._map.off("zoomend",this._checkDisabledLayers,this);for(const t of this._layers)t.layer.off("add remove",this._onLayerChange,this);this._map.off("resize",this._expandIfNotCollapsed,this)}addBaseLayer(t,e){return this._addLayer(t,e),this._map?this._update():this}addOverlay(t,e){return this._addLayer(t,e,!0),this._map?this._update():this}removeLayer(t){t.off("add remove",this._onLayerChange,this);const e=this._getLayer(q(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this}expand(){clearTimeout(this._collapseDelayTimeout),this._container.classList.add("leaflet-control-layers-expanded"),this._section.style.height=null;const t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(this._section.classList.add("leaflet-control-layers-scrollbar"),this._section.style.height=`${t}px`):this._section.classList.remove("leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this}collapse(t){if(!t||"pointerleave"!==t.type&&"pointerout"!==t.type||"touch"!==t.pointerType){if(this.options.collapseDelay>0)return this._collapseDelayTimeout=setTimeout(()=>{this._container.classList.remove("leaflet-control-layers-expanded")},this.options.collapseDelay),this;this._container.classList.remove("leaflet-control-layers-expanded")}return this}_initLayout(){const t="leaflet-control-layers",e=this._container=Ct("div",t),o=this.options.collapsed;ce(e),de(e);const i=this._section=Ct("fieldset",`${t}-list`);o&&(this._map.on("click",this.collapse,this),oe(e,{pointerenter:this._expandSafely,pointerleave:this.collapse},this));const s=this._layersLink=Ct("a",`${t}-toggle`,e);s.href="#",s.title="Layers",s.setAttribute("role","button"),oe(s,{keydown(t){"Enter"===t.code&&this._expandSafely()},click(t){ue(t),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=Ct("div",`${t}-base`,i),this._separator=Ct("div",`${t}-separator`,i),this._overlaysList=Ct("div",`${t}-overlays`,i),e.appendChild(i)}_getLayer(t){for(const e of this._layers)if(e&&q(e.layer)===t)return e}_addLayer(t,e,o){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:o}),this.options.sortLayers&&this._layers.sort((t,e)=>this.options.sortFunction(t.layer,e.layer,t.name,e.name)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()}_update(){if(!this._container)return this;this._baseLayersList.replaceChildren(),this._overlaysList.replaceChildren(),this._layerControlInputs=[];let t,e,o=0;for(const i of this._layers)this._addItem(i),e||=i.overlay,t||=!i.overlay,o+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&o>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this}_onLayerChange(t){this._handlingClick||this._update();const e=this._getLayer(q(t.target)),o=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;o&&this._map.fire(o,e)}_addItem(t){const e=document.createElement("label"),o=this._map.hasLayer(t.layer),i=document.createElement("input");i.type=t.overlay?"checkbox":"radio",i.className="leaflet-control-layers-selector",i.defaultChecked=o,t.overlay||(i.name=`leaflet-base-layers_${q(this)}`),this._layerControlInputs.push(i),i.layerId=q(t.layer),oe(i,"click",this._onInputClick,this);const s=document.createElement("span");s.innerHTML=` ${t.name}`;const n=document.createElement("span");e.appendChild(n),n.appendChild(i),n.appendChild(s);return(t.overlay?this._overlaysList:this._baseLayersList).appendChild(e),this._checkDisabledLayers(),e}_onInputClick(t){if(this._preventClick)return;const e=this._layerControlInputs,o=[],i=[];this._handlingClick=!0;for(const t of e){const e=this._getLayer(t.layerId).layer;t.checked?o.push(e):t.checked||i.push(e)}for(const t of i)this._map.hasLayer(t)&&this._map.removeLayer(t);for(const t of o)this._map.hasLayer(t)||this._map.addLayer(t);this._handlingClick=!1,this._refocusOnMap(t)}_checkDisabledLayers(){const t=this._layerControlInputs,e=this._map.getZoom();for(const o of t){const t=this._getLayer(o.layerId).layer;o.disabled=void 0!==t.options.minZoom&&e<t.options.minZoom||void 0!==t.options.maxZoom&&e>t.options.maxZoom}}_expandIfNotCollapsed(){return this._map&&!this.options.collapsed&&this.expand(),this}_expandSafely(){const t=this._section;this._preventClick=!0,oe(t,"click",ue),this.expand(),setTimeout(()=>{se(t,"click",ue),this._preventClick=!1})}}class Me extends Ee{static{this.setDefaultOptions({position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"})}onAdd(t){const e="leaflet-control-zoom",o=Ct("div",`${e} leaflet-bar`),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,`${e}-in`,o,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,`${e}-out`,o,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),o}onRemove(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)}disable(){return this._disabled=!0,this._updateDisabled(),this}enable(){return this._disabled=!1,this._updateDisabled(),this}_zoomIn(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))}_zoomOut(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))}_createButton(t,e,o,i,s){const n=Ct("a",o,i);return n.innerHTML=t,n.href="#",n.title=e,n.setAttribute("role","button"),n.setAttribute("aria-label",e),ce(n),oe(n,"click",me),oe(n,"click",s,this),oe(n,"click",this._refocusOnMap,this),n}_updateDisabled(){const t=this._map,e="leaflet-disabled";this._zoomInButton.classList.remove(e),this._zoomOutButton.classList.remove(e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(this._zoomOutButton.classList.add(e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(this._zoomInButton.classList.add(e),this._zoomInButton.setAttribute("aria-disabled","true"))}}be.mergeOptions({zoomControl:!0}),be.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Me,this.addControl(this.zoomControl))});class xe extends Ee{static{this.setDefaultOptions({position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1})}onAdd(t){const e="leaflet-control-scale",o=Ct("div",e),i=this.options;return this._addScales(i,`${e}-line`,o),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),o}onRemove(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)}_addScales(t,e,o){t.metric&&(this._mScale=Ct("div",e,o)),t.imperial&&(this._iScale=Ct("div",e,o))}_update(){const t=this._map,e=t.getSize().y/2,o=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(o)}_updateScales(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)}_updateMetric(t){const e=this._getRoundNum(t),o=e<1e3?`${e} m`:e/1e3+" km";this._updateScale(this._mScale,o,e/t)}_updateImperial(t){const e=3.2808399*t;let o,i,s;e>5280?(o=e/5280,i=this._getRoundNum(o),this._updateScale(this._iScale,`${i} mi`,i/o)):(s=this._getRoundNum(e),this._updateScale(this._iScale,`${s} ft`,s/e))}_updateScale(t,e,o){t.style.width=`${Math.round(this.options.maxWidth*o)}px`,t.innerHTML=e}_getRoundNum(t){const e=10**(`${Math.floor(t)}`.length-1);let o=t/e;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,e*o}}class Ie extends Ee{static{this.setDefaultOptions({position:"bottomright",prefix:'<a target="_blank" href="https://leafletjs.com" title="A JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>Leaflet</a>'})}initialize(t){ot(this,t),this._attributions={}}onAdd(t){t.attributionControl=this,this._container=Ct("div","leaflet-control-attribution"),ce(this._container);for(const e of Object.values(t._layers))e.getAttribution&&this.addAttribution(e.getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container}onRemove(t){t.off("layeradd",this._addAttribution,this)}_addAttribution(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",()=>this.removeAttribution(t.layer.getAttribution())))}setPrefix(t){return this.options.prefix=t,this._update(),this}addAttribution(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this}removeAttribution(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this}_update(){if(!this._map)return;const t=Object.keys(this._attributions).filter(t=>this._attributions[t]),e=[];this.options.prefix&&e.push(this.options.prefix),t.length&&e.push(t.join(", ")),this._container.innerHTML=e.join(' <span aria-hidden="true">|</span> ')}}be.mergeOptions({attributionControl:!0}),be.addInitHook(function(){this.options.attributionControl&&(new Ie).addTo(this)}),Ee.Layers=we,Ee.Zoom=Me,Ee.Scale=xe,Ee.Attribution=Ie;class Ce extends at{initialize(t){this._map=t}enable(){return this._enabled||(this._enabled=!0,this.addHooks()),this}disable(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this}enabled(){return!!this._enabled}}Ce.addTo=function(t,e){return t.addHandler(e,this),this};class Ne extends lt{static{this.setDefaultOptions({clickTolerance:3})}initialize(t,e,o,i){ot(this,i),this._element=t,this._dragStartTarget=e??t,this._preventOutline=o}enable(){this._enabled||(oe(this._dragStartTarget,"pointerdown",this._onDown,this),this._enabled=!0)}disable(){this._enabled&&(Ne._dragging===this&&this.finishDrag(!0),se(this._dragStartTarget,"pointerdown",this._onDown,this),this._enabled=!1,this._moved=!1)}_onDown(t){if(this._moved=!1,this._element.classList.contains("leaflet-zoom-anim"))return;if(1!==ee().length)return void(Ne._dragging===this&&this.finishDrag());if(Ne._dragging||t.shiftKey||0!==t.button&&"touch"!==t.pointerType)return;if(Ne._dragging=this,this._preventOutline&&Ut(this._element),Zt(),zt(),this._moving)return;this.fire("down");const e=Vt(this._element);this._startPoint=new ht(t.clientX,t.clientY),this._startPos=jt(this._element),this._parentScale=Xt(e),oe(document,"pointermove",this._onMove,this),oe(document,"pointerup pointercancel",this._onUp,this)}_onMove(t){if(ee().length>1)return void(this._moved=!0);const e=new ht(t.clientX,t.clientY)._subtract(this._startPoint);(e.x||e.y)&&(Math.abs(e.x)+Math.abs(e.y)<this.options.clickTolerance||(e.x/=this._parentScale.x,e.y/=this._parentScale.y,t.cancelable&&ue(t),this._moved||(this.fire("dragstart"),this._moved=!0,document.body.classList.add("leaflet-dragging"),this._lastTarget=t.target??t.srcElement,this._lastTarget.classList.add("leaflet-drag-target")),this._newPos=this._startPos.add(e),this._moving=!0,this._lastEvent=t,this._updatePosition()))}_updatePosition(){const t={originalEvent:this._lastEvent};this.fire("predrag",t),St(this._element,this._newPos),this.fire("drag",t)}_onUp(){this.finishDrag()}finishDrag(t){document.body.classList.remove("leaflet-dragging"),this._lastTarget&&(this._lastTarget.classList.remove("leaflet-drag-target"),this._lastTarget=null),se(document,"pointermove",this._onMove,this),se(document,"pointerup pointercancel",this._onUp,this),Kt(),Ft();const e=this._moved&&this._moving;this._moving=!1,Ne._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}}function Pe(t,e,o){let i,s,n,r,a,l,h,d,c;const u=[1,4,2,8];for(s=0,h=t.length;s<h;s++)t[s]._code=ze(t[s],e);for(r=0;r<4;r++){for(d=u[r],i=[],s=0,h=t.length,n=h-1;s<h;n=s++)a=t[s],l=t[n],a._code&d?l._code&d||(c=Be(l,a,d,e,o),c._code=ze(c,e),i.push(c)):(l._code&d&&(c=Be(l,a,d,e,o),c._code=ze(c,e),i.push(c)),i.push(a));t=i}return t}function Oe(t,e){let o,i,s,n,r,a,l,h,d;if(!t||0===t.length)throw new Error("latlngs not passed");Ke(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);let c=new ut([0,0]);const u=new ct(t);u.getNorthWest().distanceTo(u.getSouthWest())*u.getNorthEast().distanceTo(u.getNorthWest())<1700&&(c=De(t));const m=t.length,p=[];for(o=0;o<m;o++){const i=new ut(t[o]);p.push(e.project(new ut([i.lat-c.lat,i.lng-c.lng])))}for(a=l=h=0,o=0,i=m-1;o<m;i=o++)s=p[o],n=p[i],r=s.y*n.x-n.y*s.x,l+=(s.x+n.x)*r,h+=(s.y+n.y)*r,a+=3*r;d=0===a?p[0]:[l/a,h/a];const g=e.unproject(new ht(d));return new ut([g.lat+c.lat,g.lng+c.lng])}function De(t){let e=0,o=0,i=0;for(const s of t){const t=new ut(s);e+=t.lat,o+=t.lng,i++}return new ut([e/i,o/i])}var Se={__proto__:null,centroid:De,clipPolygon:Pe,polygonCenter:Oe};function je(t,e){if(!e||!t.length)return t.slice();const o=e*e;return t=function(t,e){const o=[t[0]];let i=0;for(let s=1;s<t.length;s++)Fe(t[s],t[i])>e&&(o.push(t[s]),i=s);i<t.length-1&&o.push(t[t.length-1]);return o}(t,o),t=function(t,e){const o=t.length,i=new Uint8Array(o);let s;i[0]=i[o-1]=1,Re(t,i,e,0,o-1);const n=[];for(s=0;s<o;s++)i[s]&&n.push(t[s]);return n}(t,o),t}function Ae(t,e,o){return Math.sqrt(Ze(t,e,o,!0))}function Re(t,e,o,i,s){let n,r,a,l=0;for(r=i+1;r<=s-1;r++)a=Ze(t[r],t[i],t[s],!0),a>l&&(n=r,l=a);l>o&&(e[n]=1,Re(t,e,o,i,n),Re(t,e,o,n,s))}let He;function ke(t,e,o,i,s){let n,r,a,l=i?He:ze(t,o),h=ze(e,o);for(He=h;;){if(!(l|h))return[t,e];if(l&h)return!1;n=l||h,r=Be(t,e,n,o,s),a=ze(r,o),n===l?(t=r,l=a):(e=r,h=a)}}function Be(t,e,o,i,s){const n=e.x-t.x,r=e.y-t.y,a=i.min,l=i.max;let h,d;return 8&o?(h=t.x+n*(l.y-t.y)/r,d=l.y):4&o?(h=t.x+n*(a.y-t.y)/r,d=a.y):2&o?(h=l.x,d=t.y+r*(l.x-t.x)/n):1&o&&(h=a.x,d=t.y+r*(a.x-t.x)/n),new ht(h,d,s)}function ze(t,e){let o=0;return t.x<e.min.x?o|=1:t.x>e.max.x&&(o|=2),t.y<e.min.y?o|=4:t.y>e.max.y&&(o|=8),o}function Fe(t,e){const o=e.x-t.x,i=e.y-t.y;return o*o+i*i}function Ze(t,e,o,i){let s,n=e.x,r=e.y,a=o.x-n,l=o.y-r;const h=a*a+l*l;return h>0&&(s=((t.x-n)*a+(t.y-r)*l)/h,s>1?(n=o.x,r=o.y):s>0&&(n+=a*s,r+=l*s)),a=t.x-n,l=t.y-r,i?a*a+l*l:new ht(n,r)}function Ke(t){return!Array.isArray(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function Ue(t,e){let o,i,s,n,r,a,l,h;if(!t||0===t.length)throw new Error("latlngs not passed");Ke(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);let d=new ut([0,0]);const c=new ct(t);c.getNorthWest().distanceTo(c.getSouthWest())*c.getNorthEast().distanceTo(c.getNorthWest())<1700&&(d=De(t));const u=t.length,m=[];for(o=0;o<u;o++){const i=new ut(t[o]);m.push(e.project(new ut([i.lat-d.lat,i.lng-d.lng])))}for(o=0,i=0;o<u-1;o++)i+=m[o].distanceTo(m[o+1])/2;if(0===i)h=m[0];else for(o=0,n=0;o<u-1;o++)if(r=m[o],a=m[o+1],s=r.distanceTo(a),n+=s,n>i){l=(n-i)/s,h=[a.x-l*(a.x-r.x),a.y-l*(a.y-r.y)];break}const p=e.unproject(new ht(h));return new ut([p.lat+d.lat,p.lng+d.lng])}var We={__proto__:null,_getBitCode:ze,_getEdgeIntersection:Be,_sqClosestPointOnSegment:Ze,clipSegment:ke,closestPointOnSegment:function(t,e,o){return Ze(t,e,o)},isFlat:Ke,pointToSegmentDistance:Ae,polylineCenter:Ue,simplify:je};const Ve={project:t=>(t=new ut(t),new ht(t.lng,t.lat)),unproject:t=>(t=new ht(t),new ut(t.y,t.x)),bounds:new dt([-180,-90],[180,90])},Xe={R:6378137,R_MINOR:6356752.314245179,bounds:new dt([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project(t){t=new ut(t);const e=Math.PI/180,o=this.R,i=this.R_MINOR/o,s=Math.sqrt(1-i*i);let n=t.lat*e;const r=s*Math.sin(n),a=Math.tan(Math.PI/4-n/2)/((1-r)/(1+r))**(s/2);return n=-o*Math.log(Math.max(a,1e-10)),new ht(t.lng*e*o,n)},unproject(t){t=new ht(t);const e=180/Math.PI,o=this.R,i=this.R_MINOR/o,s=Math.sqrt(1-i*i),n=Math.exp(-t.y/o);let r=Math.PI/2-2*Math.atan(n);for(let t,e=0,o=.1;e<15&&Math.abs(o)>1e-7;e++)t=s*Math.sin(r),t=((1-t)/(1+t))**(s/2),o=Math.PI/2-2*Math.atan(n*t)-r,r+=o;return new ut(r*e,t.x*e/o)}};var Ye={__proto__:null,LonLat:Ve,Mercator:Xe,SphericalMercator:vt};class Ge extends pt{static code="EPSG:3395";static projection=Xe;static transformation=(()=>{const t=.5/(Math.PI*Xe.R);return new ft(t,.5,-t,.5)})()}class qe extends pt{static code="EPSG:4326";static projection=Ve;static transformation=new ft(1/180,1,-1/180,.5)}class $e extends mt{static projection=Ve;static transformation=new ft(1,0,-1,0);static scale(t){return 2**t}static zoom(t){return Math.log(t)/Math.LN2}static distance(t,e){const o=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(o*o+i*i)}static infinite=!0}mt.Earth=pt,mt.EPSG3395=Ge,mt.EPSG3857=yt,mt.EPSG900913=class extends yt{static code="EPSG:900913"},mt.EPSG4326=qe,mt.Simple=$e;class Je extends lt{static{this.setDefaultOptions({pane:"overlayPane",attribution:null,bubblingPointerEvents:!0})}addTo(t){return t.addLayer(this),this}remove(){return this.removeFrom(this._map||this._mapToAdd)}removeFrom(t){return t?.removeLayer(this),this}getPane(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)}addInteractiveTarget(t){return this._map._targets[q(t)]=this,this}removeInteractiveTarget(t){return delete this._map._targets[q(t)],this}getAttribution(){return this.options.attribution}_layerAdd(t){const e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){const t=this.getEvents();e.on(t,this),this.once("remove",()=>e.off(t,this))}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}}be.include({addLayer(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");const e=q(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer(t){const e=q(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer(t){return q(t)in this._layers},eachLayer(t,e){for(const o of Object.values(this._layers))t.call(e,o);return this},_addLayers(t){t=t?Array.isArray(t)?t:[t]:[];for(const e of t)this.addLayer(e)},_addZoomLimit(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[q(t)]=t,this._updateZoomLevels())},_removeZoomLimit(t){const e=q(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels(){let t=1/0,e=-1/0;const o=this._getZoomSpan();for(const o of Object.values(this._zoomBoundLayers)){const i=o.options;t=Math.min(t,i.minZoom??1/0),e=Math.max(e,i.maxZoom??-1/0)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});class Qe extends Je{initialize(t,e){ot(this,e),this._layers={};for(const e of t??[])this.addLayer(e)}addLayer(t){const e=this.getLayerId(t);return this._layers[e]=t,this._map?.addLayer(t),this}removeLayer(t){const e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this}hasLayer(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers}clearLayers(){return this.eachLayer(this.removeLayer,this)}invoke(t,...e){for(const o of Object.values(this._layers))o[t]?.apply(o,e);return this}onAdd(t){this.eachLayer(t.addLayer,t)}onRemove(t){this.eachLayer(t.removeLayer,t)}eachLayer(t,e){for(const o of Object.values(this._layers))t.call(e,o);return this}getLayer(t){return this._layers[t]}getLayers(){const t=[];return this.eachLayer(t.push,t),t}setZIndex(t){return this.invoke("setZIndex",t)}getLayerId(t){return q(t)}}class to extends Qe{addLayer(t){return this.hasLayer(t)?this:(t.addEventParent(this),Qe.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))}removeLayer(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Qe.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this}setStyle(t){return this.invoke("setStyle",t)}bringToFront(){return this.invoke("bringToFront")}bringToBack(){return this.invoke("bringToBack")}getBounds(){const t=new ct;for(const e of Object.values(this._layers))t.extend(e.getBounds?e.getBounds():e.getLatLng());return t}}class eo extends at{static{this.setDefaultOptions({popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1})}initialize(t){ot(this,t)}createIcon(t){return this._createIcon("icon",t)}createShadow(t){return this._createIcon("shadow",t)}_createIcon(t,e){const o=this._getIconUrl(t);if(!o){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}const i=this._createImg(o,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i}_setIconStyles(t,e){const o=this.options;let i=o[`${e}Size`];"number"==typeof i&&(i=[i,i]);const s=ht.validate(i)&&new ht(i),n="shadow"===e&&o.shadowAnchor||o.iconAnchor||s&&s.divideBy(2,!0),r=ht.validate(n)&&new ht(n);t.className=`leaflet-marker-${e} ${o.className||""}`,r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&&(t.style.width=`${s.x}px`,t.style.height=`${s.y}px`)}_createImg(t,e){return e??=document.createElement("img"),e.src=t,e}_getIconUrl(t){return Mt.retina&&this.options[`${t}RetinaUrl`]||this.options[`${t}Url`]}}class oo extends eo{static{this.setDefaultOptions({iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]})}_getIconUrl(t){oo.imagePath||(oo.imagePath=this._detectIconPath());const e=eo.prototype._getIconUrl.call(this,t);return e?(this.options.imagePath||oo.imagePath)+e:null}_stripUrl(t){const e=function(t,e,o){const i=e.exec(t);return i&&i[o]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)}_detectIconPath(){const t=Ct("div","leaflet-default-icon-path",document.body),e=this._stripUrl(getComputedStyle(t).backgroundImage);if(document.body.removeChild(t),e)return e;const o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}class io extends Ce{initialize(t){this._marker=t}addHooks(){const t=this._marker._icon;this._draggable||(this._draggable=new Ne(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),t.classList.add("leaflet-marker-draggable")}removeHooks(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon?.classList.remove("leaflet-marker-draggable")}moved(){return this._draggable?._moved}_adjustPan(t){const e=this._marker,o=e._map,i=this._marker.options.autoPanSpeed,s=this._marker.options.autoPanPadding,n=jt(e._icon),r=o.getPixelBounds(),a=o.getPixelOrigin(),l=new dt(r.min._subtract(a).add(s),r.max._subtract(a).subtract(s));if(!l.contains(n)){const s=new ht((Math.max(l.max.x,n.x)-l.max.x)/(r.max.x-l.max.x)-(Math.min(l.min.x,n.x)-l.min.x)/(r.min.x-l.min.x),(Math.max(l.max.y,n.y)-l.max.y)/(r.max.y-l.max.y)-(Math.min(l.min.y,n.y)-l.min.y)/(r.min.y-l.min.y)).multiplyBy(i);o.panBy(s,{animate:!1}),this._draggable._newPos._add(s),this._draggable._startPos._add(s),St(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=requestAnimationFrame(this._adjustPan.bind(this,t))}}_onDragStart(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup?.(),this._marker.fire("movestart").fire("dragstart")}_onPreDrag(t){this._marker.options.autoPan&&(cancelAnimationFrame(this._panRequest),this._panRequest=requestAnimationFrame(this._adjustPan.bind(this,t)))}_onDrag(t){const e=this._marker,o=e._shadow,i=jt(e._icon),s=e._map.layerPointToLatLng(i);o&&St(o,i),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)}_onDragEnd(t){cancelAnimationFrame(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}class so extends Je{static{this.setDefaultOptions({icon:new oo,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingPointerEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10})}initialize(t,e){ot(this,e),this._latlng=new ut(t)}onAdd(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()}onRemove(t){this.dragging?.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()}getEvents(){return{zoom:this.update,viewreset:this.update}}getLatLng(){return this._latlng}setLatLng(t){const e=this._latlng;return this._latlng=new ut(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})}setZIndexOffset(t){return this.options.zIndexOffset=t,this.update()}getIcon(){return this.options.icon}setIcon(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this}getElement(){return this._icon}update(){if(this._icon&&this._map){const t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this}_initIcon(){const t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=t.icon.createIcon(this._icon);let i=!1;o!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(o.title=t.title),"IMG"===o.tagName&&(o.alt=t.alt??"")),o.classList.add(e),t.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,t.riseOnHover&&this.on({pointerover:this._bringToFront,pointerout:this._resetZIndex}),this.options.autoPanOnFocus&&oe(o,"focus",this._panOnFocus,this);const s=t.icon.createShadow(this._shadow);let n=!1;s!==this._shadow&&(this._removeShadow(),n=!0),s&&(s.classList.add(e),s.alt=""),this._shadow=s,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&n&&this.getPane(t.shadowPane).appendChild(this._shadow)}_removeIcon(){this.options.riseOnHover&&this.off({pointerover:this._bringToFront,pointerout:this._resetZIndex}),this.options.autoPanOnFocus&&se(this._icon,"focus",this._panOnFocus,this),this._icon.remove(),this.removeInteractiveTarget(this._icon),this._icon=null}_removeShadow(){this._shadow?.remove(),this._shadow=null}_setPos(t){this._icon&&St(this._icon,t),this._shadow&&St(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()}_updateZIndex(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)}_animateZoom(t){const e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)}_initInteraction(){if(this.options.interactive&&(this._icon.classList.add("leaflet-interactive"),this.addInteractiveTarget(this._icon),io)){let t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new io(this),t&&this.dragging.enable()}}setOpacity(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this}_updateOpacity(){const t=this.options.opacity;this._icon&&(this._icon.style.opacity=t),this._shadow&&(this._shadow.style.opacity=t)}_bringToFront(){this._updateZIndex(this.options.riseOffset)}_resetZIndex(){this._updateZIndex(0)}_panOnFocus(){const t=this._map;if(!t)return;const e=this.options.icon.options,o=e.iconSize?new ht(e.iconSize):new ht(0,0),i=e.iconAnchor?new ht(e.iconAnchor):new ht(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:o.subtract(i)})}_getPopupAnchor(){return this.options.icon.options.popupAnchor}_getTooltipAnchor(){return this.options.icon.options.tooltipAnchor}}class no extends Je{static{this.setDefaultOptions({stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingPointerEvents:!0})}beforeAdd(t){this._renderer=t.getRenderer(this)}onAdd(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)}onRemove(){this._renderer._removePath(this)}redraw(){return this._map&&this._renderer._updatePath(this),this}setStyle(t){return ot(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.hasOwn(t,"weight")&&this._updateBounds()),this}bringToFront(){return this._renderer?._bringToFront(this),this}bringToBack(){return this._renderer?._bringToBack(this),this}getElement(){return this._path}_reset(){this._project(),this._update()}_clickTolerance(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}class ro extends no{static{this.setDefaultOptions({fill:!0,radius:10})}initialize(t,e){ot(this,e),this._latlng=new ut(t),this._radius=this.options.radius}setLatLng(t){const e=this._latlng;return this._latlng=new ut(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})}getLatLng(){return this._latlng}setRadius(t){return this.options.radius=this._radius=t,this.redraw()}getRadius(){return this._radius}setStyle(t){const e=t?.radius??this._radius;return no.prototype.setStyle.call(this,t),this.setRadius(e),this}_project(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()}_updateBounds(){const t=this._radius,e=this._radiusY??t,o=this._clickTolerance(),i=[t+o,e+o];this._pxBounds=new dt(this._point.subtract(i),this._point.add(i))}_update(){this._map&&this._updatePath()}_updatePath(){this._renderer._updateCircle(this)}_empty(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}_containsPoint(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}class ao extends ro{initialize(t,e){if(ot(this,e),this._latlng=new ut(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius}setRadius(t){return this._mRadius=t,this.redraw()}getRadius(){return this._mRadius}getBounds(){const t=[this._radius,this._radiusY??this._radius];return new ct(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))}setStyle=no.prototype.setStyle;_project(){const t=this._latlng.lng,e=this._latlng.lat,o=this._map,i=o.options.crs;if(i.distance===pt.distance){const i=Math.PI/180,s=this._mRadius/pt.R/i,n=o.project([e+s,t]),r=o.project([e-s,t]),a=n.add(r).divideBy(2),l=o.unproject(a).lat;let h=Math.acos((Math.cos(s*i)-Math.sin(e*i)*Math.sin(l*i))/(Math.cos(e*i)*Math.cos(l*i)))/i;(isNaN(h)||0===h)&&(h=s/Math.cos(Math.PI/180*e)),this._point=a.subtract(o.getPixelOrigin()),this._radius=isNaN(h)?0:a.x-o.project([l,t-h]).x,this._radiusY=a.y-n.y}else{const t=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=Math.abs(this._point.x-o.latLngToLayerPoint(t).x)}this._updateBounds()}}class lo extends no{static{this.setDefaultOptions({smoothFactor:1,noClip:!1})}initialize(t,e){ot(this,e),this._setLatLngs(t)}getLatLngs(){return this._latlngs}setLatLngs(t){return this._setLatLngs(t),this.redraw()}isEmpty(){return!this._latlngs.length}closestLayerPoint(t){t=new ht(t);let e,o,i=1/0,s=null;const n=Ze;for(const r of this._parts)for(let a=1,l=r.length;a<l;a++){e=r[a-1],o=r[a];const l=n(t,e,o,!0);l<i&&(i=l,s=n(t,e,o))}return s&&(s.distance=Math.sqrt(i)),s}getCenter(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ue(this._defaultShape(),this._map.options.crs)}getBounds(){return this._bounds}addLatLng(t,e){return e??=this._defaultShape(),t=new ut(t),e.push(t),this._bounds.extend(t),this.redraw()}_setLatLngs(t){this._bounds=new ct,this._latlngs=this._convertLatLngs(t)}_defaultShape(){return Ke(this._latlngs)?this._latlngs:this._latlngs[0]}_convertLatLngs(t){const e=[],o=Ke(t);for(let i=0,s=t.length;i<s;i++)o?(e[i]=new ut(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e}_project(){const t=new dt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())}_updateBounds(){const t=this._clickTolerance(),e=new ht(t,t);this._rawPxBounds&&(this._pxBounds=new dt([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))}_projectLatlngs(t,e,o){if(t[0]instanceof ut){const i=t.map(t=>this._map.latLngToLayerPoint(t));i.forEach(t=>o.extend(t)),e.push(i)}else t.forEach(t=>this._projectLatlngs(t,e,o))}_clipPoints(){const t=this._renderer._bounds;if(this._parts=[],!this._pxBounds||!this._pxBounds.intersects(t))return;if(this.options.noClip)return void(this._parts=this._rings);const e=this._parts;let o,i,s,n,r,a,l;for(o=0,s=0,n=this._rings.length;o<n;o++)for(l=this._rings[o],i=0,r=l.length;i<r-1;i++)a=ke(l[i],l[i+1],t,i,!0),a&&(e[s]??=[],e[s].push(a[0]),a[1]===l[i+1]&&i!==r-2||(e[s].push(a[1]),s++))}_simplifyPoints(){const t=this._parts,e=this.options.smoothFactor;for(let o=0,i=t.length;o<i;o++)t[o]=je(t[o],e)}_update(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())}_updatePath(){this._renderer._updatePoly(this)}_containsPoint(t,e){let o,i,s,n,r,a;const l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,n=this._parts.length;o<n;o++)for(a=this._parts[o],i=0,r=a.length,s=r-1;i<r;s=i++)if((e||0!==i)&&Ae(t,a[s],a[i])<=l)return!0;return!1}}class ho extends lo{static{this.setDefaultOptions({fill:!0})}isEmpty(){return!this._latlngs.length||!this._latlngs[0].length}getCenter(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Oe(this._defaultShape(),this._map.options.crs)}_convertLatLngs(t){const e=lo.prototype._convertLatLngs.call(this,t),o=e.length;return o>=2&&e[0]instanceof ut&&e[0].equals(e[o-1])&&e.pop(),e}_setLatLngs(t){lo.prototype._setLatLngs.call(this,t),Ke(this._latlngs)&&(this._latlngs=[this._latlngs])}_defaultShape(){return Ke(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]}_clipPoints(){let t=this._renderer._bounds;const e=this.options.weight,o=new ht(e,e);if(t=new dt(t.min.subtract(o),t.max.add(o)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(const e of this._rings){const o=Pe(e,t,!0);o.length&&this._parts.push(o)}}_updatePath(){this._renderer._updatePoly(this,!0)}_containsPoint(t){let e,o,i,s,n,r,a,l,h=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(s=0,a=this._parts.length;s<a;s++)for(e=this._parts[s],n=0,l=e.length,r=l-1;n<l;r=n++)o=e[n],i=e[r],o.y>t.y!=i.y>t.y&&t.x<(i.x-o.x)*(t.y-o.y)/(i.y-o.y)+o.x&&(h=!h);return h||lo.prototype._containsPoint.call(this,t,!0)}}class co extends to{initialize(t,e){ot(this,e),this._layers={},t&&this.addData(t)}addData(t){const e=Array.isArray(t)?t:t.features;if(e){for(const t of e)(t.geometries||t.geometry||t.features||t.coordinates)&&this.addData(t);return this}const o=this.options;if(o.filter&&!o.filter(t))return this;const i=uo(t,o);return i?(i.feature=_o(t),i.defaultOptions=i.options,this.resetStyle(i),o.onEachFeature&&o.onEachFeature(t,i),this.addLayer(i)):this}resetStyle(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=Object.create(t.defaultOptions),this._setLayerStyle(t,this.options.style),this)}setStyle(t){return this.eachLayer(e=>this._setLayerStyle(e,t))}_setLayerStyle(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}}function uo(t,e){const o="Feature"===t.type?t.geometry:t,i=o?.coordinates,s=[],n=e?.pointToLayer,r=e?.coordsToLatLng??po;let a,l;if(!i&&!o)return null;switch(o.type){case"Point":return a=r(i),mo(n,t,a,e);case"MultiPoint":for(const o of i)a=r(o),s.push(mo(n,t,a,e));return new to(s);case"LineString":case"MultiLineString":return l=go(i,"LineString"===o.type?0:1,r),new lo(l,e);case"Polygon":case"MultiPolygon":return l=go(i,"Polygon"===o.type?1:2,r),new ho(l,e);case"GeometryCollection":for(const i of o.geometries){const o=uo({geometry:i,type:"Feature",properties:t.properties},e);o&&s.push(o)}return new to(s);case"FeatureCollection":for(const t of o.features){const o=uo(t,e);o&&s.push(o)}return new to(s);default:throw new Error("Invalid GeoJSON object.")}}function mo(t,e,o,i){return t?t(e,o):new so(o,i?.markersInheritOptions&&i)}function po(t){return new ut(t[1],t[0],t[2])}function go(t,e,o){return t.map(t=>e?go(t,e-1,o):(o||po)(t))}function vo(t,e){return void 0!==(t=new ut(t)).alt?[tt(t.lng,e),tt(t.lat,e),tt(t.alt,e)]:[tt(t.lng,e),tt(t.lat,e)]}function fo(t,e,o,i){const s=t.map(t=>e?fo(t,Ke(t)?0:e-1,o,i):vo(t,i));return!e&&o&&s.length>0&&s.push(s[0].slice()),s}function yo(t,e){return t.feature?{...t.feature,geometry:e}:_o(e)}function _o(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}const To={toGeoJSON(t){return yo(this,{type:"Point",coordinates:vo(this.getLatLng(),t)})}};so.include(To),ao.include(To),ro.include(To),lo.include({toGeoJSON(t){const e=!Ke(this._latlngs);return yo(this,{type:(e?"Multi":"")+"LineString",coordinates:fo(this._latlngs,e?1:0,!1,t)})}}),ho.include({toGeoJSON(t){const e=!Ke(this._latlngs),o=e&&!Ke(this._latlngs[0]);let i=fo(this._latlngs,o?2:e?1:0,!0,t);return e||(i=[i]),yo(this,{type:(o?"Multi":"")+"Polygon",coordinates:i})}}),Qe.include({toMultiPoint(t){const e=[];return this.eachLayer(o=>{e.push(o.toGeoJSON(t).geometry.coordinates)}),yo(this,{type:"MultiPoint",coordinates:e})},toGeoJSON(t){const e=this.feature?.geometry?.type;if("MultiPoint"===e)return this.toMultiPoint(t);const o="GeometryCollection"===e,i=[];return this.eachLayer(e=>{if(e.toGeoJSON){const s=e.toGeoJSON(t);if(o)i.push(s.geometry);else{const t=_o(s);"FeatureCollection"===t.type?i.push.apply(i,t.features):i.push(t)}}}),o?yo(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});class bo extends Je{static{this.setDefaultOptions({padding:.1,continuous:!1})}initialize(t){ot(this,t)}onAdd(){this._container||(this._initContainer(),this._container.classList.add("leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._resizeContainer(),this._onMoveEnd()}onRemove(){this._destroyContainer()}getEvents(){const t={viewreset:this._reset,zoom:this._onZoom,moveend:this._onMoveEnd,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),this.options.continuous&&(t.move=this._onMoveEnd),t}_onAnimZoom(t){this._updateTransform(t.center,t.zoom)}_onZoom(){this._updateTransform(this._map.getCenter(),this._map.getZoom())}_updateTransform(t,e){const o=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),n=i.multiplyBy(-o).add(s).subtract(this._map._getNewPixelOrigin(t,e));Ot(this._container,n,o)}_onMoveEnd(t){const e=this.options.padding,o=this._map.getSize(),i=this._map.containerPointToLayerPoint(o.multiplyBy(-e)).round();this._bounds=new dt(i,i.add(o.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._updateTransform(this._center,this._zoom),this._onSettled(t),this._resizeContainer()}_reset(){this._onSettled(),this._updateTransform(this._center,this._zoom),this._onViewReset()}_initContainer(){this._container=Ct("div")}_destroyContainer(){se(this._container),this._container.remove(),delete this._container}_resizeContainer(){const t=this.options.padding,e=this._map.getSize().multiplyBy(1+2*t).round();return this._container.style.width=`${e.x}px`,this._container.style.height=`${e.y}px`,e}_onZoomEnd(){}_onViewReset(){}_onSettled(){}}class Lo extends Je{static{this.setDefaultOptions({opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:"",decoding:"auto"})}initialize(t,e,o){this._url=t,this._bounds=new ct(e),ot(this,o)}onAdd(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(this._image.classList.add("leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()}onRemove(){this._image.remove(),this.options.interactive&&this.removeInteractiveTarget(this._image)}setOpacity(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this}setStyle(t){return t.opacity&&this.setOpacity(t.opacity),this}bringToFront(){return this._map&&Nt(this._image),this}bringToBack(){return this._map&&Pt(this._image),this}setUrl(t){return this._url=t,this._image&&(this._image.src=t),this}setBounds(t){return this._bounds=new ct(t),this._map&&this._reset(),this}getEvents(){const t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t}setZIndex(t){return this.options.zIndex=t,this._updateZIndex(),this}getBounds(){return this._bounds}getElement(){return this._image}_initImage(){const t="IMG"===this._url.tagName,e=this._image=t?this._url:Ct("img");e.classList.add("leaflet-image-layer"),this._zoomAnimated&&e.classList.add("leaflet-zoom-animated"),this.options.className&&e.classList.add(...et(this.options.className)),e.onselectstart=Q,e.onpointermove=Q,e.onload=this.fire.bind(this,"load"),e.onerror=this._overlayOnError.bind(this),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),e.decoding=this.options.decoding,this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)}_animateZoom(t){const e=this._map.getZoomScale(t.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Ot(this._image,o,e)}_reset(){const t=this._image,e=new dt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=e.getSize();St(t,e.min),t.style.width=`${o.x}px`,t.style.height=`${o.y}px`}_updateOpacity(){this._image.style.opacity=this.options.opacity}_updateZIndex(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)}_overlayOnError(){this.fire("error");const t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}getCenter(){return this._bounds.getCenter()}}class Eo extends Lo{static{this.setDefaultOptions({autoplay:!0,controls:!1,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0})}_initImage(){const t="VIDEO"===this._url.tagName,e=this._image=t?this._url:Ct("video");if(e.classList.add("leaflet-image-layer"),this._zoomAnimated&&e.classList.add("leaflet-zoom-animated"),this.options.className&&e.classList.add(...et(this.options.className)),oe(e,"pointerdown",t=>{e.controls&&he(t)}),e.onloadeddata=this.fire.bind(this,"load"),t){const t=e.getElementsByTagName("source"),o=t.map(t=>t.src);return void(this._url=t.length>0?o:[e.src])}Array.isArray(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.hasOwn(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.controls=!!this.options.controls,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(const t of this._url){const o=Ct("source");o.src=t,e.appendChild(o)}}}class wo extends Je{static{this.setDefaultOptions({interactive:!1,offset:[0,0],className:"",pane:void 0,content:""})}initialize(t,e){t instanceof ut||Array.isArray(t)?(this._latlng=new ut(t),ot(this,e)):(ot(this,t),this._source=e),this.options.content&&(this._content=this.options.content)}openOn(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this}close(){return this._map?.removeLayer(this),this}toggle(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this}onAdd(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&(this._container.style.opacity=0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&(this._container.style.opacity=1),this.bringToFront(),this.options.interactive&&(this._container.classList.add("leaflet-interactive"),this.addInteractiveTarget(this._container))}onRemove(t){t._fadeAnimated?(this._container.style.opacity=0,this._removeTimeout=setTimeout(()=>this._container.remove(),200)):this._container.remove(),this.options.interactive&&(this._container.classList.remove("leaflet-interactive"),this.removeInteractiveTarget(this._container))}getLatLng(){return this._latlng}setLatLng(t){return this._latlng=new ut(t),this._map&&(this._updatePosition(),this._adjustPan()),this}getContent(){return this._content}setContent(t){return this._content=t,this.update(),this}getElement(){return this._container}update(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())}getEvents(){const t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t}isOpen(){return!!this._map&&this._map.hasLayer(this)}bringToFront(){return this._map&&Nt(this._container),this}bringToBack(){return this._map&&Pt(this._container),this}_prepareOpen(t){let e=this._source;if(!e._map)return!1;if(e instanceof to){e=null;for(const t of Object.values(this._source._layers))if(t._map){e=t;break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0}_updateContent(){if(!this._content)return;const t=this._contentNode,e="function"==typeof this._content?this._content(this._source??this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}_updatePosition(){if(!this._map)return;const t=this._map.latLngToLayerPoint(this._latlng),e=this._getAnchor();let o=new ht(this.options.offset);this._zoomAnimated?St(this._container,t.add(e)):o=o.add(t).add(e);const i=this._containerBottom=-o.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+o.x;this._container.style.bottom=`${i}px`,this._container.style.left=`${s}px`}_getAnchor(){return[0,0]}}be.include({_initOverlay(t,e,o,i){let s=e;return s instanceof t||(s=new t(i).setContent(e)),o&&s.setLatLng(o),s}}),Je.include({_initOverlay(t,e,o,i){let s=o;return s instanceof t?(ot(s,i),s._source=this):(s=e&&!i?e:new t(i,this),s.setContent(o)),s}});class Mo extends wo{static{this.setDefaultOptions({pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,closeButtonLabel:"Close popup",autoClose:!0,closeOnEscapeKey:!0,className:"",trackResize:!0})}openOn(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,wo.prototype.openOn.call(this,t)}onAdd(t){wo.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof no||this._source.on("preclick",he))}onRemove(t){wo.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof no||this._source.off("preclick",he))}getEvents(){const t=wo.prototype.getEvents.call(this);return(this.options.closeOnClick??this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t}_initLayout(){const t="leaflet-popup",e=this._container=Ct("div",`${t} ${this.options.className||""} leaflet-zoom-animated`),o=this._wrapper=Ct("div",`${t}-content-wrapper`,e);if(this._contentNode=Ct("div",`${t}-content`,o),ce(e),de(this._contentNode),oe(e,"contextmenu",he),this._tipContainer=Ct("div",`${t}-tip-container`,e),this._tip=Ct("div",`${t}-tip`,this._tipContainer),this.options.closeButton){const o=this._closeButton=Ct("a",`${t}-close-button`,e);o.setAttribute("role","button"),o.setAttribute("aria-label",this.options.closeButtonLabel),o.href="#close",o.innerHTML='<span aria-hidden="true">&#215;</span>',oe(o,"click",t=>{ue(t),this.close()})}this.options.trackResize&&(this._resizeObserver=new ResizeObserver(t=>{this._map&&(this._containerWidth=t[0]?.contentRect?.width,this._containerHeight=t[0]?.contentRect?.height,this._updateLayout(),this._updatePosition(),this._adjustPan())}),this._resizeObserver.observe(this._contentNode))}_updateLayout(){const t=this._contentNode,e=t.style;e.maxWidth=`${this.options.maxWidth}px`,e.minWidth=`${this.options.minWidth}px`;const o=this._containerHeight??t.offsetHeight,i=this.options.maxHeight,s="leaflet-popup-scrolled";i&&o>i?(e.height=`${i}px`,t.classList.add(s)):t.classList.remove(s),this._containerWidth=this._container.offsetWidth,this._containerHeight=this._container.offsetHeight}_animateZoom(t){const e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();St(this._container,e.add(o))}_adjustPan(){if(!this.options.autoPan)return;if(this._map._panAnim?.stop(),this._autopanning)return void(this._autopanning=!1);const t=this._map,e=parseInt(getComputedStyle(this._container).marginBottom,10)||0,o=this._containerHeight+e,i=this._containerWidth,s=new ht(this._containerLeft,-o-this._containerBottom);s._add(jt(this._container));const n=t.layerPointToContainerPoint(s),r=new ht(this.options.autoPanPadding),a=new ht(this.options.autoPanPaddingTopLeft??r),l=new ht(this.options.autoPanPaddingBottomRight??r),h=t.getSize();let d=0,c=0;n.x+i+l.x>h.x&&(d=n.x+i-h.x+l.x),n.x-d-a.x<0&&(d=n.x-a.x),n.y+o+l.y>h.y&&(c=n.y+o-h.y+l.y),n.y-c-a.y<0&&(c=n.y-a.y),(d||c)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([d,c]))}_getAnchor(){return new ht(this._source?._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}be.mergeOptions({closePopupOnClick:!0}),be.include({openPopup(t,e,o){return this._initOverlay(Mo,t,e,o).openOn(this),this},closePopup(t){return t=arguments.length?t:this._popup,t?.close(),this}}),Je.include({bindPopup(t,e){return this._popup=this._initOverlay(Mo,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup(t){return this._popup&&(this instanceof to||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup(){return this._popup?.close(),this},togglePopup(){return this._popup?.toggle(this),this},isPopupOpen(){return this._popup?.isOpen()??!1},setPopupContent(t){return this._popup?.setContent(t),this},getPopup(){return this._popup},_openPopup(t){if(!this._popup||!this._map)return;me(t);const e=t.propagatedFrom??t.target;this._popup._source!==e||e instanceof no?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)},_movePopup(t){this._popup.setLatLng(t.latlng)},_onKeyPress(t){"Enter"===t.originalEvent.code&&this._openPopup(t)}});class xo extends wo{static{this.setDefaultOptions({pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9})}onAdd(t){wo.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))}onRemove(t){wo.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))}getEvents(){const t=wo.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t}_initLayout(){const t=`leaflet-tooltip ${this.options.className||""} leaflet-zoom-${this._zoomAnimated?"animated":"hide"}`;this._contentNode=this._container=Ct("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id",`leaflet-tooltip-${q(this)}`)}_updateLayout(){}_adjustPan(){}_setPosition(t){let e,o,i=this.options.direction;const s=this._map,n=this._container,r=s.latLngToContainerPoint(s.getCenter()),a=s.layerPointToContainerPoint(t),l=n.offsetWidth,h=n.offsetHeight,d=new ht(this.options.offset),c=this._getAnchor();"top"===i?(e=l/2,o=h):"bottom"===i?(e=l/2,o=0):"center"===i?(e=l/2,o=h/2):"right"===i?(e=0,o=h/2):"left"===i?(e=l,o=h/2):a.x<r.x?(i="right",e=0,o=h/2):(i="left",e=l+2*(d.x+c.x),o=h/2),t=t.subtract(new ht(e,o,!0)).add(d).add(c),n.classList.remove("leaflet-tooltip-right","leaflet-tooltip-left","leaflet-tooltip-top","leaflet-tooltip-bottom"),n.classList.add(`leaflet-tooltip-${i}`),St(n,t)}_updatePosition(){const t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)}setOpacity(t){this.options.opacity=t,this._container&&(this._container.style.opacity=t)}_animateZoom(t){const e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)}_getAnchor(){return new ht(this._source?._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}be.include({openTooltip(t,e,o){return this._initOverlay(xo,t,e,o).openOn(this),this},closeTooltip(t){return t.close(),this}}),Je.include({bindTooltip(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(xo,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions(t){if(!t&&this._tooltipHandlersAdded)return;const e=t?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.pointerover=this._openTooltip,o.pointerout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners(t):o.add=()=>this._addFocusListeners(t)),this._tooltip.options.sticky&&(o.pointermove=this._moveTooltip),this[e](o),this._tooltipHandlersAdded=!t},openTooltip(t){return this._tooltip&&(this instanceof to||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip(){if(this._tooltip)return this._tooltip.close()},toggleTooltip(){return this._tooltip?.toggle(this),this},isTooltipOpen(){return this._tooltip.isOpen()},setTooltipContent(t){return this._tooltip?.setContent(t),this},getTooltip(){return this._tooltip},_addFocusListeners(t){this.getElement?this._addFocusListenersOnLayer(this,t):this.eachLayer&&this.eachLayer(e=>this._addFocusListenersOnLayer(e,t),this)},_addFocusListenersOnLayer(t,e){const o="function"==typeof t.getElement&&t.getElement();if(o){const i=e?"off":"on";e||(o._leaflet_focus_handler&&se(o,"focus",o._leaflet_focus_handler,this),o._leaflet_focus_handler=()=>{this._tooltip&&(this._tooltip._source=t,this.openTooltip())}),o._leaflet_focus_handler&&_e[i](o,"focus",o._leaflet_focus_handler,this),_e[i](o,"blur",this.closeTooltip,this),e&&delete o._leaflet_focus_handler}},_setAriaDescribedByOnLayer(t){const e="function"==typeof t.getElement&&t.getElement();e?.setAttribute?.("aria-describedby",this._tooltip._container.id)},_openTooltip(t){this._tooltip&&this._map&&(this._map.dragging?.moving()?"add"!==t.type||this._moveEndOpensTooltip||(this._moveEndOpensTooltip=!0,this._map.once("moveend",()=>{this._moveEndOpensTooltip=!1,this._openTooltip(t)})):(this._tooltip._source=t.propagatedFrom??t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)))},_moveTooltip(t){let e,o,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.pointerEventToContainerPoint(t.originalEvent),o=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(o)),this._tooltip.setLatLng(i)}});class Io extends eo{static{this.setDefaultOptions({iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"})}createIcon(t){const e=t&&"DIV"===t.tagName?t:document.createElement("div"),o=this.options;if(o.html instanceof Element?(e.replaceChildren(),e.appendChild(o.html)):e.innerHTML=!1!==o.html?o.html:"",o.bgPos){const t=new ht(o.bgPos);e.style.backgroundPosition=`${-t.x}px ${-t.y}px`}return this._setIconStyles(e,"icon"),e}createShadow(){return null}}eo.Default=oo;class Co extends Je{static{this.setDefaultOptions({tileSize:256,opacity:1,updateWhenIdle:Mt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2})}initialize(t){ot(this,t)}onAdd(){this._initContainer(),this._levels={},this._tiles={},this._resetView()}beforeAdd(t){t._addZoomLimit(this)}onRemove(t){this._removeAllTiles(),this._container.remove(),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0,clearTimeout(this._pruneTimeout)}bringToFront(){return this._map&&(Nt(this._container),this._setAutoZIndex(Math.max)),this}bringToBack(){return this._map&&(Pt(this._container),this._setAutoZIndex(Math.min)),this}getContainer(){return this._container}setOpacity(t){return this.options.opacity=t,this._updateOpacity(),this}setZIndex(t){return this.options.zIndex=t,this._updateZIndex(),this}isLoading(){return this._loading}redraw(){if(this._map){this._removeAllTiles();const t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this}getEvents(){const t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=$(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t}createTile(){return document.createElement("div")}getTileSize(){const t=this.options.tileSize;return t instanceof ht?t:new ht(t,t)}_updateZIndex(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)}_setAutoZIndex(t){const e=this.getPane().children;let o=-t(-1/0,1/0);for(const i of e){const e=i.style.zIndex;i!==this._container&&e&&(o=t(o,+e))}isFinite(o)&&(this.options.zIndex=o+t(-1,1),this._updateZIndex())}_updateOpacity(){if(!this._map)return;this._container.style.opacity=this.options.opacity;const t=+new Date;let e=!1,o=!1;for(const i of Object.values(this._tiles??{})){if(!i.current||!i.loaded)continue;const s=Math.min(1,(t-i.loaded)/200);i.el.style.opacity=s,s<1?e=!0:(i.active?o=!0:this._onOpaqueTile(i),i.active=!0)}o&&!this._noPrune&&this._pruneTiles(),e&&(cancelAnimationFrame(this._fadeFrame),this._fadeFrame=requestAnimationFrame(this._updateOpacity.bind(this)))}_onOpaqueTile(){}_initContainer(){this._container||(this._container=Ct("div",`leaflet-layer ${this.options.className??""}`),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))}_updateLevels(){const t=this._tileZoom,e=this.options.maxZoom;if(void 0===t)return;for(let o of Object.keys(this._levels))o=Number(o),this._levels[o].el.children.length||o===t?(this._levels[o].el.style.zIndex=e-Math.abs(t-o),this._onUpdateLevel(o)):(this._levels[o].el.remove(),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);let o=this._levels[t];const i=this._map;return o||(o=this._levels[t]={},o.el=Ct("div","leaflet-tile-container leaflet-zoom-animated",this._container),o.el.style.zIndex=e,o.origin=i.project(i.unproject(i.getPixelOrigin()),t).round(),o.zoom=t,this._setZoomTransform(o,i.getCenter(),i.getZoom()),o.el.offsetWidth,this._onCreateLevel(o)),this._level=o,o}_onUpdateLevel(){}_onRemoveLevel(){}_onCreateLevel(){}_pruneTiles(){if(!this._map)return;const t=this._map.getZoom();if(t>this.options.maxZoom||t<this.options.minZoom)this._removeAllTiles();else{for(const t of Object.values(this._tiles))t.retain=t.current;for(const t of Object.values(this._tiles))if(t.current&&!t.active){const e=t.coords;this._retainParent(e.x,e.y,e.z,e.z-5)||this._retainChildren(e.x,e.y,e.z,e.z+2)}for(const[t,e]of Object.entries(this._tiles))e.retain||this._removeTile(t)}}_removeTilesAtZoom(t){for(const[e,o]of Object.entries(this._tiles))o.coords.z===t&&this._removeTile(e)}_removeAllTiles(){for(const t of Object.keys(this._tiles))this._removeTile(t)}_invalidateAll(){for(const t of Object.keys(this._levels))this._levels[t].el.remove(),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0}_retainParent(t,e,o,i){const s=Math.floor(t/2),n=Math.floor(e/2),r=o-1,a=new ht(+s,+n);a.z=+r;const l=this._tileCoordsToKey(a),h=this._tiles[l];return h?.active?(h.retain=!0,!0):(h?.loaded&&(h.retain=!0),r>i&&this._retainParent(s,n,r,i))}_retainChildren(t,e,o,i){for(let s=2*t;s<2*t+2;s++)for(let t=2*e;t<2*e+2;t++){const e=new ht(s,t);e.z=o+1;const n=this._tileCoordsToKey(e),r=this._tiles[n];r?.active?r.retain=!0:(r?.loaded&&(r.retain=!0),o+1<i&&this._retainChildren(s,t,o+1,i))}}_resetView(t){const e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)}_animateZoom(t){this._setView(t.center,t.zoom,!0,t.noUpdate)}_clampZoom(t){const e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t}_setView(t,e,o,i){let s=Math.round(e);s=void 0!==this.options.maxZoom&&s>this.options.maxZoom||void 0!==this.options.minZoom&&s<this.options.minZoom?void 0:this._clampZoom(s);const n=this.options.updateWhenZooming&&s!==this._tileZoom;i&&!n||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==s&&this._update(t),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(t,e)}_setZoomTransforms(t,e){for(const o of Object.values(this._levels))this._setZoomTransform(o,t,e)}_setZoomTransform(t,e,o){const i=this._map.getZoomScale(o,t.zoom),s=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,o)).round();Ot(t.el,s,i)}_resetGrid(){const t=this._map,e=t.options.crs,o=this._tileSize=this.getTileSize(),i=this._tileZoom,s=this._map.getPixelWorldBounds(this._tileZoom);s&&(this._globalTileRange=this._pxBoundsToTileRange(s)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/o.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/o.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/o.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/o.y)]}_onMoveEnd(){this._map&&!this._map._animatingZoom&&this._update()}_getTiledPixelBounds(t){const e=this._map,o=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(o,this._tileZoom),s=e.project(t,this._tileZoom).floor(),n=e.getSize().divideBy(2*i);return new dt(s.subtract(n),s.add(n))}_update(t){const e=this._map;if(!e)return;const o=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0===this._tileZoom)return;const i=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(i),n=s.getCenter(),r=[],a=this.options.keepBuffer,l=new dt(s.getBottomLeft().subtract([a,-a]),s.getTopRight().add([a,-a]));if(!(isFinite(s.min.x)&&isFinite(s.min.y)&&isFinite(s.max.x)&&isFinite(s.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(const t of Object.values(this._tiles)){const e=t.coords;e.z===this._tileZoom&&l.contains(new ht(e.x,e.y))||(t.current=!1)}if(Math.abs(o-this._tileZoom)>1)this._setView(t,o);else{for(let t=s.min.y;t<=s.max.y;t++)for(let e=s.min.x;e<=s.max.x;e++){const o=new ht(e,t);if(o.z=this._tileZoom,!this._isValidTile(o))continue;const i=this._tiles[this._tileCoordsToKey(o)];i?i.current=!0:r.push(o)}if(r.sort((t,e)=>t.distanceTo(n)-e.distanceTo(n)),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));const t=document.createDocumentFragment();for(const e of r)this._addTile(e,t);this._level.el.appendChild(t)}}}_isValidTile(t){const e=this._map.options.crs;if(!e.infinite){const o=this._globalTileRange;if(!e.wrapLng&&(t.x<o.min.x||t.x>o.max.x)||!e.wrapLat&&(t.y<o.min.y||t.y>o.max.y))return!1}if(!this.options.bounds)return!0;const o=this._tileCoordsToBounds(t);return new ct(this.options.bounds).overlaps(o)}_keyToBounds(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))}_tileCoordsToNwSe(t){const e=this._map,o=this.getTileSize(),i=t.scaleBy(o),s=i.add(o);return[e.unproject(i,t.z),e.unproject(s,t.z)]}_tileCoordsToBounds(t){const e=this._tileCoordsToNwSe(t);let o=new ct(e[0],e[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o}_tileCoordsToKey(t){return`${t.x}:${t.y}:${t.z}`}_keyToTileCoords(t){const e=t.split(":"),o=new ht(+e[0],+e[1]);return o.z=+e[2],o}_removeTile(t){const e=this._tiles[t];e&&(e.el.remove(),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))}_initTile(t){t.classList.add("leaflet-tile");const e=this.getTileSize();t.style.width=`${e.x}px`,t.style.height=`${e.y}px`,t.onselectstart=Q,t.onpointermove=Q}_addTile(t,e){const o=this._getTilePos(t),i=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),this._tileReady.bind(this,t));this._initTile(s),this.createTile.length<2&&requestAnimationFrame(this._tileReady.bind(this,t,null,s)),St(s,o),this._tiles[i]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})}_tileReady(t,e,o){e&&this.fire("tileerror",{error:e,tile:o,coords:t});const i=this._tileCoordsToKey(t);(o=this._tiles[i])&&(o.loaded=+new Date,this._map._fadeAnimated?(o.el.style.opacity=0,cancelAnimationFrame(this._fadeFrame),this._fadeFrame=requestAnimationFrame(this._updateOpacity.bind(this))):(o.active=!0,this._pruneTiles()),e||(o.el.classList.add("leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),this._map._fadeAnimated?this._pruneTimeout=setTimeout(this._pruneTiles.bind(this),250):requestAnimationFrame(this._pruneTiles.bind(this))))}_getTilePos(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)}_wrapCoords(t){const e=new ht(this._wrapX?J(t.x,this._wrapX):t.x,this._wrapY?J(t.y,this._wrapY):t.y);return e.z=t.z,e}_pxBoundsToTileRange(t){const e=this.getTileSize();return new dt(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))}_noTilesToLoad(){return Object.values(this._tiles).every(t=>t.loaded)}}class No extends Co{static{this.setDefaultOptions({minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1})}initialize(t,e){if(this._url=t,null===(e=ot(this,e)).attribution&&URL.canParse(t)){const o=new URL(t).hostname;["tile.openstreetmap.org","tile.osm.org"].some(t=>o.endsWith(t))&&(e.attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors')}e.detectRetina&&Mt.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)}setUrl(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this}createTile(t,e){const o=document.createElement("img");return oe(o,"load",this._tileOnLoad.bind(this,e,o)),oe(o,"error",this._tileOnError.bind(this,e,o)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(o.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(t),o}getTileUrl(t){const e=Object.create(this.options);if(Object.assign(e,{r:Mt.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()}),this._map&&!this._map.options.crs.infinite){const o=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=o),e["-y"]=o}return st(this._url,e)}_tileOnLoad(t,e){t(null,e)}_tileOnError(t,e,o){const i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(o,e)}_onTileRemove(t){t.tile.onload=null}_getZoomForUrl(){let t=this._tileZoom;const e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset}_getSubdomain(t){const e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]}_abortLoading(){let t,e;for(t of Object.keys(this._tiles))if(this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=Q,e.onerror=Q,!e.complete)){e.src=nt;const o=this._tiles[t].coords;e.remove(),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:o})}}_removeTile(t){const e=this._tiles[t];if(e)return e.el.setAttribute("src",nt),Co.prototype._removeTile.call(this,t)}_tileReady(t,e,o){if(this._map&&(!o||o.getAttribute("src")!==nt))return Co.prototype._tileReady.call(this,t,e,o)}_clampZoom(t){return Math.round(Co.prototype._clampZoom.call(this,t))}}class Po extends No{static{this.prototype.defaultWmsParams={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},this.setDefaultOptions({crs:null,uppercase:!1})}initialize(t,e){this._url=t;const o={...this.defaultWmsParams};for(const t of Object.keys(e))t in this.options||(o[t]=e[t]);const i=(e=ot(this,e)).detectRetina&&Mt.retina?2:1,s=this.getTileSize();o.width=s.x*i,o.height=s.y*i,this.wmsParams=o}onAdd(t){this._crs=this.options.crs??t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);const e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,No.prototype.onAdd.call(this,t)}getTileUrl(t){const e=this._tileCoordsToNwSe(t),o=this._crs,i=new dt(o.project(e[0]),o.project(e[1])),s=i.min,n=i.max,r=(this._wmsVersion>=1.3&&this._crs===qe?[s.y,s.x,n.y,n.x]:[s.x,s.y,n.x,n.y]).join(","),a=new URL(No.prototype.getTileUrl.call(this,t));for(const[t,e]of Object.entries({...this.wmsParams,bbox:r}))a.searchParams.append(this.options.uppercase?t.toUpperCase():t,e);return a.toString()}setParams(t,e){return Object.assign(this.wmsParams,t),e||this.redraw(),this}}No.WMS=Po;class Oo extends bo{initialize(t){ot(this,{...t,continuous:!1}),q(this),this._layers??={}}onAdd(t){super.onAdd(t),this.on("update",this._updatePaths,this)}onRemove(){super.onRemove(),this.off("update",this._updatePaths,this)}_onZoomEnd(){for(const t of Object.values(this._layers))t._project()}_updatePaths(){for(const t of Object.values(this._layers))t._update()}_onViewReset(){for(const t of Object.values(this._layers))t._reset()}_onSettled(){this._update()}_update(){}}class Do extends Oo{static{this.setDefaultOptions({tolerance:0})}getEvents(){const t=Oo.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t}_onViewPreReset(){this._postponeUpdatePaths=!0}onAdd(t){Oo.prototype.onAdd.call(this,t),this._draw()}onRemove(){Oo.prototype.onRemove.call(this),clearTimeout(this._pointerHoverThrottleTimeout)}_initContainer(){const t=this._container=document.createElement("canvas");oe(t,"pointermove",this._onPointerMove,this),oe(t,"click dblclick pointerdown pointerup contextmenu",this._onClick,this),oe(t,"pointerout",this._handlePointerOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")}_destroyContainer(){cancelAnimationFrame(this._redrawRequest),this._redrawRequest=null,delete this._ctx,Oo.prototype._destroyContainer.call(this)}_resizeContainer(){const t=Oo.prototype._resizeContainer.call(this),e=this._ctxScale=window.devicePixelRatio;this._container.width=e*t.x,this._container.height=e*t.y}_updatePaths(){if(!this._postponeUpdatePaths){this._redrawBounds=null;for(const t of Object.values(this._layers))t._update();this._redraw()}}_update(){if(this._map._animatingZoom&&this._bounds)return;const t=this._bounds,e=this._ctxScale;this._ctx.setTransform(e,0,0,e,-t.min.x*e,-t.min.y*e),this.fire("update")}_reset(){Oo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())}_initPath(t){this._updateDashArray(t),this._layers[q(t)]=t;const e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst??=this._drawLast}_addPath(t){this._requestRedraw(t)}_removePath(t){const e=t._order,o=e.next,i=e.prev;o?o.prev=i:this._drawLast=i,i?i.next=o:this._drawFirst=o,delete t._order,delete this._layers[q(t)],this._requestRedraw(t)}_updatePath(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)}_updateStyle(t){this._updateDashArray(t),this._requestRedraw(t)}_updateDashArray(t){if("string"==typeof t.options.dashArray){const e=t.options.dashArray.split(/[, ]+/);t.options._dashArray=e.map(t=>Number(t)).filter(t=>!isNaN(t))}else t.options._dashArray=t.options.dashArray}_requestRedraw(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest??=requestAnimationFrame(this._redraw.bind(this)))}_extendRedrawBounds(t){if(t._pxBounds){const e=(t.options.weight??0)+1;this._redrawBounds??=new dt,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}}_redraw(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null}_clear(){const t=this._redrawBounds;if(t){const e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()}_draw(){let t;const e=this._redrawBounds;if(this._ctx.save(),e){const t=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,t.x,t.y),this._ctx.clip()}this._drawing=!0;for(let o=this._drawFirst;o;o=o.next)t=o.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()}_updatePoly(t,e){if(!this._drawing)return;const o=t._parts,i=this._ctx;o.length&&(i.beginPath(),o.forEach(t=>{t.forEach((t,e)=>{i[e?"lineTo":"moveTo"](t.x,t.y)}),e&&i.closePath()}),this._fillStroke(i,t))}_updateCircle(t){if(!this._drawing||t._empty())return;const e=t._point,o=this._ctx,i=Math.max(Math.round(t._radius),1),s=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==s&&(o.save(),o.scale(1,s)),o.beginPath(),o.arc(e.x,e.y/s,i,0,2*Math.PI,!1),1!==s&&o.restore(),this._fillStroke(o,t)}_fillStroke(t,e){const o=e.options;o.fill&&(t.globalAlpha=o.fillOpacity,t.fillStyle=o.fillColor??o.color,t.fill(o.fillRule||"evenodd")),o.stroke&&0!==o.weight&&(t.setLineDash&&(t.lineDashOffset=Number(o.dashOffset??0),t.setLineDash(o._dashArray??[])),t.globalAlpha=o.opacity,t.lineWidth=o.weight,t.strokeStyle=o.color,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.stroke())}_onClick(t){const e=this._map.pointerEventToLayerPoint(t);let o,i;for(let s=this._drawFirst;s;s=s.next)o=s.layer,o.options.interactive&&o._containsPoint(e)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(o))&&(i=o);this._fireEvent(!!i&&[i],t)}_onPointerMove(t){if(!this._map||this._map.dragging.moving()||this._map._animatingZoom)return;const e=this._map.pointerEventToLayerPoint(t);this._handlePointerHover(t,e)}_handlePointerOut(t){const e=this._hoveredLayer;e&&(this._container.classList.remove("leaflet-interactive"),this._fireEvent([e],t,"pointerout"),this._hoveredLayer=null,this._pointerHoverThrottled=!1)}_handlePointerHover(t,e){if(this._pointerHoverThrottled)return;let o,i;for(let t=this._drawFirst;t;t=t.next)o=t.layer,o.options.interactive&&o._containsPoint(e)&&(i=o);i!==this._hoveredLayer&&(this._handlePointerOut(t),i&&(this._container.classList.add("leaflet-interactive"),this._fireEvent([i],t,"pointerover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._pointerHoverThrottled=!0,this._pointerHoverThrottleTimeout=setTimeout(()=>{this._pointerHoverThrottled=!1},32)}_fireEvent(t,e,o){this._map._fireDOMEvent(e,o||e.type,t)}_bringToFront(t){const e=t._order;if(!e)return;const o=e.next,i=e.prev;o&&(o.prev=i,i?i.next=o:o&&(this._drawFirst=o),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}_bringToBack(t){const e=t._order;if(!e)return;const o=e.next,i=e.prev;i&&(i.next=o,o?o.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}function So(t,e){return t.flatMap(t=>[...t.map((t,e)=>`${(e?"L":"M")+t.x} ${t.y}`),e?"z":""]).join("")||"M0 0"}const jo=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)};class Ao extends Oo{_initContainer(){this._container=jo("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=jo("g"),this._container.appendChild(this._rootGroup)}_destroyContainer(){Oo.prototype._destroyContainer.call(this),delete this._rootGroup,delete this._svgSize}_resizeContainer(){const t=Oo.prototype._resizeContainer.call(this);this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,this._container.setAttribute("width",t.x),this._container.setAttribute("height",t.y))}_update(){if(this._map._animatingZoom&&this._bounds)return;const t=this._bounds,e=t.getSize();this._container.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}_initPath(t){const e=t._path=jo("path");t.options.className&&e.classList.add(...et(t.options.className)),t.options.interactive&&e.classList.add("leaflet-interactive"),this._updateStyle(t),this._layers[q(t)]=t}_addPath(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)}_removePath(t){t._path.remove(),t.removeInteractiveTarget(t._path),delete this._layers[q(t)]}_updatePath(t){t._project(),t._update()}_updateStyle(t){const e=t._path,o=t.options;e&&(o.stroke?(e.setAttribute("stroke",o.color),e.setAttribute("stroke-opacity",o.opacity),e.setAttribute("stroke-width",o.weight),e.setAttribute("stroke-linecap",o.lineCap),e.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?e.setAttribute("stroke-dasharray",o.dashArray):e.removeAttribute("stroke-dasharray"),o.dashOffset?e.setAttribute("stroke-dashoffset",o.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),o.fill?(e.setAttribute("fill",o.fillColor||o.color),e.setAttribute("fill-opacity",o.fillOpacity),e.setAttribute("fill-rule",o.fillRule||"evenodd")):e.setAttribute("fill","none"))}_updatePoly(t,e){this._setPath(t,So(t._parts,e))}_updateCircle(t){const e=t._point,o=Math.max(Math.round(t._radius),1),i=`a${o},${Math.max(Math.round(t._radiusY),1)||o} 0 1,0 `,s=t._empty()?"M0 0":`M${e.x-o},${e.y}${i}${2*o},0 ${i}${2*-o},0 `;this._setPath(t,s)}_setPath(t,e){t._path.setAttribute("d",e)}_bringToFront(t){Nt(t._path)}_bringToBack(t){Pt(t._path)}}be.include({getRenderer(t){let e=t.options.renderer??this._getPaneRenderer(t.options.pane)??this.options.renderer??this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer(t){if("overlayPane"===t||void 0===t)return;let e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer(t){return this.options.preferCanvas&&new Do(t)||new Ao(t)}});class Ro extends ho{initialize(t,e){ho.prototype.initialize.call(this,this._boundsToLatLngs(t),e)}setBounds(t){return this.setLatLngs(this._boundsToLatLngs(t))}_boundsToLatLngs(t){return[(t=new ct(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}Ao.create=jo,Ao.pointsToPath=So,co.geometryToLayer=uo,co.coordsToLatLng=po,co.coordsToLatLngs=go,co.latLngToCoords=vo,co.latLngsToCoords=fo,co.getFeature=yo,co.asFeature=_o,be.mergeOptions({boxZoom:!0});class Ho extends Ce{initialize(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)}addHooks(){oe(this._container,"pointerdown",this._onPointerDown,this)}removeHooks(){se(this._container,"pointerdown",this._onPointerDown,this)}moved(){return this._moved}_destroy(){this._pane.remove(),delete this._pane}_resetState(){this._resetStateTimeout=0,this._moved=!1}_clearDeferredResetState(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)}_onPointerDown(t){if(!t.shiftKey||0!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),zt(),Zt(),this._startPoint=this._map.pointerEventToContainerPoint(t),oe(document,{contextmenu:me,pointermove:this._onPointerMove,pointerup:this._onPointerUp,keydown:this._onKeyDown},this)}_onPointerMove(t){this._moved||(this._moved=!0,this._box=Ct("div","leaflet-zoom-box",this._container),this._container.classList.add("leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.pointerEventToContainerPoint(t);const e=new dt(this._point,this._startPoint),o=e.getSize();St(this._box,e.min),this._box.style.width=`${o.x}px`,this._box.style.height=`${o.y}px`}_finish(){this._moved&&(this._box.remove(),this._container.classList.remove("leaflet-crosshair")),Ft(),Kt(),se(document,{contextmenu:me,pointermove:this._onPointerMove,pointerup:this._onPointerUp,keydown:this._onKeyDown},this)}_onPointerUp(t){if(0!==t.button)return;if(this._finish(),!this._moved)return;this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(this._resetState.bind(this),0);const e=new ct(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}_onKeyDown(t){"Escape"===t.code&&(this._finish(),this._clearDeferredResetState(),this._resetState())}}be.addInitHook("addHandler","boxZoom",Ho),be.mergeOptions({doubleClickZoom:!0});class ko extends Ce{addHooks(){this._map.on("dblclick",this._onDoubleClick,this)}removeHooks(){this._map.off("dblclick",this._onDoubleClick,this)}_onDoubleClick(t){const e=this._map,o=e.getZoom(),i=e.options.zoomDelta,s=t.originalEvent.shiftKey?o-i:o+i;"center"===e.options.doubleClickZoom?e.setZoom(s):e.setZoomAround(t.containerPoint,s)}}be.addInitHook("addHandler","doubleClickZoom",ko),be.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});class Bo extends Ce{addHooks(){if(!this._draggable){const t=this._map;this._draggable=new Ne(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}this._map._container.classList.add("leaflet-grab","leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]}removeHooks(){this._map._container.classList.remove("leaflet-grab","leaflet-touch-drag"),this._draggable.disable()}moved(){return this._draggable?._moved}moving(){return this._draggable?._moving}_onDragStart(){const t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){const t=new ct(this._map.options.maxBounds);this._offsetLimit=new dt(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])}_onDrag(t){if(this._map.options.inertia){const t=this._lastTime=+new Date,e=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(e),this._times.push(t),this._prunePositions(t)}this._map.fire("move",t).fire("drag",t)}_prunePositions(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()}_onZoomEnd(){const t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x}_viscousLimit(t,e){return t-(t-e)*this._viscosity}_onPreDragLimit(){if(!this._viscosity||!this._offsetLimit)return;const t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}_onPreDragWrap(){const t=this._worldWidth,e=Math.round(t/2),o=this._initialWorldOffset,i=this._draggable._newPos.x,s=(i-e+o)%t+e-o,n=(i+e+o)%t-e-o,r=Math.abs(s+o)<Math.abs(n+o)?s:n;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r}_onDragEnd(t){const e=this._map,o=e.options,i=!o.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);const t=this._lastPos.subtract(this._positions[0]),i=(this._lastTime-this._times[0])/1e3,s=o.easeLinearity,n=t.multiplyBy(s/i),r=n.distanceTo([0,0]),a=Math.min(o.inertiaMaxSpeed,r),l=n.multiplyBy(a/r),h=a/(o.inertiaDeceleration*s);let d=l.multiplyBy(-h/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),requestAnimationFrame(()=>{e.panBy(d,{duration:h,easeLinearity:s,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}}be.addInitHook("addHandler","dragging",Bo),be.mergeOptions({keyboard:!0,keyboardPanDelta:80});class zo extends Ce{static keyCodes={left:["ArrowLeft"],right:["ArrowRight"],down:["ArrowDown"],up:["ArrowUp"],zoomIn:["Equal","NumpadAdd","BracketRight"],zoomOut:["Minus","NumpadSubtract","Digit6","Slash"]};initialize(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)}addHooks(){const t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),t.ariaKeyShortcuts=Object.values(zo.keyCodes).flat().join(" "),oe(t,{focus:this._onFocus,blur:this._onBlur,pointerdown:this._onPointerDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)}removeHooks(){this._removeHooks(),se(this._map._container,{focus:this._onFocus,blur:this._onBlur,pointerdown:this._onPointerDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)}_onPointerDown(){if(this._focused)return;const t=document.body,e=document.documentElement,o=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,o)}_onFocus(){this._focused=!0,this._map.fire("focus")}_onBlur(){this._focused=!1,this._map.fire("blur")}_setPanDelta(t){const e=this._panKeys={},o=zo.keyCodes;for(const i of o.left)e[i]=[-1*t,0];for(const i of o.right)e[i]=[t,0];for(const i of o.down)e[i]=[0,t];for(const i of o.up)e[i]=[0,-1*t]}_setZoomDelta(t){const e=this._zoomKeys={},o=zo.keyCodes;for(const i of o.zoomIn)e[i]=t;for(const i of o.zoomOut)e[i]=-t}_addHooks(){oe(document,"keydown",this._onKeyDown,this)}_removeHooks(){se(document,"keydown",this._onKeyDown,this)}_onKeyDown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;const e=t.code,o=this._map;let i;if(e in this._panKeys){if(!o._panAnim||!o._panAnim._inProgress)if(i=this._panKeys[e],t.shiftKey&&(i=new ht(i).multiplyBy(3)),o.options.maxBounds&&(i=o._limitOffset(new ht(i),o.options.maxBounds)),o.options.worldCopyJump){const t=o.wrapLatLng(o.unproject(o.project(o.getCenter()).add(i)));o.panTo(t)}else o.panBy(i)}else if(e in this._zoomKeys)o.setZoom(o.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[e]);else{if("Escape"!==e||!o._popup||!o._popup.options.closeOnEscapeKey)return;o.closePopup()}me(t)}}be.addInitHook("addHandler","keyboard",zo),be.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});class Fo extends Ce{addHooks(){oe(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0}removeHooks(){se(this._map._container,"wheel",this._onWheelScroll,this),clearTimeout(this._timer)}_onWheelScroll(t){const e=fe(t),o=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.pointerEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);const i=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(this._performZoom.bind(this),i),me(t)}_performZoom(){const t=this._map,e=t.getZoom(),o=this._map.options.zoomSnap??0;t._stop();const i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),s=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,n=o?Math.ceil(s/o)*o:s,r=t._limitZoom(e+(this._delta>0?n:-n))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}}be.addInitHook("addHandler","scrollWheelZoom",Fo);be.mergeOptions({tapHold:Mt.safari&&Mt.mobile,tapTolerance:15});class Zo extends Ce{addHooks(){oe(this._map._container,"pointerdown",this._onDown,this)}removeHooks(){se(this._map._container,"pointerdown",this._onDown,this),clearTimeout(this._holdTimeout)}_onDown(t){clearTimeout(this._holdTimeout),1===ee().length&&"mouse"!==t.pointerType&&(this._startPos=this._newPos=new ht(t.clientX,t.clientY),this._holdTimeout=setTimeout(()=>{this._cancel(),this._isTapValid()&&(oe(document,"pointerup",ue),oe(document,"pointerup pointercancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},600),oe(document,"pointerup pointercancel contextmenu",this._cancel,this),oe(document,"pointermove",this._onMove,this))}_cancelClickPrevent=function t(){se(document,"pointerup",ue),se(document,"pointerup pointercancel",t)};_cancel(){clearTimeout(this._holdTimeout),se(document,"pointerup pointercancel contextmenu",this._cancel,this),se(document,"pointermove",this._onMove,this)}_onMove(t){this._newPos=new ht(t.clientX,t.clientY)}_isTapValid(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance}_simulateEvent(t,e){const o=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});o._simulated=!0,e.target.dispatchEvent(o)}}be.addInitHook("addHandler","tapHold",Zo),be.mergeOptions({pinchZoom:!0,bounceAtZoomLimits:!0});class Ko extends Ce{addHooks(){this._map._container.classList.add("leaflet-touch-zoom"),oe(this._map._container,"pointerdown",this._onPointerStart,this)}removeHooks(){this._map._container.classList.remove("leaflet-touch-zoom"),se(this._map._container,"pointerdown",this._onPointerStart,this)}_onPointerStart(t){const e=this._map,o=ee();if(2!==o.length||e._animatingZoom||this._zooming)return;const i=e.pointerEventToContainerPoint(o[0]),s=e.pointerEventToContainerPoint(o[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.pinchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(s)._divideBy(2))),this._startDist=i.distanceTo(s),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),oe(document,"pointermove",this._onPointerMove,this),oe(document,"pointerup pointercancel",this._onPointerEnd,this),ue(t)}_onPointerMove(t){const e=ee();if(2!==e.length||!this._zooming)return;const o=this._map,i=o.pointerEventToContainerPoint(e[0]),s=o.pointerEventToContainerPoint(e[1]),n=i.distanceTo(s)/this._startDist;if(this._zoom=o.getScaleZoom(n,this._startZoom),!o.options.bounceAtZoomLimits&&(this._zoom<o.getMinZoom()&&n<1||this._zoom>o.getMaxZoom()&&n>1)&&(this._zoom=o._limitZoom(this._zoom)),"center"===o.options.pinchZoom){if(this._center=this._startLatLng,1===n)return}else{const t=i._add(s)._divideBy(2)._subtract(this._centerPoint);if(1===n&&0===t.x&&0===t.y)return;this._center=o.unproject(o.project(this._pinchStartLatLng,this._zoom).subtract(t),this._zoom)}this._moved||(o._moveStart(!0,!1),this._moved=!0),cancelAnimationFrame(this._animRequest);const r=o._move.bind(o,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=requestAnimationFrame(r.bind(this)),ue(t)}_onPointerEnd(){this._moved&&this._zooming?(this._zooming=!1,cancelAnimationFrame(this._animRequest),se(document,"pointermove",this._onPointerMove,this),se(document,"pointerup pointercancel",this._onPointerEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}}be.addInitHook("addHandler","pinchZoom",Ko),be.addInitHook(function(){this.touchZoom=this.pinchZoom,void 0!==this.options.touchZoom&&(console.warn("Map: touchZoom option is deprecated and will be removed in future versions. Use pinchZoom instead."),this.options.pinchZoom=this.options.touchZoom,delete this.options.touchZoom),this.options.pinchZoom?this.pinchZoom.enable():this.pinchZoom.disable()}),be.BoxZoom=Ho,be.DoubleClickZoom=ko,be.Drag=Bo,be.Keyboard=zo,be.ScrollWheelZoom=Fo,be.TapHold=Zo,be.PinchZoom=Ko,be.TouchZoom=Ko;var Uo={__proto__:null,BlanketOverlay:bo,Bounds:dt,Browser:Mt,CRS:mt,Canvas:Do,Circle:ao,CircleMarker:ro,Class:at,Control:Ee,DivIcon:Io,DivOverlay:wo,DomEvent:_e,DomUtil:Yt,Draggable:Ne,Evented:lt,FeatureGroup:to,GeoJSON:co,GridLayer:Co,Handler:Ce,Icon:eo,ImageOverlay:Lo,LatLng:ut,LatLngBounds:ct,Layer:Je,LayerGroup:Qe,LeafletMap:Le,LineUtil:We,Map:be,Marker:so,Path:no,Point:ht,PolyUtil:Se,Polygon:ho,Polyline:lo,Popup:Mo,PosAnimation:Te,Projection:Ye,Rectangle:Ro,Renderer:Oo,SVG:Ao,SVGOverlay:class extends Lo{_initImage(){const t=this._image=this._url;t.classList.add("leaflet-image-layer"),this._zoomAnimated&&t.classList.add("leaflet-zoom-animated"),this.options.className&&t.classList.add(...et(this.options.className)),t.onselectstart=Q,t.onpointermove=Q}},TileLayer:No,Tooltip:xo,Transformation:ft,Util:rt,VideoOverlay:Eo,version:"2.0.0-alpha.1"};const Wo=Vo().L;function Vo(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}Vo().L=Uo,Vo().L.noConflict=function(){return Vo().L=Wo,this};class Xo{constructor(){Object.freeze(this)}handleEvent(t){if(!t.target.classList.contains("TravelNotes-Background"))return;let e=K.map.getZoom()+(0>t.deltaY?1:-1);e=Math.min(K.map.getMaxZoom(),e),e=Math.max(K.map.getMinZoom(),e),K.map.setZoomAround(new ht(t.clientX,t.clientY),e)}}class Yo{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault()}}class Go{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){t.preventDefault(),Number.parseInt(t.dataTransfer.getData("ObjId"))===this.#Zt.objId&&(t.stopPropagation(),this.#Zt.moveDialog(t))}}class qo{#V;#X;constructor(t,e){Object.freeze(this),this.#V=t,this.#X=e}static clone(t){return new qo(t.lat,t.lng)}get latLng(){return[this.#V,this.#X]}get lat(){return this.#V}get lng(){return this.#X}}class $o extends qo{#Y;constructor(t,e,o){super(t,e),this.#Y=o}get distance(){return this.#Y}}class Jo extends $o{#G;#et;constructor(t,e,o,i,s){super(t,e,o),this.#G=i,this.#et=s}get elev(){return this.#G}get ascent(){return this.#et}}class Qo{static get#Kt(){return 100}constructor(){Object.freeze(this)}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let o=0;const i=t.itinerary.itineraryPoints.iterator;for(;o<e&&!i.done;)o+=i.value.distance;const s=i.value;i.done;const n=(s.distance-o+e)/s.distance;return new Jo(s.lat+(i.value.lat-s.lat)*n,s.lng+(i.value.lng-s.lng)*n,e,s.elev+(i.value.elev-s.elev)*n,Qo.#Kt*(i.value.elev-s.elev)/s.distance)}getClosestLatLngDistance(t,e){if(0===t.itinerary.itineraryPoints.length)return null;const i=t.itinerary.itineraryPoints.iterator;i.done;let s=Number.MAX_VALUE;const n=Ye.SphericalMercator.project(new ut(e[0],e[1]));let r=Ye.SphericalMercator.project(new ut(i.value.lat,i.value.lng)),a=null,l=o.defaultValue,h=i.value.distance;for(;!i.done;){const t=Ye.SphericalMercator.project(new ut(i.value.lat,i.value.lng));let e=We.pointToSegmentDistance(n,r,t);e<s&&(s=e,a=Ye.SphericalMercator.unproject(We.closestPointOnSegment(n,r,t)),l=h-a.distanceTo(new ut(i.value.lat,i.value.lng))),h+=i.value.distance,r=t}return new $o(a.lat,a.lng,l)}getLatLngBounds(t){const e=new ut(a.maxLat,a.maxLng),o=new ut(a.minLat,a.minLng);return t.forEach(t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),o.lat=Math.max(o.lat,t[0]),o.lng=Math.max(o.lng,t[1])}),new ct(e,o)}getSquareBoundingBox(t,o){const i=t[0]*e.toRadians,s=o/u*e.fromRadians,n=Math.acos((Math.cos(o/u)-Math.sin(i)**2)/Math.cos(i)**2)*e.fromRadians;return new ct(new ut(t[0]-s,t[1]-n),new ut(t[0]+s,t[1]+n))}project(t,e){const o=K.map.project(new ut(t[0],t[1]),e);return[o.x,o.y]}screenCoordToLatLng(t,e){const o=K.map.containerPointToLatLng(new ht(t,e));return[o.lat,o.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const ti=new Qo;class ei{#zt;#Ut=!1;#Wt=!1;#Vt=0;#Xt=0;#Yt;#Gt;#qt;#$t;#Jt(e){if(this.#Ut&&(this.#Vt!==e.screenX||this.#Xt!==e.screenY)){t.baseDialog.cancelTouchY>this.#Xt&&e.screenY<this.#Xt&&t.baseDialog.cancelTouchX>this.#Vt&&this.#zt.onCancel();const o=ti.screenCoordToLatLng(this.#Vt,this.#Xt),i=ti.screenCoordToLatLng(e.screenX,e.screenY);K.map.panTo([this.#Yt.lat+o[0]-i[0],this.#Yt.lng+o[1]-i[1]])}}#Qt(e){let o=Math.sqrt((e.item(0).clientX-e.item(1).clientX)**2+(e.item(0).clientY-e.item(1).clientY)**2),i=this.#Gt,s=o-this.#qt;t.baseDialog.deltaZoomDistance<s?i++:-t.baseDialog.deltaZoomDistance>s&&i--,i=Math.min(K.map.getMaxZoom(),i),i=Math.max(K.map.getMinZoom(),i),i!==this.#Gt&&(K.map.setZoomAround(this.#$t,i),this.#Gt=i,this.#qt=o)}#te(t){this.#Ut&&1===t.changedTouches.length&&(this.#Jt(t.changedTouches.item(0)),this.#Ut=!1)}#ee(t){this.#Ut&&1===t.changedTouches.length?this.#Jt(t.changedTouches.item(0)):this.#Wt&&2===t.targetTouches.length&&this.#Qt(t.targetTouches)}#oe(t){if(1===t.targetTouches.length){const e=t.changedTouches.item(0);this.#Vt=e.screenX,this.#Xt=e.screenY,this.#Yt=K.map.getCenter(),this.#Ut=!0,this.#Wt=!1}2===t.targetTouches.length&&(this.#Gt=K.map.getZoom(),this.#$t=new ht((t.targetTouches.item(0).clientX+t.targetTouches.item(1).clientX)/2,(t.targetTouches.item(0).clientY+t.targetTouches.item(1).clientY)/2),this.#qt=Math.sqrt((t.targetTouches.item(0).clientX-t.targetTouches.item(1).clientX)**2+(t.targetTouches.item(0).clientY-t.targetTouches.item(1).clientY)**2),this.#Ut=!1,this.#Wt=!0)}constructor(t){Object.freeze(this),this.#zt=t}handleEvent(t){switch(t.currentTarget===t.target&&t.preventDefault(),t.type){case"touchstart":t.currentTarget===t.target&&this.#oe(t);break;case"touchmove":this.#ee(t);break;case"touchend":this.#te(t)}}}class oi{static get LEFT_BUTTON(){return 0}#Ut=!1;#Vt=0;#Xt=0;#Yt;#Jt(t){const e=ti.screenCoordToLatLng(this.#Vt,this.#Xt),o=ti.screenCoordToLatLng(t.screenX,t.screenY);K.map.panTo([this.#Yt.lat+e[0]-o[0],this.#Yt.lng+e[1]-o[1]])}constructor(){Object.freeze(this)}handleEvent(t){switch(t.type){case"mousedown":t.button===oi.LEFT_BUTTON&&t.target===t.currentTarget&&(this.#Vt=t.screenX,this.#Xt=t.screenY,this.#Yt=K.map.getCenter(),this.#Ut=!0);break;case"mousemove":t.button===oi.LEFT_BUTTON&&this.#Ut&&(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),this.#Jt(t));break;case"mouseup":t.button!==oi.LEFT_BUTTON||!this.#Ut||this.#Vt===t.screenX&&this.#Xt===t.screenY||this.#Jt(t),this.#Ut=!1}}}class ii{#ie=null;#se=null;#ne=null;#re=null;#ae=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#ie=t.firstButtonText;break;case"secondButtonText":this.#se=t.secondButtonText;break;case"selectOptionsData":this.#ne=t.selectOptionsData;break;case"title":this.#re=t.title;break;case"text":this.#ae=t.text}}get firstButtonText(){return this.#ie}get secondButtonText(){return this.#se}get selectOptionsData(){return this.#ne}get title(){return this.#re}get text(){return this.#ae}}class si{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Zt.objId)}}class ni{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.moveDialog(t)}}class ri{#Zt;#le;constructor(t){Object.freeze(this),this.#Zt=t,this.#le=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#le=!0,this.#Zt.setDragStartPoint(o);break;case"touchmove":this.#le=!1,t.preventDefault(),this.#Zt.moveDialog(o,e);break;case"touchend":this.#le||this.#Zt.moveDialog(o,e)}}}}class ai{static#he;static#de(){ai.#he=!0,document.removeEventListener("touchstart",ai.#de,!0)}constructor(){Object.freeze(this),ai.#he=!1,document.addEventListener("touchstart",ai.#de,!0)}get isTouch(){return ai.#he}get screenAvailable(){const t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.right=0,t.style.height=1,t.style.width=1,document.body.appendChild(t);const e=t.getBoundingClientRect(),o=e.bottom,i=e.right;return document.body.removeChild(t),Object.freeze({height:o,width:i})}}const li=new ai;class hi{#t;#ce;#ue;#me;#pe;#ge(t,e){const o=li.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-c,s=o.height-this.dialogHTMLElement.offsetHeight-c;this.#me=Math.max(Math.min(t,i),c),this.#pe=Math.max(Math.min(e,s),c)}#ve(){this.dialogHTMLElement.style.left=String(this.#me)+"px",this.dialogHTMLElement.style.top=String(this.#pe)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#me=c,this.#pe=c,this.#ce=0,this.#ue=0,this.#t=T.nextObjId}get onTop(){return 42>this.#pe}get objId(){return this.#t}centerDialog(){const e=li.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(e.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(e.width-80,800))+"px",this.#me=(e.width-this.dialogHTMLElement.clientWidth)/2,t.baseDialog.touchTopScreen&&li.isTouch?this.#pe=c:this.#pe=(e.height-this.dialogHTMLElement.clientHeight)/2,this.#ve()}moveDialog(t,e){const o=this.#me+t.screenX-this.#ce,i=this.#pe+t.screenY-this.#ue;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#ge(t,e),this.#ve()}moveDialogToLastPosition(){this.moveDialogTo(this.#me,this.#pe)}moveDialogToTopLeft(){this.#me=c,this.#pe=c,this.#ve()}setDragStartPoint(t){this.#ce=t.screenX,this.#ue=t.screenY}}class di{#fe;#ye;#_e;#Te;#be;#Le;#Ee;#we;#Me;#xe=null;#Ie(){this.#fe=W.create("div",{className:"TravelNotes-BaseDialog-DialogHTMLElement"}),this.mover.dialogHTMLElement=this.#fe}#Ce(){this.#ye=W.create("div",{className:"TravelNotes-BaseDialog-TopBarHTMLElement",draggable:!0},this.#fe),this.#we=new ri(this.mover),this.#ye.addEventListener("touchstart",this.#we,!1),this.#ye.addEventListener("touchmove",this.#we,!1),this.#ye.addEventListener("touchend",this.#we,!1),this.#ye.addEventListener("touchcancel",this.#we,!1),this.#Le=new si(this.mover),this.#ye.addEventListener("dragstart",this.#Le,!1),this.#Ee=new ni(this.mover),this.#ye.addEventListener("dragend",this.#Ee,!1),this.#_e=W.create("div",{textContent:"❌",className:"TravelNotes-BaseDialog-CancelButton",title:O.getText("BaseDialog - Cancel")},this.#ye),W.create("div",{textContent:this.title,className:"TravelNotes-BaseDialog-Title"},this.#ye),this.#Me=new V(this),this.#_e.addEventListener("click",this.#Me,!1),this.mover.topBarHTMLElement=this.#ye}#Ne(){this.toolbarHTMLElement&&W.create("div",{className:"TravelNotes-BaseDialog-ToolbarHTMLElement"},this.#fe).appendChild(this.toolbarHTMLElement)}#Pe(){this.#Te=W.create("div",{className:"TravelNotes-BaseDialog-ContentHTMLElement"},this.#fe),this.contentHTMLElements.forEach(t=>this.#Te.appendChild(t))}#Oe(){this.#Ie(),this.#Ce(),this.#Ne(),this.#Pe()}constructor(t){Object.freeze(this),this.#xe=new ii(t)}#De(){this.#ye.removeEventListener("dragstart",this.#Le,!1),this.#Le=null,this.#ye.removeEventListener("dragend",this.#Ee,!1),this.#Ee=null,this.#ye.removeEventListener("touchstart",this.#we,!1),this.#ye.removeEventListener("touchmove",this.#we,!1),this.#ye.removeEventListener("touchend",this.#we,!1),this.#ye.removeEventListener("touchcancel",this.#we,!1),this.#we=null,this.#_e.removeEventListener("click",this.#Me,!1),this.#Me=null,this.#be&&(this.#be=null)}get mover(){return this.#be?this.#be:this.#be=new hi}onCancel(){this.#De()}onOk(){this.#De()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#Oe()}removeFromBackground(t){t.removeChild(this.#fe)}addToBackground(t){t.appendChild(this.#fe)}addToDialog(t){this.#fe.appendChild(t)}get options(){return this.#xe}addCssClass(t){this.#fe.classList.add(t)}}class ci extends di{#Se;#je;#Ae;#Re;#He;#ke;#Be;#Me;#ze;#Fe;#Ze;#Ke;#Ue;#We;#Ve;#Xe;#Ye(){this.#Se=W.create("div",{className:"TravelNotes-Background"})}#Ge(){this.#Ke=new Go(this.mover),this.#Se.addEventListener("dragover",this.#Ke,!1),this.#Ve=new Xo,this.#Se.addEventListener("wheel",this.#Ve,{passive:!0}),this.#Xe=new Yo,this.#Se.addEventListener("contextmenu",this.#Xe,!1),this.#Ue=new ei(this),this.#Se.addEventListener("touchstart",this.#Ue,!1),this.#Se.addEventListener("touchmove",this.#Ue,!1),this.#Se.addEventListener("touchend",this.#Ue,!1),this.#Se.addEventListener("touchcancel",this.#Ue,!1),this.#We=new oi,this.#Se.addEventListener("mouseup",this.#We,!1),this.#Se.addEventListener("mousemove",this.#We,!1),this.#Se.addEventListener("mousedown",this.#We,!1)}#qe(){this.#je=W.create("div",{className:"TravelNotes-ModalBaseDialog-ErrorHTMLElement TravelNotes-Hidden"}),this.addToDialog(this.#je)}#$e(){W.create("div",{className:"TravelNotes-WaitAnimationBullet"},W.create("div",{className:"TravelNotes-WaitAnimation"},this.#Ae=W.create("div",{className:"TravelNotes-ModalBaseDialog-WaitHTMLElement  TravelNotes-Hidden"}))),this.addToDialog(this.#Ae)}#Je(){const t=W.create("div",{className:"TravelNotes-ModalBaseDialog-FooterHTMLElement"});this.addToDialog(t),this.#He=W.create("div",{textContent:this.options.firstButtonText||"🆗",className:"TravelNotes-BaseDialog-Button"},t),this.#Be=new Y(this),this.#He.addEventListener("click",this.#Be,!1),this.options.secondButtonText?(this.#ke=W.create("div",{textContent:this.options.secondButtonText,className:"TravelNotes-BaseDialog-Button"},t),this.#Me=new V(this),this.#ke.addEventListener("click",this.#Me,!1)):this.#ke=null,this.footerHTMLElements.forEach(e=>t.appendChild(e))}#Oe(){this.#Ye(),this.#Ge(),this.#qe(),this.#$e(),this.#Je()}#De(){this.#Se.removeEventListener("wheel",this.#Ve,{passive:!0}),this.#Ve=null,this.#Se.removeEventListener("contextmenu",this.#Xe,!1),this.#Xe=null,this.#Se.removeEventListener("dragover",this.#Ke,!1),this.#Ke=null,this.#Se.removeEventListener("touchstart",this.#Ue,!1),this.#Se.removeEventListener("touchmove",this.#Ue,!1),this.#Se.removeEventListener("touchend",this.#Ue,!1),this.#Se.removeEventListener("touchcancel",this.#Ue,!1),this.#Ue=null,this.#Se.removeEventListener("mouseup",this.#We,!1),this.#Se.removeEventListener("mousemove",this.#We,!1),this.#Se.removeEventListener("mousedown",this.#We,!1),this.#We=null,document.removeEventListener("keydown",this.#Ze,{capture:!0}),this.#Ze=null,this.#He.removeEventListener("click",this.#Be,!1),this.#Be=null,this.options.secondButtonText&&(this.#ke.removeEventListener("click",this.#Me,!1),this.#Me=null),document.body.removeChild(this.#Se)}#Qe(t,e){this.#ze=t,this.#Fe=e}constructor(t){super(t),this.#Re=!0}show(){return super.show(),this.#Oe(),this.addCssClass("TravelNotes-ModalBaseDialog"),document.body.appendChild(this.#Se),this.addToBackground(this.#Se),this.#Ze=new X(this),document.addEventListener("keydown",this.#Ze,{capture:!0}),this.mover.centerDialog(),new Promise((t,e)=>this.#Qe(t,e))}onCancel(){this.#De(),super.onCancel(),this.#Fe("Canceled by user")}canClose(){return!0}onOk(t){return!!this.canClose()&&(this.#ze(t),this.#De(),super.onOk(),!0)}showWait(){this.#Ae.classList.remove("TravelNotes-Hidden"),this.#He.classList.add("TravelNotes-Hidden")}hideWait(){this.#Ae.classList.add("TravelNotes-Hidden"),this.#He.classList.remove("TravelNotes-Hidden")}showError(t){this.#je.textContent="",P.sanitizeToHtmlElement(t,this.#je),this.#je.classList.remove("TravelNotes-Hidden")}hideError(){this.#je.textContent="",this.#je.classList.add("TravelNotes-Hidden")}get footerHTMLElements(){return[]}get keyboardELEnabled(){return this.#Re}set keyboardELEnabled(t){this.#Re=t}}class ui{#to;constructor(t){Object.freeze(this),this.#to=t}destructor(){this.#to=null}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{this.#to.addApiKeys(JSON.parse(e.result))}catch(t){this.#to.showError(t.message),t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class mi{#to;#eo;constructor(t){Object.freeze(this),this.#to=t,this.#eo=new ui(this.#to)}destructor(){this.#to=null,this.#eo.destructor()}handleEvent(t){t.stopPropagation(),this.#to.hideError(),D.openFile(this.#eo,".json")}}class pi{#oo;constructor(){Object.freeze(this),this.#oo=W.create("div",{className:"TravelNotes-BaseDialog-DataDiv"})}get controlHTMLElement(){return this.#oo}}class gi{#io=null;constructor(t){Object.freeze(this),this.#io=t}handleEvent(t){t.currentTarget.textContent="👀",t.preventDefault(),t.stopPropagation(),this.#io.type="text"}}class vi{#io;constructor(t){Object.freeze(this),this.#io=t}handleEvent(t){t.currentTarget.textContent="👁️",t.preventDefault(),t.stopPropagation(),this.#io.type="password",this.#io.focus()}}class fi extends pi{#io;#so;#no;#ro;constructor(t){super(),this.#io=W.create("input",{type:"password",dataset:{Name:t?.datasetName||"PasswordControl"}},this.controlHTMLElement),this.#so=W.create("span",{id:"TravelNotes-PasswordControl-EyeSpan",textContent:"👁️"},this.controlHTMLElement),this.#no=new gi(this.#io),this.#ro=new vi(this.#io),this.#so.addEventListener("mousedown",this.#no,!1),this.#so.addEventListener("touchstart",this.#no,!1),this.#so.addEventListener("mouseup",this.#ro,!1),this.#so.addEventListener("mouseleave",this.#ro,!1),this.#so.addEventListener("touchend",this.#ro,!1),this.#io.focus()}destructor(){this.#so.removeEventListener("mousedown",this.#no,!1),this.#so.removeEventListener("touchstart",this.#no,!1),this.#so.removeEventListener("mouseup",this.#ro,!1),this.#so.removeEventListener("mouseleave",this.#ro,!1),this.#so.removeEventListener("touchend",this.#ro,!1),this.#no=null,this.#ro=null}get value(){return this.#io.value}focus(){this.#io.focus()}}class yi extends ci{#ao;#lo;static get#ho(){return 12}constructor(t){super(),this.#lo=t}#De(){this.#ao.destructor()}createContentHTML(){this.#ao=new fi}show(){const t=super.show();return this.#ao.focus(),t}canClose(){return this.hideError(),!(this.#lo&&(this.#ao.value.length<yi.#ho||!this.#ao.value.match(/[0-9]+/)||!this.#ao.value.match(/[a-z]+/)||!this.#ao.value.match(/[A-Z]+/)||!this.#ao.value.match(/[^0-9a-zA-Z]/)))||(this.showError("<p>"+O.getText("PasswordDialog - Password rules1")+"</p><ul><li>"+O.getText("PasswordDialog - Password rules2")+"</li><li>"+O.getText("PasswordDialog - Password rules3")+"</li><li>"+O.getText("PasswordDialog - Password rules4")+"</li><li>"+O.getText("PasswordDialog - Password rules5")+"</li><li>"+O.getText("PasswordDialog - Password rules6")+"</li></ul>"),this.#ao.focus(),!1)}onCancel(){this.#De(),super.onCancel()}onOk(){super.onOk((new window.TextEncoder).encode(this.#ao.value))&&this.#De()}get contentHTMLElements(){return[this.#ao.controlHTMLElement]}get title(){return O.getText("PasswordDialog - password")}}class _i{#do;#co(t){return window.crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"])}#uo(t,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode(e),iterations:1e6,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}#mo(t,e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(e.slice(0,16))},t,new Uint8Array(e.slice(16)))}#po(t,e,o){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,o)}constructor(t){this.#do=t||"Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette.",Object.freeze(this)}encryptData(t,e,o,i){let s=window.crypto.getRandomValues(new Uint8Array(16));i.then(t=>this.#co(t)).then(t=>this.#uo(t,this.#do)).then(e=>this.#po(e,s,t)).then(t=>{e(new Blob([s,new Uint8Array(t)],{type:"application/octet-stream"}))}).catch(o)}decryptData(t,e,o,i){i.then(t=>this.#co(t)).then(t=>this.#uo(t,this.#do)).then(e=>this.#mo(e,t)).then(e).catch(o)}}class Ti{#go;constructor(t){this.#go=t,Object.freeze(this)}destructor(){this.#go=null}onErrorDecrypt(t){this.#go.hideWait(),this.#go.keyboardELEnabled=!0,t&&"Canceled by user"!==t&&this.#go.showError(O.getText("DataEncryptorHandlers - An error occurs when reading the file"))}onOkDecrypt(t){try{this.#go.addApiKeys(JSON.parse((new TextDecoder).decode(t)))}catch(t){return void this.onErrorDecrypt(t)}this.#go.hideWait(),this.#go.hideError(),this.#go.keyboardELEnabled=!0}onOkEncrypt(t){this.#go.hideError(),this.#go.hideWait(),D.saveFile("ApiKeys",t),this.#go.keyboardELEnabled=!0}onErrorEncrypt(){this.#go.showError(O.getText("DataEncryptorHandlers - An error occurs when saving the keys")),this.#go.hideWait(),this.#go.keyboardELEnabled=!0}}class bi{#to;#vo;constructor(t){Object.freeze(this),this.#to=t,this.#vo=new Ti(this.#to)}destructor(){this.#vo.destructor(),this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.hideError(),this.#to.showWait(),this.#to.keyboardELEnabled=!1,fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then(t=>{p===t.status&&t.ok?t.arrayBuffer().then(t=>{(new _i).decryptData(t,t=>{this.#vo.onOkDecrypt(t)},t=>{this.#vo.onErrorDecrypt(t)},new yi(!1).show())}):this.#vo.onErrorDecrypt(new Error("Invalid http status"))}).catch(t=>{this.#vo.onErrorDecrypt(t),t instanceof Error&&console.error(t)})}}class Li{#to;#vo;constructor(t){Object.freeze(this),this.#to=t,this.#vo=new Ti(this.#to)}destructor(){this.#vo.destructor(),this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.showWait(),this.#to.keyboardELEnabled=!1;const e=new FileReader;e.onload=()=>{(new _i).decryptData(e.result,t=>{this.#vo.onOkDecrypt(t)},t=>{this.#vo.onErrorDecrypt(t)},new yi(!1).show())},e.readAsArrayBuffer(t.target.files[0])}}class Ei{#to;#fo;constructor(t){Object.freeze(this),this.#to=t,this.#fo=new Li(this.#to)}destructor(){this.#to=null,this.#fo.destructor()}handleEvent(t){t.stopPropagation(),this.#to.hideError(),D.openFile(this.#fo)}}class wi{#to;#vo;constructor(t){Object.freeze(this),this.#to=t,this.#vo=new Ti(this.#to)}destructor(){this.#vo.destructor(),this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.validateApiKeys()&&(this.#to.showWait(),this.#to.keyboardELEnabled=!1,(new _i).encryptData((new window.TextEncoder).encode(this.#to.apiKeysJSON),t=>this.#vo.onOkEncrypt(t),()=>this.#vo.onErrorEncrypt(),new yi(!0).show()))}}class Mi{#to;constructor(t){Object.freeze(this),this.#to=t}destructor(){this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.validateApiKeys()&&D.saveFile("ApiKeys.json",this.#to.apiKeysJSON,"application/json")}}class xi{#yo;constructor(t){Object.freeze(this),this.#yo=t}destructor(){this.#yo=null}handleEvent(t){t.stopPropagation(),this.#yo.newApiKey()}}class Ii{#to;#yo;#_o;#To;#bo;#Lo;#Eo;#wo;#Mo;#xo;#Io;#Co;#No;#Po;#Oo;#Do;#So(){this.#To=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Reload from server"),textContent:"🔄"},this.#_o),this.#Io=new bi(this.#to),this.#To.addEventListener("click",this.#Io,!1)}#jo(){this.#bo=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Save to file"),textContent:"💾"},this.#_o),this.#Co=new wi(this.#to),this.#bo.addEventListener("click",this.#Co,!1)}#Ao(){this.#Lo=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Open file"),textContent:"📂"},this.#_o),this.#No=new Ei(this.#to),this.#Lo.addEventListener("click",this.#No,!1)}#Ro(){this.#Eo=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - new api key"),textContent:"+"},this.#_o),this.#Po=new xi(this.#yo),this.#Eo.addEventListener("click",this.#Po,!1)}#Ho(){this.#wo=W.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-ApiKeysDialog-AtRightButton",title:O.getText("ApiKeysDialogToolbar - Save to json file"),textContent:"💾"},this.#_o),this.#Oo=new Mi(this.#to),this.#wo.addEventListener("click",this.#Oo,!1)}#ko(){this.#Mo=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Open json file"),textContent:"📂"},this.#_o),this.#Do=new mi(this.#to),this.#Mo.addEventListener("click",this.#Do,!1)}#Bo(){window?.crypto?.subtle?.importKey&&window.isSecureContext&&(this.#xo&&this.#So(),this.#jo(),this.#Ao()),this.#Ro(),t.ApiKeysDialog.haveUnsecureButtons&&(this.#Ho(),this.#ko())}constructor(t,e,o){this.#to=t,this.#yo=e,this.#xo=o,this.#_o=W.create("div",{id:"TravelNotes-ApiKeysDialog-ToolbarDiv"}),this.#Bo(),Object.freeze(this)}destructor(){this.#To&&(this.#To.removeEventListener("click",this.#Io,!1),this.#Io.destructor(),this.#Io=null),this.#bo&&(this.#bo.removeEventListener("click",this.#Co,!1),this.#Co.destructor(),this.#Co=null),this.#Lo&&(this.#Lo.removeEventListener("click",this.#No,!1),this.#No.destructor(),this.#No=null),this.#Eo&&(this.#Eo.removeEventListener("click",this.#Po,!1),this.#Po.destructor(),this.#Po=null),this.#wo&&(this.#wo.removeEventListener("click",this.#Oo,!1),this.#Oo.destructor(),this.#Oo=null),this.#Mo&&(this.#Mo.removeEventListener("click",this.#Do,!1),this.#Do.destructor(),this.#Do=null)}get toolbarHTMLElement(){return this.#_o}}class Ci{#zo;#Fo;#Zo;#t;#Ko;#Uo;constructor(e,o){Object.freeze(this),this.#Ko=o,this.#t=T.nextObjId,this.#zo=W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"}),this.#Fo=W.create("input",{className:"TravelNotes-ApiKeysDialog-ApiKeyName TravelNotes-ApiKeysDialog-Input",value:e.providerName,placeholder:O.getText("ApiKeyControlRow - provider name")},this.#zo),this.#Zo=W.create("input",{className:"TravelNotes-ApiKeysDialog-ApiKeyValue TravelNotes-ApiKeysDialog-Input",value:e.providerKey,placeholder:O.getText("ApiKeyControlRow - api key"),type:t.ApiKeysDialog.showApiKeys?"text":"password"},this.#zo),this.#Uo=W.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-ApiKeysDialog-AtRightButton",title:O.getText("ApiKeyControlRow - delete api key"),textContent:"❌",dataset:{ObjId:this.#t}},this.#zo),this.#Uo.addEventListener("click",this.#Ko,!1)}destructor(){this.#Uo.removeEventListener("click",this.#Ko,!1)}get objId(){return this.#t}get HTMLElement(){return this.#zo}get providerName(){return this.#Fo.value}get providerKey(){return this.#Zo.value}get apiKey(){return new U(this.#Fo.value,this.#Zo.value)}}class Ni{#yo;constructor(t){Object.freeze(this),this.#yo=t}destructor(){this.#yo=null}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#yo.deleteApiKey(Number.parseInt(t.target.dataset.tanObjId))}}class Pi extends pi{#Wo;#Ko;constructor(){super(),this.#Wo=new Map,this.#Ko=new Ni(this)}destructor(){this.#Wo.forEach(t=>t.destructor()),this.#Wo.clear(),this.#Ko.destructor(),this.#Ko=null}haveEmptyOrDuplicateValues(){let t=!1;const e=[];this.#Wo.forEach(o=>{t=t||""===o.providerName||""===o.providerKey,e.push(o.providerName)});let o=!1;return e.forEach(t=>{o=o||e.indexOf(t)!==e.lastIndexOf(t)}),{haveEmpty:t,haveDuplicate:o}}addApiKeys(t){this.#Wo.clear(),t.forEach(t=>{const e=new Ci(t,this.#Ko);this.#Wo.set(e.objId,e)}),this.refreshApiKeys()}newApiKey(){const t=new U,e=new Ci(t,this.#Ko);this.#Wo.set(e.objId,e),this.refreshApiKeys()}deleteApiKey(t){this.#Wo.get(t).destructor(),this.#Wo.delete(t),this.refreshApiKeys()}refreshApiKeys(){for(;this.controlHTMLElement.firstChild;)this.controlHTMLElement.removeChild(this.controlHTMLElement.firstChild);this.#Wo.forEach(t=>{this.controlHTMLElement.appendChild(t.HTMLElement)})}get apiKeys(){const t=[];return this.#Wo.forEach(e=>t.push(e.apiKey)),t}get apiKeysJSON(){const t=[];return this.#Wo.forEach(e=>t.push(e.apiKey.jsonObject)),JSON.stringify(t)}}const Oi=new class{#Vo;#Xo;#Yo;#Go;#qo;#$o;#Jo(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),this.#Vo.classList.remove("TravelNotes-ErrorsUI-"+this.#$o),this.#Vo.classList.add("TravelNotes-Hidden"),this.#qo.classList.add("TravelNotes-Hidden"),this.#Xo.textContent=""}#Qe(e,o){if(this.#$o=o,!t.errorsUI["show"+this.#$o]||"Help"===o&&this.#Go.checked)return;this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),this.#Xo.textContent="",P.sanitizeToHtmlElement(e,this.#Xo),this.#Vo.classList.add("TravelNotes-ErrorsUI-"+this.#$o),this.#Vo.classList.remove("TravelNotes-Hidden");let i=t.errorsUI.timeOut;"Help"===this.#$o&&(this.#qo.classList.remove("TravelNotes-Hidden"),i=t.errorsUI.helpTimeOut),this.#Yo=setTimeout(()=>this.#Jo(),i)}constructor(){Object.freeze(this)}createUI(){if(this.#Vo)return;this.#Vo=W.create("div",{id:"TravelNotes-ErrorsUI",className:"TravelNotes-Hidden"},document.body);const e=W.create("div",null,this.#Vo);W.create("span",{id:"TravelNotes-ErrorsUI-CancelButton",textContent:"❌"},e).addEventListener("click",()=>this.#Jo(),!1),this.#Xo=W.create("div",{id:"TravelNotes-ErrorsUI-Message"},this.#Vo),this.#qo=W.create("div",{id:"TravelNotes-ErrorsUI-HelpInputDiv",className:"TravelNotes-Hidden"},this.#Vo),this.#Go=W.create("input",{id:"TravelNotes-ErrorsUI-HelpInput",type:"checkbox",checked:!t.errorsUI.showHelp},this.#qo),W.create("label",{id:"TravelNotes-ErrorsUI-HelpInputLabel",htmlFor:"TravelNotes-ErrorsUI-HelpInput",textContent:"Don't show help again"},this.#qo)}showError(t){this.#Qe(t,"Error")}showWarning(t){this.#Qe(t,"Warning")}showInfo(t){this.#Qe(t,"Info")}showHelp(t){this.#Qe(t,"Help")}};class Di extends ci{#Qo;#yo;#ti;#xo;constructor(t,e){super(),this.#ti=t,this.#xo=e}createContentHTML(){this.#yo=new Pi,this.#Qo=new Ii(this,this.#yo,this.#xo),this.#yo.addApiKeys(this.#ti)}#De(){this.#yo.destructor(),this.#Qo.destructor(),this.#Qo=null}validateApiKeys(){this.hideError();const t=this.#yo.haveEmptyOrDuplicateValues();return t.haveEmpty?(this.showError(O.getText("ApiKeysDialog - empty api key name or value")),!1):!t.haveDuplicate||(this.showError(O.getText("ApiKeysDialog - duplicate api key name found")),!1)}show(){return Oi.showHelp("<p>"+O.getText("Help - Complete the ApiKeys1")+"</p><p>"+O.getText("Help - Complete the ApiKeys2")+"</p><p>"+O.getText("Help - Complete the ApiKeys3")+"</p>"),super.show()}canClose(){return this.validateApiKeys()}onCancel(){this.#De(),super.onCancel()}onOk(){super.onOk(this.#yo.apiKeys)&&this.#De()}get title(){return O.getText("ApiKeysDialog - api keys")}get toolbarHTMLElement(){return this.#Qo.toolbarHTMLElement}get contentHTMLElements(){return[this.#yo.controlHTMLElement]}get apiKeysJSON(){return this.#yo.apiKeysJSON}addApiKeys(t){this.#yo.addApiKeys(t)}}const Si=new class{constructor(){Object.freeze(this)}dispatch(t,e){const o=new Event(t);e&&(o.data=e),document.dispatchEvent(o)}};const ji=new class{#xo=!1;#ei=new Map;#oi(t){this.#ii(JSON.parse((new TextDecoder).decode(t)))}#si(t){t instanceof Error&&console.error(t),t&&"Canceled by user"!==t&&Oi.showError(O.getText("ApiKeysManager - An error occurs when reading the ApiKeys file"))}#ni(t){window.isSecureContext&&window?.crypto?.subtle?.importKey&&(new _i).decryptData(t,t=>this.#oi(t),t=>this.#si(t),new yi(!1).show())}#ri(t){return this.#ei.get(t.toLowerCase())}#ai(t,e){this.#ei.set(t.toLowerCase(),e)}#li(){if(!D.storageAvailable("sessionStorage"))return 0;let t=0;for(let e=0;e<sessionStorage.length;e++){const o=sessionStorage.key(e);o.match(/^\w*ProviderKey$/)&&(this.#ai(o.replace("ProviderKey",""),atob(sessionStorage.getItem(o))),t++)}return K.providers.forEach(t=>{t.providerKeyNeeded&&(t.providerKey=this.#ri(t.name)||"")}),t}#ii(e){this.#ei.clear();const o=D.storageAvailable("sessionStorage")&&t.ApiKeys.saveToSessionStorage;o&&sessionStorage.clear(),e.forEach(t=>{o&&sessionStorage.setItem(t.providerName.toLowerCase()+"ProviderKey",btoa(t.providerKey)),this.#ai(t.providerName,t.providerKey)}),K.providers.forEach(t=>{t.providerKeyNeeded&&(t.providerKey=this.#ri(t.name)||"")}),Si.dispatch("providersadded")}constructor(){Object.freeze(this)}hasKey(t){return this.#ei.has(t.toLowerCase())}getUrl(t){if(t.providerKeyNeeded){const e=this.#ei.get(t.providerName.toLowerCase());return e?t.url.replace("{providerKey}",e):null}return t.url}setKeysFromServerFile(){let t=!1;0!==this.#li()&&(Si.dispatch("providersadded"),t=!0),fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then(e=>{p===e.status&&e.ok&&(this.#xo=!0,t||e.arrayBuffer().then(t=>this.#ni(t)))}).catch(t=>{t instanceof Error&&console.error(t)})}setKeysFromDialog(){const t=[];this.#ei.forEach((e,o)=>{t.push(new U(o,e))}),t.sort((t,e)=>t.providerName.localeCompare(e.providerName)),new Di(t,this.#xo).show().then(t=>this.#ii(t)).catch(t=>{t instanceof Error&&console.error(t)})}addProvider(t){const e=new t,o=e.name.toLowerCase();let i=this.#ri(o);e.providerKeyNeeded&&!i&&D.storageAvailable("sessionStorage")&&(i=sessionStorage.getItem(o),i&&(i=atob(i))),e.providerKeyNeeded&&i&&(e.providerKey=i),K.providers.set(e.name.toLowerCase(),e)}};const Ai=new class{#hi(t){return(t+e.d540)%e.d360-e.d180}constructor(){Object.freeze(this)}arcFromSummitArcArc(t,e,o){return Math.acos(Math.cos(e)*Math.cos(o)+Math.sin(e)*Math.sin(o)*Math.cos(t))}summitFromArcArcArc(t,e,o){return Math.acos((Math.cos(o)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(t,o){if(t[0]===o[0]&&t[1]===o[1])return 0;const i=t[0]*e.toRadians,s=o[0]*e.toRadians,n=(this.#hi(o[1])-this.#hi(t[1]))*e.toRadians;return Math.acos(Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos(n))*u}};class Ri{#di;#ci;constructor(t,e){Object.freeze(this),this.#di=t,this.#ci=e}get note(){return this.#di}get route(){return this.#ci}}class Hi{constructor(){Object.seal(this)}distance=Number.MAX_VALUE;route=null;distanceOnRoute=0;latLngOnRoute=[a.defaultValue,a.defaultValue]}const ki=new class{#ui(t,e,o){if(t.objId!==K.editedRouteObjId){const i=ti.getClosestLatLngDistance(t,e);if(i){const s=Ai.pointsDistance(e,i.latLng);s<o.distance&&(o.route=t,o.distance=s,o.latLngOnRoute=i.latLng,o.distanceOnRoute=i.distance)}}}constructor(){Object.freeze(this)}getNearestRouteData(t){const e=new Hi;return K.travel.routes.forEach(o=>this.#ui(o,t,e)),g!==K.editedRouteObjId&&this.#ui(K.travel.editedRoute,t,e),Object.freeze(e)}getRoute(t){let e=null;return e=K.travel.routes.getAt(t),e||t===K.travel.editedRoute.objId&&(e=K.travel.editedRoute),e}getNoteAndRoute(t){let e=null,o=null;if(e=K.travel.notes.getAt(t),!e){const i=K.travel.routes.iterator;for(;!i.done&&!e;)e=i.value.notes.getAt(t),e&&(o=i.value);e||(e=K.travel.editedRoute.notes.getAt(t),e&&(o=K.travel.editedRoute))}return new Ri(e,o)}getWayPoint(t){let e=K.travel.editedRoute.wayPoints.getAt(t);if(!e){const o=K.travel.routes.iterator;for(;!o.done&&!e;)e=o.value.wayPoints.getAt(t)}return e}};class Bi{#mi;#pi;#ci;static get#gi(){return"\n"}static get#vi(){return"\n\t"}static get#fi(){return"\n\t\t"}static get#yi(){return"\n\t\t\t"}static get#_i(){return"\n\t\t\t\t"}#Ti(){this.#mi='<?xml version="1.0"?>'+Bi.#gi,this.#mi+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="TravelNotes">'}#bi(t){return t.replaceAll("&","&amp;").replaceAll(/\u0027/g,"&apos;").replaceAll(/"/g,"&quot;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;")}#Li(){const t=this.#ci.wayPoints.iterator;for(;!t.done;)this.#mi+=Bi.#vi+'<wpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+Bi.#fi+this.#pi+Bi.#fi+"<name>"+this.#bi(t.value.fullName)+"</name>"+Bi.#vi+"</wpt>"}#Ei(){this.#mi+=Bi.#vi+"<rte>",this.#mi+=Bi.#fi+"<name>"+this.#bi(this.#ci.computedName)+"</name>";const t=this.#ci.itinerary.maneuvers.iterator;for(;!t.done;){const e=this.#ci.itinerary.itineraryPoints.getAt(t.value.itineraryPointObjId);this.#mi+=Bi.#fi+'<rtept lat="'+e.lat+'" lon="'+e.lng+'">'+Bi.#yi+this.#pi+Bi.#yi+"<desc>"+this.#bi(t.value.instruction)+"</desc>"+Bi.#fi+"</rtept>"}this.#mi+=Bi.#vi+"</rte>"}#wi(){this.#mi+=Bi.#vi+"<trk>",this.#mi+=Bi.#fi+"<name>"+this.#bi(this.#ci.computedName)+"</name>",this.#mi+=Bi.#fi+"<trkseg>";const t=this.#ci.itinerary.itineraryPoints.iterator;for(;!t.done;)this.#mi+=Bi.#yi+'<trkpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+Bi.#_i+this.#pi+Bi.#_i+"<ele>"+t.value.elev+"</ele>"+Bi.#yi+"</trkpt>";this.#mi+=Bi.#fi+"</trkseg>",this.#mi+=Bi.#vi+"</trk>"}#Mi(){this.#mi+=Bi.#gi+"</gpx>"}#xi(){let t=(""===K.travel.name?"":K.travel.name+" - ")+this.#ci.computedName;""===t&&(t="TravelNote"),t+=".gpx",D.saveFile(t,this.#mi,"application/xml")}constructor(){Object.freeze(this)}routeToGpx(t){this.#ci=ki.getRoute(t),this.#ci&&(this.#pi="<time>"+(new Date).toISOString()+"</time>",this.#Ti(),this.#Li(),this.#Ei(),this.#wi(),this.#Mi(),this.#xi())}}class zi extends pi{#Ii;constructor(t){super(),W.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Ii=W.create("input",{type:"checkbox",className:"TravelNotes-CheckboxInputControl-Checkbox",checked:t?.checked,dataset:{Name:t?.datasetName||"CheckboxInputControl"}},this.controlHTMLElement),W.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get checked(){return this.#Ii.checked}set checked(t){this.#Ii.checked=t}}class Fi{#Ci;#Ni;#Pi;constructor(t,e,o){Object.freeze(this),this.#Ci="number"==typeof t&&Fi.MAX_COLOR>=t&&Fi.MIN_COLOR<=t?t:Fi.MAX_COLOR,this.#Ni="number"==typeof e&&Fi.MAX_COLOR>=e&&Fi.MIN_COLOR<=e?e:Fi.MAX_COLOR,this.#Pi="number"==typeof o&&Fi.MAX_COLOR>=o&&Fi.MIN_COLOR<=o?o:Fi.MAX_COLOR}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 255}static fromCss(t){let e=new Fi;return e.cssColor=t,e}get red(){return this.#Ci}set red(t){"number"==typeof t&&Fi.MAX_COLOR>=t&&Fi.MIN_COLOR<=t&&(this.#Ci=t)}get green(){return this.#Ni}set green(t){"number"==typeof t&&Fi.MAX_COLOR>=t&&Fi.MIN_COLOR<=t&&(this.#Ni=t)}get blue(){return this.#Pi}set blue(t){"number"==typeof t&&Fi.MAX_COLOR>=t&&Fi.MIN_COLOR<=t&&(this.#Pi=t)}get cssColor(){return"#"+this.#Ci.toString(m).padStart(2,"0")+this.#Ni.toString(m).padStart(2,"0")+this.#Pi.toString(m).padStart(2,"0")}set cssColor(t){"#"===t[0]?(this.#Ci=Number.parseInt(t.substring(1,3),m),this.#Ni=Number.parseInt(t.substring(3,5),m),this.#Pi=Number.parseInt(t.substring(5,7),m)):"rgb"===t.substring(0,3)&&([this.#Ci,this.#Ni,this.#Pi]=Array.from(t.match(/[0-9]{1,3}/g),t=>Number.parseInt(t)))}}class Zi{#Oi=null;constructor(t){Object.freeze(this),this.#Oi=t}handleEvent(t){t.stopPropagation(),this.#Oi.onColorButtonClick(t.target.style["background-color"])}}class Ki{#Di;#Si;#ji;static get#Ai(){return 6}static get#Ri(){return 6}static get#Hi(){return 51}constructor(t){Object.freeze(this),this.#Si=[],this.#ji=new Zi(t),this.#Di=W.create("div",null,t.controlHTMLElement);for(let t=0;t<Ki.#Ai;++t){const t=W.create("div",null,this.#Di);for(let e=0;e<Ki.#Ri;++e){let e=W.create("div",{className:"TravelNotes-ColorControl-CellColorHTMLElement"},t);e.addEventListener("click",this.#ji,!1),this.#Si.push(e)}}}destructor(){this.#Si.forEach(t=>{t.removeEventListener("click",this.#ji,!1)}),this.#ji=null}set red(t){let e=new Fi(t,Fi.MIN_COLOR,Fi.MIN_COLOR);this.#Si.forEach(t=>{t.style["background-color"]=e.cssColor,Fi.MAX_COLOR<=e.green?(e.green=Fi.MIN_COLOR,e.blue+=Ki.#Hi):e.green+=Ki.#Hi})}}class Ui{#Oi;#ki;constructor(t,e){Object.freeze(this),this.#Oi=t,this.#ki=e}handleEvent(t){t.stopPropagation();let e=t.target.valueAsNumber*this.#ki;e=e-Math.floor(e)<Math.ceil(e)-e?Math.floor(e):Math.ceil(e),this.#Oi.onRedSliderInput(e)}}class Wi{#Bi;#zi;static get#Fi(){return 100}static get#Zi(){return 20}constructor(t){this.#zi=new Ui(t,Fi.MAX_COLOR/Wi.#Fi),this.#Bi=W.create("input",{type:"range",value:0,min:0,max:Wi.#Fi,step:Wi.#Zi},W.create("div",null,t.controlHTMLElement)),this.#Bi.addEventListener("input",this.#zi,!1),this.#Bi.focus()}destructor(){this.#Bi.removeEventListener("input",this.#zi,!1),this.#zi=null}}class Vi{#Oi;#Ki;constructor(t,e){Object.freeze(this),this.#Oi=t,this.#Ki=e}handleEvent(t){t.stopPropagation(),this.#Oi.onRgbInput(this.#Ki.cssColor)}}class Xi{#Ui;#Wi;#Vi;#Xi;#Yi;#Gi(t){W.create("text",{value:t},this.#Ui);const e=W.create("input",{type:"number",className:"TravelNotes-ColorControl-NumberInput",min:Fi.MIN_COLOR,max:Fi.MAX_COLOR},this.#Ui);return e.addEventListener("input",this.#Yi,!1),e}constructor(t){Object.freeze(this),this.#Yi=new Vi(t,this),this.#Ui=W.create("div",null,t.controlHTMLElement),this.#Wi=this.#Gi(O.getText("ColorControl - Red")),this.#Vi=this.#Gi(O.getText("ColorControl - Green")),this.#Xi=this.#Gi(O.getText("ColorControl - Blue"))}destructor(){this.#Wi.removeEventListener("input",this.#Yi,!1),this.#Vi.removeEventListener("input",this.#Yi,!1),this.#Xi.removeEventListener("input",this.#Yi,!1),this.#Yi=null}get cssColor(){return new Fi(Number.parseInt(this.#Wi.value),Number.parseInt(this.#Vi.value),Number.parseInt(this.#Xi.value)).cssColor}set cssColor(t){let e=Fi.fromCss(t);this.#Wi.value=e.red,this.#Vi.value=e.green,this.#Xi.value=e.blue}}class Yi{#qi;constructor(t){Object.freeze(this),this.#qi=W.create("div",{id:"TravelNotes-ColorControl-ColorSampleHTMLElement"},t.controlHTMLElement)}get cssColor(){return this.#qi.style["background-color"]}set cssColor(t){this.#qi.style["background-color"]=t}}class Gi extends pi{#$i;#Ji;#Ki;#Qi;constructor(t){super(),t?.headerText&&""!==t.headerText&&W.create("div",{textContent:t.headerText},this.controlHTMLElement),this.controlHTMLElement.classList.add("TravelNotes-ColorControl-ColorHTMLElement"),this.#$i=new Ki(this),this.#$i.red=0,this.#Ji=new Wi(this),this.#Ki=new Xi(this),this.#Ki.cssColor=t?.cssColor||"#ff0000",this.#Qi=new Yi(this),this.#Qi.cssColor=t?.cssColor||"#ff0000"}destructor(){this.#$i.destructor(),this.#Ji.destructor(),this.#Ki.destructor()}get cssColor(){return Fi.fromCss(this.#Qi.cssColor).cssColor}onRedSliderInput(t){this.#$i.red=t}onColorButtonClick(t){this.#Ki.cssColor=t,this.#Qi.cssColor=t}onRgbInput(t){this.#Qi.cssColor=t}}class qi extends pi{#Ii;constructor(t){super(),W.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Ii=W.create("input",{type:"number",className:"TravelNotes-NumberInputControl-NumberInput",value:t?.value||0,min:t?.min||0,max:t?.max||Number.MAX_VALUE,dataset:{Name:t?.datasetName||"NumberInputControl"}},this.controlHTMLElement),W.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get value(){return Number.parseInt(this.#Ii.value)}set value(t){this.#Ii.value=t}}class $i extends pi{#Ii;constructor(t,e){super(),W.create("div",{className:"TravelNotes-BaseDialog-FlexRow",textContent:t?.headerText||""},this.controlHTMLElement),this.#Ii=W.create("input",{className:"TravelNotes-TextInputControl-TextInput",type:"text",dataset:{Name:t?.datasetName||"TextInputControl"},value:t?.value||""},W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),e?.controlFocus&&this.#Ii.addEventListener("focus",e.controlFocus),e?.controlInput&&this.#Ii.addEventListener("input",e.controlInput),e?.controlChange&&this.#Ii.addEventListener("change",e.controlChange)}destructor(t){t?.controlFocus&&this.#Ii.removeEventListener("focus",t.controlFocus),t?.controlInput&&this.#Ii.removeEventListener("input",t.controlInput)}get value(){return this.#Ii.value}set value(t){this.#Ii.value=t}}class Ji extends pi{#ts;constructor(t){super(),W.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#ts=W.create("select",null,this.controlHTMLElement),t?.elements.forEach(t=>{this.#ts.add(W.create("option",{text:t}))})}get selectedIndex(){return this.#ts.selectedIndex}set selectedIndex(t){this.#ts.selectedIndex=t}}class Qi extends ci{#ci;#Oi;#es;#os;#is;#ss;static get#ns(){return 1}static get#rs(){return 40}constructor(t){super(),this.#ci=t}createContentHTML(){this.#es=new $i({headerText:O.getText("RoutePropertiesDialog - Name"),value:this.#ci.computedName}),this.#os=new qi({beforeText:O.getText("RoutePropertiesDialog - Width"),value:this.#ci.width,min:Qi.#ns,max:Qi.#rs}),this.#is=new Ji({beforeText:O.getText("RoutePropertiesDialog - Linetype"),elements:Array.from(t.route.dashChoices,t=>t.text)}),this.#is.selectedIndex=this.#ci.dashIndex<t.route.dashChoices.length?this.#ci.dashIndex:0,this.#ss=new zi({beforeText:O.getText("RoutePropertiesDialog - Chained route"),checked:this.#ci.chain}),this.#Oi=new Gi({cssColor:this.#ci.color,headerText:O.getText("RoutePropertiesDialog - Color")})}show(){let t=super.show();return this.addCssClass("TravelNotes-RoutePropertiesDialog"),t}onCancel(){this.#Oi.destructor(),super.onCancel()}onOk(){this.#ci.color=this.#Oi.cssColor,this.#ci.computedName!==this.#es.value&&(this.#ci.name=this.#es.value),this.#ci.width=this.#os.value,this.#ci.chain=this.#ss.checked,this.#ci.dashIndex=this.#is.selectedIndex,this.#Oi.destructor(),super.onOk()}get title(){return O.getText("RoutePropertiesDialog - Route properties")}get contentHTMLElements(){return[this.#es.controlHTMLElement,this.#os.controlHTMLElement,this.#is.controlHTMLElement,this.#ss.controlHTMLElement,this.#Oi.controlHTMLElement]}}class ts extends pi{static#t=0;#as;constructor(t){super(),this.#as=[],W.create("div",{className:"TravelNotes-BaseDialog-FlexRow",textContent:t?.headerText||""},this.controlHTMLElement);let e="controlName"+ ++ts.#t,o=0;t.buttons.forEach(i=>{let s="buttonId"+ ++ts.#t,n=W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement);this.#as.push(W.create("input",{type:"radio",className:"TravelNotes-RadioInputControl-Radio",checked:i.checked,id:s,name:e,value:String(o++),dataset:{Name:t?.datasetName||"RadioInputControl"}},n)),W.create("label",{htmlFor:s,innerText:i.label},n)})}get value(){let t=f;return this.#as.forEach(e=>{t=e.checked?Number.parseInt(e.value):t}),t}}class es{constructor(){Object.seal(this)}paperWidth=0;paperHeight=0;borderWidth=0;zoomFactor=0;printNotes=!1;firefoxBrowser=!0}class os extends ci{#ls;#hs;#ds;#cs;#us;#ms;static get#ps(){return 15}constructor(){super()}createContentHTML(){this.#ls=new qi({beforeText:O.getText("PrintRouteMapDialog - Paper width"),afterText:O.getText("PrintRouteMapDialog - Paper width units"),value:t.printRouteMap.paperWidth}),this.#hs=new qi({beforeText:O.getText("PrintRouteMapDialog - Paper height"),afterText:O.getText("PrintRouteMapDialog - Paper height units"),value:t.printRouteMap.paperHeight}),this.#ds=new qi({beforeText:O.getText("PrintRouteMapDialog - Border width"),afterText:O.getText("PrintRouteMapDialog - Border width units"),value:t.printRouteMap.borderWidth}),this.#cs=new qi({beforeText:O.getText("PrintRouteMapDialog - Zoom factor"),value:Math.min(t.printRouteMap.zoomFactor,os.#ps),min:K.map.getMinZoom(),max:Math.min(K.map.getMaxZoom(),os.#ps)}),this.#us=new zi({afterText:O.getText("PrintRouteMapDialog - Print notes"),checked:t.printRouteMap.printNotes}),this.#ms=new ts({headerText:O.getText("PrintRouteMapDialog - Print with"),buttons:[{label:"Firefox",checked:t.printRouteMap.firefoxBrowser},{label:O.getText("PrintRouteMapDialog - Another browser"),checked:!t.printRouteMap.firefoxBrowser}]})}show(){let t=super.show();return this.addCssClass("TravelNotes-PrintRouteMapDialog"),t}onOk(){const t=new es;t.paperWidth=this.#ls.value,t.paperHeight=this.#hs.value,t.borderWidth=this.#ds.value,t.zoomFactor=this.#cs.value,t.printNotes=this.#us.checked,t.firefoxBrowser=0===this.#ms.value,Object.freeze(t),super.onOk(t)}get contentHTMLElements(){return[this.#ls.controlHTMLElement,this.#hs.controlHTMLElement,this.#ds.controlHTMLElement,this.#cs.controlHTMLElement,this.#us.controlHTMLElement,this.#ms.controlHTMLElement]}get title(){return O.getText("PrintRouteMapDialog - Print")}}class is{#ie=null;#se=null;#ne=null;#re=null;#ae=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#ie=t.firstButtonText;break;case"secondButtonText":this.#se=t.secondButtonText;break;case"selectOptionsData":this.#ne=t.selectOptionsData;break;case"title":this.#re=t.title;break;case"text":this.#ae=t.text}}get firstButtonText(){return this.#ie}get secondButtonText(){return this.#se}get selectOptionsData(){return this.#ne}get title(){return this.#re}get text(){return this.#ae}}class ss{#zt;constructor(t){Object.freeze(this),this.#zt=t}handleEvent(){this.#zt.onCancel()}}class ns{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Zt.objId)}}class rs{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.moveDialog(t)}}class as{#Zt;#le;constructor(t){Object.freeze(this),this.#Zt=t,this.#le=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#le=!0,this.#Zt.setDragStartPoint(o);break;case"touchmove":this.#le=!1,t.preventDefault(),this.#Zt.moveDialog(o,e);break;case"touchend":this.#le||this.#Zt.moveDialog(o,e)}}}}class ls{#t;#ce;#ue;#me;#pe;#ge(t,e){const o=li.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-c,s=o.height-this.dialogHTMLElement.offsetHeight-c;this.#me=Math.max(Math.min(t,i),c),this.#pe=Math.max(Math.min(e,s),c)}#ve(){this.dialogHTMLElement.style.left=String(this.#me)+"px",this.dialogHTMLElement.style.top=String(this.#pe)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#me=c,this.#pe=c,this.#ce=0,this.#ue=0,this.#t=T.nextObjId}get onTop(){return 42>this.#pe}get objId(){return this.#t}centerDialog(){const e=li.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(e.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(e.width-80,800))+"px",this.#me=(e.width-this.dialogHTMLElement.clientWidth)/2,t.baseDialog.touchTopScreen&&li.isTouch?this.#pe=c:this.#pe=(e.height-this.dialogHTMLElement.clientHeight)/2,this.#ve()}moveDialog(t,e){const o=this.#me+t.screenX-this.#ce,i=this.#pe+t.screenY-this.#ue;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#ge(t,e),this.#ve()}moveDialogToLastPosition(){this.moveDialogTo(this.#me,this.#pe)}moveDialogToTopLeft(){this.#me=c,this.#pe=c,this.#ve()}setDragStartPoint(t){this.#ce=t.screenX,this.#ue=t.screenY}}class hs{#fe;#ye;#_e;#Te;#be;#Le;#Ee;#we;#Me;#xe=null;#Ie(){this.#fe=W.create("div",{className:"TravelNotes-BaseDialog-DialogHTMLElement"}),this.mover.dialogHTMLElement=this.#fe}#Ce(){this.#ye=W.create("div",{className:"TravelNotes-BaseDialog-TopBarHTMLElement",draggable:!0},this.#fe),this.#we=new as(this.mover),this.#ye.addEventListener("touchstart",this.#we,!1),this.#ye.addEventListener("touchmove",this.#we,!1),this.#ye.addEventListener("touchend",this.#we,!1),this.#ye.addEventListener("touchcancel",this.#we,!1),this.#Le=new ns(this.mover),this.#ye.addEventListener("dragstart",this.#Le,!1),this.#Ee=new rs(this.mover),this.#ye.addEventListener("dragend",this.#Ee,!1),this.#_e=W.create("div",{textContent:"❌",className:"TravelNotes-BaseDialog-CancelButton",title:O.getText("BaseDialog - Cancel")},this.#ye),W.create("div",{textContent:this.title,className:"TravelNotes-BaseDialog-Title"},this.#ye),this.#Me=new ss(this),this.#_e.addEventListener("click",this.#Me,!1),this.mover.topBarHTMLElement=this.#ye}#Ne(){this.toolbarHTMLElement&&W.create("div",{className:"TravelNotes-BaseDialog-ToolbarHTMLElement"},this.#fe).appendChild(this.toolbarHTMLElement)}#Pe(){this.#Te=W.create("div",{className:"TravelNotes-BaseDialog-ContentHTMLElement"},this.#fe),this.contentHTMLElements.forEach(t=>this.#Te.appendChild(t))}#Oe(){this.#Ie(),this.#Ce(),this.#Ne(),this.#Pe()}constructor(t){Object.freeze(this),this.#xe=new is(t)}#De(){this.#ye.removeEventListener("dragstart",this.#Le,!1),this.#Le=null,this.#ye.removeEventListener("dragend",this.#Ee,!1),this.#Ee=null,this.#ye.removeEventListener("touchstart",this.#we,!1),this.#ye.removeEventListener("touchmove",this.#we,!1),this.#ye.removeEventListener("touchend",this.#we,!1),this.#ye.removeEventListener("touchcancel",this.#we,!1),this.#we=null,this.#_e.removeEventListener("click",this.#Me,!1),this.#Me=null,this.#be&&(this.#be=null)}get mover(){return this.#be?this.#be:this.#be=new ls}onCancel(){this.#De()}onOk(){this.#De()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#Oe()}removeFromBackground(t){t.removeChild(this.#fe)}addToBackground(t){t.appendChild(this.#fe)}addToDialog(t){this.#fe.appendChild(t)}get options(){return this.#xe}addCssClass(t){this.#fe.classList.add(t)}}class ds extends hs{#Ke;#Ge(){this.#Ke=new Go(this.mover),document.body.addEventListener("dragover",this.#Ke,!1)}constructor(){super()}onCancel(){document.body.removeEventListener("dragover",this.#Ke,!1),this.#Ke=null,super.onCancel(),this.removeFromBackground(document.body)}show(){super.show(),this.#Ge(),this.addToBackground(document.body)}}class cs{#ci;#gs;#vs;#fs;#ys;#_s;#Ts;static get PROFILE_MARGIN(){return 100}static get PROFILE_HEIGHT(){return 500}static get PROFILE_WIDTH(){return 1e3}static get X_DELTA_TEXT(){return 10}static get Y_DELTA_TEXT(){return 30}static get#bs(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}static get#Ls(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3]}static get#Es(){return 8}static get#ws(){return 4}static get#Ms(){return cs.PROFILE_MARGIN.toFixed(0)}static get#xs(){return(cs.PROFILE_MARGIN+cs.PROFILE_WIDTH).toFixed(0)}static get#Is(){return cs.PROFILE_MARGIN.toFixed(0)}static get#Cs(){return(cs.PROFILE_MARGIN+cs.PROFILE_HEIGHT).toFixed(0)}static get#Ns(){return(cs.PROFILE_MARGIN-cs.X_DELTA_TEXT).toFixed(0)}static get#Ps(){return(cs.PROFILE_MARGIN+cs.PROFILE_WIDTH+cs.X_DELTA_TEXT).toFixed(0)}static get#Os(){return cs.PROFILE_MARGIN+cs.PROFILE_HEIGHT+cs.PROFILE_MARGIN/2}#Ds(){let t="",e=0,o=0,i=0;this.#ci.itinerary.itineraryPoints.forEach(s=>{o=(cs.PROFILE_MARGIN+this.#fs*e).toFixed(0),i=(cs.PROFILE_MARGIN+this.#vs*(this.#_s-s.elev)).toFixed(0),t+=o+","+i+" ",e+=s.distance});const s=document.createElementNS(y,"polyline");s.setAttributeNS(null,"points",t),s.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-profilePolyline"),this.#gs.appendChild(s)}#Ss(){const t=cs.#Ms+","+cs.#Is+" "+cs.#Ms+","+cs.#Cs+" "+cs.#xs+","+cs.#Cs+" "+cs.#xs+","+cs.#Is,e=document.createElementNS(y,"polyline");e.setAttributeNS(null,"points",t),e.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-framePolyline"),this.#gs.appendChild(e)}#js(){let t=Number.MAX_VALUE,e=0;cs.#bs.forEach(o=>{const i=Math.abs(this.#ci.distance/cs.#Es-o);i<t&&(t=i,e=o)});let i=Math.ceil(this.#ci.chainedDistance/e)*e;for(;i<this.#ci.distance+this.#ci.chainedDistance;){const t=document.createElementNS(y,"text");t.appendChild(document.createTextNode(o.metersInKm<e||0<this.#ci.chainedDistance?i/o.metersInKm+" km":i+" m ")),t.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-distLegend"),t.setAttributeNS(null,"x",cs.PROFILE_MARGIN+(i-this.#ci.chainedDistance)*this.#fs),t.setAttributeNS(null,"y",cs.#Os),t.setAttributeNS(null,"text-anchor","start"),this.#gs.appendChild(t),i+=e}}#As(){let t=Number.MAX_VALUE,e=0;cs.#Ls.forEach(o=>{const i=Math.abs(this.#Ts/cs.#ws-o);i<t&&(t=i,e=o)});let o=Math.ceil(this.#ys/e)*e;for(;o<this.#_s;){const t=cs.PROFILE_MARGIN+(this.#_s-o)*this.#vs,i=document.createElementNS(y,"text");i.appendChild(document.createTextNode(o.toFixed(0))),i.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),i.setAttributeNS(null,"x",cs.#Ps),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"text-anchor","start"),this.#gs.appendChild(i);const s=document.createElementNS(y,"text");s.appendChild(document.createTextNode(o.toFixed(0))),s.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),s.setAttributeNS(null,"x",cs.#Ns),s.setAttributeNS(null,"y",t),s.setAttributeNS(null,"text-anchor","end"),this.#gs.appendChild(s),o+=e}}#Rs(){this.#gs=document.createElementNS(y,"svg"),this.#gs.setAttributeNS(null,"viewBox","0 0 "+(cs.PROFILE_WIDTH+2*cs.PROFILE_MARGIN)+" "+(cs.PROFILE_HEIGHT+2*cs.PROFILE_MARGIN)),this.#gs.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile")}constructor(){Object.freeze(this)}createSvg(t){return this.#ci=t,this.#ys=Number.MAX_VALUE,this.#_s=0,this.#ci.itinerary.itineraryPoints.forEach(t=>{this.#_s=Math.max(this.#_s,t.elev),this.#ys=Math.min(this.#ys,t.elev)}),this.#Ts=this.#_s-this.#ys,this.#vs=cs.PROFILE_HEIGHT/this.#Ts,this.#fs=cs.PROFILE_WIDTH/this.#ci.distance,this.#Rs(),this.#Ds(),this.#Ss(),this.#As(),this.#js(),this.#gs}}class us{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.onKeydownKeyboard(t.key)}}class ms{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.onCancelMenu()}}class ps{#ks=null;#Bs=null;static get#zs(){return 100}static get#Fs(){return 30}#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){if(1===t.changedTouches.length){const e=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#ks=e.clientX,this.#Bs=e.clientY;break;case"touchend":this.#ks&&this.#Bs&&ps.#zs<this.#Bs-e.clientY&&ps.#Fs>Math.abs(this.#ks-e.clientX)&&this.#Hs.onCancelMenu(),this.#ks=null,this.#Bs=null;break;case"touchcancel":this.#ks=null,this.#Bs=null}}}}class gs{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.onMouseLeaveMenuItem(t.currentTarget)}}class vs{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.onMouseEnterMenuItem(t.currentTarget)}}class fs{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.selectItem(Number.parseInt(t.currentTarget.dataset.tanObjId))}}class ys{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.onMouseLeaveContainer()}}class _s{#Hs=null;constructor(t){Object.freeze(this),this.#Hs=t}handleEvent(t){t.stopPropagation(),this.#Hs.onMouseEnterContainer()}}class Ts{static#Zs=Object.freeze({get previousItem(){return-1},get firstItem(){return 0},get nextItem(){return 1},get lastItem(){return 2}});#Ks=null;#Us;#Ws;#Vs;#Xs;#Ys;#Gs;#qs;#$s;#Js=f;#Yo=null;#Qs(){this.#Ks.menuItemHTMLElements.forEach(t=>{t.classList.remove("TravelNotes-ContextMenu-MenuItemSelected")})}#tn(t){switch(this.#Qs(),t){case Ts.#Zs.previousItem:case Ts.#Zs.nextItem:this.#Js+=t,f===this.#Js&&(this.#Js=this.#Ks.menuItemHTMLElements.length-1),this.#Ks.menuItemHTMLElements.length===this.#Js&&(this.#Js=0);break;case Ts.#Zs.firstItem:this.#Js=0;break;case Ts.#Zs.lastItem:this.#Js=this.#Ks.menuItemHTMLElements.length-1}this.#Ks.menuItemHTMLElements[this.#Js].classList.add("TravelNotes-ContextMenu-MenuItemSelected")}constructor(t){Object.freeze(this),this.#Ks=t,this.#Us=new us(this),this.#Ws=new ys(this),this.#Vs=new _s(this),this.#Xs=new ms(this),this.#Ys=new ps(this),this.#Gs=new fs(this),this.#qs=new gs(this),this.#$s=new vs(this),document.addEventListener("keydown",this.#Us,!0),this.#Ks.contextMenuHTMLElement.addEventListener("mouseleave",this.#Ws),this.#Ks.contextMenuHTMLElement.addEventListener("mouseenter",this.#Vs),this.#Ks.contextMenuHTMLElement.addEventListener("touchstart",this.#Ys),this.#Ks.contextMenuHTMLElement.addEventListener("touchend",this.#Ys),this.#Ks.contextMenuHTMLElement.addEventListener("touchcancel",this.#Ys),this.#Ks.cancelButton.addEventListener("click",this.#Xs),this.#Ks.menuItemHTMLElements.forEach(t=>{t.addEventListener("click",this.#Gs),t.addEventListener("mouseleave",this.#qs),t.addEventListener("mouseenter",this.#$s)})}destructor(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),document.removeEventListener("keydown",this.#Us,!0),this.#Ks.contextMenuHTMLElement.removeEventListener("mouseleave",this.#Ws),this.#Ks.contextMenuHTMLElement.removeEventListener("mouseenter",this.#Vs),this.#Ks.contextMenuHTMLElement.removeEventListener("touchstart",this.#Ys),this.#Ks.contextMenuHTMLElement.removeEventListener("touchend",this.#Ys),this.#Ks.contextMenuHTMLElement.removeEventListener("touchcancel",this.#Ys),this.#Ks.cancelButton.removeEventListener("click",this.#Xs),this.#Ks.menuItemHTMLElements.forEach(t=>{t.removeEventListener("click",this.#Gs),t.removeEventListener("mouseleave",this.#qs),t.removeEventListener("mouseenter",this.#$s)}),this.#Us=null,this.#Ws=null,this.#Vs=null,this.#Xs=null,this.#Ys=null,this.#Gs=null,this.#qs=null,this.#$s=null,document.body.removeChild(this.#Ks.contextMenuHTMLElement),this.#Ks=null}onMouseLeaveContainer(){this.#Yo=setTimeout(()=>this.onCancelMenu(),t.contextMenu.timeout)}onMouseEnterContainer(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null)}onKeydownKeyboard(t){switch(t){case"Escape":case"Esc":this.onCancelMenu();break;case"ArrowDown":case"ArrowRight":case"Tab":this.#tn(Ts.#Zs.nextItem);break;case"ArrowUp":case"ArrowLeft":this.#tn(Ts.#Zs.previousItem);break;case"Home":this.#tn(Ts.#Zs.firstItem);break;case"End":this.#tn(Ts.#Zs.lastItem);break;case"Enter":if(f===this.#Js||this.#Ks.menuItemHTMLElements[this.#Js].classList.contains("TravelNotes-ContextMenu-ItemDisabled"))return;this.#Ks.onOk(this.#Js)}}onCancelMenu(){this.#Ks.onCancel("Canceled by user")}selectItem(t){this.#Ks.menuItemHTMLElements[t].classList.contains("TravelNotes-ContextMenu-ItemDisabled")||this.#Ks.onOk(t)}onMouseLeaveMenuItem(t){t.classList.remove("TravelNotes-ContextMenu-MenuItemSelected")}onMouseEnterMenuItem(t){this.#Qs(),this.#Js=Number.parseInt(t.dataset.tanObjId),t.classList.add("TravelNotes-ContextMenu-MenuItemSelected")}}class bs{#ks;#Bs;#en;#on;#in;static#sn=null;#nn;#rn;#an;#_e;#ln;#Hs;static get#hn(){return 20}static get isActive(){return Boolean(bs.#sn)}#dn(){this.#an=W.create("div",{className:"TravelNotes-ContextMenu-ContextMenuHTMLElement"},document.body)}#cn(){this.#_e=W.create("div",{textContent:"❌",className:"TravelNotes-ContextMenu-CancelButton",title:O.getText("BaseContextMenu - Close")},this.#an)}#un(){this.#ln=[],this.menuItems.forEach((t,e)=>{const o=W.create("div",{textContent:t.itemText,className:"TravelNotes-ContextMenu-MenuItem",dataset:{ObjId:String(e)}},this.#an);t.isActive||o.classList.add("TravelNotes-ContextMenu-MenuItemDisabled"),this.#ln.push(o)})}#mn(){const t=li.screenAvailable,e=Math.min(this.#Bs,t.height-this.#an.clientHeight-bs.#hn);this.#an.style.top=String(e)+"px";const o=Math.min(this.#ks,t.width-this.#an.clientWidth-bs.#hn);this.#an.style.left=String(o)+"px"}#pn(t,e){this.#nn=t,this.#rn=e,this.#dn(),this.#cn(),this.#un(),this.#mn(),this.#Hs=new Ts(this)}constructor(t,e){Object.freeze(this),bs.#sn?bs.#sn.onCancel():(this.#ks=t.clientX||t.originalEvent.clientX||0,this.#Bs=t.clientY||t.originalEvent.clientY||0,this.#en=[t.latlng?t.latlng.lat:a.defaultValue,t.latlng?t.latlng.lng:a.defaultValue],this.#on=t.target?.objId??(Number.parseInt(t?.currentTarget?.dataset?.tanObjId)||g),this.#in=Boolean(e),bs.#sn=this)}onOk(t){this.#Hs.destructor(),bs.#sn=null,this.#nn(t)}onCancel(){this.#Hs.destructor(),bs.#sn=null,this.#rn()}show(){bs.#sn&&new Promise((t,e)=>{this.#pn(t,e)}).then(t=>this.menuItems[t].doAction()).catch(t=>{t&&console.error(t)})}get menuItems(){return[]}get contextMenuHTMLElement(){return this.#an}get cancelButton(){return this.#_e}get menuItemHTMLElements(){return this.#ln}get clientX(){return this.#ks}get clientY(){return this.#Bs}get latLng(){return this.#en}get targetObjId(){return this.#on}get haveParentNode(){return this.#in}}class Ls{#gn;#vn;#fn;constructor(t,e,o){Object.freeze(this),this.#gn=t,this.#vn=e,this.#fn=o}get itemText(){return this.#gn}get isActive(){return this.#vn}doAction(){this.#fn()}}class Es{#U;#yn;#_n;#_t;#Tn;constructor(t){this.#U="string"==typeof t?.name?P.sanitizeToJsString(t.name):"?",this.#yn="string"==typeof t.icon?P.sanitizeToHtmlString(t?.icon).htmlString:"?",this.#_n="string"==typeof t?.tooltip?P.sanitizeToHtmlString(t.tooltip).htmlString:"?",this.#_t="number"==typeof t?.width?t.width:n.width,this.#Tn="number"==typeof t?.height?t.height:n.height}get name(){return this.#U}get icon(){return this.#yn}get tooltip(){return this.#_n}get width(){return this.#_t}get height(){return this.#Tn}}class ws{#re;#bn;#Ln;constructor(t){if(Object.freeze(this),"string"!=typeof t?.title||"string"!=typeof t?.htmlBefore||t.htmlAfter&&"string"!=typeof t.htmlAfter)throw new Error("Invalid toolbar button");let e=(t.htmlBefore||"")+(t.htmlAfter||""),o=P.sanitizeToHtmlString(e).errorsString;if(""!==o)throw new Error("Invalid toolbar button : "+e+o);this.#re=P.sanitizeToHtmlString(t.title).htmlString,""===this.title&&(this.title="?"),this.#bn=t.htmlBefore||"",this.#Ln=t.htmlAfter||""}get title(){return this.#re}get htmlBefore(){return this.#bn}get htmlAfter(){return this.#Ln}}const Ms=new class{#En;#wn;#Mn;constructor(){Object.freeze(this),this.#En=[],this.#wn=new Map,this.#Mn=[]}get editionButtonsData(){return this.#En}get preDefinedIconsData(){return this.#Mn}preDefinedIconDataAt(t){return this.#Mn[t]}preDefinedIconDataFromName(t){const e=this.#wn.get(t);return e?e.icon:""}loadJson(t){if(t.editionButtons&&t.editionButtons.forEach(t=>{try{let e=new ws(t);this.#En.push(e)}catch(t){console.error(t.message)}}),t.preDefinedIconsList){t.preDefinedIconsList.forEach(t=>{const e=new Es(t);this.#wn.set(e.name,e)}),this.#Mn.length=0;for(const t of this.#wn)this.#Mn.push(t[1]);this.#Mn=this.#Mn.sort((t,e)=>t.name.localeCompare(e.name))}}};class xs{#xn;#In;#Cn;#Nn;#Pn(){this.#In=W.create("select",{className:"TravelNotes-NoteDialog-Select",id:"TravelNotes-NoteDialog-IconSelect"},this.#xn),Ms.preDefinedIconsData.forEach(t=>{this.#In.add(W.create("option",{text:t.name}))}),this.#In.selectedIndex=f}#Bo(){this.#Cn=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("NoteDialogToolbar - Open a configuration file"),textContent:"📂"},this.#xn)}#On(){Ms.editionButtonsData.forEach(t=>{const e=W.create("div",{dataset:{HtmlBefore:t.htmlBefore,HtmlAfter:t.htmlAfter},className:"TravelNotes-NoteDialog-EditorButton"},this.#xn);P.sanitizeToHtmlElement(t.title,e),this.#Nn.push(e)})}#Dn(){this.#Pn(),this.#Bo(),this.#On()}#Sn(t){this.#In.addEventListener("change",t.iconSelectorChange),this.#Nn.forEach(e=>{e.addEventListener("click",t.editionButtonsClick)}),this.#Cn.addEventListener("click",t.openCfgFileButtonClick,!1)}#jn(t){this.#In.removeEventListener("change",t.iconSelectorChange),this.#Nn.forEach(e=>{e.removeEventListener("click",t.editionButtonsClick)}),this.#Cn.removeEventListener("click",t.openCfgFileButtonClick,!1)}constructor(t){Object.freeze(this),this.#Nn=[],this.#xn=W.create("div",{id:"TravelNotes-NoteDialog-ToolbarDiv"}),this.#Dn(),this.#Sn(t)}destructor(t){this.#jn(t)}update(t){this.#jn(t),this.#xn.textContent="",this.#Nn=[],this.#Dn(),this.#Sn(t)}get rootHTMLElement(){return this.#xn}}class Is{#en;#ci;constructor(t,e){Object.freeze(this),this.#en=t,this.#ci=e}get latLng(){return this.#en}get route(){return this.#ci}}class Cs extends pi{#An;constructor(t,e){super(),W.create("div",{textContent:t?.headerText||"",className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement),this.#An=W.create("textarea",{className:"TravelNotes-TextAreaControl-TextArea",placeholder:t?.placeholder||"",rows:t.rows||2,dataset:{Name:t?.datasetName||"TextAreaControl"}},W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),e.controlFocus&&this.#An.addEventListener("focus",e.controlFocus),e.controlInput&&this.#An.addEventListener("input",e.controlInput)}destructor(t){t.controlFocus&&this.#An.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#An.removeEventListener("input",t.controlInput)}get value(){return this.#An.value}set value(t){this.#An.value=t}}class Ns extends pi{#Rn;#Hn;constructor(t){super();const e=W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement);this.#Hn=W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("AddressControl - Reset address"),textContent:"🔄"},e),W.create("text",{value:O.getText("AddressControl - Address")},e),this.#Rn=W.create("input",{type:"text",className:"TravelNotes-AdressControl-InputText",dataset:{Name:"address"}},W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),t.controlFocus&&this.#Rn.addEventListener("focus",t.controlFocus),t.controlInput&&this.#Rn.addEventListener("input",t.controlInput),t.addressButtonClick&&this.#Hn.addEventListener("click",t.addressButtonClick)}destructor(t){t.controlFocus&&this.#Rn.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#Rn.removeEventListener("input",t.controlInput),t.addressButtonClick&&this.#Hn.removeEventListener("click",t.addressButtonClick)}get address(){return this.#Rn.value}set address(t){this.#Rn.value=t}}class Ps{searchPlaces=!0;searchWays=!0;searchRelations=!0;setGeometry=!0;constructor(){Object.seal(this)}}class Os{#xe;#kn;#Bn;#zn;#Fn;#Zn;#Kn;#en;#Un;#Wn;#Vn;#Xn(){this.#Bn.forEach(t=>{t.geometry=[[]],t.lat=a.defaultValue,t.lon=a.defaultValue;let e=0;t.nodes.forEach(o=>{const i=this.#kn.get(o);t.geometry[0].push([i.lat,i.lon]),t.lat+=i.lat,t.lon+=i.lon,e++}),0!==e&&(t.lat/=e,t.lon/=e)}),this.#zn.forEach(t=>{t.geometry=[[]],t.lat=a.defaultValue,t.lon=a.defaultValue;let e=0;t.members.forEach(o=>{if("way"===o.type){const i=this.#Bn.get(o.ref);t.geometry.push(i.geometry[0]),t.lat+=i.lat,t.lon+=i.lon,e++}}),0!==e&&(t.lat/=e,t.lon/=e)})}#Yn(e){e.forEach(e=>{switch(e.type){case"node":if(this.#kn.set(e.id,e),e?.tags?.place&&this.#xe.searchPlaces&&this.#Kn[e.tags.place]&&e?.tags?.name){const t=Ai.pointsDistance(this.#en,[e.lat,e.lon]),o=this.#Kn[e.tags.place];o.maxDistance>t&&o.distance>t&&(o.distance=t,o.name=e.tags.name)}break;case"way":this.#xe.searchWays&&this.#Bn.set(e.id,e);break;case"relation":this.#xe.searchRelations&&this.#zn.set(e.id,e);break;case"area":if(this.#xe.searchPlaces){let o=e.tags.name;"*"!==t.nominatim.language&&e.tags["name:"+t.nominatim.language]&&(o=e.tags["name:"+t.nominatim.language]),this.#Fn[Number.parseInt(e.tags.admin_level)]=o,"2"===e.tags.admin_level&&(this.#Zn=t.geoCoder.osmCityAdminLevel[e.tags["ISO3166-1"]]||this.#Zn)}}}),this.#xe.setGeometry&&this.#Xn(),this.#xe.searchPlaces&&this.#Gn()}#Gn(){let t=null;for(let e=2;e<this.#Fn.length;e++)void 0!==this.#Fn[e]&&(this.#Zn>=e?this.#Wn=this.#Fn[e]:t=this.#Fn[e]);let e=Number.MAX_VALUE;Object.values(this.#Kn).forEach(t=>{t.distance<e&&(e=t.distance,this.#Un=t.name)}),this.#Un=t||this.#Un,this.#Un===this.#Wn&&(this.#Un=null)}async#qn(t){for(let e=0;e<t.length;e++)if("fulfilled"===t[e].status&&p===t[e].value.status&&t[e].value.ok){const o=await t[e].value.json();this.#Yn(o.elements)}else this.#Vn=!1,console.error("An error occurs when calling theOverpassAPI: "),console.error(t[e])}constructor(t){if(Object.freeze(this),this.#xe=new Ps,t)for(const[e,o]of Object.entries(t))this.#xe[e]&&(this.#xe[e]=o);this.#kn=new Map,this.#Bn=new Map,this.#zn=new Map}async loadData(e,o){this.#en=o,this.#Vn=!0,this.#Fn=[],this.#Zn=t.geoCoder.osmCityAdminLevel.DEFAULT,this.#Kn=Object.freeze({hamlet:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.hamlet}),village:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.village}),city:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.city}),town:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.town})}),this.#Un=null,this.#Wn=null,this.#kn.clear(),this.#Bn.clear(),this.#zn.clear();const i=[];e.forEach(e=>{i.push(fetch(t.overpassApi.url+"?data=[out:json][timeout:"+t.overpassApi.timeOut+"];"+e))}),await Promise.allSettled(i).then(t=>this.#qn(t))}get nodes(){return this.#kn}get ways(){return this.#Bn}get relations(){return this.#zn}get place(){return this.#Un}get city(){return this.#Wn}get country(){return this.#Fn[2]}get statusOk(){return this.#Vn}}class Ds{#$n=!1;#U="";#Jn="";#Wn="";#Qn="";#tr(t,e){t.error||e.error?this.#$n=!1:(this.#U=e?.namedetails?.name??"",e.address.house_number&&(this.#Jn=e.address.house_number+" "),e.address.road?this.#Jn+=e.address.road+" ":e.address.pedestrian&&(this.#Jn+=e.address.pedestrian+" "),this.#Wn=t.address.city||t.address.town||t.address.municipality||t.address.village||"",this.#Qn=e.address.country,this.#$n=!0)}constructor(){Object.freeze(this)}async loadData(e){this.#$n=!1;const o=t.nominatim.url+"reverse?format=json&lat="+e[0]+"&lon="+e[1];let i=o+"&zoom=10&addressdetails=1&namedetails=0",s=o+"&zoom=18&addressdetails=1&namedetails=1";const n=t.nominatim.language;n&&"*"!==n&&(i+="&accept-language="+n,s+="&accept-language="+n);const r=new Headers;n&&"*"===n&&r.append("accept-language","");const a=await fetch(i,{headers:r}),l=await fetch(s,{headers:r});p===a.status&&a.ok&&p===l.status&&l.ok?this.#tr(await a.json(),await l.json()):this.#$n=!1}get name(){return this.#$n?this.#U:null}get street(){return this.#$n?this.#Jn:null}get city(){return this.#$n?this.#Wn:null}get country(){return this.#$n?this.#Qn:null}}class Ss{#U;#Jn;#Wn;constructor(t,e,o){Object.freeze(this),this.#U=P.sanitizeToJsString(t),this.#Jn=P.sanitizeToJsString(e),this.#Wn=P.sanitizeToJsString(o)}get name(){return this.#U}get street(){return this.#Jn}get city(){return this.#Wn}}class js{static get#er(){return Math.max(t.geoCoder.distances.hamlet,t.geoCoder.distances.village,t.geoCoder.distances.city,t.geoCoder.distances.town)}#en;#or;#ir;#sr(){let t=this.#ir.city||this.#ir.country||"";const e=this.#or.place;e&&e!==t&&(t+=" ("+e+")");let o=(this.#ir.street||"").replaceAll(";"," "),i=this.#ir.name||"";return(o.includes(i)||t.includes(i))&&(i=""),new Ss(i,o,t)}#nr(){return["node(around:"+js.#er+","+this.#en[0]+","+this.#en[1]+")[place];out;"]}async#rr(){return await this.#or.loadData(this.#nr(),this.#en),await this.#ir.loadData(this.#en),this.#sr()}async#ar(t,e){t(await this.#rr())}constructor(){Object.freeze(this),this.#or=new Os({searchWays:!1,searchRelations:!1,setGeometry:!0}),this.#ir=new Ds({searchPlaces:!0,searchWays:!1,searchRelations:!1,setGeometry:!1})}async getAddressAsync(t){return this.#en=t,this.#rr()}getAddressWithPromise(t){return this.#en=t,new Promise((t,e)=>this.#ar(t,e))}}class As{#lr;#hr(t){this.#lr.hideWait();let e=t.street;""!==t.city&&(e+=" "+t.city),this.#lr.setControlsValues({address:e,name:t.name}),this.#lr.updatePreview&&this.#lr.updatePreview({address:e})}constructor(t){Object.freeze(this),this.#lr=t}setAddressWithGeoCoder(t){this.#lr.showWait(),this.#lr.hideError(),(new js).getAddressWithPromise(t).then(t=>{this.#hr(t)}).catch(t=>{t&&console.error(t),this.#lr.hideWait(),this.#lr.showError(O.getText("NoteDialogGeoCoderHelper - an error occurs when searching the adress"))})}}class Rs extends pi{#dr=null;#cr=null;constructor(t){super(),W.create("text",{value:O.getText("NoteDialogIconDimsControl - Icon width")},this.controlHTMLElement),this.#dr=W.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",value:n.width,dataset:{Name:"iconWidth"}},this.controlHTMLElement),W.create("text",{value:O.getText("NoteDialogIconDimsControl - Icon height")},this.controlHTMLElement),this.#cr=W.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",value:n.height,dataset:{Name:"iconHeight"}},this.controlHTMLElement),this.#dr.addEventListener("input",t.controlInput),this.#cr.addEventListener("input",t.controlInput)}destructor(t){this.#dr.removeEventListener("input",t.controlInput),this.#cr.removeEventListener("input",t.controlInput)}get iconWidth(){return Number.parseInt(this.#dr.value)}set iconWidth(t){this.#dr.value=t}get iconHeight(){return Number.parseInt(this.#cr.value)}set iconHeight(t){this.#cr.value=t}}class Hs extends pi{#ur;#mr(e,o){t.noteDialog.theDevil.addButton&&W.create("text",{value:"👿"},W.create("a",{href:"https://www.google.com/maps/@"+e[0].toFixed(a.fixed)+","+e[1].toFixed(a.fixed)+","+t.noteDialog.theDevil.zoomFactor+"z",target:"_blank",title:"Reminder! The devil will know everything about you"},W.create("div",{className:"TravelNotes-BaseDialog-Button",title:"Reminder! The devil will know everything about you"},o)))}constructor(t,e){super();const o=W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement);this.#mr(e,o),W.create("text",{value:O.getText("NoteDialogLinkControl - Link")},o),this.#ur=W.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",dataset:{Name:"url"}},W.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),this.#ur.addEventListener("focus",t.controlFocus),this.#ur.addEventListener("input",t.controlInput),this.#ur.addEventListener("blur",t.urlInputBlur)}destructor(t){this.#ur.removeEventListener("focus",t.controlFocus),this.#ur.removeEventListener("input",t.controlInput),this.#ur.removeEventListener("blur",t.urlInputBlur)}get url(){return this.#ur.value}set url(t){this.#ur.value=t}}class ks{static get#pr(){return 40}static get#gr(){return 40}constructor(){Object.freeze(this)}getNoteTextAndIconHTML(e,o){const i=W.create("div",{dataset:{ObjId:o.note.objId}}),s=W.create("div",{className:e+(o.route?"Route-ManeuversAndNotes-IconCell":"Travel-Notes-IconCell")},i);let r=1;P.sanitizeToHtmlElement(o.note.iconContent,s),"TravelNotes-Roadbook-"===e&&s.firstChild&&("svg"===s.firstChild.tagName?(s.firstChild.setAttributeNS(null,"viewBox","0 0 "+n.svgViewboxDim+" "+n.svgViewboxDim),r=t.note.svgIcon.roadbookFactor):s?.firstChild?.classList?.contains("TravelNotes-MapNoteCategory-0073")&&(r=t.note.svgIcon.roadbookFactor)),s.dataset.tanWidth=String(o.note.iconWidth*r)+"px",s.dataset.tanHeight=String(o.note.iconHeight*r)+"px",s.style.width=String(o.note.iconWidth*r)+"px",s.style.height=String(o.note.iconHeight*r)+"px";const a=this.getNoteTextHTML(e,o);return a.className=e+(o.route?"Route-ManeuversAndNotes-Cell":"Travel-Notes-Cell"),i.appendChild(a),i}getNoteTextHTML(t,e){const o=e.note,i=W.create("div");if(0!==o.tooltipContent.length&&P.sanitizeToHtmlElement(o.tooltipContent,W.create("div",{className:t+"NoteHtml-TooltipContent"},i)),0!==o.popupContent.length&&P.sanitizeToHtmlElement(o.popupContent,W.create("div",{className:t+"NoteHtml-PopupContent"},i)),0!==o.address.length&&P.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Address")+"</span> : "+o.address,W.create("div",{className:t+"NoteHtml-Address"},i)),0!==o.url.length&&P.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Link")+"</span><a href="+o.url+' target="_blank" >'+o.url.substring(0,ks.#pr)+"...</a>",W.create("div",{className:t+"NoteHtml-Url"},i)),0!==o.phone.length){let e=o.phone;if(o.phone.match(/^\+[0-9, ,*,\u0023]*$/)){const t=o.phone.replaceAll(/\u0020/g,""),i=o.phone.replaceAll(/\u0020/g," ");e=O.getText("NoteHTMLViewsFactory - Phone")+" : "+O.getText("NoteHTMLViewsFactory - call")+'<a target="_blank" href="tel:'+t+'" >'+i+"</a>"+O.getText("NoteHTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+t+'" >'+i+"</a>"}else e=O.getText("NoteHTMLViewsFactory - Phone")+" : "+o.phone;P.sanitizeToHtmlElement(e,W.create("div",{className:t+"NoteHtml-Phone"},i))}if(P.sanitizeToHtmlElement(D.formatLatLng(o.latLng),W.create("div",{className:t+"NoteHtml-LatLng"},i)),e.route){e.route.chain&&P.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Distance from start of travel")+"</span> : "+D.formatDistance(o.chainedDistance+o.distance),W.create("div",{className:t+"NoteHtml-TravelDistance"},i)),P.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Distance from start of route")+"</span> : "+D.formatDistance(o.distance),W.create("div",{className:t+"NoteHtml-RouteDistance"},i));const s=e.route.notes.next(o.objId);if(s){const e=s.distance-o.distance;ks.#gr<e&&P.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Next note after")+"</span> : "+D.formatDistance(e),W.create("div",{className:t+"NoteHtml-NextDistance"},i))}}return i}getTravelNotesHTML(t){const e=W.create("div",{className:t+"Travel-Notes"}),o=K.travel.notes.iterator;for(;!o.done;){const i=this.getNoteTextAndIconHTML(t,{note:o.value,route:null});i.className=t+"Travel-Notes-Row",e.appendChild(i)}return e}}const Bs=new ks;class zs{#vr;#fr;constructor(t){Object.freeze(this),this.#fr=t,this.#vr=W.create("div",{className:"TravelNotes-NoteDialog-PreviewDiv"}),this.#vr.appendChild(Bs.getNoteTextAndIconHTML("TravelNotes-NoteDialog-",new Ri(this.#fr,null)))}update(){this.#vr.textContent="",this.#vr.appendChild(Bs.getNoteTextAndIconHTML("TravelNotes-NoteDialog-",{note:this.#fr,route:null}))}get HTMLElements(){return[this.#vr]}}class Fs{#yr;constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){t.stopPropagation(),"url"===t.target.dataset.tanName?this.#yr.focusControl=null:this.#yr.focusControl=t.target}}class Zs{#yr;constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){t.stopPropagation();const e={};"iconWidth"===t.target.dataset.tanName||"iconHeight"===t.target.dataset.tanName?e[t.target.dataset.tanName]=Number.parseInt(t.target.value):e[t.target.dataset.tanName]=t.target.value,this.#yr.updatePreview(e)}}class Ks{#lr;#en;constructor(t,e){Object.freeze(this),this.#lr=t,this.#en=e}handleEvent(t){t.stopPropagation(),new As(this.#lr).setAddressWithGeoCoder(this.#en)}}class Us{#yr;constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){if(t.stopPropagation(),""===t.target.value)return void this.#yr.hideError();""===P.sanitizeToUrl(t.target.value).errorsString?this.#yr.hideError():this.#yr.showError(O.getText("UrlInputBlurEL - invalidUrl"))}}class Ws{#yr;constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){if(!this.#yr.focusControl)return;const e=t.currentTarget;let o=this.#yr.focusControl.selectionStart,i=this.#yr.focusControl.selectionEnd;this.#yr.focusControl.value=this.#yr.focusControl.value.slice(0,o)+e.dataset.tanHtmlBefore+(0===e.dataset.tanHtmlAfter.length?"":this.#yr.focusControl.value.slice(o,i))+e.dataset.tanHtmlAfter+this.#yr.focusControl.value.slice(i),o===i||0===e.dataset.tanHtmlAfter.length?(o+=e.dataset.tanHtmlBefore.length,i=o):i+=e.dataset.tanHtmlBefore.length+e.dataset.tanHtmlAfter.length,this.#yr.focusControl.setSelectionRange(o,i),this.#yr.focusControl.focus();const s={};s[this.#yr.focusControl.dataset.tanName]=this.#yr.focusControl.value,this.#yr.updatePreview(s)}}class Vs{#_r;#or;#Tr;#br(){this.#Tr=document.createElementNS(y,"svg"),this.#Tr.setAttributeNS(null,"viewBox",String(n.svgViewboxDim/4)+" "+n.svgViewboxDim/4+" "+n.svgViewboxDim/2+" "+n.svgViewboxDim/2),this.#Tr.setAttributeNS(null,"class","TravelNotes-SvgIcon")}#Lr(){let e=-1,o=f,i=f;const s=[];if(this.#_r.route.itinerary.itineraryPoints.forEach(r=>{e++;const a=ti.addPoints(ti.project(r.latLng,t.note.svgIcon.zoom),this.#_r.translation);s.push(a);a[0]>=0&&a[1]>=0&&a[0]<=n.svgViewboxDim&&a[1]<=n.svgViewboxDim&&(f===o&&(o=e),i=e)}),f!==o&&f!==i){0<o&&o--,this.#_r.route.itinerary.itineraryPoints.length-1>i&&i++;let t="";for(e=o;e<=i;e++)t+=s[e][0].toFixed(0)+","+s[e][1].toFixed(0)+" ";const r=document.createElementNS(y,"polyline");r.setAttributeNS(null,"points",t),r.setAttributeNS(null,"class","TravelNotes-OSM-Itinerary"),r.setAttributeNS(null,"transform","rotate("+this.#_r.rotation+","+n.svgViewboxDim/2+","+n.svgViewboxDim/2+")"),this.#Tr.appendChild(r)}}#Er(){this.#or.ways.forEach(e=>{let o=f,i=f,s=-1;const r=[];if(e.nodes.forEach(e=>{s++;const a=this.#or.nodes.get(e),l=ti.addPoints(ti.project([a.lat,a.lon],t.note.svgIcon.zoom),this.#_r.translation);r.push(l);l[0]>=0&&l[1]>=0&&l[0]<=n.svgViewboxDim&&l[1]<=n.svgViewboxDim&&(f===o&&(o=s),i=s)}),f!==o&&f!==i){0<o&&o--,e.nodes.length-1>i&&i++;let t="";for(s=o;s<=i;s++)t+=r[s][0].toFixed(0)+","+r[s][1].toFixed(0)+" ";const a=document.createElementNS(y,"polyline");a.setAttributeNS(null,"points",t),a.setAttributeNS(null,"class","TravelNotes-OSM-Highway TravelNotes-OSM-Highway-"+e.tags.highway),a.setAttributeNS(null,"transform","rotate("+this.#_r.rotation+","+n.svgViewboxDim/2+","+n.svgViewboxDim/2+")"),this.#Tr.appendChild(a)}})}#wr(){if(""===this.#_r.rcnRef)return;const t=document.createElementNS(y,"text");t.textContent=this.#_r.rcnRef,t.setAttributeNS(null,"x",String(n.svgViewboxDim/2)),t.setAttributeNS(null,"y",String(n.svgViewboxDim/2)),t.setAttributeNS(null,"class","TravelNotes-OSM-RcnRef"),this.#Tr.appendChild(t)}constructor(){Object.freeze(this)}buildSvg(t,e,o){this.#_r=t,this.#or=o,this.#br(),this.#Lr(),this.#Er(),this.#wr(),e.iconContent=this.#Tr.outerHTML}}class Xs{isMini;isEntry;isExit;constructor(){Object.seal(this),this.isMini=!1,this.isEntry=!1,this.isExit=!1}}class Ys{#_r;#Mr;#or;#xr;#Ir;#Cr;#Nr;#Pr;#Or;#Dr;#Sr;#jr(t){return(t.tags.name?t.tags.name:"")+(t.tags.name&&t.tags.ref?" ":"")+(t.tags.ref?"["+t.tags.ref+"]":"")}#Ar(t){const e=5e-6;let o=!1;return this.#_r.route.wayPoints.forEach(i=>{Math.abs(t.lat-i.lat)<e&&Math.abs(t.lng-i.lng)<e&&(o=!0)}),!o&&(this.#Mr.latLng[0]!==t.lat||this.#Mr.latLng[1]!==t.lng)}#Rr(){const e=this.#_r.route.itinerary.itineraryPoints.previous(this.#_r.nearestItineraryPointObjId,t=>this.#Ar(t)),i=this.#_r.route.itinerary.itineraryPoints.next(this.#_r.nearestItineraryPointObjId,t=>this.#Ar(t));let s=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MAX_VALUE,l=o.defaultValue;this.#or.nodes.forEach(o=>{l=Ai.pointsDistance([o.lat,o.lon],this.#Mr.latLng),"bike"===this.#_r.route.itinerary.transitMode&&o?.tags?.rcn_ref&&o.tags["network:type"]&&"node_network"===o.tags["network:type"]&&l<t.note.svgIcon.rcnRefDistance&&l<n&&(this.#xr=o,n=l),l<s&&(this.#Cr=o.id,s=l),e&&(l=Ai.pointsDistance([o.lat,o.lon],e.latLng),l<r&&(this.#Nr=o.id,r=l)),i&&(l=Ai.pointsDistance([o.lat,o.lon],i.latLng),l<a&&(this.#Pr=o.id,a=l))}),this.#Ir=this.#or.nodes.get(this.#Cr)}#Hr(){this.#Sr.isMini="mini_roundabout"===this?.#Ir?.tags?.highway}#kr(){this.#xr&&(this.#_r.rcnRef=this.#xr.tags.rcn_ref,this.#Mr.tooltipContent+=O.getText("StreetFinder - rcnRef",{rcnRef:this.#_r.rcnRef}))}#Br(){this.#or.ways.forEach(t=>{if(!t.nodes.includes(this.#Cr))return;const e=this.#jr(t),o=""!==e,i=t.nodes.includes(this.#Nr),s=t.nodes.includes(this.#Pr);let n=2*t.nodes.filter(t=>t===this.#Cr).length;if(t.nodes[0]===this.#Cr&&n--,t.nodes[t.nodes.length-1]===this.#Cr&&n--,i&&(this.#Or=o?e:"???",n--,"roundabout"===t?.tags?.junction&&(this.#Sr.isExit=!0)),0!==n&&(s&&(this.#Dr=o?e:"???",n--,"roundabout"===t?.tags?.junction&&(this.#Sr.isEntry=!0)),0!==n&&o))for(;0!==n;)this.#Mr.address=""===this.#Mr.address?e:this.#Mr.address+" ⪥  "+e,n--})}#zr(){""!==this.#or.city&&(this.#Mr.address+=' <span class="TravelNotes-NoteHtml-Address-City">'+this.#or.city+"</span>"),this.#or.place&&this.#or.place!==this.#or.city&&(this.#Mr.address+=" ("+this.#or.place+")")}#Fr(){r.atStart===this.#_r.positionOnRoute?(this.#Mr.address="🟢 "+this.#Dr,this.#zr()):r.atEnd===this.#_r.positionOnRoute?(this.#zr(),this.#Mr.address=this.#Or,this.#zr(),this.#Mr.address+=" 🔴 "):(this.#Mr.address=this.#Or+(""===this.#Mr.address?"":" ⪥  "+this.#Mr.address)+" "+this.#_r.directionArrow+" "+this.#Dr,this.#zr())}#Zr(){this.#Sr.isEntry&&!this.#Sr.isExit?this.#Mr.tooltipContent+=O.getText("StreetFinder - entry roundabout"):!this.#Sr.isEntry&&this.#Sr.isExit?this.#Mr.tooltipContent+=O.getText("StreetFinder - exit roundabout"):this.#Sr.isEntry&&this.#Sr.isExit&&(this.#Mr.tooltipContent+=O.getText("StreetFinder - continue roundabout")),this.#Sr.isMini&&(this.#Mr.tooltipContent+=O.getText("StreetFinder - at the small roundabout on the ground"))}constructor(){Object.freeze(this)}findData(t,e,o){this.#_r=t,this.#Mr=e,this.#or=o,this.#Cr=f,this.#Nr=f,this.#Pr=f,this.#Or="",this.#Dr="",this.#Sr=new Xs,this.#Rr(),this.#Hr(),this.#kr(),this.#Br(),this.#Fr(),this.#Zr()}}class Gs{constructor(){Object.freeze(this)}findData(e,o){null!==e.direction&&(e.direction<t.note.svgIcon.angleDirection.right?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn right"),e.directionArrow="🢂"):e.direction<t.note.svgIcon.angleDirection.slightRight?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn slight right"),e.directionArrow="🢅"):e.direction<t.note.svgIcon.angleDirection.continue?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Continue"),e.directionArrow="🢁"):e.direction<t.note.svgIcon.angleDirection.slightLeft?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn slight left"),e.directionArrow="🢄"):e.direction<t.note.svgIcon.angleDirection.left?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn left"),e.directionArrow="🢀"):e.direction<t.note.svgIcon.angleDirection.sharpLeft?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn sharp left"),e.directionArrow="🢇"):e.direction<t.note.svgIcon.angleDirection.sharpRight?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn sharp right"),e.directionArrow="🢆"):(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn right"),e.directionArrow="🢂")),r.atStart===e.positionOnRoute?o.tooltipContent=O.getText("ArrowAndTooltipFinder - Start"):r.atEnd===e.positionOnRoute&&(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Stop"))}}class qs{#_r;#Mr;#Kr;#Ur;#Wr;#Vr(){this.#_r.translation=ti.subtrackPoints([n.svgViewboxDim/2,n.svgViewboxDim/2],ti.project(this.#Mr.latLng,t.note.svgIcon.zoom))}#Xr(){this.#Kr=this.#_r.route.itinerary.itineraryPoints.previous(this.#_r.nearestItineraryPointObjId,e=>Ai.pointsDistance(e.latLng,this.#Mr.latLng)>t.note.svgIcon.angleDistance)||this.#_r.route.itinerary.itineraryPoints.first}#Yr(){this.#Ur=this.#_r.route.itinerary.itineraryPoints.next(this.#_r.nearestItineraryPointObjId,e=>Ai.pointsDistance(e.latLng,this.#Mr.latLng)>t.note.svgIcon.angleDistance)||this.#_r.route.itinerary.itineraryPoints.last}#Gr(){this.#Wr=ti.addPoints(ti.project(this.#Mr.latLng,t.note.svgIcon.zoom),this.#_r.translation)}#qr(){if(this.#_r.nearestItineraryPointObjId!==this.#_r.route.itinerary.itineraryPoints.first.objId){const o=ti.addPoints(ti.project(this.#Kr.latLng,t.note.svgIcon.zoom),this.#_r.translation);this.#_r.rotation=Math.atan((this.#Wr[1]-o[1])/(o[0]-this.#Wr[0]))*e.d180/Math.PI,0>this.#_r.rotation&&(this.#_r.rotation+=e.d360),this.#_r.rotation-=e.d270,0>o[0]-this.#Wr[0]&&(this.#_r.rotation+=e.d180)}}#$r(){if(this.#_r.nearestItineraryPointObjId!==this.#_r.route.itinerary.itineraryPoints.last.objId){const o=ti.addPoints(ti.project(this.#Ur.latLng,t.note.svgIcon.zoom),this.#_r.translation);for(this.#_r.direction=Math.atan((this.#Wr[1]-o[1])/(o[0]-this.#Wr[0]))*e.d180/Math.PI,0>o[0]-this.#Wr[0]&&(this.#_r.direction+=e.d180),this.#_r.direction-=this.#_r.rotation;e.d0>this.#_r.direction;)this.#_r.direction+=e.d360;for(;e.d360<this.#_r.direction;)this.#_r.direction-=e.d360}}#Jr(){this.#_r.nearestItineraryPointObjId===this.#_r.route.itinerary.itineraryPoints.first.objId&&(this.#_r.rotation=-this.#_r.direction-e.d90,this.#_r.direction=null,this.#_r.positionOnRoute=r.atStart),this.#Mr.latLng[0]===this.#_r.route.itinerary.itineraryPoints.last.lat&&this.#Mr.latLng[1]===this.#_r.route.itinerary.itineraryPoints.last.lng&&(this.#_r.direction=null,this.#_r.positionOnRoute=r.atEnd)}constructor(){Object.freeze(this)}findData(t,e){this.#_r=t,this.#Mr=e,this.#Vr(),this.#Xr(),this.#Yr(),this.#Gr(),this.#qr(),this.#$r(),this.#Jr()}}class $s{constructor(){Object.seal(this)}iconContent="";tooltipContent="";address="";latLng=[a.defaultValue,a.defaultValue]}class Js{constructor(){Object.seal(this)}nearestItineraryPointObjId=g;route=null;positionOnRoute=r.onRoute;direction=null;directionArrow=" ";rcnRef="";rotation=0;translation=[0,0]}class Qs{#Mr;#_r;#or;#er;#Qr;static get#ta(){return 1.5}#ea(){let t=null,e=Number.MAX_VALUE;this.#_r.route.itinerary.itineraryPoints.forEach(o=>{const i=Ai.pointsDistance(this.#Mr.latLng,o.latLng);e>i&&(e=i,t=o)}),this.#Mr.latLng=t.latLng,this.#_r.nearestItineraryPointObjId=t.objId}#oa(){return(new qs).findData(this.#_r,this.#Mr),(new Gs).findData(this.#_r,this.#Mr),(new Ys).findData(this.#_r,this.#Mr,this.#or),(new Vs).buildSvg(this.#_r,this.#Mr,this.#or),this.#Qr=!1,this.#Mr}async#ia(){if(this.#Qr)return null;this.#Qr=!0,this.#_r.nearestItineraryPointObjId=g,this.#_r.positionOnRoute=r.onRoute,this.#_r.direction=null,this.#_r.directionArrow=" ",this.#_r.translation=[0,0],this.#_r.rotation=0,this.#_r.rcnRef="",this.#Mr.iconContent="",this.#Mr.tooltipContent="",this.#Mr.address="",this.#ea();const t=this.#Mr.latLng[0].toFixed(a.fixed)+","+this.#Mr.latLng[1].toFixed(a.fixed),e=["way[highway](around:"+(n.svgViewboxDim*Qs.#ta).toFixed(0)+","+t+")->.a;(.a >;.a;)->.a;.a out;is_in("+t+')->.e;area.e[admin_level][boundary="administrative"];out;node(around:'+this.#er+","+t+")[place];out;"];return await this.#or.loadData(e,this.#Mr.latLng),this.#or.statusOk?this.#oa():null}async#sa(t,e){const o=await this.#ia();o?t(o):e("An error occurs...")}constructor(){Object.freeze(this),this.#Mr=new $s,this.#_r=new Js,this.#or=new Os({searchRelations:!1,setGeometry:!1}),this.#er=Math.max(t.geoCoder.distances.hamlet,t.geoCoder.distances.village,t.geoCoder.distances.city,t.geoCoder.distances.town),this.#Qr=!1}async getIconAndAdressAsync(t,e){return this.#Mr.latLng=t,this.#_r.route=e,this.#ia()}getIconAndAdressWithPromise(t){return this.#Mr.latLng=t.latLng,this.#_r.route=t.route,new Promise((t,e)=>this.#sa(t,e))}}class tn{#yr;#na(t){this.#yr.setControlsValues(t),this.#yr.updatePreview(t)}#ra(){const t=this.#yr.mapIconData;t.route?(this.#yr.hideError(),this.#yr.showWait(),(new Qs).getIconAndAdressWithPromise(t).then(t=>{this.#yr.hideWait(),this.#na(t)}).catch(t=>{t instanceof Error&&console.error(t),this.#yr.hideWait(),this.#yr.showError(O.getText("IconSelectorChangeEL - an error occurs when creating the SVG icon"))})):this.#yr.showError(O.getText("IconSelectorChangeEL - not possible to create a SVG icon for a travel note"))}constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){t.stopPropagation();const e=Ms.preDefinedIconDataAt(t.target.selectedIndex);"SvgIcon"!==e.icon?(this.#na({iconContent:e.icon,iconHeight:e.height,iconWidth:e.width,tooltipContent:e.tooltip}),this.#yr.setAddress()):this.#ra()}}class en{#yr;constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{Ms.loadJson(JSON.parse(e.result)),this.#yr.updateToolbar()}catch(t){t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class on{#yr;constructor(t){Object.freeze(this),this.#yr=t}handleEvent(t){t.stopPropagation(),D.openFile(new en(this.#yr),".json")}}class sn{#aa;#la;#ha;#da;#ca;#ua;#ma;constructor(t,e){Object.freeze(this),this.#aa=new Fs(t),this.#la=new Zs(t),this.#ha=new Ks(t,e),this.#da=new Us(t),this.#ca=new Ws(t),this.#ua=new tn(t),this.#ma=new on(t)}destructor(){this.#aa=null,this.#la=null,this.#ha=null,this.#da=null,this.#ca=null,this.#ua=null,this.#ma=null}get controlFocus(){return this.#aa}get controlInput(){return this.#la}get addressButtonClick(){return this.#ha}get urlInputBlur(){return this.#da}get editionButtonsClick(){return this.#ca}get iconSelectorChange(){return this.#ua}get openCfgFileButtonClick(){return this.#ma}}class nn extends ci{#di;#ci;#fr;#pa;#ga;#va;#fa;#ya;#_a;#Ta;#ba;#Qo;#La;#Ea;#De(){this.#Qo.destructor(this.#Ea),this.#pa.destructor(this.#Ea),this.#ga.destructor(this.#Ea),this.#va.destructor(this.#Ea),this.#fa.destructor(this.#Ea),this.#ya.destructor(this.#Ea),this.#_a.destructor(this.#Ea),this.#Ta.destructor(this.#Ea),this.#Ea.destructor()}constructor(t,e){super(),this.#La=null,this.#di=t,this.#ci=e,this.#fr=new B,this.#fr.jsonObject=t.jsonObject}createContentHTML(){this.#Ea=new sn(this,this.#fr.latLng),this.#Qo=new xs(this.#Ea),this.#pa=new Rs(this.#Ea),this.#ga=new Cs({placeholder:"?????",datasetName:"iconContent",headerText:O.getText("NoteDialogIconControl - Icon content")},this.#Ea),this.#va=new $i({headerText:O.getText("NoteDialogTooltipControl - Tooltip content"),datasetName:"tooltipContent"},this.#Ea),this.#fa=new Cs({rows:t.noteDialog.areaHeight.popupContent,datasetName:"popupContent",headerText:O.getText("NoteDialogPopupControl - Text")},this.#Ea),this.#ya=new Ns(this.#Ea),this.#_a=new Hs(this.#Ea,this.#fr.latLng),this.#Ta=new $i({headerText:O.getText("NoteDialogPhoneControl - Phone"),datasetName:"phone"},this.#Ea),this.#ba=new zs(this.#fr),this.setControlsValues(this.#fr)}get focusControl(){return this.#La}set focusControl(t){this.#La=t}get mapIconData(){return new Is(this.#fr.latLng,this.#ci)}updatePreview(t){for(const e in t)this.#fr[e]=t[e];this.#ba.update()}setAddress(){""===this.#di.address&&new As(this).setAddressWithGeoCoder(this.#fr.latLng)}canClose(){return""===this.#ga.value?(this.showError(O.getText("Notedialog - The icon content cannot be empty")),!1):""===this.#_a.url||""!==P.sanitizeToUrl(this.#_a.url).url||(this.showError(O.getText("NoteDialog - invalidUrl")),!1)}onCancel(){this.#De(),super.onCancel()}onOk(){super.onOk()&&(this.#di.iconWidth=this.#pa.iconWidth,this.#di.iconHeight=this.#pa.iconHeight,this.#di.iconContent=this.#ga.value,this.#di.tooltipContent=this.#va.value,this.#di.popupContent=this.#fa.value,this.#di.address=this.#ya.address,this.#di.url=this.#_a.url,this.#di.phone=this.#Ta.value,this.#di.latLng=this.#fr.latLng,this.#De())}get title(){return O.getText("NoteDialog - Note")}get toolbarHTMLElement(){return this.#Qo.rootHTMLElement}get contentHTMLElements(){return[this.#pa.controlHTMLElement,this.#ga.controlHTMLElement,this.#va.controlHTMLElement,this.#fa.controlHTMLElement,this.#ya.controlHTMLElement,this.#_a.controlHTMLElement,this.#Ta.controlHTMLElement]}get footerHTMLElements(){return this.#ba.HTMLElements}setControlsValues(t){this.#pa.iconHeight=t.iconHeight||this.#pa.iconHeight,this.#pa.iconWidth=t.iconWidth||this.#pa.iconWidth,this.#ga.value=t.iconContent||this.#ga.value,this.#va.value=t.tooltipContent||this.#va.value,this.#fa.value=t.popupContent||this.#fa.value,this.#ya.address=t.address||this.#ya.address,this.#_a.url=t.url||this.#_a.url,this.#Ta.value=t.phone||this.#Ta.value}updateToolbar(){this.#Qo.update(this.#Ea)}}class rn{#wa;#Ma;constructor(){Object.freeze(this)}createUI(){if(this.#wa)return;this.#wa=W.create("div",{className:"TravelNotes-Background"},document.body);const t=W.create("div",{id:"TravelNotes-WaitUI"},this.#wa);this.#Ma=W.create("div",{id:"TravelNotes-WaitUI-MessageDiv"},t),W.create("div",{className:"TravelNotes-WaitAnimationBullet"},W.create("div",{className:"TravelNotes-WaitAnimation"},t))}showInfo(t){this.#Ma.textContent=t}close(){document.body.removeChild(this.#wa),this.#wa=null}}class an{#xa=[];#Ia(t){this.#xa.push(t.latLng),this.#xa.push(t.iconLatLng)}#Ca(t){t.itinerary.itineraryPoints.forEach(t=>this.#xa.push(t.latLng)),t.notes.forEach(t=>this.#Ia(t))}constructor(){Object.freeze(this)}zoomToLatLng(t){Si.dispatch("zoomto",{latLng:t})}zoomToNote(t){this.#xa=[],this.#Ia(ki.getNoteAndRoute(t).note),Si.dispatch("zoomto",{geometry:[this.#xa]})}zoomToRoute(t){this.#xa=[],this.#Ca(ki.getRoute(t)),Si.dispatch("zoomto",{geometry:[this.#xa]})}zoomToTravel(){this.#xa=[],K.travel.routes.forEach(t=>this.#Ca(t)),g!==K.travel.editedRouteObjId&&this.#Ca(K.travel.editedRoute),K.travel.notes.forEach(t=>this.#Ia(t)),Si.dispatch("zoomto",{geometry:[this.#xa]})}zoomToPoi(t){Si.dispatch("zoomto",t)}}const ln=new class{#di=null;#ci=null;#Na=!0;#Pa=null;#Oa(){this.#Na?this.#ci?(this.#ci.notes.add(this.#di),this.#di.chainedDistance=this.#ci.chainedDistance,this.#ci.notes.sort((t,e)=>t.distance-e.distance)):(K.travel.notes.add(this.#di),Si.dispatch("updatetravelnotes")):this.#ci||Si.dispatch("updatetravelnotes"),Si.dispatch("noteupdated",{removedNoteObjId:this.#di.objId,addedNoteObjId:this.#di.objId}),Si.dispatch("updateroadbook")}#yr(){new nn(this.#di,this.#ci).show().then(()=>this.#Oa()).catch(t=>{console.error(t)})}#Da(t){this.#Na=!0,this.#di=new B,this.#di.latLng=t,this.#di.iconLatLng=t}async#Sa(t){if(t.tags.rcn_ref?this.#di.iconContent="<div class='TravelNotes-MapNote TravelNotes-MapNoteCategory-0073'><svg viewBox='0 0 20 20'><text x='10' y='14'>"+t.tags.rcn_ref+"</text></svg></div>":this.#di.iconContent=Ms.preDefinedIconDataFromName(t.description),this.#di.url=t.tags.website||"",this.#di.phone=t.tags.phone||"",this.#di.tooltipContent=t.description||"",this.#di.popupContent=t.tags.name||"",t.tags["addr:street"]&&t.tags["addr:city"])this.#di.address=(t.tags["addr:housenumber"]?t.tags["addr:housenumber"]+" ":"")+t.tags["addr:street"]+' <span class="TravelNotes-NoteHtml-Address-City">'+t.tags["addr:city"]+"</span>";else{const e=new rn;e.createUI(),e.showInfo("Creating address");let o=null;try{o=await(new js).getAddressAsync([t.lat,t.lon])}catch(t){console.error(t)}e.close(),this.#di.address=o.street,""!==o.city&&(this.#di.address+=' <span class="TravelNotes-NoteHtml-Address-City">'+o.city+"</span>")}this.osmSearchNoteDialog||""===this.#di.iconContent?this.#yr():this.#Oa()}constructor(){Object.freeze(this)}get osmSearchNoteDialog(){return null===this.#Pa&&(this.#Pa=t.osmSearch.showSearchNoteDialog),this.#Pa}changeOsmSearchNoteDialog(){this.#Pa=!this.osmSearchNoteDialog}newRouteNote(t,e){this.#ci=ki.getRoute(t);const o=ti.getClosestLatLngDistance(this.#ci,e);this.#Da(o.latLng),this.#di.distance=o.distance,this.#yr()}newSearchRouteNote(t){const e=ki.getNearestRouteData([t.lat,t.lon]);e.route?(this.#Da(e.latLngOnRoute),this.#di.iconLatLng=[t.lat,t.lon],this.#di.distance=e.distanceOnRoute,this.#ci=e.route,this.#Sa(t)):Oi.showError(O.getText("NoteEditor - No route was found"))}newSearchTravelNote(t){this.#ci=null,this.#Da([t.lat,t.lon]),this.#Sa(t)}newTravelNote(t){this.#ci=null,this.#Da(t),this.#yr()}newUrlNote(t){this.#ci=null,this.#Da(t),this.#di.iconContent='<div class="TravelNotes-MapNote TravelNotes-MapNoteCategory-0074"></div>',this.#di.tooltipContent="Here",this.#Oa(),(new an).zoomToLatLng(t)}editNote(t){this.#Na=!1;const e=ki.getNoteAndRoute(t);this.#ci=e.route,this.#di=e.note,this.#yr()}removeNote(t){const e=ki.getNoteAndRoute(t);e.route?e.route.notes.remove(t):(K.travel.notes.remove(t),Si.dispatch("updatetravelnotes")),Si.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:g}),Si.dispatch("updateroadbook")}hideNotes(){let t=K.travel.notes.iterator;for(;!t.done;)Si.dispatch("removeobject",{objId:t.value.objId});const e=K.travel.routes.iterator;for(;!e.done;)for(t=e.value.notes.iterator;!t.done;)Si.dispatch("removeobject",{objId:t.value.objId});if(g!==K.editedRouteObjId)for(t=K.travel.editedRoute.notes.iterator;!t.done;)Si.dispatch("removeobject",{objId:t.value.objId})}showNotes(){this.hideNotes();const t=K.travel.notes.iterator;for(;!t.done;)Si.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:t.value.objId});const e=K.travel.routes.iterator;for(;!e.done;)e.value.hidden||Si.dispatch("routeupdated",{removedRouteObjId:e.value.objId,addedRouteObjId:e.value.objId})}attachNoteToRoute(t){const e=ki.getNoteAndRoute(t).note,o=ki.getNearestRouteData(e.latLng);o.route&&(K.travel.notes.remove(t),e.distance=o.distanceOnRoute,e.latLng=o.latLngOnRoute,e.chainedDistance=o.route.chainedDistance,o.route.notes.add(e),o.route.notes.sort((t,e)=>t.distance-e.distance),Si.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:t}),Si.dispatch("updatetravelnotes"),Si.dispatch("updateroadbook"))}detachNoteFromRoute(t){const e=ki.getNoteAndRoute(t);e.route.notes.remove(t),e.note.distance=o.invalid,e.note.chainedDistance=o.defaultValue,K.travel.notes.add(e.note),Si.dispatch("updatetravelnotes"),Si.dispatch("updateroadbook")}travelNoteDropped(t,e,o){K.travel.notes.moveTo(t,e,o),Si.dispatch("updatetravelnotes"),Si.dispatch("updateroadbook")}};class hn extends bs{constructor(t,e){super(t,e)}get menuItems(){return[new Ls(O.getText("ProfileContextMenu - Add a note to the route at this point"),!0,()=>ln.newRouteNote(this.targetObjId,this.latLng)),new Ls(O.getText("ProfileContextMenu - Zoom to this point"),!0,()=>(new an).zoomToLatLng(this.latLng))]}}class dn{constructor(){Object.freeze(this)}getlatLngElevOnRouteAtMousePosition(t){const e=ki.getRoute(Number.parseInt(t.currentTarget.dataset.tanObjId)),o=t.currentTarget.getBoundingClientRect(),i=(t.clientX-o.x-cs.PROFILE_MARGIN/(2*cs.PROFILE_MARGIN+cs.PROFILE_WIDTH)*o.width)/(cs.PROFILE_WIDTH/(2*cs.PROFILE_MARGIN+cs.PROFILE_WIDTH)*o.width)*e.distance;return 0<i&&i<e.distance?ti.getLatLngElevAtDist(e,i):null}}class cn extends dn{constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation();const e=this.getlatLngElevOnRouteAtMousePosition(t);e&&(t.latlng={lat:e.latLng[0],lng:e.latLng[1]},new hn(t).show())}}class un{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault(),t.stopPropagation(),Si.dispatch("removeobject",{objId:Number.parseInt(t.currentTarget.dataset.tanMarkerObjId)})}}class mn extends dn{#ja;#Aa;#Ra;#Ha;#ka;#Ba;#za;#Fa(t,e){const o=document.createElementNS(y,"text");return o.appendChild(document.createTextNode(t)),o.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevText"),o.setAttributeNS(null,"x",this.#Ba),o.setAttributeNS(null,"y",e),o.setAttributeNS(null,"text-anchor",this.#ka),this.#za.appendChild(o),o}constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#za=t.currentTarget;const e=this.getlatLngElevOnRouteAtMousePosition(t);if(e){const o=Number.parseInt(this.#za.dataset.tanMarkerObjId);Si.dispatch("removeobject",{objId:o}),Si.dispatch("additinerarypointmarker",{objId:o,latLng:e.latLng}),this.#ja&&this.#za.contains(this.#ja)?(this.#za.removeChild(this.#ja),this.#za.removeChild(this.#Aa),this.#za.removeChild(this.#Ra),this.#za.removeChild(this.#Ha)):(this.#ja=null,this.#Aa=null,this.#Ra=null,this.#Ha=null);const i=this.#za.getBoundingClientRect();this.#Ba=(2*cs.PROFILE_MARGIN+cs.PROFILE_WIDTH)*(t.clientX-i.x)/i.width;const s=cs.PROFILE_MARGIN+cs.PROFILE_HEIGHT;this.#ja=document.createElementNS(y,"polyline"),this.#ja.setAttributeNS(null,"points",String(this.#Ba)+","+cs.PROFILE_MARGIN+" "+this.#Ba+","+s),this.#ja.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-markerPolyline"),this.#za.appendChild(this.#ja);const n=ki.getRoute(Number.parseInt(this.#za.dataset.tanObjId));this.#ka=e.distance>n.distance/2?"end":"start",this.#Ba+=e.distance>n.distance/2?-cs.X_DELTA_TEXT:cs.X_DELTA_TEXT,this.#Aa=this.#Fa(D.formatDistance(e.distance),cs.PROFILE_MARGIN+cs.Y_DELTA_TEXT),this.#Ra=this.#Fa("Alt. "+e.elev.toFixed(0)+" m.",cs.PROFILE_MARGIN+2*cs.Y_DELTA_TEXT),this.#Ha=this.#Fa("Pente "+e.ascent.toFixed(0)+" % ",cs.PROFILE_MARGIN+3*cs.Y_DELTA_TEXT)}}}class pn extends ds{#gs=null;#Za;#Ka;#Ua;#Wa=null;#Va=null;#Xa=null;#Ya=T.nextObjId;#Ga;#qa(){this.#gs&&(this.#gs.removeEventListener("contextmenu",this.#Wa,!1),this.#gs.removeEventListener("mousemove",this.#Va,!1),this.#gs.removeEventListener("mouseleave",this.#Xa,!1),this.#Za.removeChild(this.#gs),this.#gs=null,Si.dispatch("removeobject",{objId:this.#Ya}),this.#Ua.textContent="",this.#Ka.textContent="")}setContent(t){this.#Ga=t.objId,this.#qa(),this.#gs=(new cs).createSvg(t),this.#gs.dataset.tanObjId=t.objId,this.#gs.dataset.tanMarkerObjId=this.#Ya,this.#gs.addEventListener("contextmenu",this.#Wa,!1),this.#gs.addEventListener("mousemove",this.#Va,!1),this.#gs.addEventListener("mouseleave",this.#Xa,!1),this.#Za.appendChild(this.#gs),this.setContentName(t)}setContentName(t){this.#Ua.textContent=O.getText("ProfileWindow - Route {name}",{name:t.computedName}),this.#Ka.textContent=O.getText("ProfileWindow - Ascent: {ascent} m. - Descent: {descent} m. - Distance: {distance}",{ascent:t.itinerary.ascent.toFixed(0),descent:t.itinerary.descent.toFixed(0),distance:D.formatDistance(t.distance)})}constructor(){super(),this.#Wa=new cn,this.#Va=new mn,this.#Xa=new un,this.#Za=W.create("div",{className:"TravelNotes-ProfileDialog-SvgContainer"}),this.#Ua=W.create("div",{className:"TravelNotes-ProfileDialog-NameContainer"}),this.#Ka=W.create("div",{className:"TravelNotes-ProfileDialog-AscentContainer"})}createContentHTML(){}onCancel(){this.#qa(),super.onCancel(),Si.dispatch("profileclosed",{objId:this.#Ga})}show(){super.show(),this.mover.moveDialogToTopLeft()}get contentHTMLElements(){return[this.#Za,this.#Ua,this.#Ka]}get title(){return O.getText("ProfileWindow - Profile")}}class gn{#ci;#$a;#Ja;get#Qa(){return t.route.elev.smoothPoints}#tl(){this.#Ja=[],this.#Ja.push({distance:0,elev:this.#ci.itinerary.itineraryPoints.first.elev,smoothElev:this.#ci.itinerary.itineraryPoints.first.elev});const t=this.#ci.itinerary.itineraryPoints.iterator;t.done;let e=0,o=t.value.distance,i=t.value.elev;t.done;let s=this.#$a;for(;s<this.#ci.distance;){if(o<s)for(e=o,i=t.value.elev;o<s;)o+=t.value.distance,t.done;const n=i+(s-e)*((t.value.elev-i)/(o-e));this.#Ja.push({distance:s,elev:n,smoothElev:0}),s+=this.#$a}this.#Ja.push({distance:this.#ci.distance,elev:this.#ci.itinerary.itineraryPoints.last.elev,smoothElev:this.#ci.itinerary.itineraryPoints.last.elev})}#el(){let t=(this.#Ja[this.#Qa-1].elev-this.#Ja[0].elev)/(this.#Qa-1),e=0;for(e=0;e<this.#Qa;e++)this.#Ja[e].smoothElev=this.#Ja[0].elev+t*e;for(e=this.#Qa;e<this.#Ja.length-this.#Qa;e++){let t=0;for(let o=e-this.#Qa;o<=e+this.#Qa;o++)t+=this.#Ja[o].elev;this.#Ja[e].smoothElev=t/(2*this.#Qa+1)}e--;const o=(this.#Ja[e+this.#Qa].smoothElev-this.#Ja[e].smoothElev)/this.#Qa;let i=this.#Ja[e].smoothElev,s=1;for(e++;e<this.#Ja.length-1;s++,e++)this.#Ja[e].smoothElev=i+o*s}#ol(){const e=this.#ci.itinerary.itineraryPoints.iterator;let o=0;for(;!e.done;)o+=e.next?Math.abs(e.value.elev-e.next.elev):0;this.#$a=Math.floor(Math.min(t.route.elev.smoothCoefficient*this.#ci.distance/o,this.#ci.distance/(3*this.#Qa)))}#il(){const t=this.#ci.itinerary.itineraryPoints.iterator;t.done;let e=t.value.distance;for(;!t.done;){const o=this.#Ja[Math.floor(e/this.#$a)],i=this.#Ja[Math.ceil(e/this.#$a)];if(o&&i){const s=e-o.distance,n=(i.elev-o.elev)/(i.distance-o.distance);t.value.elev=o.elev+s*n}e+=t.value.distance}}constructor(){Object.freeze(this)}smooth(t){this.#ci=t,this.#ol(),this.#tl(),this.#el(),this.#il()}}const vn=new class{#sl=new Map;constructor(){Object.freeze(this)}createProfile(e){const o=this.#sl.get(e.objId);if(e.itinerary.hasProfile){t.route.elev.smooth&&(new gn).smooth(e);let i=0,s=0,n=e.itinerary.itineraryPoints.first.elev;e.itinerary.itineraryPoints.forEach(t=>{let e=t.elev-n;0>e?s-=e:i+=e,n=t.elev}),e.itinerary.ascent=i,e.itinerary.descent=s,o&&o.setContent(e)}else o&&o.onCancel()}updateProfileName(t){const e=this.#sl.get(t);if(e){const o=ki.getRoute(t);o&&e.setContentName(o)}}updateProfile(t,e){const o=this.#sl.get(t);o&&(this.#sl.delete(t),e&&e.itinerary.hasProfile?(o.setContent(e),this.#sl.set(e.objId,o)):o.onCancel())}deleteProfile(t){const e=this.#sl.get(t);e&&e.onCancel()}deleteAllProfiles(){this.#sl.forEach(t=>t.onCancel())}showProfile(t){const e=ki.getRoute(t);let o=this.#sl.get(t);o||(o=new pn,o.setContent(e),o.show(),this.#sl.set(t,o))}onProfileClosed(t){this.#sl.delete(t)}};class fn{constructor(){Object.seal(this)}bottomLeft;upperRight;entryPoint;exitPoint}class yn{#nl;#ci;#rl;#al(t,e,o){return e.lng===o.lng?new qo(e.lat>o.lat?t.bottomLeft.lat:t.upperRight.lat,e.lng):e.lat===o.lat?new qo(e.lat,e.lng<o.lng?t.upperRight.lng:t.bottomLeft.lng):null}#ll(t,e){const o=1e-6;return e.lat-t.bottomLeft.lat<o||t.upperRight.lat-e.lat<o||e.lng-t.bottomLeft.lng<o||t.upperRight.lng-e.lng<o?qo.clone(e):null}#hl(t,e,o){if(t.bottomLeft.lat===t.upperRight.lat&&t.bottomLeft.lng===t.upperRight.lng){const t=Math.min(Math.abs(this.#rl.height/(o.lat-e.lat)),Math.abs(this.#rl.width/(o.lng-e.lng)));return new qo(e.lat+t*(o.lat-e.lat),e.lng+t*(o.lng-e.lng))}return null}#dl(t,e,o){let i=this.#hl(t,e,o);if(i)return i;if(i=this.#ll(t,e),i)return i;if(i=this.#al(t,e,o),i)return i;const s=(e.lat-o.lat)/(e.lng-o.lng),n=e.lat-s*e.lng;if(i=new qo(s*t.upperRight.lng+n,t.upperRight.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng<o.lng)return i;if(i=new qo(t.upperRight.lat,(t.upperRight.lat-n)/s),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat<o.lat)return i;if(i=new qo(s*t.bottomLeft.lng+n,t.bottomLeft.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng>o.lng)return i;if(i=new qo(t.bottomLeft.lat,(t.bottomLeft.lat-n)/s),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat>o.lat)return i;throw new Error("intermediate point not found")}#cl(){this.#nl=[];const t=this.#ci.itinerary.itineraryPoints.iterator;let e=t.done,o=new fn;o.bottomLeft=qo.clone(t.value),o.upperRight=qo.clone(t.value),o.entryPoint=qo.clone(t.value);let i=t.value,s=qo.clone(t.value);e=t.done;let n=t.value;for(;!e;){const r=new fn;r.bottomLeft=new qo(Math.min(o.bottomLeft.lat,n.lat),Math.min(o.bottomLeft.lng,n.lng)),r.upperRight=new qo(Math.max(o.upperRight.lat,n.lat),Math.max(o.upperRight.lng,n.lng)),r.entryPoint=qo.clone(o.entryPoint),this.#rl.height>r.upperRight.lat-r.bottomLeft.lat&&this.#rl.width>r.upperRight.lng-r.bottomLeft.lng?(o=r,i=t.value,s=qo.clone(t.value),e=t.done,n=t.value,e&&(o.exitPoint=s,this.#nl.push(Object.freeze(o)))):(s=this.#dl(o,i,n),o.bottomLeft=new qo(Math.min(o.bottomLeft.lat,s.lat),Math.min(o.bottomLeft.lng,s.lng)),o.upperRight=new qo(Math.max(o.upperRight.lat,s.lat),Math.max(o.upperRight.lng,s.lng)),o.exitPoint=s,this.#nl.push(Object.freeze(o)),o=new fn,o.bottomLeft=qo.clone(s),o.upperRight=qo.clone(s),o.entryPoint=qo.clone(s))}}constructor(t,e){Object.freeze(this),this.#ci=t,this.#rl=e,this.#cl()}get printViews(){return this.#nl}}class _n{#_t;#Tn;constructor(t,e){Object.freeze(this),this.#_t=t,this.#Tn=e}get width(){return this.#_t}get height(){return this.#Tn}}class Tn{#ae;#Tt;#ul;constructor(t){if("string"!=typeof t?.text||"string"!=typeof t?.color||"string"!=typeof t?.backgroundColor)throw new Error("invalid toolbar for layer");Object.freeze(this),this.#ae=P.sanitizeToJsString(t.text),this.#Tt=P.sanitizeToColor(t.color),this.#ul=P.sanitizeToColor(t.backgroundColor)}get text(){return this.#ae}get color(){return this.#Tt}get backgroundColor(){return this.#ul}}class bn{#U=null;#ml=null;#p=null;#pl=null;#gl=null;#vl=null;#fl=null;#yl=null;#Ht=null;#_l=!1;#Tl=null;#bl=null;#Ll(){if("string"!=typeof this.#bl?.name)throw new Error("invalid name for layer");this.#U=P.sanitizeToJsString(this.#bl.name)}#El(){if("wms"!==this.#bl?.service&&"wmts"!==this.#bl?.service)throw new Error("invalid service for layer "+this.#U);this.#ml=this.#bl.service}#wl(){if("string"!=typeof this.#bl?.url)throw new Error("invalid url for layer "+this.#U);this.#p=this.#bl.url}#Ml(){if("wms"===this.#ml){if("string"!=typeof this.#bl?.wmsOptions?.layers||"string"!=typeof this.#bl?.wmsOptions?.format||"boolean"!=typeof this.#bl?.wmsOptions?.transparent)throw new Error("invalid wmsOptions for layer "+this.#U);this.#pl=this.#bl.wmsOptions,this.#pl.layers=P.sanitizeToJsString(this.#pl.layers),this.#pl.format=P.sanitizeToJsString(this.#pl.format)}}#xl(){try{this.#bl.bounds&&"number"==typeof this.#bl.bounds[0][0]&&"number"==typeof this.#bl.bounds[0][1]&&"number"==typeof this.#bl.bounds[1][0]&&"number"==typeof this.#bl.bounds[1][1]&&(this.#gl=this.#bl.bounds)}catch{throw new Error("invalid bounds for layer "+this.#U)}}#Il(){if(this.#bl.minZoom){if("number"!=typeof this.#bl.minZoom)throw new Error("invalid minZoom for layer "+this.#U);this.#vl=this.#bl.minZoom}if(this.#bl.maxZoom){if("number"!=typeof this.#bl.maxZoom)throw new Error("invalid maxZoom for layer "+this.#U);this.#fl=this.#bl.maxZoom}}#Cl(){this.#yl=new Tn(this.#bl.toolbar)}#Nl(){if("string"!=typeof this.#bl?.providerName)throw new Error("invalid providerName for layer "+this.#U);this.#Ht=P.sanitizeToJsString(this.#bl.providerName)}#Pl(){if("boolean"!=typeof this.#bl.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this.#U);this.#_l=this.#bl.providerKeyNeeded}#Ol(){if(""===this.#bl.attribution)this.#Tl="";else{if("string"!=typeof this.#bl?.attribution)throw new Error("invalid attribution for map layer "+this.#U);this.#Tl=P.sanitizeToHtmlString(this.#bl.attribution).htmlString}}constructor(t){Object.freeze(this),this.#bl=t,this.#Ll(),this.#El(),this.#wl(),this.#Ml(),this.#xl(),this.#Il(),this.#Cl(),this.#Nl(),this.#Pl(),this.#Ol(),this.#bl=null}get name(){return this.#U}get service(){return this.#ml}get url(){return this.#p}get wmsOptions(){return this.#pl}get bounds(){return this.#gl}get minZoom(){return this.#vl}get maxZoom(){return this.#fl}get toolbarButtonData(){return this.#yl}get providerName(){return this.#Ht}get providerKeyNeeded(){return this.#_l}get attribution(){return this.#Tl}}const Ln=new class{#Dl;#Sl;#jl;constructor(){Object.freeze(this),this.#Dl=new Map,this.#jl=!1,this.#Sl=new bn({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}),this.#Dl.set(this.#Sl.name,this.#Sl)}getMapLayer(t){let e=this.#Dl.get(t)||this.#Sl;return e.providerKeyNeeded&&(ji.hasKey(e.providerName.toLowerCase())||(e=this.#Sl)),e}forEach(t){this.#Dl.forEach(t)}addMapLayers(t){this.#jl||(t.forEach(t=>{const e=new bn(t);this.#Dl.get(e.name)||this.#Dl.set(e.name,e)}),this.#jl=!0)}get defaultMapLayer(){return this.#Sl}};class En{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class wn{#Al=null;constructor(t){Object.freeze(this),this.#Al=t}handleEvent(){this.#Al.onAfterPrint(),this.#Al=null}}class Mn{#Rl;#ci;#nl;#Hl;#kl;#_e;#Bl;#zl;#Fl;#Zl;#Kl;onAfterPrint(){this.#zl.forEach(t=>document.body.removeChild(t)),this.#zl.length=0,this.#kl.removeEventListener("click",this.#Zl,!1),this.#_e.removeEventListener("click",this.#Kl,!1),document.body.removeChild(this.#Hl);const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.remove("TravelNotes-Hidden");K.map.invalidateSize(!1),document.title="Travel & Notes"+(""===K.travel.name?"":" - "+K.travel.name),window.removeEventListener("afterprint",this.#Kl,!0),this.#Kl=null,this.#Zl=null}#Ul(){const t=Ln.getMapLayer(K.travel.layerName),e=ji.getUrl(t),o="wmts"===t.service.toLowerCase()?new No(e):new No.WMS(e,t.wmsOptions);return o.options.attribution=P.sanitizeToHtmlString(' © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t.attribution+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> ').htmlString,o}#Wl(){const t=[];return this.#ci.notes.forEach(e=>{const o=new Io({iconSize:[e.iconWidth,e.iconHeight],iconAnchor:[e.iconWidth/2,e.iconHeight/2],popupAnchor:[0,-e.iconHeight/2],html:e.iconContent,className:"TravelNotes-Map-AllNotes "}),i=new so(e.iconLatLng,{zIndexOffset:100,icon:o,draggable:!0});t.push(i)}),t}#Vl(e){this.#Bl++;const o="TravelNotes-RouteViewDiv"+this.#Bl,i=document.createElement("div");i.className="TravelNotes-routeViewDiv",i.id=o,document.body.appendChild(i),this.#zl.push(i),i.style.width=String(this.#Rl.paperWidth)+"mm",i.style.height=String(this.#Rl.paperHeight)+"mm";const s=this.#Rl.printNotes?this.#Wl():[];s.push(this.#Ul()),s.push(new ro([e.entryPoint.lat,e.entryPoint.lng],t.printRouteMap.entryPointMarker)),s.push(new ro([e.exitPoint.lat,e.exitPoint.lng],t.printRouteMap.exitPointMarker)),s.push(this.#Fl),new Le(o,{attributionControl:!0,zoomControl:!1,center:[(e.bottomLeft.lat+e.upperRight.lat)/2,(e.bottomLeft.lng+e.upperRight.lng)/2],zoom:this.#Rl.zoomFactor,minZoom:this.#Rl.zoomFactor,maxZoom:this.#Rl.zoomFactor,layers:s})}#Xl(){this.#Hl=W.create("div",{id:"TravelNotes-PrintToolbar"},document.body),this.#kl=W.create("div",{className:"TravelNotes-UI-Button",title:O.getText("PrintPageBuilder - Print"),textContent:"🖨️"},this.#Hl),this.#kl.addEventListener("click",this.#Zl,!1),this.#_e=W.create("div",{className:"TravelNotes-UI-Button",title:O.getText("PrintPageBuilder - Cancel print"),textContent:"❌"},this.#Hl),this.#_e.addEventListener("click",this.#Kl,!1)}constructor(t,e,o){Object.freeze(this),this.#ci=t,this.#nl=e,this.#Rl=o,this.#Bl=0,this.#zl=[],this.#Zl=new En,this.#Kl=new wn(this)}preparePage(){this.#Rl.firefoxBrowser?document.body.classList.add("TravelNotes-Maps-FirefoxBrowser"):document.body.classList.remove("TravelNotes-Maps-FirefoxBrowser");const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.add("TravelNotes-Hidden");document.title=""===K.travel.name?"maps":K.travel.name+" - "+this.#ci.computedName+" - maps",this.#Xl(),window.addEventListener("afterprint",this.#Kl,!0);const e=[],o=this.#ci.itinerary.itineraryPoints.iterator;for(;!o.done;)e.push(o.value.latLng);this.#Fl=new lo(e,{color:this.#ci.color,weight:this.#ci.width,dashArray:this.#ci.dashString}),this.#Bl=0,this.#nl.forEach(t=>this.#Vl(t))}}class xn{#Yl=0;static get#Gl(){return 256}#ql(t){const e=W.create("div",{},document.body);e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width=String(t.paperWidth-2*t.borderWidth)+"mm",e.style.height=String(t.paperHeight-2*t.borderWidth)+"mm";const o=ti.screenCoordToLatLng(0,0),i=ti.screenCoordToLatLng(e.clientWidth,e.clientHeight);this.#Yl=Math.ceil(e.clientWidth/xn.#Gl)*Math.ceil(e.clientHeight/xn.#Gl),document.body.removeChild(e);const s=K.map.getZoomScale(K.map.getZoom(),t.zoomFactor);return new _n(Math.abs(o[1]-i[1])*s,Math.abs(o[0]-i[0])*s)}constructor(){Object.freeze(this)}print(e,o){const i=ki.getRoute(o);if(!i)return;const s=new yn(i,this.#ql(e));if(t.printRouteMap.maxTiles<s.printViews.length*this.#Yl)return void Oi.showError(O.getText("RoutePrinter - The maximum of allowed pages is reached."));new Mn(i,s.printViews,e).preparePage()}}class In{static marker=null;static initialLatLng=null}class Cn{static handleEvent(){In.marker&&(In.marker.off(),K.map.removeLayer(In.marker),In.marker=null)}}const Nn=new class{constructor(){Object.freeze(this)}addRoute(){const t=new z;K.travel.routes.add(t),this.chainRoutes(),l.editedChanged===K.travel.editedRoute.editionStatus?(Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook")):this.editRoute(t.objId)}editRoute(t){const e=ki.getRoute(t),o=e.itinerary.provider,i=K.providers.get(o.toLowerCase());if(o&&""!==o&&(!i||i.providerKeyNeeded&&!ji.hasKey(o)))return void Oi.showError(O.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:o}));g!==K.editedRouteObjId&&this.cancelEdition(),o&&""!==o&&Si.dispatch("setprovider",{provider:o});const s=e.itinerary.transitMode;s&&""!==s&&Si.dispatch("settransitmode",{transitMode:s}),K.travel.editedRoute=new z,e.editionStatus=l.editedNoChange,K.travel.editedRoute.jsonObject=e.jsonObject,K.editedRouteObjId=e.objId,K.travel.editedRoute.hidden=!1,e.hidden=!1,vn.updateProfile(K.editedRouteObjId,K.travel.editedRoute),this.chainRoutes(),Si.dispatch("routeupdated",{removedRouteObjId:e.objId,addedRouteObjId:K.travel.editedRoute.objId}),Si.dispatch("updateroadbook"),Si.dispatch("updatetravelproperties")}removeRoute(t){let e=t;e!==K.editedRouteObjId&&e!==K.travel.editedRoute.objId||(e=K.editedRouteObjId,this.cancelEdition()),Si.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:g}),K.travel.routes.remove(e),vn.deleteProfile(e),this.chainRoutes(),Si.dispatch("updateroadbook"),Si.dispatch("updatetravelproperties")}saveGpx(t){(new Bi).routeToGpx(t)}chainRoutes(){const t=K.travel.routes.iterator;let e=o.defaultValue;for(;!t.done;){t.value.chain?(t.value.chainedDistance=e,e+=t.value.distance):t.value.chainedDistance=o.defaultValue;const i=t.value.notes.iterator;for(;!i.done;)i.value.chainedDistance=t.value.chainedDistance;if(t.value.objId===K.editedRouteObjId){K.travel.editedRoute.chainedDistance=K.travel.editedRoute.chain?t.value.chainedDistance:o.defaultValue;const e=K.travel.editedRoute.notes.iterator;for(;!e.done;)e.value.chainedDistance=K.travel.editedRoute.chainedDistance}}}saveEdition(){const t=new z;t.jsonObject=K.travel.editedRoute.jsonObject,K.travel.routes.replace(K.editedRouteObjId,t),K.editedRouteObjId=t.objId,this.cancelEdition()}cancelEdition(){Cn.handleEvent();const t=ki.getRoute(K.editedRouteObjId);t.editionStatus=l.notEdited,vn.updateProfile(K.travel.editedRoute.objId,t),Si.dispatch("routeupdated",{removedRouteObjId:K.travel.editedRoute.objId,addedRouteObjId:K.editedRouteObjId}),K.editedRouteObjId=g,K.travel.editedRoute=new z,this.chainRoutes(),Si.dispatch("updateroadbook"),Si.dispatch("updatetravelproperties")}routeProperties(t){const e=ki.getRoute(t);new Qi(e).show().then(()=>{this.chainRoutes(),e.haveValidWayPoints()&&Si.dispatch("routepropertiesupdated",{routeObjId:e.objId}),Si.dispatch("updateroadbook"),Si.dispatch("updatetravelproperties"),Si.dispatch("updateprofilename",{routeObjId:t})}).catch(t=>{t instanceof Error&&console.error(t)})}printRouteMap(t){(new os).show().then(e=>(new xn).print(e,t)).catch(t=>{t instanceof Error&&console.error(t)})}showRoute(t){ki.getRoute(t).hidden=!1,Si.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t}),Si.dispatch("updatetravelproperties")}hideRoute(t){ki.getRoute(t).hidden=!0,Si.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:g}),Si.dispatch("updatetravelproperties")}showRoutes(){const t=K.travel.routes.iterator;for(;!t.done;)t.value.hidden&&(t.value.hidden=!1,Si.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t.value.objId}));Si.dispatch("updatetravelproperties")}hideRoutes(){const t=K.travel.routes.iterator;for(;!t.done;)t.value.hidden||t.value.objId===K.editedRouteObjId||(t.value.hidden=!0,Si.dispatch("routeupdated",{removedRouteObjId:t.value.objId,addedRouteObjId:g}));Si.dispatch("updatetravelproperties")}};class Pn{static get#$l(){return.5}static get#Jl(){return 5}static get#Ql(){return 10}static get#th(){return 31}static get#eh(){return 32}static get#oh(){return 63}#ih(t){return Math.floor(Math.abs(t)+Pn.#$l)*(0<=t?1:-1)}#sh(t,e,o){const i=this.#ih(t*o),s=this.#ih(e*o);let n=i-s;n<<=1,0>i-s&&(n=~n);let r="";for(;Pn.#eh<=n;)r+=String.fromCharCode((Pn.#eh|n&Pn.#th)+Pn.#oh),n>>=Pn.#Jl;return r+=String.fromCharCode(n+Pn.#oh),r}#n;#nh(t){let e=null,o=0,i=0;do{e=t.charCodeAt(this.#n++)-Pn.#oh,i|=(e&Pn.#th)<<o,o+=Pn.#Jl}while(Pn.#eh<=e);return 1&i?~(i>>1):i>>1}constructor(){Object.freeze(this)}encode(t,e){if(!t.length)return"";const o=e.length,i=Array.from(e,t=>Math.pow(Pn.#Ql,t));let s="";for(let e=0;e<o;e++)s+=this.#sh(t[0][e],0,i[e]);for(let e=1;e<t.length;e++){const n=t[e],r=t[e-1];for(let t=0;t<o;t++)s+=this.#sh(n[t],r[t],i[t])}return s}decode(t,e){const o=e.length;if(!t||0===t.length)return[];this.#n=0;const i=[],s=Array.from(e,t=>Math.pow(Pn.#Ql,t)),n=new Array(o).fill(0);for(;this.#n<t.length;){const e=new Array(o).fill(0);for(let i=0;i<o;i++)n[i]+=this.#nh(t),e[i]=n[i]/s[i];i.push(e)}return i}}class On{#rh(t){const e={values:"",objType:(new R).objType.jsonObject},o=[];t.itinerary.itineraryPoints.forEach(t=>{o.push([t.lat,t.lng,t.distance,t.elev,t.objId])}),e.values=(new Pn).encode(o,[a.fixed,a.fixed,2,2,0]),t.itinerary.itineraryPoints=e}#ah(t){const e=[];if(t.itinerary.itineraryPoints.values)(new Pn).decode(t.itinerary.itineraryPoints.values,[a.fixed,a.fixed,2,2,0]).forEach(s=>{const n={lat:a.defaultValue,lng:a.defaultValue,distance:o.defaultValue,elev:i.defaultValue,objId:g};[n.lat,n.lng,n.distance,n.elev,n.objId]=s,n.objType=t.itinerary.itineraryPoints.objType,e.push(n)});else{t.itinerary.itineraryPoints.latLngs=(new Pn).decode(t.itinerary.itineraryPoints.latLngs,[a.fixed,a.fixed]);let o=0;t.itinerary.itineraryPoints.latLngs.forEach(s=>{const n={};n.lat=s[0],n.lng=s[1],n.distance=t.itinerary.itineraryPoints.distances[o],t.itinerary.itineraryPoints.elevs?n.elev=t.itinerary.itineraryPoints.elevs[o]:n.elev=i.defaultValue,n.objId=t.itinerary.itineraryPoints.objIds[o],n.objType=t.itinerary.itineraryPoints.objType,e.push(n),o++})}t.itinerary.itineraryPoints=e}constructor(){Object.freeze(this)}decompress(t){t.routes.forEach(this.#ah),t.editedRoute&&this.#ah(t.editedRoute)}compress(t){const e=t.jsonObject;return e.routes.forEach(t=>this.#rh(t)),this.#rh(e.editedRoute),e}}class Dn{constructor(){Object.freeze(this)}openDistantFile(t){(new On).decompress(t),K.travel.jsonObject=t,K.travel.readOnly=!0,document.title="Travel & Notes"+(""===K.travel.name?"":" - "+K.travel.name);const e=K.travel.routes.iterator;for(;!e.done;)l.notEdited===e.value.editionStatus?Si.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:e.value.objId}):K.editedRouteObjId=e.value.objId;g!==K.editedRouteObjId&&Si.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:K.travel.editedRoute.objId});const o=K.travel.notes.iterator;for(;!o.done;)Si.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:o.value.objId});(new an).zoomToTravel()}}const Sn=new class{#Vo=null;constructor(){Object.freeze(this)}createUI(){this.#Vo=W.create("div",{id:"TravelNotes-AttributionsUI"},document.body)}set attributions(t){const e='© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">🇺🇦 Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| © <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">🏴‍☠️ Travel & Notes</a>';for(;this.#Vo.firstChild;)this.#Vo.removeChild(this.#Vo.firstChild);P.sanitizeToHtmlElement(e,this.#Vo)}};const jn=new class{constructor(){Object.freeze(this)}setMapLayer(t){const e=Ln.getMapLayer(t);Si.dispatch("layerchange",{layer:e}),Sn.attributions=e.attribution,K.travel.layerName=e.name}};class An{toolbarItemsArray;constructor(){Object.seal(this),this.toolbarItemsArray=[]}}class Rn{#lh;constructor(t){Object.freeze(this),this.#lh=t}handleEvent(t){this.#lh.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].doAction()}}class Hn{#hh;#lh;#dh;static get#ch(){return 5}constructor(t,e){Object.freeze(this),this.#hh=t,this.#lh=e}handleEvent(t){switch(t.type){case"touchstart":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);this.#dh=e.screenY}break;case"touchend":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);Hn.#ch>Math.abs(e.screenY-this.#dh)&&(t.stopPropagation(),t.preventDefault(),this.#lh.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].doAction(),this.#hh.hide())}}}}class kn{#uh;constructor(){Object.freeze(this),this.#uh=Number.MAX_VALUE}handleEvent(t){switch(t.type){case"touchstart":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);this.#uh=e.screenY}break;case"touchmove":case"touchend":if(1===t.changedTouches.length){const e=t.changedTouches.item(0),o=this.#uh-e.screenY;t.currentTarget.scrollTop+=o,this.#uh=e.screenY}break;default:this.#uh=Number.MAX_VALUE}"touchend"===t.type&&(this.#uh=Number.MAX_VALUE)}}class Bn{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.currentTarget.scrollTop+=t.deltaY*v[t.deltaMode])}}class zn{#_o;#mh;#Yo;#ph;#gh;#vh;#fh;#yh;#lh;static get#_h(){return 100}#Th;#bh(t,e){const o=W.create("div",{className:"TravelNotes-BaseToolbar-ButtonHTMLElement",textContent:t.textContent,title:t.title,dataset:{ItemId:e}},this.#mh);o.addEventListener("click",this.#vh,!1),o.addEventListener("touchstart",this.#fh,!1),o.addEventListener("touchend",this.#fh,!1)}#Qe(){this.#mh=W.create("div",{className:"TravelNotes-BaseToolbar-ButtonsHTMLElement"},this.#_o),this.#lh.toolbarItemsArray=[],this.addToolbarItems(),this.#lh.toolbarItemsArray.forEach((t,e)=>{this.#bh(t,e)}),this.#mh.addEventListener("wheel",this.#ph,{passive:!0}),this.#mh.addEventListener("touchstart",this.#gh,!1),this.#mh.addEventListener("touchmove",this.#gh,!1),this.#mh.addEventListener("touchend",this.#gh,!1),this.#yh=!0}#Lh(t){zn.#_h>t.timeStamp-this.#Th||this.#Eh(t)}#Eh(t){if(this.#Th=t.timeStamp,this.#yh){if(this.#Yo)return clearTimeout(this.#Yo),void(this.#Yo=null);this.hide()}else this.#Qe()}#wh(){this.#yh&&(this.#Yo=setTimeout(()=>this.hide(),t.toolbars.timeOut))}constructor(){Object.freeze(this)}hide(){for(this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null);this.#mh.firstChild;){const t=this.#mh.firstChild;t.removeEventListener("click",this.#vh,!1),t.removeEventListener("touchstart",this.#fh,!1),t.removeEventListener("touchend",this.#fh,!1),this.#mh.removeChild(t)}this.#mh.removeEventListener("wheel",this.#ph,{passive:!0}),this.#mh.removeEventListener("touchstart",this.#gh,!1),this.#mh.removeEventListener("touchmove",this.#gh,!1),this.#mh.removeEventListener("touchend",this.#gh,!1),this.#_o.removeChild(this.#mh),this.#mh=null,this.#yh=!1}createUI(t,e){if(this.#_o)return!1;this.#Yo=null,this.#yh=!1,this.#Th=0,this.#lh=new An,this.#ph=new Bn,this.#gh=new kn,this.#vh=new Rn(this.#lh),this.#fh=new Hn(this,this.#lh),this.#_o=W.create("div",{className:"TravelNotes-BaseToolbar-ToolbarHTMLElement "+e},document.body),this.#_o.addEventListener("click",t=>this.#Lh(t),!1),this.#_o.addEventListener("mouseenter",t=>this.#Eh(t),!1),this.#_o.addEventListener("mouseleave",t=>this.#wh(t),!1),W.create("div",{className:"TravelNotes-BaseToolbar-HeaderTextHTMLElement",textContent:t},W.create("div",{className:"TravelNotes-BaseToolbar-HeaderHTMLElement"},this.#_o))}addToolbarItem(t){this.#lh.toolbarItemsArray.push(t)}addCssClass(t){this.#_o.classList.add(t)}}class Fn{#Mh;#re;#fn;constructor(t,e,o){this.#Mh=t,this.#Mh="function"==typeof t?t():t,this.#re=e,this.#fn=o}get textContent(){return this.#Mh}get title(){return this.#re}doAction(){switch(typeof this.#fn){case"string":{const t=document.createElement("a");t.href=this.#fn,t.target="_blank",t.click()}break;case"function":this.#fn()}}}const Zn=new class extends zn{constructor(){super()}createUI(){super.createUI(O.getText("MapLayersToolbar - Layers"),d.topLeft),this.addCssClass("TravelNotes-MapLayersToolbar-ToolbarHTMLElement")}addToolbarItems(){Ln.forEach(t=>{(t.providerKeyNeeded&&ji.hasKey(t.providerName.toLowerCase())||!t.providerKeyNeeded)&&this.addToolbarItem(new Fn(t.toolbarButtonData.text,t.name,()=>{jn.setMapLayer(t.name)}))}),t.mapLayersToolbar?.theDevil?.addButton&&this.addToolbarItem(new Fn("👿","Reminder! The devil will know everything about you","https://www.google.com/maps/@"+K.map.getCenter().lat+","+K.map.getCenter().lng+","+K.map.getZoom()+"z"))}};class Kn{#xh;#Ih;#Ch;#Nh;#Ph;#Oh;#Dh;static get#Sh(){return 3e5}#jh(t){K.map.setZoom(K.map.getZoom()+t)}#Ah(){this.#xh&&(this.#xh.textContent=" "+this.#Nh+" "+this.#Ph+" - Zoom : "+String(this.#Oh)+" ");const t=K.map;t.getMaxZoom()===this.#Oh?this.#Ih.classList.add("TravelNotes-MouseUI-Disabled"):this.#Ih.classList.remove("TravelNotes-MouseUI-Disabled"),t.getMinZoom()===this.#Oh?this.#Ch.classList.add("TravelNotes-MouseUI-Disabled"):this.#Ch.classList.remove("TravelNotes-MouseUI-Disabled")}constructor(){Object.freeze(this),this.#Nh=h.saved,this.#Ph="",this.#Oh=0,this.#Dh=null}set saveStatus(t){h.modified===t&&h.notSaved===this.#Nh||(this.#Nh=t,h.modified!==t||this.#Dh?h.saved===t&&this.#Dh&&(clearTimeout(this.#Dh),this.#Dh=null):this.#Dh=setTimeout(()=>this.#Nh=h.notSaved,Kn.#Sh),this.#Ah())}createUI(){const e=W.create("div",{id:"TravelNotes-MouseUI"},document.body);this.#Ch=W.create("span",{id:"TravelNotes-MouseUI-ZoomMinus",textContent:"▼"},e),this.#Ch.addEventListener("click",()=>this.#jh(-1)),this.#xh=W.create("span",null,e),this.#Ih=W.create("span",{id:"TravelNotes-MouseUI-ZoomPlus",textContent:"▲"},e),this.#Ih.addEventListener("click",()=>this.#jh(1)),this.#Oh=K.map.getZoom(),this.#Ph=D.formatLat(t.map.center.lat)+" - "+D.formatLng(t.map.center.lng),K.map.on("pointermove",t=>{this.#Ph=D.formatLatLng([t.latlng.lat,t.latlng.lng]),this.#Ah()}),K.map.on("zoomend",()=>{this.#Oh=K.map.getZoom(),this.#Ah()})}}const Un=new Kn;class Wn extends ds{#Rh=null;constructor(){super()}createContentHTML(){this.#Rh=W.create("div",{id:"TravelNotes-AboutDialog-About"}),P.sanitizeToHtmlElement('<p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2023 - wwwouaiebe</p><p>Contact : <a href="https://www.ouaie.be/pages/Contact" target="_blank">https://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank">https://github.com/wwwouaiebe/TravelNotes</a></p><p>Version : '+L+'.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p>',this.#Rh)}show(){super.show(),this.mover.centerDialog()}get contentHTMLElements(){return[this.#Rh]}get title(){return O.getText("AboutDialog - About Travel & Notes")}}const Vn=new class{#Hh=navigator.geolocation?s.inactive:s.disabled;#kh=null;#Bh(t){Si.dispatch("geolocationpositionchanged",{position:t})}#zh(){s.active===this.#Hh&&(this.#Hh=s.inactive),Si.dispatch("geolocationstatuschanged",{status:this.#Hh}),this.#kh&&(navigator.geolocation.clearWatch(this.#kh),this.#kh=null)}#Fh(t){1===t.code&&(this.#Hh=s.refusedByUser),2===t.code&&Oi.showError(O.getText("GeoLocator - Geolocation disabled on the device")),this.#zh()}#Zh(){this.#Hh=s.active,Si.dispatch("geolocationstatuschanged",{status:this.#Hh}),t.geoLocation.watch?this.#kh=navigator.geolocation.watchPosition(t=>this.#Bh(t),t=>this.#Fh(t),t.geoLocation.options):navigator.geolocation.getCurrentPosition(t=>this.#Bh(t),t=>this.#Fh(t),t.geoLocation.options)}constructor(){Object.freeze(this)}get status(){return this.#Hh}switch(){switch(this.#Hh){case s.inactive:this.#Zh();break;case s.active:this.#zh()}return this.#Hh}};class Xn{#Kh;#Uh;#Wh;constructor(t,e,o){Object.freeze(this),this.#Kh=t,this.#Uh=e,this.#Wh=o}get removeTravelNotes(){return this.#Kh}get removeRoutesNotes(){return this.#Uh}get removeManeuvers(){return this.#Wh}}class Yn extends ci{#Vh;#Xh;#Yh;constructor(t){super(t)}createContentHTML(){this.#Vh=new zi({afterText:O.getText("SaveAsDialog - Remove Travel Notes"),checked:!1}),this.#Xh=new zi({afterText:O.getText("SaveAsDialog - Remove Routes Notes"),checked:!1}),this.#Yh=new zi({afterText:O.getText("SaveAsDialog - Remove Maneuvers"),checked:!1})}onOk(){super.onOk(new Xn(this.#Vh.checked,this.#Xh.checked,this.#Yh.checked))}get contentHTMLElements(){return[this.#Vh.controlHTMLElement,this.#Xh.controlHTMLElement,this.#Yh.controlHTMLElement]}get title(){return O.getText("SaveAsDialog - SaveAs")}}const Gn=new class{#Gh(e){const o=new F;o.jsonObject=K.travel.jsonObject,o.name+="-partial";let i=o.routes.iterator;for(;!i.done;)i.value.hidden=!1;if(e.removeTravelNotes&&o.notes.removeAll(),e.removeRoutesNotes)for(i=o.routes.iterator;!i.done;)i.value.notes.removeAll();if(e.removeManeuvers)for(i=o.routes.iterator;!i.done;)i.value.itinerary.maneuvers.removeAll();const s=(new On).compress(o);D.saveFile(s.name+"."+(li.isTouch?t.files.writeTouch:t.files.writeOthers),JSON.stringify(s),"application/json")}#qh(){return""!==K.travel.name||(Oi.showError(O.getText("TravelEditor - Gives a name to the travel")),Si.dispatch("showtravelproperties"),!1)}constructor(){Object.freeze(this)}routeDropped(t,e,o){const i=t===K.travel.editedRoute.objId?K.editedRouteObjId:t,s=e===K.travel.editedRoute.objId?K.editedRouteObjId:e;K.travel.routes.moveTo(i,s,o),Nn.chainRoutes(),Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook")}saveAsTravel(){if(this.#qh())return g!==K.editedRouteObjId?(Oi.showError(O.getText("TravelEditor - Not possible to partial save when a route is edited.")),void Si.dispatch("showtravelproperties")):void(new Yn).show().then(t=>{this.#Gh(t)}).catch(t=>{t instanceof Error&&console.error(t)})}saveTravel(){if(!this.#qh())return;const e=K.travel.routes.iterator;for(;!e.done;)e.value.hidden=!1;const o=(new On).compress(K.travel);D.saveFile(o.name+"."+(li.isTouch?t.files.writeTouch:t.files.writeOthers),JSON.stringify(o),"application/json"),Un.saveStatus=h.saved}newTravel(){t.travelNotes.haveBeforeUnloadWarning&&!window.confirm(O.getText("TravelEditor - This page ask to close; data are perhaps not saved."))||(vn.deleteAllProfiles(),Si.dispatch("removeallobjects"),K.editedRouteObjId=g,K.travel.jsonObject=(new F).jsonObject,Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook"),Si.dispatch("updatetravelnotes"),t.travelNotes.startupRouteEdition&&Nn.editRoute(K.travel.routes.first.objId),Un.saveStatus=h.saved)}};class qn extends hi{#$h;#Jh(){this.onTop?(this.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-Docked"),this.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-HiddenContent"),this.dialogHTMLElement.style.top="0px",this.#$h=!0):(this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-Docked"),this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-HiddenContent"),this.#$h=!1)}constructor(){super(),this.#$h=!1}get dialogDocked(){return this.#$h}centerDialog(){this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-Docked"),this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-HiddenContent"),super.centerDialog()}moveDialogTo(t,e,o){super.moveDialogTo(t,e,o),o&&"touchmove"===o||this.#Jh()}}class $n extends ds{#me;#pe;#Qh;#td;#Th;#yh;static get#_h(){return 100}static get#ed(){return 1500}#od(){this.mover.dialogDocked&&(bs.isActive?this.#Qh=setTimeout(()=>{this.#od()},Math.max($n.#ed,t.dockableBaseDialog.timeout)):this.mover.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-HiddenContent"))}#id(t){this.#Th=t.timeStamp,this.#Qh&&(clearTimeout(this.#Qh),this.#Qh=null),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-HiddenContent")}#sd(){this.mover.dialogDocked&&(this.#Qh=setTimeout(()=>{this.#od()},Math.max($n.#ed,t.dockableBaseDialog.timeout)))}#nd(t){t.preventDefault(),$n.#_h>t.timeStamp-this.#Th||this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.toggle("TravelNotes-DockableBaseDialog-HiddenContent")}constructor(t,e){super(),this.#me=t,this.#pe=e,this.#Qh=null,this.#td=null,this.#Th=0,this.#yh=!1}get mover(){return this.#td?this.#td:this.#td=new qn}onCancel(){super.onCancel(),this.#yh=!1,this.#td&&(this.#td=null)}show(){this.#yh||(super.show(),this.addCssClass("TravelNotes-DockableBaseDialog"),this.updateContent(),null!==this.#me&&null!==this.#pe?(this.mover.moveDialogTo(this.#me,this.#pe),this.#me=null,this.#pe=null):this.mover.moveDialogToLastPosition(),this.mover.dialogHTMLElement.addEventListener("mouseenter",t=>this.#id(t),!1),t.dockableBaseDialog.hideOnMouseLeave&&this.mover.dialogHTMLElement.addEventListener("mouseleave",()=>this.#sd(),!1),this.mover.topBarHTMLElement.addEventListener("click",t=>this.#nd(t),!1),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-HiddenContent"),this.#yh=!0)}}class Jn{#U="";#rd=!1;#ad=[];#ld=["node","way","relation"];#hd=[];#dd=!1;#cd=!1;#t=g;constructor(t,e){this.#U=P.sanitizeToJsString(t),e&&(this.#cd=!0,this.#rd=!0),this.#t=T.nextObjId,Object.freeze(this)}get name(){return this.#U}get isRoot(){return this.#rd}get items(){return this.#ad}get elementTypes(){return this.#ld}setElementType(t){f!==["node","way","relation"].indexOf(t)&&(this.#ld=[t])}get filterTagsArray(){return this.#hd}get isSelected(){return this.#dd}set isSelected(t){this.#dd=t,this.items.forEach(e=>{e.isSelected=t})}get isExpanded(){return this.#cd}set isExpanded(t){this.#cd=t}get objId(){return this.#t}}const Qn=new class{#ud;#md;#pd;#gd;#vd(t){const e=t.split(";");for(;""===e[e.length-1];)e.pop();let o=0;const i=[];e.forEach(t=>{if(""!==t)if(f===t.indexOf("="))this.#pd=new Jn(t),this.#md.set(this.#pd.objId,this.#pd),this.#gd[o].push(this.#pd),this.#gd[o+1]=this.#pd.items;else{let e=t.split("=");if("element"===e[0])this.#pd.setElementType(e[1]);else{let t={};t[e[0]]="*"===e[1]?null:e[1],i.push(t)}}o++}),0!==i.length&&this.#pd.filterTagsArray.push(i)}#fd(t){t.items.forEach(t=>{this.#fd(t)}),t.isExpanded=!0}#yd(t){t.items.forEach(t=>{this.#yd(t)}),t.isExpanded=!1}constructor(){this.#ud=new Jn("",!0),this.#md=new Map,this.#md.set(this.#ud.objId,this.#ud),this.#gd=[this.#ud.items],Object.freeze(this)}get dictionary(){return this.#ud}parseDictionary(t){t.split(/\r\n|\r|\n/).forEach(t=>{""!==t&&this.#vd(t)})}selectItem(t,e){this.#md.get(t).isSelected=e}unselectAll(){this.#ud.isSelected=!1}expandItem(t){let e=this.#md.get(t);e.isExpanded=!e.isExpanded}expand(){this.#fd(this.#ud)}collapse(){this.#ud.items.forEach(t=>this.#yd(t))}};class tr{#_d;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),Qn.unselectAll(),this.#_d.redraw()}}class er{#_d;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),Qn.collapse(),this.#_d.redraw()}}class or{#_d;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),Qn.expand(),this.#_d.redraw()}}class ir{#Td;#bd;#Ld;static get#Ed(){return 5e3}#wd(t,e){let o=!0;return e.forEach(e=>{const[i,s]=Object.entries(e)[0];o=o&&t.tags[i]&&(!s||t.tags[i]===s)}),o}#Md(t,e){this.#bd.forEach(o=>{o.filterTagsArray.forEach(i=>{this.#wd(t,i)&&(t.description=o.name,e.set(t.id,t))})})}#xd(){const e=[],o=new Map;this.#bd.forEach(t=>{t.filterTagsArray.forEach(e=>{const[i,s]=Object.entries(e[0])[0];let n=o.get(i);n||(n={values:new Map,elements:new Map},o.set(i,n)),n.values.set(s,s),t.elementTypes.forEach(t=>{n.elements.set(t,t)})})});const i=this.#Id();this.#Ld=i;const s="("+i.getSouthWest().lat.toFixed(a.fixed)+","+i.getSouthWest().lng.toFixed(a.fixed)+","+i.getNorthEast().lat.toFixed(a.fixed)+","+i.getNorthEast().lng.toFixed(a.fixed)+")";return o.forEach((o,i)=>{let n='"'+i+'"';if(1===o.values.size){const t=o.values.values().next().value;t&&(n+='="'+t+'"')}else 1<o.values.size&&(n+='~"',o.values.forEach(t=>{n+=t+"|"}),n=n.substring(0,n.length-1)+'"');if(t.overpassApi.useNwr){const t=1===o.elements.size?o.elements.values().next().value:"nwr";e.push(t+"["+n+"]"+s+";"+("node"===t?"":"(._;>;);")+"out;")}else{let t=[];1===o.elements.size?t.push(o.elements.values().next().value):t=["node","way","rel"],t.forEach(t=>{e.push(t+"["+n+"]"+s+";"+("node"===t?"":"(._;>;);")+"out;")})}}),e}#Cd(t){t.isSelected&&0<t.filterTagsArray.length&&this.#bd.push(t),t.items.forEach(t=>this.#Cd(t))}#Id(){const t=K.map.getCenter(),e=K.map.getBounds(),o=ti.getSquareBoundingBox([t.lat,t.lng],ir.#Ed);return e.getSouthWest().lat=Math.max(e.getSouthWest().lat,o.getSouthWest().lat),e.getSouthWest().lng=Math.max(e.getSouthWest().lng,o.getSouthWest().lng),e.getNorthEast().lat=Math.min(e.getNorthEast().lat,o.getNorthEast().lat),e.getNorthEast().lng=Math.min(e.getNorthEast().lng,o.getNorthEast().lng),e}constructor(){Object.freeze(this),this.#Td=!1,this.#bd=[],this.#Ld=null}async search(){if(this.#Td)return;this.#Td=!0,this.#bd=[],this.#Cd(Qn.dictionary);const t=new Os({searchPlaces:!1});await t.loadData(this.#xd());const e=new Map;t.statusOk||Oi.showError(O.getText("OsmSearchEngine - incomplete results")),[t.nodes,t.ways,t.relations].forEach(t=>{t.forEach(t=>{t.tags&&this.#Md(t,e)})}),K.searchData.length=0,Array.from(e.values()).sort((t,e)=>t.description>e.description).forEach(t=>K.searchData.push(t)),this.#Td=!1,Si.dispatch("updateosmsearch")}get searchBounds(){return this.#Id()}get previousSearchBounds(){return this.#Ld}}const sr=new ir;class nr{#_d;#Nd;constructor(t,e){Object.freeze(this),this.#_d=t,this.#Nd=e}handleEvent(t){t.stopPropagation(),Qn.dictionary.isExpanded=!1,this.#_d.redraw(),K.searchData.length=0,Si.dispatch("updateosmsearch"),this.#Nd.showWait(),sr.search()}}class rr{#Pd;constructor(t,e){Object.freeze(this),this.#Pd=W.create("div"),W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Start the search"),textContent:"🔎"},this.#Pd).addEventListener("click",new nr(t,e),!1),W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Expand the tree"),textContent:"▼"},this.#Pd).addEventListener("click",new or(t),!1),W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Collapse the tree"),textContent:"▶"},this.#Pd).addEventListener("click",new er(t),!1),W.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Clear the tree"),textContent:"❌"},this.#Pd).addEventListener("click",new tr(t),!1)}get toolbarButtonsHTMLElement(){return this.#Pd}}class ar{#_d=null;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),Qn.expandItem(Number.parseInt(t.target.parentNode.dataset.tanObjId)),this.#_d.redraw()}}class lr{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.target.scrollTop+=t.deltaY*v[t.deltaMode]),t.stopPropagation()}}class hr{#_d=null;constructor(t){Object.freeze(this),this.#_d=t}handleEvent(t){t.stopPropagation(),Qn.selectItem(Number.parseInt(t.target.parentNode.dataset.tanObjId),t.target.checked),this.#_d.redraw()}}class dr{#Od;#Dd;#Sd;#jd;#Ad(t){this.#jd++;const e=W.create("div",{className:"TravelNotes-OsmSearchDialog-SearchItemMargin"+this.#jd,dataset:{ObjId:t.objId}},this.#Od);if(!t.isRoot){W.create("input",{type:"checkbox",checked:t.isSelected},e).addEventListener("change",this.#Sd,!1)}if(0===t.filterTagsArray.length){W.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-OsmSearchDialog-TreeArrow",textContent:t.isExpanded?"▼":"▶"},e).addEventListener("click",this.#Dd,!1)}W.create("text",{value:t.name},e),t.isExpanded&&t.items.forEach(t=>this.#Ad(t)),this.#jd--}constructor(){Object.freeze(this),this.#jd=0,this.#Od=W.create("div",{id:"TravelNotes-OsmSearchDialog-SearchTree"}),this.#Od.addEventListener("wheel",new lr,{passive:!0}),this.#Sd=new hr(this),this.#Dd=new ar(this),this.#Ad(Qn.dictionary)}redraw(){this.#Od.textContent="",this.#Ad(Qn.dictionary)}get treeHTMLElement(){return this.#Od}}class cr{#Ae;constructor(){this.#Ae=W.create("div",{className:"TravelNotes-WaitAnimation"}),W.create("div",{className:"TravelNotes-WaitAnimationBullet"},this.#Ae),this.#Ae.classList.add("TravelNotes-Hidden")}showWait(){this.#Ae.classList.remove("TravelNotes-Hidden")}hideWait(){this.#Ae.classList.add("TravelNotes-Hidden")}get waitHTMLElement(){return this.#Ae}}class ur{#ha;constructor(t,e){Object.freeze(this),this.#ha=new Ks(t,e)}destructor(){this.#ha=null}get addressButtonClick(){return this.#ha}}class mr extends ci{#Rd;#Hd;#ya;#Ea;constructor(t){super(),this.#Rd=t,this.#Ea=new ur(this,this.#Rd.latLng)}createContentHTML(){this.#Hd=new $i({headerText:O.getText("WayPointPropertiesDialog - Name")},this.#Ea),this.#Hd.value=this.#Rd.name,this.#ya=new Ns(this.#Ea),this.#ya.address=this.#Rd.address}onCancel(){this.#Ea.destructor(),super.onCancel()}onOk(){this.#Rd.address=this.#ya.address,this.#Rd.name=this.#Hd.value,this.#Ea.destructor(),super.onOk()}get contentHTMLElements(){return[this.#Hd.controlHTMLElement,this.#ya.controlHTMLElement]}set name(t){this.#Hd.name=t}set address(t){this.#ya.address=t}get title(){return O.getText("WayPointPropertiesDialog - Waypoint properties")}get wayPoint(){return this.#Rd}setControlsValues(t){this.#ya.address=t.address,this.#Hd.value=t.name}}const pr=new class{#kd;#Bd;#zd(t){const e=t.itinerary.itineraryPoints.iterator,i=t.itinerary.maneuvers.iterator;for(e.done,i.done,i.value.distance=o.defaultValue,i.done,t.distance=o.defaultValue,t.duration=o.defaultValue;!e.done;)e.previous.distance=Ai.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,i.previous.distance+=e.previous.distance,i.value.itineraryPointObjId===e.value.objId&&(t.duration+=i.previous.duration,i.value.distance=o.defaultValue,i.next&&i.value.itineraryPointObjId===i.next.itineraryPointObjId&&(i.done,i.value.distance=o.defaultValue),i.done)}#Fd(t){this.#kd=!1,t instanceof Error?(console.error(t),Oi.showError(t.message)):Oi.showError("A network error occurs when calling the provider")}#Zd(){if(this.#kd=!1,this.#zd(K.travel.editedRoute),"circle"!==K.travel.editedRoute.itinerary.transitMode){const t=K.travel.editedRoute.wayPoints.iterator;for(;!t.done;)t.first?t.value.latLng=K.travel.editedRoute.itinerary.itineraryPoints.first.latLng:t.last?t.value.latLng=K.travel.editedRoute.itinerary.itineraryPoints.last.latLng:t.value.latLng=ti.getClosestLatLngDistance(K.travel.editedRoute,t.value.latLng).latLng}const t=K.travel.editedRoute.notes.iterator;for(;!t.done;){const e=ti.getClosestLatLngDistance(K.travel.editedRoute,t.value.latLng);t.value.latLng=e.latLng,t.value.distance=e.distance}Nn.chainRoutes(),K.travel.editedRoute.notes.sort((t,e)=>t.distance-e.distance),this.#Bd&&(new an).zoomToRoute(K.travel.editedRoute.objId),vn.createProfile(K.travel.editedRoute),Si.dispatch("routeupdated",{removedRouteObjId:K.travel.editedRoute.objId,addedRouteObjId:K.travel.editedRoute.objId}),Si.dispatch("updateroadbook"),Si.dispatch("updatetravelproperties")}constructor(){Object.freeze(this)}startRouting(){if(!this.#kd&&K.travel.editedRoute.haveValidWayPoints()){this.#Bd=0===K.travel.editedRoute.itinerary.itineraryPoints.length,this.#kd=!0;const t=K.providers.get(K.routing.provider.toLowerCase());K.travel.editedRoute.itinerary.provider=t.name,K.travel.editedRoute.itinerary.transitMode=K.routing.transitMode,t.getPromiseRoute(K.travel.editedRoute).then(()=>this.#Zd()).catch(()=>this.#Fd())}}};const gr=new class{async#Kd(e){if(!t.wayPoint.reverseGeocoding)return Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook"),void Si.dispatch("updateprofilename",{routeObjId:K.editedRouteObjId});const o=await(new js).getAddressAsync(e.latLng);K.editedRouteObjId===K.travel.editedRoute.objId&&(K.travel.editedRoute.editionStatus=l.editedChanged),e.address=o.street,""!==o.city&&(e.address+=" "+o.city),e.name="",t.wayPoint.geocodingIncludeName&&(e.name=o.name),Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook"),Si.dispatch("updateprofilename",{routeObjId:K.travel.editedRoute.objId})}#Ud(t){const e=K.travel.editedRoute.wayPoints.first;e.latLng=t,this.#Kd(e),Si.dispatch("addwaypoint",{wayPoint:e,letter:"A"})}#Wd(t){const e=K.travel.editedRoute.wayPoints.last;e.latLng=t,this.#Kd(e),Si.dispatch("addwaypoint",{wayPoint:e,letter:"B"})}constructor(){Object.freeze(this)}addWayPoint(t){K.travel.editedRoute.editionStatus=l.editedChanged;const e=new A;e.latLng=t,K.travel.editedRoute.wayPoints.add(e),this.#Kd(e),Si.dispatch("addwaypoint",{wayPoint:K.travel.editedRoute.wayPoints.last,letter:K.travel.editedRoute.wayPoints.length-2}),K.travel.editedRoute.wayPoints.swap(e.objId,!0),pr.startRouting()}addWayPointOnRoute(t,e){const o=ti.getClosestLatLngDistance(K.travel.editedRoute,t).distance;K.travel.editedRoute.editionStatus=l.editedChanged;const i=new A;i.latLng=e;let s="";const n=K.travel.editedRoute.wayPoints.iterator;for(;!n.done;){if(o<ti.getClosestLatLngDistance(K.travel.editedRoute,n.value.latLng).distance){s=String(n.index),K.travel.editedRoute.wayPoints.add(i),K.travel.editedRoute.wayPoints.moveTo(i.objId,n.value.objId,!0),this.#Kd(i),Si.dispatch("addwaypoint",{wayPoint:i,letter:s}),pr.startRouting();break}}}reverseWayPoints(){K.travel.editedRoute.editionStatus=l.editedChanged;let t=K.travel.editedRoute.wayPoints.iterator;for(;!t.done;)Si.dispatch("removeobject",{objId:t.value.objId});for(K.travel.editedRoute.wayPoints.reverse(),t=K.travel.editedRoute.wayPoints.iterator;!t.done;)Si.dispatch("addwaypoint",{wayPoint:t.value,letter:t.first?"A":t.last?"B":String(t.index)});Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook"),pr.startRouting()}removeWayPoint(t){K.travel.editedRoute.editionStatus=l.editedChanged,Si.dispatch("removeobject",{objId:t}),K.travel.editedRoute.wayPoints.remove(t),pr.startRouting()}setStartPoint(t){K.travel.editedRoute.editionStatus=l.editedChanged,this.#Ud(t),pr.startRouting()}setEndPoint(t){K.travel.editedRoute.editionStatus=l.editedChanged,this.#Wd(t),pr.startRouting()}setStartAndEndPoint(t){K.travel.editedRoute.editionStatus=l.editedChanged,this.#Ud(t),this.#Wd(t),2<K.travel.editedRoute.wayPoints.length&&pr.startRouting()}wayPointDragEnd(t){K.travel.editedRoute.editionStatus=l.editedChanged;const e=K.travel.editedRoute.wayPoints.getAt(t.target.objId),o=t.target.getLatLng();e.latLng=[o.lat,o.lng],this.#Kd(e),pr.startRouting()}wayPointProperties(t){const e=K.travel.editedRoute.wayPoints.getAt(t);new mr(e).show().then(()=>{Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook")}).catch(t=>{t instanceof Error&&console.error(t)})}};class vr{#en;#xa;constructor(t,e){this.#en=t,this.#xa=e}get latLng(){return this.#en}get geometry(){return this.#xa}}class fr extends bs{#Vd;#en;constructor(t,e){super(t,e),this.#Vd=K.searchData[Number.parseInt(t.currentTarget.dataset.tanElementIndex)],this.#en=[this.#Vd.lat,this.#Vd.lon],Si.dispatch("removeobject",{objId:this.targetObjId})}get menuItems(){return[new Ls(O.getText("OsmSearchContextMenu - Select this point as start point"),g!==K.editedRouteObjId&&a.defaultValue===K.travel.editedRoute.wayPoints.first.lat,()=>gr.setStartPoint(this.#en)),new Ls(O.getText("OsmSearchContextMenu - Select this point as way point"),g!==K.editedRouteObjId,()=>gr.addWayPoint(this.#en)),new Ls(O.getText("OsmSearchContextMenu - Select this point as end point"),g!==K.editedRouteObjId&&a.defaultValue===K.travel.editedRoute.wayPoints.last.lat,()=>gr.setEndPoint(this.#en)),new Ls(O.getText("OsmSearchContextMenu - Create a route note with this result"),!0,()=>ln.newSearchRouteNote(this.#Vd)),new Ls(O.getText("OsmSearchContextMenu - Create a travel note with this result"),!0,()=>ln.newSearchTravelNote(this.#Vd)),new Ls(O.getText(ln.osmSearchNoteDialog?"OsmSearchContextMenu - Hide note dialog":"OsmSearchContextMenu - Show note dialog"),!0,()=>ln.changeOsmSearchNoteDialog()),new Ls(O.getText("OsmSearchContextMenu - Zoom to this result"),!0,()=>(new an).zoomToPoi(new vr(this.#en,this.#Vd.geometry)))]}}class yr{#Xd;#Yd;#Gd;#qd;#$d;#Jd;#Qd;#tc;#ec;#oc;#ic;#sc;#nc;#rc;static get#ac(){return 1e3}static get#lc(){return 40}static get#hc(){return 5}static get#dc(){return 200}static get#cc(){return 100}#uc(t){t!==this.#qd&&yr.#lc<t-this.#qd&&(this.#Qd.scrollTop-=yr.#hc,this.#qd=t),this.#tc>this.#oc&&0<this.#Qd.scrollTop&&window.requestAnimationFrame(t=>{this.#uc(t)})}#mc(t){t!==this.#qd&&yr.#lc<t-this.#qd&&(this.#Qd.scrollTop+=yr.#hc,this.#qd=t);let e=1>Math.abs(this.#Qd.scrollHeight-this.#Qd.clientHeight-this.#Qd.scrollTop);this.#ec<this.#oc&&!e&&window.requestAnimationFrame(t=>{this.#mc(t)})}#oe(t){const e=t.changedTouches.item(0);if(1===t.touches.length){if(yr.#ac<t.timeStamp-this.#Gd||0===this.#Gd)return void(this.#Gd=t.timeStamp);t.preventDefault(),this.#Yd=!0,this.#Jd=t.currentTarget.parentNode,this.#Qd=t.currentTarget.parentNode.parentNode.parentNode,this.#oc=e.screenY;const o=t.currentTarget.getBoundingClientRect();this.#nc=e.screenX-o.left,this.#rc=e.screenY-o.top,this.#$d=t.currentTarget.cloneNode(!0),this.#$d.classList.add("TravelNotes-SortableList-DraggedListItemHTMLElement"),document.body.appendChild(this.#$d),this.#$d.style.left=String(e.screenX-this.#nc)+"px",this.#$d.style.top=String(e.screenY-this.#rc)+"px",this.#tc=this.#Jd.getBoundingClientRect().y-this.#Qd.getBoundingClientRect().y+this.#Qd.scrollTop+yr.#dc,this.#ec=this.#Qd.getBoundingClientRect().bottom-yr.#cc}}#ee(t){if(!this.#Yd)return;const e=t.changedTouches.item(0);if(1===t.touches.length&&this.#$d){this.#$d.style.left=String(e.screenX-this.#nc)+"px",this.#$d.style.top=String(e.screenY-this.#rc)+"px",this.#oc=e.screenY,this.#tc>this.#oc&&0<this.#Qd.scrollTop&&window.requestAnimationFrame(t=>{this.#uc(t)});let t=1>Math.abs(this.#Qd.scrollHeight-this.#Qd.clientHeight-this.#Qd.scrollTop);this.#ec<this.#oc&&!t&&window.requestAnimationFrame(t=>{this.#mc(t)})}}#pc(t){this.#Jd.childNodes.forEach(e=>{let o=e.getBoundingClientRect();o.left<t.clientX&&o.right>t.clientX&&o.top<t.clientY&&o.bottom>t.clientY&&(this.#ic=e,this.#sc=t.clientY-o.top<o.height/2)})}#te(t){if(this.#Yd){let e=t.changedTouches.item(0);if(this.#pc(e),this.#ic)try{this.#Xd(Number.parseInt(t.currentTarget.dataset.tanObjId),Number.parseInt(this.#ic.dataset.tanObjId),this.#sc)}catch{}}this.#gc()}#gc(){this.#$d&&document.body.removeChild(this.#$d),this.#$d=null,this.#Qd=null,this.#Yd=!1,this.#qd=0,this.#Jd=null,this.#tc=0,this.#ec=0,this.#oc=0,this.#ic=null,this.#sc=!0}constructor(t){Object.freeze(this),this.#Xd=t,this.#$d=null,this.#Gd=0,this.#gc()}handleEvent(t){switch(t.type){case"touchstart":this.#oe(t);break;case"touchmove":this.#ee(t);break;case"touchend":this.#te(t);break;case"touchcancel":this.#gc()}}}class _r{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();try{t.dataTransfer.setData("ObjId",t.target.dataset.tanObjId),t.dataTransfer.dropEffect="move"}catch(t){t instanceof Error&&console.error(t)}}}class Tr{#Xd;constructor(t){Object.freeze(this),this.#Xd=t}handleEvent(t){t.preventDefault();const e=t.currentTarget.getBoundingClientRect();try{this.#Xd(Number.parseInt(t.dataTransfer.getData("ObjId")),Number.parseInt(t.currentTarget.dataset.tanObjId),t.clientY-e.top<e.bottom-t.clientY)}catch{}}}class br{#vc;constructor(t){Object.freeze(this),this.#vc=t}handleEvent(t){t.stopPropagation(),t.preventDefault(),new this.#vc(t,t.target.parentNode).show()}}class Lr extends pi{#fc;#yc;#_c;#Tc;#Jd;constructor(t,e,o){super(),this.#fc=new _r,this.#yc=new Tr(t),this.#_c=new br(e),this.#Tc=new yr(t),o&&W.create("div",{className:"TravelNotes-BaseDialog-FlexRow",textContent:o},this.controlHTMLElement),this.#Jd=W.create("div",{className:"TravelNotes-SortableList-ListHTMLElement"},this.controlHTMLElement)}updateContent(t){for(;this.#Jd.firstChild;)this.#Jd.firstChild.removeEventListener("dragstart",this.#fc,!1),this.#Jd.firstChild.removeEventListener("drop",this.#yc,!1),this.#Jd.firstChild.removeEventListener("contextmenu",this.#_c,!1),this.#Jd.firstChild.removeEventListener("touchstart",this.#Tc,!1),this.#Jd.firstChild.removeEventListener("touchmove",this.#Tc,!1),this.#Jd.firstChild.removeEventListener("touchend",this.#Tc,!1),this.#Jd.removeChild(this.#Jd.firstChild);t.forEach(t=>{t.draggable=!0,t.addEventListener("dragstart",this.#fc,!1),t.addEventListener("drop",this.#yc,!1),t.addEventListener("contextmenu",this.#_c,!1),t.addEventListener("touchstart",this.#Tc,!1),t.addEventListener("touchmove",this.#Tc,!1),t.addEventListener("touchend",this.#Tc,!1),this.#Jd.appendChild(t),t.classList.add("TravelNotes-SortableList-ListItemHTMLElement")})}}class Er{#bc;#Vd;#Lc;static get#pr(){return 40}#Ec(){let t="";t=this.#Vd.tags.rcn_ref?"<div class='TravelNotes-MapNote TravelNotes-MapNoteCategory-0073'><svg viewBox='0 0 20 20'><text class='' x=10 y=14>"+this.#Vd.tags.rcn_ref+"</text></svg></div>":Ms.preDefinedIconDataFromName(this.#Vd.description)||"";const e=W.create("div",{className:"TravelNotes-OsmSearchDialog-SearchResult-IconCell"},this.#bc);P.sanitizeToHtmlElement(t,e)}#wc(t){t&&W.create("div",{textContent:t},this.#Lc)}#Fr(){const t=(this.#Vd.tags["addr:street"]?(this.#Vd.tags["addr:housenumber"]?this.#Vd.tags["addr:housenumber"]+" ":"")+this.#Vd.tags["addr:street"]+" ":"")+(this.#Vd.tags["addr:city"]?(this.#Vd.tags["addr:postcode"]?this.#Vd.tags["addr:postcode"]+" ":"")+this.#Vd.tags["addr:city"]:"");""!==t&&this.#wc(t)}#Mc(){this.#Vd.tags.phone&&this.#wc("☎️ : "+this.#Vd.tags.phone,this.#Lc)}#xc(){this.#Vd.tags.email&&W.create("a",{href:"mailto:"+this.#Vd.tags.email,textContent:this.#Vd.tags.email},W.create("div",{textContent:"📧 : "},this.#Lc))}#Ic(){this.#Vd.tags.website&&W.create("a",{href:this.#Vd.tags.website,target:"_blank",textContent:this.#Vd.tags.website.length>Er.#pr?this.#Vd.tags.website.substring(0,Er.#pr)+"...":this.#Vd.tags.website},W.create("div",null,this.#Lc))}#Cc(){this.#Lc=W.create("div",{className:"TravelNotes-OsmSearchDialog-SearchResult-Cell"},this.#bc),this.#wc(this.#Vd.description),this.#wc(this.#Vd.tags.name),this.#wc(this.#Vd.tags.rcn_ref),this.#Fr(),this.#Mc(),this.#xc(),this.#Ic()}#Nc(){for(const[t,e]of Object.entries(this.#Vd.tags))this.#bc.title+=t+"="+e+"\n"}constructor(){Object.freeze(this)}buildHTMLElement(t,e){return this.#Vd=t,this.#bc=W.create("div",{className:"TravelNotes-OsmSearchDialog-SearchResultHTMLElement",dataset:{ObjId:T.nextObjId,ElementIndex:e}}),this.#Ec(),this.#Cc(),this.#Nc(),this.#bc}}class wr{#Pc;#Oc;#Dc(){g===this.#Oc?this.#Oc=T.nextObjId:Si.dispatch("removeobject",{objId:this.#Oc}),Si.dispatch("addrectangle",{objId:this.#Oc,bounds:sr.searchBounds,properties:t.osmSearch.nextSearchLimit})}#Sc(){const e=sr.previousSearchBounds;e&&(g===this.#Pc?this.#Pc=T.nextObjId:Si.dispatch("removeobject",{objId:this.#Pc}),Si.dispatch("addrectangle",{objId:this.#Pc,bounds:[[e.getSouthWest().lat,e.getSouthWest().lng],[e.getNorthEast().lat,e.getNorthEast().lng]],properties:t.osmSearch.previousSearchLimit}))}constructor(){Object.freeze(this),this.#Pc=g,this.#Oc=g}show(){K.map.on("zoom",this.#Dc,this),K.map.on("move",this.#Dc,this),this.#Dc(),this.#Sc()}hide(){K.map.off("zoom",this.#Dc,this),K.map.off("move",this.#Dc,this),g!==this.#Oc&&(Si.dispatch("removeobject",{objId:this.#Oc}),this.#Oc=g),g!==this.#Pc&&(Si.dispatch("removeobject",{objId:this.#Pc}),this.#Pc=g)}}class Mr{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();const e=K.searchData[Number.parseInt(t.target.dataset.tanElementIndex)];Si.dispatch("addsearchpointmarker",{objId:Number.parseInt(t.target.dataset.tanObjId),latLng:[e.lat,e.lon],geometry:e.geometry})}}class xr{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),Si.dispatch("removeobject",{objId:Number.parseInt(t.target.dataset.tanObjId)})}}class Ir extends $n{#jc;#_o;#Ac;#_d;#Nd;#Rc;#Hc;#kc;#Xl(){this.#_o=W.create("div"),this.#_d=new dr,this.#Nd=new cr;const t=new rr(this.#_d,this.#Nd);this.#_o.appendChild(t.toolbarButtonsHTMLElement),this.#_o.appendChild(this.#_d.treeHTMLElement),this.#_o.appendChild(this.#Nd.waitHTMLElement)}constructor(){super(t.osmSearchDialog.dialogX,t.osmSearchDialog.dialogY)}createContentHTML(){this.#Xl(),this.#Ac=new Lr(null,fr),this.#Rc=new Er,this.#jc=new wr,this.#Hc=new Mr,this.#kc=new xr}get contentHTMLElements(){return[].concat(this.#Ac.controlHTMLElement)}get title(){return O.getText("OsmSearchDialog - Searching OpenStreetMap")}get toolbarHTMLElement(){return this.#_o}onCancel(){this.#jc.hide(),super.onCancel()}show(){super.show(),this.#jc.show()}updateContent(){this.#Nd.hideWait(),this.#jc.hide(),this.#jc.show();const t=[];K.searchData.forEach((e,o)=>{const i=this.#Rc.buildHTMLElement(e,o);i.addEventListener("mouseenter",this.#Hc,!1),i.addEventListener("mouseleave",this.#kc,!1),t.push(i)}),this.#Ac.updateContent(t)}}class Cr extends ci{#Bc;constructor(t){super(t)}createContentHTML(){this.#Bc=W.create("div",{textContent:this.options.text||""})}get contentHTMLElements(){return[this.#Bc]}get title(){return this.options.title||""}}class Nr{#ci=null;#zc=0;#Fc(t){const e=new B;for(const o in t)e[o]=t[o];e.iconLatLng=e.latLng,e.distance=ti.getClosestLatLngDistance(this.#ci,e.latLng).distance,e.chainedDistance=this.#ci.chainedDistance,this.#ci.notes.add(e),Si.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:e.objId})}async#Zc(){const t=new rn;t.createUI();const e=new Qs,o=this.#ci.itinerary.maneuvers.iterator;for(;!o.done;){t.showInfo(O.getText("AllManeuverNotesBuilder - Creating note",{noteNumber:o.index+1,notesLength:this.#zc}));const i=this.#ci.itinerary.itineraryPoints.getAt(o.value.itineraryPointObjId).latLng,s=await e.getIconAndAdressAsync(i,this.#ci);s?this.#Fc(s):console.error("An error occurs when creating the svg icon "+o.index)}this.#ci.notes.sort((t,e)=>t.distance-e.distance),Si.dispatch("updateroadbook"),t.close()}constructor(){Object.freeze(this)}addAllManeuverNotes(e){this.#ci=ki.getRoute(e),this.#zc=this.#ci.itinerary.maneuvers.length,t.note.maxManeuversNotes<this.#zc?Oi.showError(O.getText("AllManeuverNotesBuilder - max maneuvers notes reached {maneuversLength}{maxManeuversNotes}",{maneuversLength:this.#zc,maxManeuversNotes:t.note.maxManeuversNotes})):new Cr({title:O.getText("AllManeuverNotesBuilder - Add a note for each maneuver"),text:O.getText("AllManeuverNotesBuilder - Add a note for each maneuver. Are you sure?",{noteLength:this.#zc}),secondButtonText:"❌"}).show().then(()=>this.#Zc()).catch(t=>{t instanceof Error&&console.error(t)})}}class Pr extends bs{#ci=null;constructor(t,e){super(t,e),this.#ci=ki.getRoute(this.targetObjId)}get menuItems(){return[new Ls(O.getText("RouteContextMenu - Edit this route"),this.targetObjId!==K.travel.editedRoute.objId&&l.editedChanged!==K.travel.editedRoute.editionStatus,()=>Nn.editRoute(this.targetObjId)),new Ls(O.getText("RouteContextMenu - Delete this route"),this.targetObjId!==K.travel.editedRoute.objId||l.editedChanged!==K.travel.editedRoute.editionStatus,()=>Nn.removeRoute(this.targetObjId)),new Ls(O.getText(this.#ci.hidden?"RouteContextMenu - Show this route":"RouteContextMenu - Hide this route"),this.#ci.hidden||K.travel.editedRoute.objId!==this.targetObjId,()=>{this.#ci.hidden?Nn.showRoute(this.targetObjId):Nn.hideRoute(this.targetObjId)}),new Ls(O.getText("RouteContextMenu - Properties"),!this.#ci.hidden,()=>Nn.routeProperties(this.targetObjId)),new Ls(O.getText("RouteContextMenu - Zoom to route"),!this.#ci.hidden,()=>(new an).zoomToRoute(this.targetObjId)),new Ls(O.getText("RouteContextMenu - View the elevation"),this.#ci.itinerary.hasProfile,()=>vn.showProfile(this.targetObjId)),new Ls(O.getText("RouteContextMenu - Print route map"),t.printRouteMap.isEnabled,()=>Nn.printRouteMap(this.targetObjId)),new Ls(O.getText("RouteContextMenu - Save this route in a GPX file"),0<this.#ci.itinerary.itineraryPoints.length,()=>Nn.saveGpx(this.targetObjId)),new Ls(O.getText("RouteContextMenu - Invert waypoints"),K.travel.editedRoute.objId===this.targetObjId,()=>gr.reverseWayPoints()),new Ls(O.getText("RouteContextMenu - Add a note on the route"),!this.haveParentNode,()=>ln.newRouteNote(this.targetObjId,this.latLng)),new Ls(O.getText("RouteContextMenu - Create a note for each route maneuver"),!this.#ci.hidden,()=>(new Nr).addAllManeuverNotes(this.targetObjId)),new Ls(O.getText("RouteContextMenu - Save modifications on this route"),K.travel.editedRoute.objId===this.targetObjId,()=>Nn.saveEdition()),new Ls(O.getText("RouteContextMenu - Cancel modifications on this route"),K.travel.editedRoute.objId===this.targetObjId,()=>Nn.cancelEdition())]}}class Or{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),K.travel.name=P.sanitizeToJsString(t.target.value),document.title="Travel & Notes"+(""===K.travel.name?"":" - "+K.travel.name),Si.dispatch("updateroadbook")}}class Dr extends $n{#Kc=null;#Uc=null;constructor(){super(t.travelPropertiesDialog.dialogX,t.travelPropertiesDialog.dialogY)}createContentHTML(){this.#Kc=new $i(O.getText("TravelPropertiesDialog - Name"),{controlChange:new Or}),this.#Kc.value=K.travel.name,this.#Uc=new Lr(Gn.routeDropped,Pr,O.getText("TravelPropertiesDialog - Routes"))}get contentHTMLElements(){return[this.#Kc.controlHTMLElement,this.#Uc.controlHTMLElement]}get title(){return O.getText("TravelPropertiesDialog - Travel properties")}#Ei(t,e){const o=(t.editionStatus===l.notEdited?"":"🔴 ")+(t.chain?"⛓ ":"")+(t.objId===K.editedRouteObjId?K.travel.editedRoute.computedName:t.computedName);e.push(W.create("div",{textContent:o,dataset:{ObjId:String(t.objId)}}))}updateContent(){if(!this.#Uc)return;const t=[];K.travel.routes.forEach(e=>{e.objId===K.editedRouteObjId?this.#Ei(K.travel.editedRoute,t):this.#Ei(e,t)}),this.#Uc.updateContent(t),this.#Kc.value=K.travel.name}}class Sr extends bs{#ci;constructor(t,e){super(t,e),this.#ci=ki.getNoteAndRoute(this.targetObjId).route}get menuItems(){return[new Ls(O.getText("NoteContextMenu - Edit this note"),!0,()=>ln.editNote(this.targetObjId)),new Ls(O.getText("NoteContextMenu - Delete this note"),!0,()=>ln.removeNote(this.targetObjId)),new Ls(O.getText("NoteContextMenu - Zoom to note"),!0,()=>(new an).zoomToNote(this.targetObjId)),new Ls(O.getText(this.#ci?"NoteContextMenu - Detach note from route":"NoteContextMenu - Attach note to route"),g===K.editedRouteObjId,()=>{this.#ci?ln.detachNoteFromRoute(this.targetObjId):ln.attachNoteToRoute(this.targetObjId)})]}}class jr extends $n{#Wc;constructor(){super(t.travelNotesDialog.dialogX,t.travelNotesDialog.dialogY)}createContentHTML(){this.#Wc=new Lr(ln.travelNoteDropped,Sr)}get contentHTMLElements(){return[this.#Wc.controlHTMLElement]}get title(){return O.getText("TravelNotesDialog - Travel notes dialog")}updateContent(){if(!this.#Wc)return;let t=Bs.getTravelNotesHTML("TravelNotes-TravelNotesDialog-");this.#Wc.updateContent(Array.from(t.childNodes))}}const Ar=new class{#Vc=null;#Xc=null;#Yc=null;constructor(){Object.freeze(this)}get osmSearchDialog(){return this.#Vc||(this.#Vc=new Ir(t.osmSearchDialog.dialogX,t.osmSearchDialog.dialogY)),this.#Vc}get travelPropertiesDialog(){return this.#Xc||(this.#Xc=new Dr(t.travelPropertiesDialog.dialogX,t.travelPropertiesDialog.dialogY)),this.#Xc}get travelNotesDialog(){return this.#Yc||(this.#Yc=new jr(t.travelNotesDialog.dialogX,t.travelNotesDialog.dialogY)),this.#Yc}showTravelProperties(){this.travelPropertiesDialog.show(),this.travelPropertiesDialog.mover.centerDialog()}};const Rr=new class{#Vo;#Yo=null;hide(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),this.#Vo.removeEventListener("click",this.toggle,!1),document.body.removeChild(this.#Vo)}constructor(){Object.freeze(this)}async toggle(){document.fullscreenElement?await document.exitFullscreen():await document.body.requestFullscreen()}show(){const e=t.FullScreenUI.timeOut;0===e||!document.fullscreenEnabled||document.body.clientWidth>t.FullScreenUI.screenMaxWidth||(this.#Vo=W.create("div",{id:"TravelNotes-FullScreenUI",textContent:O.getText("FullScreenUI - start full screen")},document.body),this.#Vo.addEventListener("click",this.toggle,!1),this.#Yo=setTimeout(()=>this.hide(),e))}};const Hr=new class{#Gc;constructor(){Object.freeze(this),this.#Gc=null}increment(){this.#Gc||(this.#Gc=t.fontSize.initialValue),this.#Gc+=t.fontSize.incrementValue,document.body.style["font-size"]=String(this.#Gc)+"mm"}decrement(){this.#Gc||(this.#Gc=t.fontSize.initialValue),this.#Gc-=t.fontSize.incrementValue,document.body.style["font-size"]=String(this.#Gc)+"mm"}};class kr{#qc;#jt;#ci;#$c;#Jc(t){let e=new R;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("ele"===o[t].nodeName)e.elev=Number.parseFloat(o[t].textContent),0!==e.elev&&(this.#ci.itinerary.hasProfile=!0);this.#ci.itinerary.itineraryPoints.add(e)}#Qc(t){const e=t.childNodes;for(let t=0;t<e.length;t++)if("trkpt"===e[t].nodeName)this.#Jc(e[t])}#tu(){let t=0,e=0,o=this.#ci.itinerary.itineraryPoints.iterator;for(o.done;!o.done;){let i=o.value.elev-o.previous.elev;0>i?e-=i:t+=i}this.#ci.itinerary.ascent=t,this.#ci.itinerary.descent=e}#eu(t){this.#ci=new z;const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#ci.name=e[t].textContent;break;case"trkseg":this.#Qc(e[t])}this.#ci.itinerary.hasProfile&&this.#tu(),this.#jt.routes.add(this.#ci)}#ou(t){let e=Number.MAX_VALUE,o=g;return this.#ci.itinerary.itineraryPoints.forEach(i=>{const s=Ai.pointsDistance(t,i.latLng);s<e&&(e=s,o=i.objId)}),o}#iu(t){const e=new H;e.iconName="kUndefined";const o=Number.parseFloat(t.getAttributeNS(null,"lat")),i=Number.parseFloat(t.getAttributeNS(null,"lon"));e.itineraryPointObjId=this.#ou([o,i]);const s=t.childNodes;for(let t=0;t<s.length;t++)if("desc"===s[t].nodeName)e.instruction=s[t].textContent;this.#ci.itinerary.maneuvers.add(e)}#su(t){const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#ci.name=e[t].textContent;break;case"rtept":this.#iu(e[t])}}#nu(t){const e=new B;e.latLng=t.latLng,e.iconLatLng=t.latLng;const o=t.name.split("+");e.iconContent='<div class="TravelNotes-MapNote TravelNotes-MapNoteCategory-0073"><svg viewBox="0 0 20 20"><text x="10" y="14">'+o[0]+"</text></svg></div>",e.tooltipContent=O.getText("GpxParser - Network node")+o[0],o[1]&&(e.tooltipContent+=O.getText("GpxParser - Go to network node")+o[1]),e.distance=ti.getClosestLatLngDistance(this.#ci,e.latLng).distance,this.#ci.notes.add(e)}#ru(t){let e=new A;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("name"===o[t].nodeName)e.name=o[t].textContent;this.#ci.wayPoints.add(e),this.#$c&&this.#nu(e)}#au(t){for(let e=0;e<t.length;e++)this.#ru(t[e])}#lu(){this.#jt.routes.forEach(t=>{t.wayPoints.remove(t.wayPoints.first.objId),t.wayPoints.remove(t.wayPoints.last.objId);const e=new A;e.latLng=t.itinerary.itineraryPoints.first.latLng,t.wayPoints.add(e);const o=new A;o.latLng=t.itinerary.itineraryPoints.last.latLng,t.wayPoints.add(o)})}#zd(t){const e=t.itinerary.itineraryPoints.iterator,i=t.itinerary.maneuvers.iterator;e.done;let s=i.done;for(s||(i.value.distance=o.defaultValue,s=i.done),t.distance=o.defaultValue,t.duration=o.defaultValue;!e.done;)e.previous.distance=Ai.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,s||(i.previous.distance+=e.previous.distance,i.value.itineraryPointObjId===e.value.objId&&(t.duration+=i.previous.duration,i.value.distance=o.defaultValue,i.next&&i.value.itineraryPointObjId===i.next.itineraryPointObjId&&(s=i.done,i.value.distance=o.defaultValue),s=i.done))}constructor(){Object.freeze(this)}parse(t){this.#qc=(new DOMParser).parseFromString(t,"text/xml"),this.#$c=Boolean(this.#qc.querySelector("gpx").getAttributeNS(null,"creator").match(/fietsnet|knooppuntnet/g)),this.#jt=new F,this.#jt.routes.remove(this.#jt.routes.first.objId);const e=this.#qc.querySelectorAll("trk");for(let t=0;t<e.length;t++)this.#eu(e[t]);const o=this.#qc.querySelectorAll("rte");1===o.length&&1===this.#jt.routes.length&&this.#su(o[0]),this.#jt.routes.forEach(t=>this.#zd(t));const i=this.#qc.querySelectorAll("wpt");return 0<i.length&&1===this.#jt.routes.length?(this.#ci.wayPoints.remove(this.#ci.wayPoints.first.objId),this.#ci.wayPoints.remove(this.#ci.wayPoints.last.objId),this.#au(i)):this.#lu(),this.#jt}}class Br{#hu(){Si.dispatch("removeallobjects"),document.title="Travel & Notes"+(""===K.travel.name?"":" - "+K.travel.name);const t=K.travel.routes.iterator;for(;!t.done;)l.notEdited===t.value.editionStatus&&Si.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t.value.objId});g!==K.editedRouteObjId&&Si.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:K.travel.editedRoute.objId});const e=K.travel.notes.iterator;for(;!e.done;)Si.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:e.value.objId});if(Si.dispatch("updatetravelnotes"),(new an).zoomToTravel(),jn.setMapLayer(K.travel.layerName),g!==K.editedRouteObjId){const t=K.travel.editedRoute.itinerary.provider;if(""===t||K.providers.get(t.toLowerCase())){Si.dispatch("setprovider",{provider:t});const e=K.travel.editedRoute.itinerary.transitMode;""!==e&&Si.dispatch("settransitmode",{transitMode:e})}else Oi.showError(O.getText("FileLoader - Not possible to select as provider",{provider:t}))}Nn.chainRoutes(),Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook")}constructor(){Object.freeze(this)}openLocalGpxFile(t){vn.deleteAllProfiles(),K.travel.jsonObject=(new kr).parse(t).jsonObject,K.editedRouteObjId=g,this.#hu(),Un.saveStatus=h.saved}openLocalTrvFile(t){vn.deleteAllProfiles();const e=JSON.parse(t);(new On).decompress(e),K.travel.jsonObject=e,K.editedRouteObjId=g,K.travel.routes.forEach(t=>{l.notEdited!==t.editionStatus&&(K.editedRouteObjId=t.objId)}),this.#hu(),Un.saveStatus=h.saved}#du(t){const e=t.routes.iterator;for(;!e.done;)K.travel.routes.add(e.value);const o=t.notes.iterator;for(;!o.done;)K.travel.notes.add(o.value);this.#hu(),Un.saveStatus=h.modified}mergeLocalGpxFile(t){this.#du((new kr).parse(t))}mergeLocalTrvFile(t){const e=JSON.parse(t);(new On).decompress(e);const o=new F;o.jsonObject=e,this.#du(o)}}class zr{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation();const o=e.target.files[0].name,i=o.split(".").pop().toLowerCase(),s=new FileReader;s.onload=()=>{try{f!==t.files.openTaN.indexOf(i)?(new Br).openLocalTrvFile(s.result):f!==t.files.openGpx.indexOf(i)&&(new Br).openLocalGpxFile(s.result)}catch(t){t instanceof Error&&(console.error(t),Oi.showError("An error occurs when reading the file "+o))}},s.readAsText(e.target.files[0])}}class Fr{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation();const o=e.target.files[0].name,i=o.split(".").pop().toLowerCase(),s=new FileReader;s.onload=()=>{try{f!==t.files.openTaN.indexOf(i)?(new Br).mergeLocalTrvFile(s.result):f!==t.files.openGpx.indexOf(i)&&(new Br).mergeLocalGpxFile(s.result)}catch(t){t instanceof Error&&(console.error(t),Oi.showError("An error occurs when reading the file "+o))}},s.readAsText(e.target.files[0])}}const Zr=new class extends zn{constructor(){super()}createUI(){super.createUI("Travel & Notes",d.topRight)}addToolbarItems(){const e=li.isTouch?t.files.writeTouch:t.files.writeOthers,o=Object.seal({openTaN:"",openGpx:""});t.files.openTaN.forEach(t=>o.openTaN+="."+t+","),t.files.openGpx.forEach(t=>o.openGpx+="."+t+",");const i=(o.openTaN+o.openGpx).slice(0,-1);o.openTaN=o.openTaN.slice(0,-1),o.openGpx=o.openGpx.slice(0,-1),o.openTaN.replaceAll(",",", "),o.openGpx.replaceAll(",",", "),this.addToolbarItem(Vn.status===s.active?new Fn("🏀",O.getText("TravelNotesToolbar - Stop Geo location"),()=>{Vn.switch()}):new Fn("🌐",O.getText("TravelNotesToolbar - Start Geo location"),()=>{Vn.switch()})),this.addToolbarItem(new Fn("❌",O.getText("TravelNotesToolbar - Cancel travel"),()=>{Gn.newTravel(),document.title="Travel & Notes"+(""===K.travel.name?"":" - "+K.travel.name)})),this.addToolbarItem(new Fn("💾",O.getText("TravelNotesToolbar - Save travel",{extension:e}),()=>{Gn.saveTravel()})),this.addToolbarItem(new Fn("📂",O.getText("TravelNotesToolbar - Open travel",o),()=>{t.travelNotes.haveBeforeUnloadWarning&&!window.confirm(O.getText("TravelNotesToolbar - This page ask to close; data are perhaps not saved."))||D.openFile(new zr,i)})),this.addToolbarItem(new Fn("🌏",O.getText("TravelNotesToolbar - Import travel",o),()=>{g===K.editedRouteObjId?D.openFile(new Fr,i):Oi.showError(O.getText("TravelNotesToolbar - Not possible to merge a travel when a route is edited"))})),this.addToolbarItem(new Fn("📙",O.getText("TravelNotesToolbar - Open travel roadbook"),"TravelNotesRoadbook.html?lng="+t.travelNotes.language+"&page="+K.UUID)),t.ApiKeysDialog.showButton&&this.addToolbarItem(new Fn("🔑",O.getText("TravelNotesToolbar - api keys"),()=>{ji.setKeysFromDialog()})),this.addToolbarItem(new Fn("🛄",O.getText("TravelNotesToolbar - Travel properties"),()=>{Ar.travelPropertiesDialog.show()})),this.addToolbarItem(new Fn("🗨️",O.getText("TravelNotesToolbar - Travel notes"),()=>{Ar.travelNotesDialog.show()})),this.addToolbarItem(new Fn("🔍",O.getText("Search with OpenStreetMap"),()=>{Ar.osmSearchDialog.show()})),this.addToolbarItem(new Fn("☢️",O.getText("TravelNotesToolbar - Save as travel",{extension:e}),()=>{Gn.saveAsTravel()})),this.addToolbarItem(new Fn("🛠️",O.getText("TravelNotesToolbar - About Travel & Notes"),()=>(new Wn).show())),document.fullscreenEnabled&&this.addToolbarItem(document.fullscreenElement?new Fn("🔻",O.getText("TravelNotesToolbar - disable fullscreen"),()=>Rr.toggle()):new Fn("🔺",O.getText("TravelNotesToolbar - enable fullscreen"),()=>Rr.toggle())),this.addToolbarItem(new Fn("+",O.getText("TravelNotesToolbar - Increment the font size"),()=>{Hr.increment()})),this.addToolbarItem(new Fn("-",O.getText("TravelNotesToolbar - Decrement the font size"),()=>{Hr.decrement()})),this.addToolbarItem(new Fn("🏠","Home",window.location.origin)),this.addToolbarItem(new Fn("?","Help","https://wwwouaiebe.github.io/TravelNotes/userGuides/README.html#")),this.addToolbarItem(new Fn("@","Contact",t.travelNotesToolbar.contactMail.url||window.location.origin))}};class Kr{#cu;#st;#uu;static get#mu(){return Object.freeze({bike:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <path fill="rgb(0,0,191)" d="m 11.25,3.125 v 1.09375 l 1.5625,0.9765625 V 6.5625 H 7.4999999 V 5.625 h 0.625 c 1.25,0 1.25,-1.25 0,-1.25 h -2.5 c -1.25,0 -1.25,1.25 0,1.25 h 0.625 V 6.5625 L 5.0781249,8.75 c -0.026125,-5.821e-4 -0.0519,0 -0.078125,0 -2.0153538,0 -3.75,1.734646 -3.75,3.75 0,2.015354 1.7346462,3.75 3.75,3.75 2.0153537,0 3.75,-1.734646 3.75,-3.75 0,-0.432461 -0.089462,-0.858226 -0.234375,-1.25 h 0.546875 c 0.9375,0 1.1534331,-0.567495 1.4843751,-0.898437 L 12.773438,7.8125 13.4375,9.1015625 C 12.159328,9.7073948 11.25,11.031094 11.25,12.5 c 0,2.015354 1.734646,3.75 3.75,3.75 2.015354,0 3.75,-1.734646 3.75,-3.75 0,-2.015354 -1.734646,-3.75 -3.75,-3.75 -0.03934,0 -0.07808,-0.00131 -0.117187,0 L 13.75,6.5625 V 4.5703125 Z M 7.2265624,7.8125 H 11.132813 L 9.1796874,10 h -1.40625 c -0.0231,0 -0.054487,0.0026 -0.078125,0 C 7.3660586,9.6463159 6.9994024,9.3504739 6.5624999,9.140625 6.5471874,9.1173375 6.5373874,9.0856825 6.5234374,9.0625 Z M 4.9999999,10 c 1.2571387,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.2428613,2.5 -2.5,2.5 -1.2571388,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.2428612,-2.5 2.5,-2.5 z M 15,10 c 1.257137,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.242863,2.5 -2.5,2.5 -1.257139,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.242861,-2.5 2.5,-2.5 z" /> </svg>',pedestrian:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20"  xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)" transform="matrix(0.15866777,0,0,0.12627988,148.47251,-116.69398)"> <path d="m -875.5,962.4 c 2,-1.5 4.6,-2.3 7.4,-2.2 3.6,0.3 6.7,2.5 8.4,5.2 l 10.7,21.2 14.5,10.1 c 1.2,1 2,2.5 1.9,4.2 -0.1,2.6 -2.5,4.6 -5.2,4.3 -0.7,0 -1.5,-0.3 -2.2,-0.7 l -15.6,-10.7 c -0.4,-0.4 -0.9,-0.9 -1.2,-1.5 l -4.1,-7.9 -4.8,21.1 18.9,22.3 c 0.4,0.7 0.7,1.5 0.9,2.2 l 5.1,26.9 c 0,0.6 0,1 0,1.5 -0.3,4.1 -3.8,6.8 -7.7,6.7 -3.2,-0.3 -5.7,-2.6 -6.5,-5.7 l -4.8,-25.1 -15.3,-17 -3.6,16.3 c -0.1,0.7 -1.2,2.3 -1.5,2.9 l -14.6,24.9 c -1.5,2.2 -3.9,3.8 -6.7,3.4 -4.1,-0.3 -7,-3.8 -6.7,-7.7 0.1,-1.2 0.6,-2.2 1,-3.1 l 13.7,-22.8 11.4,-50.4 -7.4,6 -4.1,18 c -0.4,2.2 -2.6,4.2 -5.1,4.1 -2.6,-0.1 -4.6,-2.5 -4.5,-5.2 0,-0.1 0,-0.4 0.1,-0.6 l 4.6,-20.9 c 0.3,-0.9 0.7,-1.6 1.5,-2.2 z" /> <path d="m -884.5,943.5 c 1.3,8.6 8.7,15.3 17.8,15.3 5.7,0 10.2,-4.6 10.2,-10.2 0,-5.6 -4.6,-10.2 -10.2,-10.2 -3.9,0 -7.2,2 -8.9,5.2 -0.2,0.4 -0.5,0.7 -0.8,1 -2,2 -5.3,2 -7.3,0 -0.4,-0.4 -0.6,-0.7 -0.8,-1.1 z" /> </g> </svg>',car:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" > <g fill="rgb(0,0,191)"> <path d="m 2,13 a 1.7142857,1.7142857 0 0 0 1.7142857,1.714286 H 16.285714 A 1.7142857,1.7142857 0 0 0 18,13 V 9.5714286 A 1.7142857,1.7142857 0 0 0 16.285714,7.8571429 H 3.7142857 A 1.7142857,1.7142857 0 0 0 2,9.5714286 Z m 1.8285714,-2.285714 a 1.0285714,1.0285714 0 1 1 0,0.01143 z m 10.2857146,0 a 1.0285714,1.0285714 0 1 1 0,0.01143 z" /> <path d="M 4.2857143,7.8571429 V 5 A 1.7142857,1.7142857 0 0 1 6,3.2857143 h 8 A 1.7142857,1.7142857 0 0 1 15.714286,5 V 7.8571429 H 14 V 6.1428571 A 1.1428571,1.1428571 0 0 0 12.857143,5 H 7.1428571 A 1.1428571,1.1428571 0 0 0 6,6.1428571 v 1.7142858 z" /> <g transform="matrix(1.1428571,0,0,1.1428571,2,2.1428571)"> <rect x="1" y="10" width="2" height="3" /> <rect x="11" y="10" width="2" height="3" /> </g> </g> </svg>',train:'data:image/svg+xml;utf8,<svg viewBox="-3 -3 20 20" xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)"> <path d="M 5,0 C 3.025911,-0.0084 1,3 1,7 l 0,2 c 0,1 1,2 2,2 l 8,0 c 1,0 2,-1 2,-2 L 13,7 C 13,3 11,0 9,0 z m -1,3 6,0 c 0,0 1,1 1,3 L 3.03125,6 C 2.994661,3.9916 4,3 4,3 z M 3,8 6,8 6,9 3,9 z m 5,0 3,0 0,1 -3,0 z m -6,4 -1,2 3,0 1,-2 z m 7,0 1,2 3,0 -1,-2 z"/></g></svg>',line:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <line x1="5" y1="17" x2= "11" y2="2" stroke="rgb(0,0,0)" /> <line x1="3" y1="6" x2="17" y2="9" stroke="rgb(191,0,0)" /> <line x1="3" y1= "16" x2="17" y2="5" stroke="rgb(255,204,0)" /> </svg>',circle:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <g fill="transparent"> <circle cx="8" cy="6" r="5" stroke="rgb(0,0,0)" /> <circle cx="12" cy="12" r="4" stroke="rgb(255,204,0)" /> <circle cx="14" cy="8" r="3" stroke="rgb(191,0,0)" /> </g> </svg>'})}constructor(t,e){Object.freeze(this),this.#cu=t,this.#st=e,this.#uu=W.create("img",{src:Kr.#mu[e],id:"TravelNotes-ProvidersToolbar-"+e+"ImgButton",className:"TravelNotes-ProvidersToolbar-ImgButton",title:O.getText("ProvidersToolbar - TransitMode "+e)}),this.#uu.addEventListener("click",this),this.visible=!1}handleEvent(t){t.stopPropagation(),this.#cu.transitMode=this.#st,this.#cu.hide(),pr.startRouting()}get buttonHTMLElement(){return this.#uu}get transitMode(){return this.#st}set active(t){t?this.#uu.classList.add("TravelNotes-ProvidersToolbar-ActiveTransitModeImgButton"):this.#uu.classList.remove("TravelNotes-ProvidersToolbar-ActiveTransitModeImgButton")}set visible(t){t?this.#uu.classList.remove("TravelNotes-Hidden"):this.#uu.classList.add("TravelNotes-Hidden")}}class Ur{#cu;#it;#uu;constructor(t,e){Object.freeze(this),this.#cu=t,this.#it=e,this.#uu=W.create("img",{src:e.icon,id:"TravelNotes-ProvidersToolbar-"+e.name+"ImgButton",className:"TravelNotes-ProvidersToolbar-ImgButton",title:e.title||e.name}),this.#uu.addEventListener("click",this)}handleEvent(t){t.stopPropagation(),this.#cu.provider=this.#it.name,pr.startRouting()}get buttonHTMLElement(){return this.#uu}get provider(){return this.#it}set active(t){t?this.#uu.classList.add("TravelNotes-ProvidersToolbar-ActiveProviderImgButton"):this.#uu.classList.remove("TravelNotes-ProvidersToolbar-ActiveProviderImgButton")}}class Wr{#_o;#pu;#mh;#gu;#vu;#fu;#yu;#yh;#Qh;static get#_u(){return 100}#Tu(){["bike","pedestrian","car","train","line","circle"].forEach(t=>{const e=new Kr(this,t);this.#gu.set(t,e),this.#mh.appendChild(e.buttonHTMLElement)})}#bu(){K.providers.forEach(t=>{if(!t.providerKeyNeeded||ji.hasKey(t.name)){const e=new Ur(this,t);this.#vu.set(t.name,e),this.#mh.appendChild(e.buttonHTMLElement)}})}#Qe(){this.#yh=!0,setTimeout(()=>this.#Lu(),Wr.#_u)}#Lu(){this.#_o.style.top=0,this.#mh.classList.remove("TravelNotes-Hidden"),this.centerToolbar()}#Eu(){li.isTouch&&(this.#yh?this.hide():this.#Qe())}#wu(){li.isTouch||(this.#Qh&&(clearTimeout(this.#Qh),this.#Qh=null),this.#Qe())}#Mu(){li.isTouch||(this.#Qh=setTimeout(()=>this.hide(),t.toolbars.timeOut))}hide(){this.#Qh&&(clearTimeout(this.#Qh),this.#Qh=null),this.#mh.classList.add("TravelNotes-Hidden"),this.centerToolbar(),this.#yh=!1}constructor(){Object.freeze(this),this.#gu=new Map,this.#vu=new Map}centerToolbar(){this.#pu.textContent=O.getText("ProvidersToolbar - Computed by {provider} for {transitMode}",{provider:K.routing.provider,transitMode:O.getText("ProvidersToolbar - TransitMode "+K.routing.transitMode)}),this.#_o.style.left=String((window.visualViewport.width-this.#_o.clientWidth)/2)+"px",this.#_o.style.top=String(window.visualViewport.height-this.#_o.clientHeight-2)+"px"}createUI(){this.#_o=W.create("div",{id:"TravelNotes-ProvidersToolbar-Container"},document.body),this.#_o.addEventListener("mouseenter",t=>this.#wu(t),!1),this.#_o.addEventListener("mouseleave",t=>this.#Mu(t),!1),this.#pu=W.create("div",{className:"TravelNotes-ProvidersToolbar-TopBar",textContent:O.getText("TravelNotes-ProvidersToolbar - Providers")},this.#_o),this.#pu.addEventListener("click",t=>this.#Eu(t),!1),this.#mh=W.create("div",{className:"TravelNotes-ProvidersToolbar-ImgButtonsDiv TravelNotes-Hidden"},this.#_o),this.#Tu(),this.#bu(),this.provider=this.#vu.keys().next().value,this.centerToolbar()}set provider(t){K.routing.provider=t,this.#yu&&(this.#yu.active=!1),this.#yu=this.#vu.get(t),this.#yu.active=!0;const e=K.providers.get(t.toLowerCase());this.#gu.forEach(t=>{t.visible=f!==e.transitModes.indexOf(t.transitMode)}),this.#fu&&f!==e.transitModes.indexOf(this.#fu.transitMode)||(this.#fu=null,this.#gu.forEach(t=>{this.#fu||f===e.transitModes.indexOf(t.transitMode)?t.active=!1:(this.#fu=t,t.active=!0,K.routing.transitMode=t.transitMode)})),this.centerToolbar()}set transitMode(t){K.routing.transitMode=t,this.#fu&&(this.#fu.active=!1),this.#fu=this.#gu.get(t),this.#fu.active=!0,this.centerToolbar()}providersAdded(){for(;this.#mh.firstChild;)this.#mh.removeChild(this.#mh.firstChild);this.#gu.clear(),this.#vu.clear(),this.#Tu(),this.#bu(),this.provider=this.#vu.keys().next().value;const t=this.#vu.keys().next().value;this.provider=t,this.transitMode=K.providers.get(t.toLowerCase()).transitModes[0],this.centerToolbar()}}const Vr=new Wr;class Xr extends bs{constructor(t,e){super(t,e)}get menuItems(){return[new Ls(O.getText("MapContextMenu - Select this point as start point"),g!==K.editedRouteObjId&&a.defaultValue===K.travel.editedRoute.wayPoints.first.lat,()=>gr.setStartPoint(this.latLng)),new Ls(O.getText("MapContextMenu - Select this point as way point"),g!==K.editedRouteObjId,()=>gr.addWayPoint(this.latLng)),new Ls(O.getText("MapContextMenu - Select this point as end point"),g!==K.editedRouteObjId&&a.defaultValue===K.travel.editedRoute.wayPoints.last.lat,()=>gr.setEndPoint(this.latLng)),new Ls(O.getText("MapContextMenu - Select this point as start and end point"),g!==K.editedRouteObjId&&a.defaultValue===K.travel.editedRoute.wayPoints.first.lat&&a.defaultValue===K.travel.editedRoute.wayPoints.last.lat,()=>gr.setStartAndEndPoint(this.latLng)),new Ls(O.getText("MapContextMenu - Add a route"),!0,()=>Nn.addRoute()),new Ls(O.getText("MapContextMenu - Hide all routes"),!0,()=>Nn.hideRoutes()),new Ls(O.getText("MapContextMenu - Show all routes"),!0,()=>Nn.showRoutes()),new Ls(O.getText("MapContextMenu - New travel note"),!0,()=>ln.newTravelNote(this.latLng)),new Ls(O.getText("MapContextMenu - Hide all notes"),!0,()=>ln.hideNotes()),new Ls(O.getText("MapContextMenu - Show all notes"),!0,()=>ln.showNotes()),new Ls(O.getText("MapContextMenu - Zoom to travel"),!0,()=>(new an).zoomToTravel()),new Ls("What the fuck?",!0,()=>{const t=document.createElement("a");t.href="https://www.openstreetmap.org/query?lat="+this.latLng[0].toFixed(a.fixed)+"&lon="+this.latLng[1].toFixed(a.fixed)+"#map="+K.map.getZoom()+"/"+this.latLng[0].toFixed(a.fixed)+"/"+this.latLng[1].toFixed(a.fixed),t.target="_blank",t.click()})]}}class Yr{static handleEvent(){In.marker.off("pointerout",Cn.handleEvent)}}class Gr{static handleEvent(t){t.latlng.lat=In.initialLatLng[0],t.latlng.lng=In.initialLatLng[1],t.target.objId=K.travel.editedRoute.objId,new Pr(t).show()}}class qr{static handleEvent(t){K.mapObjects.get(K.travel.editedRoute.objId).openPopup(t.latlng)}}class $r{static handleEvent(t){gr.addWayPointOnRoute(In.initialLatLng,[t.target.getLatLng().lat,t.target.getLatLng().lng]),In.marker&&(In.marker.off("dragstart",Yr.handleEvent),In.marker.off("dragend",$r.handleEvent),In.marker.off("contextmenu",Gr.handleEvent),K.map.removeLayer(In.marker),In.marker=null)}}class Jr{static#xu=1;static handleEvent(e){const o=ki.getRoute(e.target.objId);if(In.initialLatLng=[e.latlng.lat,e.latlng.lng],In.marker)In.marker.setLatLng(e.latlng);else{In.marker=new so(e.latlng,{icon:new Io({iconSize:[_,_],iconAnchor:[10,_],html:'<div class="TravelNotes-Map-WayPoint TravelNotes-Map-WayPointTmp"></div><div class="TravelNotes-Map-WayPointText">?</div>',className:"TravelNotes-Map-WayPointStyle"}),draggable:!0});let i="";(f===t.route.showDragTooltip||Jr.#xu<=t.route.showDragTooltip)&&(Jr.#xu++,i=O.getText("EditedRouteMouseOverEL - Drag and drop to add a waypoint")+" - "),i+=o.computedName+" - ";let s=ti.getClosestLatLngDistance(o,[e.latlng.lat,e.latlng.lng]).distance;s+=o.chainedDistance,i+=D.formatDistance(s),In.marker.bindTooltip(i),In.marker.getTooltip().options.offset=[0,0],In.marker.addTo(K.map),In.marker.on("pointerout",Cn.handleEvent),In.marker.on("dragstart",Yr.handleEvent),In.marker.on("dragend",$r.handleEvent),In.marker.on("contextmenu",Gr.handleEvent),In.marker.on("click",qr.handleEvent)}}}class Qr{static createFakeEvent(e){const o=ki.getNearestRouteData([e.latlng.lat,e.latlng.lng]);if(!o.route)return;const i=new ut(o.latLngOnRoute[0],o.latLngOnRoute[1]),s=K.map.latLngToContainerPoint(i);return s.distanceTo(e.containerPoint)>(li.isTouch?t.mapContextMenu.touchMaxRouteDistance:t.mapContextMenu.mouseMaxRouteDistance)?void 0:Object.freeze({clientX:s.x,clientY:s.y,latlng:i,target:o.route})}static handleClickEvent(t){const e=Qr.createFakeEvent(t);e&&li.isTouch&&e.target.editionStatus!==l.notEdited&&Jr.handleEvent(e)}static handleContextMenuEvent(t){const e=Qr.createFakeEvent(t);e?new Pr(e).show():new Xr(t).show()}}const ta=new class{#Iu=!1;constructor(){Object.freeze(this)}async addReadOnlyTravel(t){if(this.#Iu)return;this.#Iu=!0,Sn.createUI(),jn.setMapLayer("OSM - Color");const e=await fetch(t);p===e.status&&e.ok?(new Dn).openDistantFile(await e.json()):(K.map.setView([a.defaultValue,a.defaultValue],2),document.title="Travel & Notes")}addToolbarsMenusUIs(e,o){this.#Iu||(this.#Iu=!0,document.title="Travel & Notes",K.map.on("contextmenu",Qr.handleContextMenuEvent),K.map.on("click",Qr.handleClickEvent),K.map.setView([t.map.center.lat,t.map.center.lng],t.map.zoom),Sn.createUI(),Un.createUI(),Un.saveStatus=h.saved,Oi.showHelp("<p>"+O.getText("Help - Continue with interface1")+"</p><p>"+O.getText("Help - Continue with interface2")+"</p>"),Zn.createUI(),jn.setMapLayer("OSM - Color"),Zr.createUI(),Vr.createUI(),ji.setKeysFromServerFile(),K.travel.jsonObject=(new F).jsonObject,t.travelNotes.startupRouteEdition&&Nn.editRoute(K.travel.routes.first.objId),Si.dispatch("updatetravelproperties"),Si.dispatch("updateroadbook"),Rr.show(),e&&o&&ln.newUrlNote([e,o]))}addProvider(t){ji.addProvider(t)}showInfo(t){Oi.showInfo(t)}get overpassApiUrl(){return t.overpassApi.url}get map(){return K.map}get version(){return L}};class ea{#Cu(t,e){if("object"==typeof t&&"object"==typeof e){for(const o in e)"object"==typeof e[o]?this.#Cu(t[o],e[o]):typeof t[o]==typeof e[o]&&("string"==typeof e[o]?e[o]="color"===o?P.sanitizeToColor(t[o])||e[o]:"url"===o?P.sanitizeToUrl(t[o]).url:P.sanitizeToJsString(t[o]):e[o]=t[o]||e[o]);for(const o in t)"object"==typeof t[o]?("[object Array]"===Object.prototype.toString.call(t[o])?e[o]=e[o]||[]:e[o]=e[o]||{},this.#Cu(t[o],e[o])):"string"==typeof e.property?e[o]=P.sanitizeToHtmlString(t[o],[]).htmlString:e[o]=t[o]}}#Nu(t){for(const e in t)"object"==typeof t[e]&&this.#Nu(t[e]);Object.freeze(t)}constructor(){Object.freeze(this)}overload(e){this.#Cu(e,t),this.#Nu(t)}}const oa=new class{#Pu(t,e){const i=W.create("div"),s=W.create("div",{className:t+"Route-ManeuversAndNotes-IconCell"},i);W.create("div",{className:"TravelNotes-ManeuverNote TravelNotes-ManeuverNote-"+e.maneuver.iconName},s),s.dataset.tanWidth=String(n.width)+"px",s.dataset.tanHeight=String(n.height)+"px";const r=W.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},i);return W.create("div",{className:t+"Route-Maneuver-TooltipContent",textContent:O.getText("RouteHTMLViewsFactory - "+e.maneuver.iconName)},r),P.sanitizeToHtmlElement(e.maneuver.instruction,W.create("div",{className:t+"Route-Maneuver-Instruction"},r)),e.route.chain&&P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Distance from start of travel")+"</span> : "+D.formatDistance(e.route.chainedDistance+e.maneuverDistance),W.create("div",{className:t+"Route-Maneuver-TravelDistance"},r)),P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Distance from start of route")+"</span> : "+D.formatDistance(e.maneuverDistance),W.create("div",{className:t+"Route-Maneuver-RouteDistance"},r)),o.defaultValue<e.maneuver.distance&&P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Next maneuver after")+"</span> : "+D.formatDistance(e.maneuver.distance),W.create("div",{className:t+"Route-Maneuver-NextDistance"},r)),i}constructor(){Object.freeze(this)}getRouteProfileHTML(t,e){const o=W.create("div",{className:t+"RouteProfile"});return P.sanitizeToHtmlElement(O.getText("RouteHTMLViewsFactory - Profile"),o),o.appendChild((new cs).createSvg(e)),o}getRouteManeuversAndNotesHTML(t,e,o){const i=[],s=e.notes.iterator;for(;!s.done;)i.push({data:s.value,distance:s.value.distance});const n=e.itinerary.maneuvers.iterator;let r=0;for(;!n.done;)i.push({data:n.value,distance:r}),r+=n.value.distance;i.sort((t,e)=>t.distance-e.distance);const a=W.create("div",{className:t+"Route-ManeuversAndNotes"});return i.forEach(i=>{let s=null;"Note"===i.data.objType.name?(s=Bs.getNoteTextAndIconHTML(t,{note:i.data,route:e}),s.className=t+"Route-Notes-Row"):(s=this.#Pu(t,{route:e,maneuver:i.data,maneuverDistance:i.distance}),s.className=t+"Route-Maneuvers-Row"),o&&(s.dataset.tanObjId=i.data.objId,s.dataset.tanMarkerObjId=T.nextObjId,s.dataset.tanObjType=i.data.objType.name),a.appendChild(s)}),a}getRouteHeaderHTML(t,e){const o=W.create("div",{className:t+"Route-Header",id:"route"+e.objId});return P.sanitizeToHtmlElement(e.computedName,W.create("div",{className:t+"Route-Header-Name"},o)),0!==e.distance&&P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Route distance")+"</span> : "+D.formatDistance(e.distance),W.create("div",{className:t+"Route-Header-Distance"},o)),K.travel.readOnly||"bike"===e.itinerary.transitMode||P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Duration")+"</span> : "+D.formatTime(e.duration),W.create("div",{className:t+"Route-Header-Duration"},o)),e.itinerary.hasProfile&&(P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Ascent")+"</span> : "+String(e.itinerary.ascent.toFixed(0))+" m.",W.create("div",{className:t+"Route-Header-Ascent"},o)),P.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Descent")+"</span> : "+String(e.itinerary.descent.toFixed(0))+" m.",W.create("div",{className:t+"Route-Header-Descent"},o))),o}getRouteFooterHTML(t,e){let o=""!==e.itinerary.provider&&""!==e.itinerary.transitMode?O.getText("RouteHTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:O.getText("RouteHTMLViewsFactory - TransitMode "+e.itinerary.transitMode)}):"";const i=W.create("div",{className:t+"RouteFooter"});return P.sanitizeToHtmlElement(o,i),i}};class ia{static handleEvent(t){const e=ki.getRoute(t.target.objId);let o=ti.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;o+=e.chainedDistance,o=D.formatDistance(o);const i=K.mapObjects.get(t.target.objId);i.closeTooltip();let s=e.computedName;K.travel.readOnly||(s+=0===s.length?"":" - ",s+=o),i.setTooltipContent(s),i.openTooltip(t.latlng)}}class sa{#ja;#Ou;#Du;constructor(t,e,o){Object.freeze(this),this.#ja=t,this.#Ou=e,this.#Du=o}get marker(){return this.#ja}get polyline(){return this.#Ou}get bullet(){return this.#Du}}class na{#Su;#ju;static get#Au(){return 18}static get#Ru(){return 0}static get#Hu(){return 100}constructor(){Object.freeze(this),this.#Su=null,this.#ju=null}addToMap(t,e){e.objId=t,e.addTo(K.map),K.mapObjects.set(t,e)}addRoute(t){const e=ki.getRoute(t),o=[],i=e.itinerary.itineraryPoints.iterator;for(;!i.done;)o.push(i.value.latLng);const s=new lo(o,{color:e.color,weight:e.width,dashArray:e.dashString});this.addToMap(e.objId,s),li.isTouch||(s.bindPopup(t=>P.clone(oa.getRouteHeaderHTML("TravelNotes-Map-",ki.getRoute(t.objId)))),s.on("click",t=>t.target.openPopup(t.latlng))),l.notEdited===e.editionStatus&&(s.bindTooltip(e.computedName,{sticky:!0,direction:"right"}),li.isTouch||(s.on("pointerover",ia.handleEvent),s.on("pointermove",ia.handleEvent)));const n=e.notes.iterator;for(;!n.done;)this.addNote(n.value.objId);return e}addNote(e){const o=ki.getNoteAndRoute(e).note,i=new so(o.latLng,{icon:new Io({iconSize:[t.note.grip.size,t.note.grip.size],iconAnchor:[t.note.grip.size/2,t.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Map-Note-Bullet"}),opacity:t.note.grip.opacity,draggable:!K.travel.readOnly});i.objId=o.objId;const s=new so(o.iconLatLng,{zIndexOffset:na.#Hu,icon:new Io({iconSize:[o.iconWidth,o.iconHeight],iconAnchor:[o.iconWidth/2,o.iconHeight/2],popupAnchor:[0,-o.iconHeight/2],html:o.iconContent,className:"TravelNotes-Map-AllNotes "}),draggable:!K.travel.readOnly});s.objId=o.objId,s.bindPopup(t=>P.clone(Bs.getNoteTextHTML("TravelNotes-Map-",ki.getNoteAndRoute(t.objId)))),0!==o.tooltipContent.length&&(s.bindTooltip(t=>ki.getNoteAndRoute(t.objId).note.tooltipContent),s.getTooltip().options.offset[0]=o.iconWidth/2);const n=new lo([o.latLng,o.iconLatLng],t.note.polyline);n.objId=o.objId;const r=new Qe([s,n,i]);return r.markerId=rt.stamp(s),r.polylineId=rt.stamp(n),r.bulletId=rt.stamp(i),this.addToMap(o.objId,r),t.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach(t=>t.classList.add("TravelNotes-Map-Note-Background")),new sa(s,n,i)}zoomTo(e,o){if(o){let t=[];o.forEach(e=>t=t.concat(e)),K.map.fitBounds(ti.getLatLngBounds(t))}else K.map.setView(e,t.itineraryPoint.zoomFactor)}setLayer(t,e){const o="wmts"===t.service.toLowerCase()?new No(e):new No.WMS(e,t.wmsOptions);this.#Su&&K.map.removeLayer(this.#Su),K.map.addLayer(o),this.#Su=o,K.travel.readOnly||(K.map.getZoom()<(t.minZoom||na.#Ru)&&K.map.setZoom(t.minZoom||na.#Ru),K.map.setMinZoom(t.minZoom||na.#Ru),K.map.getZoom()>(t.maxZoom||na.#Au)&&K.map.setZoom(t.maxZoom||na.#Au),K.map.setMaxZoom(t.maxZoom||na.#Au),t.bounds?(K.map.getBounds().intersects(t.bounds)&&!K.map.getBounds().contains(t.bounds)||(K.map.setMaxBounds(null),K.map.fitBounds(t.bounds),K.map.setZoom(t.minZoom||na.#Ru)),K.map.setMaxBounds(t.bounds)):K.map.setMaxBounds(null)),K.map.fire("baselayerchange",o)}onGeolocationStatusChanged(t){s.active!==t&&this.#ju&&(K.map.removeLayer(this.#ju),this.#ju=null)}#ku(t){const e=O.getText("MapEditorViewer -Copied to clipboard"),o=t.target.getTooltip().getContent();f===o.indexOf(e)&&navigator.clipboard.writeText(o.replaceAll("<br/>","\n")).then(()=>{t.target.getTooltip().setContent(o+"<br/><br/>"+O.getText("MapEditorViewer -Copied to clipboard"))}).catch(()=>console.error("Failed to copy to clipboard "))}onGeolocationPositionChanged(e){let o=t.geoLocation.zoomToPosition;this.#ju&&(K.map.removeLayer(this.#ju),o=!1);let i="Position (+/- "+e.coords.accuracy.toFixed(0)+" m) : <br/>"+D.formatLatLngDMS([e.coords.latitude,e.coords.longitude])+"<br/>"+D.formatLatLng([e.coords.latitude,e.coords.longitude])+"<br/>";e.coords.altitude&&(i+="<br/> Altitude  :<br/>"+e.coords.altitude.toFixed(0)+" m",e.coords.altitudeAccuracy&&(i+="(+/- "+e.coords.altitudeAccuracy.toFixed(0)+" m)")),0===t.geoLocation.marker.radius?(this.#ju=new ao(new ut(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#ju.setRadius(e.coords.accuracy.toFixed(0))):this.#ju=new ro(new ut(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#ju.bindTooltip(i).addTo(K.map),t.geoLocation.watch||this.#ju.bindPopup(i).openPopup(),this.#ju.on("click",t=>{this.#ku(t)}),o&&K.map.setView(new ut(e.coords.latitude,e.coords.longitude),t.geoLocation.zoomFactor)}}class ra{static handleEvent(t){const e=ki.getNoteAndRoute(t.target.objId),o=e.note,i=e.route,s=K.mapObjects.get(t.target.objId);if(null===i)o.latLng=[t.target.getLatLng().lat,t.target.getLatLng().lng],Si.dispatch("updatetravelnotes");else{const e=ti.getClosestLatLngDistance(i,[t.target.getLatLng().lat,t.target.getLatLng().lng]);o.latLng=e.latLng,o.distance=e.distance,i.notes.sort((t,e)=>t.distance-e.distance),s.getLayer(s.bulletId).setLatLng(e.latLng)}s.getLayer(s.polylineId).setLatLngs([o.latLng,o.iconLatLng]),Si.dispatch("updateroadbook")}}class aa{static handleEvent(t){const e=ki.getNoteAndRoute(t.target.objId).note,o=K.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([[t.latlng.lat,t.latlng.lng],e.iconLatLng])}}class la{static handleEvent(e){e.originalEvent.target.style.opacity=t.note.grip.moveOpacity}}class ha{static handleEvent(e){e.originalEvent.target.style.opacity=t.note.grip.opacity}}class da{static handleEvent(t){new Sr(t).show()}}class ca{static handleEvent(t){const e=ki.getNoteAndRoute(t.target.objId).note;e.iconLatLng=[t.target.getLatLng().lat,t.target.getLatLng().lng];const o=K.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,e.iconLatLng])}}class ua{static handleEvent(t){const e=ki.getNoteAndRoute(t.target.objId).note,o=K.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,[t.latlng.lat,t.latlng.lng]])}}class ma extends bs{constructor(t,e){super(t,e)}get menuItems(){return[new Ls(O.getText("WayPointContextMenu - Delete this waypoint"),K.travel.editedRoute.wayPoints.first.objId!==this.targetObjId&&K.travel.editedRoute.wayPoints.last.objId!==this.targetObjId,()=>gr.removeWayPoint(this.targetObjId)),new Ls(O.getText("WayPointContextMenu - Modify properties"),!0,()=>gr.wayPointProperties(this.targetObjId))]}}class pa{static handleEvent(t){new ma(t).show()}}class ga{static handleEvent(t){gr.wayPointDragEnd(t)}}class va{static handleEvent(t){_e.stopPropagation(t),new Pr(t).show()}}class fa extends na{static get#Bu(){return.01}#zu(t){const e=K.mapObjects.get(t);e&&(e.off(),K.map.removeLayer(e),K.mapObjects.delete(t))}constructor(){super()}updateRoute(t,e){if(g!==t){const e=ki.getRoute(t);this.#zu(e.objId);const o=e.notes.iterator;for(;!o.done;)this.#zu(o.value.objId);const i=e.wayPoints.iterator;for(;!i.done;)this.#zu(i.value.objId)}if(g!==e){const t=this.addRoute(e),o=K.mapObjects.get(e);if(!K.travel.readOnly){o.on("contextmenu",va.handleEvent),l.notEdited===t.editionStatus||li.isTouch||o.on("pointerover",Jr.handleEvent);const e=t.notes.iterator;for(;!e.done;){const t=K.mapObjects.get(e.value.objId),o=t.getLayer(t.markerId),i=t.getLayer(t.bulletId);i.on("dragend",ra.handleEvent),i.on("drag",aa.handleEvent),i.on("pointerover",la.handleEvent),i.on("pointerout",ha.handleEvent),o.on("contextmenu",da.handleEvent),o.on("dragend",ca.handleEvent),o.on("drag",ua.handleEvent)}}if(!K.travel.readOnly&&l.notEdited!==t.editionStatus){const t=K.travel.editedRoute.wayPoints.iterator;for(;!t.done;)this.addWayPoint(t.value,t.first?"A":t.last?"B":t.index)}}}updateRouteProperties(t){const e=K.mapObjects.get(t),o=ki.getRoute(t);e.setStyle({color:o.color,weight:o.width,dashArray:o.dashString})}updateNote(t,e){let o=!1;if(g!==t){const e=K.mapObjects.get(t);e&&(o=e.getLayer(e.markerId).isPopupOpen()),this.#zu(t)}if(g!==e){const t=this.addNote(e);o&&t.marker.openPopup(),K.travel.readOnly||(t.bullet.on("dragend",ra.handleEvent),t.bullet.on("drag",aa.handleEvent),t.bullet.on("pointerover",la.handleEvent),t.bullet.on("pointerout",ha.handleEvent),t.marker.on("contextmenu",da.handleEvent),t.marker.on("dragend",ca.handleEvent),t.marker.on("drag",ua.handleEvent))}}removeObject(t){this.#zu(t)}removeAllObjects(){K.mapObjects.forEach(t=>{t.off(),K.map.removeLayer(t)}),K.mapObjects.clear()}addWayPoint(t,e){if(a.defaultValue===t.lat&&a.defaultValue===t.lng)return;const o='<div class="TravelNotes-Map-WayPoint TravelNotes-Map-WayPoint'+("A"===e?"Start":"B"===e?"End":"Via")+'"></div><div class="TravelNotes-Map-WayPointText">'+e+"</div>",i=new so(t.latLng,{icon:new Io({iconSize:[_,_],iconAnchor:[10,_],html:o,className:"TravelNotes-Map-WayPointStyle"}),draggable:!0});i.bindTooltip(t=>ki.getWayPoint(t.objId).fullName),i.getTooltip().options.offset=[10,-10],i.on("contextmenu",pa.handleEvent),i.objId=t.objId,this.addToMap(t.objId,i),i.on("dragend",ga.handleEvent)}addItineraryPointMarker(e,o){this.addToMap(e,new ro(o,t.itineraryPoint.marker))}addSearchPointMarker(e,o,i){let s=!1;if(i){let t=[];i.forEach(e=>{t=t.concat(e)});const e=ti.getLatLngBounds(t),o=K.map.getBounds();s=(e.getEast()-e.getWest())/(o.getEast()-o.getWest())>fa.#Bu&&(e.getNorth()-e.getSouth())/(o.getNorth()-o.getSouth())>fa.#Bu}s?this.addToMap(e,new lo(i,t.osmSearch.searchPointPolyline)):this.addToMap(e,new ro(o,t.osmSearch.searchPointMarker))}addRectangle(t,e,o){this.addToMap(t,new Ro(e,o))}setLayer(t){const e=ji.getUrl(t);e&&super.setLayer(t,e)}}const ya=new fa;class _a{#Fu;#Dt;#Zu;static get#Ku(){return 1}#Uu(t,e){if(this.#Fu)return void t();const o=window.indexedDB.open("TravelNotesDb",_a.#Ku);o.onerror=()=>{this.#Fu=null,e(new Error("Not possible to open the db"))},o.onsuccess=e=>{this.#Fu=e.target.result,t()},o.onupgradeneeded=t=>{this.#Fu=t.target.result,this.#Fu.createObjectStore("Travels",{keyPath:"UUID"})}}#Wu(t,e){if(!this.#Fu)return void e(new Error("Database not opened"));const o=this.#Fu.transaction(["Travels"],"readonly");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").get(this.#Dt).onsuccess=e=>t(e.target.result?e.target.result.data:null)}#Vu(t,e){if(!this.#Fu)return void e(new Error("Database not opened"));const o=this.#Fu.transaction(["Travels"],"readwrite");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").put({UUID:this.#Dt,data:this.#Zu}).onsuccess=()=>t()}#Xu(){this.#Fu.close(),this.#Fu=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise((t,e)=>this.#Uu(t,e))}getReadPromise(t){return this.#Dt=t,new Promise((t,e)=>this.#Wu(t,e))}getWritePromise(t,e){return this.#Dt=t,this.#Zu=e,new Promise((t,e)=>this.#Vu(t,e))}closeDb(t){if(!this.#Fu)return;if(!t)return void this.#Xu();const e=this.#Fu.transaction(["Travels"],"readwrite");e.onerror=()=>{};const o=e.objectStore("Travels").delete(t);o.onerror=()=>this.#Xu(),o.onsuccess=()=>this.#Xu()}}const Ta=new _a;const ba=new class{#Yu(e){const i=W.create("div",{className:e+"Travel-Header"});P.sanitizeToHtmlElement(K.travel.name,W.create("div",{className:e+"Travel-Header-Name"},i));let s=o.defaultValue,n=0,r=0;const a=K.travel.routes.iterator;for(;!a.done;){const o=a.value.objId===K.editedRouteObjId&&t.routeEditor.showEditedRouteInRoadbook?K.travel.editedRoute:a.value;P.sanitizeToHtmlElement('<a href="#route'+o.objId+'" >'+o.computedName+"</a> : "+D.formatDistance(o.distance)+".",W.create("div",{className:e+"Travel-Header-RouteName"},i)),o.chain&&(s+=o.distance,n+=o.itinerary.ascent,r+=o.itinerary.descent)}return P.sanitizeToHtmlElement("<span>"+O.getText("TravelHTMLViewsFactory - Travel distance")+"</span> : "+D.formatDistance(s),W.create("div",{className:e+"Travel-Header-TravelDistance"},i)),0!==n&&P.sanitizeToHtmlElement("<span>"+O.getText("travelHTMLViewsFactory - Travel ascent")+"</span> : "+String(n.toFixed(0))+" m.",W.create("div",{className:e+"Travel-Header-TravelAscent"},i)),0!==r&&P.sanitizeToHtmlElement("<span>"+O.getText("TravelHTMLViewsFactory - Travel descent")+"</span> : "+String(r.toFixed(0))+" m.",W.create("div",{className:e+"Travel-Header-TravelDescent"},i)),i}#Gu(t){const e=O.getText("TravelHTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/TravelNotes" >Travel & Notes</a>, © <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 '+new Date(Date.now()).getFullYear()+'</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+O.getText("TravelHTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=W.create("div",{className:t+"TravelFooter"});return P.sanitizeToHtmlElement(e,o),o}constructor(){Object.freeze(this)}getTravelHTML(e){const o=W.create("div",{className:e+"Travel"});o.appendChild(this.#Yu(e)),o.appendChild(Bs.getTravelNotesHTML(e));const i=K.travel.routes.iterator;for(;!i.done;){const s=t.routeEditor.showEditedRouteInRoadbook&&i.value.objId===K.editedRouteObjId?K.travel.editedRoute:i.value;o.appendChild(oa.getRouteHeaderHTML(e,s)),s.itinerary.hasProfile&&o.appendChild(oa.getRouteProfileHTML(e,s)),o.appendChild(oa.getRouteManeuversAndNotesHTML(e,s,!1)),o.appendChild(oa.getRouteFooterHTML(e,s))}return o.appendChild(this.#Gu(e)),o}};class La{#qu;constructor(){Object.freeze(this),this.#qu=D.storageAvailable("localStorage")}handleEvent(){Un.saveStatus=h.modified,this.#qu&&Ta.getOpenPromise().then(()=>{Ta.getWritePromise(K.UUID,ba.getTravelHTML("TravelNotes-Roadbook-").outerHTML)}).then(()=>localStorage.setItem(K.UUID,Date.now())).catch(t=>{t instanceof Error&&console.error(t)})}}class Ea{#$u=null;#Ju(){Vr.centerToolbar(),this.#$u=null}constructor(){Object.freeze(this)}handleEvent(){this.#$u&&(clearTimeout(this.#$u),this.#$u=null),this.#$u=setTimeout(()=>this.#Ju(),t.travelNotes.resizeDelay)}}class wa{static addEventsListeners(){document.addEventListener("additinerarypointmarker",t=>{t.data&&ya.addItineraryPointMarker(t.data.objId,t.data.latLng)}),document.addEventListener("addrectangle",t=>{t.data&&ya.addRectangle(t.data.objId,t.data.bounds,t.data.properties)}),document.addEventListener("addsearchpointmarker",t=>{t.data&&ya.addSearchPointMarker(t.data.objId,t.data.latLng,t.data.geometry)}),document.addEventListener("addwaypoint",t=>{t.data&&ya.addWayPoint(t.data.wayPoint,t.data.letter)}),document.addEventListener("geolocationpositionchanged",t=>{t.data&&ya.onGeolocationPositionChanged(t.data.position)}),document.addEventListener("geolocationstatuschanged",t=>{t.data&&ya.onGeolocationStatusChanged(t.data.status)}),document.addEventListener("layerchange",t=>{t.data&&ya.setLayer(t.data.layer)}),document.addEventListener("noteupdated",t=>{t.data&&ya.updateNote(t.data.removedNoteObjId,t.data.addedNoteObjId)}),document.addEventListener("profileclosed",t=>{t.data&&vn.onProfileClosed(t.data.objId)}),document.addEventListener("providersadded",()=>Vr.providersAdded()),document.addEventListener("removeallobjects",()=>ya.removeAllObjects()),document.addEventListener("removeobject",t=>{t.data&&ya.removeObject(t.data.objId)}),document.addEventListener("routepropertiesupdated",t=>{t.data&&ya.updateRouteProperties(t.data.routeObjId)}),document.addEventListener("routeupdated",t=>{t.data&&ya.updateRoute(t.data.removedRouteObjId,t.data.addedRouteObjId)}),document.addEventListener("setprovider",t=>{t?.data?.provider&&(Vr.provider=t.data.provider)}),document.addEventListener("settransitmode",t=>{t?.data?.transitMode&&(Vr.transitMode=t.data.transitMode)}),document.addEventListener("showtravelproperties",()=>Ar.showTravelProperties()),document.addEventListener("updateosmsearch",()=>Ar.osmSearchDialog.updateContent()),document.addEventListener("updateprofilename",t=>{t.data&&vn.updateProfileName(t.data.routeObjId)}),document.addEventListener("updateroadbook",new La),document.addEventListener("updatetravelnotes",()=>Ar.travelNotesDialog.updateContent()),document.addEventListener("updatetravelproperties",()=>Ar.travelPropertiesDialog.updateContent()),document.addEventListener("zoomto",t=>{t.data&&ya.zoomTo(t.data.latLng,t.data.geometry)}),window.visualViewport.addEventListener("resize",new Ea)}static addUnloadEventsListeners(){window.addEventListener("unload",()=>localStorage.removeItem(K.UUID)),window.addEventListener("beforeunload",e=>{if(Ta.closeDb(K.UUID),t.travelNotes.haveBeforeUnloadWarning)return e.returnValue="x","x"})}}(new class{#Qu;#tm;#em;#om;#im;#sm;#nm(){const t=new URL(window.location);let e=t.searchParams.get("fil");if(e&&0!==e.length)try{if(e=atob(e),e.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");const o=new URL(e,t.protocol+"//"+t.hostname+(""===t.port?"":":"+t.port));if(!(Url=t.protocol&&o.protocol&&t.protocol===o.protocol&&t.hostname&&o.hostname&&t.hostname===o.hostname))throw new Error("The distant file is not on the same site than the app");this.#Qu=encodeURI(o.href)}catch(t){t instanceof Error&&console.error(t)}const o=t.searchParams.get("lng");o&&o.match(/^[A-Z,a-z]{2}$/)&&(this.#om=o.toLowerCase());const i=t.searchParams.get("lat");i&&(this.#tm=Number.parseFloat(i),Number.isNaN(this.#tm)&&(this.#tm=null));const s=t.searchParams.get("lon");s&&(this.#em=Number.parseFloat(s),Number.isNaN(this.#em)&&(this.#em=null))}async#rm(){const e=await fetch(this.#im+"Config.json");if(p===e.status&&e.ok){const o=await e.json();return o.travelNotes.language=this.#om||o.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(o.ApiKeysDialog.haveUnsecureButtons=!0,o.errorsUI.showHelp=!0,o.mapLayersToolbar.theDevil.addButton=!1,o.note.maxManeuversNotes=12,o.note.haveBackground=!0,o.noteDialog.theDevil.addButton=!1,o.printRouteMap.maxTiles=10,o.route.showDragTooltip=f),(new ea).overload(o),K.providers.forEach(e=>{e.userLanguage=t.travelNotes.language}),!0}return!1}async#am(t,e){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(O.setTranslations(await t.value.json()),!0):"fulfilled"===e.status&&p===e.value.status&&e.value.ok?(O.setTranslations(await e.value.json()),this.#sm+="Not possible to load the TravelNotes"+this.#om.toUpperCase()+".json file. English will be used. ",!0):(this.#sm+="Not possible to load the translations. ",!1)}async#lm(t,e){if("fulfilled"===t.status&&p===t.value.status&&t.value.ok){const e=await t.value.json();return Ms.loadJson(e),!0}if("fulfilled"===e.status&&p===e.value.status&&e.value.ok){const t=await e.value.json();return Ms.loadJson(t),this.#sm+="Not possible to load the TravelNotesNoteDialog"+this.#om.toUpperCase()+".json file. English will be used. ",!0}return this.#sm+="Not possible to load the translations for the note dialog. ",!1}async#hm(t,e){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(Qn.parseDictionary(await t.value.text()),!0):"fulfilled"===e.status&&p===e.value.status&&e.value.ok?(Qn.parseDictionary(await e.value.text()),this.#sm+="Not possible to load the TravelNotesSearchDictionary"+this.#om.toUpperCase()+".csv file. English will be used. ",!0):(this.#sm+="Not possible to load the search dictionary. OSM search will not be available.",!0)}async#dm(t){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(Ln.addMapLayers(await t.value.json()),!0):(this.#sm+="Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",!0)}async#cm(){const t=await Promise.allSettled([fetch(this.#im+this.#om.toUpperCase()+".json"),fetch(this.#im+"EN.json"),fetch(this.#im+"NoteDialog"+this.#om.toUpperCase()+".json"),fetch(this.#im+"NoteDialogEN.json"),fetch(this.#im+"SearchDictionary"+this.#om.toUpperCase()+".csv"),fetch(this.#im+"SearchDictionaryEN.csv"),fetch(this.#im+"Layers.json")]),e=await this.#am(t[0],t[1])&&await this.#lm(t[2],t[3])&&await this.#hm(t[4],t[5])&&await this.#dm(t[6]);return""!==this.#sm&&e?Oi.showError(this.#sm):""!==this.#sm&&(document.body.textContent=this.#sm),e}#um(){wa.addEventsListeners(),document.body.style["font-size"]=String(t.fontSize.initialValue)+"mm";const e=document.createElement("div");e.id="TravelNotes-Map",document.body.appendChild(e),K.map=new Le(e.id,{attributionControl:!1,zoomControl:!1}).setView([a.defaultValue,a.defaultValue],0),this.#Qu?ta.addReadOnlyTravel(this.#Qu):(wa.addUnloadEventsListeners(),ta.addToolbarsMenusUIs(this.#tm,this.#em))}constructor(){Object.freeze(this),this.#im=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes",this.#sm=""}async loadApp(){window.TaN=ta,this.#nm(),await this.#rm()?(this.#om=this.#om||t.travelNotes.language||"fr",Oi.createUI(),await this.#cm()&&this.#um()):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}}).loadApp()}();
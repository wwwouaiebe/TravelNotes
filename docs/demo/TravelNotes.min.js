/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 4.1.0
 * Build 00207 - 2022-10-14T14:54:36+0200 
 * Copyright 2017 2022 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";const t={ApiKeys:{saveToSessionStorage:!0},ApiKeysDialog:{haveUnsecureButtons:!0,showApiKeys:!1,showButton:!0},baseDialog:{cancelTouchX:100,cancelTouchY:150,deltaZoomDistance:75,touchTopScreen:!0},contextMenu:{timeout:1500},dockableBaseDialog:{timeout:1500,hideOnMouseLeave:!1},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!1,showInfo:!0,showWarning:!0,timeOut:1e4},files:{openGpx:["gpx"],openTaN:["json","trv"],writeTouch:"trv",writeOthers:"trv"},fontSize:{initialValue:3.5,incrementValue:.5},FullScreenUI:{timeOut:5e3,screenMaxWidth:1200},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:0},options:{enableHighAccuracy:!0,maximumAge:0,timeout:36e5},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},mapContextMenu:{mouseMaxRouteDistance:10,touchMaxRouteDistance:10},mapLayersToolbar:{theDevil:{addButton:!0}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:6,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},theDevil:{addButton:!0,zoomFactor:17}},osmSearchDialog:{dialogX:50,dialogY:0},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"â€”â€”â€”â€”â€”â€”",iDashArray:[0]},{text:"â€” â€” â€” â€” â€”",iDashArray:[4,2]},{text:"â€”â€§â€”â€§â€”â€§â€”â€§â€”",iDashArray:[4,2,0,2]},{text:"Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:0,width:5},routeEditor:{showEditedRouteInRoadbook:!0},toolbars:{timeOut:1500},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr",startupRouteEdition:!0,resizeDelay:200},travelNotesToolbar:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},travelNotesDialog:{dialogX:250,dialogY:0},travelPropertiesDialog:{dialogX:50,dialogY:0},wayPoint:{reverseGeocoding:!0,geocodingIncludeName:!0}};class e{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class o{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class i{static get fixed(){return 2}static get defaultValue(){return 0}}class n{static get refusedByUser(){return-1}static get disabled(){return 0}static get inactive(){return 1}static get active(){return 2}}class s{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class r{static get atStart(){return-1}static get onRoute(){return 0}static get atEnd(){return 1}}class a{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class l{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}class h{static get notSaved(){return"ðŸ”´"}static get modified(){return"ðŸŸ¡"}static get saved(){return"ðŸŸ¢"}}class c{static get topLeft(){return"TravelNotes-BaseToolbar-TopLeft"}static get topRight(){return"TravelNotes-BaseToolbar-TopRight"}static get bottomLeft(){return"TravelNotes-BaseToolbar-BottomLeft"}static get bottomRight(){return"TravelNotes-BaseToolbar-BottomRight"}}const d=40,u=6371e3,m=16,p=200,g=-1,v=[.3,10,1],f=-1,_="http://www.w3.org/2000/svg",y=20;class T{static#t=0;static get nextObjId(){return++T.#t}}const b="2.4.0",E="v4.1.0";class w{#e="";#o=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];#i=[];constructor(t,e){if(Object.freeze(this),f===this.#o.indexOf(t))throw new Error("Invalid ObjType name : "+t);this.#e=t,this.#i=e,Object.freeze(this.#i)}get name(){return this.#e}get version(){return b}get properties(){return this.#i}get jsonObject(){return{name:this.#e,version:b}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this.#e);if(this.#e!==t.name)throw new Error("Invalid name for "+this.#e);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this.#e)}}class M{#n=null;#s=f;constructor(t){Object.freeze(this),this.#n=t}get value(){return this.#s<this.#n.length?this.#n.at(this.#s):null}get previous(){return 0>=this.#s?null:this.#n.at(this.#s-1)}get next(){return this.#s<this.#n.length-1?this.#n.at(this.#s+1):null}get done(){return++this.#s>=this.#n.length}get first(){return 0===this.#s}get last(){return this.#s>=this.#n.length-1}get index(){return this.#s}}class x{#r;#a;#l;#h(t){return this.#r.findIndex((e=>e.objId===t))}#c(t,e,o){let i=this.#h(t);if(f===i)throw new Error("invalid objId for next or previous function");if(1!==o&&-1!==o)throw new Error("invalid direction");let n=e;for(n||(n=()=>!0),i+=o;f<i&&i<this.#r.length&&!n(this.#r[i]);)i+=o;return f===i||this.#r.length===i?null:this.#r[i]}constructor(t){Object.freeze(this),this.#r=[],this.#l=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this.#a=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this.#a)throw new Error("invalid object name for add function");this.#r.push(t)}at(t){return t<this.#r.length&&t>f?this.#r[t]:null}forEach(t){let e=null;const o=this.iterator;for(;!o.done;)e=t(o.value,e);return e}getAt(t){const e=this.#h(t);return f===e?null:this.#r[e]}moveTo(t,e,o){let i=this.#h(t),n=this.#h(e);if(f===i||f===n)throw new Error("invalid objId for function  myMoveTo");o||n++,this.#r.splice(n,0,this.#r[i]),n<i&&i++,this.#r.splice(i,1)}next(t,e){return this.#c(t,e,1)}previous(t,e){return this.#c(t,e,-1)}remove(t){const e=this.#h(t);if(f===e)throw new Error("invalid objId for remove function");this.#r.splice(e,1)}removeAll(t){t?this.#r.splice(1,this.#r.length-2):this.#r.length=0}replace(t,e){const o=this.#h(t);if(f===o)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this.#a)throw new Error("invalid object name for replace function");this.#r[o]=e}reverse(){this.#r.reverse()}sort(t){this.#r.sort(t)}swap(t,e){const o=this.#h(t);if(f===o||0===o&&e||this.#r.length-1===o&&!e)throw new Error("invalid objId for swap function");const i=e?-1:1,n=this.#r[o];this.#r[o]=this.#r[o+i],this.#r[o+i]=n}get first(){return this.#r[0]}get iterator(){return new M(this)}get last(){return this.#r[this.#r.length-1]}get length(){return this.#r.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this.#r.length=0,Array.isArray(t)&&t.forEach((t=>{const e=new this.#l;e.jsonObject=t,this.add(e)}))}}class I{#d=new Map;constructor(){Object.freeze(this),this.#d.set("a",["href","target"]),this.#d.set("div",[]),this.#d.set("del",[]),this.#d.set("em",[]),this.#d.set("figcaption",[]),this.#d.set("figure",[]),this.#d.set("h1",[]),this.#d.set("h2",[]),this.#d.set("h3",[]),this.#d.set("h4",[]),this.#d.set("h5",[]),this.#d.set("h6",[]),this.#d.set("hr",[]),this.#d.set("img",["src","alt","width","height"]),this.#d.set("ins",[]),this.#d.set("li",[]),this.#d.set("mark",[]),this.#d.set("ol",[]),this.#d.set("p",[]),this.#d.set("s",[]),this.#d.set("small",[]),this.#d.set("strong",[]),this.#d.set("span",[]),this.#d.set("sub",[]),this.#d.set("sup",[]),this.#d.set("ul",[]),this.#d.set("svg",["xmlns","viewBox","class"]),this.#d.set("text",["x","y","text-anchor"]),this.#d.set("polyline",["points","class","transform"]),this.#d.set("#text",[])}getValidAttributesNames(t){return this.#d.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#d.get(e)?e:""}}class C{#u;#m;constructor(t,e){Object.freeze(this),this.#u=t,this.#m=e}get htmlString(){return this.#u}get errorsString(){return this.#m}}class N{#p;#m;constructor(t,e){Object.freeze(this),this.#p=t,this.#m=e}get url(){return this.#p}get errorsString(){return this.#m}}class P{#g="";#v="";static#f=new I;#_(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#y(t,e){const o=this.sanitizeToUrl(t,e).url;""===o&&""!==t?this.#v+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#g+=" "+e+'="'+o+'"'}#T(t,e){P.#f.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(this.#g+=" "+e+'="'+this.#_(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))}))}#L(t,e){t.hasAttribute("target")&&(this.#g+=' rel="noopener noreferrer"'),P.#f.getValidAttributesNames(e).forEach((e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#y(t.getAttribute(e),e):this.#g+=" "+e+'="'+this.#_(t.getAttribute(e))+'"',t.removeAttribute(e))}))}#b(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#v+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#E(t){const e=t.childNodes;for(let o=0;o<e.length;o++){const e=t.childNodes[o],i=P.#f.getValidNodeName(e.nodeName);""===i?this.#v+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===i?this.#g+=this.#_(e.nodeValue):(this.#g+="<"+i,"svg"===i||"text"===i||"polyline"===i?this.#T(e,i):this.#L(e,i),this.#g+=">",this.#E(e),this.#g+="</"+i+">",e.attributes&&this.#b(e))}}#w(t,e){const o=document.createElementNS(_,e);return P.#f.getValidAttributesNames(e).forEach((e=>{t.hasAttributeNS(null,e)&&(o.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))})),o}#M(t,e){const o=document.createElement(e);return P.#f.getValidAttributesNames(e).forEach((e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const i=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==i&&o.setAttribute(e,i)}else o.setAttribute(e,t.getAttribute(e))})),t.hasAttribute("target")&&o.setAttribute("rel","noopener noreferrer"),o}#x(t,e){const o=t.childNodes;for(let i=0;i<o.length;i++){const o=t.childNodes[i],n=P.#f.getValidNodeName(o.nodeName);if("#text"===n)e.appendChild(document.createTextNode(o.nodeValue));else if(""!==n){const t="svg"===n||"text"===n||"polyline"===n?this.#w(o,n):this.#M(o,n);e.appendChild(t),this.#x(o,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const o=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),i=new DocumentFragment;o&&"#document"===o.nodeName?(this.#x(o.body.firstChild,i),e.appendChild(i)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#x(t,e),e}sanitizeToHtmlString(t){this.#g="",this.#v="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","à¨€")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#E(e.body.firstChild),new C(this.#g,this.#v)):new C("","Parsing error")}sanitizeToUrl(t,e){const o=e||"href",i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!i||"#document"!==i.nodeName)return new N("","Parsing error");const n=i.body.firstChild;let s="";for(let t=0;t<n.childNodes.length;t++){if("#text"!==n.childNodes[t].nodeName)return new N("","Invalid characters found in the url");s+=n.childNodes[t].nodeValue}if(s=s.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),s!==t)return new N("","Invalid characters found in the url");const r=["https:"];if("http:"!==window.location.protocol&&"href"!==o||r.push("http:"),"href"===o){r.push("mailto:"),r.push("sms:"),r.push("tel:");const t=s.match(/^\u0023\w*/);if(t&&s===t[0])return new N(s,"")}"src"===o&&r.push("data:");let a=null;try{a=new URL(s)}catch(t){return new N("","Invalid url string")}if(f===r.indexOf(a.protocol))return new N("","Invalid protocol "+a.protocol);if(f!==["sms:","tel:"].indexOf(a.protocol))return a.pathname.match(/^\+[0-9,*,\u0023]*$/)?new N(s,""):new N("","Invalid sms: or tel: url");try{encodeURIComponent(a.href)}catch(t){return new N("","Invalid character in url")}return new N(s,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const o=e.body.firstChild;let i="";for(let t=0;t<o.childNodes.length;t++){if("#text"!==o.childNodes[t].nodeName)return"";i+=o.childNodes[t].nodeValue}return i=i.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),i}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const D=new P;const O=new class{#I=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach((t=>this.#I.set(t.msgid,D.sanitizeToJsString(t.msgstr))))}getText(t,e){let o=this.#I.get(t);return e&&o&&Object.getOwnPropertyNames(e).forEach((t=>o=o.replace("{"+t+"}",e[t]))),o||t}};const S=new class{constructor(){Object.freeze(this)}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let o="";for(let i=0;i<16;i++)o+=e[i].toString(m).padStart(2,"0")+t[i];return o}storageAvailable(t){try{const e=window[t],o="__storage_test__";return e.setItem(o,o),e.removeItem(o),!0}catch(t){return!1}}openFile(t,e){const o=document.createElement("input");o.type="file",e&&(o.accept=e),o.addEventListener("change",t,!1),o.click()}saveFile(t,e,o){try{const i=o?window.URL.createObjectURL(new File([e],t,{type:o})):URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",t),n.click(),window.URL.revokeObjectURL(i)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const o=Math.floor(e/86400),i=Math.floor(e%86400/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60);return 0<o?o+"Â "+O.getText("Utilities - Day")+"Â "+i+"Â "+O.getText("Utilities - Hour"):0<i?i+"Â "+O.getText("Utilities - Hour")+"Â "+n+"Â "+O.getText("Utilities - Minute"):0<n?n+"Â "+O.getText("Utilities - Minute"):s+"Â "+O.getText("Utilities - Second")}formatDistance(t){const e=Math.floor(t);return 0>=e?"0Â km":Math.floor(e/o.metersInKm)+","+Math.floor(e%o.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+"Â km"}numberToDMS(t){let e=t,o=Math.floor(t);e-=o;let i=Math.floor(60*e);e-=i/60,e*=3600;let n=Math.floor(e);return e-=n,e=Math.floor(100*e),o.toString()+"Â° "+i.toString()+"' "+n+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+"Â N":this.numberToDMS(-t)+"Â S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+"Â E":this.numberToDMS(-t)+"Â W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+"Â -Â "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(a.fixed)+"Â N":(-t).toFixed(a.fixed)+"Â S"}formatLng(t){return t>0?t.toFixed(a.fixed)+"Â E":(-t).toFixed(a.fixed)+"Â W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+"Â -Â "+this.formatLng(t[1])}};class j{#C;#N(){this.#C.routes.forEach((t=>{t.dashArray=0,t.hidden=!1}))}#P(){this.#C.routes.forEach((t=>{t.edited=l.notEdited}))}#D(){this.#P(),this.#C.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"#ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:l.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}#O(){if(this.#C.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"LantmÃ¤teriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find((t=>t.layerId===this.#C.userData.layerId));this.#C.layerName=t?t.layerName:"OSM - Color"}else this.#C.layerName="OSM - Color"}#S(t){t.forEach((t=>{t.elev=i.defaultValue}))}#j(){this.#C.routes.forEach((t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this.#S(t.itinerary.itineraryPoints)})),this.#C.editedRoute.itinerary.hasProfile=!1,this.#C.editedRoute.itinerary.ascent=0,this.#C.editedRoute.itinerary.descent=0,this.#S(this.#C.editedRoute.itinerary.itineraryPoints)}#A(t){t.itinerary.maneuvers.forEach((t=>{"kArriveDefault"===t.iconName&&(t.distance=o.defaultValue)}))}#H(t){t.wayPoints.forEach((t=>{t.address=t.name,t.name=""}))}#R(){this.#C.routes.forEach((t=>{t.editionStatus=t.edited,this.#A(t),this.#H(t)})),this.#C.editedRoute.editionStatus=this.#C.editedRoute.edited,this.#A(this.#C.editedRoute),this.#H(this.#C.editedRoute)}#k(){this.#C.routes.forEach((t=>{t.dashIndex=t.dashArray})),this.#C.editedRoute.dashIndex=this.#C.editedRoute.dashArray}#B(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}#z(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this.#B(t.iconContent),t.popupContent=this.#B(t.popupContent),t.tooltipContent=this.#B(t.tooltipContent),t.phone=this.#B(t.phone),t.address=this.#B(t.address)}#F(){this.#C.notes.forEach((t=>{this.#z(t)})),this.jsonTravel.routes.forEach((t=>{t.notes.forEach((t=>{this.#z(t)}))}))}#Z(){switch(this.#C.objType.version){case"1.0.0":this.#N();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this.#D();case"1.5.0":this.#O();case"1.6.0":this.#j();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this.#R();case"1.12.0":case"1.13.0":this.#F();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this.#k(),this.#C.objType.version="2.4.0";break;default:throw new Error("invalid version for travel")}}constructor(){Object.freeze(this)}update(t){t.objType.version!==b&&(this.#C=t,this.#Z())}}class A{constructor(){Object.freeze(this)}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new j).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach((t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)})),t}}class H extends A{static#K=new w("WayPoint",["address","name","lat","lng","objId"]);#U="";#W="";#V=a.defaultValue;#X=a.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get name(){return this.#U}set name(t){this.#U="string"==typeof t?D.sanitizeToJsString(t):""}get address(){return this.#W}set address(t){this.#W="string"==typeof t?D.sanitizeToJsString(t):""}get lat(){return this.#V}set lat(t){this.#V="number"==typeof t?t:a.defaultValue}get lng(){return this.#X}set lng(t){this.#X="number"==typeof t?t:a.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=S.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#V=t[0],this.#X=t[1]):(this.#V=a.defaultValue,this.#X=a.defaultValue)}get objId(){return this.#t}get objType(){return H.#K}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.#t=T.nextObjId}}class R extends A{static#K=new w("ItineraryPoint",["lat","lng","distance","elev","objId"]);#V=a.defaultValue;#X=a.defaultValue;#Y=o.defaultValue;#G=i.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get lat(){return this.#V}set lat(t){this.#V="number"==typeof t?t:a.defaultValue}get lng(){return this.#X}set lng(t){this.#X="number"==typeof t?t:a.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.defaultValue}get elev(){return this.#G}set elev(t){this.#G="number"==typeof t?t:a.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#V=t[0],this.#X=t[1]):(this.#V=a.defaultValue,this.#X=a.defaultValue)}get objType(){return R.#K}get objId(){return this.#t}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),elev:parseFloat(this.elev.toFixed(i.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this.#t=T.nextObjId}}class k extends A{static#K=new w("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);#q="";#J="";#$=g;#Y=o.defaultValue;#Q=o.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get iconName(){return this.#q}set iconName(t){this.#q="string"==typeof t?D.sanitizeToJsString(t):""}get instruction(){return this.#J}set instruction(t){this.#J="string"==typeof t?D.sanitizeToJsString(t):""}get itineraryPointObjId(){return this.#$}set itineraryPointObjId(t){this.#$="number"==typeof t?t:g}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.defaultValue}get duration(){return this.#Q}set duration(t){this.#Q="number"==typeof t?t:o.defaultValue}get objType(){return k.#K}get objId(){return this.#t}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this.#t=T.nextObjId}}class B extends A{static#K=new w("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);#t=g;#tt=!1;#et=0;#ot=0;#it="";#nt="";#st=new x(R);#rt=new x(k);constructor(){super(),this.#t=T.nextObjId}get hasProfile(){return this.#tt}set hasProfile(t){this.#tt="boolean"==typeof t&&t}get ascent(){return this.#et}set ascent(t){this.#et="number"==typeof t?Number.parseInt(t):0}get descent(){return this.#ot}set descent(t){this.#ot="number"==typeof t?Number.parseInt(t):0}get provider(){return this.#it}set provider(t){this.#it="string"==typeof t?D.sanitizeToJsString(t):""}get transitMode(){return this.#nt}set transitMode(t){this.#nt="string"==typeof t?D.sanitizeToJsString(t):""}get itineraryPoints(){return this.#st}get maneuvers(){return this.#rt}get objType(){return B.#K}get objId(){return this.#t}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this.#t=T.nextObjId;const o=new Map;let i=0;const n=this.itineraryPoints.iterator;for(;!n.done;)o.set(e.itineraryPoints[i].objId,n.value.objId),i++;const s=this.maneuvers.iterator;for(;!s.done;)s.value.itineraryPointObjId=o.get(s.value.itineraryPointObjId)}}class z extends A{static#K=new w("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);#at=s.height;#lt=s.width;#ht="";#ct="";#dt="";#ut="";#p="";#W="";#mt=a.defaultValue;#pt=a.defaultValue;#V=a.defaultValue;#X=a.defaultValue;#Y=o.invalid;#gt=o.defaultValue;#t=g;constructor(){super(),this.#t=T.nextObjId}get iconHeight(){return this.#at}set iconHeight(t){this.#at="number"==typeof t?t:s.height}get iconWidth(){return this.#lt}set iconWidth(t){this.#lt="number"==typeof t?t:s.width}get iconContent(){return this.#ht}set iconContent(t){this.#ht="string"==typeof t?D.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this.#ct}set popupContent(t){this.#ct="string"==typeof t?D.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this.#dt}set tooltipContent(t){this.#dt="string"==typeof t?D.sanitizeToHtmlString(t).htmlString:""}get phone(){return this.#ut}set phone(t){this.#ut="string"==typeof t?D.sanitizeToHtmlString(t).htmlString:""}get url(){return this.#p}set url(t){this.#p="string"==typeof t?encodeURI(D.sanitizeToUrl(t).url):""}get address(){return this.#W}set address(t){this.#W="string"==typeof t?D.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this.#mt}set iconLat(t){this.#mt="number"==typeof t?t:a.defaultValue}get iconLng(){return this.#pt}set iconLng(t){this.#pt="number"==typeof t?t:a.defaultValue}get lat(){return this.#V}set lat(t){this.#V="number"==typeof t?t:a.defaultValue}get lng(){return this.#X}set lng(t){this.#X="number"==typeof t?t:a.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.invalid}get chainedDistance(){return this.#gt}set chainedDistance(t){this.#gt="number"==typeof t?t:o.defaultValue}get isRouteNote(){return this.#Y!==o.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#mt=t[0],this.#pt=t[1]):(this.#mt=a.defaultValue,this.#pt=a.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#V=t[0],this.#X=t[1]):(this.#V=a.defaultValue,this.#X=a.defaultValue)}get objType(){return z.#K}get objId(){return this.#t}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(a.fixed)),iconLng:parseFloat(this.iconLng.toFixed(a.fixed)),lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this.#t=T.nextObjId}}class F extends A{static#K=new w("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);#U="";#vt=new x(H);#ft=new x(z);#_t=new B;#yt=t.route.width;#Tt=t.route.color;#Lt=t.route.dashIndex;#bt=!0;#gt=o.defaultValue;#Y=o.defaultValue;#Q=o.defaultValue;#Et=l.notEdited;#wt=!1;#t=g;constructor(){super(),this.#vt.add(new H),this.#vt.add(new H),this.#t=T.nextObjId}get name(){return this.#U}set name(t){this.#U="string"==typeof t?D.sanitizeToJsString(t):""}get wayPoints(){return this.#vt}get notes(){return this.#ft}get itinerary(){return this.#_t}get width(){return this.#yt}set width(e){this.#yt="number"==typeof e?e:t.route.width}get color(){return this.#Tt}set color(e){this.#Tt="string"==typeof e&&D.sanitizeToColor(e)||t.route.color}get dashIndex(){return this.#Lt}set dashIndex(e){this.#Lt="number"==typeof e&&t.route.dashChoices[e]?e:0}get dashString(){let e="";return t.route.dashChoices[this.#Lt].iDashArray.forEach((t=>e+=String(t*this.#yt)+",")),e.substring(0,e.length-1)}get chain(){return this.#bt}set chain(t){this.#bt="boolean"==typeof t&&t}get chainedDistance(){return this.#gt}set chainedDistance(t){this.#gt="number"==typeof t?t:o.defaultValue}get distance(){return this.#Y}set distance(t){this.#Y="number"==typeof t?t:o.defaultValue}get duration(){return this.#Q}set duration(t){this.#Q="number"==typeof t?t:o.defaultValue}get editionStatus(){return this.#Et}set editionStatus(t){this.#Et="number"==typeof t?t:l.notEdited}get hidden(){return this.#wt}set hidden(t){this.#wt="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" â®ž "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this.#t}get objType(){return F.#K}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach((e=>{t=t&&a.defaultValue!==e.lat&&a.defaultValue!==e.lng})),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this.#t=T.nextObjId}}class Z extends A{static#K=new w("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);#Mt=new F;#xt=new x(F);#ft=new x(z);#It="OSM - Color";#U="";#Ct=!1;#t=g;constructor(){super(),this.#xt.add(new F),this.#t=T.nextObjId}get editedRoute(){return this.#Mt}set editedRoute(t){this.#Mt="Route"===t?.objType?.name?t:new F}get routes(){return this.#xt}get notes(){return this.#ft}get layerName(){return this.#It}set layerName(t){this.#It="string"==typeof t?D.sanitizeToJsString(t):"OSM - Color"}get name(){return this.#U}set name(t){this.#U="string"==typeof t?D.sanitizeToJsString(t):""}get readOnly(){return this.#Ct}set readOnly(t){this.#Ct="boolean"!=typeof t||t}get objId(){return this.#t}get objType(){return Z.#K}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this.#t=T.nextObjId}}class K{#it="";#nt="";constructor(){Object.freeze(this)}get provider(){return this.#it}set provider(t){this.#it="string"==typeof t?t:""}get transitMode(){return this.#nt}set transitMode(t){this.#nt="string"==typeof t?t:""}}const U=new class{#Nt;#Pt;#Dt;#Ot;#St;#jt;#At;#Ht;constructor(){Object.freeze(this),this.#Nt=new Map,this.#Pt=new Map,this.#Dt=new K,this.#Ot=S.UUID,this.#St=null,this.#jt=new Z,this.#At=g,this.#Ht=[]}get map(){return this.#St}set map(t){this.#St||(this.#St=t)}get travel(){return this.#jt}get editedRouteObjId(){return this.#At}set editedRouteObjId(t){this.#At="number"==typeof t?t:g}get searchData(){return this.#Ht}get providers(){return this.#Nt}get mapObjects(){return this.#Pt}get routing(){return this.#Dt}get UUID(){return this.#Ot}};class W{#Rt;#kt;constructor(t,e){Object.freeze(this),this.#Rt="string"==typeof t?t:"",this.#kt="string"==typeof e?e:""}get providerName(){return this.#Rt}get providerKey(){return this.#kt}get jsonObject(){return{providerName:this.providerName,providerKey:this.providerKey}}}const V=new class{#Bt(t,e){for(const o in e)try{if("dataset"===o){const o=e.dataset;for(const e in o)t.dataset["tan"+e]=o[e]}else t[o]=e[o]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){Object.freeze(this)}create(t,e,o){let i=null;return"text"===t.toLowerCase()?i=document.createTextNode(e.value||""):(i="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this.#Bt(i,e)),o&&o.appendChild(i),i}};class X{#zt;constructor(t){Object.freeze(this),this.#zt=t}handleEvent(){this.#zt.onCancel()}}class Y{#Ft;constructor(t){Object.freeze(this),this.#Ft=t}handleEvent(t){this.#Ft.keyboardELEnabled&&("Escape"===t.key||"Esc"===t.key?this.#Ft.onCancel():"Enter"===t.key&&this.#Ft.onOk())}}class G{#Ft;constructor(t){Object.freeze(this),this.#Ft=t}handleEvent(){this.#Ft.onOk()}}
/* @preserve
	 * Leaflet 1.9.2, a JS library for interactive maps. https://leafletjs.com
	 * (c) 2010-2022 Vladimir Agafonkin, (c) 2010-2011 CloudMade
	 */function q(t){var e,o,i,n;for(o=1,i=arguments.length;o<i;o++)for(e in n=arguments[o])t[e]=n[e];return t}var J=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function $(t,e){var o=Array.prototype.slice;if(t.bind)return t.bind.apply(t,o.call(arguments,1));var i=o.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(o.call(arguments)):arguments)}}var Q=0;function tt(t){return"_leaflet_id"in t||(t._leaflet_id=++Q),t._leaflet_id}function et(t,e,o){var i,n,s,r;return r=function(){i=!1,n&&(s.apply(o,n),n=!1)},s=function(){i?n=arguments:(t.apply(o,arguments),setTimeout(r,e),i=!0)},s}function ot(t,e,o){var i=e[1],n=e[0],s=i-n;return t===i&&o?t:((t-n)%s+s)%s+n}function it(){return!1}function nt(t,e){if(!1===e)return t;var o=Math.pow(10,void 0===e?6:e);return Math.round(t*o)/o}function st(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function rt(t){return st(t).split(/\s+/)}function at(t,e){for(var o in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?J(t.options):{}),e)t.options[o]=e[o];return t.options}function lt(t,e,o){var i=[];for(var n in t)i.push(encodeURIComponent(o?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}var ht=/\{ *([\w_ -]+) *\}/g;function ct(t,e){return t.replace(ht,(function(t,o){var i=e[o];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i}))}var dt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function ut(t,e){for(var o=0;o<t.length;o++)if(t[o]===e)return o;return-1}var mt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function pt(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var gt=0;function vt(t){var e=+new Date,o=Math.max(0,16-(e-gt));return gt=e+o,window.setTimeout(t,o)}var ft=window.requestAnimationFrame||pt("RequestAnimationFrame")||vt,_t=window.cancelAnimationFrame||pt("CancelAnimationFrame")||pt("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function yt(t,e,o){if(!o||ft!==vt)return ft.call(window,$(t,e));t.call(e)}function Tt(t){t&&_t.call(window,t)}var Lt={__proto__:null,extend:q,create:J,bind:$,get lastId(){return Q},stamp:tt,throttle:et,wrapNum:ot,falseFn:it,formatNum:nt,trim:st,splitWords:rt,setOptions:at,getParamString:lt,template:ct,isArray:dt,indexOf:ut,emptyImageUrl:mt,requestFn:ft,cancelFn:_t,requestAnimFrame:yt,cancelAnimFrame:Tt};function bt(){}bt.extend=function(t){var e=function(){at(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=e.__super__=this.prototype,i=J(o);for(var n in i.constructor=e,e.prototype=i,this)Object.prototype.hasOwnProperty.call(this,n)&&"prototype"!==n&&"__super__"!==n&&(e[n]=this[n]);return t.statics&&q(e,t.statics),t.includes&&(!function(t){if("undefined"==typeof L||!L||!L.Mixin)return;t=dt(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}(t.includes),q.apply(null,[i].concat(t.includes))),q(i,t),delete i.statics,delete i.includes,i.options&&(i.options=o.options?J(o.options):{},q(i.options,t.options)),i._initHooks=[],i.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=i._initHooks.length;t<e;t++)i._initHooks[t].call(this)}},e},bt.include=function(t){var e=this.prototype.options;return q(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},bt.mergeOptions=function(t){return q(this.prototype.options,t),this},bt.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),o="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};var Et={on:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else for(var n=0,s=(t=rt(t)).length;n<s;n++)this._on(t[n],e,o);return this},off:function(t,e,o){if(arguments.length)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=rt(t);for(var n=1===arguments.length,s=0,r=t.length;s<r;s++)n?this._off(t[s]):this._off(t[s],e,o)}else delete this._events;return this},_on:function(t,e,o,i){if("function"==typeof e){if(!1===this._listens(t,e,o)){o===this&&(o=void 0);var n={fn:e,ctx:o};i&&(n.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,o){var i,n,s;if(this._events&&(i=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var r=this._listens(t,e,o);if(!1!==r){var a=i[r];this._firingCount&&(a.fn=it,this._events[t]=i=i.slice()),i.splice(r,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(n=0,s=i.length;n<s;n++)i[n].fn=it;delete this._events[t]}},fire:function(t,e,o){if(!this.listens(t,o))return this;var i=q({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var n=this._events[t];if(n){this._firingCount=this._firingCount+1||1;for(var s=0,r=n.length;s<r;s++){var a=n[s],l=a.fn;a.once&&this.off(t,l,a.ctx),l.call(a.ctx||this,i)}this._firingCount--}}return o&&this._propagateEvent(i),this},listens:function(t,e,o,i){"string"!=typeof t&&console.warn('"string" type argument expected');var n=e;"function"!=typeof e&&(i=!!e,n=void 0,o=void 0);var s=this._events&&this._events[t];if(s&&s.length&&!1!==this._listens(t,n,o))return!0;if(i)for(var r in this._eventParents)if(this._eventParents[r].listens(t,e,o,i))return!0;return!1},_listens:function(t,e,o){if(!this._events)return!1;var i=this._events[t]||[];if(!e)return!!i.length;o===this&&(o=void 0);for(var n=0,s=i.length;n<s;n++)if(i[n].fn===e&&i[n].ctx===o)return n;return!1},once:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e,!0);else for(var n=0,s=(t=rt(t)).length;n<s;n++)this._on(t[n],e,o,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[tt(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[tt(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,q({layer:t.target,propagatedFrom:t.target},t),!0)}};Et.addEventListener=Et.on,Et.removeEventListener=Et.clearAllEventListeners=Et.off,Et.addOneTimeEventListener=Et.once,Et.fireEvent=Et.fire,Et.hasEventListeners=Et.listens;var wt=bt.extend(Et);function Mt(t,e,o){this.x=o?Math.round(t):t,this.y=o?Math.round(e):e}var xt=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function It(t,e,o){return t instanceof Mt?t:dt(t)?new Mt(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new Mt(t.x,t.y):new Mt(t,e,o)}function Ct(t,e){if(t)for(var o=e?[t,e]:t,i=0,n=o.length;i<n;i++)this.extend(o[i])}function Nt(t,e){return!t||t instanceof Ct?t:new Ct(t,e)}function Pt(t,e){if(t)for(var o=e?[t,e]:t,i=0,n=o.length;i<n;i++)this.extend(o[i])}function Dt(t,e){return t instanceof Pt?t:new Pt(t,e)}function Ot(t,e,o){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==o&&(this.alt=+o)}function St(t,e,o){return t instanceof Ot?t:dt(t)&&"object"!=typeof t[0]?3===t.length?new Ot(t[0],t[1],t[2]):2===t.length?new Ot(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new Ot(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new Ot(t,e,o)}Mt.prototype={clone:function(){return new Mt(this.x,this.y)},add:function(t){return this.clone()._add(It(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(It(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new Mt(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new Mt(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=xt(this.x),this.y=xt(this.y),this},distanceTo:function(t){var e=(t=It(t)).x-this.x,o=t.y-this.y;return Math.sqrt(e*e+o*o)},equals:function(t){return(t=It(t)).x===this.x&&t.y===this.y},contains:function(t){return t=It(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+nt(this.x)+", "+nt(this.y)+")"}},Ct.prototype={extend:function(t){var e,o;if(!t)return this;if(t instanceof Mt||"number"==typeof t[0]||"x"in t)e=o=It(t);else if(e=(t=Nt(t)).min,o=t.max,!e||!o)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)):(this.min=e.clone(),this.max=o.clone()),this},getCenter:function(t){return It((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return It(this.min.x,this.max.y)},getTopRight:function(){return It(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,o;return(t="number"==typeof t[0]||t instanceof Mt?It(t):Nt(t))instanceof Ct?(e=t.min,o=t.max):e=o=t,e.x>=this.min.x&&o.x<=this.max.x&&e.y>=this.min.y&&o.y<=this.max.y},intersects:function(t){t=Nt(t);var e=this.min,o=this.max,i=t.min,n=t.max,s=n.x>=e.x&&i.x<=o.x,r=n.y>=e.y&&i.y<=o.y;return s&&r},overlaps:function(t){t=Nt(t);var e=this.min,o=this.max,i=t.min,n=t.max,s=n.x>e.x&&i.x<o.x,r=n.y>e.y&&i.y<o.y;return s&&r},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,o=this.max,i=Math.abs(e.x-o.x)*t,n=Math.abs(e.y-o.y)*t;return Nt(It(e.x-i,e.y-n),It(o.x+i,o.y+n))},equals:function(t){return!!t&&(t=Nt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},Pt.prototype={extend:function(t){var e,o,i=this._southWest,n=this._northEast;if(t instanceof Ot)e=t,o=t;else{if(!(t instanceof Pt))return t?this.extend(St(t)||Dt(t)):this;if(e=t._southWest,o=t._northEast,!e||!o)return this}return i||n?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),n.lat=Math.max(o.lat,n.lat),n.lng=Math.max(o.lng,n.lng)):(this._southWest=new Ot(e.lat,e.lng),this._northEast=new Ot(o.lat,o.lng)),this},pad:function(t){var e=this._southWest,o=this._northEast,i=Math.abs(e.lat-o.lat)*t,n=Math.abs(e.lng-o.lng)*t;return new Pt(new Ot(e.lat-i,e.lng-n),new Ot(o.lat+i,o.lng+n))},getCenter:function(){return new Ot((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ot(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ot(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof Ot||"lat"in t?St(t):Dt(t);var e,o,i=this._southWest,n=this._northEast;return t instanceof Pt?(e=t.getSouthWest(),o=t.getNorthEast()):e=o=t,e.lat>=i.lat&&o.lat<=n.lat&&e.lng>=i.lng&&o.lng<=n.lng},intersects:function(t){t=Dt(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),n=t.getNorthEast(),s=n.lat>=e.lat&&i.lat<=o.lat,r=n.lng>=e.lng&&i.lng<=o.lng;return s&&r},overlaps:function(t){t=Dt(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),n=t.getNorthEast(),s=n.lat>e.lat&&i.lat<o.lat,r=n.lng>e.lng&&i.lng<o.lng;return s&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=Dt(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},Ot.prototype={equals:function(t,e){return!!t&&(t=St(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+nt(this.lat,t)+", "+nt(this.lng,t)+")"},distanceTo:function(t){return Ht.distance(this,St(t))},wrap:function(){return Ht.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,o=e/Math.cos(Math.PI/180*this.lat);return Dt([this.lat-e,this.lng-o],[this.lat+e,this.lng+o])},clone:function(){return new Ot(this.lat,this.lng,this.alt)}};var jt,At={latLngToPoint:function(t,e){var o=this.projection.project(t),i=this.scale(e);return this.transformation._transform(o,i)},pointToLatLng:function(t,e){var o=this.scale(e),i=this.transformation.untransform(t,o);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,o=this.scale(t);return new Ct(this.transformation.transform(e.min,o),this.transformation.transform(e.max,o))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?ot(t.lng,this.wrapLng,!0):t.lng;return new Ot(this.wrapLat?ot(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),o=this.wrapLatLng(e),i=e.lat-o.lat,n=e.lng-o.lng;if(0===i&&0===n)return t;var s=t.getSouthWest(),r=t.getNorthEast();return new Pt(new Ot(s.lat-i,s.lng-n),new Ot(r.lat-i,r.lng-n))}},Ht=q({},At,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var o=Math.PI/180,i=t.lat*o,n=e.lat*o,s=Math.sin((e.lat-t.lat)*o/2),r=Math.sin((e.lng-t.lng)*o/2),a=s*s+Math.cos(i)*Math.cos(n)*r*r,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),Rt=6378137,kt={R:Rt,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,o=this.MAX_LATITUDE,i=Math.max(Math.min(o,t.lat),-o),n=Math.sin(i*e);return new Mt(this.R*t.lng*e,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(t){var e=180/Math.PI;return new Ot((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(jt=Rt*Math.PI,new Ct([-jt,-jt],[jt,jt]))};function Bt(t,e,o,i){if(dt(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=o,this._d=i}function zt(t,e,o,i){return new Bt(t,e,o,i)}Bt.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new Mt((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Ft,Zt=q({},Ht,{code:"EPSG:3857",projection:kt,transformation:(Ft=.5/(Math.PI*kt.R),zt(Ft,.5,-Ft,.5))}),Kt=q({},Zt,{code:"EPSG:900913"});function Ut(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Wt(t,e){var o,i,n,s,r,a,l="";for(o=0,n=t.length;o<n;o++){for(i=0,s=(r=t[o]).length;i<s;i++)l+=(i?"L":"M")+(a=r[i]).x+" "+a.y;l+=e?Ne.svg?"z":"x":""}return l||"M0 0"}var Vt,Xt=document.documentElement.style,Yt="ActiveXObject"in window,Gt=Yt&&!document.addEventListener,qt="msLaunchUri"in navigator&&!("documentMode"in document),Jt=Ce("webkit"),$t=Ce("android"),Qt=Ce("android 2")||Ce("android 3"),te=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ee=$t&&Ce("Google")&&te<537&&!("AudioNode"in window),oe=!!window.opera,ie=!qt&&Ce("chrome"),ne=Ce("gecko")&&!Jt&&!oe&&!Yt,se=!ie&&Ce("safari"),re=Ce("phantom"),ae="OTransition"in Xt,le=0===navigator.platform.indexOf("Win"),he=Yt&&"transition"in Xt,ce="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Qt,de="MozPerspective"in Xt,ue=!window.L_DISABLE_3D&&(he||ce||de)&&!ae&&!re,me="undefined"!=typeof orientation||Ce("mobile"),pe=me&&Jt,ge=me&&ce,ve=!window.PointerEvent&&window.MSPointerEvent,fe=!(!window.PointerEvent&&!ve),_e="ontouchstart"in window||!!window.TouchEvent,ye=!window.L_NO_TOUCH&&(_e||fe),Te=me&&oe,Le=me&&ne,be=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ee=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",it,e),window.removeEventListener("testPassiveEventSupport",it,e)}catch(t){}return t}(),we=!!document.createElement("canvas").getContext,Me=!(!document.createElementNS||!Ut("svg").createSVGRect),xe=!!Me&&((Vt=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(Vt.firstChild&&Vt.firstChild.namespaceURI)),Ie=!Me&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function Ce(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Ne={ie:Yt,ielt9:Gt,edge:qt,webkit:Jt,android:$t,android23:Qt,androidStock:ee,opera:oe,chrome:ie,gecko:ne,safari:se,phantom:re,opera12:ae,win:le,ie3d:he,webkit3d:ce,gecko3d:de,any3d:ue,mobile:me,mobileWebkit:pe,mobileWebkit3d:ge,msPointer:ve,pointer:fe,touch:ye,touchNative:_e,mobileOpera:Te,mobileGecko:Le,retina:be,passiveEvents:Ee,canvas:we,svg:Me,vml:Ie,inlineSvg:xe,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Pe=Ne.msPointer?"MSPointerDown":"pointerdown",De=Ne.msPointer?"MSPointerMove":"pointermove",Oe=Ne.msPointer?"MSPointerUp":"pointerup",Se=Ne.msPointer?"MSPointerCancel":"pointercancel",je={touchstart:Pe,touchmove:De,touchend:Oe,touchcancel:Se},Ae={touchstart:function(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Po(e);Ze(t,e)},touchmove:Ze,touchend:Ze,touchcancel:Ze},He={},Re=!1;function ke(t,e,o){return"touchstart"===e&&(Re||(document.addEventListener(Pe,Be,!0),document.addEventListener(De,ze,!0),document.addEventListener(Oe,Fe,!0),document.addEventListener(Se,Fe,!0),Re=!0)),Ae[e]?(o=Ae[e].bind(this,o),t.addEventListener(je[e],o,!1),o):(console.warn("wrong event specified:",e),L.Util.falseFn)}function Be(t){He[t.pointerId]=t}function ze(t){He[t.pointerId]&&(He[t.pointerId]=t)}function Fe(t){delete He[t.pointerId]}function Ze(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var o in e.touches=[],He)e.touches.push(He[o]);e.changedTouches=[e],t(e)}}var Ke,Ue,We,Ve,Xe,Ye=ho(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ge=ho(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),qe="webkitTransition"===Ge||"OTransition"===Ge?Ge+"End":"transitionend";function Je(t,e){var o=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!o||"auto"===o)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);o=i?i[e]:null}return"auto"===o?null:o}function $e(t,e,o){var i=document.createElement(t);return i.className=e||"",o&&o.appendChild(i),i}function Qe(t){var e=t.parentNode;e&&e.removeChild(t)}function to(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function eo(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function oo(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function io(t,e){if(void 0!==t.classList)return t.classList.contains(e);var o=ao(t);return o.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(o)}function no(t,e){if(void 0!==t.classList)for(var o=rt(e),i=0,n=o.length;i<n;i++)t.classList.add(o[i]);else if(!io(t,e)){var s=ao(t);ro(t,(s?s+" ":"")+e)}}function so(t,e){void 0!==t.classList?t.classList.remove(e):ro(t,st((" "+ao(t)+" ").replace(" "+e+" "," ")))}function ro(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function ao(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function lo(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var o=!1,i="DXImageTransform.Microsoft.Alpha";try{o=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),o?(o.Enabled=100!==e,o.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}(t,e)}function ho(t){for(var e=document.documentElement.style,o=0;o<t.length;o++)if(t[o]in e)return t[o];return!1}function co(t,e,o){var i=e||new Mt(0,0);t.style[Ye]=(Ne.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(o?" scale("+o+")":"")}function uo(t,e){t._leaflet_pos=e,Ne.any3d?co(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function mo(t){return t._leaflet_pos||new Mt(0,0)}if("onselectstart"in document)Ke=function(){To(window,"selectstart",Po)},Ue=function(){bo(window,"selectstart",Po)};else{var po=ho(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ke=function(){if(po){var t=document.documentElement.style;We=t[po],t[po]="none"}},Ue=function(){po&&(document.documentElement.style[po]=We,We=void 0)}}function go(){To(window,"dragstart",Po)}function vo(){bo(window,"dragstart",Po)}function fo(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(_o(),Ve=t,Xe=t.style.outline,t.style.outline="none",To(window,"keydown",_o))}function _o(){Ve&&(Ve.style.outline=Xe,Ve=void 0,Xe=void 0,bo(window,"keydown",_o))}function yo(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}function To(t,e,o,i){if(e&&"object"==typeof e)for(var n in e)Mo(t,n,e[n],o);else for(var s=0,r=(e=rt(e)).length;s<r;s++)Mo(t,e[s],o,i);return this}var Lo="_leaflet_events";function bo(t,e,o,i){if(1===arguments.length)Eo(t),delete t[Lo];else if(e&&"object"==typeof e)for(var n in e)xo(t,n,e[n],o);else if(e=rt(e),2===arguments.length)Eo(t,(function(t){return-1!==ut(e,t)}));else for(var s=0,r=e.length;s<r;s++)xo(t,e[s],o,i);return this}function Eo(t,e){for(var o in t[Lo]){var i=o.split(/\d/)[0];e&&!e(i)||xo(t,i,null,null,o)}}var wo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Mo(t,e,o,i){var n=e+tt(o)+(i?"_"+tt(i):"");if(t[Lo]&&t[Lo][n])return this;var s=function(e){return o.call(i||t,e||window.event)},r=s;!Ne.touchNative&&Ne.pointer&&0===e.indexOf("touch")?s=ke(t,e,s):Ne.touch&&"dblclick"===e?s=function(t,e){t.addEventListener("dblclick",e);var o,i=0;function n(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var n=Oo(t);if(!n.some((function(t){return t instanceof HTMLLabelElement&&t.attributes.for}))||n.some((function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement}))){var s=Date.now();s-i<=200?2==++o&&e(function(t){var e,o,i={};for(o in t)e=t[o],i[o]=e&&e.bind?e.bind(t):e;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}(t)):o=1,i=s}}}else o=t.detail}return t.addEventListener("click",n),{dblclick:e,simDblclick:n}}(t,s):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(wo[e]||e,s,!!Ne.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||window.event,Ho(t,e)&&r(e)},t.addEventListener(wo[e],s,!1)):t.addEventListener(e,r,!1):t.attachEvent("on"+e,s),t[Lo]=t[Lo]||{},t[Lo][n]=s}function xo(t,e,o,i,n){n=n||e+tt(o)+(i?"_"+tt(i):"");var s=t[Lo]&&t[Lo][n];if(!s)return this;!Ne.touchNative&&Ne.pointer&&0===e.indexOf("touch")?function(t,e,o){je[e]?t.removeEventListener(je[e],o,!1):console.warn("wrong event specified:",e)}(t,e,s):Ne.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,s):"removeEventListener"in t?t.removeEventListener(wo[e]||e,s,!1):t.detachEvent("on"+e,s),t[Lo][n]=null}function Io(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Co(t){return Mo(t,"wheel",Io),this}function No(t){return To(t,"mousedown touchstart dblclick contextmenu",Io),t._leaflet_disable_click=!0,this}function Po(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Do(t){return Po(t),Io(t),this}function Oo(t){if(t.composedPath)return t.composedPath();for(var e=[],o=t.target;o;)e.push(o),o=o.parentNode;return e}function So(t,e){if(!e)return new Mt(t.clientX,t.clientY);var o=yo(e),i=o.boundingClientRect;return new Mt((t.clientX-i.left)/o.x-e.clientLeft,(t.clientY-i.top)/o.y-e.clientTop)}var jo=Ne.linux&&Ne.chrome?window.devicePixelRatio:Ne.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ao(t){return Ne.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/jo:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function Ho(t,e){var o=e.relatedTarget;if(!o)return!0;try{for(;o&&o!==t;)o=o.parentNode}catch(t){return!1}return o!==t}var Ro={__proto__:null,on:To,off:bo,stopPropagation:Io,disableScrollPropagation:Co,disableClickPropagation:No,preventDefault:Po,stop:Do,getPropagationPath:Oo,getMousePosition:So,getWheelDelta:Ao,isExternalTarget:Ho,addListener:To,removeListener:bo},ko=wt.extend({run:function(t,e,o,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=mo(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=yt(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,o=1e3*this._duration;e<o?this._runFrame(this._easeOut(e/o),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var o=this._startPos.add(this._offset.multiplyBy(t));e&&o._round(),uo(this._el,o),this.fire("step")},_complete:function(){Tt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Bo=wt.extend({options:{crs:Zt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=at(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=$(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(St(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ge&&Ne.any3d&&!Ne.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),To(this._proxy,qe,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,o){if((e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(St(t),e,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&!0!==o)&&(void 0!==o.animate&&(o.zoom=q({animate:o.animate},o.zoom),o.pan=q({animate:o.animate,duration:o.duration},o.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,o.zoom):this._tryAnimatedPan(t,o.pan)))return clearTimeout(this._sizeTimer),this;return this._resetView(t,e,o.pan&&o.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Ne.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,o){var i=this.getZoomScale(e),n=this.getSize().divideBy(2),s=(t instanceof Mt?t:this.latLngToContainerPoint(t)).subtract(n).multiplyBy(1-1/i),r=this.containerPointToLatLng(n.add(s));return this.setView(r,e,{zoom:o})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():Dt(t);var o=It(e.paddingTopLeft||e.padding||[0,0]),i=It(e.paddingBottomRight||e.padding||[0,0]),n=this.getBoundsZoom(t,!1,o.add(i));if((n="number"==typeof e.maxZoom?Math.min(e.maxZoom,n):n)===1/0)return{center:t.getCenter(),zoom:n};var s=i.subtract(o).divideBy(2),r=this.project(t.getSouthWest(),n),a=this.project(t.getNorthEast(),n);return{center:this.unproject(r.add(a).divideBy(2).add(s),n),zoom:n}},fitBounds:function(t,e){if(!(t=Dt(t)).isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(t,e);return this.setView(o.center,o.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=It(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ko,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){no(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,o,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,o){if(!1===(o=o||{}).animate||!Ne.any3d)return this.setView(t,e,o);this._stop();var i=this.project(this.getCenter()),n=this.project(t),s=this.getSize(),r=this._zoom;t=St(t),e=void 0===e?r:e;var a=Math.max(s.x,s.y),l=a*this.getZoomScale(r,e),h=n.distanceTo(i)||1,c=1.42,d=2.0164;function u(t){var e=(l*l-a*a+(t?-1:1)*d*d*h*h)/(2*(t?l:a)*d*h),o=Math.sqrt(e*e+1)-e;return o<1e-9?-18:Math.log(o)}function m(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}var g=u(0);function v(t){return a*(p(g)*(m(e=g+c*t)/p(e))-m(g))/d;var e}var f=Date.now(),_=(u(1)-g)/c,y=o.duration?1e3*o.duration:1e3*_*.8;return this._moveStart(!0,o.noMoveStart),function o(){var s=(Date.now()-f)/y,l=function(t){return 1-Math.pow(1-t,1.5)}(s)*_;s<=1?(this._flyToFrame=yt(o,this),this._move(this.unproject(i.add(n.subtract(i).multiplyBy(v(l)/h)),r),this.getScaleZoom(a/function(t){return a*(p(g)/p(g+c*t))}(l),r),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var o=this._getBoundsCenterZoom(t,e);return this.flyTo(o.center,o.zoom,e)},setMaxBounds:function(t){return t=Dt(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var o=this.getCenter(),i=this._limitCenter(o,this._zoom,Dt(t));return o.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){var o=It((e=e||{}).paddingTopLeft||e.padding||[0,0]),i=It(e.paddingBottomRight||e.padding||[0,0]),n=this.project(this.getCenter()),s=this.project(t),r=this.getPixelBounds(),a=Nt([r.min.add(o),r.max.subtract(i)]),l=a.getSize();if(!a.contains(s)){this._enforcingBounds=!0;var h=s.subtract(a.getCenter()),c=a.extend(s).getSize().subtract(l);n.x+=h.x<0?-c.x:c.x,n.y+=h.y<0?-c.y:c.y,this.panTo(this.unproject(n),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=q({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),i=e.divideBy(2).round(),n=o.divideBy(2).round(),s=i.subtract(n);return s.x||s.y?(t.animate&&t.pan?this.panBy(s):(t.pan&&this._rawPanBy(s),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout($(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:o})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=q({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=$(this._handleGeolocationResponse,this),o=$(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,o,t):navigator.geolocation.getCurrentPosition(e,o,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,o=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new Ot(t.coords.latitude,t.coords.longitude),o=e.toBounds(2*t.coords.accuracy),i=this._locateOptions;if(i.setView){var n=this.getBoundsZoom(o);this.setView(e,i.maxZoom?Math.min(n,i.maxZoom):n)}var s={latlng:e,bounds:o,timestamp:t.timestamp};for(var r in t.coords)"number"==typeof t.coords[r]&&(s[r]=t.coords[r]);this.fire("locationfound",s)}},addHandler:function(t,e){if(!e)return this;var o=this[t]=new e(this);return this._handlers.push(o),this.options[t]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),Qe(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Tt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)Qe(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var o=$e("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=o),o},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new Pt(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,o){t=Dt(t),o=It(o||[0,0]);var i=this.getZoom()||0,n=this.getMinZoom(),s=this.getMaxZoom(),r=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(o),h=Nt(this.project(a,i),this.project(r,i)).getSize(),c=Ne.any3d?this.options.zoomSnap:1,d=l.x/h.x,u=l.y/h.y,m=e?Math.max(d,u):Math.min(d,u);return i=this.getScaleZoom(m,i),c&&(i=Math.round(i/(c/100))*(c/100),i=e?Math.ceil(i/c)*c:Math.floor(i/c)*c),Math.max(n,Math.min(s,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new Mt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var o=this._getTopLeftPoint(t,e);return new Ct(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var o=this.options.crs;return e=void 0===e?this._zoom:e,o.scale(t)/o.scale(e)},getScaleZoom:function(t,e){var o=this.options.crs;e=void 0===e?this._zoom:e;var i=o.zoom(t*o.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(St(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(It(t),e)},layerPointToLatLng:function(t){var e=It(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(St(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(St(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(Dt(t))},distance:function(t,e){return this.options.crs.distance(St(t),St(e))},containerPointToLayerPoint:function(t){return It(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return It(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(It(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(St(t)))},mouseEventToContainerPoint:function(t){return So(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=function(t){return"string"==typeof t?document.getElementById(t):t}(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");To(e,"scroll",this._onScroll,this),this._containerId=tt(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ne.any3d,no(t,"leaflet-container"+(Ne.touch?" leaflet-touch":"")+(Ne.retina?" leaflet-retina":"")+(Ne.ielt9?" leaflet-oldie":"")+(Ne.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=Je(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),uo(this._mapPane,new Mt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(no(t.markerPane,"leaflet-zoom-hide"),no(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,o){uo(this._mapPane,new Mt(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,o)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,o,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?o&&o.pinch&&this.fire("zoom",o):((n||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Tt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){uo(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[tt(this._container)]=this;var e=t?bo:To;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Ne.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Tt(this._resizeRequest),this._resizeRequest=yt((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var o,i=[],n="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,r=!1;s;){if((o=this._targets[tt(s)])&&("click"===e||"preclick"===e)&&this._draggableMoved(o)){r=!0;break}if(o&&o.listens(e,!0)){if(n&&!Ho(s,t))break;if(i.push(o),n)break}if(s===this._container)break;s=s.parentNode}return i.length||r||n||!this.listens(e,!0)||(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var o=t.type;"mousedown"===o&&fo(e),this._fireDOMEvent(t,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,o){if("click"===t.type){var i=q({},t);i.type="preclick",this._fireDOMEvent(i,i.type,o)}var n=this._findEventTargets(t,e);if(o){for(var s=[],r=0;r<o.length;r++)o[r].listens(e,!0)&&s.push(o[r]);n=s.concat(n)}if(n.length){"contextmenu"===e&&Po(t);var a=n[0],l={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var h=a.getLatLng&&(!a._radius||a._radius<=10);l.containerPoint=h?this.latLngToContainerPoint(a.getLatLng()):this.mouseEventToContainerPoint(t),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=h?a.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(r=0;r<n.length;r++)if(n[r].fire(e,l,!0),l.originalEvent._stopped||!1===n[r].options.bubblingMouseEvents&&-1!==ut(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return mo(this._mapPane)||new Mt(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var o=this.getSize()._divideBy(2);return this.project(t,e)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return Nt([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,o){if(!o)return t;var i=this.project(t,e),n=this.getSize().divideBy(2),s=new Ct(i.subtract(n),i.add(n)),r=this._getBoundsOffset(s,o,e);return r.round().equals([0,0])?t:this.unproject(i.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var o=this.getPixelBounds(),i=new Ct(o.min.add(t),o.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,o){var i=Nt(this.project(e.getNorthEast(),o),this.project(e.getSouthWest(),o)),n=i.min.subtract(t.min),s=i.max.subtract(t.max);return new Mt(this._rebound(n.x,-s.x),this._rebound(n.y,-s.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),o=this.getMaxZoom(),i=Ne.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(o,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){so(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var o=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(o))&&(this.panBy(o,e),!0)},_createAnimProxy:function(){var t=this._proxy=$e("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",(function(t){var e=Ye,o=this._proxy.style[e];co(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),o===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Qe(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();co(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||!1===o.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==o.animate&&!this.getSize().contains(n))&&(yt((function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)}),this),!0)},_animateZoom:function(t,e,o,i){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,no(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout($(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&so(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}}),zo=bt.extend({options:{position:"topright"},initialize:function(t){at(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),o=this.getPosition(),i=t._controlCorners[o];return no(e,"leaflet-control"),-1!==o.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Qe(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}});Bo.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",o=this._controlContainer=$e("div",e+"control-container",this._container);function i(i,n){var s=e+i+" "+e+n;t[i+n]=$e("div",s,o)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)Qe(this._controlCorners[t]);Qe(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Fo=zo.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,o,i){return o<i?-1:i<o?1:0}},initialize:function(t,e,o){for(var i in at(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return zo.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(tt(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){no(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(no(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):so(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return so(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=$e("div",t),o=this.options.collapsed;e.setAttribute("aria-haspopup",!0),No(e),Co(e);var i=this._section=$e("section",t+"-list");o&&(this._map.on("click",this.collapse,this),To(e,{mouseenter:function(){To(i,"click",Po),this.expand(),setTimeout((function(){bo(i,"click",Po)}))},mouseleave:this.collapse},this));var n=this._layersLink=$e("a",t+"-toggle",e);n.href="#",n.title="Layers",n.setAttribute("role","button"),To(n,"click",Po),To(n,"focus",this.expand,this),o||this.expand(),this._baseLayersList=$e("div",t+"-base",i),this._separator=$e("div",t+"-separator",i),this._overlaysList=$e("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&tt(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,o){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:o}),this.options.sortLayers&&this._layers.sort($((function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)}),this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;to(this._baseLayersList),to(this._overlaysList),this._layerControlInputs=[];var t,e,o,i,n=0;for(o=0;o<this._layers.length;o++)i=this._layers[o],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,n+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&n>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(tt(t.target)),o=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;o&&this._map.fire(o,e)},_createRadioElement:function(t,e){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=o,i.firstChild},_addItem:function(t){var e,o=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers_"+tt(this),i),this._layerControlInputs.push(e),e.layerId=tt(t.layer),To(e,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var s=document.createElement("span");return o.appendChild(s),s.appendChild(e),s.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(o),this._checkDisabledLayers(),o},_onInputClick:function(){var t,e,o=this._layerControlInputs,i=[],n=[];this._handlingClick=!0;for(var s=o.length-1;s>=0;s--)t=o[s],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||n.push(e);for(s=0;s<n.length;s++)this._map.hasLayer(n[s])&&this._map.removeLayer(n[s]);for(s=0;s<i.length;s++)this._map.hasLayer(i[s])||this._map.addLayer(i[s]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,o=this._layerControlInputs,i=this._map.getZoom(),n=o.length-1;n>=0;n--)t=o[n],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this}}),Zo=zo.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",o=$e("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",o,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,o,i,n){var s=$e("a",o,i);return s.innerHTML=t,s.href="#",s.title=e,s.setAttribute("role","button"),s.setAttribute("aria-label",e),No(s),To(s,"click",Do),To(s,"click",n,this),To(s,"click",this._refocusOnMap,this),s},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";so(this._zoomInButton,e),so(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(no(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(no(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});Bo.mergeOptions({zoomControl:!0}),Bo.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new Zo,this.addControl(this.zoomControl))}));var Ko=zo.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",o=$e("div",e),i=this.options;return this._addScales(i,e+"-line",o),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),o},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,o){t.metric&&(this._mScale=$e("div",e,o)),t.imperial&&(this._iScale=$e("div",e,o))},_update:function(){var t=this._map,e=t.getSize().y/2,o=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(o)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),o=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,o,e/t)},_updateImperial:function(t){var e,o,i,n=3.2808399*t;n>5280?(e=n/5280,o=this._getRoundNum(e),this._updateScale(this._iScale,o+" mi",o/e)):(i=this._getRoundNum(n),this._updateScale(this._iScale,i+" ft",i/n))},_updateScale:function(t,e,o){t.style.width=Math.round(this.options.maxWidth*o)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),o=t/e;return e*(o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1)}}),Uo=zo.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ne.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(t){at(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=$e("div","leaflet-control-attribution"),No(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",(function(){this.removeAttribution(t.layer.getAttribution())}),this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var o=[];this.options.prefix&&o.push(this.options.prefix),t.length&&o.push(t.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});Bo.mergeOptions({attributionControl:!0}),Bo.addInitHook((function(){this.options.attributionControl&&(new Uo).addTo(this)})),zo.Layers=Fo,zo.Zoom=Zo,zo.Scale=Ko,zo.Attribution=Uo;var Wo=bt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Wo.addTo=function(t,e){return t.addHandler(e,this),this};var Vo,Xo=Ne.touch?"touchstart mousedown":"mousedown",Yo=wt.extend({options:{clickTolerance:3},initialize:function(t,e,o,i){at(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=o},enable:function(){this._enabled||(To(this._dragStartTarget,Xo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Yo._dragging===this&&this.finishDrag(!0),bo(this._dragStartTarget,Xo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!io(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)Yo._dragging===this&&this.finishDrag();else if(!(Yo._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(Yo._dragging=this,this._preventOutline&&fo(this._element),go(),Ke(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,o=function(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}(this._element);this._startPoint=new Mt(e.clientX,e.clientY),this._startPos=mo(this._element),this._parentScale=yo(o);var i="mousedown"===t.type;To(document,i?"mousemove":"touchmove",this._onMove,this),To(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,o=new Mt(e.clientX,e.clientY)._subtract(this._startPoint);(o.x||o.y)&&(Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,Po(t),this._moved||(this.fire("dragstart"),this._moved=!0,no(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),no(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),uo(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){so(document.body,"leaflet-dragging"),this._lastTarget&&(so(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),bo(document,"mousemove touchmove",this._onMove,this),bo(document,"mouseup touchend touchcancel",this._onUp,this),vo(),Ue(),this._moved&&this._moving&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,Yo._dragging=!1}});function Go(t,e){if(!e||!t.length)return t.slice();var o=e*e;return t=function(t,e){for(var o=[t[0]],i=1,n=0,s=t.length;i<s;i++)ei(t[i],t[n])>e&&(o.push(t[i]),n=i);n<s-1&&o.push(t[s-1]);return o}(t,o),t=function(t,e){var o=t.length,i=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(o);i[0]=i[o-1]=1,Jo(t,i,e,0,o-1);var n,s=[];for(n=0;n<o;n++)i[n]&&s.push(t[n]);return s}(t,o),t}function qo(t,e,o){return Math.sqrt(oi(t,e,o,!0))}function Jo(t,e,o,i,n){var s,r,a,l=0;for(r=i+1;r<=n-1;r++)(a=oi(t[r],t[i],t[n],!0))>l&&(s=r,l=a);l>o&&(e[s]=1,Jo(t,e,o,i,s),Jo(t,e,o,s,n))}function $o(t,e,o,i,n){var s,r,a,l=i?Vo:ti(t,o),h=ti(e,o);for(Vo=h;;){if(!(l|h))return[t,e];if(l&h)return!1;a=ti(r=Qo(t,e,s=l||h,o,n),o),s===l?(t=r,l=a):(e=r,h=a)}}function Qo(t,e,o,i,n){var s,r,a=e.x-t.x,l=e.y-t.y,h=i.min,c=i.max;return 8&o?(s=t.x+a*(c.y-t.y)/l,r=c.y):4&o?(s=t.x+a*(h.y-t.y)/l,r=h.y):2&o?(s=c.x,r=t.y+l*(c.x-t.x)/a):1&o&&(s=h.x,r=t.y+l*(h.x-t.x)/a),new Mt(s,r,n)}function ti(t,e){var o=0;return t.x<e.min.x?o|=1:t.x>e.max.x&&(o|=2),t.y<e.min.y?o|=4:t.y>e.max.y&&(o|=8),o}function ei(t,e){var o=e.x-t.x,i=e.y-t.y;return o*o+i*i}function oi(t,e,o,i){var n,s=e.x,r=e.y,a=o.x-s,l=o.y-r,h=a*a+l*l;return h>0&&((n=((t.x-s)*a+(t.y-r)*l)/h)>1?(s=o.x,r=o.y):n>0&&(s+=a*n,r+=l*n)),a=t.x-s,l=t.y-r,i?a*a+l*l:new Mt(s,r)}function ii(t){return!dt(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function ni(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ii(t)}function si(t,e){var o,i,n,s,r,a,l,h;if(!t||0===t.length)throw new Error("latlngs not passed");ii(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var c=[];for(var d in t)c.push(e.project(St(t[d])));var u=c.length;for(o=0,i=0;o<u-1;o++)i+=c[o].distanceTo(c[o+1])/2;if(0===i)h=c[0];else for(o=0,s=0;o<u-1;o++)if(r=c[o],a=c[o+1],(s+=n=r.distanceTo(a))>i){l=(s-i)/n,h=[a.x-l*(a.x-r.x),a.y-l*(a.y-r.y)];break}return e.unproject(It(h))}var ri={__proto__:null,simplify:Go,pointToSegmentDistance:qo,closestPointOnSegment:function(t,e,o){return oi(t,e,o)},clipSegment:$o,_getEdgeIntersection:Qo,_getBitCode:ti,_sqClosestPointOnSegment:oi,isFlat:ii,_flat:ni,polylineCenter:si};function ai(t,e,o){var i,n,s,r,a,l,h,c,d,u=[1,4,2,8];for(n=0,h=t.length;n<h;n++)t[n]._code=ti(t[n],e);for(r=0;r<4;r++){for(c=u[r],i=[],n=0,s=(h=t.length)-1;n<h;s=n++)a=t[n],l=t[s],a._code&c?l._code&c||((d=Qo(l,a,c,e,o))._code=ti(d,e),i.push(d)):(l._code&c&&((d=Qo(l,a,c,e,o))._code=ti(d,e),i.push(d)),i.push(a));t=i}return t}var li={project:function(t){return new Mt(t.lng,t.lat)},unproject:function(t){return new Ot(t.y,t.x)},bounds:new Ct([-180,-90],[180,90])},hi={R:6378137,R_MINOR:6356752.314245179,bounds:new Ct([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,o=this.R,i=t.lat*e,n=this.R_MINOR/o,s=Math.sqrt(1-n*n),r=s*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-r)/(1+r),s/2);return i=-o*Math.log(Math.max(a,1e-10)),new Mt(t.lng*e*o,i)},unproject:function(t){for(var e,o=180/Math.PI,i=this.R,n=this.R_MINOR/i,s=Math.sqrt(1-n*n),r=Math.exp(-t.y/i),a=Math.PI/2-2*Math.atan(r),l=0,h=.1;l<15&&Math.abs(h)>1e-7;l++)e=s*Math.sin(a),e=Math.pow((1-e)/(1+e),s/2),a+=h=Math.PI/2-2*Math.atan(r*e)-a;return new Ot(a*o,t.x*o/i)}},ci={__proto__:null,LonLat:li,Mercator:hi,SphericalMercator:kt},di=q({},Ht,{code:"EPSG:3395",projection:hi,transformation:function(){var t=.5/(Math.PI*hi.R);return zt(t,.5,-t,.5)}()}),ui=q({},Ht,{code:"EPSG:4326",projection:li,transformation:zt(1/180,1,-1/180,.5)}),mi=q({},At,{projection:li,transformation:zt(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var o=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(o*o+i*i)},infinite:!0});At.Earth=Ht,At.EPSG3395=di,At.EPSG3857=Zt,At.EPSG900913=Kt,At.EPSG4326=ui,At.Simple=mi;var pi=wt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[tt(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[tt(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var o=this.getEvents();e.on(o,this),this.once("remove",(function(){e.off(o,this)}),this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});Bo.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=tt(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=tt(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return tt(t)in this._layers},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},_addLayers:function(t){for(var e=0,o=(t=t?dt(t)?t:[t]:[]).length;e<o;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[tt(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=tt(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,o=this._getZoomSpan();for(var i in this._zoomBoundLayers){var n=this._zoomBoundLayers[i].options;t=void 0===n.minZoom?t:Math.min(t,n.minZoom),e=void 0===n.maxZoom?e:Math.max(e,n.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var gi=pi.extend({initialize:function(t,e){var o,i;if(at(this,e),this._layers={},t)for(o=0,i=t.length;o<i;o++)this.addLayer(t[o])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,o,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)(o=this._layers[e])[t]&&o[t].apply(o,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return tt(t)}}),vi=gi.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),gi.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),gi.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new Pt;for(var e in this._layers){var o=this._layers[e];t.extend(o.getBounds?o.getBounds():o.getLatLng())}return t}}),fi=bt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){at(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var o=this._getIconUrl(t);if(!o){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(o,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(t,e){var o=this.options,i=o[e+"Size"];"number"==typeof i&&(i=[i,i]);var n=It(i),s=It("shadow"===e&&o.shadowAnchor||o.iconAnchor||n&&n.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(o.className||""),s&&(t.style.marginLeft=-s.x+"px",t.style.marginTop=-s.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Ne.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),_i=fi.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof _i.imagePath&&(_i.imagePath=this._detectIconPath()),(this.options.imagePath||_i.imagePath)+fi.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,o){var i=e.exec(t);return i&&i[o]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=$e("div","leaflet-default-icon-path",document.body),e=Je(t,"background-image")||Je(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-"leaflet.css".length-1):""}}),yi=Wo.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new Yo(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),no(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&so(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,o=e._map,i=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,s=mo(e._icon),r=o.getPixelBounds(),a=o.getPixelOrigin(),l=Nt(r.min._subtract(a).add(n),r.max._subtract(a).subtract(n));if(!l.contains(s)){var h=It((Math.max(l.max.x,s.x)-l.max.x)/(r.max.x-l.max.x)-(Math.min(l.min.x,s.x)-l.min.x)/(r.min.x-l.min.x),(Math.max(l.max.y,s.y)-l.max.y)/(r.max.y-l.max.y)-(Math.min(l.min.y,s.y)-l.min.y)/(r.min.y-l.min.y)).multiplyBy(i);o.panBy(h,{animate:!1}),this._draggable._newPos._add(h),this._draggable._startPos._add(h),uo(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=yt(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(Tt(this._panRequest),this._panRequest=yt(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,o=e._shadow,i=mo(e._icon),n=e._map.layerPointToLatLng(i);o&&uo(o,i),e._latlng=n,t.latlng=n,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){Tt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Ti=pi.extend({options:{icon:new _i,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){at(this,e),this._latlng=St(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=St(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=t.icon.createIcon(this._icon),i=!1;o!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(o.title=t.title),"IMG"===o.tagName&&(o.alt=t.alt||"")),no(o,e),t.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&To(o,"focus",this._panOnFocus,this);var n=t.icon.createShadow(this._shadow),s=!1;n!==this._shadow&&(this._removeShadow(),s=!0),n&&(no(n,e),n.alt=""),this._shadow=n,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&s&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&bo(this._icon,"focus",this._panOnFocus,this),Qe(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Qe(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&uo(this._icon,t),this._shadow&&uo(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(no(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),yi)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new yi(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&lo(this._icon,t),this._shadow&&lo(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,o=e.iconSize?It(e.iconSize):It(0,0),i=e.iconAnchor?It(e.iconAnchor):It(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:o.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Li=pi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return at(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),bi=Li.extend({options:{fill:!0,radius:10},initialize:function(t,e){at(this,e),this._latlng=St(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=St(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Li.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,o=this._clickTolerance(),i=[t+o,e+o];this._pxBounds=new Ct(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Ei=bi.extend({initialize:function(t,e,o){if("number"==typeof e&&(e=q({},o,{radius:e})),at(this,e),this._latlng=St(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new Pt(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Li.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,o=this._map,i=o.options.crs;if(i.distance===Ht.distance){var n=Math.PI/180,s=this._mRadius/Ht.R/n,r=o.project([e+s,t]),a=o.project([e-s,t]),l=r.add(a).divideBy(2),h=o.unproject(l).lat,c=Math.acos((Math.cos(s*n)-Math.sin(e*n)*Math.sin(h*n))/(Math.cos(e*n)*Math.cos(h*n)))/n;(isNaN(c)||0===c)&&(c=s/Math.cos(Math.PI/180*e)),this._point=l.subtract(o.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-o.project([h,t-c]).x,this._radiusY=l.y-r.y}else{var d=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(d).x}this._updateBounds()}}),wi=Li.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){at(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,o,i=1/0,n=null,s=oi,r=0,a=this._parts.length;r<a;r++)for(var l=this._parts[r],h=1,c=l.length;h<c;h++){var d=s(t,e=l[h-1],o=l[h],!0);d<i&&(i=d,n=s(t,e,o))}return n&&(n.distance=Math.sqrt(i)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return si(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=St(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new Pt,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return ii(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],o=ii(t),i=0,n=t.length;i<n;i++)o?(e[i]=St(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new Ct;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new Mt(t,t);this._rawPxBounds&&(this._pxBounds=new Ct([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,o){var i,n,s=t[0]instanceof Ot,r=t.length;if(s){for(n=[],i=0;i<r;i++)n[i]=this._map.latLngToLayerPoint(t[i]),o.extend(n[i]);e.push(n)}else for(i=0;i<r;i++)this._projectLatlngs(t[i],e,o)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,o,i,n,s,r,a,l=this._parts;for(e=0,i=0,n=this._rings.length;e<n;e++)for(o=0,s=(a=this._rings[e]).length;o<s-1;o++)(r=$o(a[o],a[o+1],t,o,!0))&&(l[i]=l[i]||[],l[i].push(r[0]),r[1]===a[o+1]&&o!==s-2||(l[i].push(r[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,o=0,i=t.length;o<i;o++)t[o]=Go(t[o],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var o,i,n,s,r,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,s=this._parts.length;o<s;o++)for(i=0,n=(r=(a=this._parts[o]).length)-1;i<r;n=i++)if((e||0!==i)&&qo(t,a[n],a[i])<=l)return!0;return!1}});wi._flat=ni;var Mi=wi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return function(t,e){var o,i,n,s,r,a,l,h,c;if(!t||0===t.length)throw new Error("latlngs not passed");ii(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var d=[];for(var u in t)d.push(e.project(St(t[u])));var m=d.length;for(a=l=h=0,o=0,i=m-1;o<m;i=o++)n=d[o],s=d[i],r=n.y*s.x-s.y*n.x,l+=(n.x+s.x)*r,h+=(n.y+s.y)*r,a+=3*r;return c=0===a?d[0]:[l/a,h/a],e.unproject(It(c))}(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=wi.prototype._convertLatLngs.call(this,t),o=e.length;return o>=2&&e[0]instanceof Ot&&e[0].equals(e[o-1])&&e.pop(),e},_setLatLngs:function(t){wi.prototype._setLatLngs.call(this,t),ii(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ii(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,o=new Mt(e,e);if(t=new Ct(t.min.subtract(o),t.max.add(o)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,n=0,s=this._rings.length;n<s;n++)(i=ai(this._rings[n],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,o,i,n,s,r,a,l,h=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,a=this._parts.length;n<a;n++)for(s=0,r=(l=(e=this._parts[n]).length)-1;s<l;r=s++)o=e[s],i=e[r],o.y>t.y!=i.y>t.y&&t.x<(i.x-o.x)*(t.y-o.y)/(i.y-o.y)+o.x&&(h=!h);return h||wi.prototype._containsPoint.call(this,t,!0)}}),xi=vi.extend({initialize:function(t,e){at(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,o,i,n=dt(t)?t:t.features;if(n){for(e=0,o=n.length;e<o;e++)((i=n[e]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var s=this.options;if(s.filter&&!s.filter(t))return this;var r=Ii(t,s);return r?(r.feature=ji(t),r.defaultOptions=r.options,this.resetStyle(r),s.onEachFeature&&s.onEachFeature(t,r),this.addLayer(r)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=q({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer((function(e){this._setLayerStyle(e,t)}),this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function Ii(t,e){var o,i,n,s,r="Feature"===t.type?t.geometry:t,a=r?r.coordinates:null,l=[],h=e&&e.pointToLayer,c=e&&e.coordsToLatLng||Ni;if(!a&&!r)return null;switch(r.type){case"Point":return Ci(h,t,o=c(a),e);case"MultiPoint":for(n=0,s=a.length;n<s;n++)o=c(a[n]),l.push(Ci(h,t,o,e));return new vi(l);case"LineString":case"MultiLineString":return i=Pi(a,"LineString"===r.type?0:1,c),new wi(i,e);case"Polygon":case"MultiPolygon":return i=Pi(a,"Polygon"===r.type?1:2,c),new Mi(i,e);case"GeometryCollection":for(n=0,s=r.geometries.length;n<s;n++){var d=Ii({geometry:r.geometries[n],type:"Feature",properties:t.properties},e);d&&l.push(d)}return new vi(l);case"FeatureCollection":for(n=0,s=r.features.length;n<s;n++){var u=Ii(r.features[n],e);u&&l.push(u)}return new vi(l);default:throw new Error("Invalid GeoJSON object.")}}function Ci(t,e,o,i){return t?t(e,o):new Ti(o,i&&i.markersInheritOptions&&i)}function Ni(t){return new Ot(t[1],t[0],t[2])}function Pi(t,e,o){for(var i,n=[],s=0,r=t.length;s<r;s++)i=e?Pi(t[s],e-1,o):(o||Ni)(t[s]),n.push(i);return n}function Di(t,e){return void 0!==(t=St(t)).alt?[nt(t.lng,e),nt(t.lat,e),nt(t.alt,e)]:[nt(t.lng,e),nt(t.lat,e)]}function Oi(t,e,o,i){for(var n=[],s=0,r=t.length;s<r;s++)n.push(e?Oi(t[s],ii(t[s])?0:e-1,o,i):Di(t[s],i));return!e&&o&&n.push(n[0]),n}function Si(t,e){return t.feature?q({},t.feature,{geometry:e}):ji(e)}function ji(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Ai={toGeoJSON:function(t){return Si(this,{type:"Point",coordinates:Di(this.getLatLng(),t)})}};Ti.include(Ai),Ei.include(Ai),bi.include(Ai),wi.include({toGeoJSON:function(t){var e=!ii(this._latlngs);return Si(this,{type:(e?"Multi":"")+"LineString",coordinates:Oi(this._latlngs,e?1:0,!1,t)})}}),Mi.include({toGeoJSON:function(t){var e=!ii(this._latlngs),o=e&&!ii(this._latlngs[0]),i=Oi(this._latlngs,o?2:e?1:0,!0,t);return e||(i=[i]),Si(this,{type:(o?"Multi":"")+"Polygon",coordinates:i})}}),gi.include({toMultiPoint:function(t){var e=[];return this.eachLayer((function(o){e.push(o.toGeoJSON(t).geometry.coordinates)})),Si(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var o="GeometryCollection"===e,i=[];return this.eachLayer((function(e){if(e.toGeoJSON){var n=e.toGeoJSON(t);if(o)i.push(n.geometry);else{var s=ji(n);"FeatureCollection"===s.type?i.push.apply(i,s.features):i.push(s)}}})),o?Si(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Hi=pi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,o){this._url=t,this._bounds=Dt(e),at(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(no(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Qe(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&eo(this._image),this},bringToBack:function(){return this._map&&oo(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=Dt(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:$e("img");no(e,"leaflet-image-layer"),this._zoomAnimated&&no(e,"leaflet-zoom-animated"),this.options.className&&no(e,this.options.className),e.onselectstart=it,e.onmousemove=it,e.onload=$(this.fire,this,"load"),e.onerror=$(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;co(this._image,o,e)},_reset:function(){var t=this._image,e=new Ct(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=e.getSize();uo(t,e.min),t.style.width=o.x+"px",t.style.height=o.y+"px"},_updateOpacity:function(){lo(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}});Hi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:$e("video");if(no(e,"leaflet-image-layer"),this._zoomAnimated&&no(e,"leaflet-zoom-animated"),this.options.className&&no(e,this.options.className),e.onselectstart=it,e.onmousemove=it,e.onloadeddata=$(this.fire,this,"load"),t){for(var o=e.getElementsByTagName("source"),i=[],n=0;n<o.length;n++)i.push(o[n].src);this._url=o.length>0?i:[e.src]}else{dt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var s=0;s<this._url.length;s++){var r=$e("source");r.src=this._url[s],e.appendChild(r)}}}}),Hi.extend({_initImage:function(){var t=this._image=this._url;no(t,"leaflet-image-layer"),this._zoomAnimated&&no(t,"leaflet-zoom-animated"),this.options.className&&no(t,this.options.className),t.onselectstart=it,t.onmousemove=it}});var Ri=pi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof Ot||dt(t))?(this._latlng=St(t),at(this,e)):(at(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&lo(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&lo(this._container,1),this.bringToFront(),this.options.interactive&&(no(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(lo(this._container,0),this._removeTimeout=setTimeout($(Qe,void 0,this._container),200)):Qe(this._container),this.options.interactive&&(so(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=St(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&eo(this._container),this},bringToBack:function(){return this._map&&oo(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof vi){e=null;var o=this._source._layers;for(var i in o)if(o[i]._map){e=o[i];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=It(this.options.offset),o=this._getAnchor();this._zoomAnimated?uo(this._container,t.add(o)):e=e.add(t).add(o);var i=this._containerBottom=-e.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});Bo.include({_initOverlay:function(t,e,o,i){var n=e;return n instanceof t||(n=new t(i).setContent(e)),o&&n.setLatLng(o),n}}),pi.include({_initOverlay:function(t,e,o,i){var n=o;return n instanceof t?(at(n,i),n._source=this):(n=e&&!i?e:new t(i,this)).setContent(o),n}});var ki=Ri.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Ri.prototype.openOn.call(this,t)},onAdd:function(t){Ri.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Li||this._source.on("preclick",Io))},onRemove:function(t){Ri.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Li||this._source.off("preclick",Io))},getEvents:function(){var t=Ri.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=$e("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=$e("div",t+"-content-wrapper",e);if(this._contentNode=$e("div",t+"-content",o),No(e),Co(this._contentNode),To(e,"contextmenu",Io),this._tipContainer=$e("div",t+"-tip-container",e),this._tip=$e("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=$e("a",t+"-close-button",e);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',To(i,"click",(function(t){Po(t),this.close()}),this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var o=t.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),e.width=o+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,n=this.options.maxHeight,s="leaflet-popup-scrolled";n&&i>n?(e.height=n+"px",no(t,s)):so(t,s),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();uo(this._container,e.add(o))},_adjustPan:function(t){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var e=this._map,o=parseInt(Je(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+o,n=this._containerWidth,s=new Mt(this._containerLeft,-i-this._containerBottom);s._add(mo(this._container));var r=e.layerPointToContainerPoint(s),a=It(this.options.autoPanPadding),l=It(this.options.autoPanPaddingTopLeft||a),h=It(this.options.autoPanPaddingBottomRight||a),c=e.getSize(),d=0,u=0;r.x+n+h.x>c.x&&(d=r.x+n-c.x+h.x),r.x-d-l.x<0&&(d=r.x-l.x),r.y+i+h.y>c.y&&(u=r.y+i-c.y+h.y),r.y-u-l.y<0&&(u=r.y-l.y),(d||u)&&e.fire("autopanstart").panBy([d,u],{animate:t&&"moveend"===t.type})}},_getAnchor:function(){return It(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Bo.mergeOptions({closePopupOnClick:!0}),Bo.include({openPopup:function(t,e,o){return this._initOverlay(ki,t,e,o).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),pi.include({bindPopup:function(t,e){return this._popup=this._initOverlay(ki,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Do(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof Li?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Bi=Ri.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Ri.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Ri.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Ri.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=$e("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+tt(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,o,i=this._map,n=this._container,s=i.latLngToContainerPoint(i.getCenter()),r=i.layerPointToContainerPoint(t),a=this.options.direction,l=n.offsetWidth,h=n.offsetHeight,c=It(this.options.offset),d=this._getAnchor();"top"===a?(e=l/2,o=h):"bottom"===a?(e=l/2,o=0):"center"===a?(e=l/2,o=h/2):"right"===a?(e=0,o=h/2):"left"===a?(e=l,o=h/2):r.x<s.x?(a="right",e=0,o=h/2):(a="left",e=l+2*(c.x+d.x),o=h/2),t=t.subtract(It(e,o,!0)).add(c).add(d),so(n,"leaflet-tooltip-right"),so(n,"leaflet-tooltip-left"),so(n,"leaflet-tooltip-top"),so(n,"leaflet-tooltip-bottom"),no(n,"leaflet-tooltip-"+a),uo(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&lo(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return It(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Bo.include({openTooltip:function(t,e,o){return this._initOverlay(Bi,t,e,o).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),pi.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Bi,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[e](o),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e=t.getElement();e&&(To(e,"focus",(function(){this._tooltip._source=t,this.openTooltip()}),this),To(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e=t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0))},_moveTooltip:function(t){var e,o,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),o=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(o)),this._tooltip.setLatLng(i)}});var zi=fi.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),o=this.options;if(o.html instanceof Element?(to(e),e.appendChild(o.html)):e.innerHTML=!1!==o.html?o.html:"",o.bgPos){var i=It(o.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});fi.Default=_i;var Fi=pi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ne.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){at(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),Qe(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(eo(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(oo(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=et(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof Mt?t:new Mt(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,o=this.getPane().children,i=-t(-1/0,1/0),n=0,s=o.length;n<s;n++)e=o[n].style.zIndex,o[n]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ne.ielt9){lo(this._container,this.options.opacity);var t=+new Date,e=!1,o=!1;for(var i in this._tiles){var n=this._tiles[i];if(n.current&&n.loaded){var s=Math.min(1,(t-n.loaded)/200);lo(n.el,s),s<1?e=!0:(n.active?o=!0:this._onOpaqueTile(n),n.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),e&&(Tt(this._fadeFrame),this._fadeFrame=yt(this._updateOpacity,this))}},_onOpaqueTile:it,_initContainer:function(){this._container||(this._container=$e("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===t?(this._levels[o].el.style.zIndex=e-Math.abs(t-o),this._onUpdateLevel(o)):(Qe(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var i=this._levels[t],n=this._map;return i||((i=this._levels[t]={}).el=$e("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=n.project(n.unproject(n.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,n.getCenter(),n.getZoom()),i.el.offsetWidth,this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:it,_onRemoveLevel:it,_onCreateLevel:it,_pruneTiles:function(){if(this._map){var t,e,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)Qe(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,o,i){var n=Math.floor(t/2),s=Math.floor(e/2),r=o-1,a=new Mt(+n,+s);a.z=+r;var l=this._tileCoordsToKey(a),h=this._tiles[l];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),r>i&&this._retainParent(n,s,r,i))},_retainChildren:function(t,e,o,i){for(var n=2*t;n<2*t+2;n++)for(var s=2*e;s<2*e+2;s++){var r=new Mt(n,s);r.z=o+1;var a=this._tileCoordsToKey(r),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),o+1<i&&this._retainChildren(n,s,o+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,o,i){var n=Math.round(e);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var s=this.options.updateWhenZooming&&n!==this._tileZoom;i&&!s||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(t),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var o in this._levels)this._setZoomTransform(this._levels[o],t,e)},_setZoomTransform:function(t,e,o){var i=this._map.getZoomScale(o,t.zoom),n=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,o)).round();Ne.any3d?co(t.el,n,i):uo(t.el,n)},_resetGrid:function(){var t=this._map,e=t.options.crs,o=this._tileSize=this.getTileSize(),i=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/o.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/o.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/o.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/o.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,o=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(o,this._tileZoom),n=e.project(t,this._tileZoom).floor(),s=e.getSize().divideBy(2*i);return new Ct(n.subtract(s),n.add(s))},_update:function(t){var e=this._map;if(e){var o=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(i),s=n.getCenter(),r=[],a=this.options.keepBuffer,l=new Ct(n.getBottomLeft().subtract([a,-a]),n.getTopRight().add([a,-a]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var h in this._tiles){var c=this._tiles[h].coords;c.z===this._tileZoom&&l.contains(new Mt(c.x,c.y))||(this._tiles[h].current=!1)}if(Math.abs(o-this._tileZoom)>1)this._setView(t,o);else{for(var d=n.min.y;d<=n.max.y;d++)for(var u=n.min.x;u<=n.max.x;u++){var m=new Mt(u,d);if(m.z=this._tileZoom,this._isValidTile(m)){var p=this._tiles[this._tileCoordsToKey(m)];p?p.current=!0:r.push(m)}}if(r.sort((function(t,e){return t.distanceTo(s)-e.distanceTo(s)})),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));var g=document.createDocumentFragment();for(u=0;u<r.length;u++)this._addTile(r[u],g);this._level.el.appendChild(g)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var o=this._globalTileRange;if(!e.wrapLng&&(t.x<o.min.x||t.x>o.max.x)||!e.wrapLat&&(t.y<o.min.y||t.y>o.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return Dt(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,o=this.getTileSize(),i=t.scaleBy(o),n=i.add(o);return[e.unproject(i,t.z),e.unproject(n,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),o=new Pt(e[0],e[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),o=new Mt(+e[0],+e[1]);return o.z=+e[2],o},_removeTile:function(t){var e=this._tiles[t];e&&(Qe(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){no(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=it,t.onmousemove=it,Ne.ielt9&&this.options.opacity<1&&lo(t,this.options.opacity)},_addTile:function(t,e){var o=this._getTilePos(t),i=this._tileCoordsToKey(t),n=this.createTile(this._wrapCoords(t),$(this._tileReady,this,t));this._initTile(n),this.createTile.length<2&&yt($(this._tileReady,this,t,null,n)),uo(n,o),this._tiles[i]={el:n,coords:t,current:!0},e.appendChild(n),this.fire("tileloadstart",{tile:n,coords:t})},_tileReady:function(t,e,o){e&&this.fire("tileerror",{error:e,tile:o,coords:t});var i=this._tileCoordsToKey(t);(o=this._tiles[i])&&(o.loaded=+new Date,this._map._fadeAnimated?(lo(o.el,0),Tt(this._fadeFrame),this._fadeFrame=yt(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),e||(no(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ne.ielt9||!this._map._fadeAnimated?yt(this._pruneTiles,this):setTimeout($(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new Mt(this._wrapX?ot(t.x,this._wrapX):t.x,this._wrapY?ot(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new Ct(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),Zi=Fi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=at(this,e)).detectRetina&&Ne.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var o=document.createElement("img");return To(o,"load",$(this._tileOnLoad,this,e,o)),To(o,"error",$(this._tileOnError,this,e,o)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(o.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(t),o},getTileUrl:function(t){var e={r:Ne.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=o),e["-y"]=o}return ct(this._url,q(e,this.options))},_tileOnLoad:function(t,e){Ne.ielt9?setTimeout($(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,o){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(o,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=it,e.onerror=it,!e.complete)){e.src=mt;var o=this._tiles[t].coords;Qe(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:o})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",mt),Fi.prototype._removeTile.call(this,t)},_tileReady:function(t,e,o){if(this._map&&(!o||o.getAttribute("src")!==mt))return Fi.prototype._tileReady.call(this,t,e,o)}}),Ki=Zi.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var o=q({},this.defaultWmsParams);for(var i in e)i in this.options||(o[i]=e[i]);var n=(e=at(this,e)).detectRetina&&Ne.retina?2:1,s=this.getTileSize();o.width=s.x*n,o.height=s.y*n,this.wmsParams=o},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Zi.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),o=this._crs,i=Nt(o.project(e[0]),o.project(e[1])),n=i.min,s=i.max,r=(this._wmsVersion>=1.3&&this._crs===ui?[n.y,n.x,s.y,s.x]:[n.x,n.y,s.x,s.y]).join(","),a=Zi.prototype.getTileUrl.call(this,t);return a+lt(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+r},setParams:function(t,e){return q(this.wmsParams,t),e||this.redraw(),this}});Zi.WMS=Ki;var Ui=pi.extend({options:{padding:.1},initialize:function(t){at(this,t),tt(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&no(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var o=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,e),s=i.multiplyBy(-o).add(n).subtract(this._map._getNewPixelOrigin(t,e));Ne.any3d?co(this._container,s,o):uo(this._container,s)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),o=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new Ct(o,o.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Wi=Ui.extend({options:{tolerance:0},getEvents:function(){var t=Ui.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ui.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");To(t,"mousemove",this._onMouseMove,this),To(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),To(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){Tt(this._redrawRequest),delete this._ctx,Qe(this._container),bo(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Ui.prototype._update.call(this);var t=this._bounds,e=this._container,o=t.getSize(),i=Ne.retina?2:1;uo(e,t.min),e.width=i*o.x,e.height=i*o.y,e.style.width=o.x+"px",e.style.height=o.y+"px",Ne.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Ui.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[tt(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,o=e.next,i=e.prev;o?o.prev=i:this._drawLast=i,i?i.next=o:this._drawFirst=o,delete t._order,delete this._layers[tt(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,o,i=t.options.dashArray.split(/[, ]+/),n=[];for(o=0;o<i.length;o++){if(e=Number(i[o]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||yt(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ct,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var o=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var o,i,n,s,r=t._parts,a=r.length,l=this._ctx;if(a){for(l.beginPath(),o=0;o<a;o++){for(i=0,n=r[o].length;i<n;i++)s=r[o][i],l[i?"lineTo":"moveTo"](s.x,s.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,o=this._ctx,i=Math.max(Math.round(t._radius),1),n=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==n&&(o.save(),o.scale(1,n)),o.beginPath(),o.arc(e.x,e.y/n,i,0,2*Math.PI,!1),1!==n&&o.restore(),this._fillStroke(o,t)}},_fillStroke:function(t,e){var o=e.options;o.fill&&(t.globalAlpha=o.fillOpacity,t.fillStyle=o.fillColor||o.color,t.fill(o.fillRule||"evenodd")),o.stroke&&0!==o.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=o.opacity,t.lineWidth=o.weight,t.strokeStyle=o.color,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.stroke())},_onClick:function(t){for(var e,o,i=this._map.mouseEventToLayerPoint(t),n=this._drawFirst;n;n=n.next)(e=n.layer).options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(o=e);this._fireEvent(!!o&&[o],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(so(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var o,i,n=this._drawFirst;n;n=n.next)(o=n.layer).options.interactive&&o._containsPoint(e)&&(i=o);i!==this._hoveredLayer&&(this._handleMouseOut(t),i&&(no(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout($((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(t,e,o){this._map._fireDOMEvent(e,o||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;o&&(o.prev=i,i?i.next=o:o&&(this._drawFirst=o),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;i&&(i.next=o,o?o.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});var Vi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Xi={_initContainer:function(){this._container=$e("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ui.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Vi("shape");no(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Vi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[tt(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;Qe(e),t.removeInteractiveTarget(e),delete this._layers[tt(t)]},_updateStyle:function(t){var e=t._stroke,o=t._fill,i=t.options,n=t._container;n.stroked=!!i.stroke,n.filled=!!i.fill,i.stroke?(e||(e=t._stroke=Vi("stroke")),n.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=dt(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(n.removeChild(e),t._stroke=null),i.fill?(o||(o=t._fill=Vi("fill")),n.appendChild(o),o.color=i.fillColor||i.color,o.opacity=i.fillOpacity):o&&(n.removeChild(o),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),o=Math.round(t._radius),i=Math.round(t._radiusY||o);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+o+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){eo(t._container)},_bringToBack:function(t){oo(t._container)}},Yi=Ne.vml?Vi:Ut,Gi=Ui.extend({_initContainer:function(){this._container=Yi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Yi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Qe(this._container),bo(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Ui.prototype._update.call(this);var t=this._bounds,e=t.getSize(),o=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,o.setAttribute("width",e.x),o.setAttribute("height",e.y)),uo(o,t.min),o.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Yi("path");t.options.className&&no(e,t.options.className),t.options.interactive&&no(e,"leaflet-interactive"),this._updateStyle(t),this._layers[tt(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){Qe(t._path),t.removeInteractiveTarget(t._path),delete this._layers[tt(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,o=t.options;e&&(o.stroke?(e.setAttribute("stroke",o.color),e.setAttribute("stroke-opacity",o.opacity),e.setAttribute("stroke-width",o.weight),e.setAttribute("stroke-linecap",o.lineCap),e.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?e.setAttribute("stroke-dasharray",o.dashArray):e.removeAttribute("stroke-dasharray"),o.dashOffset?e.setAttribute("stroke-dashoffset",o.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),o.fill?(e.setAttribute("fill",o.fillColor||o.color),e.setAttribute("fill-opacity",o.fillOpacity),e.setAttribute("fill-rule",o.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,Wt(t._parts,e))},_updateCircle:function(t){var e=t._point,o=Math.max(Math.round(t._radius),1),i="a"+o+","+(Math.max(Math.round(t._radiusY),1)||o)+" 0 1,0 ",n=t._empty()?"M0 0":"M"+(e.x-o)+","+e.y+i+2*o+",0 "+i+2*-o+",0 ";this._setPath(t,n)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){eo(t._path)},_bringToBack:function(t){oo(t._path)}});Ne.vml&&Gi.include(Xi),Bo.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&function(t){return Ne.canvas?new Wi(t):null}(t)||function(t){return Ne.svg||Ne.vml?new Gi(t):null}(t)}});var qi=Mi.extend({initialize:function(t,e){Mi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=Dt(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});Gi.create=Yi,Gi.pointsToPath=Wt,xi.geometryToLayer=Ii,xi.coordsToLatLng=Ni,xi.coordsToLatLngs=Pi,xi.latLngToCoords=Di,xi.latLngsToCoords=Oi,xi.getFeature=Si,xi.asFeature=ji,Bo.mergeOptions({boxZoom:!0});var Ji=Wo.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){To(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){bo(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Qe(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Ke(),go(),this._startPoint=this._map.mouseEventToContainerPoint(t),To(document,{contextmenu:Do,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=$e("div","leaflet-zoom-box",this._container),no(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new Ct(this._point,this._startPoint),o=e.getSize();uo(this._box,e.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(Qe(this._box),so(this._container,"leaflet-crosshair")),Ue(),vo(),bo(document,{contextmenu:Do,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout($(this._resetState,this),0);var e=new Pt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Bo.addInitHook("addHandler","boxZoom",Ji),Bo.mergeOptions({doubleClickZoom:!0});var $i=Wo.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,o=e.getZoom(),i=e.options.zoomDelta,n=t.originalEvent.shiftKey?o-i:o+i;"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}});Bo.addInitHook("addHandler","doubleClickZoom",$i),Bo.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Qi=Wo.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new Yo(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}no(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){so(this._map._container,"leaflet-grab"),so(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=Dt(this._map.options.maxBounds);this._offsetLimit=Nt(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),o=this._initialWorldOffset,i=this._draggable._newPos.x,n=(i-e+o)%t+e-o,s=(i+e+o)%t-e-o,r=Math.abs(n+o)<Math.abs(s+o)?n:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,o=e.options,i=!o.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),s=(this._lastTime-this._times[0])/1e3,r=o.easeLinearity,a=n.multiplyBy(r/s),l=a.distanceTo([0,0]),h=Math.min(o.inertiaMaxSpeed,l),c=a.multiplyBy(h/l),d=h/(o.inertiaDeceleration*r),u=c.multiplyBy(-d/2).round();u.x||u.y?(u=e._limitOffset(u,e.options.maxBounds),yt((function(){e.panBy(u,{duration:d,easeLinearity:r,noMoveStart:!0,animate:!0})}))):e.fire("moveend")}}});Bo.addInitHook("addHandler","dragging",Qi),Bo.mergeOptions({keyboard:!0,keyboardPanDelta:80});var tn=Wo.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),To(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),bo(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,o=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,o,i=this._panKeys={},n=this.keyCodes;for(e=0,o=n.left.length;e<o;e++)i[n.left[e]]=[-1*t,0];for(e=0,o=n.right.length;e<o;e++)i[n.right[e]]=[t,0];for(e=0,o=n.down.length;e<o;e++)i[n.down[e]]=[0,t];for(e=0,o=n.up.length;e<o;e++)i[n.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,o,i=this._zoomKeys={},n=this.keyCodes;for(e=0,o=n.zoomIn.length;e<o;e++)i[n.zoomIn[e]]=t;for(e=0,o=n.zoomOut.length;e<o;e++)i[n.zoomOut[e]]=-t},_addHooks:function(){To(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){bo(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,o=t.keyCode,i=this._map;if(o in this._panKeys)i._panAnim&&i._panAnim._inProgress||(e=this._panKeys[o],t.shiftKey&&(e=It(e).multiplyBy(3)),i.panBy(e),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds));else if(o in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[o]);else{if(27!==o||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Do(t)}}});Bo.addInitHook("addHandler","keyboard",tn),Bo.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var en=Wo.extend({addHooks:function(){To(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){bo(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Ao(t),o=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout($(this._performZoom,this),i),Do(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),o=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,s=o?Math.ceil(n/o)*o:n,r=t._limitZoom(e+(this._delta>0?s:-s))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}});Bo.addInitHook("addHandler","scrollWheelZoom",en);Bo.mergeOptions({tapHold:Ne.touchNative&&Ne.safari&&Ne.mobile,tapTolerance:15});var on=Wo.extend({addHooks:function(){To(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){bo(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new Mt(e.clientX,e.clientY),this._holdTimeout=setTimeout($((function(){this._cancel(),this._isTapValid()&&(To(document,"touchend",Po),To(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))}),this),600),To(document,"touchend touchcancel contextmenu",this._cancel,this),To(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){bo(document,"touchend",Po),bo(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),bo(document,"touchend touchcancel contextmenu",this._cancel,this),bo(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new Mt(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var o=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});o._simulated=!0,e.target.dispatchEvent(o)}});Bo.addInitHook("addHandler","tapHold",on),Bo.mergeOptions({touchZoom:Ne.touch,bounceAtZoomLimits:!0});var nn=Wo.extend({addHooks:function(){no(this._map._container,"leaflet-touch-zoom"),To(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){so(this._map._container,"leaflet-touch-zoom"),bo(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(o.add(i)._divideBy(2))),this._startDist=o.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),To(document,"touchmove",this._onTouchMove,this),To(document,"touchend touchcancel",this._onTouchEnd,this),Po(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]),n=o.distanceTo(i)/this._startDist;if(this._zoom=e.getScaleZoom(n,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&n<1||this._zoom>e.getMaxZoom()&&n>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===n)return}else{var s=o._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===n&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),Tt(this._animRequest);var r=$(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=yt(r,this,!0),Po(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,Tt(this._animRequest),bo(document,"touchmove",this._onTouchMove,this),bo(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Bo.addInitHook("addHandler","touchZoom",nn),Bo.BoxZoom=Ji,Bo.DoubleClickZoom=$i,Bo.Drag=Qi,Bo.Keyboard=tn,Bo.ScrollWheelZoom=en,Bo.TapHold=on,Bo.TouchZoom=nn;class sn{constructor(){Object.freeze(this)}handleEvent(t){if(!t.target.classList.contains("TravelNotes-Background"))return;let e=U.map.getZoom()+(0>t.deltaY?1:-1);e=Math.min(U.map.getMaxZoom(),e),e=Math.max(U.map.getMinZoom(),e),U.map.setZoomAround(new Mt(t.clientX,t.clientY),e)}}class rn{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault()}}class an{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){t.preventDefault(),Number.parseInt(t.dataTransfer.getData("ObjId"))===this.#Zt.objId&&(t.stopPropagation(),this.#Zt.moveDialog(t))}}class ln{#V;#X;constructor(t,e){Object.freeze(this),this.#V=t,this.#X=e}static clone(t){return new ln(t.lat,t.lng)}get latLng(){return[this.#V,this.#X]}get lat(){return this.#V}get lng(){return this.#X}}class hn extends ln{#Y;constructor(t,e,o){super(t,e),this.#Y=o}get distance(){return this.#Y}}class cn extends hn{#G;#et;constructor(t,e,o,i,n){super(t,e,o),this.#G=i,this.#et=n}get elev(){return this.#G}get ascent(){return this.#et}}class dn{static get#Kt(){return 100}constructor(){Object.freeze(this)}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let o=0;const i=t.itinerary.itineraryPoints.iterator;for(;o<e&&!i.done;)o+=i.value.distance;const n=i.value;i.done;const s=(n.distance-o+e)/n.distance;return new cn(n.lat+(i.value.lat-n.lat)*s,n.lng+(i.value.lng-n.lng)*s,e,n.elev+(i.value.elev-n.elev)*s,dn.#Kt*(i.value.elev-n.elev)/n.distance)}getClosestLatLngDistance(t,e){if(0===t.itinerary.itineraryPoints.length)return null;const i=t.itinerary.itineraryPoints.iterator;i.done;let n=Number.MAX_VALUE;const s=ci.SphericalMercator.project(new Ot(e[0],e[1]));let r=ci.SphericalMercator.project(new Ot(i.value.lat,i.value.lng)),a=null,l=o.defaultValue,h=i.value.distance;for(;!i.done;){const t=ci.SphericalMercator.project(new Ot(i.value.lat,i.value.lng));let e=ri.pointToSegmentDistance(s,r,t);e<n&&(n=e,a=ci.SphericalMercator.unproject(ri.closestPointOnSegment(s,r,t)),l=h-a.distanceTo(new Ot(i.value.lat,i.value.lng))),h+=i.value.distance,r=t}return new hn(a.lat,a.lng,l)}getLatLngBounds(t){const e=new Ot(a.maxLat,a.maxLng),o=new Ot(a.minLat,a.minLng);return t.forEach((t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),o.lat=Math.max(o.lat,t[0]),o.lng=Math.max(o.lng,t[1])})),new Pt(e,o)}getSquareBoundingBox(t,o){const i=t[0]*e.toRadians,n=o/u*e.fromRadians,s=Math.acos((Math.cos(o/u)-Math.sin(i)**2)/Math.cos(i)**2)*e.fromRadians;return new Pt(new Ot(t[0]-n,t[1]-s),new Ot(t[0]+n,t[1]+s))}project(t,e){const o=U.map.project(new Ot(t[0],t[1]),e);return[o.x,o.y]}screenCoordToLatLng(t,e){const o=U.map.containerPointToLatLng(new Mt(t,e));return[o.lat,o.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const un=new dn;class mn{#zt;#Ut=!1;#Wt=!1;#Vt=0;#Xt=0;#Yt;#Gt;#qt;#Jt;#$t(e){if(this.#Ut&&(this.#Vt!==e.screenX||this.#Xt!==e.screenY)){t.baseDialog.cancelTouchY>this.#Xt&&e.screenY<this.#Xt&&t.baseDialog.cancelTouchX>this.#Vt&&this.#zt.onCancel();const o=un.screenCoordToLatLng(this.#Vt,this.#Xt),i=un.screenCoordToLatLng(e.screenX,e.screenY);U.map.panTo([this.#Yt.lat+o[0]-i[0],this.#Yt.lng+o[1]-i[1]])}}#Qt(e){let o=Math.sqrt((e.item(0).clientX-e.item(1).clientX)**2+(e.item(0).clientY-e.item(1).clientY)**2),i=this.#Gt,n=o-this.#qt;t.baseDialog.deltaZoomDistance<n?i++:-t.baseDialog.deltaZoomDistance>n&&i--,i=Math.min(U.map.getMaxZoom(),i),i=Math.max(U.map.getMinZoom(),i),i!==this.#Gt&&(U.map.setZoomAround(this.#Jt,i),this.#Gt=i,this.#qt=o)}#te(t){this.#Ut&&1===t.changedTouches.length&&(this.#$t(t.changedTouches.item(0)),this.#Ut=!1)}#ee(t){this.#Ut&&1===t.changedTouches.length?this.#$t(t.changedTouches.item(0)):this.#Wt&&2===t.targetTouches.length&&this.#Qt(t.targetTouches)}#oe(t){if(1===t.targetTouches.length){const e=t.changedTouches.item(0);this.#Vt=e.screenX,this.#Xt=e.screenY,this.#Yt=U.map.getCenter(),this.#Ut=!0,this.#Wt=!1}2===t.targetTouches.length&&(this.#Gt=U.map.getZoom(),this.#Jt=new Mt((t.targetTouches.item(0).clientX+t.targetTouches.item(1).clientX)/2,(t.targetTouches.item(0).clientY+t.targetTouches.item(1).clientY)/2),this.#qt=Math.sqrt((t.targetTouches.item(0).clientX-t.targetTouches.item(1).clientX)**2+(t.targetTouches.item(0).clientY-t.targetTouches.item(1).clientY)**2),this.#Ut=!1,this.#Wt=!0)}constructor(t){Object.freeze(this),this.#zt=t}handleEvent(t){switch(t.currentTarget===t.target&&t.preventDefault(),t.type){case"touchstart":t.currentTarget===t.target&&this.#oe(t);break;case"touchmove":this.#ee(t);break;case"touchend":this.#te(t)}}}class pn{static get LEFT_BUTTON(){return 0}#Ut=!1;#Vt=0;#Xt=0;#Yt;#$t(t){const e=un.screenCoordToLatLng(this.#Vt,this.#Xt),o=un.screenCoordToLatLng(t.screenX,t.screenY);U.map.panTo([this.#Yt.lat+e[0]-o[0],this.#Yt.lng+e[1]-o[1]])}constructor(){Object.freeze(this)}handleEvent(t){switch(t.type){case"mousedown":t.button===pn.LEFT_BUTTON&&t.target===t.currentTarget&&(this.#Vt=t.screenX,this.#Xt=t.screenY,this.#Yt=U.map.getCenter(),this.#Ut=!0);break;case"mousemove":t.button===pn.LEFT_BUTTON&&this.#Ut&&(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),this.#$t(t));break;case"mouseup":t.button!==pn.LEFT_BUTTON||!this.#Ut||this.#Vt===t.screenX&&this.#Xt===t.screenY||this.#$t(t),this.#Ut=!1}}}class gn{#ie=null;#ne=null;#se=null;#re=null;#ae=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#ie=t.firstButtonText;break;case"secondButtonText":this.#ne=t.secondButtonText;break;case"selectOptionsData":this.#se=t.selectOptionsData;break;case"title":this.#re=t.title;break;case"text":this.#ae=t.text}}get firstButtonText(){return this.#ie}get secondButtonText(){return this.#ne}get selectOptionsData(){return this.#se}get title(){return this.#re}get text(){return this.#ae}}class vn{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Zt.objId)}}class fn{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.moveDialog(t)}}class _n{#Zt;#le;constructor(t){Object.freeze(this),this.#Zt=t,this.#le=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#le=!0,this.#Zt.setDragStartPoint(o);break;case"touchmove":this.#le=!1,t.preventDefault(),this.#Zt.moveDialog(o,e);break;case"touchend":this.#le||this.#Zt.moveDialog(o,e)}}}}class yn{static#he;static#ce(){yn.#he=!0,document.removeEventListener("touchstart",yn.#ce,!0)}constructor(){Object.freeze(this),yn.#he=!1,document.addEventListener("touchstart",yn.#ce,!0)}get isTouch(){return yn.#he}get screenAvailable(){const t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.right=0,t.style.height=1,t.style.width=1,document.body.appendChild(t);const e=t.getBoundingClientRect(),o=e.bottom,i=e.right;return document.body.removeChild(t),Object.freeze({height:o,width:i})}}const Tn=new yn;class Ln{#t;#de;#ue;#me;#pe;#ge(t,e){const o=Tn.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-d,n=o.height-this.dialogHTMLElement.offsetHeight-d;this.#me=Math.max(Math.min(t,i),d),this.#pe=Math.max(Math.min(e,n),d)}#ve(){this.dialogHTMLElement.style.left=String(this.#me)+"px",this.dialogHTMLElement.style.top=String(this.#pe)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#me=d,this.#pe=d,this.#de=0,this.#ue=0,this.#t=T.nextObjId}get onTop(){return 42>this.#pe}get objId(){return this.#t}centerDialog(){const e=Tn.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(e.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(e.width-80,800))+"px",this.#me=(e.width-this.dialogHTMLElement.clientWidth)/2,t.baseDialog.touchTopScreen&&Tn.isTouch?this.#pe=d:this.#pe=(e.height-this.dialogHTMLElement.clientHeight)/2,this.#ve()}moveDialog(t,e){const o=this.#me+t.screenX-this.#de,i=this.#pe+t.screenY-this.#ue;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#ge(t,e),this.#ve()}moveDialogToLastPosition(){this.moveDialogTo(this.#me,this.#pe)}moveDialogToTopLeft(){this.#me=d,this.#pe=d,this.#ve()}setDragStartPoint(t){this.#de=t.screenX,this.#ue=t.screenY}}class bn extends class{#fe;#_e;#ye;#Te;#Le;#be;#Ee;#we;#Me;#xe=null;#Ie(){this.#fe=V.create("div",{className:"TravelNotes-BaseDialog-DialogHTMLElement"}),this.mover.dialogHTMLElement=this.#fe}#Ce(){this.#_e=V.create("div",{className:"TravelNotes-BaseDialog-TopBarHTMLElement",draggable:!0},this.#fe),this.#we=new _n(this.mover),this.#_e.addEventListener("touchstart",this.#we,!1),this.#_e.addEventListener("touchmove",this.#we,!1),this.#_e.addEventListener("touchend",this.#we,!1),this.#_e.addEventListener("touchcancel",this.#we,!1),this.#be=new vn(this.mover),this.#_e.addEventListener("dragstart",this.#be,!1),this.#Ee=new fn(this.mover),this.#_e.addEventListener("dragend",this.#Ee,!1),this.#ye=V.create("div",{textContent:"âŒ",className:"TravelNotes-BaseDialog-CancelButton",title:O.getText("BaseDialog - Cancel")},this.#_e),V.create("div",{textContent:this.title,className:"TravelNotes-BaseDialog-Title"},this.#_e),this.#Me=new X(this),this.#ye.addEventListener("click",this.#Me,!1),this.mover.topBarHTMLElement=this.#_e}#Ne(){this.toolbarHTMLElement&&V.create("div",{className:"TravelNotes-BaseDialog-ToolbarHTMLElement"},this.#fe).appendChild(this.toolbarHTMLElement)}#Pe(){this.#Te=V.create("div",{className:"TravelNotes-BaseDialog-ContentHTMLElement"},this.#fe),this.contentHTMLElements.forEach((t=>this.#Te.appendChild(t)))}#De(){this.#Ie(),this.#Ce(),this.#Ne(),this.#Pe()}constructor(t){Object.freeze(this),this.#xe=new gn(t)}#Oe(){this.#_e.removeEventListener("dragstart",this.#be,!1),this.#be=null,this.#_e.removeEventListener("dragend",this.#Ee,!1),this.#Ee=null,this.#_e.removeEventListener("touchstart",this.#we,!1),this.#_e.removeEventListener("touchmove",this.#we,!1),this.#_e.removeEventListener("touchend",this.#we,!1),this.#_e.removeEventListener("touchcancel",this.#we,!1),this.#we=null,this.#ye.removeEventListener("click",this.#Me,!1),this.#Me=null,this.#Le&&(this.#Le=null)}get mover(){return this.#Le?this.#Le:this.#Le=new Ln}onCancel(){this.#Oe()}onOk(){this.#Oe()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#De()}removeFromBackground(t){t.removeChild(this.#fe)}addToBackground(t){t.appendChild(this.#fe)}addToDialog(t){this.#fe.appendChild(t)}get options(){return this.#xe}addCssClass(t){this.#fe.classList.add(t)}}{#Se;#je;#Ae;#He;#Re;#ke;#Be;#Me;#ze;#Fe;#Ze;#Ke;#Ue;#We;#Ve;#Xe;#Ye(){this.#Se=V.create("div",{className:"TravelNotes-Background"})}#Ge(){this.#Ke=new an(this.mover),this.#Se.addEventListener("dragover",this.#Ke,!1),this.#Ve=new sn,this.#Se.addEventListener("wheel",this.#Ve,{passive:!0}),this.#Xe=new rn,this.#Se.addEventListener("contextmenu",this.#Xe,!1),this.#Ue=new mn(this),this.#Se.addEventListener("touchstart",this.#Ue,!1),this.#Se.addEventListener("touchmove",this.#Ue,!1),this.#Se.addEventListener("touchend",this.#Ue,!1),this.#Se.addEventListener("touchcancel",this.#Ue,!1),this.#We=new pn,this.#Se.addEventListener("mouseup",this.#We,!1),this.#Se.addEventListener("mousemove",this.#We,!1),this.#Se.addEventListener("mousedown",this.#We,!1)}#qe(){this.#je=V.create("div",{className:"TravelNotes-ModalBaseDialog-ErrorHTMLElement TravelNotes-Hidden"}),this.addToDialog(this.#je)}#Je(){V.create("div",{className:"TravelNotes-WaitAnimationBullet"},V.create("div",{className:"TravelNotes-WaitAnimation"},this.#Ae=V.create("div",{className:"TravelNotes-ModalBaseDialog-WaitHTMLElement  TravelNotes-Hidden"}))),this.addToDialog(this.#Ae)}#$e(){const t=V.create("div",{className:"TravelNotes-ModalBaseDialog-FooterHTMLElement"});this.addToDialog(t),this.#Re=V.create("div",{textContent:this.options.firstButtonText||"ðŸ†—",className:"TravelNotes-BaseDialog-Button"},t),this.#Be=new G(this),this.#Re.addEventListener("click",this.#Be,!1),this.options.secondButtonText?(this.#ke=V.create("div",{textContent:this.options.secondButtonText,className:"TravelNotes-BaseDialog-Button"},t),this.#Me=new X(this),this.#ke.addEventListener("click",this.#Me,!1)):this.#ke=null,this.footerHTMLElements.forEach((e=>t.appendChild(e)))}#De(){this.#Ye(),this.#Ge(),this.#qe(),this.#Je(),this.#$e()}#Oe(){this.#Se.removeEventListener("wheel",this.#Ve,{passive:!0}),this.#Ve=null,this.#Se.removeEventListener("contextmenu",this.#Xe,!1),this.#Xe=null,this.#Se.removeEventListener("dragover",this.#Ke,!1),this.#Ke=null,this.#Se.removeEventListener("touchstart",this.#Ue,!1),this.#Se.removeEventListener("touchmove",this.#Ue,!1),this.#Se.removeEventListener("touchend",this.#Ue,!1),this.#Se.removeEventListener("touchcancel",this.#Ue,!1),this.#Ue=null,this.#Se.removeEventListener("mouseup",this.#We,!1),this.#Se.removeEventListener("mousemove",this.#We,!1),this.#Se.removeEventListener("mousedown",this.#We,!1),this.#We=null,document.removeEventListener("keydown",this.#Ze,{capture:!0}),this.#Ze=null,this.#Re.removeEventListener("click",this.#Be,!1),this.#Be=null,this.options.secondButtonText&&(this.#ke.removeEventListener("click",this.#Me,!1),this.#Me=null),document.body.removeChild(this.#Se)}#Qe(t,e){this.#ze=t,this.#Fe=e}constructor(t){super(t),this.#He=!0}show(){return super.show(),this.#De(),this.addCssClass("TravelNotes-ModalBaseDialog"),document.body.appendChild(this.#Se),this.addToBackground(this.#Se),this.#Ze=new Y(this),document.addEventListener("keydown",this.#Ze,{capture:!0}),this.mover.centerDialog(),new Promise(((t,e)=>this.#Qe(t,e)))}onCancel(){this.#Oe(),super.onCancel(),this.#Fe("Canceled by user")}canClose(){return!0}onOk(t){return!!this.canClose()&&(this.#ze(t),this.#Oe(),super.onOk(),!0)}showWait(){this.#Ae.classList.remove("TravelNotes-Hidden"),this.#Re.classList.add("TravelNotes-Hidden")}hideWait(){this.#Ae.classList.add("TravelNotes-Hidden"),this.#Re.classList.remove("TravelNotes-Hidden")}showError(t){this.#je.textContent="",D.sanitizeToHtmlElement(t,this.#je),this.#je.classList.remove("TravelNotes-Hidden")}hideError(){this.#je.textContent="",this.#je.classList.add("TravelNotes-Hidden")}get footerHTMLElements(){return[]}get keyboardELEnabled(){return this.#He}set keyboardELEnabled(t){this.#He=t}}class En{#to;constructor(t){Object.freeze(this),this.#to=t}destructor(){this.#to=null}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{this.#to.addApiKeys(JSON.parse(e.result))}catch(t){this.#to.showError(t.message),t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class wn{#to;#eo;constructor(t){Object.freeze(this),this.#to=t,this.#eo=new En(this.#to)}destructor(){this.#to=null,this.#eo.destructor()}handleEvent(t){t.stopPropagation(),this.#to.hideError(),S.openFile(this.#eo,".json")}}class Mn{#oo;constructor(){Object.freeze(this),this.#oo=V.create("div",{className:"TravelNotes-BaseDialog-DataDiv"})}get controlHTMLElement(){return this.#oo}}class xn{#io=null;constructor(t){Object.freeze(this),this.#io=t}handleEvent(t){t.currentTarget.textContent="ðŸ‘€",t.preventDefault(),t.stopPropagation(),this.#io.type="text"}}class In{#io;constructor(t){Object.freeze(this),this.#io=t}handleEvent(t){t.currentTarget.textContent="ðŸ‘ï¸",t.preventDefault(),t.stopPropagation(),this.#io.type="password",this.#io.focus()}}class Cn extends Mn{#io;#no;#so;#ro;constructor(t){super(),this.#io=V.create("input",{type:"password",dataset:{Name:t?.datasetName||"PasswordControl"}},this.controlHTMLElement),this.#no=V.create("span",{id:"TravelNotes-PasswordControl-EyeSpan",textContent:"ðŸ‘ï¸"},this.controlHTMLElement),this.#so=new xn(this.#io),this.#ro=new In(this.#io),this.#no.addEventListener("mousedown",this.#so,!1),this.#no.addEventListener("touchstart",this.#so,!1),this.#no.addEventListener("mouseup",this.#ro,!1),this.#no.addEventListener("mouseleave",this.#ro,!1),this.#no.addEventListener("touchend",this.#ro,!1),this.#io.focus()}destructor(){this.#no.removeEventListener("mousedown",this.#so,!1),this.#no.removeEventListener("touchstart",this.#so,!1),this.#no.removeEventListener("mouseup",this.#ro,!1),this.#no.removeEventListener("mouseleave",this.#ro,!1),this.#no.removeEventListener("touchend",this.#ro,!1),this.#so=null,this.#ro=null}get value(){return this.#io.value}focus(){this.#io.focus()}}class Nn extends bn{#ao;#lo;static get#ho(){return 12}constructor(t){super(),this.#lo=t}#Oe(){this.#ao.destructor()}createContentHTML(){this.#ao=new Cn}show(){const t=super.show();return this.#ao.focus(),t}canClose(){return this.hideError(),!(this.#lo&&(this.#ao.value.length<Nn.#ho||!this.#ao.value.match(/[0-9]+/)||!this.#ao.value.match(/[a-z]+/)||!this.#ao.value.match(/[A-Z]+/)||!this.#ao.value.match(/[^0-9a-zA-Z]/)))||(this.showError("<p>"+O.getText("PasswordDialog - Password rules1")+"</p><ul><li>"+O.getText("PasswordDialog - Password rules2")+"</li><li>"+O.getText("PasswordDialog - Password rules3")+"</li><li>"+O.getText("PasswordDialog - Password rules4")+"</li><li>"+O.getText("PasswordDialog - Password rules5")+"</li><li>"+O.getText("PasswordDialog - Password rules6")+"</li></ul>"),this.#ao.focus(),!1)}onCancel(){this.#Oe(),super.onCancel()}onOk(){super.onOk((new window.TextEncoder).encode(this.#ao.value))&&this.#Oe()}get contentHTMLElements(){return[this.#ao.controlHTMLElement]}get title(){return O.getText("PasswordDialog - password")}}class Pn{#co;#do(t){return window.crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"])}#uo(t,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode(e),iterations:1e6,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}#mo(t,e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(e.slice(0,16))},t,new Uint8Array(e.slice(16)))}#po(t,e,o){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,o)}constructor(t){this.#co=t||"Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette.",Object.freeze(this)}encryptData(t,e,o,i){let n=window.crypto.getRandomValues(new Uint8Array(16));i.then((t=>this.#do(t))).then((t=>this.#uo(t,this.#co))).then((e=>this.#po(e,n,t))).then((t=>{e(new Blob([n,new Uint8Array(t)],{type:"application/octet-stream"}))})).catch(o)}decryptData(t,e,o,i){i.then((t=>this.#do(t))).then((t=>this.#uo(t,this.#co))).then((e=>this.#mo(e,t))).then(e).catch(o)}}class Dn{#go;constructor(t){this.#go=t,Object.freeze(this)}destructor(){this.#go=null}onErrorDecrypt(t){this.#go.hideWait(),this.#go.keyboardELEnabled=!0,t&&"Canceled by user"!==t&&this.#go.showError(O.getText("DataEncryptorHandlers - An error occurs when reading the file"))}onOkDecrypt(t){try{this.#go.addApiKeys(JSON.parse((new TextDecoder).decode(t)))}catch(t){return void this.onErrorDecrypt(t)}this.#go.hideWait(),this.#go.hideError(),this.#go.keyboardELEnabled=!0}onOkEncrypt(t){this.#go.hideError(),this.#go.hideWait(),S.saveFile("ApiKeys",t),this.#go.keyboardELEnabled=!0}onErrorEncrypt(){this.#go.showError(O.getText("DataEncryptorHandlers - An error occurs when saving the keys")),this.#go.hideWait(),this.#go.keyboardELEnabled=!0}}class On{#to;#vo;constructor(t){Object.freeze(this),this.#to=t,this.#vo=new Dn(this.#to)}destructor(){this.#vo.destructor(),this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.hideError(),this.#to.showWait(),this.#to.keyboardELEnabled=!1,fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then((t=>{p===t.status&&t.ok?t.arrayBuffer().then((t=>{(new Pn).decryptData(t,(t=>{this.#vo.onOkDecrypt(t)}),(t=>{this.#vo.onErrorDecrypt(t)}),new Nn(!1).show())})):this.#vo.onErrorDecrypt(new Error("Invalid http status"))})).catch((t=>{this.#vo.onErrorDecrypt(t),t instanceof Error&&console.error(t)}))}}class Sn{#to;#vo;constructor(t){Object.freeze(this),this.#to=t,this.#vo=new Dn(this.#to)}destructor(){this.#vo.destructor(),this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.showWait(),this.#to.keyboardELEnabled=!1;const e=new FileReader;e.onload=()=>{(new Pn).decryptData(e.result,(t=>{this.#vo.onOkDecrypt(t)}),(t=>{this.#vo.onErrorDecrypt(t)}),new Nn(!1).show())},e.readAsArrayBuffer(t.target.files[0])}}class jn{#to;#fo;constructor(t){Object.freeze(this),this.#to=t,this.#fo=new Sn(this.#to)}destructor(){this.#to=null,this.#fo.destructor()}handleEvent(t){t.stopPropagation(),this.#to.hideError(),S.openFile(this.#fo)}}class An{#to;#vo;constructor(t){Object.freeze(this),this.#to=t,this.#vo=new Dn(this.#to)}destructor(){this.#vo.destructor(),this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.validateApiKeys()&&(this.#to.showWait(),this.#to.keyboardELEnabled=!1,(new Pn).encryptData((new window.TextEncoder).encode(this.#to.apiKeysJSON),(t=>this.#vo.onOkEncrypt(t)),(()=>this.#vo.onErrorEncrypt()),new Nn(!0).show()))}}class Hn{#to;constructor(t){Object.freeze(this),this.#to=t}destructor(){this.#to=null}handleEvent(t){t.stopPropagation(),this.#to.validateApiKeys()&&S.saveFile("ApiKeys.json",this.#to.apiKeysJSON,"application/json")}}class Rn{#_o;constructor(t){Object.freeze(this),this.#_o=t}destructor(){this.#_o=null}handleEvent(t){t.stopPropagation(),this.#_o.newApiKey()}}class kn{#to;#_o;#yo;#To;#Lo;#bo;#Eo;#wo;#Mo;#xo;#Io;#Co;#No;#Po;#Do;#Oo;#So(){this.#To=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Reload from server"),textContent:"ðŸ”„"},this.#yo),this.#Io=new On(this.#to),this.#To.addEventListener("click",this.#Io,!1)}#jo(){this.#Lo=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Save to file"),textContent:"ðŸ’¾"},this.#yo),this.#Co=new An(this.#to),this.#Lo.addEventListener("click",this.#Co,!1)}#Ao(){this.#bo=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Open file"),textContent:"ðŸ“‚"},this.#yo),this.#No=new jn(this.#to),this.#bo.addEventListener("click",this.#No,!1)}#Ho(){this.#Eo=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - new api key"),textContent:"+"},this.#yo),this.#Po=new Rn(this.#_o),this.#Eo.addEventListener("click",this.#Po,!1)}#Ro(){this.#wo=V.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-ApiKeysDialog-AtRightButton",title:O.getText("ApiKeysDialogToolbar - Save to json file"),textContent:"ðŸ’¾"},this.#yo),this.#Do=new Hn(this.#to),this.#wo.addEventListener("click",this.#Do,!1)}#ko(){this.#Mo=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("ApiKeysDialogToolbar - Open json file"),textContent:"ðŸ“‚"},this.#yo),this.#Oo=new wn(this.#to),this.#Mo.addEventListener("click",this.#Oo,!1)}#Bo(){window?.crypto?.subtle?.importKey&&window.isSecureContext&&(this.#xo&&this.#So(),this.#jo(),this.#Ao()),this.#Ho(),t.ApiKeysDialog.haveUnsecureButtons&&(this.#Ro(),this.#ko())}constructor(t,e,o){this.#to=t,this.#_o=e,this.#xo=o,this.#yo=V.create("div",{id:"TravelNotes-ApiKeysDialog-ToolbarDiv"}),this.#Bo(),Object.freeze(this)}destructor(){this.#To&&(this.#To.removeEventListener("click",this.#Io,!1),this.#Io.destructor(),this.#Io=null),this.#Lo&&(this.#Lo.removeEventListener("click",this.#Co,!1),this.#Co.destructor(),this.#Co=null),this.#bo&&(this.#bo.removeEventListener("click",this.#No,!1),this.#No.destructor(),this.#No=null),this.#Eo&&(this.#Eo.removeEventListener("click",this.#Po,!1),this.#Po.destructor(),this.#Po=null),this.#wo&&(this.#wo.removeEventListener("click",this.#Do,!1),this.#Do.destructor(),this.#Do=null),this.#Mo&&(this.#Mo.removeEventListener("click",this.#Oo,!1),this.#Oo.destructor(),this.#Oo=null)}get toolbarHTMLElement(){return this.#yo}}class Bn{#zo;#Fo;#Zo;#t;#Ko;#Uo;constructor(e,o){Object.freeze(this),this.#Ko=o,this.#t=T.nextObjId,this.#zo=V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"}),this.#Fo=V.create("input",{className:"TravelNotes-ApiKeysDialog-ApiKeyName TravelNotes-ApiKeysDialog-Input",value:e.providerName,placeholder:O.getText("ApiKeyControlRow - provider name")},this.#zo),this.#Zo=V.create("input",{className:"TravelNotes-ApiKeysDialog-ApiKeyValue TravelNotes-ApiKeysDialog-Input",value:e.providerKey,placeholder:O.getText("ApiKeyControlRow - api key"),type:t.ApiKeysDialog.showApiKeys?"text":"password"},this.#zo),this.#Uo=V.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-ApiKeysDialog-AtRightButton",title:O.getText("ApiKeyControlRow - delete api key"),textContent:"âŒ",dataset:{ObjId:this.#t}},this.#zo),this.#Uo.addEventListener("click",this.#Ko,!1)}destructor(){this.#Uo.removeEventListener("click",this.#Ko,!1)}get objId(){return this.#t}get HTMLElement(){return this.#zo}get providerName(){return this.#Fo.value}get providerKey(){return this.#Zo.value}get apiKey(){return new W(this.#Fo.value,this.#Zo.value)}}class zn{#_o;constructor(t){Object.freeze(this),this.#_o=t}destructor(){this.#_o=null}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#_o.deleteApiKey(Number.parseInt(t.target.dataset.tanObjId))}}class Fn extends Mn{#Wo;#Ko;constructor(){super(),this.#Wo=new Map,this.#Ko=new zn(this)}destructor(){this.#Wo.forEach((t=>t.destructor())),this.#Wo.clear(),this.#Ko.destructor(),this.#Ko=null}haveEmptyOrDuplicateValues(){let t=!1;const e=[];this.#Wo.forEach((o=>{t=t||""===o.providerName||""===o.providerKey,e.push(o.providerName)}));let o=!1;return e.forEach((t=>{o=o||e.indexOf(t)!==e.lastIndexOf(t)})),{haveEmpty:t,haveDuplicate:o}}addApiKeys(t){this.#Wo.clear(),t.forEach((t=>{const e=new Bn(t,this.#Ko);this.#Wo.set(e.objId,e)})),this.refreshApiKeys()}newApiKey(){const t=new W,e=new Bn(t,this.#Ko);this.#Wo.set(e.objId,e),this.refreshApiKeys()}deleteApiKey(t){this.#Wo.get(t).destructor(),this.#Wo.delete(t),this.refreshApiKeys()}refreshApiKeys(){for(;this.controlHTMLElement.firstChild;)this.controlHTMLElement.removeChild(this.controlHTMLElement.firstChild);this.#Wo.forEach((t=>{this.controlHTMLElement.appendChild(t.HTMLElement)}))}get apiKeys(){const t=[];return this.#Wo.forEach((e=>t.push(e.apiKey))),t}get apiKeysJSON(){const t=[];return this.#Wo.forEach((e=>t.push(e.apiKey.jsonObject))),JSON.stringify(t)}}const Zn=new class{#Vo;#Xo;#Yo;#Go;#qo;#Jo;#$o(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),this.#Vo.classList.remove("TravelNotes-ErrorsUI-"+this.#Jo),this.#Vo.classList.add("TravelNotes-Hidden"),this.#qo.classList.add("TravelNotes-Hidden"),this.#Xo.textContent=""}#Qe(e,o){if(this.#Jo=o,!t.errorsUI["show"+this.#Jo]||"Help"===o&&this.#Go.checked)return;this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),this.#Xo.textContent="",D.sanitizeToHtmlElement(e,this.#Xo),this.#Vo.classList.add("TravelNotes-ErrorsUI-"+this.#Jo),this.#Vo.classList.remove("TravelNotes-Hidden");let i=t.errorsUI.timeOut;"Help"===this.#Jo&&(this.#qo.classList.remove("TravelNotes-Hidden"),i=t.errorsUI.helpTimeOut),this.#Yo=setTimeout((()=>this.#$o()),i)}constructor(){Object.freeze(this)}createUI(){if(this.#Vo)return;this.#Vo=V.create("div",{id:"TravelNotes-ErrorsUI",className:"TravelNotes-Hidden"},document.body);const e=V.create("div",null,this.#Vo);V.create("span",{id:"TravelNotes-ErrorsUI-CancelButton",textContent:"âŒ"},e).addEventListener("click",(()=>this.#$o()),!1),this.#Xo=V.create("div",{id:"TravelNotes-ErrorsUI-Message"},this.#Vo),this.#qo=V.create("div",{id:"TravelNotes-ErrorsUI-HelpInputDiv",className:"TravelNotes-Hidden"},this.#Vo),this.#Go=V.create("input",{id:"TravelNotes-ErrorsUI-HelpInput",type:"checkbox",checked:!t.errorsUI.showHelp},this.#qo),V.create("label",{id:"TravelNotes-ErrorsUI-HelpInputLabel",htmlFor:"TravelNotes-ErrorsUI-HelpInput",textContent:"Don't show help again"},this.#qo)}showError(t){this.#Qe(t,"Error")}showWarning(t){this.#Qe(t,"Warning")}showInfo(t){this.#Qe(t,"Info")}showHelp(t){this.#Qe(t,"Help")}};class Kn extends bn{#Qo;#_o;#ti;#xo;constructor(t,e){super(),this.#ti=t,this.#xo=e}createContentHTML(){this.#_o=new Fn,this.#Qo=new kn(this,this.#_o,this.#xo),this.#_o.addApiKeys(this.#ti)}#Oe(){this.#_o.destructor(),this.#Qo.destructor(),this.#Qo=null}validateApiKeys(){this.hideError();const t=this.#_o.haveEmptyOrDuplicateValues();return t.haveEmpty?(this.showError(O.getText("ApiKeysDialog - empty api key name or value")),!1):!t.haveDuplicate||(this.showError(O.getText("ApiKeysDialog - duplicate api key name found")),!1)}show(){return Zn.showHelp("<p>"+O.getText("Help - Complete the ApiKeys1")+"</p><p>"+O.getText("Help - Complete the ApiKeys2")+"</p><p>"+O.getText("Help - Complete the ApiKeys3")+"</p>"),super.show()}canClose(){return this.validateApiKeys()}onCancel(){this.#Oe(),super.onCancel()}onOk(){super.onOk(this.#_o.apiKeys)&&this.#Oe()}get title(){return O.getText("ApiKeysDialog - api keys")}get toolbarHTMLElement(){return this.#Qo.toolbarHTMLElement}get contentHTMLElements(){return[this.#_o.controlHTMLElement]}get apiKeysJSON(){return this.#_o.apiKeysJSON}addApiKeys(t){this.#_o.addApiKeys(t)}}const Un=new class{constructor(){Object.freeze(this)}dispatch(t,e){const o=new Event(t);e&&(o.data=e),document.dispatchEvent(o)}};const Wn=new class{#xo=!1;#ei=new Map;#oi(t){this.#ii(JSON.parse((new TextDecoder).decode(t)))}#ni(t){t instanceof Error&&console.error(t),t&&"Canceled by user"!==t&&Zn.showError(O.getText("ApiKeysManager - An error occurs when reading the ApiKeys file"))}#si(t){window.isSecureContext&&window?.crypto?.subtle?.importKey&&(new Pn).decryptData(t,(t=>this.#oi(t)),(t=>this.#ni(t)),new Nn(!1).show())}#ri(t){return this.#ei.get(t.toLowerCase())}#ai(t,e){this.#ei.set(t.toLowerCase(),e)}#li(){if(!S.storageAvailable("sessionStorage"))return 0;let t=0;for(let e=0;e<sessionStorage.length;e++){const o=sessionStorage.key(e);o.match(/^\w*ProviderKey$/)&&(this.#ai(o.replace("ProviderKey",""),atob(sessionStorage.getItem(o))),t++)}return U.providers.forEach((t=>{t.providerKeyNeeded&&(t.providerKey=this.#ri(t.name)||"")})),t}#ii(e){this.#ei.clear();const o=S.storageAvailable("sessionStorage")&&t.ApiKeys.saveToSessionStorage;o&&sessionStorage.clear(),e.forEach((t=>{o&&sessionStorage.setItem(t.providerName.toLowerCase()+"ProviderKey",btoa(t.providerKey)),this.#ai(t.providerName,t.providerKey)})),U.providers.forEach((t=>{t.providerKeyNeeded&&(t.providerKey=this.#ri(t.name)||"")})),Un.dispatch("providersadded")}constructor(){Object.freeze(this)}hasKey(t){return this.#ei.has(t.toLowerCase())}getUrl(t){if(t.providerKeyNeeded){const e=this.#ei.get(t.providerName.toLowerCase());return e?t.url.replace("{providerKey}",e):null}return t.url}setKeysFromServerFile(){let t=!1;0!==this.#li()&&(Un.dispatch("providersadded"),t=!0),fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then((e=>{p===e.status&&e.ok&&(this.#xo=!0,t||e.arrayBuffer().then((t=>this.#si(t))))})).catch((t=>{t instanceof Error&&console.error(t)}))}setKeysFromDialog(){const t=[];this.#ei.forEach(((e,o)=>{t.push(new W(o,e))})),t.sort(((t,e)=>t.providerName.localeCompare(e.providerName))),new Kn(t,this.#xo).show().then((t=>this.#ii(t))).catch((t=>{t instanceof Error&&console.error(t)}))}addProvider(t){const e=new t,o=e.name.toLowerCase();let i=this.#ri(o);e.providerKeyNeeded&&!i&&S.storageAvailable("sessionStorage")&&(i=sessionStorage.getItem(o),i&&(i=atob(i))),e.providerKeyNeeded&&i&&(e.providerKey=i),U.providers.set(e.name.toLowerCase(),e)}};const Vn=new class{#hi(t){return(t+e.d540)%e.d360-e.d180}constructor(){Object.freeze(this)}arcFromSummitArcArc(t,e,o){return Math.acos(Math.cos(e)*Math.cos(o)+Math.sin(e)*Math.sin(o)*Math.cos(t))}summitFromArcArcArc(t,e,o){return Math.acos((Math.cos(o)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(t,o){if(t[0]===o[0]&&t[1]===o[1])return 0;const i=t[0]*e.toRadians,n=o[0]*e.toRadians,s=(this.#hi(o[1])-this.#hi(t[1]))*e.toRadians;return Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(s))*u}};class Xn{#ci;#di;constructor(t,e){Object.freeze(this),this.#ci=t,this.#di=e}get note(){return this.#ci}get route(){return this.#di}}class Yn{constructor(){Object.seal(this)}distance=Number.MAX_VALUE;route=null;distanceOnRoute=0;latLngOnRoute=[a.defaultValue,a.defaultValue]}const Gn=new class{#ui(t,e,o){if(t.objId!==U.editedRouteObjId){const i=un.getClosestLatLngDistance(t,e);if(i){const n=Vn.pointsDistance(e,i.latLng);n<o.distance&&(o.route=t,o.distance=n,o.latLngOnRoute=i.latLng,o.distanceOnRoute=i.distance)}}}constructor(){Object.freeze(this)}getNearestRouteData(t){const e=new Yn;return U.travel.routes.forEach((o=>this.#ui(o,t,e))),g!==U.editedRouteObjId&&this.#ui(U.travel.editedRoute,t,e),Object.freeze(e)}getRoute(t){let e=null;return e=U.travel.routes.getAt(t),e||t===U.travel.editedRoute.objId&&(e=U.travel.editedRoute),e}getNoteAndRoute(t){let e=null,o=null;if(e=U.travel.notes.getAt(t),!e){const i=U.travel.routes.iterator;for(;!i.done&&!e;)e=i.value.notes.getAt(t),e&&(o=i.value);e||(e=U.travel.editedRoute.notes.getAt(t),e&&(o=U.travel.editedRoute))}return new Xn(e,o)}getWayPoint(t){let e=U.travel.editedRoute.wayPoints.getAt(t);if(!e){const o=U.travel.routes.iterator;for(;!o.done&&!e;)e=o.value.wayPoints.getAt(t)}return e}};class qn{#mi;#pi;#di;static get#gi(){return"\n"}static get#vi(){return"\n\t"}static get#fi(){return"\n\t\t"}static get#_i(){return"\n\t\t\t"}static get#yi(){return"\n\t\t\t\t"}#Ti(){this.#mi='<?xml version="1.0"?>'+qn.#gi,this.#mi+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="TravelNotes">'}#Li(t){return t.replaceAll("&","&amp;").replaceAll(/\u0027/g,"&apos;").replaceAll(/"/g,"&quot;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;")}#bi(){const t=this.#di.wayPoints.iterator;for(;!t.done;)this.#mi+=qn.#vi+'<wpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+qn.#fi+this.#pi+qn.#fi+"<name>"+this.#Li(t.value.fullName)+"</name>"+qn.#vi+"</wpt>"}#Ei(){this.#mi+=qn.#vi+"<rte>",this.#mi+=qn.#fi+"<name>"+this.#Li(this.#di.computedName)+"</name>";const t=this.#di.itinerary.maneuvers.iterator;for(;!t.done;){const e=this.#di.itinerary.itineraryPoints.getAt(t.value.itineraryPointObjId);this.#mi+=qn.#fi+'<rtept lat="'+e.lat+'" lon="'+e.lng+'">'+qn.#_i+this.#pi+qn.#_i+"<desc>"+this.#Li(t.value.instruction)+"</desc>"+qn.#fi+"</rtept>"}this.#mi+=qn.#vi+"</rte>"}#wi(){this.#mi+=qn.#vi+"<trk>",this.#mi+=qn.#fi+"<name>"+this.#Li(this.#di.computedName)+"</name>",this.#mi+=qn.#fi+"<trkseg>";const t=this.#di.itinerary.itineraryPoints.iterator;for(;!t.done;)this.#mi+=qn.#_i+'<trkpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+qn.#yi+this.#pi+qn.#yi+"<ele>"+t.value.elev+"</ele>"+qn.#_i+"</trkpt>";this.#mi+=qn.#fi+"</trkseg>",this.#mi+=qn.#vi+"</trk>"}#Mi(){this.#mi+=qn.#gi+"</gpx>"}#xi(){let t=(""===U.travel.name?"":U.travel.name+" - ")+this.#di.computedName;""===t&&(t="TravelNote"),t+=".gpx",S.saveFile(t,this.#mi,"application/xml")}constructor(){Object.freeze(this)}routeToGpx(t){this.#di=Gn.getRoute(t),this.#di&&(this.#pi="<time>"+(new Date).toISOString()+"</time>",this.#Ti(),this.#bi(),this.#Ei(),this.#wi(),this.#Mi(),this.#xi())}}class Jn extends Mn{#Ii;constructor(t){super(),V.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Ii=V.create("input",{type:"checkbox",className:"TravelNotes-CheckboxInputControl-Checkbox",checked:t?.checked,dataset:{Name:t?.datasetName||"CheckboxInputControl"}},this.controlHTMLElement),V.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get checked(){return this.#Ii.checked}set checked(t){this.#Ii.checked=t}}class $n{#Ci;#Ni;#Pi;constructor(t,e,o){Object.freeze(this),this.#Ci="number"==typeof t&&$n.MAX_COLOR>=t&&$n.MIN_COLOR<=t?t:$n.MAX_COLOR,this.#Ni="number"==typeof e&&$n.MAX_COLOR>=e&&$n.MIN_COLOR<=e?e:$n.MAX_COLOR,this.#Pi="number"==typeof o&&$n.MAX_COLOR>=o&&$n.MIN_COLOR<=o?o:$n.MAX_COLOR}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 255}static fromCss(t){let e=new $n;return e.cssColor=t,e}get red(){return this.#Ci}set red(t){"number"==typeof t&&$n.MAX_COLOR>=t&&$n.MIN_COLOR<=t&&(this.#Ci=t)}get green(){return this.#Ni}set green(t){"number"==typeof t&&$n.MAX_COLOR>=t&&$n.MIN_COLOR<=t&&(this.#Ni=t)}get blue(){return this.#Pi}set blue(t){"number"==typeof t&&$n.MAX_COLOR>=t&&$n.MIN_COLOR<=t&&(this.#Pi=t)}get cssColor(){return"#"+this.#Ci.toString(m).padStart(2,"0")+this.#Ni.toString(m).padStart(2,"0")+this.#Pi.toString(m).padStart(2,"0")}set cssColor(t){"#"===t[0]?(this.#Ci=Number.parseInt(t.substring(1,3),m),this.#Ni=Number.parseInt(t.substring(3,5),m),this.#Pi=Number.parseInt(t.substring(5,7),m)):"rgb"===t.substring(0,3)&&([this.#Ci,this.#Ni,this.#Pi]=Array.from(t.match(/[0-9]{1,3}/g),(t=>Number.parseInt(t))))}}class Qn{#Di=null;constructor(t){Object.freeze(this),this.#Di=t}handleEvent(t){t.stopPropagation(),this.#Di.onColorButtonClick(t.target.style["background-color"])}}class ts{#Oi;#Si;#ji;static get#Ai(){return 6}static get#Hi(){return 6}static get#Ri(){return 51}constructor(t){Object.freeze(this),this.#Si=[],this.#ji=new Qn(t),this.#Oi=V.create("div",null,t.controlHTMLElement);for(let t=0;t<ts.#Ai;++t){const t=V.create("div",null,this.#Oi);for(let e=0;e<ts.#Hi;++e){let e=V.create("div",{className:"TravelNotes-ColorControl-CellColorHTMLElement"},t);e.addEventListener("click",this.#ji,!1),this.#Si.push(e)}}}destructor(){this.#Si.forEach((t=>{t.removeEventListener("click",this.#ji,!1)})),this.#ji=null}set red(t){let e=new $n(t,$n.MIN_COLOR,$n.MIN_COLOR);this.#Si.forEach((t=>{t.style["background-color"]=e.cssColor,$n.MAX_COLOR<=e.green?(e.green=$n.MIN_COLOR,e.blue+=ts.#Ri):e.green+=ts.#Ri}))}}class es{#Di;#ki;constructor(t,e){Object.freeze(this),this.#Di=t,this.#ki=e}handleEvent(t){t.stopPropagation();let e=t.target.valueAsNumber*this.#ki;e=e-Math.floor(e)<Math.ceil(e)-e?Math.floor(e):Math.ceil(e),this.#Di.onRedSliderInput(e)}}class os{#Bi;#zi;static get#Fi(){return 100}static get#Zi(){return 20}constructor(t){this.#zi=new es(t,$n.MAX_COLOR/os.#Fi),this.#Bi=V.create("input",{type:"range",value:0,min:0,max:os.#Fi,step:os.#Zi},V.create("div",null,t.controlHTMLElement)),this.#Bi.addEventListener("input",this.#zi,!1),this.#Bi.focus()}destructor(){this.#Bi.removeEventListener("input",this.#zi,!1),this.#zi=null}}class is{#Di;#Ki;constructor(t,e){Object.freeze(this),this.#Di=t,this.#Ki=e}handleEvent(t){t.stopPropagation(),this.#Di.onRgbInput(this.#Ki.cssColor)}}class ns{#Ui;#Wi;#Vi;#Xi;#Yi;#Gi(t){V.create("text",{value:t},this.#Ui);const e=V.create("input",{type:"number",className:"TravelNotes-ColorControl-NumberInput",min:$n.MIN_COLOR,max:$n.MAX_COLOR},this.#Ui);return e.addEventListener("input",this.#Yi,!1),e}constructor(t){Object.freeze(this),this.#Yi=new is(t,this),this.#Ui=V.create("div",null,t.controlHTMLElement),this.#Wi=this.#Gi(O.getText("ColorControl - Red")),this.#Vi=this.#Gi(O.getText("ColorControl - Green")),this.#Xi=this.#Gi(O.getText("ColorControl - Blue"))}destructor(){this.#Wi.removeEventListener("input",this.#Yi,!1),this.#Vi.removeEventListener("input",this.#Yi,!1),this.#Xi.removeEventListener("input",this.#Yi,!1),this.#Yi=null}get cssColor(){return new $n(Number.parseInt(this.#Wi.value),Number.parseInt(this.#Vi.value),Number.parseInt(this.#Xi.value)).cssColor}set cssColor(t){let e=$n.fromCss(t);this.#Wi.value=e.red,this.#Vi.value=e.green,this.#Xi.value=e.blue}}class ss{#qi;constructor(t){Object.freeze(this),this.#qi=V.create("div",{id:"TravelNotes-ColorControl-ColorSampleHTMLElement"},t.controlHTMLElement)}get cssColor(){return this.#qi.style["background-color"]}set cssColor(t){this.#qi.style["background-color"]=t}}class rs extends Mn{#Ji;#$i;#Ki;#Qi;constructor(t){super(),t?.headerText&&""!==t.headerText&&V.create("div",{textContent:t.headerText},this.controlHTMLElement),this.controlHTMLElement.classList.add("TravelNotes-ColorControl-ColorHTMLElement"),this.#Ji=new ts(this),this.#Ji.red=0,this.#$i=new os(this),this.#Ki=new ns(this),this.#Ki.cssColor=t?.cssColor||"#ff0000",this.#Qi=new ss(this),this.#Qi.cssColor=t?.cssColor||"#ff0000"}destructor(){this.#Ji.destructor(),this.#$i.destructor(),this.#Ki.destructor()}get cssColor(){return $n.fromCss(this.#Qi.cssColor).cssColor}onRedSliderInput(t){this.#Ji.red=t}onColorButtonClick(t){this.#Ki.cssColor=t,this.#Qi.cssColor=t}onRgbInput(t){this.#Qi.cssColor=t}}class as extends Mn{#Ii;constructor(t){super(),V.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Ii=V.create("input",{type:"number",className:"TravelNotes-NumberInputControl-NumberInput",value:t?.value||0,min:t?.min||0,max:t?.max||Number.MAX_VALUE,dataset:{Name:t?.datasetName||"NumberInputControl"}},this.controlHTMLElement),V.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get value(){return Number.parseInt(this.#Ii.value)}set value(t){this.#Ii.value=t}}class ls extends Mn{#Ii;constructor(t,e){super(),V.create("div",{className:"TravelNotes-BaseDialog-FlexRow",textContent:t?.headerText||""},this.controlHTMLElement),this.#Ii=V.create("input",{className:"TravelNotes-TextInputControl-TextInput",type:"text",dataset:{Name:t?.datasetName||"TextInputControl"},value:t?.value||""},V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),e?.controlFocus&&this.#Ii.addEventListener("focus",e.controlFocus),e?.controlInput&&this.#Ii.addEventListener("input",e.controlInput),e?.controlChange&&this.#Ii.addEventListener("change",e.controlChange)}destructor(t){t?.controlFocus&&this.#Ii.removeEventListener("focus",t.controlFocus),t?.controlInput&&this.#Ii.removeEventListener("input",t.controlInput)}get value(){return this.#Ii.value}set value(t){this.#Ii.value=t}}class hs extends Mn{#tn;constructor(t){super(),V.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#tn=V.create("select",null,this.controlHTMLElement),t?.elements.forEach((t=>{this.#tn.add(V.create("option",{text:t}))}))}get selectedIndex(){return this.#tn.selectedIndex}set selectedIndex(t){this.#tn.selectedIndex=t}}class cs extends bn{#di;#Di;#en;#on;#in;#nn;static get#sn(){return 1}static get#rn(){return 40}constructor(t){super(),this.#di=t}createContentHTML(){this.#en=new ls({headerText:O.getText("RoutePropertiesDialog - Name"),value:this.#di.computedName}),this.#on=new as({beforeText:O.getText("RoutePropertiesDialog - Width"),value:this.#di.width,min:cs.#sn,max:cs.#rn}),this.#in=new hs({beforeText:O.getText("RoutePropertiesDialog - Linetype"),elements:Array.from(t.route.dashChoices,(t=>t.text))}),this.#in.selectedIndex=this.#di.dashIndex<t.route.dashChoices.length?this.#di.dashIndex:0,this.#nn=new Jn({beforeText:O.getText("RoutePropertiesDialog - Chained route"),checked:this.#di.chain}),this.#Di=new rs({cssColor:this.#di.color,headerText:O.getText("RoutePropertiesDialog - Color")})}show(){let t=super.show();return this.addCssClass("TravelNotes-RoutePropertiesDialog"),t}onCancel(){this.#Di.destructor(),super.onCancel()}onOk(){this.#di.color=this.#Di.cssColor,this.#di.computedName!==this.#en.value&&(this.#di.name=this.#en.value),this.#di.width=this.#on.value,this.#di.chain=this.#nn.checked,this.#di.dashIndex=this.#in.selectedIndex,this.#Di.destructor(),super.onOk()}get title(){return O.getText("RoutePropertiesDialog - Route properties")}get contentHTMLElements(){return[this.#en.controlHTMLElement,this.#on.controlHTMLElement,this.#in.controlHTMLElement,this.#nn.controlHTMLElement,this.#Di.controlHTMLElement]}}class ds extends Mn{static#t=0;#an;constructor(t){super(),this.#an=[],V.create("div",{className:"TravelNotes-BaseDialog-FlexRow",textContent:t?.headerText||""},this.controlHTMLElement);let e="controlName"+ ++ds.#t,o=0;t.buttons.forEach((i=>{let n="buttonId"+ ++ds.#t,s=V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement);this.#an.push(V.create("input",{type:"radio",className:"TravelNotes-RadioInputControl-Radio",checked:i.checked,id:n,name:e,value:String(o++),dataset:{Name:t?.datasetName||"RadioInputControl"}},s)),V.create("label",{htmlFor:n,innerText:i.label},s)}))}get value(){let t=f;return this.#an.forEach((e=>{t=e.checked?Number.parseInt(e.value):t})),t}}class us{constructor(){Object.seal(this)}paperWidth=0;paperHeight=0;borderWidth=0;zoomFactor=0;printNotes=!1;firefoxBrowser=!0}class ms extends bn{#ln;#hn;#cn;#dn;#un;#mn;static get#pn(){return 15}constructor(){super()}createContentHTML(){this.#ln=new as({beforeText:O.getText("PrintRouteMapDialog - Paper width"),afterText:O.getText("PrintRouteMapDialog - Paper width units"),value:t.printRouteMap.paperWidth}),this.#hn=new as({beforeText:O.getText("PrintRouteMapDialog - Paper height"),afterText:O.getText("PrintRouteMapDialog - Paper height units"),value:t.printRouteMap.paperHeight}),this.#cn=new as({beforeText:O.getText("PrintRouteMapDialog - Border width"),afterText:O.getText("PrintRouteMapDialog - Border width units"),value:t.printRouteMap.borderWidth}),this.#dn=new as({beforeText:O.getText("PrintRouteMapDialog - Zoom factor"),value:Math.min(t.printRouteMap.zoomFactor,ms.#pn),min:U.map.getMinZoom(),max:Math.min(U.map.getMaxZoom(),ms.#pn)}),this.#un=new Jn({afterText:O.getText("PrintRouteMapDialog - Print notes"),checked:t.printRouteMap.printNotes}),this.#mn=new ds({headerText:O.getText("PrintRouteMapDialog - Print with"),buttons:[{label:"Firefox",checked:t.printRouteMap.firefoxBrowser},{label:O.getText("PrintRouteMapDialog - Another browser"),checked:!t.printRouteMap.firefoxBrowser}]})}show(){let t=super.show();return this.addCssClass("TravelNotes-PrintRouteMapDialog"),t}onOk(){const t=new us;t.paperWidth=this.#ln.value,t.paperHeight=this.#hn.value,t.borderWidth=this.#cn.value,t.zoomFactor=this.#dn.value,t.printNotes=this.#un.checked,t.firefoxBrowser=0===this.#mn.value,Object.freeze(t),super.onOk(t)}get contentHTMLElements(){return[this.#ln.controlHTMLElement,this.#hn.controlHTMLElement,this.#cn.controlHTMLElement,this.#dn.controlHTMLElement,this.#un.controlHTMLElement,this.#mn.controlHTMLElement]}get title(){return O.getText("PrintRouteMapDialog - Print")}}class ps{#ie=null;#ne=null;#se=null;#re=null;#ae=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#ie=t.firstButtonText;break;case"secondButtonText":this.#ne=t.secondButtonText;break;case"selectOptionsData":this.#se=t.selectOptionsData;break;case"title":this.#re=t.title;break;case"text":this.#ae=t.text}}get firstButtonText(){return this.#ie}get secondButtonText(){return this.#ne}get selectOptionsData(){return this.#se}get title(){return this.#re}get text(){return this.#ae}}class gs{#zt;constructor(t){Object.freeze(this),this.#zt=t}handleEvent(){this.#zt.onCancel()}}class vs{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Zt.objId)}}class fs{#Zt;constructor(t){Object.freeze(this),this.#Zt=t}handleEvent(t){this.#Zt.moveDialog(t)}}class _s{#Zt;#le;constructor(t){Object.freeze(this),this.#Zt=t,this.#le=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#le=!0,this.#Zt.setDragStartPoint(o);break;case"touchmove":this.#le=!1,t.preventDefault(),this.#Zt.moveDialog(o,e);break;case"touchend":this.#le||this.#Zt.moveDialog(o,e)}}}}class ys{#t;#de;#ue;#me;#pe;#ge(t,e){const o=Tn.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-d,n=o.height-this.dialogHTMLElement.offsetHeight-d;this.#me=Math.max(Math.min(t,i),d),this.#pe=Math.max(Math.min(e,n),d)}#ve(){this.dialogHTMLElement.style.left=String(this.#me)+"px",this.dialogHTMLElement.style.top=String(this.#pe)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#me=d,this.#pe=d,this.#de=0,this.#ue=0,this.#t=T.nextObjId}get onTop(){return 42>this.#pe}get objId(){return this.#t}centerDialog(){const e=Tn.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(e.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(e.width-80,800))+"px",this.#me=(e.width-this.dialogHTMLElement.clientWidth)/2,t.baseDialog.touchTopScreen&&Tn.isTouch?this.#pe=d:this.#pe=(e.height-this.dialogHTMLElement.clientHeight)/2,this.#ve()}moveDialog(t,e){const o=this.#me+t.screenX-this.#de,i=this.#pe+t.screenY-this.#ue;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#ge(t,e),this.#ve()}moveDialogToLastPosition(){this.moveDialogTo(this.#me,this.#pe)}moveDialogToTopLeft(){this.#me=d,this.#pe=d,this.#ve()}setDragStartPoint(t){this.#de=t.screenX,this.#ue=t.screenY}}class Ts extends class{#fe;#_e;#ye;#Te;#Le;#be;#Ee;#we;#Me;#xe=null;#Ie(){this.#fe=V.create("div",{className:"TravelNotes-BaseDialog-DialogHTMLElement"}),this.mover.dialogHTMLElement=this.#fe}#Ce(){this.#_e=V.create("div",{className:"TravelNotes-BaseDialog-TopBarHTMLElement",draggable:!0},this.#fe),this.#we=new _s(this.mover),this.#_e.addEventListener("touchstart",this.#we,!1),this.#_e.addEventListener("touchmove",this.#we,!1),this.#_e.addEventListener("touchend",this.#we,!1),this.#_e.addEventListener("touchcancel",this.#we,!1),this.#be=new vs(this.mover),this.#_e.addEventListener("dragstart",this.#be,!1),this.#Ee=new fs(this.mover),this.#_e.addEventListener("dragend",this.#Ee,!1),this.#ye=V.create("div",{textContent:"âŒ",className:"TravelNotes-BaseDialog-CancelButton",title:O.getText("BaseDialog - Cancel")},this.#_e),V.create("div",{textContent:this.title,className:"TravelNotes-BaseDialog-Title"},this.#_e),this.#Me=new gs(this),this.#ye.addEventListener("click",this.#Me,!1),this.mover.topBarHTMLElement=this.#_e}#Ne(){this.toolbarHTMLElement&&V.create("div",{className:"TravelNotes-BaseDialog-ToolbarHTMLElement"},this.#fe).appendChild(this.toolbarHTMLElement)}#Pe(){this.#Te=V.create("div",{className:"TravelNotes-BaseDialog-ContentHTMLElement"},this.#fe),this.contentHTMLElements.forEach((t=>this.#Te.appendChild(t)))}#De(){this.#Ie(),this.#Ce(),this.#Ne(),this.#Pe()}constructor(t){Object.freeze(this),this.#xe=new ps(t)}#Oe(){this.#_e.removeEventListener("dragstart",this.#be,!1),this.#be=null,this.#_e.removeEventListener("dragend",this.#Ee,!1),this.#Ee=null,this.#_e.removeEventListener("touchstart",this.#we,!1),this.#_e.removeEventListener("touchmove",this.#we,!1),this.#_e.removeEventListener("touchend",this.#we,!1),this.#_e.removeEventListener("touchcancel",this.#we,!1),this.#we=null,this.#ye.removeEventListener("click",this.#Me,!1),this.#Me=null,this.#Le&&(this.#Le=null)}get mover(){return this.#Le?this.#Le:this.#Le=new ys}onCancel(){this.#Oe()}onOk(){this.#Oe()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#De()}removeFromBackground(t){t.removeChild(this.#fe)}addToBackground(t){t.appendChild(this.#fe)}addToDialog(t){this.#fe.appendChild(t)}get options(){return this.#xe}addCssClass(t){this.#fe.classList.add(t)}}{#Ke;#Ge(){this.#Ke=new an(this.mover),document.body.addEventListener("dragover",this.#Ke,!1)}constructor(){super()}onCancel(){document.body.removeEventListener("dragover",this.#Ke,!1),this.#Ke=null,super.onCancel(),this.removeFromBackground(document.body)}show(){super.show(),this.#Ge(),this.addToBackground(document.body)}}class Ls{#di;#gn;#vn;#fn;#_n;#yn;#Tn;static get PROFILE_MARGIN(){return 100}static get PROFILE_HEIGHT(){return 500}static get PROFILE_WIDTH(){return 1e3}static get X_DELTA_TEXT(){return 10}static get Y_DELTA_TEXT(){return 30}static get#Ln(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}static get#bn(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3]}static get#En(){return 8}static get#wn(){return 4}static get#Mn(){return Ls.PROFILE_MARGIN.toFixed(0)}static get#xn(){return(Ls.PROFILE_MARGIN+Ls.PROFILE_WIDTH).toFixed(0)}static get#In(){return Ls.PROFILE_MARGIN.toFixed(0)}static get#Cn(){return(Ls.PROFILE_MARGIN+Ls.PROFILE_HEIGHT).toFixed(0)}static get#Nn(){return(Ls.PROFILE_MARGIN-Ls.X_DELTA_TEXT).toFixed(0)}static get#Pn(){return(Ls.PROFILE_MARGIN+Ls.PROFILE_WIDTH+Ls.X_DELTA_TEXT).toFixed(0)}static get#Dn(){return Ls.PROFILE_MARGIN+Ls.PROFILE_HEIGHT+Ls.PROFILE_MARGIN/2}#On(){let t="",e=0,o=0,i=0;this.#di.itinerary.itineraryPoints.forEach((n=>{o=(Ls.PROFILE_MARGIN+this.#fn*e).toFixed(0),i=(Ls.PROFILE_MARGIN+this.#vn*(this.#yn-n.elev)).toFixed(0),t+=o+","+i+" ",e+=n.distance}));const n=document.createElementNS(_,"polyline");n.setAttributeNS(null,"points",t),n.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-profilePolyline"),this.#gn.appendChild(n)}#Sn(){const t=Ls.#Mn+","+Ls.#In+" "+Ls.#Mn+","+Ls.#Cn+" "+Ls.#xn+","+Ls.#Cn+" "+Ls.#xn+","+Ls.#In,e=document.createElementNS(_,"polyline");e.setAttributeNS(null,"points",t),e.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-framePolyline"),this.#gn.appendChild(e)}#jn(){let t=Number.MAX_VALUE,e=0;Ls.#Ln.forEach((o=>{const i=Math.abs(this.#di.distance/Ls.#En-o);i<t&&(t=i,e=o)}));let i=Math.ceil(this.#di.chainedDistance/e)*e;for(;i<this.#di.distance+this.#di.chainedDistance;){const t=document.createElementNS(_,"text");t.appendChild(document.createTextNode(o.metersInKm<e||0<this.#di.chainedDistance?i/o.metersInKm+" km":i+" m ")),t.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-distLegend"),t.setAttributeNS(null,"x",Ls.PROFILE_MARGIN+(i-this.#di.chainedDistance)*this.#fn),t.setAttributeNS(null,"y",Ls.#Dn),t.setAttributeNS(null,"text-anchor","start"),this.#gn.appendChild(t),i+=e}}#An(){let t=Number.MAX_VALUE,e=0;Ls.#bn.forEach((o=>{const i=Math.abs(this.#Tn/Ls.#wn-o);i<t&&(t=i,e=o)}));let o=Math.ceil(this.#_n/e)*e;for(;o<this.#yn;){const t=Ls.PROFILE_MARGIN+(this.#yn-o)*this.#vn,i=document.createElementNS(_,"text");i.appendChild(document.createTextNode(o.toFixed(0))),i.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),i.setAttributeNS(null,"x",Ls.#Pn),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"text-anchor","start"),this.#gn.appendChild(i);const n=document.createElementNS(_,"text");n.appendChild(document.createTextNode(o.toFixed(0))),n.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevLegend"),n.setAttributeNS(null,"x",Ls.#Nn),n.setAttributeNS(null,"y",t),n.setAttributeNS(null,"text-anchor","end"),this.#gn.appendChild(n),o+=e}}#Hn(){this.#gn=document.createElementNS(_,"svg"),this.#gn.setAttributeNS(null,"viewBox","0 0 "+(Ls.PROFILE_WIDTH+2*Ls.PROFILE_MARGIN)+" "+(Ls.PROFILE_HEIGHT+2*Ls.PROFILE_MARGIN)),this.#gn.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile")}constructor(){Object.freeze(this)}createSvg(t){return this.#di=t,this.#_n=Number.MAX_VALUE,this.#yn=0,this.#di.itinerary.itineraryPoints.forEach((t=>{this.#yn=Math.max(this.#yn,t.elev),this.#_n=Math.min(this.#_n,t.elev)})),this.#Tn=this.#yn-this.#_n,this.#vn=Ls.PROFILE_HEIGHT/this.#Tn,this.#fn=Ls.PROFILE_WIDTH/this.#di.distance,this.#Hn(),this.#On(),this.#Sn(),this.#An(),this.#jn(),this.#gn}}class bs{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.onKeydownKeyboard(t.key)}}class Es{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.onCancelMenu()}}class ws{#kn=null;#Bn=null;static get#zn(){return 100}static get#Fn(){return 30}#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){if(1===t.changedTouches.length){const e=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#kn=e.clientX,this.#Bn=e.clientY;break;case"touchend":this.#kn&&this.#Bn&&ws.#zn<this.#Bn-e.clientY&&ws.#Fn>Math.abs(this.#kn-e.clientX)&&this.#Rn.onCancelMenu(),this.#kn=null,this.#Bn=null;break;case"touchcancel":this.#kn=null,this.#Bn=null}}}}class Ms{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.onMouseLeaveMenuItem(t.currentTarget)}}class xs{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.onMouseEnterMenuItem(t.currentTarget)}}class Is{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.selectItem(Number.parseInt(t.currentTarget.dataset.tanObjId))}}class Cs{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.onMouseLeaveContainer()}}class Ns{#Rn=null;constructor(t){Object.freeze(this),this.#Rn=t}handleEvent(t){t.stopPropagation(),this.#Rn.onMouseEnterContainer()}}class Ps{static#Zn=Object.freeze({get previousItem(){return-1},get firstItem(){return 0},get nextItem(){return 1},get lastItem(){return 2}});#Kn=null;#Un;#Wn;#Vn;#Xn;#Yn;#Gn;#qn;#Jn;#$n=f;#Yo=null;#Qn(){this.#Kn.menuItemHTMLElements.forEach((t=>{t.classList.remove("TravelNotes-ContextMenu-MenuItemSelected")}))}#ts(t){switch(this.#Qn(),t){case Ps.#Zn.previousItem:case Ps.#Zn.nextItem:this.#$n+=t,f===this.#$n&&(this.#$n=this.#Kn.menuItemHTMLElements.length-1),this.#Kn.menuItemHTMLElements.length===this.#$n&&(this.#$n=0);break;case Ps.#Zn.firstItem:this.#$n=0;break;case Ps.#Zn.lastItem:this.#$n=this.#Kn.menuItemHTMLElements.length-1}this.#Kn.menuItemHTMLElements[this.#$n].classList.add("TravelNotes-ContextMenu-MenuItemSelected")}constructor(t){Object.freeze(this),this.#Kn=t,this.#Un=new bs(this),this.#Wn=new Cs(this),this.#Vn=new Ns(this),this.#Xn=new Es(this),this.#Yn=new ws(this),this.#Gn=new Is(this),this.#qn=new Ms(this),this.#Jn=new xs(this),document.addEventListener("keydown",this.#Un,!0),this.#Kn.contextMenuHTMLElement.addEventListener("mouseleave",this.#Wn),this.#Kn.contextMenuHTMLElement.addEventListener("mouseenter",this.#Vn),this.#Kn.contextMenuHTMLElement.addEventListener("touchstart",this.#Yn),this.#Kn.contextMenuHTMLElement.addEventListener("touchend",this.#Yn),this.#Kn.contextMenuHTMLElement.addEventListener("touchcancel",this.#Yn),this.#Kn.cancelButton.addEventListener("click",this.#Xn),this.#Kn.menuItemHTMLElements.forEach((t=>{t.addEventListener("click",this.#Gn),t.addEventListener("mouseleave",this.#qn),t.addEventListener("mouseenter",this.#Jn)}))}destructor(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),document.removeEventListener("keydown",this.#Un,!0),this.#Kn.contextMenuHTMLElement.removeEventListener("mouseleave",this.#Wn),this.#Kn.contextMenuHTMLElement.removeEventListener("mouseenter",this.#Vn),this.#Kn.contextMenuHTMLElement.removeEventListener("touchstart",this.#Yn),this.#Kn.contextMenuHTMLElement.removeEventListener("touchend",this.#Yn),this.#Kn.contextMenuHTMLElement.removeEventListener("touchcancel",this.#Yn),this.#Kn.cancelButton.removeEventListener("click",this.#Xn),this.#Kn.menuItemHTMLElements.forEach((t=>{t.removeEventListener("click",this.#Gn),t.removeEventListener("mouseleave",this.#qn),t.removeEventListener("mouseenter",this.#Jn)})),this.#Un=null,this.#Wn=null,this.#Vn=null,this.#Xn=null,this.#Yn=null,this.#Gn=null,this.#qn=null,this.#Jn=null,document.body.removeChild(this.#Kn.contextMenuHTMLElement),this.#Kn=null}onMouseLeaveContainer(){this.#Yo=setTimeout((()=>this.onCancelMenu()),t.contextMenu.timeout)}onMouseEnterContainer(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null)}onKeydownKeyboard(t){switch(t){case"Escape":case"Esc":this.onCancelMenu();break;case"ArrowDown":case"ArrowRight":case"Tab":this.#ts(Ps.#Zn.nextItem);break;case"ArrowUp":case"ArrowLeft":this.#ts(Ps.#Zn.previousItem);break;case"Home":this.#ts(Ps.#Zn.firstItem);break;case"End":this.#ts(Ps.#Zn.lastItem);break;case"Enter":if(f===this.#$n||this.#Kn.menuItemHTMLElements[this.#$n].classList.contains("TravelNotes-ContextMenu-ItemDisabled"))return;this.#Kn.onOk(this.#$n)}}onCancelMenu(){this.#Kn.onCancel("Canceled by user")}selectItem(t){this.#Kn.menuItemHTMLElements[t].classList.contains("TravelNotes-ContextMenu-ItemDisabled")||this.#Kn.onOk(t)}onMouseLeaveMenuItem(t){t.classList.remove("TravelNotes-ContextMenu-MenuItemSelected")}onMouseEnterMenuItem(t){this.#Qn(),this.#$n=Number.parseInt(t.dataset.tanObjId),t.classList.add("TravelNotes-ContextMenu-MenuItemSelected")}}class Ds{#kn;#Bn;#es;#os;#is;static#ns=null;#ss;#rs;#as;#ye;#ls;#Rn;static get#hs(){return 20}static get isActive(){return Boolean(Ds.#ns)}#cs(){this.#as=V.create("div",{className:"TravelNotes-ContextMenu-ContextMenuHTMLElement"},document.body)}#ds(){this.#ye=V.create("div",{textContent:"âŒ",className:"TravelNotes-ContextMenu-CancelButton",title:O.getText("BaseContextMenu - Close")},this.#as)}#us(){this.#ls=[],this.menuItems.forEach(((t,e)=>{const o=V.create("div",{textContent:t.itemText,className:"TravelNotes-ContextMenu-MenuItem",dataset:{ObjId:String(e)}},this.#as);t.isActive||o.classList.add("TravelNotes-ContextMenu-MenuItemDisabled"),this.#ls.push(o)}))}#ms(){const t=Tn.screenAvailable,e=Math.min(this.#Bn,t.height-this.#as.clientHeight-Ds.#hs);this.#as.style.top=String(e)+"px";const o=Math.min(this.#kn,t.width-this.#as.clientWidth-Ds.#hs);this.#as.style.left=String(o)+"px"}#ps(t,e){this.#ss=t,this.#rs=e,this.#cs(),this.#ds(),this.#us(),this.#ms(),this.#Rn=new Ps(this)}constructor(t,e){Object.freeze(this),Ds.#ns?Ds.#ns.onCancel():(this.#kn=t.clientX||t.originalEvent.clientX||0,this.#Bn=t.clientY||t.originalEvent.clientY||0,this.#es=[t.latlng?t.latlng.lat:a.defaultValue,t.latlng?t.latlng.lng:a.defaultValue],this.#os=t.target?.objId??(Number.parseInt(t?.currentTarget?.dataset?.tanObjId)||g),this.#is=Boolean(e),Ds.#ns=this)}onOk(t){this.#Rn.destructor(),Ds.#ns=null,this.#ss(t)}onCancel(){this.#Rn.destructor(),Ds.#ns=null,this.#rs()}show(){Ds.#ns&&new Promise(((t,e)=>{this.#ps(t,e)})).then((t=>this.menuItems[t].action())).catch((t=>{t&&console.error(t)}))}get menuItems(){return[]}get contextMenuHTMLElement(){return this.#as}get cancelButton(){return this.#ye}get menuItemHTMLElements(){return this.#ls}get clientX(){return this.#kn}get clientY(){return this.#Bn}get latLng(){return this.#es}get targetObjId(){return this.#os}get haveParentNode(){return this.#is}}class Os{#gs;#vs;#fs;constructor(t,e,o){Object.freeze(this),this.#gs=t,this.#vs=e,this.#fs=o}get itemText(){return this.#gs}get isActive(){return this.#vs}get action(){return this.#fs}}class Ss{#U;#_s;#ys;#yt;#Ts;constructor(t){this.#U="string"==typeof t?.name?D.sanitizeToJsString(t.name):"?",this.#_s="string"==typeof t.icon?D.sanitizeToHtmlString(t?.icon).htmlString:"?",this.#ys="string"==typeof t?.tooltip?D.sanitizeToHtmlString(t.tooltip).htmlString:"?",this.#yt="number"==typeof t?.width?t.width:s.width,this.#Ts="number"==typeof t?.height?t.height:s.height}get name(){return this.#U}get icon(){return this.#_s}get tooltip(){return this.#ys}get width(){return this.#yt}get height(){return this.#Ts}}class js{#re;#Ls;#bs;constructor(t){if(Object.freeze(this),"string"!=typeof t?.title||"string"!=typeof t?.htmlBefore||t.htmlAfter&&"string"!=typeof t.htmlAfter)throw new Error("Invalid toolbar button");let e=(t.htmlBefore||"")+(t.htmlAfter||""),o=D.sanitizeToHtmlString(e).errorsString;if(""!==o)throw new Error("Invalid toolbar button : "+e+o);this.#re=D.sanitizeToHtmlString(t.title).htmlString,""===this.title&&(this.title="?"),this.#Ls=t.htmlBefore||"",this.#bs=t.htmlAfter||""}get title(){return this.#re}get htmlBefore(){return this.#Ls}get htmlAfter(){return this.#bs}}const As=new class{#Es;#ws;#Ms;constructor(){Object.freeze(this),this.#Es=[],this.#ws=new Map,this.#Ms=[]}get editionButtonsData(){return this.#Es}get preDefinedIconsData(){return this.#Ms}preDefinedIconDataAt(t){return this.#Ms[t]}preDefinedIconDataFromName(t){const e=this.#ws.get(t);return e?e.icon:""}loadJson(t){if(t.editionButtons&&t.editionButtons.forEach((t=>{try{let e=new js(t);this.#Es.push(e)}catch(t){console.error(t.message)}})),t.preDefinedIconsList){t.preDefinedIconsList.forEach((t=>{const e=new Ss(t);this.#ws.set(e.name,e)})),this.#Ms.length=0;for(const t of this.#ws)this.#Ms.push(t[1]);this.#Ms=this.#Ms.sort(((t,e)=>t.name.localeCompare(e.name)))}}};class Hs{#xs;#Is;#Cs;#Ns;#Ps(){this.#Is=V.create("select",{className:"TravelNotes-NoteDialog-Select",id:"TravelNotes-NoteDialog-IconSelect"},this.#xs),As.preDefinedIconsData.forEach((t=>{this.#Is.add(V.create("option",{text:t.name}))})),this.#Is.selectedIndex=f}#Bo(){this.#Cs=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("NoteDialogToolbar - Open a configuration file"),textContent:"ðŸ“‚"},this.#xs)}#Ds(){As.editionButtonsData.forEach((t=>{const e=V.create("div",{dataset:{HtmlBefore:t.htmlBefore,HtmlAfter:t.htmlAfter},className:"TravelNotes-NoteDialog-EditorButton"},this.#xs);D.sanitizeToHtmlElement(t.title,e),this.#Ns.push(e)}))}#Os(){this.#Ps(),this.#Bo(),this.#Ds()}#Ss(t){this.#Is.addEventListener("change",t.iconSelectorChange),this.#Ns.forEach((e=>{e.addEventListener("click",t.editionButtonsClick)})),this.#Cs.addEventListener("click",t.openCfgFileButtonClick,!1)}#js(t){this.#Is.removeEventListener("change",t.iconSelectorChange),this.#Ns.forEach((e=>{e.removeEventListener("click",t.editionButtonsClick)})),this.#Cs.removeEventListener("click",t.openCfgFileButtonClick,!1)}constructor(t){Object.freeze(this),this.#Ns=[],this.#xs=V.create("div",{id:"TravelNotes-NoteDialog-ToolbarDiv"}),this.#Os(),this.#Ss(t)}destructor(t){this.#js(t)}update(t){this.#js(t),this.#xs.textContent="",this.#Ns=[],this.#Os(),this.#Ss(t)}get rootHTMLElement(){return this.#xs}}class Rs{#es;#di;constructor(t,e){Object.freeze(this),this.#es=t,this.#di=e}get latLng(){return this.#es}get route(){return this.#di}}class ks extends Mn{#As;constructor(t,e){super(),V.create("div",{textContent:t?.headerText||"",className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement),this.#As=V.create("textarea",{className:"TravelNotes-TextAreaControl-TextArea",placeholder:t?.placeholder||"",rows:t.rows||2,dataset:{Name:t?.datasetName||"TextAreaControl"}},V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),e.controlFocus&&this.#As.addEventListener("focus",e.controlFocus),e.controlInput&&this.#As.addEventListener("input",e.controlInput)}destructor(t){t.controlFocus&&this.#As.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#As.removeEventListener("input",t.controlInput)}get value(){return this.#As.value}set value(t){this.#As.value=t}}class Bs extends Mn{#Hs;#Rs;constructor(t){super();const e=V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement);this.#Rs=V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("AddressControl - Reset address"),textContent:"ðŸ”„"},e),V.create("text",{value:O.getText("AddressControl - Address")},e),this.#Hs=V.create("input",{type:"text",className:"TravelNotes-AdressControl-InputText",dataset:{Name:"address"}},V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),t.controlFocus&&this.#Hs.addEventListener("focus",t.controlFocus),t.controlInput&&this.#Hs.addEventListener("input",t.controlInput),t.addressButtonClick&&this.#Rs.addEventListener("click",t.addressButtonClick)}destructor(t){t.controlFocus&&this.#Hs.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#Hs.removeEventListener("input",t.controlInput),t.addressButtonClick&&this.#Rs.removeEventListener("click",t.addressButtonClick)}get address(){return this.#Hs.value}set address(t){this.#Hs.value=t}}class zs{searchPlaces=!0;searchWays=!0;searchRelations=!0;setGeometry=!0;constructor(){Object.seal(this)}}class Fs{#xe;#ks;#Bs;#zs;#Fs;#Zs;#Ks;#es;#Us;#Ws;#Vs;#Xs(){this.#Bs.forEach((t=>{t.geometry=[[]],t.lat=a.defaultValue,t.lon=a.defaultValue;let e=0;t.nodes.forEach((o=>{const i=this.#ks.get(o);t.geometry[0].push([i.lat,i.lon]),t.lat+=i.lat,t.lon+=i.lon,e++})),0!==e&&(t.lat/=e,t.lon/=e)})),this.#zs.forEach((t=>{t.geometry=[[]],t.lat=a.defaultValue,t.lon=a.defaultValue;let e=0;t.members.forEach((o=>{if("way"===o.type){const i=this.#Bs.get(o.ref);t.geometry.push(i.geometry[0]),t.lat+=i.lat,t.lon+=i.lon,e++}})),0!==e&&(t.lat/=e,t.lon/=e)}))}#Ys(e){e.forEach((e=>{switch(e.type){case"node":if(this.#ks.set(e.id,e),e?.tags?.place&&this.#xe.searchPlaces&&this.#Ks[e.tags.place]&&e?.tags?.name){const t=Vn.pointsDistance(this.#es,[e.lat,e.lon]),o=this.#Ks[e.tags.place];o.maxDistance>t&&o.distance>t&&(o.distance=t,o.name=e.tags.name)}break;case"way":this.#xe.searchWays&&this.#Bs.set(e.id,e);break;case"relation":this.#xe.searchRelations&&this.#zs.set(e.id,e);break;case"area":if(this.#xe.searchPlaces){let o=e.tags.name;"*"!==t.nominatim.language&&e.tags["name:"+t.nominatim.language]&&(o=e.tags["name:"+t.nominatim.language]),this.#Fs[Number.parseInt(e.tags.admin_level)]=o,"2"===e.tags.admin_level&&(this.#Zs=t.geoCoder.osmCityAdminLevel[e.tags["ISO3166-1"]]||this.#Zs)}}})),this.#xe.setGeometry&&this.#Xs(),this.#xe.searchPlaces&&this.#Gs()}#Gs(){let t=null;for(let e=2;e<this.#Fs.length;e++)void 0!==this.#Fs[e]&&(this.#Zs>=e?this.#Ws=this.#Fs[e]:t=this.#Fs[e]);let e=Number.MAX_VALUE;Object.values(this.#Ks).forEach((t=>{t.distance<e&&(e=t.distance,this.#Us=t.name)})),this.#Us=t||this.#Us,this.#Us===this.#Ws&&(this.#Us=null)}async#qs(t){for(let e=0;e<t.length;e++)if("fulfilled"===t[e].status&&p===t[e].value.status&&t[e].value.ok){const o=await t[e].value.json();this.#Ys(o.elements)}else this.#Vs=!1,console.error("An error occurs when calling theOverpassAPI: "),console.error(t[e])}constructor(t){if(Object.freeze(this),this.#xe=new zs,t)for(const[e,o]of Object.entries(t))this.#xe[e]&&(this.#xe[e]=o);this.#ks=new Map,this.#Bs=new Map,this.#zs=new Map}async loadData(e,o){this.#es=o,this.#Vs=!0,this.#Fs=[],this.#Zs=t.geoCoder.osmCityAdminLevel.DEFAULT,this.#Ks=Object.freeze({hamlet:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.hamlet}),village:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.village}),city:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.city}),town:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.town})}),this.#Us=null,this.#Ws=null,this.#ks.clear(),this.#Bs.clear(),this.#zs.clear();const i=[];e.forEach((e=>{i.push(fetch(t.overpassApi.url+"?data=[out:json][timeout:"+t.overpassApi.timeOut+"];"+e))})),await Promise.allSettled(i).then((t=>this.#qs(t)))}get nodes(){return this.#ks}get ways(){return this.#Bs}get relations(){return this.#zs}get place(){return this.#Us}get city(){return this.#Ws}get country(){return this.#Fs[2]}get statusOk(){return this.#Vs}}class Zs{#Js=!1;#U="";#$s="";#Ws="";#Qs="";#tr(t,e){t.error||e.error?this.#Js=!1:(this.#U=e.namedetails.name,e.address.house_number&&(this.#$s=e.address.house_number+" "),e.address.road?this.#$s+=e.address.road+" ":e.address.pedestrian&&(this.#$s+=e.address.pedestrian+" "),this.#Ws=t.address.city||t.address.town||t.address.municipality||t.address.village||"",this.#Qs=e.address.country,this.#Js=!0)}constructor(){Object.freeze(this)}async loadData(e){this.#Js=!1;const o=t.nominatim.url+"reverse?format=json&lat="+e[0]+"&lon="+e[1];let i=o+"&zoom=10&addressdetails=1&namedetails=0",n=o+"&zoom=18&addressdetails=1&namedetails=1";const s=t.nominatim.language;s&&"*"!==s&&(i+="&accept-language="+s,n+="&accept-language="+s);const r=new Headers;s&&"*"===s&&r.append("accept-language","");const a=await fetch(i,{headers:r}),l=await fetch(n,{headers:r});p===a.status&&a.ok&&p===l.status&&l.ok?this.#tr(await a.json(),await l.json()):this.#Js=!1}get name(){return this.#Js?this.#U:null}get street(){return this.#Js?this.#$s:null}get city(){return this.#Js?this.#Ws:null}get country(){return this.#Js?this.#Qs:null}}class Ks{#U;#$s;#Ws;constructor(t,e,o){Object.freeze(this),this.#U=D.sanitizeToJsString(t),this.#$s=D.sanitizeToJsString(e),this.#Ws=D.sanitizeToJsString(o)}get name(){return this.#U}get street(){return this.#$s}get city(){return this.#Ws}}class Us{static get#er(){return Math.max(t.geoCoder.distances.hamlet,t.geoCoder.distances.village,t.geoCoder.distances.city,t.geoCoder.distances.town)}#es;#or;#ir;#nr(){let t=this.#ir.city||this.#ir.country||"";const e=this.#or.place;e&&e!==t&&(t+=" ("+e+")");let o=(this.#ir.street||"").replaceAll(";"," "),i=this.#ir.name||"";return(o.includes(i)||t.includes(i))&&(i=""),new Ks(i,o,t)}#sr(){return["node(around:"+Us.#er+","+this.#es[0]+","+this.#es[1]+")[place];out;"]}async#rr(){return await this.#or.loadData(this.#sr(),this.#es),await this.#ir.loadData(this.#es),this.#nr()}async#ar(t,e){t(await this.#rr())}constructor(){Object.freeze(this),this.#or=new Fs({searchWays:!1,searchRelations:!1,setGeometry:!0}),this.#ir=new Zs({searchPlaces:!0,searchWays:!1,searchRelations:!1,setGeometry:!1})}async getAddressAsync(t){return this.#es=t,this.#rr()}getAddressWithPromise(t){return this.#es=t,new Promise(((t,e)=>this.#ar(t,e)))}}class Ws{#lr;#hr(t){this.#lr.hideWait();let e=t.street;""!==t.city&&(e+=" "+t.city),this.#lr.setControlsValues({address:e,name:t.name}),this.#lr.updatePreview&&this.#lr.updatePreview({address:e})}constructor(t){Object.freeze(this),this.#lr=t}setAddressWithGeoCoder(t){this.#lr.showWait(),this.#lr.hideError(),(new Us).getAddressWithPromise(t).then((t=>{this.#hr(t)})).catch((t=>{t&&console.error(t),this.#lr.hideWait(),this.#lr.showError(O.getText("NoteDialogGeoCoderHelper - an error occurs when searching the adress"))}))}}class Vs extends Mn{#cr=null;#dr=null;constructor(t){super(),V.create("text",{value:O.getText("NoteDialogIconDimsControl - Icon width")},this.controlHTMLElement),this.#cr=V.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",value:s.width,dataset:{Name:"iconWidth"}},this.controlHTMLElement),V.create("text",{value:O.getText("NoteDialogIconDimsControl - Icon height")},this.controlHTMLElement),this.#dr=V.create("input",{type:"number",className:"TravelNotes-NoteDialog-NumberInput",value:s.height,dataset:{Name:"iconHeight"}},this.controlHTMLElement),this.#cr.addEventListener("input",t.controlInput),this.#dr.addEventListener("input",t.controlInput)}destructor(t){this.#cr.removeEventListener("input",t.controlInput),this.#dr.removeEventListener("input",t.controlInput)}get iconWidth(){return Number.parseInt(this.#cr.value)}set iconWidth(t){this.#cr.value=t}get iconHeight(){return Number.parseInt(this.#dr.value)}set iconHeight(t){this.#dr.value=t}}class Xs extends Mn{#ur;#mr(e,o){t.noteDialog.theDevil.addButton&&V.create("text",{value:"ðŸ‘¿"},V.create("a",{href:"https://www.google.com/maps/@"+e[0].toFixed(a.fixed)+","+e[1].toFixed(a.fixed)+","+t.noteDialog.theDevil.zoomFactor+"z",target:"_blank",title:"Reminder! The devil will know everything about you"},V.create("div",{className:"TravelNotes-BaseDialog-Button",title:"Reminder! The devil will know everything about you"},o)))}constructor(t,e){super();const o=V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement);this.#mr(e,o),V.create("text",{value:O.getText("NoteDialogLinkControl - Link")},o),this.#ur=V.create("input",{type:"text",className:"TravelNotes-NoteDialog-InputText",dataset:{Name:"url"}},V.create("div",{className:"TravelNotes-BaseDialog-FlexRow"},this.controlHTMLElement)),this.#ur.addEventListener("focus",t.controlFocus),this.#ur.addEventListener("input",t.controlInput),this.#ur.addEventListener("blur",t.urlInputBlur)}destructor(t){this.#ur.removeEventListener("focus",t.controlFocus),this.#ur.removeEventListener("input",t.controlInput),this.#ur.removeEventListener("blur",t.urlInputBlur)}get url(){return this.#ur.value}set url(t){this.#ur.value=t}}class Ys{static get#pr(){return 40}static get#gr(){return 40}constructor(){Object.freeze(this)}getNoteTextAndIconHTML(e,o){const i=V.create("div",{dataset:{ObjId:o.note.objId}}),n=V.create("div",{className:e+(o.route?"Route-ManeuversAndNotes-IconCell":"Travel-Notes-IconCell")},i);let r=1;D.sanitizeToHtmlElement(o.note.iconContent,n),"TravelNotes-Roadbook-"===e&&n.firstChild&&("svg"===n.firstChild.tagName?(n.firstChild.setAttributeNS(null,"viewBox","0 0 "+s.svgViewboxDim+" "+s.svgViewboxDim),r=t.note.svgIcon.roadbookFactor):n?.firstChild?.classList?.contains("TravelNotes-MapNoteCategory-0073")&&(r=t.note.svgIcon.roadbookFactor)),n.dataset.tanWidth=String(o.note.iconWidth*r)+"px",n.dataset.tanHeight=String(o.note.iconHeight*r)+"px",n.style.width=String(o.note.iconWidth*r)+"px",n.style.height=String(o.note.iconHeight*r)+"px";const a=this.getNoteTextHTML(e,o);return a.className=e+(o.route?"Route-ManeuversAndNotes-Cell":"Travel-Notes-Cell"),i.appendChild(a),i}getNoteTextHTML(t,e){const o=e.note,i=V.create("div");if(0!==o.tooltipContent.length&&D.sanitizeToHtmlElement(o.tooltipContent,V.create("div",{className:t+"NoteHtml-TooltipContent"},i)),0!==o.popupContent.length&&D.sanitizeToHtmlElement(o.popupContent,V.create("div",{className:t+"NoteHtml-PopupContent"},i)),0!==o.address.length&&D.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Address")+"</span>Â :Â "+o.address,V.create("div",{className:t+"NoteHtml-Address"},i)),0!==o.url.length&&D.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Link")+"</span><a href="+o.url+' target="_blank" >'+o.url.substring(0,Ys.#pr)+"...</a>",V.create("div",{className:t+"NoteHtml-Url"},i)),0!==o.phone.length){let e=o.phone;if(o.phone.match(/^\+[0-9, ,*,\u0023]*$/)){const t=o.phone.replaceAll(/\u0020/g,""),i=o.phone.replaceAll(/\u0020/g,"Â ");e=O.getText("NoteHTMLViewsFactory - Phone")+"Â :Â "+O.getText("NoteHTMLViewsFactory - call")+'<a target="_blank" href="tel:'+t+'" >'+i+"</a>"+O.getText("NoteHTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+t+'" >'+i+"</a>"}else e=O.getText("NoteHTMLViewsFactory - Phone")+"Â :Â "+o.phone;D.sanitizeToHtmlElement(e,V.create("div",{className:t+"NoteHtml-Phone"},i))}if(D.sanitizeToHtmlElement(S.formatLatLng(o.latLng),V.create("div",{className:t+"NoteHtml-LatLng"},i)),e.route){e.route.chain&&D.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+S.formatDistance(o.chainedDistance+o.distance),V.create("div",{className:t+"NoteHtml-TravelDistance"},i)),D.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+S.formatDistance(o.distance),V.create("div",{className:t+"NoteHtml-RouteDistance"},i));const n=e.route.notes.next(o.objId);if(n){const e=n.distance-o.distance;Ys.#gr<e&&D.sanitizeToHtmlElement("<span>"+O.getText("NoteHTMLViewsFactory - Next note after")+"</span>Â :Â "+S.formatDistance(e),V.create("div",{className:t+"NoteHtml-NextDistance"},i))}}return i}getTravelNotesHTML(t){const e=V.create("div",{className:t+"Travel-Notes"}),o=U.travel.notes.iterator;for(;!o.done;){const i=this.getNoteTextAndIconHTML(t,{note:o.value,route:null});i.className=t+"Travel-Notes-Row",e.appendChild(i)}return e}}const Gs=new Ys;class qs{#vr;#fr;constructor(t){Object.freeze(this),this.#fr=t,this.#vr=V.create("div",{className:"TravelNotes-NoteDialog-PreviewDiv"}),this.#vr.appendChild(Gs.getNoteTextAndIconHTML("TravelNotes-NoteDialog-",new Xn(this.#fr,null)))}update(){this.#vr.textContent="",this.#vr.appendChild(Gs.getNoteTextAndIconHTML("TravelNotes-NoteDialog-",{note:this.#fr,route:null}))}get HTMLElements(){return[this.#vr]}}class Js{#_r;constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){t.stopPropagation(),"url"===t.target.dataset.tanName?this.#_r.focusControl=null:this.#_r.focusControl=t.target}}class $s{#_r;constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){t.stopPropagation();const e={};"iconWidth"===t.target.dataset.tanName||"iconHeight"===t.target.dataset.tanName?e[t.target.dataset.tanName]=Number.parseInt(t.target.value):e[t.target.dataset.tanName]=t.target.value,this.#_r.updatePreview(e)}}class Qs{#lr;#es;constructor(t,e){Object.freeze(this),this.#lr=t,this.#es=e}handleEvent(t){t.stopPropagation(),new Ws(this.#lr).setAddressWithGeoCoder(this.#es)}}class tr{#_r;constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){if(t.stopPropagation(),""===t.target.value)return void this.#_r.hideError();""===D.sanitizeToUrl(t.target.value).errorsString?this.#_r.hideError():this.#_r.showError(O.getText("UrlInputBlurEL - invalidUrl"))}}class er{#_r;constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){if(!this.#_r.focusControl)return;const e=t.currentTarget;let o=this.#_r.focusControl.selectionStart,i=this.#_r.focusControl.selectionEnd;this.#_r.focusControl.value=this.#_r.focusControl.value.slice(0,o)+e.dataset.tanHtmlBefore+(0===e.dataset.tanHtmlAfter.length?"":this.#_r.focusControl.value.slice(o,i))+e.dataset.tanHtmlAfter+this.#_r.focusControl.value.slice(i),o===i||0===e.dataset.tanHtmlAfter.length?(o+=e.dataset.tanHtmlBefore.length,i=o):i+=e.dataset.tanHtmlBefore.length+e.dataset.tanHtmlAfter.length,this.#_r.focusControl.setSelectionRange(o,i),this.#_r.focusControl.focus();const n={};n[this.#_r.focusControl.dataset.tanName]=this.#_r.focusControl.value,this.#_r.updatePreview(n)}}class or{#yr;#or;#Tr;#Lr(){this.#Tr=document.createElementNS(_,"svg"),this.#Tr.setAttributeNS(null,"viewBox",String(s.svgViewboxDim/4)+" "+s.svgViewboxDim/4+" "+s.svgViewboxDim/2+" "+s.svgViewboxDim/2),this.#Tr.setAttributeNS(null,"class","TravelNotes-SvgIcon")}#br(){let e=-1,o=f,i=f;const n=[];if(this.#yr.route.itinerary.itineraryPoints.forEach((r=>{e++;const a=un.addPoints(un.project(r.latLng,t.note.svgIcon.zoom),this.#yr.translation);n.push(a);a[0]>=0&&a[1]>=0&&a[0]<=s.svgViewboxDim&&a[1]<=s.svgViewboxDim&&(f===o&&(o=e),i=e)})),f!==o&&f!==i){0<o&&o--,this.#yr.route.itinerary.itineraryPoints.length-1>i&&i++;let t="";for(e=o;e<=i;e++)t+=n[e][0].toFixed(0)+","+n[e][1].toFixed(0)+" ";const r=document.createElementNS(_,"polyline");r.setAttributeNS(null,"points",t),r.setAttributeNS(null,"class","TravelNotes-OSM-Itinerary"),r.setAttributeNS(null,"transform","rotate("+this.#yr.rotation+","+s.svgViewboxDim/2+","+s.svgViewboxDim/2+")"),this.#Tr.appendChild(r)}}#Er(){this.#or.ways.forEach((e=>{let o=f,i=f,n=-1;const r=[];if(e.nodes.forEach((e=>{n++;const a=this.#or.nodes.get(e),l=un.addPoints(un.project([a.lat,a.lon],t.note.svgIcon.zoom),this.#yr.translation);r.push(l);l[0]>=0&&l[1]>=0&&l[0]<=s.svgViewboxDim&&l[1]<=s.svgViewboxDim&&(f===o&&(o=n),i=n)})),f!==o&&f!==i){0<o&&o--,e.nodes.length-1>i&&i++;let t="";for(n=o;n<=i;n++)t+=r[n][0].toFixed(0)+","+r[n][1].toFixed(0)+" ";const a=document.createElementNS(_,"polyline");a.setAttributeNS(null,"points",t),a.setAttributeNS(null,"class","TravelNotes-OSM-Highway TravelNotes-OSM-Highway-"+e.tags.highway),a.setAttributeNS(null,"transform","rotate("+this.#yr.rotation+","+s.svgViewboxDim/2+","+s.svgViewboxDim/2+")"),this.#Tr.appendChild(a)}}))}#wr(){if(""===this.#yr.rcnRef)return;const t=document.createElementNS(_,"text");t.textContent=this.#yr.rcnRef,t.setAttributeNS(null,"x",String(s.svgViewboxDim/2)),t.setAttributeNS(null,"y",String(s.svgViewboxDim/2)),t.setAttributeNS(null,"class","TravelNotes-OSM-RcnRef"),this.#Tr.appendChild(t)}constructor(){Object.freeze(this)}buildSvg(t,e,o){this.#yr=t,this.#or=o,this.#Lr(),this.#br(),this.#Er(),this.#wr(),e.iconContent=this.#Tr.outerHTML}}class ir{isMini;isEntry;isExit;constructor(){Object.seal(this),this.isMini=!1,this.isEntry=!1,this.isExit=!1}}class nr{#yr;#Mr;#or;#xr;#Ir;#Cr;#Nr;#Pr;#Dr;#Or;#Sr;#jr(t){return(t.tags.name?t.tags.name:"")+(t.tags.name&&t.tags.ref?" ":"")+(t.tags.ref?"["+t.tags.ref+"]":"")}#Ar(t){const e=5e-6;let o=!1;return this.#yr.route.wayPoints.forEach((i=>{Math.abs(t.lat-i.lat)<e&&Math.abs(t.lng-i.lng)<e&&(o=!0)})),!o&&(this.#Mr.latLng[0]!==t.lat||this.#Mr.latLng[1]!==t.lng)}#Hr(){const e=this.#yr.route.itinerary.itineraryPoints.previous(this.#yr.nearestItineraryPointObjId,(t=>this.#Ar(t))),i=this.#yr.route.itinerary.itineraryPoints.next(this.#yr.nearestItineraryPointObjId,(t=>this.#Ar(t)));let n=Number.MAX_VALUE,s=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MAX_VALUE,l=o.defaultValue;this.#or.nodes.forEach((o=>{l=Vn.pointsDistance([o.lat,o.lon],this.#Mr.latLng),"bike"===this.#yr.route.itinerary.transitMode&&o?.tags?.rcn_ref&&o.tags["network:type"]&&"node_network"===o.tags["network:type"]&&l<t.note.svgIcon.rcnRefDistance&&l<s&&(this.#xr=o,s=l),l<n&&(this.#Cr=o.id,n=l),e&&(l=Vn.pointsDistance([o.lat,o.lon],e.latLng),l<r&&(this.#Nr=o.id,r=l)),i&&(l=Vn.pointsDistance([o.lat,o.lon],i.latLng),l<a&&(this.#Pr=o.id,a=l))})),this.#Ir=this.#or.nodes.get(this.#Cr)}#Rr(){this.#Sr.isMini="mini_roundabout"===this?.#Ir?.tags?.highway}#kr(){this.#xr&&(this.#yr.rcnRef=this.#xr.tags.rcn_ref,this.#Mr.tooltipContent+=O.getText("StreetFinder - rcnRef",{rcnRef:this.#yr.rcnRef}))}#Br(){this.#or.ways.forEach((t=>{if(!t.nodes.includes(this.#Cr))return;const e=this.#jr(t),o=""!==e,i=t.nodes.includes(this.#Nr),n=t.nodes.includes(this.#Pr);let s=2*t.nodes.filter((t=>t===this.#Cr)).length;if(t.nodes[0]===this.#Cr&&s--,t.nodes[t.nodes.length-1]===this.#Cr&&s--,i&&(this.#Dr=o?e:"???",s--,"roundabout"===t?.tags?.junction&&(this.#Sr.isExit=!0)),0!==s&&(n&&(this.#Or=o?e:"???",s--,"roundabout"===t?.tags?.junction&&(this.#Sr.isEntry=!0)),0!==s&&o))for(;0!==s;)this.#Mr.address=""===this.#Mr.address?e:this.#Mr.address+" âª¥  "+e,s--}))}#zr(){""!==this.#or.city&&(this.#Mr.address+=' <span class="TravelNotes-NoteHtml-Address-City">'+this.#or.city+"</span>"),this.#or.place&&this.#or.place!==this.#or.city&&(this.#Mr.address+=" ("+this.#or.place+")")}#Fr(){r.atStart===this.#yr.positionOnRoute?(this.#Mr.address="ðŸŸ¢ "+this.#Or,this.#zr()):r.atEnd===this.#yr.positionOnRoute?(this.#zr(),this.#Mr.address=this.#Dr,this.#zr(),this.#Mr.address+=" ðŸ”´ "):(this.#Mr.address=this.#Dr+(""===this.#Mr.address?"":" âª¥  "+this.#Mr.address)+" "+this.#yr.directionArrow+" "+this.#Or,this.#zr())}#Zr(){this.#Sr.isEntry&&!this.#Sr.isExit?this.#Mr.tooltipContent+=O.getText("StreetFinder - entry roundabout"):!this.#Sr.isEntry&&this.#Sr.isExit?this.#Mr.tooltipContent+=O.getText("StreetFinder - exit roundabout"):this.#Sr.isEntry&&this.#Sr.isExit&&(this.#Mr.tooltipContent+=O.getText("StreetFinder - continue roundabout")),this.#Sr.isMini&&(this.#Mr.tooltipContent+=O.getText("StreetFinder - at the small roundabout on the ground"))}constructor(){Object.freeze(this)}findData(t,e,o){this.#yr=t,this.#Mr=e,this.#or=o,this.#Cr=f,this.#Nr=f,this.#Pr=f,this.#Dr="",this.#Or="",this.#Sr=new ir,this.#Hr(),this.#Rr(),this.#kr(),this.#Br(),this.#Fr(),this.#Zr()}}class sr{constructor(){Object.freeze(this)}findData(e,o){null!==e.direction&&(e.direction<t.note.svgIcon.angleDirection.right?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn right"),e.directionArrow="ðŸ¢‚"):e.direction<t.note.svgIcon.angleDirection.slightRight?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn slight right"),e.directionArrow="ðŸ¢…"):e.direction<t.note.svgIcon.angleDirection.continue?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Continue"),e.directionArrow="ðŸ¢"):e.direction<t.note.svgIcon.angleDirection.slightLeft?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn slight left"),e.directionArrow="ðŸ¢„"):e.direction<t.note.svgIcon.angleDirection.left?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn left"),e.directionArrow="ðŸ¢€"):e.direction<t.note.svgIcon.angleDirection.sharpLeft?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn sharp left"),e.directionArrow="ðŸ¢‡"):e.direction<t.note.svgIcon.angleDirection.sharpRight?(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn sharp right"),e.directionArrow="ðŸ¢†"):(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Turn right"),e.directionArrow="ðŸ¢‚")),r.atStart===e.positionOnRoute?o.tooltipContent=O.getText("ArrowAndTooltipFinder - Start"):r.atEnd===e.positionOnRoute&&(o.tooltipContent=O.getText("ArrowAndTooltipFinder - Stop"))}}class rr{#yr;#Mr;#Kr;#Ur;#Wr;#Vr(){this.#yr.translation=un.subtrackPoints([s.svgViewboxDim/2,s.svgViewboxDim/2],un.project(this.#Mr.latLng,t.note.svgIcon.zoom))}#Xr(){this.#Kr=this.#yr.route.itinerary.itineraryPoints.previous(this.#yr.nearestItineraryPointObjId,(e=>Vn.pointsDistance(e.latLng,this.#Mr.latLng)>t.note.svgIcon.angleDistance))||this.#yr.route.itinerary.itineraryPoints.first}#Yr(){this.#Ur=this.#yr.route.itinerary.itineraryPoints.next(this.#yr.nearestItineraryPointObjId,(e=>Vn.pointsDistance(e.latLng,this.#Mr.latLng)>t.note.svgIcon.angleDistance))||this.#yr.route.itinerary.itineraryPoints.last}#Gr(){this.#Wr=un.addPoints(un.project(this.#Mr.latLng,t.note.svgIcon.zoom),this.#yr.translation)}#qr(){if(this.#yr.nearestItineraryPointObjId!==this.#yr.route.itinerary.itineraryPoints.first.objId){const o=un.addPoints(un.project(this.#Kr.latLng,t.note.svgIcon.zoom),this.#yr.translation);this.#yr.rotation=Math.atan((this.#Wr[1]-o[1])/(o[0]-this.#Wr[0]))*e.d180/Math.PI,0>this.#yr.rotation&&(this.#yr.rotation+=e.d360),this.#yr.rotation-=e.d270,0>o[0]-this.#Wr[0]&&(this.#yr.rotation+=e.d180)}}#Jr(){if(this.#yr.nearestItineraryPointObjId!==this.#yr.route.itinerary.itineraryPoints.last.objId){const o=un.addPoints(un.project(this.#Ur.latLng,t.note.svgIcon.zoom),this.#yr.translation);for(this.#yr.direction=Math.atan((this.#Wr[1]-o[1])/(o[0]-this.#Wr[0]))*e.d180/Math.PI,0>o[0]-this.#Wr[0]&&(this.#yr.direction+=e.d180),this.#yr.direction-=this.#yr.rotation;e.d0>this.#yr.direction;)this.#yr.direction+=e.d360;for(;e.d360<this.#yr.direction;)this.#yr.direction-=e.d360}}#$r(){this.#yr.nearestItineraryPointObjId===this.#yr.route.itinerary.itineraryPoints.first.objId&&(this.#yr.rotation=-this.#yr.direction-e.d90,this.#yr.direction=null,this.#yr.positionOnRoute=r.atStart),this.#Mr.latLng[0]===this.#yr.route.itinerary.itineraryPoints.last.lat&&this.#Mr.latLng[1]===this.#yr.route.itinerary.itineraryPoints.last.lng&&(this.#yr.direction=null,this.#yr.positionOnRoute=r.atEnd)}constructor(){Object.freeze(this)}findData(t,e){this.#yr=t,this.#Mr=e,this.#Vr(),this.#Xr(),this.#Yr(),this.#Gr(),this.#qr(),this.#Jr(),this.#$r()}}class ar{constructor(){Object.seal(this)}iconContent="";tooltipContent="";address="";latLng=[a.defaultValue,a.defaultValue]}class lr{constructor(){Object.seal(this)}nearestItineraryPointObjId=g;route=null;positionOnRoute=r.onRoute;direction=null;directionArrow=" ";rcnRef="";rotation=0;translation=[0,0]}class hr{#Mr;#yr;#or;#er;#Qr;static get#ta(){return 1.5}#ea(){let t=null,e=Number.MAX_VALUE;this.#yr.route.itinerary.itineraryPoints.forEach((o=>{const i=Vn.pointsDistance(this.#Mr.latLng,o.latLng);e>i&&(e=i,t=o)})),this.#Mr.latLng=t.latLng,this.#yr.nearestItineraryPointObjId=t.objId}#oa(){return(new rr).findData(this.#yr,this.#Mr),(new sr).findData(this.#yr,this.#Mr),(new nr).findData(this.#yr,this.#Mr,this.#or),(new or).buildSvg(this.#yr,this.#Mr,this.#or),this.#Qr=!1,this.#Mr}async#ia(){if(this.#Qr)return null;this.#Qr=!0,this.#yr.nearestItineraryPointObjId=g,this.#yr.positionOnRoute=r.onRoute,this.#yr.direction=null,this.#yr.directionArrow=" ",this.#yr.translation=[0,0],this.#yr.rotation=0,this.#yr.rcnRef="",this.#Mr.iconContent="",this.#Mr.tooltipContent="",this.#Mr.address="",this.#ea();const t=this.#Mr.latLng[0].toFixed(a.fixed)+","+this.#Mr.latLng[1].toFixed(a.fixed),e=["way[highway](around:"+(s.svgViewboxDim*hr.#ta).toFixed(0)+","+t+")->.a;(.a >;.a;)->.a;.a out;is_in("+t+')->.e;area.e[admin_level][boundary="administrative"];out;node(around:'+this.#er+","+t+")[place];out;"];return await this.#or.loadData(e,this.#Mr.latLng),this.#or.statusOk?this.#oa():null}async#na(t,e){const o=await this.#ia();o?t(o):e("An error occurs...")}constructor(){Object.freeze(this),this.#Mr=new ar,this.#yr=new lr,this.#or=new Fs({searchRelations:!1,setGeometry:!1}),this.#er=Math.max(t.geoCoder.distances.hamlet,t.geoCoder.distances.village,t.geoCoder.distances.city,t.geoCoder.distances.town),this.#Qr=!1}async getIconAndAdressAsync(t,e){return this.#Mr.latLng=t,this.#yr.route=e,this.#ia()}getIconAndAdressWithPromise(t){return this.#Mr.latLng=t.latLng,this.#yr.route=t.route,new Promise(((t,e)=>this.#na(t,e)))}}class cr{#_r;#sa(t){this.#_r.setControlsValues(t),this.#_r.updatePreview(t)}#ra(){const t=this.#_r.mapIconData;t.route?(this.#_r.hideError(),this.#_r.showWait(),(new hr).getIconAndAdressWithPromise(t).then((t=>{this.#_r.hideWait(),this.#sa(t)})).catch((t=>{t instanceof Error&&console.error(t),this.#_r.hideWait(),this.#_r.showError(O.getText("IconSelectorChangeEL - an error occurs when creating the SVG icon"))}))):this.#_r.showError(O.getText("IconSelectorChangeEL - not possible to create a SVG icon for a travel note"))}constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){t.stopPropagation();const e=As.preDefinedIconDataAt(t.target.selectedIndex);"SvgIcon"!==e.icon?(this.#sa({iconContent:e.icon,iconHeight:e.height,iconWidth:e.width,tooltipContent:e.tooltip}),this.#_r.setAddress()):this.#ra()}}class dr{#_r;constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{As.loadJson(JSON.parse(e.result)),this.#_r.updateToolbar()}catch(t){t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class ur{#_r;constructor(t){Object.freeze(this),this.#_r=t}handleEvent(t){t.stopPropagation(),S.openFile(new dr(this.#_r),".json")}}class mr{#aa;#la;#ha;#ca;#da;#ua;#ma;constructor(t,e){Object.freeze(this),this.#aa=new Js(t),this.#la=new $s(t),this.#ha=new Qs(t,e),this.#ca=new tr(t),this.#da=new er(t),this.#ua=new cr(t),this.#ma=new ur(t)}destructor(){this.#aa=null,this.#la=null,this.#ha=null,this.#ca=null,this.#da=null,this.#ua=null,this.#ma=null}get controlFocus(){return this.#aa}get controlInput(){return this.#la}get addressButtonClick(){return this.#ha}get urlInputBlur(){return this.#ca}get editionButtonsClick(){return this.#da}get iconSelectorChange(){return this.#ua}get openCfgFileButtonClick(){return this.#ma}}class pr extends bn{#ci;#di;#fr;#pa;#ga;#va;#fa;#_a;#ya;#Ta;#La;#Qo;#ba;#Ea;#Oe(){this.#Qo.destructor(this.#Ea),this.#pa.destructor(this.#Ea),this.#ga.destructor(this.#Ea),this.#va.destructor(this.#Ea),this.#fa.destructor(this.#Ea),this.#_a.destructor(this.#Ea),this.#ya.destructor(this.#Ea),this.#Ta.destructor(this.#Ea),this.#Ea.destructor()}constructor(t,e){super(),this.#ba=null,this.#ci=t,this.#di=e,this.#fr=new z,this.#fr.jsonObject=t.jsonObject}createContentHTML(){this.#Ea=new mr(this,this.#fr.latLng),this.#Qo=new Hs(this.#Ea),this.#pa=new Vs(this.#Ea),this.#ga=new ks({placeholder:"?????",datasetName:"iconContent",headerText:O.getText("NoteDialogIconControl - Icon content")},this.#Ea),this.#va=new ls({headerText:O.getText("NoteDialogTooltipControl - Tooltip content"),datasetName:"tooltipContent"},this.#Ea),this.#fa=new ks({rows:t.noteDialog.areaHeight.popupContent,datasetName:"popupContent",headerText:O.getText("NoteDialogPopupControl - Text")},this.#Ea),this.#_a=new Bs(this.#Ea),this.#ya=new Xs(this.#Ea,this.#fr.latLng),this.#Ta=new ls({headerText:O.getText("NoteDialogPhoneControl - Phone"),datasetName:"phone"},this.#Ea),this.#La=new qs(this.#fr),this.setControlsValues(this.#fr)}get focusControl(){return this.#ba}set focusControl(t){this.#ba=t}get mapIconData(){return new Rs(this.#fr.latLng,this.#di)}updatePreview(t){for(const e in t)this.#fr[e]=t[e];this.#La.update()}setAddress(){""===this.#ci.address&&new Ws(this).setAddressWithGeoCoder(this.#fr.latLng)}canClose(){return""===this.#ga.value?(this.showError(O.getText("Notedialog - The icon content cannot be empty")),!1):""===this.#ya.url||""!==D.sanitizeToUrl(this.#ya.url).url||(this.showError(O.getText("NoteDialog - invalidUrl")),!1)}onCancel(){this.#Oe(),super.onCancel()}onOk(){super.onOk()&&(this.#ci.iconWidth=this.#pa.iconWidth,this.#ci.iconHeight=this.#pa.iconHeight,this.#ci.iconContent=this.#ga.value,this.#ci.tooltipContent=this.#va.value,this.#ci.popupContent=this.#fa.value,this.#ci.address=this.#_a.address,this.#ci.url=this.#ya.url,this.#ci.phone=this.#Ta.value,this.#ci.latLng=this.#fr.latLng,this.#Oe())}get title(){return O.getText("NoteDialog - Note")}get toolbarHTMLElement(){return this.#Qo.rootHTMLElement}get contentHTMLElements(){return[this.#pa.controlHTMLElement,this.#ga.controlHTMLElement,this.#va.controlHTMLElement,this.#fa.controlHTMLElement,this.#_a.controlHTMLElement,this.#ya.controlHTMLElement,this.#Ta.controlHTMLElement]}get footerHTMLElements(){return this.#La.HTMLElements}setControlsValues(t){this.#pa.iconHeight=t.iconHeight||this.#pa.iconHeight,this.#pa.iconWidth=t.iconWidth||this.#pa.iconWidth,this.#ga.value=t.iconContent||this.#ga.value,this.#va.value=t.tooltipContent||this.#va.value,this.#fa.value=t.popupContent||this.#fa.value,this.#_a.address=t.address||this.#_a.address,this.#ya.url=t.url||this.#ya.url,this.#Ta.value=t.phone||this.#Ta.value}updateToolbar(){this.#Qo.update(this.#Ea)}}class gr{#wa;#Ma;constructor(){Object.freeze(this)}createUI(){if(this.#wa)return;this.#wa=V.create("div",{className:"TravelNotes-Background"},document.body);const t=V.create("div",{id:"TravelNotes-WaitUI"},this.#wa);this.#Ma=V.create("div",{id:"TravelNotes-WaitUI-MessageDiv"},t),V.create("div",{className:"TravelNotes-WaitAnimationBullet"},V.create("div",{className:"TravelNotes-WaitAnimation"},t))}showInfo(t){this.#Ma.textContent=t}close(){document.body.removeChild(this.#wa),this.#wa=null}}const vr=new class{#ci=null;#di=null;#xa=!0;#Ia=null;#Ca(){this.#xa?this.#di?(this.#di.notes.add(this.#ci),this.#ci.chainedDistance=this.#di.chainedDistance,this.#di.notes.sort(((t,e)=>t.distance-e.distance))):(U.travel.notes.add(this.#ci),Un.dispatch("updatetravelnotes")):this.#di||Un.dispatch("updatetravelnotes"),Un.dispatch("noteupdated",{removedNoteObjId:this.#ci.objId,addedNoteObjId:this.#ci.objId}),Un.dispatch("updateroadbook")}#_r(){new pr(this.#ci,this.#di).show().then((()=>this.#Ca())).catch((t=>{console.error(t)}))}#Na(t){this.#xa=!0,this.#ci=new z,this.#ci.latLng=t,this.#ci.iconLatLng=t}async#Pa(t){if(t.tags.rcn_ref?this.#ci.iconContent="<div class='TravelNotes-MapNote TravelNotes-MapNoteCategory-0073'><svg viewBox='0 0 20 20'><text x='10' y='14'>"+t.tags.rcn_ref+"</text></svg></div>":this.#ci.iconContent=As.preDefinedIconDataFromName(t.description),this.#ci.url=t.tags.website||"",this.#ci.phone=t.tags.phone||"",this.#ci.tooltipContent=t.description||"",this.#ci.popupContent=t.tags.name||"",t.tags["addr:street"]&&t.tags["addr:city"])this.#ci.address=(t.tags["addr:housenumber"]?t.tags["addr:housenumber"]+" ":"")+t.tags["addr:street"]+' <span class="TravelNotes-NoteHtml-Address-City">'+t.tags["addr:city"]+"</span>";else{const e=new gr;e.createUI(),e.showInfo("Creating address");let o=null;try{o=await(new Us).getAddressAsync([t.lat,t.lon])}catch(t){console.error(t)}e.close(),this.#ci.address=o.street,""!==o.city&&(this.#ci.address+=' <span class="TravelNotes-NoteHtml-Address-City">'+o.city+"</span>")}this.osmSearchNoteDialog||""===this.#ci.iconContent?this.#_r():this.#Ca()}constructor(){Object.freeze(this)}get osmSearchNoteDialog(){return null===this.#Ia&&(this.#Ia=t.osmSearch.showSearchNoteDialog),this.#Ia}changeOsmSearchNoteDialog(){this.#Ia=!this.osmSearchNoteDialog}newRouteNote(t,e){this.#di=Gn.getRoute(t);const o=un.getClosestLatLngDistance(this.#di,e);this.#Na(o.latLng),this.#ci.distance=o.distance,this.#_r()}newSearchRouteNote(t){const e=Gn.getNearestRouteData([t.lat,t.lon]);e.route?(this.#Na(e.latLngOnRoute),this.#ci.iconLatLng=[t.lat,t.lon],this.#ci.distance=e.distanceOnRoute,this.#di=e.route,this.#Pa(t)):Zn.showError(O.getText("NoteEditor - No route was found"))}newSearchTravelNote(t){this.#di=null,this.#Na([t.lat,t.lon]),this.#Pa(t)}newTravelNote(t){this.#di=null,this.#Na(t),this.#_r()}editNote(t){this.#xa=!1;const e=Gn.getNoteAndRoute(t);this.#di=e.route,this.#ci=e.note,this.#_r()}removeNote(t){const e=Gn.getNoteAndRoute(t);e.route?e.route.notes.remove(t):(U.travel.notes.remove(t),Un.dispatch("updatetravelnotes")),Un.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:g}),Un.dispatch("updateroadbook")}hideNotes(){let t=U.travel.notes.iterator;for(;!t.done;)Un.dispatch("removeobject",{objId:t.value.objId});const e=U.travel.routes.iterator;for(;!e.done;)for(t=e.value.notes.iterator;!t.done;)Un.dispatch("removeobject",{objId:t.value.objId});if(g!==U.editedRouteObjId)for(t=U.travel.editedRoute.notes.iterator;!t.done;)Un.dispatch("removeobject",{objId:t.value.objId})}showNotes(){this.hideNotes();const t=U.travel.notes.iterator;for(;!t.done;)Un.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:t.value.objId});const e=U.travel.routes.iterator;for(;!e.done;)e.value.hidden||Un.dispatch("routeupdated",{removedRouteObjId:e.value.objId,addedRouteObjId:e.value.objId})}attachNoteToRoute(t){const e=Gn.getNoteAndRoute(t).note,o=Gn.getNearestRouteData(e.latLng);o.route&&(U.travel.notes.remove(t),e.distance=o.distanceOnRoute,e.latLng=o.latLngOnRoute,e.chainedDistance=o.route.chainedDistance,o.route.notes.add(e),o.route.notes.sort(((t,e)=>t.distance-e.distance)),Un.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:t}),Un.dispatch("updatetravelnotes"),Un.dispatch("updateroadbook"))}detachNoteFromRoute(t){const e=Gn.getNoteAndRoute(t);e.route.notes.remove(t),e.note.distance=o.invalid,e.note.chainedDistance=o.defaultValue,U.travel.notes.add(e.note),Un.dispatch("updatetravelnotes"),Un.dispatch("updateroadbook")}travelNoteDropped(t,e,o){U.travel.notes.moveTo(t,e,o),Un.dispatch("updatetravelnotes"),Un.dispatch("updateroadbook")}};class fr{#Da=[];#Oa(t){this.#Da.push(t.latLng),this.#Da.push(t.iconLatLng)}#Sa(t){t.itinerary.itineraryPoints.forEach((t=>this.#Da.push(t.latLng))),t.notes.forEach((t=>this.#Oa(t)))}constructor(){Object.freeze(this)}zoomToLatLng(t){Un.dispatch("zoomto",{latLng:t})}zoomToNote(t){this.#Da=[],this.#Oa(Gn.getNoteAndRoute(t).note),Un.dispatch("zoomto",{geometry:[this.#Da]})}zoomToRoute(t){this.#Da=[],this.#Sa(Gn.getRoute(t)),Un.dispatch("zoomto",{geometry:[this.#Da]})}zoomToTravel(){this.#Da=[],U.travel.routes.forEach((t=>this.#Sa(t))),g!==U.travel.editedRouteObjId&&this.#Sa(U.travel.editedRoute),U.travel.notes.forEach((t=>this.#Oa(t))),Un.dispatch("zoomto",{geometry:[this.#Da]})}zoomToPoi(t){Un.dispatch("zoomto",t)}}class _r extends Ds{constructor(t,e){super(t,e)}get menuItems(){return[new Os(O.getText("ProfileContextMenu - Add a note to the route at this point"),!0,(()=>vr.newRouteNote(this.targetObjId,this.latLng))),new Os(O.getText("ProfileContextMenu - Zoom to this point"),!0,(()=>(new fr).zoomToLatLng(this.latLng)))]}}class yr{constructor(){Object.freeze(this)}getlatLngElevOnRouteAtMousePosition(t){const e=Gn.getRoute(Number.parseInt(t.currentTarget.dataset.tanObjId)),o=t.currentTarget.getBoundingClientRect(),i=(t.clientX-o.x-Ls.PROFILE_MARGIN/(2*Ls.PROFILE_MARGIN+Ls.PROFILE_WIDTH)*o.width)/(Ls.PROFILE_WIDTH/(2*Ls.PROFILE_MARGIN+Ls.PROFILE_WIDTH)*o.width)*e.distance;return 0<i&&i<e.distance?un.getLatLngElevAtDist(e,i):null}}class Tr extends yr{constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation();const e=this.getlatLngElevOnRouteAtMousePosition(t);e&&(t.latlng={lat:e.latLng[0],lng:e.latLng[1]},new _r(t).show())}}class Lr{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault(),t.stopPropagation(),Un.dispatch("removeobject",{objId:Number.parseInt(t.currentTarget.dataset.tanMarkerObjId)})}}class br extends yr{#ja;#Aa;#Ha;#Ra;#ka;#Ba;#za;#Fa(t,e){const o=document.createElementNS(_,"text");return o.appendChild(document.createTextNode(t)),o.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-elevText"),o.setAttributeNS(null,"x",this.#Ba),o.setAttributeNS(null,"y",e),o.setAttributeNS(null,"text-anchor",this.#ka),this.#za.appendChild(o),o}constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#za=t.currentTarget;const e=this.getlatLngElevOnRouteAtMousePosition(t);if(e){const o=Number.parseInt(this.#za.dataset.tanMarkerObjId);Un.dispatch("removeobject",{objId:o}),Un.dispatch("additinerarypointmarker",{objId:o,latLng:e.latLng}),this.#ja&&this.#za.contains(this.#ja)?(this.#za.removeChild(this.#ja),this.#za.removeChild(this.#Aa),this.#za.removeChild(this.#Ha),this.#za.removeChild(this.#Ra)):(this.#ja=null,this.#Aa=null,this.#Ha=null,this.#Ra=null);const i=this.#za.getBoundingClientRect();this.#Ba=(2*Ls.PROFILE_MARGIN+Ls.PROFILE_WIDTH)*(t.clientX-i.x)/i.width;const n=Ls.PROFILE_MARGIN+Ls.PROFILE_HEIGHT;this.#ja=document.createElementNS(_,"polyline"),this.#ja.setAttributeNS(null,"points",String(this.#Ba)+","+Ls.PROFILE_MARGIN+" "+this.#Ba+","+n),this.#ja.setAttributeNS(null,"class","TravelNotes-Route-SvgProfile-markerPolyline"),this.#za.appendChild(this.#ja);const s=Gn.getRoute(Number.parseInt(this.#za.dataset.tanObjId));this.#ka=e.distance>s.distance/2?"end":"start",this.#Ba+=e.distance>s.distance/2?-Ls.X_DELTA_TEXT:Ls.X_DELTA_TEXT,this.#Aa=this.#Fa(S.formatDistance(e.distance),Ls.PROFILE_MARGIN+Ls.Y_DELTA_TEXT),this.#Ha=this.#Fa("Alt. "+e.elev.toFixed(0)+" m.",Ls.PROFILE_MARGIN+2*Ls.Y_DELTA_TEXT),this.#Ra=this.#Fa("Pente "+e.ascent.toFixed(0)+" % ",Ls.PROFILE_MARGIN+3*Ls.Y_DELTA_TEXT)}}}class Er extends Ts{#gn=null;#Za;#Ka;#Ua;#Wa=null;#Va=null;#Xa=null;#Ya=T.nextObjId;#Ga;#qa(){this.#gn&&(this.#gn.removeEventListener("contextmenu",this.#Wa,!1),this.#gn.removeEventListener("mousemove",this.#Va,!1),this.#gn.removeEventListener("mouseleave",this.#Xa,!1),this.#Za.removeChild(this.#gn),this.#gn=null,Un.dispatch("removeobject",{objId:this.#Ya}),this.#Ua.textContent="",this.#Ka.textContent="")}setContent(t){this.#Ga=t.objId,this.#qa(),this.#gn=(new Ls).createSvg(t),this.#gn.dataset.tanObjId=t.objId,this.#gn.dataset.tanMarkerObjId=this.#Ya,this.#gn.addEventListener("contextmenu",this.#Wa,!1),this.#gn.addEventListener("mousemove",this.#Va,!1),this.#gn.addEventListener("mouseleave",this.#Xa,!1),this.#Za.appendChild(this.#gn),this.setContentName(t)}setContentName(t){this.#Ua.textContent=O.getText("ProfileWindow - Route {name}",{name:t.computedName}),this.#Ka.textContent=O.getText("ProfileWindow - Ascent: {ascent} m. - Descent: {descent} m. - Distance: {distance}",{ascent:t.itinerary.ascent.toFixed(0),descent:t.itinerary.descent.toFixed(0),distance:S.formatDistance(t.distance)})}constructor(){super(),this.#Wa=new Tr,this.#Va=new br,this.#Xa=new Lr,this.#Za=V.create("div",{className:"TravelNotes-ProfileDialog-SvgContainer"}),this.#Ua=V.create("div",{className:"TravelNotes-ProfileDialog-NameContainer"}),this.#Ka=V.create("div",{className:"TravelNotes-ProfileDialog-AscentContainer"})}createContentHTML(){}onCancel(){this.#qa(),super.onCancel(),Un.dispatch("profileclosed",{objId:this.#Ga})}show(){super.show(),this.mover.moveDialogToTopLeft()}get contentHTMLElements(){return[this.#Za,this.#Ua,this.#Ka]}get title(){return O.getText("ProfileWindow - Profile")}}class wr{#di;#Ja;#$a;get#Qa(){return t.route.elev.smoothPoints}#tl(){this.#$a=[],this.#$a.push({distance:0,elev:this.#di.itinerary.itineraryPoints.first.elev,smoothElev:this.#di.itinerary.itineraryPoints.first.elev});const t=this.#di.itinerary.itineraryPoints.iterator;t.done;let e=0,o=t.value.distance,i=t.value.elev;t.done;let n=this.#Ja;for(;n<this.#di.distance;){if(o<n)for(e=o,i=t.value.elev;o<n;)o+=t.value.distance,t.done;const s=i+(n-e)*((t.value.elev-i)/(o-e));this.#$a.push({distance:n,elev:s,smoothElev:0}),n+=this.#Ja}this.#$a.push({distance:this.#di.distance,elev:this.#di.itinerary.itineraryPoints.last.elev,smoothElev:this.#di.itinerary.itineraryPoints.last.elev})}#el(){let t=(this.#$a[this.#Qa-1].elev-this.#$a[0].elev)/(this.#Qa-1),e=0;for(e=0;e<this.#Qa;e++)this.#$a[e].smoothElev=this.#$a[0].elev+t*e;for(e=this.#Qa;e<this.#$a.length-this.#Qa;e++){let t=0;for(let o=e-this.#Qa;o<=e+this.#Qa;o++)t+=this.#$a[o].elev;this.#$a[e].smoothElev=t/(2*this.#Qa+1)}e--;const o=(this.#$a[e+this.#Qa].smoothElev-this.#$a[e].smoothElev)/this.#Qa;let i=this.#$a[e].smoothElev,n=1;for(e++;e<this.#$a.length-1;n++,e++)this.#$a[e].smoothElev=i+o*n}#ol(){const e=this.#di.itinerary.itineraryPoints.iterator;let o=0;for(;!e.done;)o+=e.next?Math.abs(e.value.elev-e.next.elev):0;this.#Ja=Math.floor(Math.min(t.route.elev.smoothCoefficient*this.#di.distance/o,this.#di.distance/(3*this.#Qa)))}#il(){const t=this.#di.itinerary.itineraryPoints.iterator;t.done;let e=t.value.distance;for(;!t.done;){const o=this.#$a[Math.floor(e/this.#Ja)],i=this.#$a[Math.ceil(e/this.#Ja)];if(o&&i){const n=e-o.distance,s=(i.elev-o.elev)/(i.distance-o.distance);t.value.elev=o.elev+n*s}e+=t.value.distance}}constructor(){Object.freeze(this)}smooth(t){this.#di=t,this.#ol(),this.#tl(),this.#el(),this.#il()}}const Mr=new class{#nl=new Map;constructor(){Object.freeze(this)}createProfile(e){const o=this.#nl.get(e.objId);if(e.itinerary.hasProfile){t.route.elev.smooth&&(new wr).smooth(e);let i=0,n=0,s=e.itinerary.itineraryPoints.first.elev;e.itinerary.itineraryPoints.forEach((t=>{let e=t.elev-s;0>e?n-=e:i+=e,s=t.elev})),e.itinerary.ascent=i,e.itinerary.descent=n,o&&o.setContent(e)}else o&&o.onCancel()}updateProfileName(t){const e=this.#nl.get(t);if(e){const o=Gn.getRoute(t);o&&e.setContentName(o)}}updateProfile(t,e){const o=this.#nl.get(t);o&&(this.#nl.delete(t),e&&e.itinerary.hasProfile?(o.setContent(e),this.#nl.set(e.objId,o)):o.onCancel())}deleteProfile(t){const e=this.#nl.get(t);e&&e.onCancel()}deleteAllProfiles(){this.#nl.forEach((t=>t.onCancel()))}showProfile(t){const e=Gn.getRoute(t);let o=this.#nl.get(t);o||(o=new Er,o.setContent(e),o.show(),this.#nl.set(t,o))}onProfileClosed(t){this.#nl.delete(t)}};class xr{constructor(){Object.seal(this)}bottomLeft;upperRight;entryPoint;exitPoint}class Ir{#sl;#di;#rl;#al(t,e,o){return e.lng===o.lng?new ln(e.lat>o.lat?t.bottomLeft.lat:t.upperRight.lat,e.lng):e.lat===o.lat?new ln(e.lat,e.lng<o.lng?t.upperRight.lng:t.bottomLeft.lng):null}#ll(t,e){const o=1e-6;return e.lat-t.bottomLeft.lat<o||t.upperRight.lat-e.lat<o||e.lng-t.bottomLeft.lng<o||t.upperRight.lng-e.lng<o?ln.clone(e):null}#hl(t,e,o){if(t.bottomLeft.lat===t.upperRight.lat&&t.bottomLeft.lng===t.upperRight.lng){const t=Math.min(Math.abs(this.#rl.height/(o.lat-e.lat)),Math.abs(this.#rl.width/(o.lng-e.lng)));return new ln(e.lat+t*(o.lat-e.lat),e.lng+t*(o.lng-e.lng))}return null}#cl(t,e,o){let i=this.#hl(t,e,o);if(i)return i;if(i=this.#ll(t,e),i)return i;if(i=this.#al(t,e,o),i)return i;const n=(e.lat-o.lat)/(e.lng-o.lng),s=e.lat-n*e.lng;if(i=new ln(n*t.upperRight.lng+s,t.upperRight.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng<o.lng)return i;if(i=new ln(t.upperRight.lat,(t.upperRight.lat-s)/n),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat<o.lat)return i;if(i=new ln(n*t.bottomLeft.lng+s,t.bottomLeft.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng>o.lng)return i;if(i=new ln(t.bottomLeft.lat,(t.bottomLeft.lat-s)/n),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat>o.lat)return i;throw new Error("intermediate point not found")}#dl(){this.#sl=[];const t=this.#di.itinerary.itineraryPoints.iterator;let e=t.done,o=new xr;o.bottomLeft=ln.clone(t.value),o.upperRight=ln.clone(t.value),o.entryPoint=ln.clone(t.value);let i=t.value,n=ln.clone(t.value);e=t.done;let s=t.value;for(;!e;){const r=new xr;r.bottomLeft=new ln(Math.min(o.bottomLeft.lat,s.lat),Math.min(o.bottomLeft.lng,s.lng)),r.upperRight=new ln(Math.max(o.upperRight.lat,s.lat),Math.max(o.upperRight.lng,s.lng)),r.entryPoint=ln.clone(o.entryPoint),this.#rl.height>r.upperRight.lat-r.bottomLeft.lat&&this.#rl.width>r.upperRight.lng-r.bottomLeft.lng?(o=r,i=t.value,n=ln.clone(t.value),e=t.done,s=t.value,e&&(o.exitPoint=n,this.#sl.push(Object.freeze(o)))):(n=this.#cl(o,i,s),o.bottomLeft=new ln(Math.min(o.bottomLeft.lat,n.lat),Math.min(o.bottomLeft.lng,n.lng)),o.upperRight=new ln(Math.max(o.upperRight.lat,n.lat),Math.max(o.upperRight.lng,n.lng)),o.exitPoint=n,this.#sl.push(Object.freeze(o)),o=new xr,o.bottomLeft=ln.clone(n),o.upperRight=ln.clone(n),o.entryPoint=ln.clone(n))}}constructor(t,e){Object.freeze(this),this.#di=t,this.#rl=e,this.#dl()}get printViews(){return this.#sl}}class Cr{#yt;#Ts;constructor(t,e){Object.freeze(this),this.#yt=t,this.#Ts=e}get width(){return this.#yt}get height(){return this.#Ts}}class Nr{#ae;#Tt;#ul;constructor(t){if("string"!=typeof t?.text||"string"!=typeof t?.color||"string"!=typeof t?.backgroundColor)throw new Error("invalid toolbar for layer");Object.freeze(this),this.#ae=D.sanitizeToJsString(t.text),this.#Tt=D.sanitizeToColor(t.color),this.#ul=D.sanitizeToColor(t.backgroundColor)}get text(){return this.#ae}get color(){return this.#Tt}get backgroundColor(){return this.#ul}}class Pr{#U=null;#ml=null;#p=null;#pl=null;#gl=null;#vl=null;#fl=null;#_l=null;#Rt=null;#yl=!1;#Tl=null;#Ll=null;#bl(){if("string"!=typeof this.#Ll?.name)throw new Error("invalid name for layer");this.#U=D.sanitizeToJsString(this.#Ll.name)}#El(){if("wms"!==this.#Ll?.service&&"wmts"!==this.#Ll?.service)throw new Error("invalid service for layer "+this.#U);this.#ml=this.#Ll.service}#wl(){if("string"!=typeof this.#Ll?.url)throw new Error("invalid url for layer "+this.#U);this.#p=this.#Ll.url}#Ml(){if("wms"===this.#ml){if("string"!=typeof this.#Ll?.wmsOptions?.layers||"string"!=typeof this.#Ll?.wmsOptions?.format||"boolean"!=typeof this.#Ll?.wmsOptions?.transparent)throw new Error("invalid wmsOptions for layer "+this.#U);this.#pl=this.#Ll.wmsOptions,this.#pl.layers=D.sanitizeToJsString(this.#pl.layers),this.#pl.format=D.sanitizeToJsString(this.#pl.format)}}#xl(){try{this.#Ll.bounds&&"number"==typeof this.#Ll.bounds[0][0]&&"number"==typeof this.#Ll.bounds[0][1]&&"number"==typeof this.#Ll.bounds[1][0]&&"number"==typeof this.#Ll.bounds[1][1]&&(this.#gl=this.#Ll.bounds)}catch(t){throw new Error("invalid bounds for layer "+this.#U)}}#Il(){if(this.#Ll.minZoom){if("number"!=typeof this.#Ll.minZoom)throw new Error("invalid minZoom for layer "+this.#U);this.#vl=this.#Ll.minZoom}if(this.#Ll.maxZoom){if("number"!=typeof this.#Ll.maxZoom)throw new Error("invalid maxZoom for layer "+this.#U);this.#fl=this.#Ll.maxZoom}}#Cl(){this.#_l=new Nr(this.#Ll.toolbar)}#Nl(){if("string"!=typeof this.#Ll?.providerName)throw new Error("invalid providerName for layer "+this.#U);this.#Rt=D.sanitizeToJsString(this.#Ll.providerName)}#Pl(){if("boolean"!=typeof this.#Ll.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this.#U);this.#yl=this.#Ll.providerKeyNeeded}#Dl(){if(""===this.#Ll.attribution)this.#Tl="";else{if("string"!=typeof this.#Ll?.attribution)throw new Error("invalid attribution for map layer "+this.#U);this.#Tl=D.sanitizeToHtmlString(this.#Ll.attribution).htmlString}}constructor(t){Object.freeze(this),this.#Ll=t,this.#bl(),this.#El(),this.#wl(),this.#Ml(),this.#xl(),this.#Il(),this.#Cl(),this.#Nl(),this.#Pl(),this.#Dl(),this.#Ll=null}get name(){return this.#U}get service(){return this.#ml}get url(){return this.#p}get wmsOptions(){return this.#pl}get bounds(){return this.#gl}get minZoom(){return this.#vl}get maxZoom(){return this.#fl}get toolbarButtonData(){return this.#_l}get providerName(){return this.#Rt}get providerKeyNeeded(){return this.#yl}get attribution(){return this.#Tl}}const Dr=new class{#Ol;#Sl;#jl;constructor(){Object.freeze(this),this.#Ol=new Map,this.#jl=!1,this.#Sl=new Pr({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}),this.#Ol.set(this.#Sl.name,this.#Sl)}getMapLayer(t){let e=this.#Ol.get(t)||this.#Sl;return e.providerKeyNeeded&&(Wn.hasKey(e.providerName.toLowerCase())||(e=this.#Sl)),e}forEach(t){this.#Ol.forEach(t)}addMapLayers(t){this.#jl||(t.forEach((t=>{const e=new Pr(t);this.#Ol.get(e.name)||this.#Ol.set(e.name,e)})),this.#jl=!0)}get defaultMapLayer(){return this.#Sl}};class Or{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class Sr{#Al=null;constructor(t){Object.freeze(this),this.#Al=t}handleEvent(){this.#Al.onAfterPrint(),this.#Al=null}}class jr{#Hl;#di;#sl;#Rl;#kl;#ye;#Bl;#zl;#Fl;#Zl;#Kl;onAfterPrint(){this.#zl.forEach((t=>document.body.removeChild(t))),this.#zl.length=0,this.#kl.removeEventListener("click",this.#Zl,!1),this.#ye.removeEventListener("click",this.#Kl,!1),document.body.removeChild(this.#Rl);const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.remove("TravelNotes-Hidden");U.map.invalidateSize(!1),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name),window.removeEventListener("afterprint",this.#Kl,!0),this.#Kl=null,this.#Zl=null}#Ul(){const t=Dr.getMapLayer(U.travel.layerName),e=Wn.getUrl(t),o="wmts"===t.service.toLowerCase()?new Zi(e):new Zi.WMS(e,t.wmsOptions);return o.options.attribution=D.sanitizeToHtmlString(' Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t.attribution+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> ').htmlString,o}#Wl(){const t=[];return this.#di.notes.forEach((e=>{const o=new zi({iconSize:[e.iconWidth,e.iconHeight],iconAnchor:[e.iconWidth/2,e.iconHeight/2],popupAnchor:[0,-e.iconHeight/2],html:e.iconContent,className:"TravelNotes-Map-AllNotes "}),i=new Ti(e.iconLatLng,{zIndexOffset:100,icon:o,draggable:!0});t.push(i)})),t}#Vl(e){this.#Bl++;const o="TravelNotes-RouteViewDiv"+this.#Bl,i=document.createElement("div");i.className="TravelNotes-routeViewDiv",i.id=o,document.body.appendChild(i),this.#zl.push(i),i.style.width=String(this.#Hl.paperWidth)+"mm",i.style.height=String(this.#Hl.paperHeight)+"mm";const n=this.#Hl.printNotes?this.#Wl():[];n.push(this.#Ul()),n.push(new bi([e.entryPoint.lat,e.entryPoint.lng],t.printRouteMap.entryPointMarker)),n.push(new bi([e.exitPoint.lat,e.exitPoint.lng],t.printRouteMap.exitPointMarker)),n.push(this.#Fl),new Bo(o,{attributionControl:!0,zoomControl:!1,center:[(e.bottomLeft.lat+e.upperRight.lat)/2,(e.bottomLeft.lng+e.upperRight.lng)/2],zoom:this.#Hl.zoomFactor,minZoom:this.#Hl.zoomFactor,maxZoom:this.#Hl.zoomFactor,layers:n})}#Xl(){this.#Rl=V.create("div",{id:"TravelNotes-PrintToolbar"},document.body),this.#kl=V.create("div",{className:"TravelNotes-UI-Button",title:O.getText("PrintPageBuilder - Print"),textContent:"ðŸ–¨ï¸"},this.#Rl),this.#kl.addEventListener("click",this.#Zl,!1),this.#ye=V.create("div",{className:"TravelNotes-UI-Button",title:O.getText("PrintPageBuilder - Cancel print"),textContent:"âŒ"},this.#Rl),this.#ye.addEventListener("click",this.#Kl,!1)}constructor(t,e,o){Object.freeze(this),this.#di=t,this.#sl=e,this.#Hl=o,this.#Bl=0,this.#zl=[],this.#Zl=new Or,this.#Kl=new Sr(this)}preparePage(){this.#Hl.firefoxBrowser?document.body.classList.add("TravelNotes-Maps-FirefoxBrowser"):document.body.classList.remove("TravelNotes-Maps-FirefoxBrowser");const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.add("TravelNotes-Hidden");document.title=""===U.travel.name?"maps":U.travel.name+" - "+this.#di.computedName+" - maps",this.#Xl(),window.addEventListener("afterprint",this.#Kl,!0);const e=[],o=this.#di.itinerary.itineraryPoints.iterator;for(;!o.done;)e.push(o.value.latLng);this.#Fl=new wi(e,{color:this.#di.color,weight:this.#di.width,dashArray:this.#di.dashString}),this.#Bl=0,this.#sl.forEach((t=>this.#Vl(t)))}}class Ar{#Yl=0;static get#Gl(){return 256}#ql(t){const e=V.create("div",{},document.body);e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width=String(t.paperWidth-2*t.borderWidth)+"mm",e.style.height=String(t.paperHeight-2*t.borderWidth)+"mm";const o=un.screenCoordToLatLng(0,0),i=un.screenCoordToLatLng(e.clientWidth,e.clientHeight);this.#Yl=Math.ceil(e.clientWidth/Ar.#Gl)*Math.ceil(e.clientHeight/Ar.#Gl),document.body.removeChild(e);const n=U.map.getZoomScale(U.map.getZoom(),t.zoomFactor);return new Cr(Math.abs(o[1]-i[1])*n,Math.abs(o[0]-i[0])*n)}constructor(){Object.freeze(this)}print(e,o){const i=Gn.getRoute(o);if(!i)return;const n=new Ir(i,this.#ql(e));if(t.printRouteMap.maxTiles<n.printViews.length*this.#Yl)return void Zn.showError(O.getText("RoutePrinter - The maximum of allowed pages is reached."));new jr(i,n.printViews,e).preparePage()}}class Hr{static marker=null;static initialLatLng=null}class Rr{static handleEvent(){Hr.marker&&(Ro.off(Hr.marker),U.map.removeLayer(Hr.marker),Hr.marker=null)}}const kr=new class{constructor(){Object.freeze(this)}addRoute(){const t=new F;U.travel.routes.add(t),this.chainRoutes(),l.editedChanged===U.travel.editedRoute.editionStatus?(Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook")):this.editRoute(t.objId)}editRoute(t){const e=Gn.getRoute(t),o=e.itinerary.provider,i=U.providers.get(o.toLowerCase());if(o&&""!==o&&(!i||i.providerKeyNeeded&&!Wn.hasKey(o)))return void Zn.showError(O.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:o}));g!==U.editedRouteObjId&&this.cancelEdition(),o&&""!==o&&Un.dispatch("setprovider",{provider:o});const n=e.itinerary.transitMode;n&&""!==n&&Un.dispatch("settransitmode",{transitMode:n}),U.travel.editedRoute=new F,e.editionStatus=l.editedNoChange,U.travel.editedRoute.jsonObject=e.jsonObject,U.editedRouteObjId=e.objId,U.travel.editedRoute.hidden=!1,e.hidden=!1,Mr.updateProfile(U.editedRouteObjId,U.travel.editedRoute),this.chainRoutes(),Un.dispatch("routeupdated",{removedRouteObjId:e.objId,addedRouteObjId:U.travel.editedRoute.objId}),Un.dispatch("updateroadbook"),Un.dispatch("updatetravelproperties")}removeRoute(t){let e=t;e!==U.editedRouteObjId&&e!==U.travel.editedRoute.objId||(e=U.editedRouteObjId,this.cancelEdition()),Un.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:g}),U.travel.routes.remove(e),Mr.deleteProfile(e),this.chainRoutes(),Un.dispatch("updateroadbook"),Un.dispatch("updatetravelproperties")}saveGpx(t){(new qn).routeToGpx(t)}chainRoutes(){const t=U.travel.routes.iterator;let e=o.defaultValue;for(;!t.done;){t.value.chain?(t.value.chainedDistance=e,e+=t.value.distance):t.value.chainedDistance=o.defaultValue;const i=t.value.notes.iterator;for(;!i.done;)i.value.chainedDistance=t.value.chainedDistance;if(t.value.objId===U.editedRouteObjId){U.travel.editedRoute.chainedDistance=U.travel.editedRoute.chain?t.value.chainedDistance:o.defaultValue;const e=U.travel.editedRoute.notes.iterator;for(;!e.done;)e.value.chainedDistance=U.travel.editedRoute.chainedDistance}}}saveEdition(){const t=new F;t.jsonObject=U.travel.editedRoute.jsonObject,U.travel.routes.replace(U.editedRouteObjId,t),U.editedRouteObjId=t.objId,this.cancelEdition()}cancelEdition(){Rr.handleEvent();const t=Gn.getRoute(U.editedRouteObjId);t.editionStatus=l.notEdited,Mr.updateProfile(U.travel.editedRoute.objId,t),Un.dispatch("routeupdated",{removedRouteObjId:U.travel.editedRoute.objId,addedRouteObjId:U.editedRouteObjId}),U.editedRouteObjId=g,U.travel.editedRoute=new F,this.chainRoutes(),Un.dispatch("updateroadbook"),Un.dispatch("updatetravelproperties")}routeProperties(t){const e=Gn.getRoute(t);new cs(e).show().then((()=>{this.chainRoutes(),e.haveValidWayPoints()&&Un.dispatch("routepropertiesupdated",{routeObjId:e.objId}),Un.dispatch("updateroadbook"),Un.dispatch("updatetravelproperties"),Un.dispatch("updateprofilename",{routeObjId:t})})).catch((t=>{t instanceof Error&&console.error(t)}))}printRouteMap(t){(new ms).show().then((e=>(new Ar).print(e,t))).catch((t=>{t instanceof Error&&console.error(t)}))}showRoute(t){Gn.getRoute(t).hidden=!1,Un.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t}),Un.dispatch("updatetravelproperties")}hideRoute(t){Gn.getRoute(t).hidden=!0,Un.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:g}),Un.dispatch("updatetravelproperties")}showRoutes(){const t=U.travel.routes.iterator;for(;!t.done;)t.value.hidden&&(t.value.hidden=!1,Un.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t.value.objId}));Un.dispatch("updatetravelproperties")}hideRoutes(){const t=U.travel.routes.iterator;for(;!t.done;)t.value.hidden||t.value.objId===U.editedRouteObjId||(t.value.hidden=!0,Un.dispatch("routeupdated",{removedRouteObjId:t.value.objId,addedRouteObjId:g}));Un.dispatch("updatetravelproperties")}};class Br{static get#Jl(){return.5}static get#$l(){return 5}static get#Ql(){return 10}static get#th(){return 31}static get#eh(){return 32}static get#oh(){return 63}#ih(t){return Math.floor(Math.abs(t)+Br.#Jl)*(0<=t?1:-1)}#nh(t,e,o){const i=this.#ih(t*o),n=this.#ih(e*o);let s=i-n;s<<=1,0>i-n&&(s=~s);let r="";for(;Br.#eh<=s;)r+=String.fromCharCode((Br.#eh|s&Br.#th)+Br.#oh),s>>=Br.#$l;return r+=String.fromCharCode(s+Br.#oh),r}#s;#sh(t){let e=null,o=0,i=0;do{e=t.charCodeAt(this.#s++)-Br.#oh,i|=(e&Br.#th)<<o,o+=Br.#$l}while(Br.#eh<=e);return 1&i?~(i>>1):i>>1}constructor(){Object.freeze(this)}encode(t,e){if(!t.length)return"";const o=e.length,i=Array.from(e,(t=>Math.pow(Br.#Ql,t)));let n="";for(let e=0;e<o;e++)n+=this.#nh(t[0][e],0,i[e]);for(let e=1;e<t.length;e++){const s=t[e],r=t[e-1];for(let t=0;t<o;t++)n+=this.#nh(s[t],r[t],i[t])}return n}decode(t,e){const o=e.length;if(!t||0===t.length)return[];this.#s=0;const i=[],n=Array.from(e,(t=>Math.pow(Br.#Ql,t))),s=new Array(o).fill(0);for(;this.#s<t.length;){const e=new Array(o).fill(0);for(let i=0;i<o;i++)s[i]+=this.#sh(t),e[i]=s[i]/n[i];i.push(e)}return i}}class zr{#rh(t){const e={values:"",objType:(new R).objType.jsonObject},o=[];t.itinerary.itineraryPoints.forEach((t=>{o.push([t.lat,t.lng,t.distance,t.elev,t.objId])})),e.values=(new Br).encode(o,[a.fixed,a.fixed,2,2,0]),t.itinerary.itineraryPoints=e}#ah(t){const e=[];if(t.itinerary.itineraryPoints.values)(new Br).decode(t.itinerary.itineraryPoints.values,[a.fixed,a.fixed,2,2,0]).forEach((n=>{const s={lat:a.defaultValue,lng:a.defaultValue,distance:o.defaultValue,elev:i.defaultValue,objId:g};[s.lat,s.lng,s.distance,s.elev,s.objId]=n,s.objType=t.itinerary.itineraryPoints.objType,e.push(s)}));else{t.itinerary.itineraryPoints.latLngs=(new Br).decode(t.itinerary.itineraryPoints.latLngs,[a.fixed,a.fixed]);let o=0;t.itinerary.itineraryPoints.latLngs.forEach((n=>{const s={};s.lat=n[0],s.lng=n[1],s.distance=t.itinerary.itineraryPoints.distances[o],t.itinerary.itineraryPoints.elevs?s.elev=t.itinerary.itineraryPoints.elevs[o]:s.elev=i.defaultValue,s.objId=t.itinerary.itineraryPoints.objIds[o],s.objType=t.itinerary.itineraryPoints.objType,e.push(s),o++}))}t.itinerary.itineraryPoints=e}constructor(){Object.freeze(this)}decompress(t){t.routes.forEach(this.#ah),t.editedRoute&&this.#ah(t.editedRoute)}compress(t){const e=t.jsonObject;return e.routes.forEach((t=>this.#rh(t))),this.#rh(e.editedRoute),e}}class Fr{constructor(){Object.freeze(this)}openDistantFile(t){(new zr).decompress(t),U.travel.jsonObject=t,U.travel.readOnly=!0,document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name);const e=U.travel.routes.iterator;for(;!e.done;)l.notEdited===e.value.editionStatus?Un.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:e.value.objId}):U.editedRouteObjId=e.value.objId;g!==U.editedRouteObjId&&Un.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:U.travel.editedRoute.objId});const o=U.travel.notes.iterator;for(;!o.done;)Un.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:o.value.objId});(new fr).zoomToTravel()}}const Zr=new class{#Vo=null;constructor(){Object.freeze(this)}createUI(){this.#Vo=V.create("div",{id:"TravelNotes-AttributionsUI"},document.body)}set attributions(t){const e='Â© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>';for(;this.#Vo.firstChild;)this.#Vo.removeChild(this.#Vo.firstChild);D.sanitizeToHtmlElement(e,this.#Vo)}};const Kr=new class{constructor(){Object.freeze(this)}setMapLayer(t){const e=Dr.getMapLayer(t);Un.dispatch("layerchange",{layer:e}),Zr.attributions=e.attribution,U.travel.layerName=e.name}};class Ur{toolbarItemsArray;constructor(){Object.seal(this),this.toolbarItemsArray=[]}}class Wr{#lh;constructor(t){Object.freeze(this),this.#lh=t}handleEvent(t){this.#lh.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].action()}}class Vr{#hh;#lh;#ch;static get#dh(){return 5}constructor(t,e){Object.freeze(this),this.#hh=t,this.#lh=e}handleEvent(t){switch(t.type){case"touchstart":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);this.#ch=e.screenY}break;case"touchend":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);Vr.#dh>Math.abs(e.screenY-this.#ch)&&(t.stopPropagation(),t.preventDefault(),this.#lh.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].action(),this.#hh.hide())}}}}class Xr{#uh;constructor(){Object.freeze(this),this.#uh=Number.MAX_VALUE}handleEvent(t){switch(t.type){case"touchstart":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);this.#uh=e.screenY}break;case"touchmove":case"touchend":if(1===t.changedTouches.length){const e=t.changedTouches.item(0),o=this.#uh-e.screenY;t.currentTarget.scrollTop+=o,this.#uh=e.screenY}break;default:this.#uh=Number.MAX_VALUE}"touchend"===t.type&&(this.#uh=Number.MAX_VALUE)}}class Yr{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.currentTarget.scrollTop+=t.deltaY*v[t.deltaMode])}}class Gr{#yo;#mh;#Yo;#ph;#gh;#vh;#fh;#_h;#lh;static get#yh(){return 100}#Th;#Lh(t,e){const o=V.create("div",{className:"TravelNotes-BaseToolbar-ButtonHTMLElement",textContent:t.textContent,title:t.title,dataset:{ItemId:e}},this.#mh);o.addEventListener("click",this.#vh,!1),o.addEventListener("touchstart",this.#fh,!1),o.addEventListener("touchend",this.#fh,!1)}#bh(t){const e=V.create("div",{className:"TravelNotes-BaseToolbar-ButtonHTMLElement",title:t.title},this.#mh);V.create("text",{value:t.textContent},V.create("a",{className:"TravelNotes-BaseToolbar-ButtonLinkHTMLElement",href:t.action,target:"_blank"},e))}#Qe(){this.#mh=V.create("div",{className:"TravelNotes-BaseToolbar-ButtonsHTMLElement"},this.#yo),this.#lh.toolbarItemsArray=[],this.addToolbarItems(),this.#lh.toolbarItemsArray.forEach(((t,e)=>{t.isCommand()?this.#Lh(t,e):this.#bh(t)})),this.#mh.addEventListener("wheel",this.#ph,{passive:!0}),this.#mh.addEventListener("touchstart",this.#gh,!1),this.#mh.addEventListener("touchmove",this.#gh,!1),this.#mh.addEventListener("touchend",this.#gh,!1),this.#_h=!0}#Eh(t){Gr.#yh>t.timeStamp-this.#Th||this.#wh(t)}#wh(t){if(this.#Th=t.timeStamp,this.#_h){if(this.#Yo)return clearTimeout(this.#Yo),void(this.#Yo=null);this.hide()}else this.#Qe()}#Mh(){this.#_h&&(this.#Yo=setTimeout((()=>this.hide()),t.toolbars.timeOut))}constructor(){Object.freeze(this)}hide(){for(this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null);this.#mh.firstChild;){const t=this.#mh.firstChild;t.removeEventListener("click",this.#vh,!1),t.removeEventListener("touchstart",this.#fh,!1),t.removeEventListener("touchend",this.#fh,!1),this.#mh.removeChild(t)}this.#mh.removeEventListener("wheel",this.#ph,{passive:!0}),this.#mh.removeEventListener("touchstart",this.#gh,!1),this.#mh.removeEventListener("touchmove",this.#gh,!1),this.#mh.removeEventListener("touchend",this.#gh,!1),this.#yo.removeChild(this.#mh),this.#mh=null,this.#_h=!1}createUI(t,e){if(this.#yo)return!1;this.#Yo=null,this.#_h=!1,this.#Th=0,this.#lh=new Ur,this.#ph=new Yr,this.#gh=new Xr,this.#vh=new Wr(this.#lh),this.#fh=new Vr(this,this.#lh),this.#yo=V.create("div",{className:"TravelNotes-BaseToolbar-ToolbarHTMLElement "+e},document.body),this.#yo.addEventListener("click",(t=>this.#Eh(t)),!1),this.#yo.addEventListener("mouseenter",(t=>this.#wh(t)),!1),this.#yo.addEventListener("mouseleave",(t=>this.#Mh(t)),!1),V.create("div",{className:"TravelNotes-BaseToolbar-HeaderTextHTMLElement",textContent:t},V.create("div",{className:"TravelNotes-BaseToolbar-HeaderHTMLElement"},this.#yo))}addToolbarItem(t){this.#lh.toolbarItemsArray.push(t)}addCssClass(t){this.#yo.classList.add(t)}}class qr{#xh;#re;#fs;constructor(t,e,o){this.#xh=t,this.#xh="function"==typeof t?t():t,this.#re=e,this.#fs=o}get textContent(){return this.#xh}get title(){return this.#re}get action(){return this.#fs}isLink(){return"string"==typeof this.#fs}isCommand(){return"function"==typeof this.#fs}}const Jr=new class extends Gr{constructor(){super()}createUI(){super.createUI(O.getText("MapLayersToolbar - Layers"),c.topLeft),this.addCssClass("TravelNotes-MapLayersToolbar-ToolbarHTMLElement")}addToolbarItems(){Dr.forEach((t=>{(t.providerKeyNeeded&&Wn.hasKey(t.providerName.toLowerCase())||!t.providerKeyNeeded)&&this.addToolbarItem(new qr(t.toolbarButtonData.text,t.name,(()=>{Kr.setMapLayer(t.name)})))})),t.mapLayersToolbar?.theDevil?.addButton&&this.addToolbarItem(new qr("ðŸ‘¿","Reminder! The devil will know everything about you","https://www.google.com/maps/@"+U.map.getCenter().lat+","+U.map.getCenter().lng+","+U.map.getZoom()+"z"))}};class $r{#Ih;#Ch;#Nh;#Ph;#Dh;#Oh;#Sh;static get#jh(){return 3e5}#Ah(t){U.map.setZoom(U.map.getZoom()+t)}#Hh(){this.#Ih&&(this.#Ih.textContent="Â "+this.#Ph+"Â "+this.#Dh+"Â -Â ZoomÂ :Â "+String(this.#Oh)+"Â ");const t=U.map;t.getMaxZoom()===this.#Oh?this.#Ch.classList.add("TravelNotes-MouseUI-Disabled"):this.#Ch.classList.remove("TravelNotes-MouseUI-Disabled"),t.getMinZoom()===this.#Oh?this.#Nh.classList.add("TravelNotes-MouseUI-Disabled"):this.#Nh.classList.remove("TravelNotes-MouseUI-Disabled")}constructor(){Object.freeze(this),this.#Ph=h.saved,this.#Dh="",this.#Oh=0,this.#Sh=null}set saveStatus(t){h.modified===t&&h.notSaved===this.#Ph||(this.#Ph=t,h.modified!==t||this.#Sh?h.saved===t&&this.#Sh&&(clearTimeout(this.#Sh),this.#Sh=null):this.#Sh=setTimeout((()=>this.#Ph=h.notSaved),$r.#jh),this.#Hh())}createUI(){const e=V.create("div",{id:"TravelNotes-MouseUI"},document.body);this.#Nh=V.create("span",{id:"TravelNotes-MouseUI-ZoomMinus",textContent:"â–¼"},e),this.#Nh.addEventListener("click",(()=>this.#Ah(-1))),this.#Ih=V.create("span",null,e),this.#Ch=V.create("span",{id:"TravelNotes-MouseUI-ZoomPlus",textContent:"â–²"},e),this.#Ch.addEventListener("click",(()=>this.#Ah(1))),this.#Oh=U.map.getZoom(),this.#Dh=S.formatLat(t.map.center.lat)+"Â -Â "+S.formatLng(t.map.center.lng),U.map.on("mousemove",(t=>{this.#Dh=S.formatLatLng([t.latlng.lat,t.latlng.lng]),this.#Hh()})),U.map.on("zoomend",(()=>{this.#Oh=U.map.getZoom(),this.#Hh()}))}}const Qr=new $r;class ta extends Ts{#Rh=null;constructor(){super()}createContentHTML(){this.#Rh=V.create("div",{id:"TravelNotes-AboutDialog-About"}),D.sanitizeToHtmlElement('<p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2022 - wwwouaiebe</p><p>Contact : <a href="https://www.ouaie.be/pages/Contact" target="_blank">https://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank">https://github.com/wwwouaiebe/TravelNotes</a></p><p>Version : v4.1.0.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p>',this.#Rh)}show(){super.show(),this.mover.centerDialog()}get contentHTMLElements(){return[this.#Rh]}get title(){return O.getText("AboutDialog - About Travel & Notes")}}const ea=new class{#kh=navigator.geolocation?n.inactive:n.disabled;#Bh=null;#zh(t){Un.dispatch("geolocationpositionchanged",{position:t})}#Fh(){n.active===this.#kh&&(this.#kh=n.inactive),Un.dispatch("geolocationstatuschanged",{status:this.#kh}),this.#Bh&&(navigator.geolocation.clearWatch(this.#Bh),this.#Bh=null)}#Zh(t){1===t.code&&(this.#kh=n.refusedByUser),2===t.code&&Zn.showError(O.getText("GeoLocator - Geolocation disabled on the device")),this.#Fh()}#Kh(){this.#kh=n.active,Un.dispatch("geolocationstatuschanged",{status:this.#kh}),t.geoLocation.watch?this.#Bh=navigator.geolocation.watchPosition((t=>this.#zh(t)),(t=>this.#Zh(t)),t.geoLocation.options):navigator.geolocation.getCurrentPosition((t=>this.#zh(t)),(t=>this.#Zh(t)),t.geoLocation.options)}constructor(){Object.freeze(this)}get status(){return this.#kh}switch(){switch(this.#kh){case n.inactive:this.#Kh();break;case n.active:this.#Fh()}return this.#kh}};class oa{#Uh;#Wh;#Vh;constructor(t,e,o){Object.freeze(this),this.#Uh=t,this.#Wh=e,this.#Vh=o}get removeTravelNotes(){return this.#Uh}get removeRoutesNotes(){return this.#Wh}get removeManeuvers(){return this.#Vh}}class ia extends bn{#Xh;#Yh;#Gh;constructor(t){super(t)}createContentHTML(){this.#Xh=new Jn({afterText:O.getText("SaveAsDialog - Remove Travel Notes"),checked:!1}),this.#Yh=new Jn({afterText:O.getText("SaveAsDialog - Remove Routes Notes"),checked:!1}),this.#Gh=new Jn({afterText:O.getText("SaveAsDialog - Remove Maneuvers"),checked:!1})}onOk(){super.onOk(new oa(this.#Xh.checked,this.#Yh.checked,this.#Gh.checked))}get contentHTMLElements(){return[this.#Xh.controlHTMLElement,this.#Yh.controlHTMLElement,this.#Gh.controlHTMLElement]}get title(){return O.getText("SaveAsDialog - SaveAs")}}const na=new class{#qh(e){const o=new Z;o.jsonObject=U.travel.jsonObject,o.name+="-partial";let i=o.routes.iterator;for(;!i.done;)i.value.hidden=!1;if(e.removeTravelNotes&&o.notes.removeAll(),e.removeRoutesNotes)for(i=o.routes.iterator;!i.done;)i.value.notes.removeAll();if(e.removeManeuvers)for(i=o.routes.iterator;!i.done;)i.value.itinerary.maneuvers.removeAll();const n=(new zr).compress(o);S.saveFile(n.name+"."+(Tn.isTouch?t.files.writeTouch:t.files.writeOthers),JSON.stringify(n),"application/json")}#Jh(){return""!==U.travel.name||(Zn.showError(O.getText("TravelEditor - Gives a name to the travel")),Un.dispatch("showtravelproperties"),!1)}constructor(){Object.freeze(this)}routeDropped(t,e,o){const i=t===U.travel.editedRoute.objId?U.editedRouteObjId:t,n=e===U.travel.editedRoute.objId?U.editedRouteObjId:e;U.travel.routes.moveTo(i,n,o),kr.chainRoutes(),Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook")}saveAsTravel(){if(this.#Jh())return g!==U.editedRouteObjId?(Zn.showError(O.getText("TravelEditor - Not possible to partial save when a route is edited.")),void Un.dispatch("showtravelproperties")):void(new ia).show().then((t=>{this.#qh(t)})).catch((t=>{t instanceof Error&&console.error(t)}))}saveTravel(){if(!this.#Jh())return;const e=U.travel.routes.iterator;for(;!e.done;)e.value.hidden=!1;const o=(new zr).compress(U.travel);S.saveFile(o.name+"."+(Tn.isTouch?t.files.writeTouch:t.files.writeOthers),JSON.stringify(o),"application/json"),Qr.saveStatus=h.saved}newTravel(){t.travelNotes.haveBeforeUnloadWarning&&!window.confirm(O.getText("TravelEditor - This page ask to close; data are perhaps not saved."))||(Mr.deleteAllProfiles(),Un.dispatch("removeallobjects"),U.editedRouteObjId=g,U.travel.jsonObject=(new Z).jsonObject,Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook"),Un.dispatch("updatetravelnotes"),t.travelNotes.startupRouteEdition&&kr.editRoute(U.travel.routes.first.objId),Qr.saveStatus=h.saved)}};class sa extends Ln{#$h;#Qh(){this.onTop?(this.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-Docked"),this.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-HiddenContent"),this.dialogHTMLElement.style.top="0px",this.#$h=!0):(this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-Docked"),this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-HiddenContent"),this.#$h=!1)}constructor(){super(),this.#$h=!1}get dialogDocked(){return this.#$h}centerDialog(){this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-Docked"),this.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-HiddenContent"),super.centerDialog()}moveDialogTo(t,e,o){super.moveDialogTo(t,e,o),o&&"touchmove"===o||this.#Qh()}}class ra extends Ts{#me;#pe;#tc;#ec;#Th;#_h;static get#yh(){return 100}static get#oc(){return 1500}#ic(){this.mover.dialogDocked&&(Ds.isActive?this.#tc=setTimeout((()=>{this.#ic()}),Math.max(ra.#oc,t.dockableBaseDialog.timeout)):this.mover.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-HiddenContent"))}#nc(t){this.#Th=t.timeStamp,this.#tc&&(clearTimeout(this.#tc),this.#tc=null),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.remove("TravelNotes-DockableBaseDialog-HiddenContent")}#sc(){this.mover.dialogDocked&&(this.#tc=setTimeout((()=>{this.#ic()}),Math.max(ra.#oc,t.dockableBaseDialog.timeout)))}#rc(t){t.preventDefault(),ra.#yh>t.timeStamp-this.#Th||this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.toggle("TravelNotes-DockableBaseDialog-HiddenContent")}constructor(t,e){super(),this.#me=t,this.#pe=e,this.#tc=null,this.#ec=null,this.#Th=0,this.#_h=!1}get mover(){return this.#ec?this.#ec:this.#ec=new sa}onCancel(){super.onCancel(),this.#_h=!1,this.#ec&&(this.#ec=null)}show(){this.#_h||(super.show(),this.addCssClass("TravelNotes-DockableBaseDialog"),this.updateContent(),null!==this.#me&&null!==this.#pe?(this.mover.moveDialogTo(this.#me,this.#pe),this.#me=null,this.#pe=null):this.mover.moveDialogToLastPosition(),this.mover.dialogHTMLElement.addEventListener("mouseenter",(t=>this.#nc(t)),!1),t.dockableBaseDialog.hideOnMouseLeave&&this.mover.dialogHTMLElement.addEventListener("mouseleave",(()=>this.#sc()),!1),this.mover.topBarHTMLElement.addEventListener("click",(t=>this.#rc(t)),!1),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.add("TravelNotes-DockableBaseDialog-HiddenContent"),this.#_h=!0)}}class aa{#U="";#ac=!1;#lc=[];#hc=["node","way","relation"];#cc=[];#dc=!1;#uc=!1;#t=g;constructor(t,e){this.#U=D.sanitizeToJsString(t),e&&(this.#uc=!0,this.#ac=!0),this.#t=T.nextObjId,Object.freeze(this)}get name(){return this.#U}get isRoot(){return this.#ac}get items(){return this.#lc}get elementTypes(){return this.#hc}setElementType(t){f!==["node","way","relation"].indexOf(t)&&(this.#hc=[t])}get filterTagsArray(){return this.#cc}get isSelected(){return this.#dc}set isSelected(t){this.#dc=t,this.items.forEach((e=>{e.isSelected=t}))}get isExpanded(){return this.#uc}set isExpanded(t){this.#uc=t}get objId(){return this.#t}}const la=new class{#mc;#pc;#gc;#vc;#fc(t){const e=t.split(";");for(;""===e[e.length-1];)e.pop();let o=0;const i=[];e.forEach((t=>{if(""!==t)if(f===t.indexOf("="))this.#gc=new aa(t),this.#pc.set(this.#gc.objId,this.#gc),this.#vc[o].push(this.#gc),this.#vc[o+1]=this.#gc.items;else{let e=t.split("=");if("element"===e[0])this.#gc.setElementType(e[1]);else{let t={};t[e[0]]="*"===e[1]?null:e[1],i.push(t)}}o++})),0!==i.length&&this.#gc.filterTagsArray.push(i)}#_c(t){t.items.forEach((t=>{this.#_c(t)})),t.isExpanded=!0}#yc(t){t.items.forEach((t=>{this.#yc(t)})),t.isExpanded=!1}constructor(){this.#mc=new aa("",!0),this.#pc=new Map,this.#pc.set(this.#mc.objId,this.#mc),this.#vc=[this.#mc.items],Object.freeze(this)}get dictionary(){return this.#mc}parseDictionary(t){t.split(/\r\n|\r|\n/).forEach((t=>{""!==t&&this.#fc(t)}))}selectItem(t,e){this.#pc.get(t).isSelected=e}unselectAll(){this.#mc.isSelected=!1}expandItem(t){let e=this.#pc.get(t);e.isExpanded=!e.isExpanded}expand(){this.#_c(this.#mc)}collapse(){this.#mc.items.forEach((t=>this.#yc(t)))}};class ha{#Tc;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),la.unselectAll(),this.#Tc.redraw()}}class ca{#Tc;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),la.collapse(),this.#Tc.redraw()}}class da{#Tc;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),la.expand(),this.#Tc.redraw()}}class ua{#Lc;#bc;#Ec;static get#wc(){return 5e3}#Mc(t,e){let o=!0;return e.forEach((e=>{const[i,n]=Object.entries(e)[0];o=o&&t.tags[i]&&(!n||t.tags[i]===n)})),o}#xc(t,e){this.#bc.forEach((o=>{o.filterTagsArray.forEach((i=>{this.#Mc(t,i)&&(t.description=o.name,e.set(t.id,t))}))}))}#Ic(){const e=[],o=new Map;this.#bc.forEach((t=>{t.filterTagsArray.forEach((e=>{const[i,n]=Object.entries(e[0])[0];let s=o.get(i);s||(s={values:new Map,elements:new Map},o.set(i,s)),s.values.set(n,n),t.elementTypes.forEach((t=>{s.elements.set(t,t)}))}))}));const i=this.#Cc();this.#Ec=i;const n="("+i.getSouthWest().lat.toFixed(a.fixed)+","+i.getSouthWest().lng.toFixed(a.fixed)+","+i.getNorthEast().lat.toFixed(a.fixed)+","+i.getNorthEast().lng.toFixed(a.fixed)+")";return o.forEach(((o,i)=>{let s='"'+i+'"';if(1===o.values.size){const t=o.values.values().next().value;t&&(s+='="'+t+'"')}else 1<o.values.size&&(s+='~"',o.values.forEach((t=>{s+=t+"|"})),s=s.substring(0,s.length-1)+'"');if(t.overpassApi.useNwr){const t=1===o.elements.size?o.elements.values().next().value:"nwr";e.push(t+"["+s+"]"+n+";"+("node"===t?"":"(._;>;);")+"out;")}else{let t=[];1===o.elements.size?t.push(o.elements.values().next().value):t=["node","way","rel"],t.forEach((t=>{e.push(t+"["+s+"]"+n+";"+("node"===t?"":"(._;>;);")+"out;")}))}})),e}#Nc(t){t.isSelected&&0<t.filterTagsArray.length&&this.#bc.push(t),t.items.forEach((t=>this.#Nc(t)))}#Cc(){const t=U.map.getCenter(),e=U.map.getBounds(),o=un.getSquareBoundingBox([t.lat,t.lng],ua.#wc);return e.getSouthWest().lat=Math.max(e.getSouthWest().lat,o.getSouthWest().lat),e.getSouthWest().lng=Math.max(e.getSouthWest().lng,o.getSouthWest().lng),e.getNorthEast().lat=Math.min(e.getNorthEast().lat,o.getNorthEast().lat),e.getNorthEast().lng=Math.min(e.getNorthEast().lng,o.getNorthEast().lng),e}constructor(){Object.freeze(this),this.#Lc=!1,this.#bc=[],this.#Ec=null}async search(){if(this.#Lc)return;this.#Lc=!0,this.#bc=[],this.#Nc(la.dictionary);const t=new Fs({searchPlaces:!1});await t.loadData(this.#Ic());const e=new Map;t.statusOk||Zn.showError(O.getText("OsmSearchEngine - incomplete results")),[t.nodes,t.ways,t.relations].forEach((t=>{t.forEach((t=>{t.tags&&this.#xc(t,e)}))})),U.searchData.length=0,Array.from(e.values()).sort(((t,e)=>t.description>e.description)).forEach((t=>U.searchData.push(t))),this.#Lc=!1,Un.dispatch("updateosmsearch")}get searchBounds(){return this.#Cc()}get previousSearchBounds(){return this.#Ec}}const ma=new ua;class pa{#Tc;#Pc;constructor(t,e){Object.freeze(this),this.#Tc=t,this.#Pc=e}handleEvent(t){t.stopPropagation(),la.dictionary.isExpanded=!1,this.#Tc.redraw(),U.searchData.length=0,Un.dispatch("updateosmsearch"),this.#Pc.showWait(),ma.search()}}class ga{#Dc;constructor(t,e){Object.freeze(this),this.#Dc=V.create("div"),V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Start the search"),textContent:"ðŸ”Ž"},this.#Dc).addEventListener("click",new pa(t,e),!1),V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Expand the tree"),textContent:"â–¼"},this.#Dc).addEventListener("click",new da(t),!1),V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Collapse the tree"),textContent:"â–¶"},this.#Dc).addEventListener("click",new ca(t),!1),V.create("div",{className:"TravelNotes-BaseDialog-Button",title:O.getText("OsmSearchToolbarButtons - Clear the tree"),textContent:"âŒ"},this.#Dc).addEventListener("click",new ha(t),!1)}get toolbarButtonsHTMLElement(){return this.#Dc}}class va{#Tc=null;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),la.expandItem(Number.parseInt(t.target.parentNode.dataset.tanObjId)),this.#Tc.redraw()}}class fa{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.target.scrollTop+=t.deltaY*v[t.deltaMode]),t.stopPropagation()}}class _a{#Tc=null;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),la.selectItem(Number.parseInt(t.target.parentNode.dataset.tanObjId),t.target.checked),this.#Tc.redraw()}}class ya{#Oc;#Sc;#jc;#Ac;#Hc(t){this.#Ac++;const e=V.create("div",{className:"TravelNotes-OsmSearchDialog-SearchItemMargin"+this.#Ac,dataset:{ObjId:t.objId}},this.#Oc);if(!t.isRoot){V.create("input",{type:"checkbox",checked:t.isSelected},e).addEventListener("change",this.#jc,!1)}if(0===t.filterTagsArray.length){V.create("div",{className:"TravelNotes-BaseDialog-Button TravelNotes-OsmSearchDialog-TreeArrow",textContent:t.isExpanded?"â–¼":"â–¶"},e).addEventListener("click",this.#Sc,!1)}V.create("text",{value:t.name},e),t.isExpanded&&t.items.forEach((t=>this.#Hc(t))),this.#Ac--}constructor(){Object.freeze(this),this.#Ac=0,this.#Oc=V.create("div",{id:"TravelNotes-OsmSearchDialog-SearchTree"}),this.#Oc.addEventListener("wheel",new fa,{passive:!0}),this.#jc=new _a(this),this.#Sc=new va(this),this.#Hc(la.dictionary)}redraw(){this.#Oc.textContent="",this.#Hc(la.dictionary)}get treeHTMLElement(){return this.#Oc}}class Ta{#Ae;constructor(){this.#Ae=V.create("div",{className:"TravelNotes-WaitAnimation"}),V.create("div",{className:"TravelNotes-WaitAnimationBullet"},this.#Ae),this.#Ae.classList.add("TravelNotes-Hidden")}showWait(){this.#Ae.classList.remove("TravelNotes-Hidden")}hideWait(){this.#Ae.classList.add("TravelNotes-Hidden")}get waitHTMLElement(){return this.#Ae}}class La{#ha;constructor(t,e){Object.freeze(this),this.#ha=new Qs(t,e)}destructor(){this.#ha=null}get addressButtonClick(){return this.#ha}}class ba extends bn{#Rc;#kc;#_a;#Ea;constructor(t){super(),this.#Rc=t,this.#Ea=new La(this,this.#Rc.latLng)}createContentHTML(){this.#kc=new ls({headerText:O.getText("WayPointPropertiesDialog - Name")},this.#Ea),this.#kc.value=this.#Rc.name,this.#_a=new Bs(this.#Ea),this.#_a.address=this.#Rc.address}onCancel(){this.#Ea.destructor(),super.onCancel()}onOk(){this.#Rc.address=this.#_a.address,this.#Rc.name=this.#kc.value,this.#Ea.destructor(),super.onOk()}get contentHTMLElements(){return[this.#kc.controlHTMLElement,this.#_a.controlHTMLElement]}set name(t){this.#kc.name=t}set address(t){this.#_a.address=t}get title(){return O.getText("WayPointPropertiesDialog - Waypoint properties")}get wayPoint(){return this.#Rc}setControlsValues(t){this.#_a.address=t.address,this.#kc.value=t.name}}const Ea=new class{#Bc;#zc;#Fc(t){const e=t.itinerary.itineraryPoints.iterator,i=t.itinerary.maneuvers.iterator;for(e.done,i.done,i.value.distance=o.defaultValue,i.done,t.distance=o.defaultValue,t.duration=o.defaultValue;!e.done;)e.previous.distance=Vn.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,i.previous.distance+=e.previous.distance,i.value.itineraryPointObjId===e.value.objId&&(t.duration+=i.previous.duration,i.value.distance=o.defaultValue,i.next&&i.value.itineraryPointObjId===i.next.itineraryPointObjId&&(i.done,i.value.distance=o.defaultValue),i.done)}#Zc(t){this.#Bc=!1,t instanceof Error?(console.error(t),Zn.showError(t.message)):Zn.showError("A network error occurs when calling the provider")}#Kc(){if(this.#Bc=!1,this.#Fc(U.travel.editedRoute),"circle"!==U.travel.editedRoute.itinerary.transitMode){const t=U.travel.editedRoute.wayPoints.iterator;for(;!t.done;)t.first?t.value.latLng=U.travel.editedRoute.itinerary.itineraryPoints.first.latLng:t.last?t.value.latLng=U.travel.editedRoute.itinerary.itineraryPoints.last.latLng:t.value.latLng=un.getClosestLatLngDistance(U.travel.editedRoute,t.value.latLng).latLng}const t=U.travel.editedRoute.notes.iterator;for(;!t.done;){const e=un.getClosestLatLngDistance(U.travel.editedRoute,t.value.latLng);t.value.latLng=e.latLng,t.value.distance=e.distance}kr.chainRoutes(),U.travel.editedRoute.notes.sort(((t,e)=>t.distance-e.distance)),this.#zc&&(new fr).zoomToRoute(U.travel.editedRoute.objId),Mr.createProfile(U.travel.editedRoute),Un.dispatch("routeupdated",{removedRouteObjId:U.travel.editedRoute.objId,addedRouteObjId:U.travel.editedRoute.objId}),Un.dispatch("updateroadbook"),Un.dispatch("updatetravelproperties")}constructor(){Object.freeze(this)}startRouting(){if(!this.#Bc&&U.travel.editedRoute.haveValidWayPoints()){this.#zc=0===U.travel.editedRoute.itinerary.itineraryPoints.length,this.#Bc=!0;const t=U.providers.get(U.routing.provider.toLowerCase());U.travel.editedRoute.itinerary.provider=t.name,U.travel.editedRoute.itinerary.transitMode=U.routing.transitMode,t.getPromiseRoute(U.travel.editedRoute).then((()=>this.#Kc())).catch((()=>this.#Zc()))}}};const wa=new class{async#Uc(e){if(!t.wayPoint.reverseGeocoding)return Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook"),void Un.dispatch("updateprofilename",{routeObjId:U.editedRouteObjId});const o=await(new Us).getAddressAsync(e.latLng);U.editedRouteObjId===U.travel.editedRoute.objId&&(U.travel.editedRoute.editionStatus=l.editedChanged),e.address=o.street,""!==o.city&&(e.address+=" "+o.city),e.name="",t.wayPoint.geocodingIncludeName&&(e.name=o.name),Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook"),Un.dispatch("updateprofilename",{routeObjId:U.travel.editedRoute.objId})}#Wc(t){const e=U.travel.editedRoute.wayPoints.first;e.latLng=t,this.#Uc(e),Un.dispatch("addwaypoint",{wayPoint:e,letter:"A"})}#Vc(t){const e=U.travel.editedRoute.wayPoints.last;e.latLng=t,this.#Uc(e),Un.dispatch("addwaypoint",{wayPoint:e,letter:"B"})}constructor(){Object.freeze(this)}addWayPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged;const e=new H;e.latLng=t,U.travel.editedRoute.wayPoints.add(e),this.#Uc(e),Un.dispatch("addwaypoint",{wayPoint:U.travel.editedRoute.wayPoints.last,letter:U.travel.editedRoute.wayPoints.length-2}),U.travel.editedRoute.wayPoints.swap(e.objId,!0),Ea.startRouting()}addWayPointOnRoute(t,e){const o=un.getClosestLatLngDistance(U.travel.editedRoute,t).distance;U.travel.editedRoute.editionStatus=l.editedChanged;const i=new H;i.latLng=e;let n="";const s=U.travel.editedRoute.wayPoints.iterator;for(;!s.done;){if(o<un.getClosestLatLngDistance(U.travel.editedRoute,s.value.latLng).distance){n=String(s.index),U.travel.editedRoute.wayPoints.add(i),U.travel.editedRoute.wayPoints.moveTo(i.objId,s.value.objId,!0),this.#Uc(i),Un.dispatch("addwaypoint",{wayPoint:i,letter:n}),Ea.startRouting();break}}}reverseWayPoints(){U.travel.editedRoute.editionStatus=l.editedChanged;let t=U.travel.editedRoute.wayPoints.iterator;for(;!t.done;)Un.dispatch("removeobject",{objId:t.value.objId});for(U.travel.editedRoute.wayPoints.reverse(),t=U.travel.editedRoute.wayPoints.iterator;!t.done;)Un.dispatch("addwaypoint",{wayPoint:t.value,letter:t.first?"A":t.last?"B":String(t.index)});Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook"),Ea.startRouting()}removeWayPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,Un.dispatch("removeobject",{objId:t}),U.travel.editedRoute.wayPoints.remove(t),Ea.startRouting()}setStartPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,this.#Wc(t),Ea.startRouting()}setEndPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,this.#Vc(t),Ea.startRouting()}setStartAndEndPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,this.#Wc(t),this.#Vc(t),2<U.travel.editedRoute.wayPoints.length&&Ea.startRouting()}wayPointDragEnd(t){U.travel.editedRoute.editionStatus=l.editedChanged;const e=U.travel.editedRoute.wayPoints.getAt(t.target.objId),o=t.target.getLatLng();e.latLng=[o.lat,o.lng],this.#Uc(e),Ea.startRouting()}wayPointProperties(t){const e=U.travel.editedRoute.wayPoints.getAt(t);new ba(e).show().then((()=>{Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook")})).catch((t=>{t instanceof Error&&console.error(t)}))}};class Ma{#es;#Da;constructor(t,e){this.#es=t,this.#Da=e}get latLng(){return this.#es}get geometry(){return this.#Da}}class xa extends Ds{#Xc;#es;constructor(t,e){super(t,e),this.#Xc=U.searchData[Number.parseInt(t.currentTarget.dataset.tanElementIndex)],this.#es=[this.#Xc.lat,this.#Xc.lon],Un.dispatch("removeobject",{objId:this.targetObjId})}get menuItems(){return[new Os(O.getText("OsmSearchContextMenu - Select this point as start point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.first.lat,(()=>wa.setStartPoint(this.#es))),new Os(O.getText("OsmSearchContextMenu - Select this point as way point"),g!==U.editedRouteObjId,(()=>wa.addWayPoint(this.#es))),new Os(O.getText("OsmSearchContextMenu - Select this point as end point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.last.lat,(()=>wa.setEndPoint(this.#es))),new Os(O.getText("OsmSearchContextMenu - Create a route note with this result"),!0,(()=>vr.newSearchRouteNote(this.#Xc))),new Os(O.getText("OsmSearchContextMenu - Create a travel note with this result"),!0,(()=>vr.newSearchTravelNote(this.#Xc))),new Os(O.getText(vr.osmSearchNoteDialog?"OsmSearchContextMenu - Hide note dialog":"OsmSearchContextMenu - Show note dialog"),!0,(()=>vr.changeOsmSearchNoteDialog())),new Os(O.getText("OsmSearchContextMenu - Zoom to this result"),!0,(()=>(new fr).zoomToPoi(new Ma(this.#es,this.#Xc.geometry))))]}}class Ia{#Yc;#Gc;#qc;#Jc;#$c;#Qc;#td;#ed;#od;#id;#nd;#sd;#rd;#ad;static get#ld(){return 1e3}static get#hd(){return 40}static get#cd(){return 5}static get#dd(){return 200}static get#ud(){return 100}#md(t){t!==this.#Jc&&Ia.#hd<t-this.#Jc&&(this.#td.scrollTop-=Ia.#cd,this.#Jc=t),this.#ed>this.#id&&0<this.#td.scrollTop&&window.requestAnimationFrame((t=>{this.#md(t)}))}#pd(t){t!==this.#Jc&&Ia.#hd<t-this.#Jc&&(this.#td.scrollTop+=Ia.#cd,this.#Jc=t);let e=1>Math.abs(this.#td.scrollHeight-this.#td.clientHeight-this.#td.scrollTop);this.#od<this.#id&&!e&&window.requestAnimationFrame((t=>{this.#pd(t)}))}#oe(t){const e=t.changedTouches.item(0);if(1===t.touches.length){if(Ia.#ld<t.timeStamp-this.#qc||0===this.#qc)return void(this.#qc=t.timeStamp);t.preventDefault(),this.#Gc=!0,this.#Qc=t.currentTarget.parentNode,this.#td=t.currentTarget.parentNode.parentNode.parentNode,this.#id=e.screenY;const o=t.currentTarget.getBoundingClientRect();this.#rd=e.screenX-o.left,this.#ad=e.screenY-o.top,this.#$c=t.currentTarget.cloneNode(!0),this.#$c.classList.add("TravelNotes-SortableList-DraggedListItemHTMLElement"),document.body.appendChild(this.#$c),this.#$c.style.left=String(e.screenX-this.#rd)+"px",this.#$c.style.top=String(e.screenY-this.#ad)+"px",this.#ed=this.#Qc.getBoundingClientRect().y-this.#td.getBoundingClientRect().y+this.#td.scrollTop+Ia.#dd,this.#od=this.#td.getBoundingClientRect().bottom-Ia.#ud}}#ee(t){if(!this.#Gc)return;const e=t.changedTouches.item(0);if(1===t.touches.length&&this.#$c){this.#$c.style.left=String(e.screenX-this.#rd)+"px",this.#$c.style.top=String(e.screenY-this.#ad)+"px",this.#id=e.screenY,this.#ed>this.#id&&0<this.#td.scrollTop&&window.requestAnimationFrame((t=>{this.#md(t)}));let t=1>Math.abs(this.#td.scrollHeight-this.#td.clientHeight-this.#td.scrollTop);this.#od<this.#id&&!t&&window.requestAnimationFrame((t=>{this.#pd(t)}))}}#gd(t){this.#Qc.childNodes.forEach((e=>{let o=e.getBoundingClientRect();o.left<t.clientX&&o.right>t.clientX&&o.top<t.clientY&&o.bottom>t.clientY&&(this.#nd=e,this.#sd=t.clientY-o.top<o.height/2)}))}#te(t){if(this.#Gc){let e=t.changedTouches.item(0);if(this.#gd(e),this.#nd)try{this.#Yc(Number.parseInt(t.currentTarget.dataset.tanObjId),Number.parseInt(this.#nd.dataset.tanObjId),this.#sd)}catch{}}this.#vd()}#vd(){this.#$c&&document.body.removeChild(this.#$c),this.#$c=null,this.#td=null,this.#Gc=!1,this.#Jc=0,this.#Qc=null,this.#ed=0,this.#od=0,this.#id=0,this.#nd=null,this.#sd=!0}constructor(t){Object.freeze(this),this.#Yc=t,this.#$c=null,this.#qc=0,this.#vd()}handleEvent(t){switch(t.type){case"touchstart":this.#oe(t);break;case"touchmove":this.#ee(t);break;case"touchend":this.#te(t);break;case"touchcancel":this.#vd()}}}class Ca{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();try{t.dataTransfer.setData("ObjId",t.target.dataset.tanObjId),t.dataTransfer.dropEffect="move"}catch(t){t instanceof Error&&console.error(t)}}}class Na{#Yc;constructor(t){Object.freeze(this),this.#Yc=t}handleEvent(t){t.preventDefault();const e=t.currentTarget.getBoundingClientRect();try{this.#Yc(Number.parseInt(t.dataTransfer.getData("ObjId")),Number.parseInt(t.currentTarget.dataset.tanObjId),t.clientY-e.top<e.bottom-t.clientY)}catch{}}}class Pa{#fd;constructor(t){Object.freeze(this),this.#fd=t}handleEvent(t){t.stopPropagation(),t.preventDefault(),new this.#fd(t,t.target.parentNode).show()}}class Da extends Mn{#_d;#yd;#Td;#Ld;#Qc;constructor(t,e,o){super(),this.#_d=new Ca,this.#yd=new Na(t),this.#Td=new Pa(e),this.#Ld=new Ia(t),o&&V.create("div",{className:"TravelNotes-BaseDialog-FlexRow",textContent:o},this.controlHTMLElement),this.#Qc=V.create("div",{className:"TravelNotes-SortableList-ListHTMLElement"},this.controlHTMLElement)}updateContent(t){for(;this.#Qc.firstChild;)this.#Qc.firstChild.removeEventListener("dragstart",this.#_d,!1),this.#Qc.firstChild.removeEventListener("drop",this.#yd,!1),this.#Qc.firstChild.removeEventListener("contextmenu",this.#Td,!1),this.#Qc.firstChild.removeEventListener("touchstart",this.#Ld,!1),this.#Qc.firstChild.removeEventListener("touchmove",this.#Ld,!1),this.#Qc.firstChild.removeEventListener("touchend",this.#Ld,!1),this.#Qc.removeChild(this.#Qc.firstChild);t.forEach((t=>{t.draggable=!0,t.addEventListener("dragstart",this.#_d,!1),t.addEventListener("drop",this.#yd,!1),t.addEventListener("contextmenu",this.#Td,!1),t.addEventListener("touchstart",this.#Ld,!1),t.addEventListener("touchmove",this.#Ld,!1),t.addEventListener("touchend",this.#Ld,!1),this.#Qc.appendChild(t),t.classList.add("TravelNotes-SortableList-ListItemHTMLElement")}))}}class Oa{#bd;#Xc;#Ed;static get#pr(){return 40}#wd(){let t="";t=this.#Xc.tags.rcn_ref?"<div class='TravelNotes-MapNote TravelNotes-MapNoteCategory-0073'><svg viewBox='0 0 20 20'><text class='' x=10 y=14>"+this.#Xc.tags.rcn_ref+"</text></svg></div>":As.preDefinedIconDataFromName(this.#Xc.description)||"";const e=V.create("div",{className:"TravelNotes-OsmSearchDialog-SearchResult-IconCell"},this.#bd);D.sanitizeToHtmlElement(t,e)}#Md(t){t&&V.create("div",{textContent:t},this.#Ed)}#Fr(){const t=(this.#Xc.tags["addr:street"]?(this.#Xc.tags["addr:housenumber"]?this.#Xc.tags["addr:housenumber"]+" ":"")+this.#Xc.tags["addr:street"]+" ":"")+(this.#Xc.tags["addr:city"]?(this.#Xc.tags["addr:postcode"]?this.#Xc.tags["addr:postcode"]+" ":"")+this.#Xc.tags["addr:city"]:"");""!==t&&this.#Md(t)}#xd(){this.#Xc.tags.phone&&this.#Md("â˜Žï¸ : "+this.#Xc.tags.phone,this.#Ed)}#Id(){this.#Xc.tags.email&&V.create("a",{href:"mailto:"+this.#Xc.tags.email,textContent:this.#Xc.tags.email},V.create("div",{textContent:"ðŸ“§ : "},this.#Ed))}#Cd(){this.#Xc.tags.website&&V.create("a",{href:this.#Xc.tags.website,target:"_blank",textContent:this.#Xc.tags.website.length>Oa.#pr?this.#Xc.tags.website.substring(0,Oa.#pr)+"...":this.#Xc.tags.website},V.create("div",null,this.#Ed))}#Nd(){this.#Ed=V.create("div",{className:"TravelNotes-OsmSearchDialog-SearchResult-Cell"},this.#bd),this.#Md(this.#Xc.description),this.#Md(this.#Xc.tags.name),this.#Md(this.#Xc.tags.rcn_ref),this.#Fr(),this.#xd(),this.#Id(),this.#Cd()}#Pd(){for(const[t,e]of Object.entries(this.#Xc.tags))this.#bd.title+=t+"="+e+"\n"}constructor(){Object.freeze(this)}buildHTMLElement(t,e){return this.#Xc=t,this.#bd=V.create("div",{className:"TravelNotes-OsmSearchDialog-SearchResultHTMLElement",dataset:{ObjId:T.nextObjId,ElementIndex:e}}),this.#wd(),this.#Nd(),this.#Pd(),this.#bd}}class Sa{#Dd;#Od;#Sd(){g===this.#Od?this.#Od=T.nextObjId:Un.dispatch("removeobject",{objId:this.#Od}),Un.dispatch("addrectangle",{objId:this.#Od,bounds:ma.searchBounds,properties:t.osmSearch.nextSearchLimit})}#jd(){const e=ma.previousSearchBounds;e&&(g===this.#Dd?this.#Dd=T.nextObjId:Un.dispatch("removeobject",{objId:this.#Dd}),Un.dispatch("addrectangle",{objId:this.#Dd,bounds:[[e.getSouthWest().lat,e.getSouthWest().lng],[e.getNorthEast().lat,e.getNorthEast().lng]],properties:t.osmSearch.previousSearchLimit}))}constructor(){Object.freeze(this),this.#Dd=g,this.#Od=g}show(){U.map.on("zoom",this.#Sd,this),U.map.on("move",this.#Sd,this),this.#Sd(),this.#jd()}hide(){U.map.off("zoom",this.#Sd,this),U.map.off("move",this.#Sd,this),g!==this.#Od&&(Un.dispatch("removeobject",{objId:this.#Od}),this.#Od=g),g!==this.#Dd&&(Un.dispatch("removeobject",{objId:this.#Dd}),this.#Dd=g)}}class ja{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();const e=U.searchData[Number.parseInt(t.target.dataset.tanElementIndex)];Un.dispatch("addsearchpointmarker",{objId:Number.parseInt(t.target.dataset.tanObjId),latLng:[e.lat,e.lon],geometry:e.geometry})}}class Aa{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),Un.dispatch("removeobject",{objId:Number.parseInt(t.target.dataset.tanObjId)})}}class Ha extends ra{#Ad;#yo;#Hd;#Tc;#Pc;#Rd;#kd;#Bd;#Xl(){this.#yo=V.create("div"),this.#Tc=new ya,this.#Pc=new Ta;const t=new ga(this.#Tc,this.#Pc);this.#yo.appendChild(t.toolbarButtonsHTMLElement),this.#yo.appendChild(this.#Tc.treeHTMLElement),this.#yo.appendChild(this.#Pc.waitHTMLElement)}constructor(){super(t.osmSearchDialog.dialogX,t.osmSearchDialog.dialogY)}createContentHTML(){this.#Xl(),this.#Hd=new Da(null,xa),this.#Rd=new Oa,this.#Ad=new Sa,this.#kd=new ja,this.#Bd=new Aa}get contentHTMLElements(){return[].concat(this.#Hd.controlHTMLElement)}get title(){return O.getText("OsmSearchDialog - Searching OpenStreetMap")}get toolbarHTMLElement(){return this.#yo}onCancel(){this.#Ad.hide(),super.onCancel()}show(){super.show(),this.#Ad.show()}updateContent(){this.#Pc.hideWait(),this.#Ad.hide(),this.#Ad.show();const t=[];U.searchData.forEach(((e,o)=>{const i=this.#Rd.buildHTMLElement(e,o);i.addEventListener("mouseenter",this.#kd,!1),i.addEventListener("mouseleave",this.#Bd,!1),t.push(i)})),this.#Hd.updateContent(t)}}class Ra extends bn{#zd;constructor(t){super(t)}createContentHTML(){this.#zd=V.create("div",{textContent:this.options.text||""})}get contentHTMLElements(){return[this.#zd]}get title(){return this.options.title||""}}class ka{#di=null;#Fd=0;#Zd(t){const e=new z;for(const o in t)e[o]=t[o];e.iconLatLng=e.latLng,e.distance=un.getClosestLatLngDistance(this.#di,e.latLng).distance,e.chainedDistance=this.#di.chainedDistance,this.#di.notes.add(e),Un.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:e.objId})}async#Kd(){const t=new gr;t.createUI();const e=new hr,o=this.#di.itinerary.maneuvers.iterator;for(;!o.done;){t.showInfo(O.getText("AllManeuverNotesBuilder - Creating note",{noteNumber:o.index+1,notesLength:this.#Fd}));const i=this.#di.itinerary.itineraryPoints.getAt(o.value.itineraryPointObjId).latLng,n=await e.getIconAndAdressAsync(i,this.#di);n?this.#Zd(n):console.error("An error occurs when creating the svg icon "+o.index)}this.#di.notes.sort(((t,e)=>t.distance-e.distance)),Un.dispatch("updateroadbook"),t.close()}constructor(){Object.freeze(this)}addAllManeuverNotes(e){this.#di=Gn.getRoute(e),this.#Fd=this.#di.itinerary.maneuvers.length,t.note.maxManeuversNotes<this.#Fd?Zn.showError(O.getText("AllManeuverNotesBuilder - max maneuvers notes reached {maneuversLength}{maxManeuversNotes}",{maneuversLength:this.#Fd,maxManeuversNotes:t.note.maxManeuversNotes})):new Ra({title:O.getText("AllManeuverNotesBuilder - Add a note for each maneuver"),text:O.getText("AllManeuverNotesBuilder - Add a note for each maneuver. Are you sure?",{noteLength:this.#Fd}),secondButtonText:"âŒ"}).show().then((()=>this.#Kd())).catch((t=>{t instanceof Error&&console.error(t)}))}}class Ba extends Ds{#di=null;constructor(t,e){super(t,e),this.#di=Gn.getRoute(this.targetObjId)}get menuItems(){return[new Os(O.getText("RouteContextMenu - Edit this route"),this.targetObjId!==U.travel.editedRoute.objId&&l.editedChanged!==U.travel.editedRoute.editionStatus,(()=>kr.editRoute(this.targetObjId))),new Os(O.getText("RouteContextMenu - Delete this route"),this.targetObjId!==U.travel.editedRoute.objId||l.editedChanged!==U.travel.editedRoute.editionStatus,(()=>kr.removeRoute(this.targetObjId))),new Os(O.getText(this.#di.hidden?"RouteContextMenu - Show this route":"RouteContextMenu - Hide this route"),this.#di.hidden||U.travel.editedRoute.objId!==this.targetObjId,(()=>{this.#di.hidden?kr.showRoute(this.targetObjId):kr.hideRoute(this.targetObjId)})),new Os(O.getText("RouteContextMenu - Properties"),!this.#di.hidden,(()=>kr.routeProperties(this.targetObjId))),new Os(O.getText("RouteContextMenu - Zoom to route"),!this.#di.hidden,(()=>(new fr).zoomToRoute(this.targetObjId))),new Os(O.getText("RouteContextMenu - View the elevation"),this.#di.itinerary.hasProfile,(()=>Mr.showProfile(this.targetObjId))),new Os(O.getText("RouteContextMenu - Print route map"),t.printRouteMap.isEnabled,(()=>kr.printRouteMap(this.targetObjId))),new Os(O.getText("RouteContextMenu - Save this route in a GPX file"),0<this.#di.itinerary.itineraryPoints.length,(()=>kr.saveGpx(this.targetObjId))),new Os(O.getText("RouteContextMenu - Invert waypoints"),U.travel.editedRoute.objId===this.targetObjId,(()=>wa.reverseWayPoints())),new Os(O.getText("RouteContextMenu - Add a note on the route"),!this.haveParentNode,(()=>vr.newRouteNote(this.targetObjId,this.latLng))),new Os(O.getText("RouteContextMenu - Create a note for each route maneuver"),!this.#di.hidden,(()=>(new ka).addAllManeuverNotes(this.targetObjId))),new Os(O.getText("RouteContextMenu - Save modifications on this route"),U.travel.editedRoute.objId===this.targetObjId,(()=>kr.saveEdition())),new Os(O.getText("RouteContextMenu - Cancel modifications on this route"),U.travel.editedRoute.objId===this.targetObjId,(()=>kr.cancelEdition()))]}}class za{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),U.travel.name=D.sanitizeToJsString(t.target.value),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name),Un.dispatch("updateroadbook")}}class Fa extends ra{#Ud=null;#Wd=null;constructor(){super(t.travelPropertiesDialog.dialogX,t.travelPropertiesDialog.dialogY)}createContentHTML(){this.#Ud=new ls(O.getText("TravelPropertiesDialog - Name"),{controlChange:new za}),this.#Ud.value=U.travel.name,this.#Wd=new Da(na.routeDropped,Ba,O.getText("TravelPropertiesDialog - Routes"))}get contentHTMLElements(){return[this.#Ud.controlHTMLElement,this.#Wd.controlHTMLElement]}get title(){return O.getText("TravelPropertiesDialog - Travel properties")}#Ei(t,e){const o=(t.editionStatus===l.notEdited?"":"ðŸ”´Â ")+(t.chain?"â›“Â ":"")+(t.objId===U.editedRouteObjId?U.travel.editedRoute.computedName:t.computedName);e.push(V.create("div",{textContent:o,dataset:{ObjId:String(t.objId)}}))}updateContent(){if(!this.#Wd)return;const t=[];U.travel.routes.forEach((e=>{e.objId===U.editedRouteObjId?this.#Ei(U.travel.editedRoute,t):this.#Ei(e,t)})),this.#Wd.updateContent(t),this.#Ud.value=U.travel.name}}class Za extends Ds{#di;constructor(t,e){super(t,e),this.#di=Gn.getNoteAndRoute(this.targetObjId).route}get menuItems(){return[new Os(O.getText("NoteContextMenu - Edit this note"),!0,(()=>vr.editNote(this.targetObjId))),new Os(O.getText("NoteContextMenu - Delete this note"),!0,(()=>vr.removeNote(this.targetObjId))),new Os(O.getText("NoteContextMenu - Zoom to note"),!0,(()=>(new fr).zoomToNote(this.targetObjId))),new Os(O.getText(this.#di?"NoteContextMenu - Detach note from route":"NoteContextMenu - Attach note to route"),g===U.editedRouteObjId,(()=>{this.#di?vr.detachNoteFromRoute(this.targetObjId):vr.attachNoteToRoute(this.targetObjId)}))]}}class Ka extends ra{#Vd;constructor(){super(t.travelNotesDialog.dialogX,t.travelNotesDialog.dialogY)}createContentHTML(){this.#Vd=new Da(vr.travelNoteDropped,Za)}get contentHTMLElements(){return[this.#Vd.controlHTMLElement]}get title(){return O.getText("TravelNotesDialog - Travel notes dialog")}updateContent(){if(!this.#Vd)return;let t=Gs.getTravelNotesHTML("TravelNotes-TravelNotesDialog-");this.#Vd.updateContent(Array.from(t.childNodes))}}const Ua=new class{#Xd=null;#Yd=null;#Gd=null;constructor(){Object.freeze(this)}get osmSearchDialog(){return this.#Xd||(this.#Xd=new Ha(t.osmSearchDialog.dialogX,t.osmSearchDialog.dialogY)),this.#Xd}get travelPropertiesDialog(){return this.#Yd||(this.#Yd=new Fa(t.travelPropertiesDialog.dialogX,t.travelPropertiesDialog.dialogY)),this.#Yd}get travelNotesDialog(){return this.#Gd||(this.#Gd=new Ka(t.travelNotesDialog.dialogX,t.travelNotesDialog.dialogY)),this.#Gd}showTravelProperties(){this.travelPropertiesDialog.show(),this.travelPropertiesDialog.mover.centerDialog()}};const Wa=new class{#Vo;#Yo=null;hide(){this.#Yo&&(clearTimeout(this.#Yo),this.#Yo=null),this.#Vo.removeEventListener("click",this.toggle,!1),document.body.removeChild(this.#Vo)}constructor(){Object.freeze(this)}async toggle(){document.fullscreenElement?await document.exitFullscreen():await document.body.requestFullscreen()}show(){const e=t.FullScreenUI.timeOut;0===e||!document.fullscreenEnabled||document.body.clientWidth>t.FullScreenUI.screenMaxWidth||(this.#Vo=V.create("div",{id:"TravelNotes-FullScreenUI",textContent:O.getText("FullScreenUI - start full screen")},document.body),this.#Vo.addEventListener("click",this.toggle,!1),this.#Yo=setTimeout((()=>this.hide()),e))}};const Va=new class{#qd;constructor(){Object.freeze(this),this.#qd=null}increment(){this.#qd||(this.#qd=t.fontSize.initialValue),this.#qd+=t.fontSize.incrementValue,document.body.style["font-size"]=String(this.#qd)+"mm"}decrement(){this.#qd||(this.#qd=t.fontSize.initialValue),this.#qd-=t.fontSize.incrementValue,document.body.style["font-size"]=String(this.#qd)+"mm"}};class Xa{#Jd;#jt;#di;#$d;#Qd(t){let e=new R;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("ele"===o[t].nodeName)e.elev=Number.parseFloat(o[t].textContent),0!==e.elev&&(this.#di.itinerary.hasProfile=!0);this.#di.itinerary.itineraryPoints.add(e)}#tu(t){const e=t.childNodes;for(let t=0;t<e.length;t++)if("trkpt"===e[t].nodeName)this.#Qd(e[t])}#eu(){let t=0,e=0,o=this.#di.itinerary.itineraryPoints.iterator;for(o.done;!o.done;){let i=o.value.elev-o.previous.elev;0>i?e-=i:t+=i}this.#di.itinerary.ascent=t,this.#di.itinerary.descent=e}#ou(t){this.#di=new F;const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#di.name=e[t].textContent;break;case"trkseg":this.#tu(e[t])}this.#di.itinerary.hasProfile&&this.#eu(),this.#jt.routes.add(this.#di)}#iu(t){let e=Number.MAX_VALUE,o=g;return this.#di.itinerary.itineraryPoints.forEach((i=>{const n=Vn.pointsDistance(t,i.latLng);n<e&&(e=n,o=i.objId)})),o}#nu(t){const e=new k;e.iconName="kUndefined";const o=Number.parseFloat(t.getAttributeNS(null,"lat")),i=Number.parseFloat(t.getAttributeNS(null,"lon"));e.itineraryPointObjId=this.#iu([o,i]);const n=t.childNodes;for(let t=0;t<n.length;t++)if("desc"===n[t].nodeName)e.instruction=n[t].textContent;this.#di.itinerary.maneuvers.add(e)}#su(t){const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#di.name=e[t].textContent;break;case"rtept":this.#nu(e[t])}}#ru(t){const e=new z;e.latLng=t.latLng,e.iconLatLng=t.latLng;const o=t.name.split("+");e.iconContent='<div class="TravelNotes-MapNote TravelNotes-MapNoteCategory-0073"><svg viewBox="0 0 20 20"><text x="10" y="14">'+o[0]+"</text></svg></div>",e.tooltipContent=O.getText("GpxParser - Network node")+o[0],o[1]&&(e.tooltipContent+=O.getText("GpxParser - Go to network node")+o[1]),e.distance=un.getClosestLatLngDistance(this.#di,e.latLng).distance,this.#di.notes.add(e)}#au(t){let e=new H;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("name"===o[t].nodeName)e.name=o[t].textContent;this.#di.wayPoints.add(e),this.#$d&&this.#ru(e)}#lu(t){for(let e=0;e<t.length;e++)this.#au(t[e])}#hu(){this.#jt.routes.forEach((t=>{t.wayPoints.remove(t.wayPoints.first.objId),t.wayPoints.remove(t.wayPoints.last.objId);const e=new H;e.latLng=t.itinerary.itineraryPoints.first.latLng,t.wayPoints.add(e);const o=new H;o.latLng=t.itinerary.itineraryPoints.last.latLng,t.wayPoints.add(o)}))}#Fc(t){const e=t.itinerary.itineraryPoints.iterator,i=t.itinerary.maneuvers.iterator;e.done;let n=i.done;for(n||(i.value.distance=o.defaultValue,n=i.done),t.distance=o.defaultValue,t.duration=o.defaultValue;!e.done;)e.previous.distance=Vn.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,n||(i.previous.distance+=e.previous.distance,i.value.itineraryPointObjId===e.value.objId&&(t.duration+=i.previous.duration,i.value.distance=o.defaultValue,i.next&&i.value.itineraryPointObjId===i.next.itineraryPointObjId&&(n=i.done,i.value.distance=o.defaultValue),n=i.done))}constructor(){Object.freeze(this)}parse(t){this.#Jd=(new DOMParser).parseFromString(t,"text/xml"),this.#$d=Boolean(this.#Jd.querySelector("gpx").getAttributeNS(null,"creator").match(/fietsnet|knooppuntnet/g)),this.#jt=new Z,this.#jt.routes.remove(this.#jt.routes.first.objId);const e=this.#Jd.querySelectorAll("trk");for(let t=0;t<e.length;t++)this.#ou(e[t]);const o=this.#Jd.querySelectorAll("rte");1===o.length&&1===this.#jt.routes.length&&this.#su(o[0]),this.#jt.routes.forEach((t=>this.#Fc(t)));const i=this.#Jd.querySelectorAll("wpt");return 0<i.length&&1===this.#jt.routes.length?(this.#di.wayPoints.remove(this.#di.wayPoints.first.objId),this.#di.wayPoints.remove(this.#di.wayPoints.last.objId),this.#lu(i)):this.#hu(),this.#jt}}class Ya{#cu(){Un.dispatch("removeallobjects"),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name);const t=U.travel.routes.iterator;for(;!t.done;)l.notEdited===t.value.editionStatus&&Un.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t.value.objId});g!==U.editedRouteObjId&&Un.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:U.travel.editedRoute.objId});const e=U.travel.notes.iterator;for(;!e.done;)Un.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:e.value.objId});if(Un.dispatch("updatetravelnotes"),(new fr).zoomToTravel(),Kr.setMapLayer(U.travel.layerName),g!==U.editedRouteObjId){const t=U.travel.editedRoute.itinerary.provider;if(""===t||U.providers.get(t.toLowerCase())){Un.dispatch("setprovider",{provider:t});const e=U.travel.editedRoute.itinerary.transitMode;""!==e&&Un.dispatch("settransitmode",{transitMode:e})}else Zn.showError(O.getText("FileLoader - Not possible to select as provider",{provider:t}))}kr.chainRoutes(),Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook")}constructor(){Object.freeze(this)}openLocalGpxFile(t){Mr.deleteAllProfiles(),U.travel.jsonObject=(new Xa).parse(t).jsonObject,U.editedRouteObjId=g,this.#cu(),Qr.saveStatus=h.saved}openLocalTrvFile(t){Mr.deleteAllProfiles();const e=JSON.parse(t);(new zr).decompress(e),U.travel.jsonObject=e,U.editedRouteObjId=g,U.travel.routes.forEach((t=>{l.notEdited!==t.editionStatus&&(U.editedRouteObjId=t.objId)})),this.#cu(),Qr.saveStatus=h.saved}#du(t){const e=t.routes.iterator;for(;!e.done;)U.travel.routes.add(e.value);const o=t.notes.iterator;for(;!o.done;)U.travel.notes.add(o.value);this.#cu(),Qr.saveStatus=h.modified}mergeLocalGpxFile(t){this.#du((new Xa).parse(t))}mergeLocalTrvFile(t){const e=JSON.parse(t);(new zr).decompress(e);const o=new Z;o.jsonObject=e,this.#du(o)}}class Ga{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation();const o=e.target.files[0].name,i=o.split(".").pop().toLowerCase(),n=new FileReader;n.onload=()=>{try{f!==t.files.openTaN.indexOf(i)?(new Ya).openLocalTrvFile(n.result):f!==t.files.openGpx.indexOf(i)&&(new Ya).openLocalGpxFile(n.result)}catch(t){t instanceof Error&&(console.error(t),Zn.showError("An error occurs when reading the file "+o))}},n.readAsText(e.target.files[0])}}class qa{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation();const o=e.target.files[0].name,i=o.split(".").pop().toLowerCase(),n=new FileReader;n.onload=()=>{try{f!==t.files.openTaN.indexOf(i)?(new Ya).mergeLocalTrvFile(n.result):f!==t.files.openGpx.indexOf(i)&&(new Ya).mergeLocalGpxFile(n.result)}catch(t){t instanceof Error&&(console.error(t),Zn.showError("An error occurs when reading the file "+o))}},n.readAsText(e.target.files[0])}}const Ja=new class extends Gr{constructor(){super()}createUI(){super.createUI("Travel & Notes",c.topRight)}addToolbarItems(){const e=Tn.isTouch?t.files.writeTouch:t.files.writeOthers,o=Object.seal({openTaN:"",openGpx:""});t.files.openTaN.forEach((t=>o.openTaN+="."+t+",")),t.files.openGpx.forEach((t=>o.openGpx+="."+t+","));const i=(o.openTaN+o.openGpx).slice(0,-1);o.openTaN=o.openTaN.slice(0,-1),o.openGpx=o.openGpx.slice(0,-1),o.openTaN.replaceAll(",",", "),o.openGpx.replaceAll(",",", "),this.addToolbarItem(ea.status===n.active?new qr("ðŸ€",O.getText("TravelNotesToolbar - Stop Geo location"),(()=>{ea.switch()})):new qr("ðŸŒ",O.getText("TravelNotesToolbar - Start Geo location"),(()=>{ea.switch()}))),this.addToolbarItem(new qr("âŒ",O.getText("TravelNotesToolbar - Cancel travel"),(()=>{na.newTravel(),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name)}))),this.addToolbarItem(new qr("ðŸ’¾",O.getText("TravelNotesToolbar - Save travel",{extension:e}),(()=>{na.saveTravel()}))),this.addToolbarItem(new qr("ðŸ“‚",O.getText("TravelNotesToolbar - Open travel",o),(()=>{t.travelNotes.haveBeforeUnloadWarning&&!window.confirm(O.getText("TravelNotesToolbar - This page ask to close; data are perhaps not saved."))||S.openFile(new Ga,i)}))),this.addToolbarItem(new qr("ðŸŒ",O.getText("TravelNotesToolbar - Import travel",o),(()=>{g===U.editedRouteObjId?S.openFile(new qa,i):Zn.showError(O.getText("TravelNotesToolbar - Not possible to merge a travel when a route is edited"))}))),this.addToolbarItem(new qr("ðŸ“™",O.getText("TravelNotesToolbar - Open travel roadbook"),"TravelNotesRoadbook.html?lng="+t.travelNotes.language+"&page="+U.UUID)),t.ApiKeysDialog.showButton&&this.addToolbarItem(new qr("ðŸ”‘",O.getText("TravelNotesToolbar - api keys"),(()=>{Wn.setKeysFromDialog()}))),this.addToolbarItem(new qr("ðŸ›„",O.getText("TravelNotesToolbar - Travel properties"),(()=>{Ua.travelPropertiesDialog.show()}))),this.addToolbarItem(new qr("ðŸ—¨ï¸",O.getText("TravelNotesToolbar - Travel notes"),(()=>{Ua.travelNotesDialog.show()}))),this.addToolbarItem(new qr("ðŸ”",O.getText("Search with OpenStreetMap"),(()=>{Ua.osmSearchDialog.show()}))),this.addToolbarItem(new qr("â˜¢ï¸",O.getText("TravelNotesToolbar - Save as travel",{extension:e}),(()=>{na.saveAsTravel()}))),this.addToolbarItem(new qr("ðŸ› ï¸",O.getText("TravelNotesToolbar - About Travel & Notes"),(()=>(new ta).show()))),document.fullscreenEnabled&&this.addToolbarItem(document.fullscreenElement?new qr("ðŸ”»",O.getText("TravelNotesToolbar - disable fullscreen"),(()=>Wa.toggle())):new qr("ðŸ”º",O.getText("TravelNotesToolbar - enable fullscreen"),(()=>Wa.toggle()))),this.addToolbarItem(new qr("+",O.getText("TravelNotesToolbar - Increment the font size"),(()=>{Va.increment()}))),this.addToolbarItem(new qr("-",O.getText("TravelNotesToolbar - Decrement the font size"),(()=>{Va.decrement()}))),this.addToolbarItem(new qr("ðŸ ","Home",window.location.origin)),this.addToolbarItem(new qr("?","Help","https://wwwouaiebe.github.io/TravelNotes/userGuides/README.html#")),this.addToolbarItem(new qr("@","Contact",t.travelNotesToolbar.contactMail.url||window.location.origin))}};class $a{#uu;#nt;#mu;static get#pu(){return Object.freeze({bike:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <path fill="rgb(0,0,191)" d="m 11.25,3.125 v 1.09375 l 1.5625,0.9765625 V 6.5625 H 7.4999999 V 5.625 h 0.625 c 1.25,0 1.25,-1.25 0,-1.25 h -2.5 c -1.25,0 -1.25,1.25 0,1.25 h 0.625 V 6.5625 L 5.0781249,8.75 c -0.026125,-5.821e-4 -0.0519,0 -0.078125,0 -2.0153538,0 -3.75,1.734646 -3.75,3.75 0,2.015354 1.7346462,3.75 3.75,3.75 2.0153537,0 3.75,-1.734646 3.75,-3.75 0,-0.432461 -0.089462,-0.858226 -0.234375,-1.25 h 0.546875 c 0.9375,0 1.1534331,-0.567495 1.4843751,-0.898437 L 12.773438,7.8125 13.4375,9.1015625 C 12.159328,9.7073948 11.25,11.031094 11.25,12.5 c 0,2.015354 1.734646,3.75 3.75,3.75 2.015354,0 3.75,-1.734646 3.75,-3.75 0,-2.015354 -1.734646,-3.75 -3.75,-3.75 -0.03934,0 -0.07808,-0.00131 -0.117187,0 L 13.75,6.5625 V 4.5703125 Z M 7.2265624,7.8125 H 11.132813 L 9.1796874,10 h -1.40625 c -0.0231,0 -0.054487,0.0026 -0.078125,0 C 7.3660586,9.6463159 6.9994024,9.3504739 6.5624999,9.140625 6.5471874,9.1173375 6.5373874,9.0856825 6.5234374,9.0625 Z M 4.9999999,10 c 1.2571387,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.2428613,2.5 -2.5,2.5 -1.2571388,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.2428612,-2.5 2.5,-2.5 z M 15,10 c 1.257137,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.242863,2.5 -2.5,2.5 -1.257139,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.242861,-2.5 2.5,-2.5 z" /> </svg>',pedestrian:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20"  xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)" transform="matrix(0.15866777,0,0,0.12627988,148.47251,-116.69398)"> <path d="m -875.5,962.4 c 2,-1.5 4.6,-2.3 7.4,-2.2 3.6,0.3 6.7,2.5 8.4,5.2 l 10.7,21.2 14.5,10.1 c 1.2,1 2,2.5 1.9,4.2 -0.1,2.6 -2.5,4.6 -5.2,4.3 -0.7,0 -1.5,-0.3 -2.2,-0.7 l -15.6,-10.7 c -0.4,-0.4 -0.9,-0.9 -1.2,-1.5 l -4.1,-7.9 -4.8,21.1 18.9,22.3 c 0.4,0.7 0.7,1.5 0.9,2.2 l 5.1,26.9 c 0,0.6 0,1 0,1.5 -0.3,4.1 -3.8,6.8 -7.7,6.7 -3.2,-0.3 -5.7,-2.6 -6.5,-5.7 l -4.8,-25.1 -15.3,-17 -3.6,16.3 c -0.1,0.7 -1.2,2.3 -1.5,2.9 l -14.6,24.9 c -1.5,2.2 -3.9,3.8 -6.7,3.4 -4.1,-0.3 -7,-3.8 -6.7,-7.7 0.1,-1.2 0.6,-2.2 1,-3.1 l 13.7,-22.8 11.4,-50.4 -7.4,6 -4.1,18 c -0.4,2.2 -2.6,4.2 -5.1,4.1 -2.6,-0.1 -4.6,-2.5 -4.5,-5.2 0,-0.1 0,-0.4 0.1,-0.6 l 4.6,-20.9 c 0.3,-0.9 0.7,-1.6 1.5,-2.2 z" /> <path d="m -884.5,943.5 c 1.3,8.6 8.7,15.3 17.8,15.3 5.7,0 10.2,-4.6 10.2,-10.2 0,-5.6 -4.6,-10.2 -10.2,-10.2 -3.9,0 -7.2,2 -8.9,5.2 -0.2,0.4 -0.5,0.7 -0.8,1 -2,2 -5.3,2 -7.3,0 -0.4,-0.4 -0.6,-0.7 -0.8,-1.1 z" /> </g> </svg>',car:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" > <g fill="rgb(0,0,191)"> <path d="m 2,13 a 1.7142857,1.7142857 0 0 0 1.7142857,1.714286 H 16.285714 A 1.7142857,1.7142857 0 0 0 18,13 V 9.5714286 A 1.7142857,1.7142857 0 0 0 16.285714,7.8571429 H 3.7142857 A 1.7142857,1.7142857 0 0 0 2,9.5714286 Z m 1.8285714,-2.285714 a 1.0285714,1.0285714 0 1 1 0,0.01143 z m 10.2857146,0 a 1.0285714,1.0285714 0 1 1 0,0.01143 z" /> <path d="M 4.2857143,7.8571429 V 5 A 1.7142857,1.7142857 0 0 1 6,3.2857143 h 8 A 1.7142857,1.7142857 0 0 1 15.714286,5 V 7.8571429 H 14 V 6.1428571 A 1.1428571,1.1428571 0 0 0 12.857143,5 H 7.1428571 A 1.1428571,1.1428571 0 0 0 6,6.1428571 v 1.7142858 z" /> <g transform="matrix(1.1428571,0,0,1.1428571,2,2.1428571)"> <rect x="1" y="10" width="2" height="3" /> <rect x="11" y="10" width="2" height="3" /> </g> </g> </svg>',train:'data:image/svg+xml;utf8,<svg viewBox="-3 -3 20 20" xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)"> <path d="M 5,0 C 3.025911,-0.0084 1,3 1,7 l 0,2 c 0,1 1,2 2,2 l 8,0 c 1,0 2,-1 2,-2 L 13,7 C 13,3 11,0 9,0 z m -1,3 6,0 c 0,0 1,1 1,3 L 3.03125,6 C 2.994661,3.9916 4,3 4,3 z M 3,8 6,8 6,9 3,9 z m 5,0 3,0 0,1 -3,0 z m -6,4 -1,2 3,0 1,-2 z m 7,0 1,2 3,0 -1,-2 z"/></g></svg>',line:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <line x1="5" y1="17" x2= "11" y2="2" stroke="rgb(0,0,0)" /> <line x1="3" y1="6" x2="17" y2="9" stroke="rgb(191,0,0)" /> <line x1="3" y1= "16" x2="17" y2="5" stroke="rgb(255,204,0)" /> </svg>',circle:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <g fill="transparent"> <circle cx="8" cy="6" r="5" stroke="rgb(0,0,0)" /> <circle cx="12" cy="12" r="4" stroke="rgb(255,204,0)" /> <circle cx="14" cy="8" r="3" stroke="rgb(191,0,0)" /> </g> </svg>'})}constructor(t,e){Object.freeze(this),this.#uu=t,this.#nt=e,this.#mu=V.create("img",{src:$a.#pu[e],id:"TravelNotes-ProvidersToolbar-"+e+"ImgButton",className:"TravelNotes-ProvidersToolbar-ImgButton",title:O.getText("ProvidersToolbar - TransitMode "+e)}),this.#mu.addEventListener("click",this),this.visible=!1}handleEvent(t){t.stopPropagation(),this.#uu.transitMode=this.#nt,this.#uu.hide(),Ea.startRouting()}get buttonHTMLElement(){return this.#mu}get transitMode(){return this.#nt}set active(t){t?this.#mu.classList.add("TravelNotes-ProvidersToolbar-ActiveTransitModeImgButton"):this.#mu.classList.remove("TravelNotes-ProvidersToolbar-ActiveTransitModeImgButton")}set visible(t){t?this.#mu.classList.remove("TravelNotes-Hidden"):this.#mu.classList.add("TravelNotes-Hidden")}}class Qa{#uu;#it;#mu;constructor(t,e){Object.freeze(this),this.#uu=t,this.#it=e,this.#mu=V.create("img",{src:e.icon,id:"TravelNotes-ProvidersToolbar-"+e.name+"ImgButton",className:"TravelNotes-ProvidersToolbar-ImgButton",title:e.title||e.name}),this.#mu.addEventListener("click",this)}handleEvent(t){t.stopPropagation(),this.#uu.provider=this.#it.name,Ea.startRouting()}get buttonHTMLElement(){return this.#mu}get provider(){return this.#it}set active(t){t?this.#mu.classList.add("TravelNotes-ProvidersToolbar-ActiveProviderImgButton"):this.#mu.classList.remove("TravelNotes-ProvidersToolbar-ActiveProviderImgButton")}}class tl{#yo;#gu;#mh;#vu;#fu;#_u;#yu;#_h;#tc;static get#Tu(){return 100}#Lu(){["bike","pedestrian","car","train","line","circle"].forEach((t=>{const e=new $a(this,t);this.#vu.set(t,e),this.#mh.appendChild(e.buttonHTMLElement)}))}#bu(){U.providers.forEach((t=>{if(!t.providerKeyNeeded||Wn.hasKey(t.name)){const e=new Qa(this,t);this.#fu.set(t.name,e),this.#mh.appendChild(e.buttonHTMLElement)}}))}#Qe(){this.#_h=!0,setTimeout((()=>this.#Eu()),tl.#Tu)}#Eu(){this.#yo.style.top=0,this.#mh.classList.remove("TravelNotes-Hidden"),this.centerToolbar()}#wu(){Tn.isTouch&&(this.#_h?this.hide():this.#Qe())}#Mu(){Tn.isTouch||(this.#tc&&(clearTimeout(this.#tc),this.#tc=null),this.#Qe())}#xu(){Tn.isTouch||(this.#tc=setTimeout((()=>this.hide()),t.toolbars.timeOut))}hide(){this.#tc&&(clearTimeout(this.#tc),this.#tc=null),this.#mh.classList.add("TravelNotes-Hidden"),this.centerToolbar(),this.#_h=!1}constructor(){Object.freeze(this),this.#vu=new Map,this.#fu=new Map}centerToolbar(){this.#gu.textContent=O.getText("ProvidersToolbar - Computed by {provider} for {transitMode}",{provider:U.routing.provider,transitMode:O.getText("ProvidersToolbar - TransitMode "+U.routing.transitMode)}),this.#yo.style.left=String((window.visualViewport.width-this.#yo.clientWidth)/2)+"px",this.#yo.style.top=String(window.visualViewport.height-this.#yo.clientHeight-2)+"px"}createUI(){this.#yo=V.create("div",{id:"TravelNotes-ProvidersToolbar-Container"},document.body),this.#yo.addEventListener("mouseenter",(t=>this.#Mu(t)),!1),this.#yo.addEventListener("mouseleave",(t=>this.#xu(t)),!1),this.#gu=V.create("div",{className:"TravelNotes-ProvidersToolbar-TopBar",textContent:O.getText("TravelNotes-ProvidersToolbar - Providers")},this.#yo),this.#gu.addEventListener("click",(t=>this.#wu(t)),!1),this.#mh=V.create("div",{className:"TravelNotes-ProvidersToolbar-ImgButtonsDiv TravelNotes-Hidden"},this.#yo),this.#Lu(),this.#bu(),this.provider=this.#fu.keys().next().value,this.centerToolbar()}set provider(t){U.routing.provider=t,this.#yu&&(this.#yu.active=!1),this.#yu=this.#fu.get(t),this.#yu.active=!0;const e=U.providers.get(t.toLowerCase());this.#vu.forEach((t=>{t.visible=f!==e.transitModes.indexOf(t.transitMode)})),this.#_u&&f!==e.transitModes.indexOf(this.#_u.transitMode)||(this.#_u=null,this.#vu.forEach((t=>{this.#_u||f===e.transitModes.indexOf(t.transitMode)?t.active=!1:(this.#_u=t,t.active=!0,U.routing.transitMode=t.transitMode)}))),this.centerToolbar()}set transitMode(t){U.routing.transitMode=t,this.#_u&&(this.#_u.active=!1),this.#_u=this.#vu.get(t),this.#_u.active=!0,this.centerToolbar()}providersAdded(){for(;this.#mh.firstChild;)this.#mh.removeChild(this.#mh.firstChild);this.#vu.clear(),this.#fu.clear(),this.#Lu(),this.#bu(),this.provider=this.#fu.keys().next().value;const t=this.#fu.keys().next().value;this.provider=t,this.transitMode=U.providers.get(t.toLowerCase()).transitModes[0],this.centerToolbar()}}const el=new tl;class ol extends Ds{constructor(t,e){super(t,e)}get menuItems(){return[new Os(O.getText("MapContextMenu - Select this point as start point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.first.lat,(()=>wa.setStartPoint(this.latLng))),new Os(O.getText("MapContextMenu - Select this point as way point"),g!==U.editedRouteObjId,(()=>wa.addWayPoint(this.latLng))),new Os(O.getText("MapContextMenu - Select this point as end point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.last.lat,(()=>wa.setEndPoint(this.latLng))),new Os(O.getText("MapContextMenu - Select this point as start and end point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.first.lat&&a.defaultValue===U.travel.editedRoute.wayPoints.last.lat,(()=>wa.setStartAndEndPoint(this.latLng))),new Os(O.getText("MapContextMenu - Add a route"),!0,(()=>kr.addRoute())),new Os(O.getText("MapContextMenu - Hide all routes"),!0,(()=>kr.hideRoutes())),new Os(O.getText("MapContextMenu - Show all routes"),!0,(()=>kr.showRoutes())),new Os(O.getText("MapContextMenu - New travel note"),!0,(()=>vr.newTravelNote(this.latLng))),new Os(O.getText("MapContextMenu - Hide all notes"),!0,(()=>vr.hideNotes())),new Os(O.getText("MapContextMenu - Show all notes"),!0,(()=>vr.showNotes())),new Os(O.getText("MapContextMenu - Zoom to travel"),!0,(()=>(new fr).zoomToTravel()))]}}class il{static handleEvent(){Ro.off(Hr.marker,"mouseout",Rr.handleEvent)}}class nl{static handleEvent(t){t.latlng.lat=Hr.initialLatLng[0],t.latlng.lng=Hr.initialLatLng[1],t.target.objId=U.travel.editedRoute.objId,new Ba(t).show()}}class sl{static handleEvent(t){U.mapObjects.get(U.travel.editedRoute.objId).openPopup(t.latlng)}}class rl{static handleEvent(t){wa.addWayPointOnRoute(Hr.initialLatLng,[t.target.getLatLng().lat,t.target.getLatLng().lng]),Hr.marker&&(Ro.off(Hr.marker,"dragstart",il.handleEvent),Ro.off(Hr.marker,"dragend",rl.handleEvent),Ro.off(Hr.marker,"contextmenu",nl.handleEvent),U.map.removeLayer(Hr.marker),Hr.marker=null)}}class al{static#Iu=1;static handleEvent(e){const o=Gn.getRoute(e.target.objId);if(Hr.initialLatLng=[e.latlng.lat,e.latlng.lng],Hr.marker)Hr.marker.setLatLng(e.latlng);else{Hr.marker=new Ti(e.latlng,{icon:new zi({iconSize:[y,y],iconAnchor:[10,y],html:'<div class="TravelNotes-Map-WayPoint TravelNotes-Map-WayPointTmp"></div><div class="TravelNotes-Map-WayPointText">?</div>',className:"TravelNotes-Map-WayPointStyle"}),draggable:!0});let i="";(f===t.route.showDragTooltip||al.#Iu<=t.route.showDragTooltip)&&(al.#Iu++,i=O.getText("EditedRouteMouseOverEL - Drag and drop to add a waypoint")+" - "),i+=o.computedName+" - ";let n=un.getClosestLatLngDistance(o,[e.latlng.lat,e.latlng.lng]).distance;n+=o.chainedDistance,i+=S.formatDistance(n),Hr.marker.bindTooltip(i),Hr.marker.getTooltip().options.offset=[0,0],Hr.marker.addTo(U.map),Ro.on(Hr.marker,"mouseout",Rr.handleEvent),Ro.on(Hr.marker,"dragstart",il.handleEvent),Ro.on(Hr.marker,"dragend",rl.handleEvent),Ro.on(Hr.marker,"contextmenu",nl.handleEvent),Ro.on(Hr.marker,"click",sl.handleEvent)}}}class ll{static createFakeEvent(e){const o=Gn.getNearestRouteData([e.latlng.lat,e.latlng.lng]);if(!o.route)return;const i=new Ot(o.latLngOnRoute[0],o.latLngOnRoute[1]),n=U.map.latLngToContainerPoint(i);return n.distanceTo(e.containerPoint)>(Tn.isTouch?t.mapContextMenu.touchMaxRouteDistance:t.mapContextMenu.mouseMaxRouteDistance)?void 0:Object.freeze({clientX:n.x,clientY:n.y,latlng:i,target:o.route})}static handleClickEvent(t){const e=ll.createFakeEvent(t);e&&Tn.isTouch&&e.target.editionStatus!==l.notEdited&&al.handleEvent(e)}static handleContextMenuEvent(t){const e=ll.createFakeEvent(t);e?new Ba(e).show():new ol(t).show()}}const hl=new class{#Cu=!1;constructor(){Object.freeze(this)}async addReadOnlyTravel(t){if(this.#Cu)return;this.#Cu=!0,Zr.createUI(),Kr.setMapLayer("OSM - Color");const e=await fetch(t);p===e.status&&e.ok?(new Fr).openDistantFile(await e.json()):(U.map.setView([a.defaultValue,a.defaultValue],2),document.title="Travel & Notes")}addToolbarsMenusUIs(){this.#Cu||(this.#Cu=!0,document.title="Travel & Notes",U.map.on("contextmenu",ll.handleContextMenuEvent),U.map.on("click",ll.handleClickEvent),U.map.setView([t.map.center.lat,t.map.center.lng],t.map.zoom),Zr.createUI(),Qr.createUI(),Qr.saveStatus=h.saved,Zn.showHelp("<p>"+O.getText("Help - Continue with interface1")+"</p><p>"+O.getText("Help - Continue with interface2")+"</p>"),Jr.createUI(),Kr.setMapLayer("OSM - Color"),Ja.createUI(),el.createUI(),Wn.setKeysFromServerFile(),U.travel.jsonObject=(new Z).jsonObject,t.travelNotes.startupRouteEdition&&kr.editRoute(U.travel.routes.first.objId),Un.dispatch("updatetravelproperties"),Un.dispatch("updateroadbook"),Wa.show())}addProvider(t){Wn.addProvider(t)}showInfo(t){Zn.showInfo(t)}get overpassApiUrl(){return t.overpassApi.url}get map(){return U.map}get version(){return E}};class cl{#Nu(t,e){if("object"==typeof t&&"object"==typeof e){for(const o in e)"object"==typeof e[o]?this.#Nu(t[o],e[o]):typeof t[o]==typeof e[o]&&("string"==typeof e[o]?e[o]="color"===o?D.sanitizeToColor(t[o])||e[o]:"url"===o?D.sanitizeToUrl(t[o]).url:D.sanitizeToJsString(t[o]):e[o]=t[o]||e[o]);for(const o in t)"object"==typeof t[o]?("[object Array]"===Object.prototype.toString.call(t[o])?e[o]=e[o]||[]:e[o]=e[o]||{},this.#Nu(t[o],e[o])):"string"==typeof e.property?e[o]=D.sanitizeToHtmlString(t[o],[]).htmlString:e[o]=t[o]}}#Pu(t){for(const e in t)"object"==typeof t[e]&&this.#Pu(t[e]);Object.freeze(t)}constructor(){Object.freeze(this)}overload(e){this.#Nu(e,t),this.#Pu(t)}}const dl=new class{#Du(t,e){const i=V.create("div"),n=V.create("div",{className:t+"Route-ManeuversAndNotes-IconCell"},i);V.create("div",{className:"TravelNotes-ManeuverNote TravelNotes-ManeuverNote-"+e.maneuver.iconName},n),n.dataset.tanWidth=String(s.width)+"px",n.dataset.tanHeight=String(s.height)+"px";const r=V.create("div",{className:t+"Route-ManeuversAndNotes-Cell"},i);return V.create("div",{className:t+"Route-Maneuver-TooltipContent",textContent:O.getText("RouteHTMLViewsFactory - "+e.maneuver.iconName)},r),D.sanitizeToHtmlElement(e.maneuver.instruction,V.create("div",{className:t+"Route-Maneuver-Instruction"},r)),e.route.chain&&D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+S.formatDistance(e.route.chainedDistance+e.maneuverDistance),V.create("div",{className:t+"Route-Maneuver-TravelDistance"},r)),D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+S.formatDistance(e.maneuverDistance),V.create("div",{className:t+"Route-Maneuver-RouteDistance"},r)),o.defaultValue<e.maneuver.distance&&D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Next maneuver after")+"</span>Â :Â "+S.formatDistance(e.maneuver.distance),V.create("div",{className:t+"Route-Maneuver-NextDistance"},r)),i}constructor(){Object.freeze(this)}getRouteProfileHTML(t,e){const o=V.create("div",{className:t+"RouteProfile"});return D.sanitizeToHtmlElement(O.getText("RouteHTMLViewsFactory - Profile"),o),o.appendChild((new Ls).createSvg(e)),o}getRouteManeuversAndNotesHTML(t,e,o){const i=[],n=e.notes.iterator;for(;!n.done;)i.push({data:n.value,distance:n.value.distance});const s=e.itinerary.maneuvers.iterator;let r=0;for(;!s.done;)i.push({data:s.value,distance:r}),r+=s.value.distance;i.sort(((t,e)=>t.distance-e.distance));const a=V.create("div",{className:t+"Route-ManeuversAndNotes"});return i.forEach((i=>{let n=null;"Note"===i.data.objType.name?(n=Gs.getNoteTextAndIconHTML(t,{note:i.data,route:e}),n.className=t+"Route-Notes-Row"):(n=this.#Du(t,{route:e,maneuver:i.data,maneuverDistance:i.distance}),n.className=t+"Route-Maneuvers-Row"),o&&(n.dataset.tanObjId=i.data.objId,n.dataset.tanMarkerObjId=T.nextObjId,n.dataset.tanObjType=i.data.objType.name),a.appendChild(n)})),a}getRouteHeaderHTML(t,e){const o=V.create("div",{className:t+"Route-Header",id:"route"+e.objId});return D.sanitizeToHtmlElement(e.computedName,V.create("div",{className:t+"Route-Header-Name"},o)),0!==e.distance&&D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Route distance")+"</span>Â :Â "+S.formatDistance(e.distance),V.create("div",{className:t+"Route-Header-Distance"},o)),U.travel.readOnly||"bike"===e.itinerary.transitMode||D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Duration")+"</span>Â :Â "+S.formatTime(e.duration),V.create("div",{className:t+"Route-Header-Duration"},o)),e.itinerary.hasProfile&&(D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Ascent")+"</span>Â :Â "+String(e.itinerary.ascent.toFixed(0))+" m.",V.create("div",{className:t+"Route-Header-Ascent"},o)),D.sanitizeToHtmlElement("<span>"+O.getText("RouteHTMLViewsFactory - Descent")+"</span>Â :Â "+String(e.itinerary.descent.toFixed(0))+" m.",V.create("div",{className:t+"Route-Header-Descent"},o))),o}getRouteFooterHTML(t,e){let o=""!==e.itinerary.provider&&""!==e.itinerary.transitMode?O.getText("RouteHTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:O.getText("RouteHTMLViewsFactory - TransitMode "+e.itinerary.transitMode)}):"";const i=V.create("div",{className:t+"RouteFooter"});return D.sanitizeToHtmlElement(o,i),i}};class ul{static handleEvent(t){const e=Gn.getRoute(t.target.objId);let o=un.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;o+=e.chainedDistance,o=S.formatDistance(o);const i=U.mapObjects.get(t.target.objId);i.closeTooltip();let n=e.computedName;U.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),i.setTooltipContent(n),i.openTooltip(t.latlng)}}class ml{#ja;#Ou;#Su;constructor(t,e,o){Object.freeze(this),this.#ja=t,this.#Ou=e,this.#Su=o}get marker(){return this.#ja}get polyline(){return this.#Ou}get bullet(){return this.#Su}}class pl{#ju;#Au;static get#Hu(){return 18}static get#Ru(){return 0}static get#ku(){return 100}constructor(){Object.freeze(this),this.#ju=null,this.#Au=null}addToMap(t,e){e.objId=t,e.addTo(U.map),U.mapObjects.set(t,e)}addRoute(t){const e=Gn.getRoute(t),o=[],i=e.itinerary.itineraryPoints.iterator;for(;!i.done;)o.push(i.value.latLng);const n=new wi(o,{color:e.color,weight:e.width,dashArray:e.dashString});this.addToMap(e.objId,n),l.notEdited===e.editionStatus&&(n.bindTooltip(e.computedName,{sticky:!0,direction:"right"}),Tn.isTouch||(Ro.on(n,"mouseover",ul.handleEvent),Ro.on(n,"mousemove",ul.handleEvent),n.bindPopup((t=>D.clone(dl.getRouteHeaderHTML("TravelNotes-Map-",Gn.getRoute(t.objId))))),Ro.on(n,"click",(t=>t.target.openPopup(t.latlng)))));const s=e.notes.iterator;for(;!s.done;)this.addNote(s.value.objId);return e}addNote(e){const o=Gn.getNoteAndRoute(e).note,i=new Ti(o.latLng,{icon:new zi({iconSize:[t.note.grip.size,t.note.grip.size],iconAnchor:[t.note.grip.size/2,t.note.grip.size/2],html:"<div></div>",className:"TravelNotes-Map-Note-Bullet"}),opacity:t.note.grip.opacity,draggable:!U.travel.readOnly});i.objId=o.objId;const n=new Ti(o.iconLatLng,{zIndexOffset:pl.#ku,icon:new zi({iconSize:[o.iconWidth,o.iconHeight],iconAnchor:[o.iconWidth/2,o.iconHeight/2],popupAnchor:[0,-o.iconHeight/2],html:o.iconContent,className:"TravelNotes-Map-AllNotes "}),draggable:!U.travel.readOnly});n.objId=o.objId,n.bindPopup((t=>D.clone(Gs.getNoteTextHTML("TravelNotes-Map-",Gn.getNoteAndRoute(t.objId))))),0!==o.tooltipContent.length&&(n.bindTooltip((t=>Gn.getNoteAndRoute(t.objId).note.tooltipContent)),n.getTooltip().options.offset[0]=o.iconWidth/2);const s=new wi([o.latLng,o.iconLatLng],t.note.polyline);s.objId=o.objId;const r=new gi([n,s,i]);return r.markerId=Lt.stamp(n),r.polylineId=Lt.stamp(s),r.bulletId=Lt.stamp(i),this.addToMap(o.objId,r),t.note.haveBackground&&document.querySelectorAll(".TravelNotes-MapNote,.TravelNotes-SvgIcon").forEach((t=>t.classList.add("TravelNotes-Map-Note-Background"))),new ml(n,s,i)}zoomTo(e,o){if(o){let t=[];o.forEach((e=>t=t.concat(e))),U.map.fitBounds(un.getLatLngBounds(t))}else U.map.setView(e,t.itineraryPoint.zoomFactor)}setLayer(t,e){const o="wmts"===t.service.toLowerCase()?new Zi(e):new Zi.WMS(e,t.wmsOptions);this.#ju&&U.map.removeLayer(this.#ju),U.map.addLayer(o),this.#ju=o,U.travel.readOnly||(U.map.getZoom()<(t.minZoom||pl.#Ru)&&U.map.setZoom(t.minZoom||pl.#Ru),U.map.setMinZoom(t.minZoom||pl.#Ru),U.map.getZoom()>(t.maxZoom||pl.#Hu)&&U.map.setZoom(t.maxZoom||pl.#Hu),U.map.setMaxZoom(t.maxZoom||pl.#Hu),t.bounds?(U.map.getBounds().intersects(t.bounds)&&!U.map.getBounds().contains(t.bounds)||(U.map.setMaxBounds(null),U.map.fitBounds(t.bounds),U.map.setZoom(t.minZoom||pl.#Ru)),U.map.setMaxBounds(t.bounds)):U.map.setMaxBounds(null)),U.map.fire("baselayerchange",o)}onGeolocationStatusChanged(t){n.active!==t&&this.#Au&&(U.map.removeLayer(this.#Au),this.#Au=null)}#Bu(t){const e=O.getText("MapEditorViewer -Copied to clipboard"),o=t.target.getTooltip().getContent();f===o.indexOf(e)&&navigator.clipboard.writeText(o.replaceAll("<br/>","\n")).then((()=>{t.target.getTooltip().setContent(o+"<br/><br/>"+O.getText("MapEditorViewer -Copied to clipboard"))})).catch((()=>console.error("Failed to copy to clipboard ")))}onGeolocationPositionChanged(e){let o=t.geoLocation.zoomToPosition;this.#Au&&(U.map.removeLayer(this.#Au),o=!1);let i="Position (+/- "+e.coords.accuracy.toFixed(0)+" m) : <br/>"+S.formatLatLngDMS([e.coords.latitude,e.coords.longitude])+"<br/>"+S.formatLatLng([e.coords.latitude,e.coords.longitude])+"<br/>";e.coords.altitude&&(i+="<br/> Altitude  :<br/>"+e.coords.altitude.toFixed(0)+" m",e.coords.altitudeAccuracy&&(i+="(+/- "+e.coords.altitudeAccuracy.toFixed(0)+" m)")),0===t.geoLocation.marker.radius?(this.#Au=new Ei(new Ot(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#Au.setRadius(e.coords.accuracy.toFixed(0))):this.#Au=new bi(new Ot(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#Au.bindTooltip(i).addTo(U.map),t.geoLocation.watch||this.#Au.bindPopup(i).openPopup(),this.#Au.on("click",(t=>{this.#Bu(t)})),o&&U.map.setView(new Ot(e.coords.latitude,e.coords.longitude),t.geoLocation.zoomFactor)}}class gl{static handleEvent(t){const e=Gn.getNoteAndRoute(t.target.objId),o=e.note,i=e.route,n=U.mapObjects.get(t.target.objId);if(null===i)o.latLng=[t.target.getLatLng().lat,t.target.getLatLng().lng],Un.dispatch("updatetravelnotes");else{const e=un.getClosestLatLngDistance(i,[t.target.getLatLng().lat,t.target.getLatLng().lng]);o.latLng=e.latLng,o.distance=e.distance,i.notes.sort(((t,e)=>t.distance-e.distance)),n.getLayer(n.bulletId).setLatLng(e.latLng)}n.getLayer(n.polylineId).setLatLngs([o.latLng,o.iconLatLng]),Un.dispatch("updateroadbook")}}class vl{static handleEvent(t){const e=Gn.getNoteAndRoute(t.target.objId).note,o=U.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([[t.latlng.lat,t.latlng.lng],e.iconLatLng])}}class fl{static handleEvent(e){e.originalEvent.target.style.opacity=t.note.grip.moveOpacity}}class _l{static handleEvent(e){e.originalEvent.target.style.opacity=t.note.grip.opacity}}class yl{static handleEvent(t){new Za(t).show()}}class Tl{static handleEvent(t){const e=Gn.getNoteAndRoute(t.target.objId).note;e.iconLatLng=[t.target.getLatLng().lat,t.target.getLatLng().lng];const o=U.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,e.iconLatLng])}}class Ll{static handleEvent(t){const e=Gn.getNoteAndRoute(t.target.objId).note,o=U.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,[t.latlng.lat,t.latlng.lng]])}}class bl extends Ds{constructor(t,e){super(t,e)}get menuItems(){return[new Os(O.getText("WayPointContextMenu - Delete this waypoint"),U.travel.editedRoute.wayPoints.first.objId!==this.targetObjId&&U.travel.editedRoute.wayPoints.last.objId!==this.targetObjId,(()=>wa.removeWayPoint(this.targetObjId))),new Os(O.getText("WayPointContextMenu - Modify properties"),!0,(()=>wa.wayPointProperties(this.targetObjId)))]}}class El{static handleEvent(t){new bl(t).show()}}class wl{static handleEvent(t){wa.wayPointDragEnd(t)}}class Ml{static handleEvent(t){Ro.stopPropagation(t),new Ba(t).show()}}class xl extends pl{static get#zu(){return.01}#Fu(t){const e=U.mapObjects.get(t);e&&(Ro.off(e),U.map.removeLayer(e),U.mapObjects.delete(t))}constructor(){super()}updateRoute(t,e){if(g!==t){const e=Gn.getRoute(t);this.#Fu(e.objId);const o=e.notes.iterator;for(;!o.done;)this.#Fu(o.value.objId);const i=e.wayPoints.iterator;for(;!i.done;)this.#Fu(i.value.objId)}if(g!==e){const t=this.addRoute(e),o=U.mapObjects.get(e);if(!U.travel.readOnly){Ro.on(o,"contextmenu",Ml.handleEvent),l.notEdited===t.editionStatus||Tn.isTouch||Ro.on(o,"mouseover",al.handleEvent);const e=t.notes.iterator;for(;!e.done;){const t=U.mapObjects.get(e.value.objId),o=t.getLayer(t.markerId),i=t.getLayer(t.bulletId);Ro.on(i,"dragend",gl.handleEvent),Ro.on(i,"drag",vl.handleEvent),Ro.on(i,"mouseenter",fl.handleEvent),Ro.on(i,"mouseleave",_l.handleEvent),Ro.on(o,"contextmenu",yl.handleEvent),Ro.on(o,"dragend",Tl.handleEvent),Ro.on(o,"drag",Ll.handleEvent)}}if(!U.travel.readOnly&&l.notEdited!==t.editionStatus){const t=U.travel.editedRoute.wayPoints.iterator;for(;!t.done;)this.addWayPoint(t.value,t.first?"A":t.last?"B":t.index)}}}updateRouteProperties(t){const e=U.mapObjects.get(t),o=Gn.getRoute(t);e.setStyle({color:o.color,weight:o.width,dashArray:o.dashString})}updateNote(t,e){let o=!1;if(g!==t){const e=U.mapObjects.get(t);e&&(o=e.getLayer(e.markerId).isPopupOpen()),this.#Fu(t)}if(g!==e){const t=this.addNote(e);o&&t.marker.openPopup(),U.travel.readOnly||(Ro.on(t.bullet,"dragend",gl.handleEvent),Ro.on(t.bullet,"drag",vl.handleEvent),Ro.on(t.bullet,"mouseenter",fl.handleEvent),Ro.on(t.bullet,"mouseleave",_l.handleEvent),Ro.on(t.marker,"contextmenu",yl.handleEvent),Ro.on(t.marker,"dragend",Tl.handleEvent),Ro.on(t.marker,"drag",Ll.handleEvent))}}removeObject(t){this.#Fu(t)}removeAllObjects(){U.mapObjects.forEach((t=>{Ro.off(t),U.map.removeLayer(t)})),U.mapObjects.clear()}addWayPoint(t,e){if(a.defaultValue===t.lat&&a.defaultValue===t.lng)return;const o='<div class="TravelNotes-Map-WayPoint TravelNotes-Map-WayPoint'+("A"===e?"Start":"B"===e?"End":"Via")+'"></div><div class="TravelNotes-Map-WayPointText">'+e+"</div>",i=new Ti(t.latLng,{icon:new zi({iconSize:[y,y],iconAnchor:[10,y],html:o,className:"TravelNotes-Map-WayPointStyle"}),draggable:!0});i.bindTooltip((t=>Gn.getWayPoint(t.objId).fullName)),i.getTooltip().options.offset=[10,-10],Ro.on(i,"contextmenu",El.handleEvent),i.objId=t.objId,this.addToMap(t.objId,i),Ro.on(i,"dragend",wl.handleEvent)}addItineraryPointMarker(e,o){this.addToMap(e,new bi(o,t.itineraryPoint.marker))}addSearchPointMarker(e,o,i){let n=!1;if(i){let t=[];i.forEach((e=>{t=t.concat(e)}));const e=un.getLatLngBounds(t),o=U.map.getBounds();n=(e.getEast()-e.getWest())/(o.getEast()-o.getWest())>xl.#zu&&(e.getNorth()-e.getSouth())/(o.getNorth()-o.getSouth())>xl.#zu}n?this.addToMap(e,new wi(i,t.osmSearch.searchPointPolyline)):this.addToMap(e,new bi(o,t.osmSearch.searchPointMarker))}addRectangle(t,e,o){this.addToMap(t,new qi(e,o))}setLayer(t){const e=Wn.getUrl(t);e&&super.setLayer(t,e)}}const Il=new xl;class Cl{#Zu;#Ot;#Ku;static get#Uu(){return 1}#Wu(t,e){if(this.#Zu)return void t();const o=window.indexedDB.open("TravelNotesDb",Cl.#Uu);o.onerror=()=>{this.#Zu=null,e(new Error("Not possible to open the db"))},o.onsuccess=e=>{this.#Zu=e.target.result,t()},o.onupgradeneeded=t=>{this.#Zu=t.target.result,this.#Zu.createObjectStore("Travels",{keyPath:"UUID"})}}#Vu(t,e){if(!this.#Zu)return void e(new Error("Database not opened"));const o=this.#Zu.transaction(["Travels"],"readonly");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").get(this.#Ot).onsuccess=e=>t(e.target.result?e.target.result.data:null)}#Xu(t,e){if(!this.#Zu)return void e(new Error("Database not opened"));const o=this.#Zu.transaction(["Travels"],"readwrite");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").put({UUID:this.#Ot,data:this.#Ku}).onsuccess=()=>t()}#Yu(){this.#Zu.close(),this.#Zu=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise(((t,e)=>this.#Wu(t,e)))}getReadPromise(t){return this.#Ot=t,new Promise(((t,e)=>this.#Vu(t,e)))}getWritePromise(t,e){return this.#Ot=t,this.#Ku=e,new Promise(((t,e)=>this.#Xu(t,e)))}closeDb(t){if(!this.#Zu)return;if(!t)return void this.#Yu();const e=this.#Zu.transaction(["Travels"],"readwrite");e.onerror=()=>{};const o=e.objectStore("Travels").delete(t);o.onerror=()=>this.#Yu(),o.onsuccess=()=>this.#Yu()}}const Nl=new Cl;const Pl=new class{#Gu(e){const i=V.create("div",{className:e+"Travel-Header"});D.sanitizeToHtmlElement(U.travel.name,V.create("div",{className:e+"Travel-Header-Name"},i));let n=o.defaultValue,s=0,r=0;const a=U.travel.routes.iterator;for(;!a.done;){const o=a.value.objId===U.editedRouteObjId&&t.routeEditor.showEditedRouteInRoadbook?U.travel.editedRoute:a.value;D.sanitizeToHtmlElement('<a href="#route'+o.objId+'" >'+o.computedName+"</a>Â :Â "+S.formatDistance(o.distance)+".",V.create("div",{className:e+"Travel-Header-RouteName"},i)),o.chain&&(n+=o.distance,s+=o.itinerary.ascent,r+=o.itinerary.descent)}return D.sanitizeToHtmlElement("<span>"+O.getText("TravelHTMLViewsFactory - Travel distance")+"</span>Â :Â "+S.formatDistance(n),V.create("div",{className:e+"Travel-Header-TravelDistance"},i)),0!==s&&D.sanitizeToHtmlElement("<span>"+O.getText("travelHTMLViewsFactory - Travel ascent")+"</span>Â :Â "+String(s.toFixed(0))+" m.",V.create("div",{className:e+"Travel-Header-TravelAscent"},i)),0!==r&&D.sanitizeToHtmlElement("<span>"+O.getText("TravelHTMLViewsFactory - Travel descent")+"</span>Â :Â "+String(r.toFixed(0))+" m.",V.create("div",{className:e+"Travel-Header-TravelDescent"},i)),i}#qu(t){const e=O.getText("TravelHTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/TravelNotes" >Travel & Notes</a>, Â© <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 '+new Date(Date.now()).getFullYear()+'</a> Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+O.getText("TravelHTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=V.create("div",{className:t+"TravelFooter"});return D.sanitizeToHtmlElement(e,o),o}constructor(){Object.freeze(this)}getTravelHTML(e){const o=V.create("div",{className:e+"Travel"});o.appendChild(this.#Gu(e)),o.appendChild(Gs.getTravelNotesHTML(e));const i=U.travel.routes.iterator;for(;!i.done;){const n=t.routeEditor.showEditedRouteInRoadbook&&i.value.objId===U.editedRouteObjId?U.travel.editedRoute:i.value;o.appendChild(dl.getRouteHeaderHTML(e,n)),n.itinerary.hasProfile&&o.appendChild(dl.getRouteProfileHTML(e,n)),o.appendChild(dl.getRouteManeuversAndNotesHTML(e,n,!1)),o.appendChild(dl.getRouteFooterHTML(e,n))}return o.appendChild(this.#qu(e)),o}};class Dl{#Ju;constructor(){Object.freeze(this),this.#Ju=S.storageAvailable("localStorage")}handleEvent(){Qr.saveStatus=h.modified,this.#Ju&&Nl.getOpenPromise().then((()=>{Nl.getWritePromise(U.UUID,Pl.getTravelHTML("TravelNotes-Roadbook-").outerHTML)})).then((()=>localStorage.setItem(U.UUID,Date.now()))).catch((t=>{t instanceof Error&&console.error(t)}))}}class Ol{#$u=null;#Qu(){el.centerToolbar(),this.#$u=null}constructor(){Object.freeze(this)}handleEvent(){this.#$u&&(clearTimeout(this.#$u),this.#$u=null),this.#$u=setTimeout((()=>this.#Qu()),t.travelNotes.resizeDelay)}}class Sl{static addEventsListeners(){document.addEventListener("additinerarypointmarker",(t=>{t.data&&Il.addItineraryPointMarker(t.data.objId,t.data.latLng)})),document.addEventListener("addrectangle",(t=>{t.data&&Il.addRectangle(t.data.objId,t.data.bounds,t.data.properties)})),document.addEventListener("addsearchpointmarker",(t=>{t.data&&Il.addSearchPointMarker(t.data.objId,t.data.latLng,t.data.geometry)})),document.addEventListener("addwaypoint",(t=>{t.data&&Il.addWayPoint(t.data.wayPoint,t.data.letter)})),document.addEventListener("geolocationpositionchanged",(t=>{t.data&&Il.onGeolocationPositionChanged(t.data.position)})),document.addEventListener("geolocationstatuschanged",(t=>{t.data&&Il.onGeolocationStatusChanged(t.data.status)})),document.addEventListener("layerchange",(t=>{t.data&&Il.setLayer(t.data.layer)})),document.addEventListener("noteupdated",(t=>{t.data&&Il.updateNote(t.data.removedNoteObjId,t.data.addedNoteObjId)})),document.addEventListener("profileclosed",(t=>{t.data&&Mr.onProfileClosed(t.data.objId)})),document.addEventListener("providersadded",(()=>el.providersAdded())),document.addEventListener("removeallobjects",(()=>Il.removeAllObjects())),document.addEventListener("removeobject",(t=>{t.data&&Il.removeObject(t.data.objId)})),document.addEventListener("routepropertiesupdated",(t=>{t.data&&Il.updateRouteProperties(t.data.routeObjId)})),document.addEventListener("routeupdated",(t=>{t.data&&Il.updateRoute(t.data.removedRouteObjId,t.data.addedRouteObjId)})),document.addEventListener("setprovider",(t=>{t?.data?.provider&&(el.provider=t.data.provider)})),document.addEventListener("settransitmode",(t=>{t?.data?.transitMode&&(el.transitMode=t.data.transitMode)})),document.addEventListener("showtravelproperties",(()=>Ua.showTravelProperties())),document.addEventListener("updateosmsearch",(()=>Ua.osmSearchDialog.updateContent())),document.addEventListener("updateprofilename",(t=>{t.data&&Mr.updateProfileName(t.data.routeObjId)})),document.addEventListener("updateroadbook",new Dl),document.addEventListener("updatetravelnotes",(()=>Ua.travelNotesDialog.updateContent())),document.addEventListener("updatetravelproperties",(()=>Ua.travelPropertiesDialog.updateContent())),document.addEventListener("zoomto",(t=>{t.data&&Il.zoomTo(t.data.latLng,t.data.geometry)})),window.visualViewport.addEventListener("resize",new Ol)}static addUnloadEventsListeners(){window.addEventListener("unload",(()=>localStorage.removeItem(U.UUID))),window.addEventListener("beforeunload",(e=>{if(Nl.closeDb(U.UUID),t.travelNotes.haveBeforeUnloadWarning)return e.returnValue="x","x"}))}}(new class{#tm;#em;#om;#im;#nm(){const t=new URL(window.location);let e=t.searchParams.get("fil");if(e&&0!==e.length)try{if(e=atob(e),e.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");const o=new URL(e);if(!(t.protocol&&o.protocol&&t.protocol===o.protocol&&t.hostname&&o.hostname&&t.hostname===o.hostname))throw new Error("The distant file is not on the same site than the app");this.#tm=encodeURI(o.href)}catch(t){t instanceof Error&&console.error(t)}const o=t.searchParams.get("lng");o&&o.match(/^[A-Z,a-z]{2}$/)&&(this.#em=o.toLowerCase())}async#sm(){const e=await fetch(this.#om+"Config.json");if(p===e.status&&e.ok){const o=await e.json();return o.travelNotes.language=this.#em||o.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(o.ApiKeysDialog.haveUnsecureButtons=!0,o.errorsUI.showHelp=!0,o.mapLayersToolbar.theDevil.addButton=!1,o.note.maxManeuversNotes=12,o.note.haveBackground=!0,o.noteDialog.theDevil.addButton=!1,o.printRouteMap.maxTiles=10,o.route.showDragTooltip=f),(new cl).overload(o),U.providers.forEach((e=>{e.userLanguage=t.travelNotes.language})),!0}return!1}async#rm(t,e){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(O.setTranslations(await t.value.json()),!0):"fulfilled"===e.status&&p===e.value.status&&e.value.ok?(O.setTranslations(await e.value.json()),this.#im+="Not possible to load the TravelNotes"+this.#em.toUpperCase()+".json file. English will be used. ",!0):(this.#im+="Not possible to load the translations. ",!1)}async#am(t,e){if("fulfilled"===t.status&&p===t.value.status&&t.value.ok){const e=await t.value.json();return As.loadJson(e),!0}if("fulfilled"===e.status&&p===e.value.status&&e.value.ok){const t=await e.value.json();return As.loadJson(t),this.#im+="Not possible to load the TravelNotesNoteDialog"+this.#em.toUpperCase()+".json file. English will be used. ",!0}return this.#im+="Not possible to load the translations for the note dialog. ",!1}async#lm(t,e){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(la.parseDictionary(await t.value.text()),!0):"fulfilled"===e.status&&p===e.value.status&&e.value.ok?(la.parseDictionary(await e.value.text()),this.#im+="Not possible to load the TravelNotesSearchDictionary"+this.#em.toUpperCase()+".csv file. English will be used. ",!0):(this.#im+="Not possible to load the search dictionary. OSM search will not be available.",!0)}async#hm(t){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(Dr.addMapLayers(await t.value.json()),!0):(this.#im+="Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",!0)}async#cm(){const t=await Promise.allSettled([fetch(this.#om+this.#em.toUpperCase()+".json"),fetch(this.#om+"EN.json"),fetch(this.#om+"NoteDialog"+this.#em.toUpperCase()+".json"),fetch(this.#om+"NoteDialogEN.json"),fetch(this.#om+"SearchDictionary"+this.#em.toUpperCase()+".csv"),fetch(this.#om+"SearchDictionaryEN.csv"),fetch(this.#om+"Layers.json")]),e=await this.#rm(t[0],t[1])&&await this.#am(t[2],t[3])&&await this.#lm(t[4],t[5])&&await this.#hm(t[6]);return""!==this.#im&&e?Zn.showError(this.#im):""!==this.#im&&(document.body.textContent=this.#im),e}#dm(){Sl.addEventsListeners(),document.body.style["font-size"]=String(t.fontSize.initialValue)+"mm";const e=document.createElement("div");e.id="TravelNotes-Map",document.body.appendChild(e),U.map=new Bo(e.id,{attributionControl:!1,zoomControl:!1}).setView([a.defaultValue,a.defaultValue],0),this.#tm?hl.addReadOnlyTravel(this.#tm):(Sl.addUnloadEventsListeners(),hl.addToolbarsMenusUIs())}constructor(){Object.freeze(this),this.#om=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes",this.#im=""}async loadApp(){window.TaN=hl,this.#nm(),await this.#sm()?(this.#em=this.#em||t.travelNotes.language||"fr",Zn.createUI(),await this.#cm()&&this.#dm()):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}}).loadApp()}();
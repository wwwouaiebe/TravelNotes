/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 5.0.0-dev
 * Build 43 - Mon Jan 05 2026 15:38:05 GMT+0100 (heure normale dâ€™Europe centrale)
 * Copyright 2019 2026 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
*/


!function(){"use strict";const t={ApiKeys:{saveToSessionStorage:!0},ApiKeysDialog:{haveUnsecureButtons:!0,showApiKeys:!1,showButton:!0},baseDialog:{cancelTouchX:100,cancelTouchY:150,deltaZoomDistance:75,touchTopScreen:!0},contextMenu:{timeout:1500},dockableBaseDialog:{timeout:1500,hideOnMouseLeave:!1},errorsUI:{helpTimeOut:3e4,showError:!0,showHelp:!1,showInfo:!0,showWarning:!0,timeOut:1e4},files:{openGpx:["gpx"],openTaN:["json","trv"],writeTouch:"trv",writeOthers:"trv"},fontSize:{initialValue:3.5,incrementValue:.5},FullScreenUI:{timeOut:5e3,screenMaxWidth:1200},geoCoder:{distances:{city:1200,hamlet:200,town:1500,village:400},osmCityAdminLevel:{DEFAULT:"8",GB:"10"}},geoLocation:{marker:{color:"#ff0000",radius:0},options:{enableHighAccuracy:!0,maximumAge:0,timeout:36e5},watch:!0,zoomFactor:17,zoomToPosition:!0},itineraryPoint:{marker:{color:"#ff0000",fill:!1,radius:7,weight:2},zoomFactor:17},mapContextMenu:{mouseMaxRouteDistance:10,touchMaxRouteDistance:10},mapLayersToolbar:{theDevil:{addButton:!0}},map:{center:{lat:50.50923,lng:5.49542},zoom:12},nominatim:{url:"https://nominatim.openstreetmap.org/",language:"*"},note:{grip:{size:10,opacity:0,moveOpacity:1},haveBackground:!1,maxManeuversNotes:100,polyline:{color:"#808080",weight:1},svgIcon:{angleDistance:10,angleDirection:{right:35,slightRight:80,continue:100,slightLeft:145,left:200,sharpLeft:270,sharpRight:340},rcnRefDistance:20,roadbookFactor:6,zoom:17}},noteDialog:{areaHeight:{icon:2,popupContent:8},theDevil:{addButton:!0,zoomFactor:17}},osmSearchDialog:{dialogX:50,dialogY:0},osmSearch:{nextSearchLimit:{color:"#ff0000",fill:!1,weight:1},previousSearchLimit:{color:"#006400",fill:!1,weight:1},searchPointMarker:{color:"#006400",fill:!1,radius:20,weight:4},searchPointPolyline:{color:"#006400",fill:!1,weight:4},showSearchNoteDialog:!1},overpassApi:{useNwr:!0,timeOut:40,url:"https://lz4.overpass-api.de/api/interpreter"},printRouteMap:{firefoxBrowser:!0,isEnabled:!0,maxTiles:240,paperWidth:287,paperHeight:200,printNotes:!0,borderWidth:10,zoomFactor:15,entryPointMarker:{color:"#00ff00",weight:4,radius:10,fill:!0,fillOpacity:1},exitPointMarker:{color:"#ff0000",weight:4,radius:10,fill:!0,fillOpacity:1}},route:{color:"#ff0000",dashIndex:0,dashChoices:[{text:"â€”â€”â€”â€”â€”â€”",iDashArray:[0]},{text:"â€” â€” â€” â€” â€”",iDashArray:[4,2]},{text:"â€”â€§â€”â€§â€”â€§â€”â€§â€”",iDashArray:[4,2,0,2]},{text:"Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·",iDashArray:[0,2]}],elev:{smooth:!0,smoothCoefficient:2.5,smoothPoints:3},showDragTooltip:0,width:5},routeEditor:{showEditedRouteInRoadbook:!0},toolbars:{timeOut:1500},travelNotes:{haveBeforeUnloadWarning:!0,language:"fr",startupRouteEdition:!0,resizeDelay:200},travelNotesToolbar:{contactMail:{url:"https://github.com/wwwouaiebe/TravelNotes/issues"}},travelNotesDialog:{dialogX:250,dialogY:0},travelPropertiesDialog:{dialogX:50,dialogY:0},wayPoint:{reverseGeocoding:!0,geocodingIncludeName:!0}};class e{static get d0(){return 0}static get d90(){return 90}static get d180(){return 180}static get d270(){return 270}static get d360(){return 360}static get d540(){return 540}static get toRadians(){return Math.PI/180}static get fromRadians(){return 180/Math.PI}}class o{static get fixed(){return 2}static get invalid(){return-1}static get defaultValue(){return 0}static get metersInKm(){return 1e3}}class i{static get fixed(){return 2}static get defaultValue(){return 0}}class n{static get refusedByUser(){return-1}static get disabled(){return 0}static get inactive(){return 1}static get active(){return 2}}class s{static get width(){return 40}static get height(){return 40}static get svgViewboxDim(){return 200}}class r{static get atStart(){return-1}static get onRoute(){return 0}static get atEnd(){return 1}}class a{static get defaultValue(){return 0}static get fixed(){return 6}static get maxLat(){return 90}static get minLat(){return-90}static get maxLng(){return 180}static get minLng(){return-180}}class l{static get notEdited(){return 0}static get editedNoChange(){return 1}static get editedChanged(){return 2}}class h{static get notSaved(){return"ðŸ”´"}static get modified(){return"ðŸŸ¡"}static get saved(){return"ðŸŸ¢"}}class c{static get topLeft(){return"travelnotes-base-toolbar-top-left"}static get topRight(){return"travelnotes-base-toolbar-top-right"}static get bottomLeft(){return"travelnotes-base-toolbar-bottom-left"}static get bottomRight(){return"travelnotes-base-toolbar-bottom-right"}}const d=40,u=6371e3,m=16,p=200,g=-1,v=[.3,10,1],f=-1,_="http://www.w3.org/2000/svg",y=20;class b{static#t=0;static get nextObjId(){return++b.#t}}const T="5.0.0",E="v5.0.0-dev";class w{#e="";#o=["Itinerary","ItineraryPoint","Maneuver","Note","Route","Travel","WayPoint"];#i=[];constructor(t,e){if(Object.freeze(this),f===this.#o.indexOf(t))throw new Error("Invalid ObjType name : "+t);this.#e=t,this.#i=e,Object.freeze(this.#i)}get name(){return this.#e}get version(){return T}get properties(){return this.#i}get jsonObject(){return{name:this.#e,version:T}}validate(t){if(!Object.getOwnPropertyNames(t).includes("name"))throw new Error("No name for "+this.#e);if(this.#e!==t.name)throw new Error("Invalid name for "+this.#e);if(!Object.getOwnPropertyNames(t).includes("version"))throw new Error("No version for "+this.#e)}}class M{#n=null;#s=f;constructor(t){Object.freeze(this),this.#n=t}get value(){return this.#s<this.#n.length?this.#n.at(this.#s):null}get previous(){return 0>=this.#s?null:this.#n.at(this.#s-1)}get next(){return this.#s<this.#n.length-1?this.#n.at(this.#s+1):null}get done(){return++this.#s>=this.#n.length}get first(){return 0===this.#s}get last(){return this.#s>=this.#n.length-1}get index(){return this.#s}}class x{#r;#a;#l;#h(t){return this.#r.findIndex(e=>e.objId===t)}#c(t,e,o){let i=this.#h(t);if(f===i)throw new Error("invalid objId for next or previous function");if(1!==o&&-1!==o)throw new Error("invalid direction");let n=e;for(n||(n=()=>!0),i+=o;f<i&&i<this.#r.length&&!n(this.#r[i]);)i+=o;return f===i||this.#r.length===i?null:this.#r[i]}constructor(t){Object.freeze(this),this.#r=[],this.#l=t;const e=new t;if(!e.objType||!e.objType.name)throw new Error("invalid object name for collection");this.#a=e.objType.name}add(t){if(!t.objType||!t.objType.name||t.objType.name!==this.#a)throw new Error("invalid object name for add function");this.#r.push(t)}at(t){return t<this.#r.length&&t>f?this.#r[t]:null}forEach(t){let e=null;const o=this.iterator;for(;!o.done;)e=t(o.value,e);return e}getAt(t){const e=this.#h(t);return f===e?null:this.#r[e]}moveTo(t,e,o){let i=this.#h(t),n=this.#h(e);if(f===i||f===n)throw new Error("invalid objId for function  myMoveTo");o||n++,this.#r.splice(n,0,this.#r[i]),n<i&&i++,this.#r.splice(i,1)}next(t,e){return this.#c(t,e,1)}previous(t,e){return this.#c(t,e,-1)}remove(t){const e=this.#h(t);if(f===e)throw new Error("invalid objId for remove function");this.#r.splice(e,1)}removeAll(t){t?this.#r.splice(1,this.#r.length-2):this.#r.length=0}replace(t,e){const o=this.#h(t);if(f===o)throw new Error("invalid objId for replace function");if(!e.objType||!e.objType.name||e.objType.name!==this.#a)throw new Error("invalid object name for replace function");this.#r[o]=e}reverse(){this.#r.reverse()}sort(t){this.#r.sort(t)}swap(t,e){const o=this.#h(t);if(f===o||0===o&&e||this.#r.length-1===o&&!e)throw new Error("invalid objId for swap function");const i=e?-1:1,n=this.#r[o];this.#r[o]=this.#r[o+i],this.#r[o+i]=n}get first(){return this.#r[0]}get iterator(){return new M(this)}get last(){return this.#r[this.#r.length-1]}get length(){return this.#r.length}get jsonObject(){const t=[],e=this.iterator;for(;!e.done;)t.push(e.value.jsonObject);return t}set jsonObject(t){this.#r.length=0,Array.isArray(t)&&t.forEach(t=>{const e=new this.#l;e.jsonObject=t,this.add(e)})}}class I{#d=new Map;constructor(){Object.freeze(this),this.#d.set("a",["href","target"]),this.#d.set("div",[]),this.#d.set("del",[]),this.#d.set("em",[]),this.#d.set("figcaption",[]),this.#d.set("figure",[]),this.#d.set("h1",[]),this.#d.set("h2",[]),this.#d.set("h3",[]),this.#d.set("h4",[]),this.#d.set("h5",[]),this.#d.set("h6",[]),this.#d.set("hr",[]),this.#d.set("img",["src","alt","width","height"]),this.#d.set("ins",[]),this.#d.set("li",[]),this.#d.set("mark",[]),this.#d.set("ol",[]),this.#d.set("p",[]),this.#d.set("s",[]),this.#d.set("small",[]),this.#d.set("strong",[]),this.#d.set("span",[]),this.#d.set("sub",[]),this.#d.set("sup",[]),this.#d.set("ul",[]),this.#d.set("svg",["xmlns","viewBox","class"]),this.#d.set("text",["x","y","text-anchor"]),this.#d.set("polyline",["points","class","transform"]),this.#d.set("#text",[])}getValidAttributesNames(t){return this.#d.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#d.get(e)?e:""}}class C{#u;#m;constructor(t,e){Object.freeze(this),this.#u=t,this.#m=e}get htmlString(){return this.#u}get errorsString(){return this.#m}}class P{#p;#m;constructor(t,e){Object.freeze(this),this.#p=t,this.#m=e}get url(){return this.#p}get errorsString(){return this.#m}}class O{#g="";#v="";static#f=new I;#_(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#y(t,e){const o=this.sanitizeToUrl(t,e).url;""===o&&""!==t?this.#v+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#g+=" "+e+'="'+o+'"'}#b(t,e){O.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(this.#g+=" "+e+'="'+this.#_(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))})}#L(t,e){t.hasAttribute("target")&&(this.#g+=' rel="noopener noreferrer"'),O.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#y(t.getAttribute(e),e):this.#g+=" "+e+'="'+this.#_(t.getAttribute(e))+'"',t.removeAttribute(e))})}#T(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#v+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#E(t){const e=t.childNodes;for(let o=0;o<e.length;o++){const e=t.childNodes[o],i=O.#f.getValidNodeName(e.nodeName);""===i?this.#v+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===i?this.#g+=this.#_(e.nodeValue):(this.#g+="<"+i,"svg"===i||"text"===i||"polyline"===i?this.#b(e,i):this.#L(e,i),this.#g+=">",this.#E(e),this.#g+="</"+i+">",e.attributes&&this.#T(e))}}#w(t,e){const o=document.createElementNS(_,e);return O.#f.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(o.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))}),o}#M(t,e){const o=document.createElement(e);return O.#f.getValidAttributesNames(e).forEach(e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const i=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==i&&o.setAttribute(e,i)}else o.setAttribute(e,t.getAttribute(e))}),t.hasAttribute("target")&&o.setAttribute("rel","noopener noreferrer"),o}#x(t,e){const o=t.childNodes;for(let i=0;i<o.length;i++){const o=t.childNodes[i],n=O.#f.getValidNodeName(o.nodeName);if("#text"===n)e.appendChild(document.createTextNode(o.nodeValue));else if(""!==n){const t="svg"===n||"text"===n||"polyline"===n?this.#w(o,n):this.#M(o,n);e.appendChild(t),this.#x(o,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const o=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),i=new DocumentFragment;o&&"#document"===o.nodeName?(this.#x(o.body.firstChild,i),e.appendChild(i)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#x(t,e),e}sanitizeToHtmlString(t){this.#g="",this.#v="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","à¨€")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#E(e.body.firstChild),new C(this.#g,this.#v)):new C("","Parsing error")}sanitizeToUrl(t,e){const o=e||"href",i=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!i||"#document"!==i.nodeName)return new P("","Parsing error");const n=i.body.firstChild;let s="";for(let t=0;t<n.childNodes.length;t++){if("#text"!==n.childNodes[t].nodeName)return new P("","Invalid characters found in the url");s+=n.childNodes[t].nodeValue}if(s=s.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),s!==t)return new P("","Invalid characters found in the url");const r=["https:"];if("http:"!==window.location.protocol&&"href"!==o||r.push("http:"),"href"===o){r.push("mailto:"),r.push("sms:"),r.push("tel:");const t=s.match(/^\u0023\w*/);if(t&&s===t[0])return new P(s,"")}"src"===o&&r.push("data:");let a=null;try{a=new URL(s)}catch{return new P("","Invalid url string")}if(f===r.indexOf(a.protocol))return new P("","Invalid protocol "+a.protocol);if(f!==["sms:","tel:"].indexOf(a.protocol))return a.pathname.match(/^\+[0-9,*,\u0023]*$/)?new P(s,""):new P("","Invalid sms: or tel: url");try{encodeURIComponent(a.href)}catch{return new P("","Invalid character in url")}return new P(s,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const o=e.body.firstChild;let i="";for(let t=0;t<o.childNodes.length;t++){if("#text"!==o.childNodes[t].nodeName)return"";i+=o.childNodes[t].nodeValue}return i=i.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),i}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const N=new O;const S=new class{#I=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach(t=>this.#I.set(t.msgid,N.sanitizeToJsString(t.msgstr)))}getText(t,e){let o=this.#I.get(t);return e&&o&&Object.getOwnPropertyNames(e).forEach(t=>o=o.replace("{"+t+"}",e[t])),o||t}};const D=new class{constructor(){Object.freeze(this)}get UUID(){const t=["","","","-","","-","","-","","-","","","","","",""],e=new Uint8Array(16);window.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let o="";for(let i=0;i<16;i++)o+=e[i].toString(m).padStart(2,"0")+t[i];return o}storageAvailable(t){try{const e=window[t],o="__storage_test__";return e.setItem(o,o),e.removeItem(o),!0}catch{return!1}}openFile(t,e){const o=document.createElement("input");o.type="file",e&&(o.accept=e),o.addEventListener("change",t,!1),o.click()}saveFile(t,e,o){try{const i=o?window.URL.createObjectURL(new File([e],t,{type:o})):URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",t),n.click(),window.URL.revokeObjectURL(i)}catch(t){t instanceof Error&&console.error(t)}}formatTime(t){const e=Math.floor(t);if(0===e)return"";const o=Math.floor(e/86400),i=Math.floor(e%86400/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60);return 0<o?o+"Â "+S.getText("Utilities - Day")+"Â "+i+"Â "+S.getText("Utilities - Hour"):0<i?i+"Â "+S.getText("Utilities - Hour")+"Â "+n+"Â "+S.getText("Utilities - Minute"):0<n?n+"Â "+S.getText("Utilities - Minute"):s+"Â "+S.getText("Utilities - Second")}formatDistance(t){const e=Math.floor(t);return 0>=e?"0Â km":Math.floor(e/o.metersInKm)+","+Math.floor(e%o.metersInKm/10).toFixed(0).padStart(2,"0").padEnd(3,"0")+"Â km"}numberToDMS(t){let e=t,o=Math.floor(t);e-=o;let i=Math.floor(60*e);e-=i/60,e*=3600;let n=Math.floor(e);return e-=n,e=Math.floor(100*e),o.toString()+"Â° "+i.toString()+"' "+n+'" '+e}formatLatDMS(t){return t>0?this.numberToDMS(t)+"Â N":this.numberToDMS(-t)+"Â S"}formatLngDMS(t){return t>0?this.numberToDMS(t)+"Â E":this.numberToDMS(-t)+"Â W"}formatLatLngDMS(t){return 0===t[0]&&0===t[1]?"":this.formatLatDMS(t[0])+"Â -Â "+this.formatLngDMS(t[1])}formatLat(t){return t>0?t.toFixed(a.fixed)+"Â N":(-t).toFixed(a.fixed)+"Â S"}formatLng(t){return t>0?t.toFixed(a.fixed)+"Â E":(-t).toFixed(a.fixed)+"Â W"}formatLatLng(t){return 0===t[0]&&0===t[1]?"":this.formatLat(t[0])+"Â -Â "+this.formatLng(t[1])}};class j{#C;#P(){this.#C.routes.forEach(t=>{t.dashArray=0,t.hidden=!1})}#O(){this.#C.routes.forEach(t=>{t.edited=l.notEdited})}#N(){this.#O(),this.#C.editedRoute={name:"",wayPoints:[{name:"",lat:0,lng:0,objId:2,objType:{name:"WayPoint",version:"1.4.0"}},{name:"",lat:0,lng:0,objId:3,objType:{name:"WayPoint",version:"1.4.0"}}],notes:[],itinerary:{itineraryPoints:[],maneuvers:[],provider:"",transitMode:"",objId:1,objType:{name:"Itinerary",version:"1.4.0"}},width:3,color:"#ff0000",dashArray:0,chain:!0,distance:0,duration:0,edited:l.notEdited,hidden:!1,chainedDistance:0,objId:4,objType:{name:"Route",version:"1.4.0"}}}#S(){if(this.#C.userData.layerId){const t=[{layerId:"0",layerName:"OSM - Color"},{layerId:"1",layerName:"OSM - Black and White"},{layerId:"2",layerName:"Thunderforest - Transport"},{layerId:"3",layerName:"Thunderforest - OpenCycleMap"},{layerId:"4",layerName:"Thunderforest - Outdoors"},{layerId:"5",layerName:"Esri - Aerial view"},{layerId:"6",layerName:"Kartverket - Norway"},{layerId:"7",layerName:"IGN-NGI - Belgium now"},{layerId:"12",layerName:"Thunderforest - Landscape"},{layerId:"24",layerName:"LantmÃ¤teriet - Sweden"},{layerId:"25",layerName:"Maanmittauslaitos - Finland"}].find(t=>t.layerId===this.#C.userData.layerId);this.#C.layerName=t?t.layerName:"OSM - Color"}else this.#C.layerName="OSM - Color"}#D(t){t.forEach(t=>{t.elev=i.defaultValue})}#j(){this.#C.routes.forEach(t=>{t.itinerary.hasProfile=!1,t.itinerary.ascent=0,t.itinerary.descent=0,this.#D(t.itinerary.itineraryPoints)}),this.#C.editedRoute.itinerary.hasProfile=!1,this.#C.editedRoute.itinerary.ascent=0,this.#C.editedRoute.itinerary.descent=0,this.#D(this.#C.editedRoute.itinerary.itineraryPoints)}#k(t){t.itinerary.maneuvers.forEach(t=>{"kArriveDefault"===t.iconName&&(t.distance=o.defaultValue)})}#A(t){t.wayPoints.forEach(t=>{t.address=t.name,t.name=""})}#R(){this.#C.routes.forEach(t=>{t.editionStatus=t.edited,this.#k(t),this.#A(t)}),this.#C.editedRoute.editionStatus=this.#C.editedRoute.edited,this.#k(this.#C.editedRoute),this.#A(this.#C.editedRoute)}#H(){this.#C.routes.forEach(t=>{t.dashIndex=t.dashArray}),this.#C.editedRoute.dashIndex=this.#C.editedRoute.dashArray}#B(t){return t.replaceAll(/style='color:white;background-color:red'/g,"class='TravelNotes-Note-WhiteRed'").replaceAll(/style='color:white;background-color:green'/g,"class='TravelNotes-Note-WhiteGreen'").replaceAll(/style='color:white;background-color:blue'/g,"class='TravelNotes-Note-WhiteBlue'").replaceAll(/style='color:white;background-color:brown'/g,"class='TravelNotes-Note-WhiteBrown'").replaceAll(/style='color:white;background-color:black'/g,"class='TravelNotes-Note-WhiteBlack'").replaceAll(/style='border:solid 0.1em'/g,"class='TravelNotes-Note-BlackWhite'").replaceAll(/style='background-color:white;'/g,"class='TravelNotes-Note-Knooppunt'").replaceAll(/style='fill:green;font:bold 120px sans-serif;'/g,"").replaceAll(/style='fill:none;stroke:green;stroke-width:10;'/g,"")}#z(t){"string"==typeof t.iconHeight&&(t.iconHeight=Number.parseInt(t.iconHeight)),"string"==typeof t.iconWidth&&(t.iconWidth=Number.parseInt(t.iconWidth)),t.iconContent=this.#B(t.iconContent),t.popupContent=this.#B(t.popupContent),t.tooltipContent=this.#B(t.tooltipContent),t.phone=this.#B(t.phone),t.address=this.#B(t.address)}#F(){this.#C.notes.forEach(t=>{this.#z(t)}),this.jsonTravel.routes.forEach(t=>{t.notes.forEach(t=>{this.#z(t)})})}#Z(t){[[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kBusEnd"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0075"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kBusStart"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0076"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kFerryExit"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0077"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kFerryEnter"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0078"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kTrainEnd"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0079"></div>'],[RegExp('<div class="TravelNotes-MapNote TravelNotes-UI-kTrainStart"><svg viewBox="0 0 20 20"></svg></div>',"g"),'<div class="travelnotes-map-note travelnotes-map-note-category-0080"></div>'],[/class="TravelNotes-MapNote TravelNotes-MapNoteCategory/g,'class="travelnotes-map-note travelnotes-map-note-category'],[/class="TravelNotes-SvgIcon/g,'class="travelnotes-svg-icon'],[/class="TravelNotes-OSM-Itinerary/g,'class="travelnotes-osm-itinerary'],[/class="TravelNotes-OSM-Highway TravelNotes-OSM-Highway/g,'class="travelnotes-osm-highway travelnotes-osm-highway'],[/class="TravelNotes-OSM-RcnRef/g,'class="travelnotes-osm-rcn-ref']].forEach(e=>{t.iconContent=t.iconContent.replaceAll(e[0],e[1])}),[[/class="TravelNotes-Note-WhiteRed/g,'class="travelnotes-note-white-red'],[/class="TravelNotes-Note-WhiteGreen/g,'class="travelnotes-note-white-green'],[/class="TravelNotes-Note-WhiteBlue/g,'class="travelnotes-note-white-blue'],[/class="TravelNotes-Note-WhiteBrown/g,'class="travelnotes-note-white-brown'],[/class="TravelNotes-Note-WhiteBlack/g,'class="travelnotes-note-white-black'],[/class="TravelNotes-Note-BlackWhite/g,'class="travelnotes-note-black-white']].forEach(e=>{t.iconContent=t.iconContent.replaceAll(e[0],e[1]),t.popupContent=t.popupContent.replaceAll(e[0],e[1]),t.tooltipContent=t.tooltipContent.replaceAll(e[0],e[1]),t.address=t.address.replaceAll(e[0],e[1]),t.phone=t.phone.replaceAll(e[0],e[1])})}#K(){const t=new Map;t.set("kArriveLeft","arrive-left"),t.set("kArriveRight","arrive-right"),t.set("kContinueLeft","continue-left"),t.set("kContinueRight","continue-right"),t.set("kContinueSharpLeft","continue-sharp-left"),t.set("kContinueSharpRight","continue-sharp-right"),t.set("kContinueSlightLeft","continue-slight-left"),t.set("kContinueSlightRight","continue-slight-right"),t.set("kContinueStraight","continue-straight"),t.set("kDepartDefault","depart-default"),t.set("kDepartLeft","depart-left"),t.set("kDepartRight","depart-right"),t.set("kEndOfRoadLeft","end-of-road-left"),t.set("kEndOfRoadRight","end-of-road-right"),t.set("kFerryEnter","ferry-enter"),t.set("kFerryExit","ferry-exit"),t.set("kForkLeft","fork-left"),t.set("kForkRight","fork-right"),t.set("kMergeDefault","merge-default"),t.set("kMergeLeft","merge-left"),t.set("kMergeRight","merge-right"),t.set("kNewNameLeft","new-name-left"),t.set("kNewNameRight","new-name-right"),t.set("kNewNameSharpLeft","new-name-sharp-left"),t.set("kNewNameSharpRight","new-name-sharp-right"),t.set("kNewNameSlightLeft","new-name-slight-left"),t.set("kNewNameSlightRight","new-name-slight-right"),t.set("kNewNameStraight","new-name-straight"),t.set("kOffRampLeft","off-ramp-left"),t.set("kOffRampRight","off-ramp-right"),t.set("kOnRampLeft","on-ramp-left"),t.set("kOnRampRight","on-ramp-right"),t.set("kRotaryLeft","rotary-left"),t.set("kRotaryRight","rotary-right"),t.set("kRoundaboutExit","roundabout-exit"),t.set("kRoundaboutLeft","roundabout-left"),t.set("kRoundaboutRight","roundabout-right"),t.set("kRoundaboutTurnLeft","roundabout-turn-left"),t.set("kRoundaboutTurnRight","roundabout-turn-right"),t.set("kRoundaboutTurnSharpLeft","roundabout-turn-sharp-left"),t.set("kRoundaboutTurnSharpRight","roundabout-turn-sharp-right"),t.set("kRoundaboutTurnSlightLeft","roundabout-turn-slight-left"),t.set("kRoundaboutTurnSlightRight","roundabout-turn-slight-right"),t.set("kRoundaboutTurnStraight","roundabout-turn-straight"),t.set("kStayLeft","stay-left"),t.set("kStayRight","stay-right"),t.set("kStayStraight","stay-straight"),t.set("kTurnLeft","turn-left"),t.set("kTurnRight","turn-right"),t.set("kTurnSharpLeft","turn-sharp-left"),t.set("kTurnSharpRight","turn-sharp-right"),t.set("kTurnSlightLeft","turn-slight-left"),t.set("kTurnSlightRight","turn-slight-right"),t.set("kTurnStraight","turn-straight"),t.set("kTurnUturn","turn-u-turn"),t.set("kUndefined","undefined"),t.set("kUturnLeft","u-turn-left"),t.set("kUturnRight","u-turn-right"),t.set("kTrainStart","train-start"),t.set("kTrainContinue","train-continue"),t.set("kTrainEnd","train-end"),this.#C.routes.forEach(e=>{e.itinerary.maneuvers.forEach(e=>{e.iconName=t.get(e.iconName)||"undefined"})})}#U(){this.#C.notes.forEach(t=>{this.#Z(t)}),this.#C.routes.forEach(t=>{t.notes.forEach(t=>{this.#Z(t)})})}#V(){switch(this.#C.objType.version){case"1.0.0":this.#P();case"1.1.0":case"1.2.0":case"1.3.0":case"1.4.0":this.#N();case"1.5.0":this.#S();case"1.6.0":this.#j();case"1.7.0":case"1.7.1":case"1.8.0":case"1.9.0":case"1.10.0":case"1.11.0":this.#R();case"1.12.0":case"1.13.0":this.#F();case"2.0.0":case"2.1.0":case"2.2.0":case"2.3.0":this.#H();case"2.4.0":this.#U(),this.#K(),this.#C.objType.version="5.0.0";break;default:throw new Error("invalid version for travel")}}constructor(){Object.freeze(this)}update(t){t.objType.version!==T&&(this.#C=t,this.#V())}}class k{constructor(){Object.freeze(this)}validateObject(t){if(!Object.getOwnPropertyNames(t).includes("objType"))throw new Error("No objType for "+this.objType.name);this.objType.validate(t.objType),"Travel"===this.objType.name&&this.objType.version!==t.objType.version&&(new j).update(t);const e=Object.getOwnPropertyNames(t);return this.objType.properties.forEach(t=>{if(!e.includes(t))throw new Error("No "+t+" for "+this.objType.name)}),t}}class A extends k{static#W=new w("WayPoint",["address","name","lat","lng","objId"]);#X="";#Y="";#G=a.defaultValue;#q=a.defaultValue;#t=g;constructor(){super(),this.#t=b.nextObjId}get name(){return this.#X}set name(t){this.#X="string"==typeof t?N.sanitizeToJsString(t):""}get address(){return this.#Y}set address(t){this.#Y="string"==typeof t?N.sanitizeToJsString(t):""}get lat(){return this.#G}set lat(t){this.#G="number"==typeof t?t:a.defaultValue}get lng(){return this.#q}set lng(t){this.#q="number"==typeof t?t:a.defaultValue}get fullName(){let t=""===this.name?this.address:this.name+", "+this.address;return""===t&&(t=D.formatLatLng([this.lat,this.lng])),t}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#G=t[0],this.#q=t[1]):(this.#G=a.defaultValue,this.#q=a.defaultValue)}get objId(){return this.#t}get objType(){return A.#W}get jsonObject(){return{name:this.name,address:this.address,lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.address=e.address,this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.#t=b.nextObjId}}class R extends k{static#W=new w("ItineraryPoint",["lat","lng","distance","elev","objId"]);#G=a.defaultValue;#q=a.defaultValue;#J=o.defaultValue;#$=i.defaultValue;#t=g;constructor(){super(),this.#t=b.nextObjId}get lat(){return this.#G}set lat(t){this.#G="number"==typeof t?t:a.defaultValue}get lng(){return this.#q}set lng(t){this.#q="number"==typeof t?t:a.defaultValue}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:o.defaultValue}get elev(){return this.#$}set elev(t){this.#$="number"==typeof t?t:a.defaultValue}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#G=t[0],this.#q=t[1]):(this.#G=a.defaultValue,this.#q=a.defaultValue)}get objType(){return R.#W}get objId(){return this.#t}get jsonObject(){return{lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),elev:parseFloat(this.elev.toFixed(i.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.elev=e.elev,this.#t=b.nextObjId}}class H extends k{static#W=new w("Maneuver",["iconName","instruction","distance","duration","itineraryPointObjId","objId"]);#Q="";#tt="";#et=g;#J=o.defaultValue;#ot=o.defaultValue;#t=g;constructor(){super(),this.#t=b.nextObjId}get iconName(){return this.#Q}set iconName(t){this.#Q="string"==typeof t?N.sanitizeToJsString(t):""}get instruction(){return this.#tt}set instruction(t){this.#tt="string"==typeof t?N.sanitizeToJsString(t):""}get itineraryPointObjId(){return this.#et}set itineraryPointObjId(t){this.#et="number"==typeof t?t:g}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:o.defaultValue}get duration(){return this.#ot}set duration(t){this.#ot="number"==typeof t?t:o.defaultValue}get objType(){return H.#W}get objId(){return this.#t}get jsonObject(){return{iconName:this.iconName,instruction:this.instruction,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,itineraryPointObjId:this.itineraryPointObjId,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconName=e.iconName,this.instruction=e.instruction,this.distance=e.distance,this.duration=e.duration,this.itineraryPointObjId=e.itineraryPointObjId,this.#t=b.nextObjId}}class B extends k{static#W=new w("Itinerary",["hasProfile","ascent","descent","itineraryPoints","maneuvers","provider","transitMode","objId"]);#t=g;#it=!1;#nt=0;#st=0;#rt="";#at="";#lt=new x(R);#ht=new x(H);constructor(){super(),this.#t=b.nextObjId}get hasProfile(){return this.#it}set hasProfile(t){this.#it="boolean"==typeof t&&t}get ascent(){return this.#nt}set ascent(t){this.#nt="number"==typeof t?Number.parseInt(t):0}get descent(){return this.#st}set descent(t){this.#st="number"==typeof t?Number.parseInt(t):0}get provider(){return this.#rt}set provider(t){this.#rt="string"==typeof t?N.sanitizeToJsString(t):""}get transitMode(){return this.#at}set transitMode(t){this.#at="string"==typeof t?N.sanitizeToJsString(t):""}get itineraryPoints(){return this.#lt}get maneuvers(){return this.#ht}get objType(){return B.#W}get objId(){return this.#t}get jsonObject(){return{hasProfile:this.hasProfile,ascent:this.ascent,descent:this.descent,itineraryPoints:this.itineraryPoints.jsonObject,maneuvers:this.maneuvers.jsonObject,provider:this.provider,transitMode:this.transitMode,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.hasProfile=e.hasProfile,this.ascent=e.ascent,this.descent=e.descent,this.itineraryPoints.jsonObject=e.itineraryPoints,this.maneuvers.jsonObject=e.maneuvers,this.provider=e.provider,this.transitMode=e.transitMode,this.#t=b.nextObjId;const o=new Map;let i=0;const n=this.itineraryPoints.iterator;for(;!n.done;)o.set(e.itineraryPoints[i].objId,n.value.objId),i++;const s=this.maneuvers.iterator;for(;!s.done;)s.value.itineraryPointObjId=o.get(s.value.itineraryPointObjId)}}class z extends k{static#W=new w("Note",["iconHeight","iconWidth","iconContent","popupContent","tooltipContent","phone","url","address","iconLat","iconLng","lat","lng","distance","chainedDistance","objId"]);#ct=s.height;#dt=s.width;#ut="";#mt="";#pt="";#gt="";#p="";#Y="";#vt=a.defaultValue;#ft=a.defaultValue;#G=a.defaultValue;#q=a.defaultValue;#J=o.invalid;#_t=o.defaultValue;#t=g;constructor(){super(),this.#t=b.nextObjId}get iconHeight(){return this.#ct}set iconHeight(t){this.#ct="number"==typeof t?t:s.height}get iconWidth(){return this.#dt}set iconWidth(t){this.#dt="number"==typeof t?t:s.width}get iconContent(){return this.#ut}set iconContent(t){this.#ut="string"==typeof t?N.sanitizeToHtmlString(t).htmlString:""}get popupContent(){return this.#mt}set popupContent(t){this.#mt="string"==typeof t?N.sanitizeToHtmlString(t).htmlString:""}get tooltipContent(){return this.#pt}set tooltipContent(t){this.#pt="string"==typeof t?N.sanitizeToHtmlString(t).htmlString:""}get phone(){return this.#gt}set phone(t){this.#gt="string"==typeof t?N.sanitizeToHtmlString(t).htmlString:""}get url(){return this.#p}set url(t){this.#p="string"==typeof t?encodeURI(N.sanitizeToUrl(t).url):""}get address(){return this.#Y}set address(t){this.#Y="string"==typeof t?N.sanitizeToHtmlString(t).htmlString:""}get iconLat(){return this.#vt}set iconLat(t){this.#vt="number"==typeof t?t:a.defaultValue}get iconLng(){return this.#ft}set iconLng(t){this.#ft="number"==typeof t?t:a.defaultValue}get lat(){return this.#G}set lat(t){this.#G="number"==typeof t?t:a.defaultValue}get lng(){return this.#q}set lng(t){this.#q="number"==typeof t?t:a.defaultValue}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:o.invalid}get chainedDistance(){return this.#_t}set chainedDistance(t){this.#_t="number"==typeof t?t:o.defaultValue}get isRouteNote(){return this.#J!==o.invalid}get iconLatLng(){return[this.iconLat,this.iconLng]}set iconLatLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#vt=t[0],this.#ft=t[1]):(this.#vt=a.defaultValue,this.#ft=a.defaultValue)}get latLng(){return[this.lat,this.lng]}set latLng(t){"number"==typeof t[0]&&"number"==typeof t[1]?(this.#G=t[0],this.#q=t[1]):(this.#G=a.defaultValue,this.#q=a.defaultValue)}get objType(){return z.#W}get objId(){return this.#t}get jsonObject(){return{iconHeight:this.iconHeight,iconWidth:this.iconWidth,iconContent:this.iconContent,popupContent:this.popupContent,tooltipContent:this.tooltipContent,phone:this.phone,url:this.url,address:this.address,iconLat:parseFloat(this.iconLat.toFixed(a.fixed)),iconLng:parseFloat(this.iconLng.toFixed(a.fixed)),lat:parseFloat(this.lat.toFixed(a.fixed)),lng:parseFloat(this.lng.toFixed(a.fixed)),distance:parseFloat(this.distance.toFixed(o.fixed)),chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.iconHeight=e.iconHeight,this.iconWidth=e.iconWidth,this.iconContent=e.iconContent,this.popupContent=e.popupContent,this.tooltipContent=e.tooltipContent,this.phone=e.phone,this.url=e.url,this.address=e.address,this.iconLat=e.iconLat,this.iconLng=e.iconLng,this.lat=e.lat,this.lng=e.lng,this.distance=e.distance,this.chainedDistance=e.chainedDistance,this.#t=b.nextObjId}}class F extends k{static#W=new w("Route",["name","wayPoints","notes","itinerary","width","color","dashIndex","chain","chainedDistance","distance","duration","editionStatus","hidden","objId"]);#X="";#yt=new x(A);#bt=new x(z);#Lt=new B;#Tt=t.route.width;#Et=t.route.color;#wt=t.route.dashIndex;#Mt=!0;#_t=o.defaultValue;#J=o.defaultValue;#ot=o.defaultValue;#xt=l.notEdited;#It=!1;#t=g;constructor(){super(),this.#yt.add(new A),this.#yt.add(new A),this.#t=b.nextObjId}get name(){return this.#X}set name(t){this.#X="string"==typeof t?N.sanitizeToJsString(t):""}get wayPoints(){return this.#yt}get notes(){return this.#bt}get itinerary(){return this.#Lt}get width(){return this.#Tt}set width(e){this.#Tt="number"==typeof e?e:t.route.width}get color(){return this.#Et}set color(e){this.#Et="string"==typeof e&&N.sanitizeToColor(e)||t.route.color}get dashIndex(){return this.#wt}set dashIndex(e){this.#wt="number"==typeof e&&t.route.dashChoices[e]?e:0}get dashString(){let e="";return t.route.dashChoices[this.#wt].iDashArray.forEach(t=>e+=String(t*this.#Tt)+","),e.substring(0,e.length-1)}get chain(){return this.#Mt}set chain(t){this.#Mt="boolean"==typeof t&&t}get chainedDistance(){return this.#_t}set chainedDistance(t){this.#_t="number"==typeof t?t:o.defaultValue}get distance(){return this.#J}set distance(t){this.#J="number"==typeof t?t:o.defaultValue}get duration(){return this.#ot}set duration(t){this.#ot="number"==typeof t?t:o.defaultValue}get editionStatus(){return this.#xt}set editionStatus(t){this.#xt="number"==typeof t?t:l.notEdited}get hidden(){return this.#It}set hidden(t){this.#It="boolean"==typeof t&&t}get computedName(){let t=this.name;return""===t&&(t=(""===this.wayPoints.first.fullName?"???":this.wayPoints.first.fullName)+" â®ž "+(""===this.wayPoints.last.fullName?"???":this.wayPoints.last.fullName)),t}get objId(){return this.#t}get objType(){return F.#W}haveValidWayPoints(){let t=!0;return this.wayPoints.forEach(e=>{t=t&&a.defaultValue!==e.lat&&a.defaultValue!==e.lng}),t}get jsonObject(){return{name:this.name,wayPoints:this.wayPoints.jsonObject,notes:this.notes.jsonObject,itinerary:this.itinerary.jsonObject,width:this.width,color:this.color,dashIndex:this.dashIndex,chain:this.chain,distance:parseFloat(this.distance.toFixed(o.fixed)),duration:this.duration,editionStatus:this.editionStatus,hidden:this.hidden,chainedDistance:parseFloat(this.chainedDistance.toFixed(o.fixed)),objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.name=e.name,this.wayPoints.jsonObject=e.wayPoints,this.notes.jsonObject=e.notes,this.itinerary.jsonObject=e.itinerary,this.width=e.width,this.color=e.color,this.dashIndex=e.dashIndex,this.chain=e.chain,this.distance=e.distance,this.duration=e.duration,this.editionStatus=e.editionStatus,this.hidden=e.hidden,this.chainedDistance=e.chainedDistance,this.#t=b.nextObjId}}class Z extends k{static#W=new w("Travel",["editedRoute","routes","notes","layerName","name","readOnly","objId"]);#Ct=new F;#Pt=new x(F);#bt=new x(z);#Ot="OSM - Color";#X="";#Nt=!1;#t=g;constructor(){super(),this.#Pt.add(new F),this.#t=b.nextObjId}get editedRoute(){return this.#Ct}set editedRoute(t){this.#Ct="Route"===t?.objType?.name?t:new F}get routes(){return this.#Pt}get notes(){return this.#bt}get layerName(){return this.#Ot}set layerName(t){this.#Ot="string"==typeof t?N.sanitizeToJsString(t):"OSM - Color"}get name(){return this.#X}set name(t){this.#X="string"==typeof t?N.sanitizeToJsString(t):""}get readOnly(){return this.#Nt}set readOnly(t){this.#Nt="boolean"!=typeof t||t}get objId(){return this.#t}get objType(){return Z.#W}get jsonObject(){return{editedRoute:this.editedRoute.jsonObject,layerName:this.layerName,name:this.name,routes:this.routes.jsonObject,notes:this.notes.jsonObject,readOnly:this.readOnly,objId:this.#t,objType:this.objType.jsonObject}}set jsonObject(t){const e=this.validateObject(t);this.editedRoute.jsonObject=e.editedRoute,this.layerName=t.layerName,this.name=e.name,this.readOnly=e.readOnly,this.routes.jsonObject=e.routes,this.notes.jsonObject=e.notes,this.#t=b.nextObjId}}class K{#rt="";#at="";constructor(){Object.freeze(this)}get provider(){return this.#rt}set provider(t){this.#rt="string"==typeof t?t:""}get transitMode(){return this.#at}set transitMode(t){this.#at="string"==typeof t?t:""}}const U=new class{#St;#Dt;#jt;#kt;#At;#Rt;#Ht;#Bt;constructor(){Object.freeze(this),this.#St=new Map,this.#Dt=new Map,this.#jt=new K,this.#kt=D.UUID,this.#At=null,this.#Rt=new Z,this.#Ht=g,this.#Bt=[]}get map(){return this.#At}set map(t){this.#At||(this.#At=t)}get travel(){return this.#Rt}get editedRouteObjId(){return this.#Ht}set editedRouteObjId(t){this.#Ht="number"==typeof t?t:g}get searchData(){return this.#Bt}get providers(){return this.#St}get mapObjects(){return this.#Dt}get routing(){return this.#jt}get UUID(){return this.#kt}};class V{#zt;#Ft;constructor(t,e){Object.freeze(this),this.#zt="string"==typeof t?t:"",this.#Ft="string"==typeof e?e:""}get providerName(){return this.#zt}get providerKey(){return this.#Ft}get jsonObject(){return{providerName:this.providerName,providerKey:this.providerKey}}}const W=new class{#Zt(t,e){for(const o in e)try{if("dataset"===o){const o=e.dataset;for(const e in o)t.dataset["tan"+e]=o[e]}else t[o]=e[o]}catch(t){t instanceof Error&&console.error(t)}t.target&&(t.rel="noopener noreferrer")}constructor(){Object.freeze(this)}create(t,e,o){let i=null;return"text"===t.toLowerCase()?i=document.createTextNode(e.value||""):(i="select"===t.toLowerCase()?document.createElement(t):Object.seal(document.createElement(t)),e&&this.#Zt(i,e)),o&&o.appendChild(i),i}};let X=class{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(){this.#Kt.onCancel()}};class Y{#Ut;constructor(t){Object.freeze(this),this.#Ut=t}handleEvent(t){this.#Ut.keyboardELEnabled&&("Escape"===t.key||"Esc"===t.key?this.#Ut.onCancel():"Enter"===t.key&&this.#Ut.onOk())}}class G{#Ut;constructor(t){Object.freeze(this),this.#Ut=t}handleEvent(){this.#Ut.onOk()}}
/* @preserve
	 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
	 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
	 */function q(t){var e,o,i,n;for(o=1,i=arguments.length;o<i;o++)for(e in n=arguments[o])t[e]=n[e];return t}var J=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function $(t,e){var o=Array.prototype.slice;if(t.bind)return t.bind.apply(t,o.call(arguments,1));var i=o.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(o.call(arguments)):arguments)}}var Q=0;function tt(t){return"_leaflet_id"in t||(t._leaflet_id=++Q),t._leaflet_id}function et(t,e,o){var i,n,s,r;return r=function(){i=!1,n&&(s.apply(o,n),n=!1)},s=function(){i?n=arguments:(t.apply(o,arguments),setTimeout(r,e),i=!0)},s}function ot(t,e,o){var i=e[1],n=e[0],s=i-n;return t===i&&o?t:((t-n)%s+s)%s+n}function it(){return!1}function nt(t,e){if(!1===e)return t;var o=Math.pow(10,void 0===e?6:e);return Math.round(t*o)/o}function st(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function rt(t){return st(t).split(/\s+/)}function at(t,e){for(var o in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?J(t.options):{}),e)t.options[o]=e[o];return t.options}function lt(t,e,o){var i=[];for(var n in t)i.push(encodeURIComponent(o?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}var ht=/\{ *([\w_ -]+) *\}/g;function ct(t,e){return t.replace(ht,function(t,o){var i=e[o];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})}var dt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function ut(t,e){for(var o=0;o<t.length;o++)if(t[o]===e)return o;return-1}var mt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function pt(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var gt=0;function vt(t){var e=+new Date,o=Math.max(0,16-(e-gt));return gt=e+o,window.setTimeout(t,o)}var ft=window.requestAnimationFrame||pt("RequestAnimationFrame")||vt,_t=window.cancelAnimationFrame||pt("CancelAnimationFrame")||pt("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function yt(t,e,o){if(!o||ft!==vt)return ft.call(window,$(t,e));t.call(e)}function bt(t){t&&_t.call(window,t)}var Lt={__proto__:null,extend:q,create:J,bind:$,get lastId(){return Q},stamp:tt,throttle:et,wrapNum:ot,falseFn:it,formatNum:nt,trim:st,splitWords:rt,setOptions:at,getParamString:lt,template:ct,isArray:dt,indexOf:ut,emptyImageUrl:mt,requestFn:ft,cancelFn:_t,requestAnimFrame:yt,cancelAnimFrame:bt};function Tt(){}Tt.extend=function(t){var e=function(){at(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=e.__super__=this.prototype,i=J(o);for(var n in i.constructor=e,e.prototype=i,this)Object.prototype.hasOwnProperty.call(this,n)&&"prototype"!==n&&"__super__"!==n&&(e[n]=this[n]);return t.statics&&q(e,t.statics),t.includes&&(!function(t){if("undefined"==typeof L||!L||!L.Mixin)return;t=dt(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}(t.includes),q.apply(null,[i].concat(t.includes))),q(i,t),delete i.statics,delete i.includes,i.options&&(i.options=o.options?J(o.options):{},q(i.options,t.options)),i._initHooks=[],i.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=i._initHooks.length;t<e;t++)i._initHooks[t].call(this)}},e},Tt.include=function(t){var e=this.prototype.options;return q(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},Tt.mergeOptions=function(t){return q(this.prototype.options,t),this},Tt.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),o="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};var Et={on:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else for(var n=0,s=(t=rt(t)).length;n<s;n++)this._on(t[n],e,o);return this},off:function(t,e,o){if(arguments.length)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=rt(t);for(var n=1===arguments.length,s=0,r=t.length;s<r;s++)n?this._off(t[s]):this._off(t[s],e,o)}else delete this._events;return this},_on:function(t,e,o,i){if("function"==typeof e){if(!1===this._listens(t,e,o)){o===this&&(o=void 0);var n={fn:e,ctx:o};i&&(n.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,o){var i,n,s;if(this._events&&(i=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var r=this._listens(t,e,o);if(!1!==r){var a=i[r];this._firingCount&&(a.fn=it,this._events[t]=i=i.slice()),i.splice(r,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(n=0,s=i.length;n<s;n++)i[n].fn=it;delete this._events[t]}},fire:function(t,e,o){if(!this.listens(t,o))return this;var i=q({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var n=this._events[t];if(n){this._firingCount=this._firingCount+1||1;for(var s=0,r=n.length;s<r;s++){var a=n[s],l=a.fn;a.once&&this.off(t,l,a.ctx),l.call(a.ctx||this,i)}this._firingCount--}}return o&&this._propagateEvent(i),this},listens:function(t,e,o,i){"string"!=typeof t&&console.warn('"string" type argument expected');var n=e;"function"!=typeof e&&(i=!!e,n=void 0,o=void 0);var s=this._events&&this._events[t];if(s&&s.length&&!1!==this._listens(t,n,o))return!0;if(i)for(var r in this._eventParents)if(this._eventParents[r].listens(t,e,o,i))return!0;return!1},_listens:function(t,e,o){if(!this._events)return!1;var i=this._events[t]||[];if(!e)return!!i.length;o===this&&(o=void 0);for(var n=0,s=i.length;n<s;n++)if(i[n].fn===e&&i[n].ctx===o)return n;return!1},once:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e,!0);else for(var n=0,s=(t=rt(t)).length;n<s;n++)this._on(t[n],e,o,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[tt(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[tt(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,q({layer:t.target,propagatedFrom:t.target},t),!0)}};Et.addEventListener=Et.on,Et.removeEventListener=Et.clearAllEventListeners=Et.off,Et.addOneTimeEventListener=Et.once,Et.fireEvent=Et.fire,Et.hasEventListeners=Et.listens;var wt=Tt.extend(Et);function Mt(t,e,o){this.x=o?Math.round(t):t,this.y=o?Math.round(e):e}var xt=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function It(t,e,o){return t instanceof Mt?t:dt(t)?new Mt(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new Mt(t.x,t.y):new Mt(t,e,o)}function Ct(t,e){if(t)for(var o=e?[t,e]:t,i=0,n=o.length;i<n;i++)this.extend(o[i])}function Pt(t,e){return!t||t instanceof Ct?t:new Ct(t,e)}function Ot(t,e){if(t)for(var o=e?[t,e]:t,i=0,n=o.length;i<n;i++)this.extend(o[i])}function Nt(t,e){return t instanceof Ot?t:new Ot(t,e)}function St(t,e,o){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==o&&(this.alt=+o)}function Dt(t,e,o){return t instanceof St?t:dt(t)&&"object"!=typeof t[0]?3===t.length?new St(t[0],t[1],t[2]):2===t.length?new St(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new St(t.lat,"lng"in t?t.lng:t.lon,t.alt):null}Mt.prototype={clone:function(){return new Mt(this.x,this.y)},add:function(t){return this.clone()._add(It(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(It(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new Mt(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new Mt(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=xt(this.x),this.y=xt(this.y),this},distanceTo:function(t){var e=(t=It(t)).x-this.x,o=t.y-this.y;return Math.sqrt(e*e+o*o)},equals:function(t){return(t=It(t)).x===this.x&&t.y===this.y},contains:function(t){return t=It(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+nt(this.x)+", "+nt(this.y)+")"}},Ct.prototype={extend:function(t){var e,o;if(!t)return this;if(t instanceof Mt||"number"==typeof t[0]||"x"in t)e=o=It(t);else if(e=(t=Pt(t)).min,o=t.max,!e||!o)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)):(this.min=e.clone(),this.max=o.clone()),this},getCenter:function(t){return It((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return It(this.min.x,this.max.y)},getTopRight:function(){return It(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,o;return(t="number"==typeof t[0]||t instanceof Mt?It(t):Pt(t))instanceof Ct?(e=t.min,o=t.max):e=o=t,e.x>=this.min.x&&o.x<=this.max.x&&e.y>=this.min.y&&o.y<=this.max.y},intersects:function(t){t=Pt(t);var e=this.min,o=this.max,i=t.min,n=t.max,s=n.x>=e.x&&i.x<=o.x,r=n.y>=e.y&&i.y<=o.y;return s&&r},overlaps:function(t){t=Pt(t);var e=this.min,o=this.max,i=t.min,n=t.max,s=n.x>e.x&&i.x<o.x,r=n.y>e.y&&i.y<o.y;return s&&r},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,o=this.max,i=Math.abs(e.x-o.x)*t,n=Math.abs(e.y-o.y)*t;return Pt(It(e.x-i,e.y-n),It(o.x+i,o.y+n))},equals:function(t){return!!t&&(t=Pt(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},Ot.prototype={extend:function(t){var e,o,i=this._southWest,n=this._northEast;if(t instanceof St)e=t,o=t;else{if(!(t instanceof Ot))return t?this.extend(Dt(t)||Nt(t)):this;if(e=t._southWest,o=t._northEast,!e||!o)return this}return i||n?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),n.lat=Math.max(o.lat,n.lat),n.lng=Math.max(o.lng,n.lng)):(this._southWest=new St(e.lat,e.lng),this._northEast=new St(o.lat,o.lng)),this},pad:function(t){var e=this._southWest,o=this._northEast,i=Math.abs(e.lat-o.lat)*t,n=Math.abs(e.lng-o.lng)*t;return new Ot(new St(e.lat-i,e.lng-n),new St(o.lat+i,o.lng+n))},getCenter:function(){return new St((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new St(this.getNorth(),this.getWest())},getSouthEast:function(){return new St(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof St||"lat"in t?Dt(t):Nt(t);var e,o,i=this._southWest,n=this._northEast;return t instanceof Ot?(e=t.getSouthWest(),o=t.getNorthEast()):e=o=t,e.lat>=i.lat&&o.lat<=n.lat&&e.lng>=i.lng&&o.lng<=n.lng},intersects:function(t){t=Nt(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),n=t.getNorthEast(),s=n.lat>=e.lat&&i.lat<=o.lat,r=n.lng>=e.lng&&i.lng<=o.lng;return s&&r},overlaps:function(t){t=Nt(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),n=t.getNorthEast(),s=n.lat>e.lat&&i.lat<o.lat,r=n.lng>e.lng&&i.lng<o.lng;return s&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=Nt(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},St.prototype={equals:function(t,e){return!!t&&(t=Dt(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+nt(this.lat,t)+", "+nt(this.lng,t)+")"},distanceTo:function(t){return At.distance(this,Dt(t))},wrap:function(){return At.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,o=e/Math.cos(Math.PI/180*this.lat);return Nt([this.lat-e,this.lng-o],[this.lat+e,this.lng+o])},clone:function(){return new St(this.lat,this.lng,this.alt)}};var jt,kt={latLngToPoint:function(t,e){var o=this.projection.project(t),i=this.scale(e);return this.transformation._transform(o,i)},pointToLatLng:function(t,e){var o=this.scale(e),i=this.transformation.untransform(t,o);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,o=this.scale(t);return new Ct(this.transformation.transform(e.min,o),this.transformation.transform(e.max,o))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?ot(t.lng,this.wrapLng,!0):t.lng;return new St(this.wrapLat?ot(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),o=this.wrapLatLng(e),i=e.lat-o.lat,n=e.lng-o.lng;if(0===i&&0===n)return t;var s=t.getSouthWest(),r=t.getNorthEast();return new Ot(new St(s.lat-i,s.lng-n),new St(r.lat-i,r.lng-n))}},At=q({},kt,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var o=Math.PI/180,i=t.lat*o,n=e.lat*o,s=Math.sin((e.lat-t.lat)*o/2),r=Math.sin((e.lng-t.lng)*o/2),a=s*s+Math.cos(i)*Math.cos(n)*r*r,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),Rt=6378137,Ht={R:Rt,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,o=this.MAX_LATITUDE,i=Math.max(Math.min(o,t.lat),-o),n=Math.sin(i*e);return new Mt(this.R*t.lng*e,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(t){var e=180/Math.PI;return new St((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(jt=Rt*Math.PI,new Ct([-jt,-jt],[jt,jt]))};function Bt(t,e,o,i){if(dt(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=o,this._d=i}function zt(t,e,o,i){return new Bt(t,e,o,i)}Bt.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new Mt((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Ft,Zt=q({},At,{code:"EPSG:3857",projection:Ht,transformation:(Ft=.5/(Math.PI*Ht.R),zt(Ft,.5,-Ft,.5))}),Kt=q({},Zt,{code:"EPSG:900913"});function Ut(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Vt(t,e){var o,i,n,s,r,a,l="";for(o=0,n=t.length;o<n;o++){for(i=0,s=(r=t[o]).length;i<s;i++)l+=(i?"L":"M")+(a=r[i]).x+" "+a.y;l+=e?Te.svg?"z":"x":""}return l||"M0 0"}var Wt=document.documentElement.style,Xt="ActiveXObject"in window,Yt=Xt&&!document.addEventListener,Gt="msLaunchUri"in navigator&&!("documentMode"in document),qt=(Le("webkit"),Le("android")),Jt=Le("android 2")||Le("android 3"),$t=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10);qt&&Le("Google")&&$t<537&&window;var Qt=!!window.opera,te=!Gt&&Le("chrome");Le("gecko");var ee=!te&&Le("safari"),oe=Le("phantom"),ie="OTransition"in Wt;navigator.platform.indexOf("Win");var ne,se=Xt&&"transition"in Wt,re="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Jt,ae="MozPerspective"in Wt,le=!window.L_DISABLE_3D&&(se||re||ae)&&!ie&&!oe,he="undefined"!=typeof orientation||Le("mobile"),ce=!window.PointerEvent&&window.MSPointerEvent,de=!(!window.PointerEvent&&!ce),ue="ontouchstart"in window||!!window.TouchEvent,me=!window.L_NO_TOUCH&&(ue||de),pe=he&&Qt,ge=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,ve=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",it,e),window.removeEventListener("testPassiveEventSupport",it,e)}catch(t){}return t}(),fe=!!document.createElement("canvas").getContext,_e=!(!document.createElementNS||!Ut("svg").createSVGRect),ye=!!_e&&((ne=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(ne.firstChild&&ne.firstChild.namespaceURI)),be=!_e&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function Le(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Te={ielt9:Yt,edge:Gt,chrome:te,safari:ee,ie3d:se,any3d:le,mobile:he,msPointer:ce,pointer:de,touch:me,touchNative:ue,mobileOpera:pe,retina:ge,passiveEvents:ve,canvas:fe,svg:_e,vml:be,inlineSvg:ye,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Ee=Te.msPointer?"MSPointerDown":"pointerdown",we=Te.msPointer?"MSPointerMove":"pointermove",Me=Te.msPointer?"MSPointerUp":"pointerup",xe=Te.msPointer?"MSPointerCancel":"pointercancel",Ie={touchstart:Ee,touchmove:we,touchend:Me,touchcancel:xe},Ce={touchstart:function(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Eo(e);ke(t,e)},touchmove:ke,touchend:ke,touchcancel:ke},Pe={},Oe=!1;function Ne(t,e,o){return"touchstart"===e&&(Oe||(document.addEventListener(Ee,Se,!0),document.addEventListener(we,De,!0),document.addEventListener(Me,je,!0),document.addEventListener(xe,je,!0),Oe=!0)),Ce[e]?(o=Ce[e].bind(this,o),t.addEventListener(Ie[e],o,!1),o):(console.warn("wrong event specified:",e),it)}function Se(t){Pe[t.pointerId]=t}function De(t){Pe[t.pointerId]&&(Pe[t.pointerId]=t)}function je(t){delete Pe[t.pointerId]}function ke(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var o in e.touches=[],Pe)e.touches.push(Pe[o]);e.changedTouches=[e],t(e)}}var Ae,Re,He,Be,ze,Fe=oo(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ze=oo(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ke="webkitTransition"===Ze||"OTransition"===Ze?Ze+"End":"transitionend";function Ue(t,e){var o=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!o||"auto"===o)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);o=i?i[e]:null}return"auto"===o?null:o}function Ve(t,e,o){var i=document.createElement(t);return i.className=e||"",o&&o.appendChild(i),i}function We(t){var e=t.parentNode;e&&e.removeChild(t)}function Xe(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function Ye(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function Ge(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function qe(t,e){if(void 0!==t.classList)return t.classList.contains(e);var o=to(t);return o.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(o)}function Je(t,e){if(void 0!==t.classList)for(var o=rt(e),i=0,n=o.length;i<n;i++)t.classList.add(o[i]);else if(!qe(t,e)){var s=to(t);Qe(t,(s?s+" ":"")+e)}}function $e(t,e){void 0!==t.classList?t.classList.remove(e):Qe(t,st((" "+to(t)+" ").replace(" "+e+" "," ")))}function Qe(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function to(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function eo(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var o=!1,i="DXImageTransform.Microsoft.Alpha";try{o=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),o?(o.Enabled=100!==e,o.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}(t,e)}function oo(t){for(var e=document.documentElement.style,o=0;o<t.length;o++)if(t[o]in e)return t[o];return!1}function io(t,e,o){var i=e||new Mt(0,0);t.style[Fe]=(Te.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(o?" scale("+o+")":"")}function no(t,e){t._leaflet_pos=e,Te.any3d?io(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function so(t){return t._leaflet_pos||new Mt(0,0)}if("onselectstart"in document)Ae=function(){mo(window,"selectstart",Eo)},Re=function(){go(window,"selectstart",Eo)};else{var ro=oo(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ae=function(){if(ro){var t=document.documentElement.style;He=t[ro],t[ro]="none"}},Re=function(){ro&&(document.documentElement.style[ro]=He,He=void 0)}}function ao(){mo(window,"dragstart",Eo)}function lo(){go(window,"dragstart",Eo)}function ho(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(co(),Be=t,ze=t.style.outlineStyle,t.style.outlineStyle="none",mo(window,"keydown",co))}function co(){Be&&(Be.style.outlineStyle=ze,Be=void 0,ze=void 0,go(window,"keydown",co))}function uo(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}function mo(t,e,o,i){if(e&&"object"==typeof e)for(var n in e)_o(t,n,e[n],o);else for(var s=0,r=(e=rt(e)).length;s<r;s++)_o(t,e[s],o,i);return this}var po="_leaflet_events";function go(t,e,o,i){if(1===arguments.length)vo(t),delete t[po];else if(e&&"object"==typeof e)for(var n in e)yo(t,n,e[n],o);else if(e=rt(e),2===arguments.length)vo(t,function(t){return-1!==ut(e,t)});else for(var s=0,r=e.length;s<r;s++)yo(t,e[s],o,i);return this}function vo(t,e){for(var o in t[po]){var i=o.split(/\d/)[0];e&&!e(i)||yo(t,i,null,null,o)}}var fo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function _o(t,e,o,i){var n=e+tt(o)+(i?"_"+tt(i):"");if(t[po]&&t[po][n])return this;var s=function(e){return o.call(i||t,e||window.event)},r=s;!Te.touchNative&&Te.pointer&&0===e.indexOf("touch")?s=Ne(t,e,s):Te.touch&&"dblclick"===e?s=function(t,e){t.addEventListener("dblclick",e);var o,i=0;function n(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var n=Mo(t);if(!n.some(function(t){return t instanceof HTMLLabelElement&&t.attributes.for})||n.some(function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement})){var s=Date.now();s-i<=200?2===++o&&e(function(t){var e,o,i={};for(o in t)e=t[o],i[o]=e&&e.bind?e.bind(t):e;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}(t)):o=1,i=s}}}else o=t.detail}return t.addEventListener("click",n),{dblclick:e,simDblclick:n}}(t,s):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(fo[e]||e,s,!!Te.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||window.event,Po(t,e)&&r(e)},t.addEventListener(fo[e],s,!1)):t.addEventListener(e,r,!1):t.attachEvent("on"+e,s),t[po]=t[po]||{},t[po][n]=s}function yo(t,e,o,i,n){n=n||e+tt(o)+(i?"_"+tt(i):"");var s=t[po]&&t[po][n];if(!s)return this;!Te.touchNative&&Te.pointer&&0===e.indexOf("touch")?function(t,e,o){Ie[e]?t.removeEventListener(Ie[e],o,!1):console.warn("wrong event specified:",e)}(t,e,s):Te.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,s):"removeEventListener"in t?t.removeEventListener(fo[e]||e,s,!1):t.detachEvent("on"+e,s),t[po][n]=null}function bo(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Lo(t){return _o(t,"wheel",bo),this}function To(t){return mo(t,"mousedown touchstart dblclick contextmenu",bo),t._leaflet_disable_click=!0,this}function Eo(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function wo(t){return Eo(t),bo(t),this}function Mo(t){if(t.composedPath)return t.composedPath();for(var e=[],o=t.target;o;)e.push(o),o=o.parentNode;return e}function xo(t,e){if(!e)return new Mt(t.clientX,t.clientY);var o=uo(e),i=o.boundingClientRect;return new Mt((t.clientX-i.left)/o.x-e.clientLeft,(t.clientY-i.top)/o.y-e.clientTop)}var Io=Te.linux&&Te.chrome?window.devicePixelRatio:Te.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Co(t){return Te.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Io:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function Po(t,e){var o=e.relatedTarget;if(!o)return!0;try{for(;o&&o!==t;)o=o.parentNode}catch(t){return!1}return o!==t}var Oo={__proto__:null,on:mo,off:go,stopPropagation:bo,disableScrollPropagation:Lo,disableClickPropagation:To,preventDefault:Eo,stop:wo,getPropagationPath:Mo,getMousePosition:xo,getWheelDelta:Co,isExternalTarget:Po,addListener:mo,removeListener:go},No=wt.extend({run:function(t,e,o,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=so(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=yt(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,o=1e3*this._duration;e<o?this._runFrame(this._easeOut(e/o),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var o=this._startPos.add(this._offset.multiplyBy(t));e&&o._round(),no(this._el,o),this.fire("step")},_complete:function(){bt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),So=wt.extend({options:{crs:Zt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=at(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=$(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(Dt(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ze&&Te.any3d&&!Te.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),mo(this._proxy,Ke,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,o){if((e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(Dt(t),e,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&!0!==o)&&(void 0!==o.animate&&(o.zoom=q({animate:o.animate},o.zoom),o.pan=q({animate:o.animate,duration:o.duration},o.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,o.zoom):this._tryAnimatedPan(t,o.pan)))return clearTimeout(this._sizeTimer),this;return this._resetView(t,e,o.pan&&o.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Te.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Te.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,o){var i=this.getZoomScale(e),n=this.getSize().divideBy(2),s=(t instanceof Mt?t:this.latLngToContainerPoint(t)).subtract(n).multiplyBy(1-1/i),r=this.containerPointToLatLng(n.add(s));return this.setView(r,e,{zoom:o})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():Nt(t);var o=It(e.paddingTopLeft||e.padding||[0,0]),i=It(e.paddingBottomRight||e.padding||[0,0]),n=this.getBoundsZoom(t,!1,o.add(i));if((n="number"==typeof e.maxZoom?Math.min(e.maxZoom,n):n)===1/0)return{center:t.getCenter(),zoom:n};var s=i.subtract(o).divideBy(2),r=this.project(t.getSouthWest(),n),a=this.project(t.getNorthEast(),n);return{center:this.unproject(r.add(a).divideBy(2).add(s),n),zoom:n}},fitBounds:function(t,e){if(!(t=Nt(t)).isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(t,e);return this.setView(o.center,o.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=It(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new No,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){Je(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,o,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,o){if(!1===(o=o||{}).animate||!Te.any3d)return this.setView(t,e,o);this._stop();var i=this.project(this.getCenter()),n=this.project(t),s=this.getSize(),r=this._zoom;t=Dt(t),e=void 0===e?r:e;var a=Math.max(s.x,s.y),l=a*this.getZoomScale(r,e),h=n.distanceTo(i)||1,c=1.42,d=2.0164;function u(t){var e=(l*l-a*a+(t?-1:1)*d*d*h*h)/(2*(t?l:a)*d*h),o=Math.sqrt(e*e+1)-e;return o<1e-9?-18:Math.log(o)}function m(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}var g=u(0);function v(t){return a*(p(g)*(m(e=g+c*t)/p(e))-m(g))/d;var e}var f=Date.now(),_=(u(1)-g)/c,y=o.duration?1e3*o.duration:1e3*_*.8;return this._moveStart(!0,o.noMoveStart),function o(){var s=(Date.now()-f)/y,l=function(t){return 1-Math.pow(1-t,1.5)}(s)*_;s<=1?(this._flyToFrame=yt(o,this),this._move(this.unproject(i.add(n.subtract(i).multiplyBy(v(l)/h)),r),this.getScaleZoom(a/function(t){return a*(p(g)/p(g+c*t))}(l),r),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var o=this._getBoundsCenterZoom(t,e);return this.flyTo(o.center,o.zoom,e)},setMaxBounds:function(t){return t=Nt(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var o=this.getCenter(),i=this._limitCenter(o,this._zoom,Nt(t));return o.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){var o=It((e=e||{}).paddingTopLeft||e.padding||[0,0]),i=It(e.paddingBottomRight||e.padding||[0,0]),n=this.project(this.getCenter()),s=this.project(t),r=this.getPixelBounds(),a=Pt([r.min.add(o),r.max.subtract(i)]),l=a.getSize();if(!a.contains(s)){this._enforcingBounds=!0;var h=s.subtract(a.getCenter()),c=a.extend(s).getSize().subtract(l);n.x+=h.x<0?-c.x:c.x,n.y+=h.y<0?-c.y:c.y,this.panTo(this.unproject(n),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=q({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),i=e.divideBy(2).round(),n=o.divideBy(2).round(),s=i.subtract(n);return s.x||s.y?(t.animate&&t.pan?this.panBy(s):(t.pan&&this._rawPanBy(s),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout($(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:o})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=q({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=$(this._handleGeolocationResponse,this),o=$(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,o,t):navigator.geolocation.getCurrentPosition(e,o,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,o=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new St(t.coords.latitude,t.coords.longitude),o=e.toBounds(2*t.coords.accuracy),i=this._locateOptions;if(i.setView){var n=this.getBoundsZoom(o);this.setView(e,i.maxZoom?Math.min(n,i.maxZoom):n)}var s={latlng:e,bounds:o,timestamp:t.timestamp};for(var r in t.coords)"number"==typeof t.coords[r]&&(s[r]=t.coords[r]);this.fire("locationfound",s)}},addHandler:function(t,e){if(!e)return this;var o=this[t]=new e(this);return this._handlers.push(o),this.options[t]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),We(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(bt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)We(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var o=Ve("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=o),o},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new Ot(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,o){t=Nt(t),o=It(o||[0,0]);var i=this.getZoom()||0,n=this.getMinZoom(),s=this.getMaxZoom(),r=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(o),h=Pt(this.project(a,i),this.project(r,i)).getSize(),c=Te.any3d?this.options.zoomSnap:1,d=l.x/h.x,u=l.y/h.y,m=e?Math.max(d,u):Math.min(d,u);return i=this.getScaleZoom(m,i),c&&(i=Math.round(i/(c/100))*(c/100),i=e?Math.ceil(i/c)*c:Math.floor(i/c)*c),Math.max(n,Math.min(s,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new Mt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var o=this._getTopLeftPoint(t,e);return new Ct(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var o=this.options.crs;return e=void 0===e?this._zoom:e,o.scale(t)/o.scale(e)},getScaleZoom:function(t,e){var o=this.options.crs;e=void 0===e?this._zoom:e;var i=o.zoom(t*o.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(Dt(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(It(t),e)},layerPointToLatLng:function(t){var e=It(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(Dt(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(Dt(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(Nt(t))},distance:function(t,e){return this.options.crs.distance(Dt(t),Dt(e))},containerPointToLayerPoint:function(t){return It(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return It(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(It(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Dt(t)))},mouseEventToContainerPoint:function(t){return xo(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=function(t){return"string"==typeof t?document.getElementById(t):t}(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");mo(e,"scroll",this._onScroll,this),this._containerId=tt(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Te.any3d,Je(t,"leaflet-container"+(Te.touch?" leaflet-touch":"")+(Te.retina?" leaflet-retina":"")+(Te.ielt9?" leaflet-oldie":"")+(Te.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=Ue(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),no(this._mapPane,new Mt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Je(t.markerPane,"leaflet-zoom-hide"),Je(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,o){no(this._mapPane,new Mt(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,o)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,o,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?o&&o.pinch&&this.fire("zoom",o):((n||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return bt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){no(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[tt(this._container)]=this;var e=t?go:mo;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Te.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){bt(this._resizeRequest),this._resizeRequest=yt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var o,i=[],n="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,r=!1;s;){if((o=this._targets[tt(s)])&&("click"===e||"preclick"===e)&&this._draggableMoved(o)){r=!0;break}if(o&&o.listens(e,!0)){if(n&&!Po(s,t))break;if(i.push(o),n)break}if(s===this._container)break;s=s.parentNode}return i.length||r||n||!this.listens(e,!0)||(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var o=t.type;"mousedown"===o&&ho(e),this._fireDOMEvent(t,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,o){if("click"===t.type){var i=q({},t);i.type="preclick",this._fireDOMEvent(i,i.type,o)}var n=this._findEventTargets(t,e);if(o){for(var s=[],r=0;r<o.length;r++)o[r].listens(e,!0)&&s.push(o[r]);n=s.concat(n)}if(n.length){"contextmenu"===e&&Eo(t);var a=n[0],l={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var h=a.getLatLng&&(!a._radius||a._radius<=10);l.containerPoint=h?this.latLngToContainerPoint(a.getLatLng()):this.mouseEventToContainerPoint(t),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=h?a.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(r=0;r<n.length;r++)if(n[r].fire(e,l,!0),l.originalEvent._stopped||!1===n[r].options.bubblingMouseEvents&&-1!==ut(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return so(this._mapPane)||new Mt(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var o=this.getSize()._divideBy(2);return this.project(t,e)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return Pt([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,o){if(!o)return t;var i=this.project(t,e),n=this.getSize().divideBy(2),s=new Ct(i.subtract(n),i.add(n)),r=this._getBoundsOffset(s,o,e);return Math.abs(r.x)<=1&&Math.abs(r.y)<=1?t:this.unproject(i.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var o=this.getPixelBounds(),i=new Ct(o.min.add(t),o.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,o){var i=Pt(this.project(e.getNorthEast(),o),this.project(e.getSouthWest(),o)),n=i.min.subtract(t.min),s=i.max.subtract(t.max);return new Mt(this._rebound(n.x,-s.x),this._rebound(n.y,-s.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),o=this.getMaxZoom(),i=Te.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(o,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){$e(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var o=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(o))&&(this.panBy(o,e),!0)},_createAnimProxy:function(){var t=this._proxy=Ve("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=Fe,o=this._proxy.style[e];io(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),o===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){We(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();io(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||!1===o.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==o.animate&&!this.getSize().contains(n))&&(yt(function(){this._moveStart(!0,o.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,o,i){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,Je(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout($(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&$e(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}}),Do=Tt.extend({options:{position:"topright"},initialize:function(t){at(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),o=this.getPosition(),i=t._controlCorners[o];return Je(e,"leaflet-control"),-1!==o.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(We(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}});So.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",o=this._controlContainer=Ve("div",e+"control-container",this._container);function i(i,n){var s=e+i+" "+e+n;t[i+n]=Ve("div",s,o)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)We(this._controlCorners[t]);We(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var jo=Do.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,o,i){return o<i?-1:i<o?1:0}},initialize:function(t,e,o){for(var i in at(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Do.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(tt(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){Je(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(Je(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):$e(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return $e(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=Ve("div",t),o=this.options.collapsed;e.setAttribute("aria-haspopup",!0),To(e),Lo(e);var i=this._section=Ve("section",t+"-list");o&&(this._map.on("click",this.collapse,this),mo(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var n=this._layersLink=Ve("a",t+"-toggle",e);n.href="#",n.title="Layers",n.setAttribute("role","button"),mo(n,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){Eo(t),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=Ve("div",t+"-base",i),this._separator=Ve("div",t+"-separator",i),this._overlaysList=Ve("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&tt(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,o){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:o}),this.options.sortLayers&&this._layers.sort($(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Xe(this._baseLayersList),Xe(this._overlaysList),this._layerControlInputs=[];var t,e,o,i,n=0;for(o=0;o<this._layers.length;o++)i=this._layers[o],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,n+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&n>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(tt(t.target)),o=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;o&&this._map.fire(o,e)},_createRadioElement:function(t,e){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=o,i.firstChild},_addItem:function(t){var e,o=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers_"+tt(this),i),this._layerControlInputs.push(e),e.layerId=tt(t.layer),mo(e,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var s=document.createElement("span");return o.appendChild(s),s.appendChild(e),s.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(o),this._checkDisabledLayers(),o},_onInputClick:function(){if(!this._preventClick){var t,e,o=this._layerControlInputs,i=[],n=[];this._handlingClick=!0;for(var s=o.length-1;s>=0;s--)t=o[s],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||n.push(e);for(s=0;s<n.length;s++)this._map.hasLayer(n[s])&&this._map.removeLayer(n[s]);for(s=0;s<i.length;s++)this._map.hasLayer(i[s])||this._map.addLayer(i[s]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,o=this._layerControlInputs,i=this._map.getZoom(),n=o.length-1;n>=0;n--)t=o[n],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,mo(t,"click",Eo),this.expand();var e=this;setTimeout(function(){go(t,"click",Eo),e._preventClick=!1})}}),ko=Do.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",o=Ve("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",o,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,o,i,n){var s=Ve("a",o,i);return s.innerHTML=t,s.href="#",s.title=e,s.setAttribute("role","button"),s.setAttribute("aria-label",e),To(s),mo(s,"click",wo),mo(s,"click",n,this),mo(s,"click",this._refocusOnMap,this),s},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";$e(this._zoomInButton,e),$e(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(Je(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(Je(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});So.mergeOptions({zoomControl:!0}),So.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ko,this.addControl(this.zoomControl))});var Ao=Do.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",o=Ve("div",e),i=this.options;return this._addScales(i,e+"-line",o),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),o},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,o){t.metric&&(this._mScale=Ve("div",e,o)),t.imperial&&(this._iScale=Ve("div",e,o))},_update:function(){var t=this._map,e=t.getSize().y/2,o=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(o)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),o=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,o,e/t)},_updateImperial:function(t){var e,o,i,n=3.2808399*t;n>5280?(e=n/5280,o=this._getRoundNum(e),this._updateScale(this._iScale,o+" mi",o/e)):(i=this._getRoundNum(n),this._updateScale(this._iScale,i+" ft",i/n))},_updateScale:function(t,e,o){t.style.width=Math.round(this.options.maxWidth*o)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),o=t/e;return e*(o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1)}}),Ro=Do.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Te.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(t){at(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=Ve("div","leaflet-control-attribution"),To(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var o=[];this.options.prefix&&o.push(this.options.prefix),t.length&&o.push(t.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});So.mergeOptions({attributionControl:!0}),So.addInitHook(function(){this.options.attributionControl&&(new Ro).addTo(this)}),Do.Layers=jo,Do.Zoom=ko,Do.Scale=Ao,Do.Attribution=Ro;var Ho=Tt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ho.addTo=function(t,e){return t.addHandler(e,this),this};var Bo,zo=Te.touch?"touchstart mousedown":"mousedown",Fo=wt.extend({options:{clickTolerance:3},initialize:function(t,e,o,i){at(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=o},enable:function(){this._enabled||(mo(this._dragStartTarget,zo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Fo._dragging===this&&this.finishDrag(!0),go(this._dragStartTarget,zo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!qe(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)Fo._dragging===this&&this.finishDrag();else if(!(Fo._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(Fo._dragging=this,this._preventOutline&&ho(this._element),ao(),Ae(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,o=function(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}(this._element);this._startPoint=new Mt(e.clientX,e.clientY),this._startPos=so(this._element),this._parentScale=uo(o);var i="mousedown"===t.type;mo(document,i?"mousemove":"touchmove",this._onMove,this),mo(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,o=new Mt(e.clientX,e.clientY)._subtract(this._startPoint);(o.x||o.y)&&(Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,Eo(t),this._moved||(this.fire("dragstart"),this._moved=!0,Je(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Je(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),no(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){$e(document.body,"leaflet-dragging"),this._lastTarget&&($e(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),go(document,"mousemove touchmove",this._onMove,this),go(document,"mouseup touchend touchcancel",this._onUp,this),lo(),Re();var e=this._moved&&this._moving;this._moving=!1,Fo._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function Zo(t,e,o){var i,n,s,r,a,l,h,c,d,u=[1,4,2,8];for(n=0,h=t.length;n<h;n++)t[n]._code=Go(t[n],e);for(r=0;r<4;r++){for(c=u[r],i=[],n=0,s=(h=t.length)-1;n<h;s=n++)a=t[n],l=t[s],a._code&c?l._code&c||((d=Yo(l,a,c,e,o))._code=Go(d,e),i.push(d)):(l._code&c&&((d=Yo(l,a,c,e,o))._code=Go(d,e),i.push(d)),i.push(a));t=i}return t}function Ko(t){for(var e=0,o=0,i=0,n=0;n<t.length;n++){var s=Dt(t[n]);e+=s.lat,o+=s.lng,i++}return Dt([e/i,o/i])}function Uo(t,e){if(!e||!t.length)return t.slice();var o=e*e;return t=function(t,e){for(var o=[t[0]],i=1,n=0,s=t.length;i<s;i++)qo(t[i],t[n])>e&&(o.push(t[i]),n=i);n<s-1&&o.push(t[s-1]);return o}(t,o),t=function(t,e){var o=t.length,i=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(o);i[0]=i[o-1]=1,Wo(t,i,e,0,o-1);var n,s=[];for(n=0;n<o;n++)i[n]&&s.push(t[n]);return s}(t,o),t}function Vo(t,e,o){return Math.sqrt(Jo(t,e,o,!0))}function Wo(t,e,o,i,n){var s,r,a,l=0;for(r=i+1;r<=n-1;r++)(a=Jo(t[r],t[i],t[n],!0))>l&&(s=r,l=a);l>o&&(e[s]=1,Wo(t,e,o,i,s),Wo(t,e,o,s,n))}function Xo(t,e,o,i,n){var s,r,a,l=i?Bo:Go(t,o),h=Go(e,o);for(Bo=h;;){if(!(l|h))return[t,e];if(l&h)return!1;a=Go(r=Yo(t,e,s=l||h,o,n),o),s===l?(t=r,l=a):(e=r,h=a)}}function Yo(t,e,o,i,n){var s,r,a=e.x-t.x,l=e.y-t.y,h=i.min,c=i.max;return 8&o?(s=t.x+a*(c.y-t.y)/l,r=c.y):4&o?(s=t.x+a*(h.y-t.y)/l,r=h.y):2&o?(s=c.x,r=t.y+l*(c.x-t.x)/a):1&o&&(s=h.x,r=t.y+l*(h.x-t.x)/a),new Mt(s,r,n)}function Go(t,e){var o=0;return t.x<e.min.x?o|=1:t.x>e.max.x&&(o|=2),t.y<e.min.y?o|=4:t.y>e.max.y&&(o|=8),o}function qo(t,e){var o=e.x-t.x,i=e.y-t.y;return o*o+i*i}function Jo(t,e,o,i){var n,s=e.x,r=e.y,a=o.x-s,l=o.y-r,h=a*a+l*l;return h>0&&((n=((t.x-s)*a+(t.y-r)*l)/h)>1?(s=o.x,r=o.y):n>0&&(s+=a*n,r+=l*n)),a=t.x-s,l=t.y-r,i?a*a+l*l:new Mt(s,r)}function $o(t){return!dt(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function Qo(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),$o(t)}function ti(t,e){var o,i,n,s,r,a,l,h;if(!t||0===t.length)throw new Error("latlngs not passed");$o(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var c=Dt([0,0]),d=Nt(t);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(c=Ko(t));var u=t.length,m=[];for(o=0;o<u;o++){var p=Dt(t[o]);m.push(e.project(Dt([p.lat-c.lat,p.lng-c.lng])))}for(o=0,i=0;o<u-1;o++)i+=m[o].distanceTo(m[o+1])/2;if(0===i)h=m[0];else for(o=0,s=0;o<u-1;o++)if(r=m[o],a=m[o+1],(s+=n=r.distanceTo(a))>i){l=(s-i)/n,h=[a.x-l*(a.x-r.x),a.y-l*(a.y-r.y)];break}var g=e.unproject(It(h));return Dt([g.lat+c.lat,g.lng+c.lng])}var ei={__proto__:null,simplify:Uo,pointToSegmentDistance:Vo,closestPointOnSegment:function(t,e,o){return Jo(t,e,o)},clipSegment:Xo,_getEdgeIntersection:Yo,_getBitCode:Go,_sqClosestPointOnSegment:Jo,isFlat:$o,_flat:Qo,polylineCenter:ti},oi={project:function(t){return new Mt(t.lng,t.lat)},unproject:function(t){return new St(t.y,t.x)},bounds:new Ct([-180,-90],[180,90])},ii={R:6378137,R_MINOR:6356752.314245179,bounds:new Ct([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,o=this.R,i=t.lat*e,n=this.R_MINOR/o,s=Math.sqrt(1-n*n),r=s*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-r)/(1+r),s/2);return i=-o*Math.log(Math.max(a,1e-10)),new Mt(t.lng*e*o,i)},unproject:function(t){for(var e,o=180/Math.PI,i=this.R,n=this.R_MINOR/i,s=Math.sqrt(1-n*n),r=Math.exp(-t.y/i),a=Math.PI/2-2*Math.atan(r),l=0,h=.1;l<15&&Math.abs(h)>1e-7;l++)e=s*Math.sin(a),e=Math.pow((1-e)/(1+e),s/2),a+=h=Math.PI/2-2*Math.atan(r*e)-a;return new St(a*o,t.x*o/i)}},ni={__proto__:null,SphericalMercator:Ht},si=q({},At,{code:"EPSG:3395",projection:ii,transformation:function(){var t=.5/(Math.PI*ii.R);return zt(t,.5,-t,.5)}()}),ri=q({},At,{code:"EPSG:4326",projection:oi,transformation:zt(1/180,1,-1/180,.5)}),ai=q({},kt,{projection:oi,transformation:zt(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var o=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(o*o+i*i)},infinite:!0});kt.Earth=At,kt.EPSG3395=si,kt.EPSG3857=Zt,kt.EPSG900913=Kt,kt.EPSG4326=ri,kt.Simple=ai;var li=wt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[tt(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[tt(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var o=this.getEvents();e.on(o,this),this.once("remove",function(){e.off(o,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});So.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=tt(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=tt(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return tt(t)in this._layers},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},_addLayers:function(t){for(var e=0,o=(t=t?dt(t)?t:[t]:[]).length;e<o;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[tt(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=tt(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,o=this._getZoomSpan();for(var i in this._zoomBoundLayers){var n=this._zoomBoundLayers[i].options;t=void 0===n.minZoom?t:Math.min(t,n.minZoom),e=void 0===n.maxZoom?e:Math.max(e,n.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var hi=li.extend({initialize:function(t,e){var o,i;if(at(this,e),this._layers={},t)for(o=0,i=t.length;o<i;o++)this.addLayer(t[o])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,o,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)(o=this._layers[e])[t]&&o[t].apply(o,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return tt(t)}}),ci=hi.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),hi.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),hi.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new Ot;for(var e in this._layers){var o=this._layers[e];t.extend(o.getBounds?o.getBounds():o.getLatLng())}return t}}),di=Tt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){at(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var o=this._getIconUrl(t);if(!o){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(o,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(t,e){var o=this.options,i=o[e+"Size"];"number"==typeof i&&(i=[i,i]);var n=It(i),s=It("shadow"===e&&o.shadowAnchor||o.iconAnchor||n&&n.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(o.className||""),s&&(t.style.marginLeft=-s.x+"px",t.style.marginTop=-s.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Te.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),ui=di.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof ui.imagePath&&(ui.imagePath=this._detectIconPath()),(this.options.imagePath||ui.imagePath)+di.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,o){var i=e.exec(t);return i&&i[o]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=Ve("div","leaflet-default-icon-path",document.body),e=Ue(t,"background-image")||Ue(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}),mi=Ho.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new Fo(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Je(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&$e(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,o=e._map,i=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,s=so(e._icon),r=o.getPixelBounds(),a=o.getPixelOrigin(),l=Pt(r.min._subtract(a).add(n),r.max._subtract(a).subtract(n));if(!l.contains(s)){var h=It((Math.max(l.max.x,s.x)-l.max.x)/(r.max.x-l.max.x)-(Math.min(l.min.x,s.x)-l.min.x)/(r.min.x-l.min.x),(Math.max(l.max.y,s.y)-l.max.y)/(r.max.y-l.max.y)-(Math.min(l.min.y,s.y)-l.min.y)/(r.min.y-l.min.y)).multiplyBy(i);o.panBy(h,{animate:!1}),this._draggable._newPos._add(h),this._draggable._startPos._add(h),no(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=yt(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(bt(this._panRequest),this._panRequest=yt(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,o=e._shadow,i=so(e._icon),n=e._map.layerPointToLatLng(i);o&&no(o,i),e._latlng=n,t.latlng=n,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){bt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),pi=li.extend({options:{icon:new ui,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){at(this,e),this._latlng=Dt(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=Dt(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=t.icon.createIcon(this._icon),i=!1;o!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(o.title=t.title),"IMG"===o.tagName&&(o.alt=t.alt||"")),Je(o,e),t.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&mo(o,"focus",this._panOnFocus,this);var n=t.icon.createShadow(this._shadow),s=!1;n!==this._shadow&&(this._removeShadow(),s=!0),n&&(Je(n,e),n.alt=""),this._shadow=n,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&s&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&go(this._icon,"focus",this._panOnFocus,this),We(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&We(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&no(this._icon,t),this._shadow&&no(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(Je(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),mi)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new mi(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&eo(this._icon,t),this._shadow&&eo(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,o=e.iconSize?It(e.iconSize):It(0,0),i=e.iconAnchor?It(e.iconAnchor):It(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:o.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),gi=li.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return at(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),vi=gi.extend({options:{fill:!0,radius:10},initialize:function(t,e){at(this,e),this._latlng=Dt(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=Dt(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return gi.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,o=this._clickTolerance(),i=[t+o,e+o];this._pxBounds=new Ct(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),fi=vi.extend({initialize:function(t,e,o){if("number"==typeof e&&(e=q({},o,{radius:e})),at(this,e),this._latlng=Dt(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new Ot(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:gi.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,o=this._map,i=o.options.crs;if(i.distance===At.distance){var n=Math.PI/180,s=this._mRadius/At.R/n,r=o.project([e+s,t]),a=o.project([e-s,t]),l=r.add(a).divideBy(2),h=o.unproject(l).lat,c=Math.acos((Math.cos(s*n)-Math.sin(e*n)*Math.sin(h*n))/(Math.cos(e*n)*Math.cos(h*n)))/n;(isNaN(c)||0===c)&&(c=s/Math.cos(Math.PI/180*e)),this._point=l.subtract(o.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-o.project([h,t-c]).x,this._radiusY=l.y-r.y}else{var d=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(d).x}this._updateBounds()}}),_i=gi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){at(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,o,i=1/0,n=null,s=Jo,r=0,a=this._parts.length;r<a;r++)for(var l=this._parts[r],h=1,c=l.length;h<c;h++){var d=s(t,e=l[h-1],o=l[h],!0);d<i&&(i=d,n=s(t,e,o))}return n&&(n.distance=Math.sqrt(i)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ti(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=Dt(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new Ot,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return $o(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],o=$o(t),i=0,n=t.length;i<n;i++)o?(e[i]=Dt(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new Ct;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new Mt(t,t);this._rawPxBounds&&(this._pxBounds=new Ct([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,o){var i,n,s=t[0]instanceof St,r=t.length;if(s){for(n=[],i=0;i<r;i++)n[i]=this._map.latLngToLayerPoint(t[i]),o.extend(n[i]);e.push(n)}else for(i=0;i<r;i++)this._projectLatlngs(t[i],e,o)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,o,i,n,s,r,a,l=this._parts;for(e=0,i=0,n=this._rings.length;e<n;e++)for(o=0,s=(a=this._rings[e]).length;o<s-1;o++)(r=Xo(a[o],a[o+1],t,o,!0))&&(l[i]=l[i]||[],l[i].push(r[0]),r[1]===a[o+1]&&o!==s-2||(l[i].push(r[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,o=0,i=t.length;o<i;o++)t[o]=Uo(t[o],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var o,i,n,s,r,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,s=this._parts.length;o<s;o++)for(i=0,n=(r=(a=this._parts[o]).length)-1;i<r;n=i++)if((e||0!==i)&&Vo(t,a[n],a[i])<=l)return!0;return!1}});_i._flat=Qo;var yi=_i.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return function(t,e){var o,i,n,s,r,a,l,h,c;if(!t||0===t.length)throw new Error("latlngs not passed");$o(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var d=Dt([0,0]),u=Nt(t);u.getNorthWest().distanceTo(u.getSouthWest())*u.getNorthEast().distanceTo(u.getNorthWest())<1700&&(d=Ko(t));var m=t.length,p=[];for(o=0;o<m;o++){var g=Dt(t[o]);p.push(e.project(Dt([g.lat-d.lat,g.lng-d.lng])))}for(a=l=h=0,o=0,i=m-1;o<m;i=o++)n=p[o],s=p[i],r=n.y*s.x-s.y*n.x,l+=(n.x+s.x)*r,h+=(n.y+s.y)*r,a+=3*r;c=0===a?p[0]:[l/a,h/a];var v=e.unproject(It(c));return Dt([v.lat+d.lat,v.lng+d.lng])}(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=_i.prototype._convertLatLngs.call(this,t),o=e.length;return o>=2&&e[0]instanceof St&&e[0].equals(e[o-1])&&e.pop(),e},_setLatLngs:function(t){_i.prototype._setLatLngs.call(this,t),$o(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return $o(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,o=new Mt(e,e);if(t=new Ct(t.min.subtract(o),t.max.add(o)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,n=0,s=this._rings.length;n<s;n++)(i=Zo(this._rings[n],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,o,i,n,s,r,a,l,h=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,a=this._parts.length;n<a;n++)for(s=0,r=(l=(e=this._parts[n]).length)-1;s<l;r=s++)o=e[s],i=e[r],o.y>t.y!=i.y>t.y&&t.x<(i.x-o.x)*(t.y-o.y)/(i.y-o.y)+o.x&&(h=!h);return h||_i.prototype._containsPoint.call(this,t,!0)}}),bi=ci.extend({initialize:function(t,e){at(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,o,i,n=dt(t)?t:t.features;if(n){for(e=0,o=n.length;e<o;e++)((i=n[e]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var s=this.options;if(s.filter&&!s.filter(t))return this;var r=Li(t,s);return r?(r.feature=Ci(t),r.defaultOptions=r.options,this.resetStyle(r),s.onEachFeature&&s.onEachFeature(t,r),this.addLayer(r)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=q({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function Li(t,e){var o,i,n,s,r="Feature"===t.type?t.geometry:t,a=r?r.coordinates:null,l=[],h=e&&e.pointToLayer,c=e&&e.coordsToLatLng||Ei;if(!a&&!r)return null;switch(r.type){case"Point":return Ti(h,t,o=c(a),e);case"MultiPoint":for(n=0,s=a.length;n<s;n++)o=c(a[n]),l.push(Ti(h,t,o,e));return new ci(l);case"LineString":case"MultiLineString":return i=wi(a,"LineString"===r.type?0:1,c),new _i(i,e);case"Polygon":case"MultiPolygon":return i=wi(a,"Polygon"===r.type?1:2,c),new yi(i,e);case"GeometryCollection":for(n=0,s=r.geometries.length;n<s;n++){var d=Li({geometry:r.geometries[n],type:"Feature",properties:t.properties},e);d&&l.push(d)}return new ci(l);case"FeatureCollection":for(n=0,s=r.features.length;n<s;n++){var u=Li(r.features[n],e);u&&l.push(u)}return new ci(l);default:throw new Error("Invalid GeoJSON object.")}}function Ti(t,e,o,i){return t?t(e,o):new pi(o,i&&i.markersInheritOptions&&i)}function Ei(t){return new St(t[1],t[0],t[2])}function wi(t,e,o){for(var i,n=[],s=0,r=t.length;s<r;s++)i=e?wi(t[s],e-1,o):(o||Ei)(t[s]),n.push(i);return n}function Mi(t,e){return void 0!==(t=Dt(t)).alt?[nt(t.lng,e),nt(t.lat,e),nt(t.alt,e)]:[nt(t.lng,e),nt(t.lat,e)]}function xi(t,e,o,i){for(var n=[],s=0,r=t.length;s<r;s++)n.push(e?xi(t[s],$o(t[s])?0:e-1,o,i):Mi(t[s],i));return!e&&o&&n.length>0&&n.push(n[0].slice()),n}function Ii(t,e){return t.feature?q({},t.feature,{geometry:e}):Ci(e)}function Ci(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Pi={toGeoJSON:function(t){return Ii(this,{type:"Point",coordinates:Mi(this.getLatLng(),t)})}};pi.include(Pi),fi.include(Pi),vi.include(Pi),_i.include({toGeoJSON:function(t){var e=!$o(this._latlngs);return Ii(this,{type:(e?"Multi":"")+"LineString",coordinates:xi(this._latlngs,e?1:0,!1,t)})}}),yi.include({toGeoJSON:function(t){var e=!$o(this._latlngs),o=e&&!$o(this._latlngs[0]),i=xi(this._latlngs,o?2:e?1:0,!0,t);return e||(i=[i]),Ii(this,{type:(o?"Multi":"")+"Polygon",coordinates:i})}}),hi.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(o){e.push(o.toGeoJSON(t).geometry.coordinates)}),Ii(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var o="GeometryCollection"===e,i=[];return this.eachLayer(function(e){if(e.toGeoJSON){var n=e.toGeoJSON(t);if(o)i.push(n.geometry);else{var s=Ci(n);"FeatureCollection"===s.type?i.push.apply(i,s.features):i.push(s)}}}),o?Ii(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Oi=li.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,o){this._url=t,this._bounds=Nt(e),at(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Je(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){We(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&Ye(this._image),this},bringToBack:function(){return this._map&&Ge(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=Nt(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:Ve("img");Je(e,"leaflet-image-layer"),this._zoomAnimated&&Je(e,"leaflet-zoom-animated"),this.options.className&&Je(e,this.options.className),e.onselectstart=it,e.onmousemove=it,e.onload=$(this.fire,this,"load"),e.onerror=$(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;io(this._image,o,e)},_reset:function(){var t=this._image,e=new Ct(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=e.getSize();no(t,e.min),t.style.width=o.x+"px",t.style.height=o.y+"px"},_updateOpacity:function(){eo(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}});Oi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:Ve("video");if(Je(e,"leaflet-image-layer"),this._zoomAnimated&&Je(e,"leaflet-zoom-animated"),this.options.className&&Je(e,this.options.className),e.onselectstart=it,e.onmousemove=it,e.onloadeddata=$(this.fire,this,"load"),t){for(var o=e.getElementsByTagName("source"),i=[],n=0;n<o.length;n++)i.push(o[n].src);this._url=o.length>0?i:[e.src]}else{dt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var s=0;s<this._url.length;s++){var r=Ve("source");r.src=this._url[s],e.appendChild(r)}}}}),Oi.extend({_initImage:function(){var t=this._image=this._url;Je(t,"leaflet-image-layer"),this._zoomAnimated&&Je(t,"leaflet-zoom-animated"),this.options.className&&Je(t,this.options.className),t.onselectstart=it,t.onmousemove=it}});var Ni=li.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof St||dt(t))?(this._latlng=Dt(t),at(this,e)):(at(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&eo(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&eo(this._container,1),this.bringToFront(),this.options.interactive&&(Je(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(eo(this._container,0),this._removeTimeout=setTimeout($(We,void 0,this._container),200)):We(this._container),this.options.interactive&&($e(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=Dt(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ye(this._container),this},bringToBack:function(){return this._map&&Ge(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof ci){e=null;var o=this._source._layers;for(var i in o)if(o[i]._map){e=o[i];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=It(this.options.offset),o=this._getAnchor();this._zoomAnimated?no(this._container,t.add(o)):e=e.add(t).add(o);var i=this._containerBottom=-e.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});So.include({_initOverlay:function(t,e,o,i){var n=e;return n instanceof t||(n=new t(i).setContent(e)),o&&n.setLatLng(o),n}}),li.include({_initOverlay:function(t,e,o,i){var n=o;return n instanceof t?(at(n,i),n._source=this):(n=e&&!i?e:new t(i,this)).setContent(o),n}});var Si=Ni.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Ni.prototype.openOn.call(this,t)},onAdd:function(t){Ni.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof gi||this._source.on("preclick",bo))},onRemove:function(t){Ni.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof gi||this._source.off("preclick",bo))},getEvents:function(){var t=Ni.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=Ve("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=Ve("div",t+"-content-wrapper",e);if(this._contentNode=Ve("div",t+"-content",o),To(e),Lo(this._contentNode),mo(e,"contextmenu",bo),this._tipContainer=Ve("div",t+"-tip-container",e),this._tip=Ve("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=Ve("a",t+"-close-button",e);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',mo(i,"click",function(t){Eo(t),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var o=t.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),e.width=o+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,n=this.options.maxHeight,s="leaflet-popup-scrolled";n&&i>n?(e.height=n+"px",Je(t,s)):$e(t,s),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();no(this._container,e.add(o))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(Ue(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+e,i=this._containerWidth,n=new Mt(this._containerLeft,-o-this._containerBottom);n._add(so(this._container));var s=t.layerPointToContainerPoint(n),r=It(this.options.autoPanPadding),a=It(this.options.autoPanPaddingTopLeft||r),l=It(this.options.autoPanPaddingBottomRight||r),h=t.getSize(),c=0,d=0;s.x+i+l.x>h.x&&(c=s.x+i-h.x+l.x),s.x-c-a.x<0&&(c=s.x-a.x),s.y+o+l.y>h.y&&(d=s.y+o-h.y+l.y),s.y-d-a.y<0&&(d=s.y-a.y),(c||d)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([c,d]))}},_getAnchor:function(){return It(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});So.mergeOptions({closePopupOnClick:!0}),So.include({openPopup:function(t,e,o){return this._initOverlay(Si,t,e,o).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),li.include({bindPopup:function(t,e){return this._popup=this._initOverlay(Si,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof ci||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){wo(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof gi?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Di=Ni.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Ni.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Ni.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Ni.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ve("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+tt(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,o,i=this._map,n=this._container,s=i.latLngToContainerPoint(i.getCenter()),r=i.layerPointToContainerPoint(t),a=this.options.direction,l=n.offsetWidth,h=n.offsetHeight,c=It(this.options.offset),d=this._getAnchor();"top"===a?(e=l/2,o=h):"bottom"===a?(e=l/2,o=0):"center"===a?(e=l/2,o=h/2):"right"===a?(e=0,o=h/2):"left"===a?(e=l,o=h/2):r.x<s.x?(a="right",e=0,o=h/2):(a="left",e=l+2*(c.x+d.x),o=h/2),t=t.subtract(It(e,o,!0)).add(c).add(d),$e(n,"leaflet-tooltip-right"),$e(n,"leaflet-tooltip-left"),$e(n,"leaflet-tooltip-top"),$e(n,"leaflet-tooltip-bottom"),Je(n,"leaflet-tooltip-"+a),no(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&eo(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return It(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});So.include({openTooltip:function(t,e,o){return this._initOverlay(Di,t,e,o).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),li.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Di,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[e](o),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof ci||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(mo(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),mo(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)})}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,o,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),o=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(o)),this._tooltip.setLatLng(i)}});var ji=di.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),o=this.options;if(o.html instanceof Element?(Xe(e),e.appendChild(o.html)):e.innerHTML=!1!==o.html?o.html:"",o.bgPos){var i=It(o.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});di.Default=ui;var ki=li.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Te.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){at(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),We(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ye(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ge(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=et(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof Mt?t:new Mt(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,o=this.getPane().children,i=-t(-1/0,1/0),n=0,s=o.length;n<s;n++)e=o[n].style.zIndex,o[n]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Te.ielt9){eo(this._container,this.options.opacity);var t=+new Date,e=!1,o=!1;for(var i in this._tiles){var n=this._tiles[i];if(n.current&&n.loaded){var s=Math.min(1,(t-n.loaded)/200);eo(n.el,s),s<1?e=!0:(n.active?o=!0:this._onOpaqueTile(n),n.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),e&&(bt(this._fadeFrame),this._fadeFrame=yt(this._updateOpacity,this))}},_onOpaqueTile:it,_initContainer:function(){this._container||(this._container=Ve("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===t?(this._levels[o].el.style.zIndex=e-Math.abs(t-o),this._onUpdateLevel(o)):(We(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var i=this._levels[t],n=this._map;return i||((i=this._levels[t]={}).el=Ve("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=n.project(n.unproject(n.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,n.getCenter(),n.getZoom()),i.el.offsetWidth,this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:it,_onRemoveLevel:it,_onCreateLevel:it,_pruneTiles:function(){if(this._map){var t,e,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)We(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,o,i){var n=Math.floor(t/2),s=Math.floor(e/2),r=o-1,a=new Mt(+n,+s);a.z=+r;var l=this._tileCoordsToKey(a),h=this._tiles[l];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),r>i&&this._retainParent(n,s,r,i))},_retainChildren:function(t,e,o,i){for(var n=2*t;n<2*t+2;n++)for(var s=2*e;s<2*e+2;s++){var r=new Mt(n,s);r.z=o+1;var a=this._tileCoordsToKey(r),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),o+1<i&&this._retainChildren(n,s,o+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,o,i){var n=Math.round(e);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var s=this.options.updateWhenZooming&&n!==this._tileZoom;i&&!s||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(t),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var o in this._levels)this._setZoomTransform(this._levels[o],t,e)},_setZoomTransform:function(t,e,o){var i=this._map.getZoomScale(o,t.zoom),n=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,o)).round();Te.any3d?io(t.el,n,i):no(t.el,n)},_resetGrid:function(){var t=this._map,e=t.options.crs,o=this._tileSize=this.getTileSize(),i=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/o.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/o.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/o.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/o.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,o=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(o,this._tileZoom),n=e.project(t,this._tileZoom).floor(),s=e.getSize().divideBy(2*i);return new Ct(n.subtract(s),n.add(s))},_update:function(t){var e=this._map;if(e){var o=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(i),s=n.getCenter(),r=[],a=this.options.keepBuffer,l=new Ct(n.getBottomLeft().subtract([a,-a]),n.getTopRight().add([a,-a]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var h in this._tiles){var c=this._tiles[h].coords;c.z===this._tileZoom&&l.contains(new Mt(c.x,c.y))||(this._tiles[h].current=!1)}if(Math.abs(o-this._tileZoom)>1)this._setView(t,o);else{for(var d=n.min.y;d<=n.max.y;d++)for(var u=n.min.x;u<=n.max.x;u++){var m=new Mt(u,d);if(m.z=this._tileZoom,this._isValidTile(m)){var p=this._tiles[this._tileCoordsToKey(m)];p?p.current=!0:r.push(m)}}if(r.sort(function(t,e){return t.distanceTo(s)-e.distanceTo(s)}),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));var g=document.createDocumentFragment();for(u=0;u<r.length;u++)this._addTile(r[u],g);this._level.el.appendChild(g)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var o=this._globalTileRange;if(!e.wrapLng&&(t.x<o.min.x||t.x>o.max.x)||!e.wrapLat&&(t.y<o.min.y||t.y>o.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return Nt(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,o=this.getTileSize(),i=t.scaleBy(o),n=i.add(o);return[e.unproject(i,t.z),e.unproject(n,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),o=new Ot(e[0],e[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),o=new Mt(+e[0],+e[1]);return o.z=+e[2],o},_removeTile:function(t){var e=this._tiles[t];e&&(We(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){Je(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=it,t.onmousemove=it,Te.ielt9&&this.options.opacity<1&&eo(t,this.options.opacity)},_addTile:function(t,e){var o=this._getTilePos(t),i=this._tileCoordsToKey(t),n=this.createTile(this._wrapCoords(t),$(this._tileReady,this,t));this._initTile(n),this.createTile.length<2&&yt($(this._tileReady,this,t,null,n)),no(n,o),this._tiles[i]={el:n,coords:t,current:!0},e.appendChild(n),this.fire("tileloadstart",{tile:n,coords:t})},_tileReady:function(t,e,o){e&&this.fire("tileerror",{error:e,tile:o,coords:t});var i=this._tileCoordsToKey(t);(o=this._tiles[i])&&(o.loaded=+new Date,this._map._fadeAnimated?(eo(o.el,0),bt(this._fadeFrame),this._fadeFrame=yt(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),e||(Je(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Te.ielt9||!this._map._fadeAnimated?yt(this._pruneTiles,this):setTimeout($(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new Mt(this._wrapX?ot(t.x,this._wrapX):t.x,this._wrapY?ot(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new Ct(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),Ai=ki.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=at(this,e)).detectRetina&&Te.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var o=document.createElement("img");return mo(o,"load",$(this._tileOnLoad,this,e,o)),mo(o,"error",$(this._tileOnError,this,e,o)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(o.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(t),o},getTileUrl:function(t){var e={r:Te.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=o),e["-y"]=o}return ct(this._url,q(e,this.options))},_tileOnLoad:function(t,e){Te.ielt9?setTimeout($(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,o){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(o,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=it,e.onerror=it,!e.complete)){e.src=mt;var o=this._tiles[t].coords;We(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:o})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",mt),ki.prototype._removeTile.call(this,t)},_tileReady:function(t,e,o){if(this._map&&(!o||o.getAttribute("src")!==mt))return ki.prototype._tileReady.call(this,t,e,o)}}),Ri=Ai.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var o=q({},this.defaultWmsParams);for(var i in e)i in this.options||(o[i]=e[i]);var n=(e=at(this,e)).detectRetina&&Te.retina?2:1,s=this.getTileSize();o.width=s.x*n,o.height=s.y*n,this.wmsParams=o},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Ai.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),o=this._crs,i=Pt(o.project(e[0]),o.project(e[1])),n=i.min,s=i.max,r=(this._wmsVersion>=1.3&&this._crs===ri?[n.y,n.x,s.y,s.x]:[n.x,n.y,s.x,s.y]).join(","),a=Ai.prototype.getTileUrl.call(this,t);return a+lt(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+r},setParams:function(t,e){return q(this.wmsParams,t),e||this.redraw(),this}});Ai.WMS=Ri;var Hi=li.extend({options:{padding:.1},initialize:function(t){at(this,t),tt(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Je(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var o=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,e),s=i.multiplyBy(-o).add(n).subtract(this._map._getNewPixelOrigin(t,e));Te.any3d?io(this._container,s,o):no(this._container,s)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),o=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new Ct(o,o.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Bi=Hi.extend({options:{tolerance:0},getEvents:function(){var t=Hi.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Hi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");mo(t,"mousemove",this._onMouseMove,this),mo(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),mo(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){bt(this._redrawRequest),delete this._ctx,We(this._container),go(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Hi.prototype._update.call(this);var t=this._bounds,e=this._container,o=t.getSize(),i=Te.retina?2:1;no(e,t.min),e.width=i*o.x,e.height=i*o.y,e.style.width=o.x+"px",e.style.height=o.y+"px",Te.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Hi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[tt(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,o=e.next,i=e.prev;o?o.prev=i:this._drawLast=i,i?i.next=o:this._drawFirst=o,delete t._order,delete this._layers[tt(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,o,i=t.options.dashArray.split(/[, ]+/),n=[];for(o=0;o<i.length;o++){if(e=Number(i[o]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||yt(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ct,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var o=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var o,i,n,s,r=t._parts,a=r.length,l=this._ctx;if(a){for(l.beginPath(),o=0;o<a;o++){for(i=0,n=r[o].length;i<n;i++)s=r[o][i],l[i?"lineTo":"moveTo"](s.x,s.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,o=this._ctx,i=Math.max(Math.round(t._radius),1),n=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==n&&(o.save(),o.scale(1,n)),o.beginPath(),o.arc(e.x,e.y/n,i,0,2*Math.PI,!1),1!==n&&o.restore(),this._fillStroke(o,t)}},_fillStroke:function(t,e){var o=e.options;o.fill&&(t.globalAlpha=o.fillOpacity,t.fillStyle=o.fillColor||o.color,t.fill(o.fillRule||"evenodd")),o.stroke&&0!==o.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=o.opacity,t.lineWidth=o.weight,t.strokeStyle=o.color,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.stroke())},_onClick:function(t){for(var e,o,i=this._map.mouseEventToLayerPoint(t),n=this._drawFirst;n;n=n.next)(e=n.layer).options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(o=e);this._fireEvent(!!o&&[o],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&($e(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var o,i,n=this._drawFirst;n;n=n.next)(o=n.layer).options.interactive&&o._containsPoint(e)&&(i=o);i!==this._hoveredLayer&&(this._handleMouseOut(t),i&&(Je(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout($(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,o){this._map._fireDOMEvent(e,o||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;o&&(o.prev=i,i?i.next=o:o&&(this._drawFirst=o),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;i&&(i.next=o,o?o.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});var zi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Fi={_initContainer:function(){this._container=Ve("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Hi.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=zi("shape");Je(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=zi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[tt(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;We(e),t.removeInteractiveTarget(e),delete this._layers[tt(t)]},_updateStyle:function(t){var e=t._stroke,o=t._fill,i=t.options,n=t._container;n.stroked=!!i.stroke,n.filled=!!i.fill,i.stroke?(e||(e=t._stroke=zi("stroke")),n.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=dt(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(n.removeChild(e),t._stroke=null),i.fill?(o||(o=t._fill=zi("fill")),n.appendChild(o),o.color=i.fillColor||i.color,o.opacity=i.fillOpacity):o&&(n.removeChild(o),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),o=Math.round(t._radius),i=Math.round(t._radiusY||o);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+o+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){Ye(t._container)},_bringToBack:function(t){Ge(t._container)}},Zi=Te.vml?zi:Ut,Ki=Hi.extend({_initContainer:function(){this._container=Zi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Zi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){We(this._container),go(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Hi.prototype._update.call(this);var t=this._bounds,e=t.getSize(),o=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,o.setAttribute("width",e.x),o.setAttribute("height",e.y)),no(o,t.min),o.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Zi("path");t.options.className&&Je(e,t.options.className),t.options.interactive&&Je(e,"leaflet-interactive"),this._updateStyle(t),this._layers[tt(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){We(t._path),t.removeInteractiveTarget(t._path),delete this._layers[tt(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,o=t.options;e&&(o.stroke?(e.setAttribute("stroke",o.color),e.setAttribute("stroke-opacity",o.opacity),e.setAttribute("stroke-width",o.weight),e.setAttribute("stroke-linecap",o.lineCap),e.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?e.setAttribute("stroke-dasharray",o.dashArray):e.removeAttribute("stroke-dasharray"),o.dashOffset?e.setAttribute("stroke-dashoffset",o.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),o.fill?(e.setAttribute("fill",o.fillColor||o.color),e.setAttribute("fill-opacity",o.fillOpacity),e.setAttribute("fill-rule",o.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,Vt(t._parts,e))},_updateCircle:function(t){var e=t._point,o=Math.max(Math.round(t._radius),1),i="a"+o+","+(Math.max(Math.round(t._radiusY),1)||o)+" 0 1,0 ",n=t._empty()?"M0 0":"M"+(e.x-o)+","+e.y+i+2*o+",0 "+i+2*-o+",0 ";this._setPath(t,n)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){Ye(t._path)},_bringToBack:function(t){Ge(t._path)}});Te.vml&&Ki.include(Fi),So.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&function(t){return Te.canvas?new Bi(t):null}(t)||function(t){return Te.svg||Te.vml?new Ki(t):null}(t)}});var Ui=yi.extend({initialize:function(t,e){yi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=Nt(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});Ki.create=Zi,Ki.pointsToPath=Vt,bi.geometryToLayer=Li,bi.coordsToLatLng=Ei,bi.coordsToLatLngs=wi,bi.latLngToCoords=Mi,bi.latLngsToCoords=xi,bi.getFeature=Ii,bi.asFeature=Ci,So.mergeOptions({boxZoom:!0});var Vi=Ho.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){mo(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){go(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){We(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Ae(),ao(),this._startPoint=this._map.mouseEventToContainerPoint(t),mo(document,{contextmenu:wo,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Ve("div","leaflet-zoom-box",this._container),Je(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new Ct(this._point,this._startPoint),o=e.getSize();no(this._box,e.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(We(this._box),$e(this._container,"leaflet-crosshair")),Re(),lo(),go(document,{contextmenu:wo,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout($(this._resetState,this),0);var e=new Ot(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});So.addInitHook("addHandler","boxZoom",Vi),So.mergeOptions({doubleClickZoom:!0});var Wi=Ho.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,o=e.getZoom(),i=e.options.zoomDelta,n=t.originalEvent.shiftKey?o-i:o+i;"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}});So.addInitHook("addHandler","doubleClickZoom",Wi),So.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Xi=Ho.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new Fo(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}Je(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){$e(this._map._container,"leaflet-grab"),$e(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=Nt(this._map.options.maxBounds);this._offsetLimit=Pt(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),o=this._initialWorldOffset,i=this._draggable._newPos.x,n=(i-e+o)%t+e-o,s=(i+e+o)%t-e-o,r=Math.abs(n+o)<Math.abs(s+o)?n:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,o=e.options,i=!o.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),s=(this._lastTime-this._times[0])/1e3,r=o.easeLinearity,a=n.multiplyBy(r/s),l=a.distanceTo([0,0]),h=Math.min(o.inertiaMaxSpeed,l),c=a.multiplyBy(h/l),d=h/(o.inertiaDeceleration*r),u=c.multiplyBy(-d/2).round();u.x||u.y?(u=e._limitOffset(u,e.options.maxBounds),yt(function(){e.panBy(u,{duration:d,easeLinearity:r,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});So.addInitHook("addHandler","dragging",Xi),So.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Yi=Ho.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),mo(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),go(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,o=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,o,i=this._panKeys={},n=this.keyCodes;for(e=0,o=n.left.length;e<o;e++)i[n.left[e]]=[-1*t,0];for(e=0,o=n.right.length;e<o;e++)i[n.right[e]]=[t,0];for(e=0,o=n.down.length;e<o;e++)i[n.down[e]]=[0,t];for(e=0,o=n.up.length;e<o;e++)i[n.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,o,i=this._zoomKeys={},n=this.keyCodes;for(e=0,o=n.zoomIn.length;e<o;e++)i[n.zoomIn[e]]=t;for(e=0,o=n.zoomOut.length;e<o;e++)i[n.zoomOut[e]]=-t},_addHooks:function(){mo(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){go(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,o=t.keyCode,i=this._map;if(o in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(e=this._panKeys[o],t.shiftKey&&(e=It(e).multiplyBy(3)),i.options.maxBounds&&(e=i._limitOffset(It(e),i.options.maxBounds)),i.options.worldCopyJump){var n=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(e)));i.panTo(n)}else i.panBy(e)}else if(o in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[o]);else{if(27!==o||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}wo(t)}}});So.addInitHook("addHandler","keyboard",Yi),So.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Gi=Ho.extend({addHooks:function(){mo(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){go(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Co(t),o=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout($(this._performZoom,this),i),wo(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),o=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,s=o?Math.ceil(n/o)*o:n,r=t._limitZoom(e+(this._delta>0?s:-s))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}});So.addInitHook("addHandler","scrollWheelZoom",Gi);So.mergeOptions({tapHold:Te.touchNative&&Te.safari&&Te.mobile,tapTolerance:15});var qi=Ho.extend({addHooks:function(){mo(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){go(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new Mt(e.clientX,e.clientY),this._holdTimeout=setTimeout($(function(){this._cancel(),this._isTapValid()&&(mo(document,"touchend",Eo),mo(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),600),mo(document,"touchend touchcancel contextmenu",this._cancel,this),mo(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){go(document,"touchend",Eo),go(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),go(document,"touchend touchcancel contextmenu",this._cancel,this),go(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new Mt(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var o=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});o._simulated=!0,e.target.dispatchEvent(o)}});So.addInitHook("addHandler","tapHold",qi),So.mergeOptions({touchZoom:Te.touch,bounceAtZoomLimits:!0});var Ji=Ho.extend({addHooks:function(){Je(this._map._container,"leaflet-touch-zoom"),mo(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){$e(this._map._container,"leaflet-touch-zoom"),go(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(o.add(i)._divideBy(2))),this._startDist=o.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),mo(document,"touchmove",this._onTouchMove,this),mo(document,"touchend touchcancel",this._onTouchEnd,this),Eo(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]),n=o.distanceTo(i)/this._startDist;if(this._zoom=e.getScaleZoom(n,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&n<1||this._zoom>e.getMaxZoom()&&n>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===n)return}else{var s=o._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===n&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),bt(this._animRequest);var r=$(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=yt(r,this,!0),Eo(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,bt(this._animRequest),go(document,"touchmove",this._onTouchMove,this),go(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});So.addInitHook("addHandler","touchZoom",Ji),So.BoxZoom=Vi,So.DoubleClickZoom=Wi,So.Drag=Xi,So.Keyboard=Yi,So.ScrollWheelZoom=Gi,So.TapHold=qi,So.TouchZoom=Ji;class $i{constructor(){Object.freeze(this)}handleEvent(t){if(!t.target.classList.contains("travelnotes-background"))return;let e=U.map.getZoom()+(0>t.deltaY?1:-1);e=Math.min(U.map.getMaxZoom(),e),e=Math.max(U.map.getMinZoom(),e),U.map.setZoomAround(new Mt(t.clientX,t.clientY),e)}}class Qi{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault()}}class tn{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){t.preventDefault(),Number.parseInt(t.dataTransfer.getData("ObjId"))===this.#Vt.objId&&(t.stopPropagation(),this.#Vt.moveDialog(t))}}class en{#G;#q;constructor(t,e){Object.freeze(this),this.#G=t,this.#q=e}static clone(t){return new en(t.lat,t.lng)}get latLng(){return[this.#G,this.#q]}get lat(){return this.#G}get lng(){return this.#q}}class on extends en{#J;constructor(t,e,o){super(t,e),this.#J=o}get distance(){return this.#J}}class nn extends on{#$;#nt;constructor(t,e,o,i,n){super(t,e,o),this.#$=i,this.#nt=n}get elev(){return this.#$}get ascent(){return this.#nt}}class sn{static get#Wt(){return 100}constructor(){Object.freeze(this)}getLatLngElevAtDist(t,e){if(t.distance<=e||0>=e)return null;let o=0;const i=t.itinerary.itineraryPoints.iterator;for(;o<e&&!i.done;)o+=i.value.distance;const n=i.value;i.done;const s=(n.distance-o+e)/n.distance;return new nn(n.lat+(i.value.lat-n.lat)*s,n.lng+(i.value.lng-n.lng)*s,e,n.elev+(i.value.elev-n.elev)*s,sn.#Wt*(i.value.elev-n.elev)/n.distance)}getClosestLatLngDistance(t,e){if(0===t.itinerary.itineraryPoints.length)return null;const i=t.itinerary.itineraryPoints.iterator;i.done;let n=Number.MAX_VALUE;const s=ni.SphericalMercator.project(new St(e[0],e[1]));let r=ni.SphericalMercator.project(new St(i.value.lat,i.value.lng)),a=null,l=o.defaultValue,h=i.value.distance;for(;!i.done;){const t=ni.SphericalMercator.project(new St(i.value.lat,i.value.lng));let e=ei.pointToSegmentDistance(s,r,t);e<n&&(n=e,a=ni.SphericalMercator.unproject(ei.closestPointOnSegment(s,r,t)),l=h-a.distanceTo(new St(i.value.lat,i.value.lng))),h+=i.value.distance,r=t}return new on(a.lat,a.lng,l)}getLatLngBounds(t){const e=new St(a.maxLat,a.maxLng),o=new St(a.minLat,a.minLng);return t.forEach(t=>{e.lat=Math.min(e.lat,t[0]),e.lng=Math.min(e.lng,t[1]),o.lat=Math.max(o.lat,t[0]),o.lng=Math.max(o.lng,t[1])}),new Ot(e,o)}getSquareBoundingBox(t,o){const i=t[0]*e.toRadians,n=o/u*e.fromRadians,s=Math.acos((Math.cos(o/u)-Math.sin(i)**2)/Math.cos(i)**2)*e.fromRadians;return new Ot(new St(t[0]-n,t[1]-s),new St(t[0]+n,t[1]+s))}project(t,e){const o=U.map.project(new St(t[0],t[1]),e);return[o.x,o.y]}screenCoordToLatLng(t,e){const o=U.map.containerPointToLatLng(new Mt(t,e));return[o.lat,o.lng]}addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}subtrackPoints(t,e){return[t[0]-e[0],t[1]-e[1]]}}const rn=new sn;class an{#Kt;#Xt=!1;#Yt=!1;#Gt=0;#qt=0;#Jt;#$t;#Qt;#te;#ee(e){if(this.#Xt&&(this.#Gt!==e.screenX||this.#qt!==e.screenY)){t.baseDialog.cancelTouchY>this.#qt&&e.screenY<this.#qt&&t.baseDialog.cancelTouchX>this.#Gt&&this.#Kt.onCancel();const o=rn.screenCoordToLatLng(this.#Gt,this.#qt),i=rn.screenCoordToLatLng(e.screenX,e.screenY);U.map.panTo([this.#Jt.lat+o[0]-i[0],this.#Jt.lng+o[1]-i[1]])}}#oe(e){let o=Math.sqrt((e.item(0).clientX-e.item(1).clientX)**2+(e.item(0).clientY-e.item(1).clientY)**2),i=this.#$t,n=o-this.#Qt;t.baseDialog.deltaZoomDistance<n?i++:-t.baseDialog.deltaZoomDistance>n&&i--,i=Math.min(U.map.getMaxZoom(),i),i=Math.max(U.map.getMinZoom(),i),i!==this.#$t&&(U.map.setZoomAround(this.#te,i),this.#$t=i,this.#Qt=o)}#ie(t){this.#Xt&&1===t.changedTouches.length&&(this.#ee(t.changedTouches.item(0)),this.#Xt=!1)}#ne(t){this.#Xt&&1===t.changedTouches.length?this.#ee(t.changedTouches.item(0)):this.#Yt&&2===t.targetTouches.length&&this.#oe(t.targetTouches)}#se(t){if(1===t.targetTouches.length){const e=t.changedTouches.item(0);this.#Gt=e.screenX,this.#qt=e.screenY,this.#Jt=U.map.getCenter(),this.#Xt=!0,this.#Yt=!1}2===t.targetTouches.length&&(this.#$t=U.map.getZoom(),this.#te=new Mt((t.targetTouches.item(0).clientX+t.targetTouches.item(1).clientX)/2,(t.targetTouches.item(0).clientY+t.targetTouches.item(1).clientY)/2),this.#Qt=Math.sqrt((t.targetTouches.item(0).clientX-t.targetTouches.item(1).clientX)**2+(t.targetTouches.item(0).clientY-t.targetTouches.item(1).clientY)**2),this.#Xt=!1,this.#Yt=!0)}constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(t){switch(t.currentTarget===t.target&&t.preventDefault(),t.type){case"touchstart":t.currentTarget===t.target&&this.#se(t);break;case"touchmove":this.#ne(t);break;case"touchend":this.#ie(t)}}}class ln{static get LEFT_BUTTON(){return 0}#Xt=!1;#Gt=0;#qt=0;#Jt;#ee(t){const e=rn.screenCoordToLatLng(this.#Gt,this.#qt),o=rn.screenCoordToLatLng(t.screenX,t.screenY);U.map.panTo([this.#Jt.lat+e[0]-o[0],this.#Jt.lng+e[1]-o[1]])}constructor(){Object.freeze(this)}handleEvent(t){switch(t.type){case"mousedown":t.button===ln.LEFT_BUTTON&&t.target===t.currentTarget&&(this.#Gt=t.screenX,this.#qt=t.screenY,this.#Jt=U.map.getCenter(),this.#Xt=!0);break;case"mousemove":t.button===ln.LEFT_BUTTON&&this.#Xt&&(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),this.#ee(t));break;case"mouseup":t.button!==ln.LEFT_BUTTON||!this.#Xt||this.#Gt===t.screenX&&this.#qt===t.screenY||this.#ee(t),this.#Xt=!1}}}let hn=class{#re=null;#ae=null;#le=null;#he=null;#ce=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#re=t.firstButtonText;break;case"secondButtonText":this.#ae=t.secondButtonText;break;case"selectOptionsData":this.#le=t.selectOptionsData;break;case"title":this.#he=t.title;break;case"text":this.#ce=t.text}}get firstButtonText(){return this.#re}get secondButtonText(){return this.#ae}get selectOptionsData(){return this.#le}get title(){return this.#he}get text(){return this.#ce}},cn=class{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){this.#Vt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Vt.objId)}},dn=class{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){this.#Vt.moveDialog(t)}},un=class{#Vt;#de;constructor(t){Object.freeze(this),this.#Vt=t,this.#de=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#de=!0,this.#Vt.setDragStartPoint(o);break;case"touchmove":this.#de=!1,t.preventDefault(),this.#Vt.moveDialog(o,e);break;case"touchend":this.#de||this.#Vt.moveDialog(o,e)}}}};class mn{static#ue;static#me(){mn.#ue=!0,document.removeEventListener("touchstart",mn.#me,!0)}constructor(){Object.freeze(this),mn.#ue=!1,document.addEventListener("touchstart",mn.#me,!0)}get isTouch(){return mn.#ue}get screenAvailable(){const t=document.createElement("div");t.style.position="absolute",t.style.bottom=0,t.style.right=0,t.style.height=1,t.style.width=1,document.body.appendChild(t);const e=t.getBoundingClientRect(),o=e.bottom,i=e.right;return document.body.removeChild(t),Object.freeze({height:o,width:i})}}const pn=new mn;let gn=class{#t;#pe;#ge;#ve;#fe;#_e(t,e){const o=pn.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-d,n=o.height-this.dialogHTMLElement.offsetHeight-d;this.#ve=Math.max(Math.min(t,i),d),this.#fe=Math.max(Math.min(e,n),d)}#ye(){this.dialogHTMLElement.style.left=String(this.#ve)+"px",this.dialogHTMLElement.style.top=String(this.#fe)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#ve=d,this.#fe=d,this.#pe=0,this.#ge=0,this.#t=b.nextObjId}get onTop(){return 42>this.#fe}get objId(){return this.#t}centerDialog(){const e=pn.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(e.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(e.width-80,800))+"px",this.#ve=(e.width-this.dialogHTMLElement.clientWidth)/2,t.baseDialog.touchTopScreen&&pn.isTouch?this.#fe=d:this.#fe=(e.height-this.dialogHTMLElement.clientHeight)/2,this.#ye()}moveDialog(t,e){const o=this.#ve+t.screenX-this.#pe,i=this.#fe+t.screenY-this.#ge;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#_e(t,e),this.#ye()}moveDialogToLastPosition(){this.moveDialogTo(this.#ve,this.#fe)}moveDialogToTopLeft(){this.#ve=d,this.#fe=d,this.#ye()}setDragStartPoint(t){this.#pe=t.screenX,this.#ge=t.screenY}},vn=class{#be;#Le;#Te;#Ee;#we;#Me;#xe;#Ie;#Ce;#Pe=null;#Oe(){this.#be=W.create("div",{className:"travelnotes-base-dialog-dialog-container"}),this.mover.dialogHTMLElement=this.#be}#Ne(){this.#Le=W.create("div",{className:"travelnotes-base-dialog-top-bar",draggable:!0},this.#be),this.#Ie=new un(this.mover),this.#Le.addEventListener("touchstart",this.#Ie,!1),this.#Le.addEventListener("touchmove",this.#Ie,!1),this.#Le.addEventListener("touchend",this.#Ie,!1),this.#Le.addEventListener("touchcancel",this.#Ie,!1),this.#Me=new cn(this.mover),this.#Le.addEventListener("dragstart",this.#Me,!1),this.#xe=new dn(this.mover),this.#Le.addEventListener("dragend",this.#xe,!1),this.#Te=W.create("div",{textContent:"âŒ",className:"travelnotes-base-dialog-cancel-button",title:S.getText("BaseDialog - Cancel")},this.#Le),W.create("div",{textContent:this.title,className:"travelnotes-base-dialog-title"},this.#Le),this.#Ce=new X(this),this.#Te.addEventListener("click",this.#Ce,!1),this.mover.topBarHTMLElement=this.#Le}#Se(){this.toolbarHTMLElement&&W.create("div",{className:"travelnotes-base-dialog-toolbar-container"},this.#be).appendChild(this.toolbarHTMLElement)}#De(){this.#Ee=W.create("div",{className:"travelnotes-base-dialog-content-container"},this.#be),this.contentHTMLElements.forEach(t=>this.#Ee.appendChild(t))}#je(){this.#Oe(),this.#Ne(),this.#Se(),this.#De()}constructor(t){Object.freeze(this),this.#Pe=new hn(t)}#ke(){this.#Le.removeEventListener("dragstart",this.#Me,!1),this.#Me=null,this.#Le.removeEventListener("dragend",this.#xe,!1),this.#xe=null,this.#Le.removeEventListener("touchstart",this.#Ie,!1),this.#Le.removeEventListener("touchmove",this.#Ie,!1),this.#Le.removeEventListener("touchend",this.#Ie,!1),this.#Le.removeEventListener("touchcancel",this.#Ie,!1),this.#Ie=null,this.#Te.removeEventListener("click",this.#Ce,!1),this.#Ce=null,this.#we&&(this.#we=null)}get mover(){return this.#we?this.#we:this.#we=new gn}onCancel(){this.#ke()}onOk(){this.#ke()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#je()}removeFromBackground(t){t.removeChild(this.#be)}addToBackground(t){t.appendChild(this.#be)}addToDialog(t){this.#be.appendChild(t)}get options(){return this.#Pe}addCssClass(t){this.#be.classList.add(t)}};class fn extends vn{#Ae;#Re;#He;#Be;#ze;#Fe;#Ze;#Ce;#Ke;#Ue;#Ve;#We;#Xe;#Ye;#Ge;#qe;#Je(){this.#Ae=W.create("div",{className:"travelnotes-background"})}#$e(){this.#We=new tn(this.mover),this.#Ae.addEventListener("dragover",this.#We,!1),this.#Ge=new $i,this.#Ae.addEventListener("wheel",this.#Ge,{passive:!0}),this.#qe=new Qi,this.#Ae.addEventListener("contextmenu",this.#qe,!1),this.#Xe=new an(this),this.#Ae.addEventListener("touchstart",this.#Xe,!1),this.#Ae.addEventListener("touchmove",this.#Xe,!1),this.#Ae.addEventListener("touchend",this.#Xe,!1),this.#Ae.addEventListener("touchcancel",this.#Xe,!1),this.#Ye=new ln,this.#Ae.addEventListener("mouseup",this.#Ye,!1),this.#Ae.addEventListener("mousemove",this.#Ye,!1),this.#Ae.addEventListener("mousedown",this.#Ye,!1)}#Qe(){this.#Re=W.create("div",{className:"travelnotes-modal-base-dialog-error-container travelnotes-hidden"}),this.addToDialog(this.#Re)}#to(){W.create("div",{className:"travelnotes-wait-animation-bullet"},W.create("div",{className:"travelnotes-wait-animation"},this.#He=W.create("div",{className:"travelnotes-modal-base-dialog-wait-container travelnotes-hidden"}))),this.addToDialog(this.#He)}#eo(){const t=W.create("div",{className:"travelnotes-modal-base-dialog-footer-container"});this.addToDialog(t),this.#ze=W.create("div",{textContent:this.options.firstButtonText||"ðŸ†—",className:"travelnotes-base-dialog-button"},t),this.#Ze=new G(this),this.#ze.addEventListener("click",this.#Ze,!1),this.options.secondButtonText?(this.#Fe=W.create("div",{textContent:this.options.secondButtonText,className:"travelnotes-base-dialog-button"},t),this.#Ce=new X(this),this.#Fe.addEventListener("click",this.#Ce,!1)):this.#Fe=null,this.footerHTMLElements.forEach(e=>t.appendChild(e))}#je(){this.#Je(),this.#$e(),this.#Qe(),this.#to(),this.#eo()}#ke(){this.#Ae.removeEventListener("wheel",this.#Ge,{passive:!0}),this.#Ge=null,this.#Ae.removeEventListener("contextmenu",this.#qe,!1),this.#qe=null,this.#Ae.removeEventListener("dragover",this.#We,!1),this.#We=null,this.#Ae.removeEventListener("touchstart",this.#Xe,!1),this.#Ae.removeEventListener("touchmove",this.#Xe,!1),this.#Ae.removeEventListener("touchend",this.#Xe,!1),this.#Ae.removeEventListener("touchcancel",this.#Xe,!1),this.#Xe=null,this.#Ae.removeEventListener("mouseup",this.#Ye,!1),this.#Ae.removeEventListener("mousemove",this.#Ye,!1),this.#Ae.removeEventListener("mousedown",this.#Ye,!1),this.#Ye=null,document.removeEventListener("keydown",this.#Ve,{capture:!0}),this.#Ve=null,this.#ze.removeEventListener("click",this.#Ze,!1),this.#Ze=null,this.options.secondButtonText&&(this.#Fe.removeEventListener("click",this.#Ce,!1),this.#Ce=null),document.body.removeChild(this.#Ae)}#oo(t,e){this.#Ke=t,this.#Ue=e}constructor(t){super(t),this.#Be=!0}show(){return super.show(),this.#je(),this.addCssClass("travelnotes-modal-base-dialog"),document.body.appendChild(this.#Ae),this.addToBackground(this.#Ae),this.#Ve=new Y(this),document.addEventListener("keydown",this.#Ve,{capture:!0}),this.mover.centerDialog(),new Promise((t,e)=>this.#oo(t,e))}onCancel(){this.#ke(),super.onCancel(),this.#Ue("Canceled by user")}canClose(){return!0}onOk(t){return!!this.canClose()&&(this.#Ke(t),this.#ke(),super.onOk(),!0)}showWait(){this.#He.classList.remove("travelnotes-hidden"),this.#ze.classList.add("travelnotes-hidden")}hideWait(){this.#He.classList.add("travelnotes-hidden"),this.#ze.classList.remove("travelnotes-hidden")}showError(t){this.#Re.textContent="",N.sanitizeToHtmlElement(t,this.#Re),this.#Re.classList.remove("travelnotes-hidden")}hideError(){this.#Re.textContent="",this.#Re.classList.add("travelnotes-hidden")}get footerHTMLElements(){return[]}get keyboardELEnabled(){return this.#Be}set keyboardELEnabled(t){this.#Be=t}}class _n{#io;constructor(t){Object.freeze(this),this.#io=t}destructor(){this.#io=null}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{this.#io.addApiKeys(JSON.parse(e.result))}catch(t){this.#io.showError(t.message),t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class yn{#io;#no;constructor(t){Object.freeze(this),this.#io=t,this.#no=new _n(this.#io)}destructor(){this.#io=null,this.#no.destructor()}handleEvent(t){t.stopPropagation(),this.#io.hideError(),D.openFile(this.#no,".json")}}class bn{#so;constructor(){Object.freeze(this),this.#so=W.create("div",{className:"travelnotes-base-dialog-data-container"})}get controlHTMLElement(){return this.#so}}class Ln{#ro=null;constructor(t){Object.freeze(this),this.#ro=t}handleEvent(t){t.currentTarget.textContent="ðŸ‘€",t.preventDefault(),t.stopPropagation(),this.#ro.type="text"}}class Tn{#ro;constructor(t){Object.freeze(this),this.#ro=t}handleEvent(t){t.currentTarget.textContent="ðŸ‘ï¸",t.preventDefault(),t.stopPropagation(),this.#ro.type="password",this.#ro.focus()}}class En extends bn{#ro;#ao;#lo;#ho;constructor(t){super(),this.#ro=W.create("input",{type:"password",dataset:{Name:t?.datasetName||"PasswordControl"}},this.controlHTMLElement),this.#ao=W.create("span",{id:"travelnotes-password-control-eye",textContent:"ðŸ‘ï¸"},this.controlHTMLElement),this.#lo=new Ln(this.#ro),this.#ho=new Tn(this.#ro),this.#ao.addEventListener("mousedown",this.#lo,!1),this.#ao.addEventListener("touchstart",this.#lo,!1),this.#ao.addEventListener("mouseup",this.#ho,!1),this.#ao.addEventListener("mouseleave",this.#ho,!1),this.#ao.addEventListener("touchend",this.#ho,!1),this.#ro.focus()}destructor(){this.#ao.removeEventListener("mousedown",this.#lo,!1),this.#ao.removeEventListener("touchstart",this.#lo,!1),this.#ao.removeEventListener("mouseup",this.#ho,!1),this.#ao.removeEventListener("mouseleave",this.#ho,!1),this.#ao.removeEventListener("touchend",this.#ho,!1),this.#lo=null,this.#ho=null}get value(){return this.#ro.value}focus(){this.#ro.focus()}}class wn extends fn{#co;#do;static get#uo(){return 12}constructor(t){super(),this.#do=t}#ke(){this.#co.destructor()}createContentHTML(){this.#co=new En}show(){const t=super.show();return this.#co.focus(),t}canClose(){return this.hideError(),!(this.#do&&(this.#co.value.length<wn.#uo||!this.#co.value.match(/[0-9]+/)||!this.#co.value.match(/[a-z]+/)||!this.#co.value.match(/[A-Z]+/)||!this.#co.value.match(/[^0-9a-zA-Z]/)))||(this.showError("<p>"+S.getText("PasswordDialog - Password rules1")+"</p><ul><li>"+S.getText("PasswordDialog - Password rules2")+"</li><li>"+S.getText("PasswordDialog - Password rules3")+"</li><li>"+S.getText("PasswordDialog - Password rules4")+"</li><li>"+S.getText("PasswordDialog - Password rules5")+"</li><li>"+S.getText("PasswordDialog - Password rules6")+"</li></ul>"),this.#co.focus(),!1)}onCancel(){this.#ke(),super.onCancel()}onOk(){super.onOk((new window.TextEncoder).encode(this.#co.value))&&this.#ke()}get contentHTMLElements(){return[this.#co.controlHTMLElement]}get title(){return S.getText("PasswordDialog - password")}}class Mn{#mo;#po(t){return window.crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"])}#go(t,e){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode(e),iterations:1e6,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}#vo(t,e){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(e.slice(0,16))},t,new Uint8Array(e.slice(16)))}#fo(t,e,o){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,o)}constructor(t){this.#mo=t||"Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette.",Object.freeze(this)}encryptData(t,e,o,i){let n=window.crypto.getRandomValues(new Uint8Array(16));i.then(t=>this.#po(t)).then(t=>this.#go(t,this.#mo)).then(e=>this.#fo(e,n,t)).then(t=>{e(new Blob([n,new Uint8Array(t)],{type:"application/octet-stream"}))}).catch(o)}decryptData(t,e,o,i){i.then(t=>this.#po(t)).then(t=>this.#go(t,this.#mo)).then(e=>this.#vo(e,t)).then(e).catch(o)}}class xn{#_o;constructor(t){this.#_o=t,Object.freeze(this)}destructor(){this.#_o=null}onErrorDecrypt(t){this.#_o.hideWait(),this.#_o.keyboardELEnabled=!0,t&&"Canceled by user"!==t&&this.#_o.showError(S.getText("DataEncryptorHandlers - An error occurs when reading the file"))}onOkDecrypt(t){try{this.#_o.addApiKeys(JSON.parse((new TextDecoder).decode(t)))}catch(t){return void this.onErrorDecrypt(t)}this.#_o.hideWait(),this.#_o.hideError(),this.#_o.keyboardELEnabled=!0}onOkEncrypt(t){this.#_o.hideError(),this.#_o.hideWait(),D.saveFile("ApiKeys",t),this.#_o.keyboardELEnabled=!0}onErrorEncrypt(){this.#_o.showError(S.getText("DataEncryptorHandlers - An error occurs when saving the keys")),this.#_o.hideWait(),this.#_o.keyboardELEnabled=!0}}class In{#io;#yo;constructor(t){Object.freeze(this),this.#io=t,this.#yo=new xn(this.#io)}destructor(){this.#yo.destructor(),this.#io=null}handleEvent(t){t.stopPropagation(),this.#io.hideError(),this.#io.showWait(),this.#io.keyboardELEnabled=!1,fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then(t=>{p===t.status&&t.ok?t.arrayBuffer().then(t=>{(new Mn).decryptData(t,t=>{this.#yo.onOkDecrypt(t)},t=>{this.#yo.onErrorDecrypt(t)},new wn(!1).show())}):this.#yo.onErrorDecrypt(new Error("Invalid http status"))}).catch(t=>{this.#yo.onErrorDecrypt(t),t instanceof Error&&console.error(t)})}}class Cn{#io;#yo;constructor(t){Object.freeze(this),this.#io=t,this.#yo=new xn(this.#io)}destructor(){this.#yo.destructor(),this.#io=null}handleEvent(t){t.stopPropagation(),this.#io.showWait(),this.#io.keyboardELEnabled=!1;const e=new FileReader;e.onload=()=>{(new Mn).decryptData(e.result,t=>{this.#yo.onOkDecrypt(t)},t=>{this.#yo.onErrorDecrypt(t)},new wn(!1).show())},e.readAsArrayBuffer(t.target.files[0])}}class Pn{#io;#bo;constructor(t){Object.freeze(this),this.#io=t,this.#bo=new Cn(this.#io)}destructor(){this.#io=null,this.#bo.destructor()}handleEvent(t){t.stopPropagation(),this.#io.hideError(),D.openFile(this.#bo)}}class On{#io;#yo;constructor(t){Object.freeze(this),this.#io=t,this.#yo=new xn(this.#io)}destructor(){this.#yo.destructor(),this.#io=null}handleEvent(t){t.stopPropagation(),this.#io.validateApiKeys()&&(this.#io.showWait(),this.#io.keyboardELEnabled=!1,(new Mn).encryptData((new window.TextEncoder).encode(this.#io.apiKeysJSON),t=>this.#yo.onOkEncrypt(t),()=>this.#yo.onErrorEncrypt(),new wn(!0).show()))}}class Nn{#io;constructor(t){Object.freeze(this),this.#io=t}destructor(){this.#io=null}handleEvent(t){t.stopPropagation(),this.#io.validateApiKeys()&&D.saveFile("ApiKeys.json",this.#io.apiKeysJSON,"application/json")}}class Sn{#Lo;constructor(t){Object.freeze(this),this.#Lo=t}destructor(){this.#Lo=null}handleEvent(t){t.stopPropagation(),this.#Lo.newApiKey()}}class Dn{#io;#Lo;#To;#Eo;#wo;#Mo;#xo;#Io;#Co;#Po;#Oo;#No;#So;#Do;#jo;#ko;#Ao(){this.#Eo=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("ApiKeysDialogToolbar - Reload from server"),textContent:"ðŸ”„"},this.#To),this.#Oo=new In(this.#io),this.#Eo.addEventListener("click",this.#Oo,!1)}#Ro(){this.#wo=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("ApiKeysDialogToolbar - Save to file"),textContent:"ðŸ’¾"},this.#To),this.#No=new On(this.#io),this.#wo.addEventListener("click",this.#No,!1)}#Ho(){this.#Mo=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("ApiKeysDialogToolbar - Open file"),textContent:"ðŸ“‚"},this.#To),this.#So=new Pn(this.#io),this.#Mo.addEventListener("click",this.#So,!1)}#Bo(){this.#xo=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("ApiKeysDialogToolbar - new api key"),textContent:"+"},this.#To),this.#Do=new Sn(this.#Lo),this.#xo.addEventListener("click",this.#Do,!1)}#zo(){this.#Io=W.create("div",{className:"travelnotes-base-dialog-button travelnotes-api-keys-dialog-at-right-button",title:S.getText("ApiKeysDialogToolbar - Save to json file"),textContent:"ðŸ’¾"},this.#To),this.#jo=new Nn(this.#io),this.#Io.addEventListener("click",this.#jo,!1)}#Fo(){this.#Co=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("ApiKeysDialogToolbar - Open json file"),textContent:"ðŸ“‚"},this.#To),this.#ko=new yn(this.#io),this.#Co.addEventListener("click",this.#ko,!1)}#Zo(){window?.crypto?.subtle?.importKey&&window.isSecureContext&&(this.#Po&&this.#Ao(),this.#Ro(),this.#Ho()),this.#Bo(),t.ApiKeysDialog.haveUnsecureButtons&&(this.#zo(),this.#Fo())}constructor(t,e,o){this.#io=t,this.#Lo=e,this.#Po=o,this.#To=W.create("div",{id:"travelnotes-api-keys-dialog-toolbar-container"}),this.#Zo(),Object.freeze(this)}destructor(){this.#Eo&&(this.#Eo.removeEventListener("click",this.#Oo,!1),this.#Oo.destructor(),this.#Oo=null),this.#wo&&(this.#wo.removeEventListener("click",this.#No,!1),this.#No.destructor(),this.#No=null),this.#Mo&&(this.#Mo.removeEventListener("click",this.#So,!1),this.#So.destructor(),this.#So=null),this.#xo&&(this.#xo.removeEventListener("click",this.#Do,!1),this.#Do.destructor(),this.#Do=null),this.#Io&&(this.#Io.removeEventListener("click",this.#jo,!1),this.#jo.destructor(),this.#jo=null),this.#Co&&(this.#Co.removeEventListener("click",this.#ko,!1),this.#ko.destructor(),this.#ko=null)}get toolbarHTMLElement(){return this.#To}}class jn{#Ko;#Uo;#Vo;#t;#Wo;#Xo;constructor(e,o){Object.freeze(this),this.#Wo=o,this.#t=b.nextObjId,this.#Ko=W.create("div",{className:"travelnotes-base-dialog-flex-row"}),this.#Uo=W.create("input",{className:"travelnotes-api-keys-dialog-api-key-name travelnotes-api-keys-dialog-input",value:e.providerName,placeholder:S.getText("ApiKeyControlRow - provider name")},this.#Ko),this.#Vo=W.create("input",{className:"travelnotes-api-keys-dialog-api-key-value travelnotes-api-keys-dialog-input",value:e.providerKey,placeholder:S.getText("ApiKeyControlRow - api key"),type:t.ApiKeysDialog.showApiKeys?"text":"password"},this.#Ko),this.#Xo=W.create("div",{className:"travelnotes-base-dialog-button travelnotes-api-keys-dialog-at-right-button",title:S.getText("ApiKeyControlRow - delete api key"),textContent:"âŒ",dataset:{ObjId:this.#t}},this.#Ko),this.#Xo.addEventListener("click",this.#Wo,!1)}destructor(){this.#Xo.removeEventListener("click",this.#Wo,!1)}get objId(){return this.#t}get HTMLElement(){return this.#Ko}get providerName(){return this.#Uo.value}get providerKey(){return this.#Vo.value}get apiKey(){return new V(this.#Uo.value,this.#Vo.value)}}class kn{#Lo;constructor(t){Object.freeze(this),this.#Lo=t}destructor(){this.#Lo=null}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#Lo.deleteApiKey(Number.parseInt(t.target.dataset.tanObjId))}}class An extends bn{#Yo;#Wo;constructor(){super(),this.#Yo=new Map,this.#Wo=new kn(this)}destructor(){this.#Yo.forEach(t=>t.destructor()),this.#Yo.clear(),this.#Wo.destructor(),this.#Wo=null}haveEmptyOrDuplicateValues(){let t=!1;const e=[];this.#Yo.forEach(o=>{t=t||""===o.providerName||""===o.providerKey,e.push(o.providerName)});let o=!1;return e.forEach(t=>{o=o||e.indexOf(t)!==e.lastIndexOf(t)}),{haveEmpty:t,haveDuplicate:o}}addApiKeys(t){this.#Yo.clear(),t.forEach(t=>{const e=new jn(t,this.#Wo);this.#Yo.set(e.objId,e)}),this.refreshApiKeys()}newApiKey(){const t=new V,e=new jn(t,this.#Wo);this.#Yo.set(e.objId,e),this.refreshApiKeys()}deleteApiKey(t){this.#Yo.get(t).destructor(),this.#Yo.delete(t),this.refreshApiKeys()}refreshApiKeys(){for(;this.controlHTMLElement.firstChild;)this.controlHTMLElement.removeChild(this.controlHTMLElement.firstChild);this.#Yo.forEach(t=>{this.controlHTMLElement.appendChild(t.HTMLElement)})}get apiKeys(){const t=[];return this.#Yo.forEach(e=>t.push(e.apiKey)),t}get apiKeysJSON(){const t=[];return this.#Yo.forEach(e=>t.push(e.apiKey.jsonObject)),JSON.stringify(t)}}const Rn=new class{#Go;#qo;#Jo;#$o;#Qo;#ti;#ei(){this.#Jo&&(clearTimeout(this.#Jo),this.#Jo=null),this.#Go.classList.remove("travelnotes-errors-ui-"+this.#ti),this.#Go.classList.add("travelnotes-hidden"),this.#Qo.classList.add("travelnotes-hidden"),this.#qo.textContent=""}#oo(e,o){if(this.#ti=o,!t.errorsUI["show"+this.#ti]||"Help"===o&&this.#$o.checked)return;this.#Jo&&(clearTimeout(this.#Jo),this.#Jo=null),this.#qo.textContent="",N.sanitizeToHtmlElement(e,this.#qo),this.#Go.classList.add("travelnotes-errors-ui-"+this.#ti),this.#Go.classList.remove("travelnotes-hidden");let i=t.errorsUI.timeOut;"Help"===this.#ti&&(this.#Qo.classList.remove("travelnotes-hidden"),i=t.errorsUI.helpTimeOut),this.#Jo=setTimeout(()=>this.#ei(),i)}constructor(){Object.freeze(this)}createUI(){if(this.#Go)return;this.#Go=W.create("div",{id:"travelnotes-errors-ui",className:"travelnotes-hidden"},document.body);const e=W.create("div",null,this.#Go);W.create("span",{id:"travelnotes-errors-ui-cancel-button",textContent:"âŒ"},e).addEventListener("click",()=>this.#ei(),!1),this.#qo=W.create("div",{id:"travelnotes-errors ui-message"},this.#Go),this.#Qo=W.create("div",{id:"travelnotes-errors-ui-hide-help-checkbox-container",className:"travelnotes-hidden"},this.#Go),this.#$o=W.create("input",{id:"travelnotes-errors-ui-hide-help-checkbox",type:"checkbox",checked:!t.errorsUI.showHelp},this.#Qo),W.create("label",{id:"travelnotes-errors-ui-hide-help-label",htmlFor:"travelnotes-errors-ui-hide-help-checkbox",textContent:"Don't show help again"},this.#Qo)}showError(t){this.#oo(t,"Error")}showWarning(t){this.#oo(t,"Warning")}showInfo(t){this.#oo(t,"Info")}showHelp(t){this.#oo(t,"Help")}};class Hn extends fn{#oi;#Lo;#ii;#Po;constructor(t,e){super(),this.#ii=t,this.#Po=e}createContentHTML(){this.#Lo=new An,this.#oi=new Dn(this,this.#Lo,this.#Po),this.#Lo.addApiKeys(this.#ii)}#ke(){this.#Lo.destructor(),this.#oi.destructor(),this.#oi=null}validateApiKeys(){this.hideError();const t=this.#Lo.haveEmptyOrDuplicateValues();return t.haveEmpty?(this.showError(S.getText("ApiKeysDialog - empty api key name or value")),!1):!t.haveDuplicate||(this.showError(S.getText("ApiKeysDialog - duplicate api key name found")),!1)}show(){return Rn.showHelp("<p>"+S.getText("Help - Complete the ApiKeys1")+"</p><p>"+S.getText("Help - Complete the ApiKeys2")+"</p><p>"+S.getText("Help - Complete the ApiKeys3")+"</p>"),super.show()}canClose(){return this.validateApiKeys()}onCancel(){this.#ke(),super.onCancel()}onOk(){super.onOk(this.#Lo.apiKeys)&&this.#ke()}get title(){return S.getText("ApiKeysDialog - api keys")}get toolbarHTMLElement(){return this.#oi.toolbarHTMLElement}get contentHTMLElements(){return[this.#Lo.controlHTMLElement]}get apiKeysJSON(){return this.#Lo.apiKeysJSON}addApiKeys(t){this.#Lo.addApiKeys(t)}}const Bn=new class{constructor(){Object.freeze(this)}dispatch(t,e){const o=new Event(t);e&&(o.data=e),document.dispatchEvent(o)}};const zn=new class{#Po=!1;#ni=new Map;#si(t){this.#ri(JSON.parse((new TextDecoder).decode(t)))}#ai(t){t instanceof Error&&console.error(t),t&&"Canceled by user"!==t&&Rn.showError(S.getText("ApiKeysManager - An error occurs when reading the ApiKeys file"))}#li(t){window.isSecureContext&&window?.crypto?.subtle?.importKey&&(new Mn).decryptData(t,t=>this.#si(t),t=>this.#ai(t),new wn(!1).show())}#hi(t){return this.#ni.get(t.toLowerCase())}#ci(t,e){this.#ni.set(t.toLowerCase(),e)}#di(){if(!D.storageAvailable("sessionStorage"))return 0;let t=0;for(let e=0;e<sessionStorage.length;e++){const o=sessionStorage.key(e);o.match(/^\w*ProviderKey$/)&&(this.#ci(o.replace("ProviderKey",""),atob(sessionStorage.getItem(o))),t++)}return U.providers.forEach(t=>{t.providerKeyNeeded&&(t.providerKey=this.#hi(t.name)||"")}),t}#ri(e){this.#ni.clear();const o=D.storageAvailable("sessionStorage")&&t.ApiKeys.saveToSessionStorage;o&&sessionStorage.clear(),e.forEach(t=>{o&&sessionStorage.setItem(t.providerName.toLowerCase()+"ProviderKey",btoa(t.providerKey)),this.#ci(t.providerName,t.providerKey)}),U.providers.forEach(t=>{t.providerKeyNeeded&&(t.providerKey=this.#hi(t.name)||"")}),Bn.dispatch("providersadded")}constructor(){Object.freeze(this)}hasKey(t){return this.#ni.has(t.toLowerCase())}getUrl(t){if(t.providerKeyNeeded){const e=this.#ni.get(t.providerName.toLowerCase());return e?t.url.replace("{providerKey}",e):null}return t.url}setKeysFromServerFile(){let t=!1;0!==this.#di()&&(Bn.dispatch("providersadded"),t=!0),fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"ApiKeys").then(e=>{p===e.status&&e.ok&&(this.#Po=!0,t||e.arrayBuffer().then(t=>this.#li(t)))}).catch(t=>{t instanceof Error&&console.error(t)})}setKeysFromDialog(){const t=[];this.#ni.forEach((e,o)=>{t.push(new V(o,e))}),t.sort((t,e)=>t.providerName.localeCompare(e.providerName)),new Hn(t,this.#Po).show().then(t=>this.#ri(t)).catch(t=>{t instanceof Error&&console.error(t)})}addProvider(t){const e=new t,o=e.name.toLowerCase();let i=this.#hi(o);e.providerKeyNeeded&&!i&&D.storageAvailable("sessionStorage")&&(i=sessionStorage.getItem(o),i&&(i=atob(i))),e.providerKeyNeeded&&i&&(e.providerKey=i),U.providers.set(e.name.toLowerCase(),e)}};const Fn=new class{#ui(t){return(t+e.d540)%e.d360-e.d180}constructor(){Object.freeze(this)}arcFromSummitArcArc(t,e,o){return Math.acos(Math.cos(e)*Math.cos(o)+Math.sin(e)*Math.sin(o)*Math.cos(t))}summitFromArcArcArc(t,e,o){return Math.acos((Math.cos(o)-Math.cos(t)*Math.cos(e))/(Math.sin(t)*Math.sin(e)))}pointsDistance(t,o){if(t[0]===o[0]&&t[1]===o[1])return 0;const i=t[0]*e.toRadians,n=o[0]*e.toRadians,s=(this.#ui(o[1])-this.#ui(t[1]))*e.toRadians;return Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(s))*u}};class Zn{#mi;#pi;constructor(t,e){Object.freeze(this),this.#mi=t,this.#pi=e}get note(){return this.#mi}get route(){return this.#pi}}class Kn{constructor(){Object.seal(this)}distance=Number.MAX_VALUE;route=null;distanceOnRoute=0;latLngOnRoute=[a.defaultValue,a.defaultValue]}const Un=new class{#gi(t,e,o){if(t.objId!==U.editedRouteObjId){const i=rn.getClosestLatLngDistance(t,e);if(i){const n=Fn.pointsDistance(e,i.latLng);n<o.distance&&(o.route=t,o.distance=n,o.latLngOnRoute=i.latLng,o.distanceOnRoute=i.distance)}}}constructor(){Object.freeze(this)}getNearestRouteData(t){const e=new Kn;return U.travel.routes.forEach(o=>this.#gi(o,t,e)),g!==U.editedRouteObjId&&this.#gi(U.travel.editedRoute,t,e),Object.freeze(e)}getRoute(t){let e=null;return e=U.travel.routes.getAt(t),e||t===U.travel.editedRoute.objId&&(e=U.travel.editedRoute),e}getNoteAndRoute(t){let e=null,o=null;if(e=U.travel.notes.getAt(t),!e){const i=U.travel.routes.iterator;for(;!i.done&&!e;)e=i.value.notes.getAt(t),e&&(o=i.value);e||(e=U.travel.editedRoute.notes.getAt(t),e&&(o=U.travel.editedRoute))}return new Zn(e,o)}getWayPoint(t){let e=U.travel.editedRoute.wayPoints.getAt(t);if(!e){const o=U.travel.routes.iterator;for(;!o.done&&!e;)e=o.value.wayPoints.getAt(t)}return e}};class Vn{#vi;#fi;#pi;static get#_i(){return"\n"}static get#yi(){return"\n\t"}static get#bi(){return"\n\t\t"}static get#Li(){return"\n\t\t\t"}static get#Ti(){return"\n\t\t\t\t"}#Ei(){this.#vi='<?xml version="1.0"?>'+Vn.#_i,this.#vi+='<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" creator="TravelNotes">'}#wi(t){return t.replaceAll("&","&amp;").replaceAll(/\u0027/g,"&apos;").replaceAll(/"/g,"&quot;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;")}#Mi(){const t=this.#pi.wayPoints.iterator;for(;!t.done;)this.#vi+=Vn.#yi+'<wpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+Vn.#bi+this.#fi+Vn.#bi+"<name>"+this.#wi(t.value.fullName)+"</name>"+Vn.#yi+"</wpt>"}#xi(){this.#vi+=Vn.#yi+"<rte>",this.#vi+=Vn.#bi+"<name>"+this.#wi(this.#pi.computedName)+"</name>";const t=this.#pi.itinerary.maneuvers.iterator;for(;!t.done;){const e=this.#pi.itinerary.itineraryPoints.getAt(t.value.itineraryPointObjId);this.#vi+=Vn.#bi+'<rtept lat="'+e.lat+'" lon="'+e.lng+'">'+Vn.#Li+this.#fi+Vn.#Li+"<desc>"+this.#wi(t.value.instruction)+"</desc>"+Vn.#bi+"</rtept>"}this.#vi+=Vn.#yi+"</rte>"}#Ii(){this.#vi+=Vn.#yi+"<trk>",this.#vi+=Vn.#bi+"<name>"+this.#wi(this.#pi.computedName)+"</name>",this.#vi+=Vn.#bi+"<trkseg>";const t=this.#pi.itinerary.itineraryPoints.iterator;for(;!t.done;)this.#vi+=Vn.#Li+'<trkpt lat="'+t.value.lat+'" lon="'+t.value.lng+'">'+Vn.#Ti+this.#fi+Vn.#Ti+"<ele>"+t.value.elev+"</ele>"+Vn.#Li+"</trkpt>";this.#vi+=Vn.#bi+"</trkseg>",this.#vi+=Vn.#yi+"</trk>"}#Ci(){this.#vi+=Vn.#_i+"</gpx>"}#Pi(){let t=(""===U.travel.name?"":U.travel.name+" - ")+this.#pi.computedName;""===t&&(t="TravelNote"),t+=".gpx",D.saveFile(t,this.#vi,"application/xml")}constructor(){Object.freeze(this)}routeToGpx(t){this.#pi=Un.getRoute(t),this.#pi&&(this.#fi="<time>"+(new Date).toISOString()+"</time>",this.#Ei(),this.#Mi(),this.#xi(),this.#Ii(),this.#Ci(),this.#Pi())}}class Wn extends bn{#Oi;constructor(t){super(),W.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Oi=W.create("input",{type:"checkbox",className:"travelnotes-checkbox-input-control-checkbox",checked:t?.checked,dataset:{Name:t?.datasetName||"CheckboxInputControl"}},this.controlHTMLElement),W.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get checked(){return this.#Oi.checked}set checked(t){this.#Oi.checked=t}}class Xn{#Ni;#Si;#Di;constructor(t,e,o){Object.freeze(this),this.#Ni="number"==typeof t&&Xn.MAX_COLOR>=t&&Xn.MIN_COLOR<=t?t:Xn.MAX_COLOR,this.#Si="number"==typeof e&&Xn.MAX_COLOR>=e&&Xn.MIN_COLOR<=e?e:Xn.MAX_COLOR,this.#Di="number"==typeof o&&Xn.MAX_COLOR>=o&&Xn.MIN_COLOR<=o?o:Xn.MAX_COLOR}static get MIN_COLOR(){return 0}static get MAX_COLOR(){return 255}static fromCss(t){let e=new Xn;return e.cssColor=t,e}get red(){return this.#Ni}set red(t){"number"==typeof t&&Xn.MAX_COLOR>=t&&Xn.MIN_COLOR<=t&&(this.#Ni=t)}get green(){return this.#Si}set green(t){"number"==typeof t&&Xn.MAX_COLOR>=t&&Xn.MIN_COLOR<=t&&(this.#Si=t)}get blue(){return this.#Di}set blue(t){"number"==typeof t&&Xn.MAX_COLOR>=t&&Xn.MIN_COLOR<=t&&(this.#Di=t)}get cssColor(){return"#"+this.#Ni.toString(m).padStart(2,"0")+this.#Si.toString(m).padStart(2,"0")+this.#Di.toString(m).padStart(2,"0")}set cssColor(t){"#"===t[0]?(this.#Ni=Number.parseInt(t.substring(1,3),m),this.#Si=Number.parseInt(t.substring(3,5),m),this.#Di=Number.parseInt(t.substring(5,7),m)):"rgb"===t.substring(0,3)&&([this.#Ni,this.#Si,this.#Di]=Array.from(t.match(/[0-9]{1,3}/g),t=>Number.parseInt(t)))}}class Yn{#ji=null;constructor(t){Object.freeze(this),this.#ji=t}handleEvent(t){t.stopPropagation(),this.#ji.onColorButtonClick(t.target.style["background-color"])}}class Gn{#ki;#Ai;#Ri;static get#Hi(){return 6}static get#Bi(){return 6}static get#zi(){return 51}constructor(t){Object.freeze(this),this.#Ai=[],this.#Ri=new Yn(t),this.#ki=W.create("div",null,t.controlHTMLElement);for(let t=0;t<Gn.#Hi;++t){const t=W.create("div",null,this.#ki);for(let e=0;e<Gn.#Bi;++e){let e=W.create("div",{className:"travelnotes-color-control-cell-color"},t);e.addEventListener("click",this.#Ri,!1),this.#Ai.push(e)}}}destructor(){this.#Ai.forEach(t=>{t.removeEventListener("click",this.#Ri,!1)}),this.#Ri=null}set red(t){let e=new Xn(t,Xn.MIN_COLOR,Xn.MIN_COLOR);this.#Ai.forEach(t=>{t.style["background-color"]=e.cssColor,Xn.MAX_COLOR<=e.green?(e.green=Xn.MIN_COLOR,e.blue+=Gn.#zi):e.green+=Gn.#zi})}}class qn{#ji;#Fi;constructor(t,e){Object.freeze(this),this.#ji=t,this.#Fi=e}handleEvent(t){t.stopPropagation();let e=t.target.valueAsNumber*this.#Fi;e=e-Math.floor(e)<Math.ceil(e)-e?Math.floor(e):Math.ceil(e),this.#ji.onRedSliderInput(e)}}class Jn{#Zi;#Ki;static get#Ui(){return 100}static get#Vi(){return 20}constructor(t){this.#Ki=new qn(t,Xn.MAX_COLOR/Jn.#Ui),this.#Zi=W.create("input",{type:"range",value:0,min:0,max:Jn.#Ui,step:Jn.#Vi},W.create("div",null,t.controlHTMLElement)),this.#Zi.addEventListener("input",this.#Ki,!1),this.#Zi.focus()}destructor(){this.#Zi.removeEventListener("input",this.#Ki,!1),this.#Ki=null}}class $n{#ji;#Wi;constructor(t,e){Object.freeze(this),this.#ji=t,this.#Wi=e}handleEvent(t){t.stopPropagation(),this.#ji.onRgbInput(this.#Wi.cssColor)}}class Qn{#Xi;#Yi;#Gi;#qi;#Ji;#$i(t){W.create("text",{value:t},this.#Xi);const e=W.create("input",{type:"number",className:"travelnotes-color-control-number-input",min:Xn.MIN_COLOR,max:Xn.MAX_COLOR},this.#Xi);return e.addEventListener("input",this.#Ji,!1),e}constructor(t){Object.freeze(this),this.#Ji=new $n(t,this),this.#Xi=W.create("div",null,t.controlHTMLElement),this.#Yi=this.#$i(S.getText("ColorControl - Red")),this.#Gi=this.#$i(S.getText("ColorControl - Green")),this.#qi=this.#$i(S.getText("ColorControl - Blue"))}destructor(){this.#Yi.removeEventListener("input",this.#Ji,!1),this.#Gi.removeEventListener("input",this.#Ji,!1),this.#qi.removeEventListener("input",this.#Ji,!1),this.#Ji=null}get cssColor(){return new Xn(Number.parseInt(this.#Yi.value),Number.parseInt(this.#Gi.value),Number.parseInt(this.#qi.value)).cssColor}set cssColor(t){let e=Xn.fromCss(t);this.#Yi.value=e.red,this.#Gi.value=e.green,this.#qi.value=e.blue}}class ts{#Qi;constructor(t){Object.freeze(this),this.#Qi=W.create("div",{id:"travelnotes-color-control-color-sample"},t.controlHTMLElement)}get cssColor(){return this.#Qi.style["background-color"]}set cssColor(t){this.#Qi.style["background-color"]=t}}class es extends bn{#tn;#en;#Wi;#on;constructor(t){super(),t?.headerText&&""!==t.headerText&&W.create("div",{textContent:t.headerText},this.controlHTMLElement),this.controlHTMLElement.classList.add("travelnotes-color-control-container"),this.#tn=new Gn(this),this.#tn.red=0,this.#en=new Jn(this),this.#Wi=new Qn(this),this.#Wi.cssColor=t?.cssColor||"#ff0000",this.#on=new ts(this),this.#on.cssColor=t?.cssColor||"#ff0000"}destructor(){this.#tn.destructor(),this.#en.destructor(),this.#Wi.destructor()}get cssColor(){return Xn.fromCss(this.#on.cssColor).cssColor}onRedSliderInput(t){this.#tn.red=t}onColorButtonClick(t){this.#Wi.cssColor=t,this.#on.cssColor=t}onRgbInput(t){this.#on.cssColor=t}}class os extends bn{#Oi;constructor(t){super(),W.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#Oi=W.create("input",{type:"number",className:"travelnotes-number-input-control-number-input",value:t?.value||0,min:t?.min||0,max:t?.max||Number.MAX_VALUE,dataset:{Name:t?.datasetName||"NumberInputControl"}},this.controlHTMLElement),W.create("text",{value:t?.afterText||""},this.controlHTMLElement)}get value(){return Number.parseInt(this.#Oi.value)}set value(t){this.#Oi.value=t}}class is extends bn{#Oi;constructor(t,e){super(),W.create("div",{className:"travelnotes-base-dialog-flex-row",textContent:t?.headerText||""},this.controlHTMLElement),this.#Oi=W.create("input",{className:"travelnotes-text-input-control-text-input",type:"text",dataset:{Name:t?.datasetName||"TextInputControl"},value:t?.value||""},W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),e?.controlFocus&&this.#Oi.addEventListener("focus",e.controlFocus),e?.controlInput&&this.#Oi.addEventListener("input",e.controlInput),e?.controlChange&&this.#Oi.addEventListener("change",e.controlChange)}destructor(t){t?.controlFocus&&this.#Oi.removeEventListener("focus",t.controlFocus),t?.controlInput&&this.#Oi.removeEventListener("input",t.controlInput)}get value(){return this.#Oi.value}set value(t){this.#Oi.value=t}}class ns extends bn{#in;constructor(t){super(),W.create("text",{value:t?.beforeText||""},this.controlHTMLElement),this.#in=W.create("select",null,this.controlHTMLElement),t?.elements.forEach(t=>{this.#in.add(W.create("option",{text:t}))})}get selectedIndex(){return this.#in.selectedIndex}set selectedIndex(t){this.#in.selectedIndex=t}}class ss extends fn{#pi;#ji;#nn;#sn;#rn;#an;static get#ln(){return 1}static get#hn(){return 40}constructor(t){super(),this.#pi=t}createContentHTML(){this.#nn=new is({headerText:S.getText("RoutePropertiesDialog - Name"),value:this.#pi.computedName}),this.#sn=new os({beforeText:S.getText("RoutePropertiesDialog - Width"),value:this.#pi.width,min:ss.#ln,max:ss.#hn}),this.#rn=new ns({beforeText:S.getText("RoutePropertiesDialog - Linetype"),elements:Array.from(t.route.dashChoices,t=>t.text)}),this.#rn.selectedIndex=this.#pi.dashIndex<t.route.dashChoices.length?this.#pi.dashIndex:0,this.#an=new Wn({beforeText:S.getText("RoutePropertiesDialog - Chained route"),checked:this.#pi.chain}),this.#ji=new es({cssColor:this.#pi.color,headerText:S.getText("RoutePropertiesDialog - Color")})}show(){let t=super.show();return this.addCssClass("travelNotes-route-properties-dialog"),t}onCancel(){this.#ji.destructor(),super.onCancel()}onOk(){this.#pi.color=this.#ji.cssColor,this.#pi.computedName!==this.#nn.value&&(this.#pi.name=this.#nn.value),this.#pi.width=this.#sn.value,this.#pi.chain=this.#an.checked,this.#pi.dashIndex=this.#rn.selectedIndex,this.#ji.destructor(),super.onOk()}get title(){return S.getText("RoutePropertiesDialog - Route properties")}get contentHTMLElements(){return[this.#nn.controlHTMLElement,this.#sn.controlHTMLElement,this.#rn.controlHTMLElement,this.#an.controlHTMLElement,this.#ji.controlHTMLElement]}}class rs extends bn{static#t=0;#cn;constructor(t){super(),this.#cn=[],W.create("div",{className:"travelnotes-base-dialog-flex-row",textContent:t?.headerText||""},this.controlHTMLElement);let e="controlName"+ ++rs.#t,o=0;t.buttons.forEach(i=>{let n="buttonId"+ ++rs.#t,s=W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement);this.#cn.push(W.create("input",{type:"radio",className:"travelnotes-radio-input-control-radio",checked:i.checked,id:n,name:e,value:String(o++),dataset:{Name:t?.datasetName||"RadioInputControl"}},s)),W.create("label",{htmlFor:n,innerText:i.label},s)})}get value(){let t=f;return this.#cn.forEach(e=>{t=e.checked?Number.parseInt(e.value):t}),t}}class as{constructor(){Object.seal(this)}paperWidth=0;paperHeight=0;borderWidth=0;zoomFactor=0;printNotes=!1;firefoxBrowser=!0}class ls extends fn{#dn;#un;#mn;#pn;#gn;#vn;static get#fn(){return 15}constructor(){super()}createContentHTML(){this.#dn=new os({beforeText:S.getText("PrintRouteMapDialog - Paper width"),afterText:S.getText("PrintRouteMapDialog - Paper width units"),value:t.printRouteMap.paperWidth}),this.#un=new os({beforeText:S.getText("PrintRouteMapDialog - Paper height"),afterText:S.getText("PrintRouteMapDialog - Paper height units"),value:t.printRouteMap.paperHeight}),this.#mn=new os({beforeText:S.getText("PrintRouteMapDialog - Border width"),afterText:S.getText("PrintRouteMapDialog - Border width units"),value:t.printRouteMap.borderWidth}),this.#pn=new os({beforeText:S.getText("PrintRouteMapDialog - Zoom factor"),value:Math.min(t.printRouteMap.zoomFactor,ls.#fn),min:U.map.getMinZoom(),max:Math.min(U.map.getMaxZoom(),ls.#fn)}),this.#gn=new Wn({afterText:S.getText("PrintRouteMapDialog - Print notes"),checked:t.printRouteMap.printNotes}),this.#vn=new rs({headerText:S.getText("PrintRouteMapDialog - Print with"),buttons:[{label:"Firefox",checked:t.printRouteMap.firefoxBrowser},{label:S.getText("PrintRouteMapDialog - Another browser"),checked:!t.printRouteMap.firefoxBrowser}]})}show(){let t=super.show();return this.addCssClass("travelnotes-print-route-map-dialog"),t}onOk(){const t=new as;t.paperWidth=this.#dn.value,t.paperHeight=this.#un.value,t.borderWidth=this.#mn.value,t.zoomFactor=this.#pn.value,t.printNotes=this.#gn.checked,t.firefoxBrowser=0===this.#vn.value,Object.freeze(t),super.onOk(t)}get contentHTMLElements(){return[this.#dn.controlHTMLElement,this.#un.controlHTMLElement,this.#mn.controlHTMLElement,this.#pn.controlHTMLElement,this.#gn.controlHTMLElement,this.#vn.controlHTMLElement]}get title(){return S.getText("PrintRouteMapDialog - Print")}}class hs{#re=null;#ae=null;#le=null;#he=null;#ce=null;constructor(t){for(const e in t)switch(e){case"firstButtonText":this.#re=t.firstButtonText;break;case"secondButtonText":this.#ae=t.secondButtonText;break;case"selectOptionsData":this.#le=t.selectOptionsData;break;case"title":this.#he=t.title;break;case"text":this.#ce=t.text}}get firstButtonText(){return this.#re}get secondButtonText(){return this.#ae}get selectOptionsData(){return this.#le}get title(){return this.#he}get text(){return this.#ce}}class cs{#Kt;constructor(t){Object.freeze(this),this.#Kt=t}handleEvent(){this.#Kt.onCancel()}}class ds{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){this.#Vt.setDragStartPoint(t),t.dataTransfer.setData("ObjId",this.#Vt.objId)}}class us{#Vt;constructor(t){Object.freeze(this),this.#Vt=t}handleEvent(t){this.#Vt.moveDialog(t)}}class ms{#Vt;#de;constructor(t){Object.freeze(this),this.#Vt=t,this.#de=!1}handleEvent(t){t.stopPropagation();let e=t.type;if(1===t.changedTouches.length){const o=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#de=!0,this.#Vt.setDragStartPoint(o);break;case"touchmove":this.#de=!1,t.preventDefault(),this.#Vt.moveDialog(o,e);break;case"touchend":this.#de||this.#Vt.moveDialog(o,e)}}}}class ps{#t;#pe;#ge;#ve;#fe;#_e(t,e){const o=pn.screenAvailable,i=o.width-this.dialogHTMLElement.offsetWidth-d,n=o.height-this.dialogHTMLElement.offsetHeight-d;this.#ve=Math.max(Math.min(t,i),d),this.#fe=Math.max(Math.min(e,n),d)}#ye(){this.dialogHTMLElement.style.left=String(this.#ve)+"px",this.dialogHTMLElement.style.top=String(this.#fe)+"px"}dialogHTMLElement=null;topBarHTMLElement=null;constructor(){Object.seal(this),this.#ve=d,this.#fe=d,this.#pe=0,this.#ge=0,this.#t=b.nextObjId}get onTop(){return 42>this.#fe}get objId(){return this.#t}centerDialog(){const e=pn.screenAvailable;this.dialogHTMLElement.style["max-height"]=String(e.height-80)+"px",this.dialogHTMLElement.style["max-width"]=String(Math.min(e.width-80,800))+"px",this.#ve=(e.width-this.dialogHTMLElement.clientWidth)/2,t.baseDialog.touchTopScreen&&pn.isTouch?this.#fe=d:this.#fe=(e.height-this.dialogHTMLElement.clientHeight)/2,this.#ye()}moveDialog(t,e){const o=this.#ve+t.screenX-this.#pe,i=this.#fe+t.screenY-this.#ge;this.moveDialogTo(o,i,e),this.setDragStartPoint(t)}moveDialogTo(t,e){this.#_e(t,e),this.#ye()}moveDialogToLastPosition(){this.moveDialogTo(this.#ve,this.#fe)}moveDialogToTopLeft(){this.#ve=d,this.#fe=d,this.#ye()}setDragStartPoint(t){this.#pe=t.screenX,this.#ge=t.screenY}}class gs{#be;#Le;#Te;#Ee;#we;#Me;#xe;#Ie;#Ce;#Pe=null;#Oe(){this.#be=W.create("div",{className:"travelnotes-base-dialog-dialog-container"}),this.mover.dialogHTMLElement=this.#be}#Ne(){this.#Le=W.create("div",{className:"travelnotes-base-dialog-top-bar",draggable:!0},this.#be),this.#Ie=new ms(this.mover),this.#Le.addEventListener("touchstart",this.#Ie,!1),this.#Le.addEventListener("touchmove",this.#Ie,!1),this.#Le.addEventListener("touchend",this.#Ie,!1),this.#Le.addEventListener("touchcancel",this.#Ie,!1),this.#Me=new ds(this.mover),this.#Le.addEventListener("dragstart",this.#Me,!1),this.#xe=new us(this.mover),this.#Le.addEventListener("dragend",this.#xe,!1),this.#Te=W.create("div",{textContent:"âŒ",className:"travelnotes-base-dialog-cancel-button",title:S.getText("BaseDialog - Cancel")},this.#Le),W.create("div",{textContent:this.title,className:"travelnotes-base-dialog-title"},this.#Le),this.#Ce=new cs(this),this.#Te.addEventListener("click",this.#Ce,!1),this.mover.topBarHTMLElement=this.#Le}#Se(){this.toolbarHTMLElement&&W.create("div",{className:"travelnotes-base-dialog-toolbar-container"},this.#be).appendChild(this.toolbarHTMLElement)}#De(){this.#Ee=W.create("div",{className:"travelnotes-base-dialog-content-container"},this.#be),this.contentHTMLElements.forEach(t=>this.#Ee.appendChild(t))}#je(){this.#Oe(),this.#Ne(),this.#Se(),this.#De()}constructor(t){Object.freeze(this),this.#Pe=new hs(t)}#ke(){this.#Le.removeEventListener("dragstart",this.#Me,!1),this.#Me=null,this.#Le.removeEventListener("dragend",this.#xe,!1),this.#xe=null,this.#Le.removeEventListener("touchstart",this.#Ie,!1),this.#Le.removeEventListener("touchmove",this.#Ie,!1),this.#Le.removeEventListener("touchend",this.#Ie,!1),this.#Le.removeEventListener("touchcancel",this.#Ie,!1),this.#Ie=null,this.#Te.removeEventListener("click",this.#Ce,!1),this.#Ce=null,this.#we&&(this.#we=null)}get mover(){return this.#we?this.#we:this.#we=new ps}onCancel(){this.#ke()}onOk(){this.#ke()}get title(){return""}get toolbarHTMLElement(){return null}get contentHTMLElements(){return[]}show(){this.createContentHTML(),this.#je()}removeFromBackground(t){t.removeChild(this.#be)}addToBackground(t){t.appendChild(this.#be)}addToDialog(t){this.#be.appendChild(t)}get options(){return this.#Pe}addCssClass(t){this.#be.classList.add(t)}}class vs extends gs{#We;#$e(){this.#We=new tn(this.mover),document.body.addEventListener("dragover",this.#We,!1)}constructor(){super()}onCancel(){document.body.removeEventListener("dragover",this.#We,!1),this.#We=null,super.onCancel(),this.removeFromBackground(document.body)}show(){super.show(),this.#$e(),this.addToBackground(document.body)}}class fs{#pi;#_n;#yn;#bn;#Ln;#Tn;#En;static get PROFILE_MARGIN(){return 100}static get PROFILE_HEIGHT(){return 500}static get PROFILE_WIDTH(){return 1e3}static get X_DELTA_TEXT(){return 10}static get Y_DELTA_TEXT(){return 30}static get#wn(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5]}static get#Mn(){return[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3]}static get#xn(){return 8}static get#In(){return 4}static get#Cn(){return fs.PROFILE_MARGIN.toFixed(0)}static get#Pn(){return(fs.PROFILE_MARGIN+fs.PROFILE_WIDTH).toFixed(0)}static get#On(){return fs.PROFILE_MARGIN.toFixed(0)}static get#Nn(){return(fs.PROFILE_MARGIN+fs.PROFILE_HEIGHT).toFixed(0)}static get#Sn(){return(fs.PROFILE_MARGIN-fs.X_DELTA_TEXT).toFixed(0)}static get#Dn(){return(fs.PROFILE_MARGIN+fs.PROFILE_WIDTH+fs.X_DELTA_TEXT).toFixed(0)}static get#jn(){return fs.PROFILE_MARGIN+fs.PROFILE_HEIGHT+fs.PROFILE_MARGIN/2}#kn(){let t="",e=0,o=0,i=0;this.#pi.itinerary.itineraryPoints.forEach(n=>{o=(fs.PROFILE_MARGIN+this.#bn*e).toFixed(0),i=(fs.PROFILE_MARGIN+this.#yn*(this.#Tn-n.elev)).toFixed(0),t+=o+","+i+" ",e+=n.distance});const n=document.createElementNS(_,"polyline");n.setAttributeNS(null,"points",t),n.setAttributeNS(null,"class","travelnotes-route-svg-profile-profile-polyline"),this.#_n.appendChild(n)}#An(){const t=fs.#Cn+","+fs.#On+" "+fs.#Cn+","+fs.#Nn+" "+fs.#Pn+","+fs.#Nn+" "+fs.#Pn+","+fs.#On,e=document.createElementNS(_,"polyline");e.setAttributeNS(null,"points",t),e.setAttributeNS(null,"class","travelnotes-route-svg-profile-frame-polyline"),this.#_n.appendChild(e)}#Rn(){let t=Number.MAX_VALUE,e=0;fs.#wn.forEach(o=>{const i=Math.abs(this.#pi.distance/fs.#xn-o);i<t&&(t=i,e=o)});let i=Math.ceil(this.#pi.chainedDistance/e)*e;for(;i<this.#pi.distance+this.#pi.chainedDistance;){const t=document.createElementNS(_,"text");t.appendChild(document.createTextNode(o.metersInKm<e||0<this.#pi.chainedDistance?i/o.metersInKm+" km":i+" m ")),t.setAttributeNS(null,"class","travelnotes-route-svg-profile-dist-legend"),t.setAttributeNS(null,"x",fs.PROFILE_MARGIN+(i-this.#pi.chainedDistance)*this.#bn),t.setAttributeNS(null,"y",fs.#jn),t.setAttributeNS(null,"text-anchor","start"),this.#_n.appendChild(t),i+=e}}#Hn(){let t=Number.MAX_VALUE,e=0;fs.#Mn.forEach(o=>{const i=Math.abs(this.#En/fs.#In-o);i<t&&(t=i,e=o)});let o=Math.ceil(this.#Ln/e)*e;for(;o<this.#Tn;){const t=fs.PROFILE_MARGIN+(this.#Tn-o)*this.#yn,i=document.createElementNS(_,"text");i.appendChild(document.createTextNode(o.toFixed(0))),i.setAttributeNS(null,"class","travelnotes-route-svg-profile-elev-legend"),i.setAttributeNS(null,"x",fs.#Dn),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"text-anchor","start"),this.#_n.appendChild(i);const n=document.createElementNS(_,"text");n.appendChild(document.createTextNode(o.toFixed(0))),n.setAttributeNS(null,"class","travelnotes-route-svg-profile-elev-legend"),n.setAttributeNS(null,"x",fs.#Sn),n.setAttributeNS(null,"y",t),n.setAttributeNS(null,"text-anchor","end"),this.#_n.appendChild(n),o+=e}}#Bn(){this.#_n=document.createElementNS(_,"svg"),this.#_n.setAttributeNS(null,"viewBox","0 0 "+(fs.PROFILE_WIDTH+2*fs.PROFILE_MARGIN)+" "+(fs.PROFILE_HEIGHT+2*fs.PROFILE_MARGIN)),this.#_n.setAttributeNS(null,"class","travelnotes-route-svg-profile-container")}constructor(){Object.freeze(this)}createSvg(t){return this.#pi=t,this.#Ln=Number.MAX_VALUE,this.#Tn=0,this.#pi.itinerary.itineraryPoints.forEach(t=>{this.#Tn=Math.max(this.#Tn,t.elev),this.#Ln=Math.min(this.#Ln,t.elev)}),this.#En=this.#Tn-this.#Ln,this.#yn=fs.PROFILE_HEIGHT/this.#En,this.#bn=fs.PROFILE_WIDTH/this.#pi.distance,this.#Bn(),this.#kn(),this.#An(),this.#Hn(),this.#Rn(),this.#_n}}class _s{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onKeydownKeyboard(t.key)}}class ys{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onCancelMenu()}}class bs{#Fn=null;#Zn=null;static get#Kn(){return 100}static get#Un(){return 30}#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){if(1===t.changedTouches.length){const e=t.changedTouches.item(0);switch(t.type){case"touchstart":this.#Fn=e.clientX,this.#Zn=e.clientY;break;case"touchend":this.#Fn&&this.#Zn&&bs.#Kn<this.#Zn-e.clientY&&bs.#Un>Math.abs(this.#Fn-e.clientX)&&this.#zn.onCancelMenu(),this.#Fn=null,this.#Zn=null;break;case"touchcancel":this.#Fn=null,this.#Zn=null}}}}class Ls{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onMouseLeaveMenuItem(t.currentTarget)}}class Ts{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onMouseEnterMenuItem(t.currentTarget)}}class Es{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.selectItem(Number.parseInt(t.currentTarget.dataset.tanObjId))}}class ws{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onMouseLeaveContainer()}}class Ms{#zn=null;constructor(t){Object.freeze(this),this.#zn=t}handleEvent(t){t.stopPropagation(),this.#zn.onMouseEnterContainer()}}class xs{static#Vn=Object.freeze({get previousItem(){return-1},get firstItem(){return 0},get nextItem(){return 1},get lastItem(){return 2}});#Wn=null;#Xn;#Yn;#Gn;#qn;#Jn;#$n;#Qn;#ts;#es=f;#Jo=null;#os(){this.#Wn.menuItemHTMLElements.forEach(t=>{t.classList.remove("travelnotes-context-menu-menu-item-selected")})}#is(t){switch(this.#os(),t){case xs.#Vn.previousItem:case xs.#Vn.nextItem:this.#es+=t,f===this.#es&&(this.#es=this.#Wn.menuItemHTMLElements.length-1),this.#Wn.menuItemHTMLElements.length===this.#es&&(this.#es=0);break;case xs.#Vn.firstItem:this.#es=0;break;case xs.#Vn.lastItem:this.#es=this.#Wn.menuItemHTMLElements.length-1}this.#Wn.menuItemHTMLElements[this.#es].classList.add("travelnotes-context-menu-menu-item-selected")}constructor(t){Object.freeze(this),this.#Wn=t,this.#Xn=new _s(this),this.#Yn=new ws(this),this.#Gn=new Ms(this),this.#qn=new ys(this),this.#Jn=new bs(this),this.#$n=new Es(this),this.#Qn=new Ls(this),this.#ts=new Ts(this),document.addEventListener("keydown",this.#Xn,!0),this.#Wn.contextMenuHTMLElement.addEventListener("mouseleave",this.#Yn),this.#Wn.contextMenuHTMLElement.addEventListener("mouseenter",this.#Gn),this.#Wn.contextMenuHTMLElement.addEventListener("touchstart",this.#Jn),this.#Wn.contextMenuHTMLElement.addEventListener("touchend",this.#Jn),this.#Wn.contextMenuHTMLElement.addEventListener("touchcancel",this.#Jn),this.#Wn.cancelButton.addEventListener("click",this.#qn),this.#Wn.menuItemHTMLElements.forEach(t=>{t.addEventListener("click",this.#$n),t.addEventListener("mouseleave",this.#Qn),t.addEventListener("mouseenter",this.#ts)})}destructor(){this.#Jo&&(clearTimeout(this.#Jo),this.#Jo=null),document.removeEventListener("keydown",this.#Xn,!0),this.#Wn.contextMenuHTMLElement.removeEventListener("mouseleave",this.#Yn),this.#Wn.contextMenuHTMLElement.removeEventListener("mouseenter",this.#Gn),this.#Wn.contextMenuHTMLElement.removeEventListener("touchstart",this.#Jn),this.#Wn.contextMenuHTMLElement.removeEventListener("touchend",this.#Jn),this.#Wn.contextMenuHTMLElement.removeEventListener("touchcancel",this.#Jn),this.#Wn.cancelButton.removeEventListener("click",this.#qn),this.#Wn.menuItemHTMLElements.forEach(t=>{t.removeEventListener("click",this.#$n),t.removeEventListener("mouseleave",this.#Qn),t.removeEventListener("mouseenter",this.#ts)}),this.#Xn=null,this.#Yn=null,this.#Gn=null,this.#qn=null,this.#Jn=null,this.#$n=null,this.#Qn=null,this.#ts=null,document.body.removeChild(this.#Wn.contextMenuHTMLElement),this.#Wn=null}onMouseLeaveContainer(){this.#Jo=setTimeout(()=>this.onCancelMenu(),t.contextMenu.timeout)}onMouseEnterContainer(){this.#Jo&&(clearTimeout(this.#Jo),this.#Jo=null)}onKeydownKeyboard(t){switch(t){case"Escape":case"Esc":this.onCancelMenu();break;case"ArrowDown":case"ArrowRight":case"Tab":this.#is(xs.#Vn.nextItem);break;case"ArrowUp":case"ArrowLeft":this.#is(xs.#Vn.previousItem);break;case"Home":this.#is(xs.#Vn.firstItem);break;case"End":this.#is(xs.#Vn.lastItem);break;case"Enter":if(f===this.#es||this.#Wn.menuItemHTMLElements[this.#es].classList.contains("travelnotes-context-menu-menu-item-disabled"))return;this.#Wn.onOk(this.#es)}}onCancelMenu(){this.#Wn.onCancel("Canceled by user")}selectItem(t){this.#Wn.menuItemHTMLElements[t].classList.contains("travelnotes-context-menu-menu-item-disabled")||this.#Wn.onOk(t)}onMouseLeaveMenuItem(t){t.classList.remove("travelnotes-context-menu-menu-item-selected")}onMouseEnterMenuItem(t){this.#os(),this.#es=Number.parseInt(t.dataset.tanObjId),t.classList.add("travelnotes-context-menu-menu-item-selected")}}class Is{#Fn;#Zn;#ns;#ss;#rs;static#as=null;#ls;#hs;#cs;#Te;#ds;#zn;static get#us(){return 20}static get isActive(){return Boolean(Is.#as)}#ms(){this.#cs=W.create("div",{className:"travelnotes-context-menu-container"},document.body)}#ps(){this.#Te=W.create("div",{textContent:"âŒ",className:"travelnotes-context-menu-cancel-button",title:S.getText("BaseContextMenu - Close")},this.#cs)}#gs(){this.#ds=[],this.menuItems.forEach((t,e)=>{const o=W.create("div",{textContent:t.itemText,className:"travelnotes-context-menu-menu-item",dataset:{ObjId:String(e)}},this.#cs);t.isActive||o.classList.add("travelnotes-context-menu-menu-item-disabled"),this.#ds.push(o)})}#vs(){const t=pn.screenAvailable,e=Math.min(this.#Zn,t.height-this.#cs.clientHeight-Is.#us);this.#cs.style.top=String(e)+"px";const o=Math.min(this.#Fn,t.width-this.#cs.clientWidth-Is.#us);this.#cs.style.left=String(o)+"px"}#fs(t,e){this.#ls=t,this.#hs=e,this.#ms(),this.#ps(),this.#gs(),this.#vs(),this.#zn=new xs(this)}constructor(t,e){Object.freeze(this),Is.#as?Is.#as.onCancel():(this.#Fn=t.clientX||t.originalEvent.clientX||0,this.#Zn=t.clientY||t.originalEvent.clientY||0,this.#ns=[t.latlng?t.latlng.lat:a.defaultValue,t.latlng?t.latlng.lng:a.defaultValue],this.#ss=t.target?.objId??(Number.parseInt(t?.currentTarget?.dataset?.tanObjId)||g),this.#rs=Boolean(e),Is.#as=this)}onOk(t){this.#zn.destructor(),Is.#as=null,this.#ls(t)}onCancel(){this.#zn.destructor(),Is.#as=null,this.#hs()}show(){Is.#as&&new Promise((t,e)=>{this.#fs(t,e)}).then(t=>this.menuItems[t].doAction()).catch(t=>{t&&console.error(t)})}get menuItems(){return[]}get contextMenuHTMLElement(){return this.#cs}get cancelButton(){return this.#Te}get menuItemHTMLElements(){return this.#ds}get clientX(){return this.#Fn}get clientY(){return this.#Zn}get latLng(){return this.#ns}get targetObjId(){return this.#ss}get haveParentNode(){return this.#rs}}class Cs{#_s;#ys;#bs;constructor(t,e,o){Object.freeze(this),this.#_s=t,this.#ys=e,this.#bs=o}get itemText(){return this.#_s}get isActive(){return this.#ys}doAction(){this.#bs()}}class Ps{#X;#Ls;#Ts;#Tt;#Es;constructor(t){this.#X="string"==typeof t?.name?N.sanitizeToJsString(t.name):"?",this.#Ls="string"==typeof t.icon?N.sanitizeToHtmlString(t?.icon).htmlString:"?",this.#Ts="string"==typeof t?.tooltip?N.sanitizeToHtmlString(t.tooltip).htmlString:"?",this.#Tt="number"==typeof t?.width?t.width:s.width,this.#Es="number"==typeof t?.height?t.height:s.height}get name(){return this.#X}get icon(){return this.#Ls}get tooltip(){return this.#Ts}get width(){return this.#Tt}get height(){return this.#Es}}class Os{#he;#ws;#Ms;constructor(t){if(Object.freeze(this),"string"!=typeof t?.title||"string"!=typeof t?.htmlBefore||t.htmlAfter&&"string"!=typeof t.htmlAfter)throw new Error("Invalid toolbar button");let e=(t.htmlBefore||"")+(t.htmlAfter||""),o=N.sanitizeToHtmlString(e).errorsString;if(""!==o)throw new Error("Invalid toolbar button : "+e+o);this.#he=N.sanitizeToHtmlString(t.title).htmlString,""===this.title&&(this.title="?"),this.#ws=t.htmlBefore||"",this.#Ms=t.htmlAfter||""}get title(){return this.#he}get htmlBefore(){return this.#ws}get htmlAfter(){return this.#Ms}}const Ns=new class{#xs;#Is;#Cs;constructor(){Object.freeze(this),this.#xs=[],this.#Is=new Map,this.#Cs=[]}get editionButtonsData(){return this.#xs}get preDefinedIconsData(){return this.#Cs}preDefinedIconDataAt(t){return this.#Cs[t]}preDefinedIconDataFromName(t){const e=this.#Is.get(t);return e?e.icon:""}loadJson(t){if(t.editionButtons&&t.editionButtons.forEach(t=>{try{let e=new Os(t);this.#xs.push(e)}catch(t){console.error(t.message)}}),t.preDefinedIconsList){t.preDefinedIconsList.forEach(t=>{const e=new Ps(t);this.#Is.set(e.name,e)}),this.#Cs.length=0;for(const t of this.#Is)this.#Cs.push(t[1]);this.#Cs=this.#Cs.sort((t,e)=>t.name.localeCompare(e.name))}}};class Ss{#Ps;#Os;#Ns;#Ss;#Ds(){this.#Os=W.create("select",{className:"travelnotes-note-dialog-select",id:"travelnotes-note-dialog-icon-selector"},this.#Ps),Ns.preDefinedIconsData.forEach(t=>{this.#Os.add(W.create("option",{text:t.name}))}),this.#Os.selectedIndex=f}#Zo(){this.#Ns=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("NoteDialogToolbar - Open a configuration file"),textContent:"ðŸ“‚"},this.#Ps)}#js(){Ns.editionButtonsData.forEach(t=>{const e=W.create("div",{dataset:{HtmlBefore:t.htmlBefore,HtmlAfter:t.htmlAfter},className:"travelnotes-note-dialog-editor-button"},this.#Ps);N.sanitizeToHtmlElement(t.title,e),this.#Ss.push(e)})}#ks(){this.#Ds(),this.#Zo(),this.#js()}#As(t){this.#Os.addEventListener("change",t.iconSelectorChange),this.#Ss.forEach(e=>{e.addEventListener("click",t.editionButtonsClick)}),this.#Ns.addEventListener("click",t.openCfgFileButtonClick,!1)}#Rs(t){this.#Os.removeEventListener("change",t.iconSelectorChange),this.#Ss.forEach(e=>{e.removeEventListener("click",t.editionButtonsClick)}),this.#Ns.removeEventListener("click",t.openCfgFileButtonClick,!1)}constructor(t){Object.freeze(this),this.#Ss=[],this.#Ps=W.create("div",{id:"travelnotes-note-dialog-toolbar-container"}),this.#ks(),this.#As(t)}destructor(t){this.#Rs(t)}update(t){this.#Rs(t),this.#Ps.textContent="",this.#Ss=[],this.#ks(),this.#As(t)}get rootHTMLElement(){return this.#Ps}}class Ds{#ns;#pi;constructor(t,e){Object.freeze(this),this.#ns=t,this.#pi=e}get latLng(){return this.#ns}get route(){return this.#pi}}class js extends bn{#Hs;constructor(t,e){super(),W.create("div",{textContent:t?.headerText||"",className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement),this.#Hs=W.create("textarea",{className:"travelnotes-text-area-control-text-area",placeholder:t?.placeholder||"",rows:t.rows||2,dataset:{Name:t?.datasetName||"TextAreaControl"}},W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),e.controlFocus&&this.#Hs.addEventListener("focus",e.controlFocus),e.controlInput&&this.#Hs.addEventListener("input",e.controlInput)}destructor(t){t.controlFocus&&this.#Hs.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#Hs.removeEventListener("input",t.controlInput)}get value(){return this.#Hs.value}set value(t){this.#Hs.value=t}}class ks extends bn{#Bs;#zs;constructor(t){super();const e=W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement);this.#zs=W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("AddressControl - Reset address"),textContent:"ðŸ”„"},e),W.create("text",{value:S.getText("AddressControl - Address")},e),this.#Bs=W.create("input",{type:"text",className:"travelnotes-adress-control-input-text",dataset:{Name:"address"}},W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),t.controlFocus&&this.#Bs.addEventListener("focus",t.controlFocus),t.controlInput&&this.#Bs.addEventListener("input",t.controlInput),t.addressButtonClick&&this.#zs.addEventListener("click",t.addressButtonClick)}destructor(t){t.controlFocus&&this.#Bs.removeEventListener("focus",t.controlFocus),t.controlInput&&this.#Bs.removeEventListener("input",t.controlInput),t.addressButtonClick&&this.#zs.removeEventListener("click",t.addressButtonClick)}get address(){return this.#Bs.value}set address(t){this.#Bs.value=t}}class As{searchPlaces=!0;searchWays=!0;searchRelations=!0;setGeometry=!0;constructor(){Object.seal(this)}}class Rs{#Pe;#Fs;#Zs;#Ks;#Us;#Vs;#Ws;#ns;#Xs;#Ys;#Gs;#qs(){this.#Zs.forEach(t=>{t.geometry=[[]],t.lat=a.defaultValue,t.lon=a.defaultValue;let e=0;t.nodes.forEach(o=>{const i=this.#Fs.get(o);t.geometry[0].push([i.lat,i.lon]),t.lat+=i.lat,t.lon+=i.lon,e++}),0!==e&&(t.lat/=e,t.lon/=e)}),this.#Ks.forEach(t=>{t.geometry=[[]],t.lat=a.defaultValue,t.lon=a.defaultValue;let e=0;t.members.forEach(o=>{if("way"===o.type){const i=this.#Zs.get(o.ref);t.geometry.push(i.geometry[0]),t.lat+=i.lat,t.lon+=i.lon,e++}}),0!==e&&(t.lat/=e,t.lon/=e)})}#Js(e){e.forEach(e=>{switch(e.type){case"node":if(this.#Fs.set(e.id,e),e?.tags?.place&&this.#Pe.searchPlaces&&this.#Ws[e.tags.place]&&e?.tags?.name){const t=Fn.pointsDistance(this.#ns,[e.lat,e.lon]),o=this.#Ws[e.tags.place];o.maxDistance>t&&o.distance>t&&(o.distance=t,o.name=e.tags.name)}break;case"way":this.#Pe.searchWays&&this.#Zs.set(e.id,e);break;case"relation":this.#Pe.searchRelations&&this.#Ks.set(e.id,e);break;case"area":if(this.#Pe.searchPlaces){let o=e.tags.name;"*"!==t.nominatim.language&&e.tags["name:"+t.nominatim.language]&&(o=e.tags["name:"+t.nominatim.language]),this.#Us[Number.parseInt(e.tags.admin_level)]=o,"2"===e.tags.admin_level&&(this.#Vs=t.geoCoder.osmCityAdminLevel[e.tags["ISO3166-1"]]||this.#Vs)}}}),this.#Pe.setGeometry&&this.#qs(),this.#Pe.searchPlaces&&this.#$s()}#$s(){let t=null;for(let e=2;e<this.#Us.length;e++)void 0!==this.#Us[e]&&(this.#Vs>=e?this.#Ys=this.#Us[e]:t=this.#Us[e]);let e=Number.MAX_VALUE;Object.values(this.#Ws).forEach(t=>{t.distance<e&&(e=t.distance,this.#Xs=t.name)}),this.#Xs=t||this.#Xs,this.#Xs===this.#Ys&&(this.#Xs=null)}async#Qs(t){for(let e=0;e<t.length;e++)if("fulfilled"===t[e].status&&p===t[e].value.status&&t[e].value.ok){const o=await t[e].value.json();this.#Js(o.elements)}else this.#Gs=!1,console.error("An error occurs when calling theOverpassAPI: "),console.error(t[e])}constructor(t){if(Object.freeze(this),this.#Pe=new As,t)for(const[e,o]of Object.entries(t))this.#Pe[e]&&(this.#Pe[e]=o);this.#Fs=new Map,this.#Zs=new Map,this.#Ks=new Map}async loadData(e,o){this.#ns=o,this.#Gs=!0,this.#Us=[],this.#Vs=t.geoCoder.osmCityAdminLevel.DEFAULT,this.#Ws=Object.freeze({hamlet:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.hamlet}),village:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.village}),city:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.city}),town:Object.seal({name:null,distance:Number.MAX_VALUE,maxDistance:t.geoCoder.distances.town})}),this.#Xs=null,this.#Ys=null,this.#Fs.clear(),this.#Zs.clear(),this.#Ks.clear();const i=[];e.forEach(e=>{i.push(fetch(t.overpassApi.url+"?data=[out:json][timeout:"+t.overpassApi.timeOut+"];"+e))}),await Promise.allSettled(i).then(t=>this.#Qs(t))}get nodes(){return this.#Fs}get ways(){return this.#Zs}get relations(){return this.#Ks}get place(){return this.#Xs}get city(){return this.#Ys}get country(){return this.#Us[2]}get statusOk(){return this.#Gs}}class Hs{#tr=!1;#X="";#er="";#Ys="";#or="";#ir(t,e){t.error||e.error?this.#tr=!1:(this.#X=e?.namedetails?.name??"",e.address.house_number&&(this.#er=e.address.house_number+" "),e.address.road?this.#er+=e.address.road+" ":e.address.pedestrian&&(this.#er+=e.address.pedestrian+" "),this.#Ys=t.address.city||t.address.town||t.address.municipality||t.address.village||"",this.#or=e.address.country,this.#tr=!0)}constructor(){Object.freeze(this)}async loadData(e){this.#tr=!1;const o=t.nominatim.url+"reverse?format=json&lat="+e[0]+"&lon="+e[1];let i=o+"&zoom=10&addressdetails=1&namedetails=0",n=o+"&zoom=18&addressdetails=1&namedetails=1";const s=t.nominatim.language;s&&"*"!==s&&(i+="&accept-language="+s,n+="&accept-language="+s);const r=new Headers;s&&"*"===s&&r.append("accept-language","");const a=await fetch(i,{headers:r}),l=await fetch(n,{headers:r});p===a.status&&a.ok&&p===l.status&&l.ok?this.#ir(await a.json(),await l.json()):this.#tr=!1}get name(){return this.#tr?this.#X:null}get street(){return this.#tr?this.#er:null}get city(){return this.#tr?this.#Ys:null}get country(){return this.#tr?this.#or:null}}class Bs{#X;#er;#Ys;constructor(t,e,o){Object.freeze(this),this.#X=N.sanitizeToJsString(t),this.#er=N.sanitizeToJsString(e),this.#Ys=N.sanitizeToJsString(o)}get name(){return this.#X}get street(){return this.#er}get city(){return this.#Ys}}class zs{static get#nr(){return Math.max(t.geoCoder.distances.hamlet,t.geoCoder.distances.village,t.geoCoder.distances.city,t.geoCoder.distances.town)}#ns;#sr;#rr;#ar(){let t=this.#rr.city||this.#rr.country||"";const e=this.#sr.place;e&&e!==t&&(t+=" ("+e+")");let o=(this.#rr.street||"").replaceAll(";"," "),i=this.#rr.name||"";return(o.includes(i)||t.includes(i))&&(i=""),new Bs(i,o,t)}#lr(){return["node(around:"+zs.#nr+","+this.#ns[0]+","+this.#ns[1]+")[place];out;"]}async#hr(){return await this.#sr.loadData(this.#lr(),this.#ns),await this.#rr.loadData(this.#ns),this.#ar()}async#cr(t,e){t(await this.#hr())}constructor(){Object.freeze(this),this.#sr=new Rs({searchWays:!1,searchRelations:!1,setGeometry:!0}),this.#rr=new Hs({searchPlaces:!0,searchWays:!1,searchRelations:!1,setGeometry:!1})}async getAddressAsync(t){return this.#ns=t,this.#hr()}getAddressWithPromise(t){return this.#ns=t,new Promise((t,e)=>this.#cr(t,e))}}class Fs{#dr;#ur(t){this.#dr.hideWait();let e=t.street;""!==t.city&&(e+=" "+t.city),this.#dr.setControlsValues({address:e,name:t.name}),this.#dr.updatePreview&&this.#dr.updatePreview({address:e})}constructor(t){Object.freeze(this),this.#dr=t}setAddressWithGeoCoder(t){this.#dr.showWait(),this.#dr.hideError(),(new zs).getAddressWithPromise(t).then(t=>{this.#ur(t)}).catch(t=>{t&&console.error(t),this.#dr.hideWait(),this.#dr.showError(S.getText("NoteDialogGeoCoderHelper - an error occurs when searching the adress"))})}}class Zs extends bn{#mr=null;#pr=null;constructor(t){super(),W.create("text",{value:S.getText("NoteDialogIconDimsControl - Icon width")},this.controlHTMLElement),this.#mr=W.create("input",{type:"number",className:"travelnotes-note-dialog-number-input",value:s.width,dataset:{Name:"iconWidth"}},this.controlHTMLElement),W.create("text",{value:S.getText("NoteDialogIconDimsControl - Icon height")},this.controlHTMLElement),this.#pr=W.create("input",{type:"number",className:"travelnotes-note-dialog-number-input",value:s.height,dataset:{Name:"iconHeight"}},this.controlHTMLElement),this.#mr.addEventListener("input",t.controlInput),this.#pr.addEventListener("input",t.controlInput)}destructor(t){this.#mr.removeEventListener("input",t.controlInput),this.#pr.removeEventListener("input",t.controlInput)}get iconWidth(){return Number.parseInt(this.#mr.value)}set iconWidth(t){this.#mr.value=t}get iconHeight(){return Number.parseInt(this.#pr.value)}set iconHeight(t){this.#pr.value=t}}class Ks extends bn{#gr;#vr(e,o){t.noteDialog.theDevil.addButton&&W.create("text",{value:"ðŸ‘¿"},W.create("a",{href:"https://www.google.com/maps/@"+e[0].toFixed(a.fixed)+","+e[1].toFixed(a.fixed)+","+t.noteDialog.theDevil.zoomFactor+"z",target:"_blank",title:"Reminder! The devil will know everything about you"},W.create("div",{className:"travelnotes-base-dialog-button",title:"Reminder! The devil will know everything about you"},o)))}constructor(t,e){super();const o=W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement);this.#vr(e,o),W.create("text",{value:S.getText("NoteDialogLinkControl - Link")},o),this.#gr=W.create("input",{type:"text",className:"travelnotes-note-dialog-input-text",dataset:{Name:"url"}},W.create("div",{className:"travelnotes-base-dialog-flex-row"},this.controlHTMLElement)),this.#gr.addEventListener("focus",t.controlFocus),this.#gr.addEventListener("input",t.controlInput),this.#gr.addEventListener("blur",t.urlInputBlur)}destructor(t){this.#gr.removeEventListener("focus",t.controlFocus),this.#gr.removeEventListener("input",t.controlInput),this.#gr.removeEventListener("blur",t.urlInputBlur)}get url(){return this.#gr.value}set url(t){this.#gr.value=t}}class Us{static get#fr(){return 40}static get#_r(){return 40}constructor(){Object.freeze(this)}getNoteTextAndIconHTML(e,o){const i=W.create("div",{dataset:{ObjId:o.note.objId}}),n=W.create("div",{className:e+(o.route?"route-maneuvers-and-notes-icon-cell":"travel-notes-icon-cell")},i);let r=1;N.sanitizeToHtmlElement(o.note.iconContent,n),"travelnotes-roadbook-"===e&&n.firstChild&&("svg"===n.firstChild.tagName?(n.firstChild.setAttributeNS(null,"viewBox","0 0 "+s.svgViewboxDim+" "+s.svgViewboxDim),r=t.note.svgIcon.roadbookFactor):n?.firstChild?.classList?.contains("travelnotes-map-note-category-0073")&&(r=t.note.svgIcon.roadbookFactor)),n.dataset.tanWidth=String(o.note.iconWidth*r)+"px",n.dataset.tanHeight=String(o.note.iconHeight*r)+"px",n.style.width=String(o.note.iconWidth*r)+"px",n.style.height=String(o.note.iconHeight*r)+"px";const a=this.getNoteTextHTML(e,o);return a.className=e+(o.route?"route-maneuvers-and-notes-cell":"travel-notes-cell"),i.appendChild(a),i}getNoteTextHTML(t,e){const o=e.note,i=W.create("div");if(0!==o.tooltipContent.length&&N.sanitizeToHtmlElement(o.tooltipContent,W.create("div",{className:t+"note-html-tooltip-content"},i)),0!==o.popupContent.length&&N.sanitizeToHtmlElement(o.popupContent,W.create("div",{className:t+"note-html-popup-content"},i)),0!==o.address.length&&N.sanitizeToHtmlElement("<span>"+S.getText("NoteHTMLViewsFactory - Address")+"</span>Â :Â "+o.address,W.create("div",{className:t+"note-html-address"},i)),0!==o.url.length&&N.sanitizeToHtmlElement("<span>"+S.getText("NoteHTMLViewsFactory - Link")+"</span><a href="+o.url+' target="_blank" >'+o.url.substring(0,Us.#fr)+"...</a>",W.create("div",{className:t+"note-html-url"},i)),0!==o.phone.length){let e=o.phone;if(o.phone.match(/^\+[0-9, ,*,\u0023]*$/)){const t=o.phone.replaceAll(/\u0020/g,""),i=o.phone.replaceAll(/\u0020/g,"Â ");e=S.getText("NoteHTMLViewsFactory - Phone")+"Â :Â "+S.getText("NoteHTMLViewsFactory - call")+'<a target="_blank" href="tel:'+t+'" >'+i+"</a>"+S.getText("NoteHTMLViewsFactory - Send a sms to")+'<a target="_blank" href="sms:'+t+'" >'+i+"</a>"}else e=S.getText("NoteHTMLViewsFactory - Phone")+"Â :Â "+o.phone;N.sanitizeToHtmlElement(e,W.create("div",{className:t+"note-html-phone"},i))}if(N.sanitizeToHtmlElement(D.formatLatLng(o.latLng),W.create("div",{className:t+"note-html-lat-lng"},i)),e.route){e.route.chain&&N.sanitizeToHtmlElement("<span>"+S.getText("NoteHTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+D.formatDistance(o.chainedDistance+o.distance),W.create("div",{className:t+"note-html-travel-distance"},i)),N.sanitizeToHtmlElement("<span>"+S.getText("NoteHTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+D.formatDistance(o.distance),W.create("div",{className:t+"note-html-route-distance"},i));const n=e.route.notes.next(o.objId);if(n){const e=n.distance-o.distance;Us.#_r<e&&N.sanitizeToHtmlElement("<span>"+S.getText("NoteHTMLViewsFactory - Next note after")+"</span>Â :Â "+D.formatDistance(e),W.create("div",{className:t+"note-html-next-distance"},i))}}return i}getTravelNotesHTML(t){const e=W.create("div",{className:t+"travel-notes"}),o=U.travel.notes.iterator;for(;!o.done;){const i=this.getNoteTextAndIconHTML(t,{note:o.value,route:null});i.className=t+"travel-notes-row",e.appendChild(i)}return e}}const Vs=new Us;class Ws{#yr;#br;constructor(t){Object.freeze(this),this.#br=t,this.#yr=W.create("div",{className:"travelnotes-note-dialog-preview-container"}),this.#yr.appendChild(Vs.getNoteTextAndIconHTML("travelnotes-note-dialog-",new Zn(this.#br,null)))}update(){this.#yr.textContent="",this.#yr.appendChild(Vs.getNoteTextAndIconHTML("travelnotes-note-dialog-",{note:this.#br,route:null}))}get HTMLElements(){return[this.#yr]}}class Xs{#Lr;constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){t.stopPropagation(),"url"===t.target.dataset.tanName?this.#Lr.focusControl=null:this.#Lr.focusControl=t.target}}class Ys{#Lr;constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){t.stopPropagation();const e={};"iconWidth"===t.target.dataset.tanName||"iconHeight"===t.target.dataset.tanName?e[t.target.dataset.tanName]=Number.parseInt(t.target.value):e[t.target.dataset.tanName]=t.target.value,this.#Lr.updatePreview(e)}}class Gs{#dr;#ns;constructor(t,e){Object.freeze(this),this.#dr=t,this.#ns=e}handleEvent(t){t.stopPropagation(),new Fs(this.#dr).setAddressWithGeoCoder(this.#ns)}}class qs{#Lr;constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){if(t.stopPropagation(),""===t.target.value)return void this.#Lr.hideError();""===N.sanitizeToUrl(t.target.value).errorsString?this.#Lr.hideError():this.#Lr.showError(S.getText("UrlInputBlurEL - invalidUrl"))}}class Js{#Lr;constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){if(!this.#Lr.focusControl)return;const e=t.currentTarget;let o=this.#Lr.focusControl.selectionStart,i=this.#Lr.focusControl.selectionEnd;this.#Lr.focusControl.value=this.#Lr.focusControl.value.slice(0,o)+e.dataset.tanHtmlBefore+(0===e.dataset.tanHtmlAfter.length?"":this.#Lr.focusControl.value.slice(o,i))+e.dataset.tanHtmlAfter+this.#Lr.focusControl.value.slice(i),o===i||0===e.dataset.tanHtmlAfter.length?(o+=e.dataset.tanHtmlBefore.length,i=o):i+=e.dataset.tanHtmlBefore.length+e.dataset.tanHtmlAfter.length,this.#Lr.focusControl.setSelectionRange(o,i),this.#Lr.focusControl.focus();const n={};n[this.#Lr.focusControl.dataset.tanName]=this.#Lr.focusControl.value,this.#Lr.updatePreview(n)}}class $s{#Tr;#sr;#Er;#wr(){this.#Er=document.createElementNS(_,"svg"),this.#Er.setAttributeNS(null,"viewBox",String(s.svgViewboxDim/4)+" "+s.svgViewboxDim/4+" "+s.svgViewboxDim/2+" "+s.svgViewboxDim/2),this.#Er.setAttributeNS(null,"class","travelnotes-svg-icon")}#Mr(){let e=-1,o=f,i=f;const n=[];if(this.#Tr.route.itinerary.itineraryPoints.forEach(r=>{e++;const a=rn.addPoints(rn.project(r.latLng,t.note.svgIcon.zoom),this.#Tr.translation);n.push(a);a[0]>=0&&a[1]>=0&&a[0]<=s.svgViewboxDim&&a[1]<=s.svgViewboxDim&&(f===o&&(o=e),i=e)}),f!==o&&f!==i){0<o&&o--,this.#Tr.route.itinerary.itineraryPoints.length-1>i&&i++;let t="";for(e=o;e<=i;e++)t+=n[e][0].toFixed(0)+","+n[e][1].toFixed(0)+" ";const r=document.createElementNS(_,"polyline");r.setAttributeNS(null,"points",t),r.setAttributeNS(null,"class","travelnotes-osm-itinerary"),r.setAttributeNS(null,"transform","rotate("+this.#Tr.rotation+","+s.svgViewboxDim/2+","+s.svgViewboxDim/2+")"),this.#Er.appendChild(r)}}#xr(){this.#sr.ways.forEach(e=>{let o=f,i=f,n=-1;const r=[];if(e.nodes.forEach(e=>{n++;const a=this.#sr.nodes.get(e),l=rn.addPoints(rn.project([a.lat,a.lon],t.note.svgIcon.zoom),this.#Tr.translation);r.push(l);l[0]>=0&&l[1]>=0&&l[0]<=s.svgViewboxDim&&l[1]<=s.svgViewboxDim&&(f===o&&(o=n),i=n)}),f!==o&&f!==i){0<o&&o--,e.nodes.length-1>i&&i++;let t="";for(n=o;n<=i;n++)t+=r[n][0].toFixed(0)+","+r[n][1].toFixed(0)+" ";const a=document.createElementNS(_,"polyline");a.setAttributeNS(null,"points",t),a.setAttributeNS(null,"class","travelnotes-osm-highway travelnotes-osm-highway-"+e.tags.highway.replaceAll(/_/g,"-")),a.setAttributeNS(null,"transform","rotate("+this.#Tr.rotation+","+s.svgViewboxDim/2+","+s.svgViewboxDim/2+")"),this.#Er.appendChild(a)}})}#Ir(){if(""===this.#Tr.rcnRef)return;const t=document.createElementNS(_,"text");t.textContent=this.#Tr.rcnRef,t.setAttributeNS(null,"x",String(s.svgViewboxDim/2)),t.setAttributeNS(null,"y",String(s.svgViewboxDim/2)),t.setAttributeNS(null,"class","travelnotes-osm-rcn-ref"),this.#Er.appendChild(t)}constructor(){Object.freeze(this)}buildSvg(t,e,o){this.#Tr=t,this.#sr=o,this.#wr(),this.#Mr(),this.#xr(),this.#Ir(),e.iconContent=this.#Er.outerHTML}}class Qs{isMini;isEntry;isExit;constructor(){Object.seal(this),this.isMini=!1,this.isEntry=!1,this.isExit=!1}}class tr{#Tr;#Cr;#sr;#Pr;#Or;#Nr;#Sr;#Dr;#jr;#kr;#Ar;#Rr(t){return(t.tags.name?t.tags.name:"")+(t.tags.name&&t.tags.ref?" ":"")+(t.tags.ref?"["+t.tags.ref+"]":"")}#Hr(t){const e=5e-6;let o=!1;return this.#Tr.route.wayPoints.forEach(i=>{Math.abs(t.lat-i.lat)<e&&Math.abs(t.lng-i.lng)<e&&(o=!0)}),!o&&(this.#Cr.latLng[0]!==t.lat||this.#Cr.latLng[1]!==t.lng)}#Br(){const e=this.#Tr.route.itinerary.itineraryPoints.previous(this.#Tr.nearestItineraryPointObjId,t=>this.#Hr(t)),i=this.#Tr.route.itinerary.itineraryPoints.next(this.#Tr.nearestItineraryPointObjId,t=>this.#Hr(t));let n=Number.MAX_VALUE,s=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MAX_VALUE,l=o.defaultValue;this.#sr.nodes.forEach(o=>{l=Fn.pointsDistance([o.lat,o.lon],this.#Cr.latLng),"bike"===this.#Tr.route.itinerary.transitMode&&o?.tags?.rcn_ref&&o.tags["network:type"]&&"node_network"===o.tags["network:type"]&&l<t.note.svgIcon.rcnRefDistance&&l<s&&(this.#Pr=o,s=l),l<n&&(this.#Nr=o.id,n=l),e&&(l=Fn.pointsDistance([o.lat,o.lon],e.latLng),l<r&&(this.#Sr=o.id,r=l)),i&&(l=Fn.pointsDistance([o.lat,o.lon],i.latLng),l<a&&(this.#Dr=o.id,a=l))}),this.#Or=this.#sr.nodes.get(this.#Nr)}#zr(){this.#Ar.isMini="mini_roundabout"===this?.#Or?.tags?.highway}#Fr(){this.#Pr&&(this.#Tr.rcnRef=this.#Pr.tags.rcn_ref,this.#Cr.tooltipContent+=S.getText("StreetFinder - rcnRef",{rcnRef:this.#Tr.rcnRef}))}#Zr(){this.#sr.ways.forEach(t=>{if(!t.nodes.includes(this.#Nr))return;const e=this.#Rr(t),o=""!==e,i=t.nodes.includes(this.#Sr),n=t.nodes.includes(this.#Dr);let s=2*t.nodes.filter(t=>t===this.#Nr).length;if(t.nodes[0]===this.#Nr&&s--,t.nodes[t.nodes.length-1]===this.#Nr&&s--,i&&(this.#jr=o?e:"???",s--,"roundabout"===t?.tags?.junction&&(this.#Ar.isExit=!0)),0!==s&&(n&&(this.#kr=o?e:"???",s--,"roundabout"===t?.tags?.junction&&(this.#Ar.isEntry=!0)),0!==s&&o))for(;0!==s;)this.#Cr.address=""===this.#Cr.address?e:this.#Cr.address+" âª¥  "+e,s--})}#Kr(){""!==this.#sr.city&&(this.#Cr.address+=' <span class="travelnotes-note-html-address-city">'+this.#sr.city+"</span>"),this.#sr.place&&this.#sr.place!==this.#sr.city&&(this.#Cr.address+=" ("+this.#sr.place+")")}#Ur(){r.atStart===this.#Tr.positionOnRoute?(this.#Cr.address="ðŸŸ¢ "+this.#kr,this.#Kr()):r.atEnd===this.#Tr.positionOnRoute?(this.#Kr(),this.#Cr.address=this.#jr,this.#Kr(),this.#Cr.address+=" ðŸ”´ "):(this.#Cr.address=this.#jr+(""===this.#Cr.address?"":" âª¥  "+this.#Cr.address)+" "+this.#Tr.directionArrow+" "+this.#kr,this.#Kr())}#Vr(){this.#Ar.isEntry&&!this.#Ar.isExit?this.#Cr.tooltipContent+=S.getText("StreetFinder - entry roundabout"):!this.#Ar.isEntry&&this.#Ar.isExit?this.#Cr.tooltipContent+=S.getText("StreetFinder - exit roundabout"):this.#Ar.isEntry&&this.#Ar.isExit&&(this.#Cr.tooltipContent+=S.getText("StreetFinder - continue roundabout")),this.#Ar.isMini&&(this.#Cr.tooltipContent+=S.getText("StreetFinder - at the small roundabout on the ground"))}constructor(){Object.freeze(this)}findData(t,e,o){this.#Tr=t,this.#Cr=e,this.#sr=o,this.#Nr=f,this.#Sr=f,this.#Dr=f,this.#jr="",this.#kr="",this.#Ar=new Qs,this.#Br(),this.#zr(),this.#Fr(),this.#Zr(),this.#Ur(),this.#Vr()}}class er{constructor(){Object.freeze(this)}findData(e,o){null!==e.direction&&(e.direction<t.note.svgIcon.angleDirection.right?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn right"),e.directionArrow="ðŸ¢‚"):e.direction<t.note.svgIcon.angleDirection.slightRight?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn slight right"),e.directionArrow="ðŸ¢…"):e.direction<t.note.svgIcon.angleDirection.continue?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Continue"),e.directionArrow="ðŸ¢"):e.direction<t.note.svgIcon.angleDirection.slightLeft?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn slight left"),e.directionArrow="ðŸ¢„"):e.direction<t.note.svgIcon.angleDirection.left?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn left"),e.directionArrow="ðŸ¢€"):e.direction<t.note.svgIcon.angleDirection.sharpLeft?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn sharp left"),e.directionArrow="ðŸ¢‡"):e.direction<t.note.svgIcon.angleDirection.sharpRight?(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn sharp right"),e.directionArrow="ðŸ¢†"):(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Turn right"),e.directionArrow="ðŸ¢‚")),r.atStart===e.positionOnRoute?o.tooltipContent=S.getText("ArrowAndTooltipFinder - Start"):r.atEnd===e.positionOnRoute&&(o.tooltipContent=S.getText("ArrowAndTooltipFinder - Stop"))}}class or{#Tr;#Cr;#Wr;#Xr;#Yr;#Gr(){this.#Tr.translation=rn.subtrackPoints([s.svgViewboxDim/2,s.svgViewboxDim/2],rn.project(this.#Cr.latLng,t.note.svgIcon.zoom))}#qr(){this.#Wr=this.#Tr.route.itinerary.itineraryPoints.previous(this.#Tr.nearestItineraryPointObjId,e=>Fn.pointsDistance(e.latLng,this.#Cr.latLng)>t.note.svgIcon.angleDistance)||this.#Tr.route.itinerary.itineraryPoints.first}#Jr(){this.#Xr=this.#Tr.route.itinerary.itineraryPoints.next(this.#Tr.nearestItineraryPointObjId,e=>Fn.pointsDistance(e.latLng,this.#Cr.latLng)>t.note.svgIcon.angleDistance)||this.#Tr.route.itinerary.itineraryPoints.last}#$r(){this.#Yr=rn.addPoints(rn.project(this.#Cr.latLng,t.note.svgIcon.zoom),this.#Tr.translation)}#Qr(){if(this.#Tr.nearestItineraryPointObjId!==this.#Tr.route.itinerary.itineraryPoints.first.objId){const o=rn.addPoints(rn.project(this.#Wr.latLng,t.note.svgIcon.zoom),this.#Tr.translation);this.#Tr.rotation=Math.atan((this.#Yr[1]-o[1])/(o[0]-this.#Yr[0]))*e.d180/Math.PI,0>this.#Tr.rotation&&(this.#Tr.rotation+=e.d360),this.#Tr.rotation-=e.d270,0>o[0]-this.#Yr[0]&&(this.#Tr.rotation+=e.d180)}}#ta(){if(this.#Tr.nearestItineraryPointObjId!==this.#Tr.route.itinerary.itineraryPoints.last.objId){const o=rn.addPoints(rn.project(this.#Xr.latLng,t.note.svgIcon.zoom),this.#Tr.translation);for(this.#Tr.direction=Math.atan((this.#Yr[1]-o[1])/(o[0]-this.#Yr[0]))*e.d180/Math.PI,0>o[0]-this.#Yr[0]&&(this.#Tr.direction+=e.d180),this.#Tr.direction-=this.#Tr.rotation;e.d0>this.#Tr.direction;)this.#Tr.direction+=e.d360;for(;e.d360<this.#Tr.direction;)this.#Tr.direction-=e.d360}}#ea(){this.#Tr.nearestItineraryPointObjId===this.#Tr.route.itinerary.itineraryPoints.first.objId&&(this.#Tr.rotation=-this.#Tr.direction-e.d90,this.#Tr.direction=null,this.#Tr.positionOnRoute=r.atStart),this.#Cr.latLng[0]===this.#Tr.route.itinerary.itineraryPoints.last.lat&&this.#Cr.latLng[1]===this.#Tr.route.itinerary.itineraryPoints.last.lng&&(this.#Tr.direction=null,this.#Tr.positionOnRoute=r.atEnd)}constructor(){Object.freeze(this)}findData(t,e){this.#Tr=t,this.#Cr=e,this.#Gr(),this.#qr(),this.#Jr(),this.#$r(),this.#Qr(),this.#ta(),this.#ea()}}class ir{constructor(){Object.seal(this)}iconContent="";tooltipContent="";address="";latLng=[a.defaultValue,a.defaultValue]}class nr{constructor(){Object.seal(this)}nearestItineraryPointObjId=g;route=null;positionOnRoute=r.onRoute;direction=null;directionArrow=" ";rcnRef="";rotation=0;translation=[0,0]}class sr{#Cr;#Tr;#sr;#nr;#oa;static get#ia(){return 1.5}#na(){let t=null,e=Number.MAX_VALUE;this.#Tr.route.itinerary.itineraryPoints.forEach(o=>{const i=Fn.pointsDistance(this.#Cr.latLng,o.latLng);e>i&&(e=i,t=o)}),this.#Cr.latLng=t.latLng,this.#Tr.nearestItineraryPointObjId=t.objId}#sa(){return(new or).findData(this.#Tr,this.#Cr),(new er).findData(this.#Tr,this.#Cr),(new tr).findData(this.#Tr,this.#Cr,this.#sr),(new $s).buildSvg(this.#Tr,this.#Cr,this.#sr),this.#oa=!1,this.#Cr}async#ra(){if(this.#oa)return null;this.#oa=!0,this.#Tr.nearestItineraryPointObjId=g,this.#Tr.positionOnRoute=r.onRoute,this.#Tr.direction=null,this.#Tr.directionArrow=" ",this.#Tr.translation=[0,0],this.#Tr.rotation=0,this.#Tr.rcnRef="",this.#Cr.iconContent="",this.#Cr.tooltipContent="",this.#Cr.address="",this.#na();const t=this.#Cr.latLng[0].toFixed(a.fixed)+","+this.#Cr.latLng[1].toFixed(a.fixed),e=["way[highway](around:"+(s.svgViewboxDim*sr.#ia).toFixed(0)+","+t+")->.a;(.a >;.a;)->.a;.a out;is_in("+t+')->.e;area.e[admin_level][boundary="administrative"];out;node(around:'+this.#nr+","+t+")[place];out;"];return await this.#sr.loadData(e,this.#Cr.latLng),this.#sr.statusOk?this.#sa():null}async#aa(t,e){const o=await this.#ra();o?t(o):e("An error occurs...")}constructor(){Object.freeze(this),this.#Cr=new ir,this.#Tr=new nr,this.#sr=new Rs({searchRelations:!1,setGeometry:!1}),this.#nr=Math.max(t.geoCoder.distances.hamlet,t.geoCoder.distances.village,t.geoCoder.distances.city,t.geoCoder.distances.town),this.#oa=!1}async getIconAndAdressAsync(t,e){return this.#Cr.latLng=t,this.#Tr.route=e,this.#ra()}getIconAndAdressWithPromise(t){return this.#Cr.latLng=t.latLng,this.#Tr.route=t.route,new Promise((t,e)=>this.#aa(t,e))}}class rr{#Lr;#la(t){this.#Lr.setControlsValues(t),this.#Lr.updatePreview(t)}#ha(){const t=this.#Lr.mapIconData;t.route?(this.#Lr.hideError(),this.#Lr.showWait(),(new sr).getIconAndAdressWithPromise(t).then(t=>{this.#Lr.hideWait(),this.#la(t)}).catch(t=>{t instanceof Error&&console.error(t),this.#Lr.hideWait(),this.#Lr.showError(S.getText("IconSelectorChangeEL - an error occurs when creating the SVG icon"))})):this.#Lr.showError(S.getText("IconSelectorChangeEL - not possible to create a SVG icon for a travel note"))}constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){t.stopPropagation();const e=Ns.preDefinedIconDataAt(t.target.selectedIndex);"SvgIcon"!==e.icon?(this.#la({iconContent:e.icon,iconHeight:e.height,iconWidth:e.width,tooltipContent:e.tooltip}),this.#Lr.setAddress()):this.#ha()}}class ar{#Lr;constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){t.stopPropagation();const e=new FileReader;e.onload=()=>{try{Ns.loadJson(JSON.parse(e.result)),this.#Lr.updateToolbar()}catch(t){t instanceof Error&&console.error(t)}},e.readAsText(t.target.files[0])}}class lr{#Lr;constructor(t){Object.freeze(this),this.#Lr=t}handleEvent(t){t.stopPropagation(),D.openFile(new ar(this.#Lr),".json")}}class hr{#ca;#da;#ua;#ma;#pa;#ga;#va;constructor(t,e){Object.freeze(this),this.#ca=new Xs(t),this.#da=new Ys(t),this.#ua=new Gs(t,e),this.#ma=new qs(t),this.#pa=new Js(t),this.#ga=new rr(t),this.#va=new lr(t)}destructor(){this.#ca=null,this.#da=null,this.#ua=null,this.#ma=null,this.#pa=null,this.#ga=null,this.#va=null}get controlFocus(){return this.#ca}get controlInput(){return this.#da}get addressButtonClick(){return this.#ua}get urlInputBlur(){return this.#ma}get editionButtonsClick(){return this.#pa}get iconSelectorChange(){return this.#ga}get openCfgFileButtonClick(){return this.#va}}class cr extends fn{#mi;#pi;#br;#fa;#_a;#ya;#ba;#La;#Ta;#Ea;#wa;#oi;#Ma;#xa;#ke(){this.#oi.destructor(this.#xa),this.#fa.destructor(this.#xa),this.#_a.destructor(this.#xa),this.#ya.destructor(this.#xa),this.#ba.destructor(this.#xa),this.#La.destructor(this.#xa),this.#Ta.destructor(this.#xa),this.#Ea.destructor(this.#xa),this.#xa.destructor()}constructor(t,e){super(),this.#Ma=null,this.#mi=t,this.#pi=e,this.#br=new z,this.#br.jsonObject=t.jsonObject}createContentHTML(){this.#xa=new hr(this,this.#br.latLng),this.#oi=new Ss(this.#xa),this.#fa=new Zs(this.#xa),this.#_a=new js({placeholder:"?????",datasetName:"iconContent",headerText:S.getText("NoteDialogIconControl - Icon content")},this.#xa),this.#ya=new is({headerText:S.getText("NoteDialogTooltipControl - Tooltip content"),datasetName:"tooltipContent"},this.#xa),this.#ba=new js({rows:t.noteDialog.areaHeight.popupContent,datasetName:"popupContent",headerText:S.getText("NoteDialogPopupControl - Text")},this.#xa),this.#La=new ks(this.#xa),this.#Ta=new Ks(this.#xa,this.#br.latLng),this.#Ea=new is({headerText:S.getText("NoteDialogPhoneControl - Phone"),datasetName:"phone"},this.#xa),this.#wa=new Ws(this.#br),this.setControlsValues(this.#br)}get focusControl(){return this.#Ma}set focusControl(t){this.#Ma=t}get mapIconData(){return new Ds(this.#br.latLng,this.#pi)}updatePreview(t){for(const e in t)this.#br[e]=t[e];this.#wa.update()}setAddress(){""===this.#mi.address&&new Fs(this).setAddressWithGeoCoder(this.#br.latLng)}canClose(){return""===this.#_a.value?(this.showError(S.getText("Notedialog - The icon content cannot be empty")),!1):""===this.#Ta.url||""!==N.sanitizeToUrl(this.#Ta.url).url||(this.showError(S.getText("NoteDialog - invalidUrl")),!1)}onCancel(){this.#ke(),super.onCancel()}onOk(){super.onOk()&&(this.#mi.iconWidth=this.#fa.iconWidth,this.#mi.iconHeight=this.#fa.iconHeight,this.#mi.iconContent=this.#_a.value,this.#mi.tooltipContent=this.#ya.value,this.#mi.popupContent=this.#ba.value,this.#mi.address=this.#La.address,this.#mi.url=this.#Ta.url,this.#mi.phone=this.#Ea.value,this.#mi.latLng=this.#br.latLng,this.#ke())}get title(){return S.getText("NoteDialog - Note")}get toolbarHTMLElement(){return this.#oi.rootHTMLElement}get contentHTMLElements(){return[this.#fa.controlHTMLElement,this.#_a.controlHTMLElement,this.#ya.controlHTMLElement,this.#ba.controlHTMLElement,this.#La.controlHTMLElement,this.#Ta.controlHTMLElement,this.#Ea.controlHTMLElement]}get footerHTMLElements(){return this.#wa.HTMLElements}setControlsValues(t){this.#fa.iconHeight=t.iconHeight||this.#fa.iconHeight,this.#fa.iconWidth=t.iconWidth||this.#fa.iconWidth,this.#_a.value=t.iconContent||this.#_a.value,this.#ya.value=t.tooltipContent||this.#ya.value,this.#ba.value=t.popupContent||this.#ba.value,this.#La.address=t.address||this.#La.address,this.#Ta.url=t.url||this.#Ta.url,this.#Ea.value=t.phone||this.#Ea.value}updateToolbar(){this.#oi.update(this.#xa)}}class dr{#Ia;#Ca;constructor(){Object.freeze(this)}createUI(){if(this.#Ia)return;this.#Ia=W.create("div",{className:"travelnotes-background"},document.body);const t=W.create("div",{id:"travelnotes-wait-ui"},this.#Ia);this.#Ca=W.create("div",{id:"travelnotes-wait-ui-message"},t),W.create("div",{className:"travelnotes-wait-animation-bullet"},W.create("div",{className:"travelnotes-wait-animation"},t))}showInfo(t){this.#Ca.textContent=t}close(){document.body.removeChild(this.#Ia),this.#Ia=null}}class ur{#Pa=[];#Oa(t){this.#Pa.push(t.latLng),this.#Pa.push(t.iconLatLng)}#Na(t){t.itinerary.itineraryPoints.forEach(t=>this.#Pa.push(t.latLng)),t.notes.forEach(t=>this.#Oa(t))}constructor(){Object.freeze(this)}zoomToLatLng(t){Bn.dispatch("zoomto",{latLng:t})}zoomToNote(t){this.#Pa=[],this.#Oa(Un.getNoteAndRoute(t).note),Bn.dispatch("zoomto",{geometry:[this.#Pa]})}zoomToRoute(t){this.#Pa=[],this.#Na(Un.getRoute(t)),Bn.dispatch("zoomto",{geometry:[this.#Pa]})}zoomToTravel(){this.#Pa=[],U.travel.routes.forEach(t=>this.#Na(t)),g!==U.travel.editedRouteObjId&&this.#Na(U.travel.editedRoute),U.travel.notes.forEach(t=>this.#Oa(t)),Bn.dispatch("zoomto",{geometry:[this.#Pa]})}zoomToPoi(t){Bn.dispatch("zoomto",t)}}const mr=new class{#mi=null;#pi=null;#Sa=!0;#Da=null;#ja(){this.#Sa?this.#pi?(this.#pi.notes.add(this.#mi),this.#mi.chainedDistance=this.#pi.chainedDistance,this.#pi.notes.sort((t,e)=>t.distance-e.distance)):(U.travel.notes.add(this.#mi),Bn.dispatch("updatetravelnotes")):this.#pi||Bn.dispatch("updatetravelnotes"),Bn.dispatch("noteupdated",{removedNoteObjId:this.#mi.objId,addedNoteObjId:this.#mi.objId}),Bn.dispatch("updateroadbook")}#Lr(){new cr(this.#mi,this.#pi).show().then(()=>this.#ja()).catch(t=>{console.error(t)})}#ka(t){this.#Sa=!0,this.#mi=new z,this.#mi.latLng=t,this.#mi.iconLatLng=t}async#Aa(t){if(t.tags.rcn_ref?this.#mi.iconContent="<div class='travenNotes-map-note travelnotes-map-note-category-0073'><svg viewBox='0 0 20 20'><text x='10' y='14'>"+t.tags.rcn_ref+"</text></svg></div>":this.#mi.iconContent=Ns.preDefinedIconDataFromName(t.description),this.#mi.url=t.tags.website||"",this.#mi.phone=t.tags.phone||"",this.#mi.tooltipContent=t.description||"",this.#mi.popupContent=t.tags.name||"",t.tags["addr:street"]&&t.tags["addr:city"])this.#mi.address=(t.tags["addr:housenumber"]?t.tags["addr:housenumber"]+" ":"")+t.tags["addr:street"]+' <span class="tavelnotes-note-html-address-city">'+t.tags["addr:city"]+"</span>";else{const e=new dr;e.createUI(),e.showInfo("Creating address");let o=null;try{o=await(new zs).getAddressAsync([t.lat,t.lon])}catch(t){console.error(t)}e.close(),this.#mi.address=o.street,""!==o.city&&(this.#mi.address+=' <span class="travelnotes-note-html-address-city">'+o.city+"</span>")}this.osmSearchNoteDialog||""===this.#mi.iconContent?this.#Lr():this.#ja()}constructor(){Object.freeze(this)}get osmSearchNoteDialog(){return null===this.#Da&&(this.#Da=t.osmSearch.showSearchNoteDialog),this.#Da}changeOsmSearchNoteDialog(){this.#Da=!this.osmSearchNoteDialog}newRouteNote(t,e){this.#pi=Un.getRoute(t);const o=rn.getClosestLatLngDistance(this.#pi,e);this.#ka(o.latLng),this.#mi.distance=o.distance,this.#Lr()}newSearchRouteNote(t){const e=Un.getNearestRouteData([t.lat,t.lon]);e.route?(this.#ka(e.latLngOnRoute),this.#mi.iconLatLng=[t.lat,t.lon],this.#mi.distance=e.distanceOnRoute,this.#pi=e.route,this.#Aa(t)):Rn.showError(S.getText("NoteEditor - No route was found"))}newSearchTravelNote(t){this.#pi=null,this.#ka([t.lat,t.lon]),this.#Aa(t)}newTravelNote(t){this.#pi=null,this.#ka(t),this.#Lr()}newUrlNote(t){this.#pi=null,this.#ka(t),this.#mi.iconContent='<div class="travenNotes-map-note travelnotes-map-note-category-0074"></div>',this.#mi.tooltipContent="Here",this.#ja(),(new ur).zoomToLatLng(t)}editNote(t){this.#Sa=!1;const e=Un.getNoteAndRoute(t);this.#pi=e.route,this.#mi=e.note,this.#Lr()}removeNote(t){const e=Un.getNoteAndRoute(t);e.route?e.route.notes.remove(t):(U.travel.notes.remove(t),Bn.dispatch("updatetravelnotes")),Bn.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:g}),Bn.dispatch("updateroadbook")}hideNotes(){let t=U.travel.notes.iterator;for(;!t.done;)Bn.dispatch("removeobject",{objId:t.value.objId});const e=U.travel.routes.iterator;for(;!e.done;)for(t=e.value.notes.iterator;!t.done;)Bn.dispatch("removeobject",{objId:t.value.objId});if(g!==U.editedRouteObjId)for(t=U.travel.editedRoute.notes.iterator;!t.done;)Bn.dispatch("removeobject",{objId:t.value.objId})}showNotes(){this.hideNotes();const t=U.travel.notes.iterator;for(;!t.done;)Bn.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:t.value.objId});const e=U.travel.routes.iterator;for(;!e.done;)e.value.hidden||Bn.dispatch("routeupdated",{removedRouteObjId:e.value.objId,addedRouteObjId:e.value.objId})}attachNoteToRoute(t){const e=Un.getNoteAndRoute(t).note,o=Un.getNearestRouteData(e.latLng);o.route&&(U.travel.notes.remove(t),e.distance=o.distanceOnRoute,e.latLng=o.latLngOnRoute,e.chainedDistance=o.route.chainedDistance,o.route.notes.add(e),o.route.notes.sort((t,e)=>t.distance-e.distance),Bn.dispatch("noteupdated",{removedNoteObjId:t,addedNoteObjId:t}),Bn.dispatch("updatetravelnotes"),Bn.dispatch("updateroadbook"))}detachNoteFromRoute(t){const e=Un.getNoteAndRoute(t);e.route.notes.remove(t),e.note.distance=o.invalid,e.note.chainedDistance=o.defaultValue,U.travel.notes.add(e.note),Bn.dispatch("updatetravelnotes"),Bn.dispatch("updateroadbook")}travelNoteDropped(t,e,o){U.travel.notes.moveTo(t,e,o),Bn.dispatch("updatetravelnotes"),Bn.dispatch("updateroadbook")}};class pr extends Is{constructor(t,e){super(t,e)}get menuItems(){return[new Cs(S.getText("ProfileContextMenu - Add a note to the route at this point"),!0,()=>mr.newRouteNote(this.targetObjId,this.latLng)),new Cs(S.getText("ProfileContextMenu - Zoom to this point"),!0,()=>(new ur).zoomToLatLng(this.latLng))]}}class gr{constructor(){Object.freeze(this)}getlatLngElevOnRouteAtMousePosition(t){const e=Un.getRoute(Number.parseInt(t.currentTarget.dataset.tanObjId)),o=t.currentTarget.getBoundingClientRect(),i=(t.clientX-o.x-fs.PROFILE_MARGIN/(2*fs.PROFILE_MARGIN+fs.PROFILE_WIDTH)*o.width)/(fs.PROFILE_WIDTH/(2*fs.PROFILE_MARGIN+fs.PROFILE_WIDTH)*o.width)*e.distance;return 0<i&&i<e.distance?rn.getLatLngElevAtDist(e,i):null}}class vr extends gr{constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation();const e=this.getlatLngElevOnRouteAtMousePosition(t);e&&(t.latlng={lat:e.latLng[0],lng:e.latLng[1]},new pr(t).show())}}class fr{constructor(){Object.freeze(this)}handleEvent(t){t.preventDefault(),t.stopPropagation(),Bn.dispatch("removeobject",{objId:Number.parseInt(t.currentTarget.dataset.tanMarkerObjId)})}}class _r extends gr{#Ra;#Ha;#Ba;#za;#Fa;#Za;#Ka;#Ua(t,e){const o=document.createElementNS(_,"text");return o.appendChild(document.createTextNode(t)),o.setAttributeNS(null,"class","travelnotes-route-svg-profile-elev-text"),o.setAttributeNS(null,"x",this.#Za),o.setAttributeNS(null,"y",e),o.setAttributeNS(null,"text-anchor",this.#Fa),this.#Ka.appendChild(o),o}constructor(){super()}handleEvent(t){t.preventDefault(),t.stopPropagation(),this.#Ka=t.currentTarget;const e=this.getlatLngElevOnRouteAtMousePosition(t);if(e){const o=Number.parseInt(this.#Ka.dataset.tanMarkerObjId);Bn.dispatch("removeobject",{objId:o}),Bn.dispatch("additinerarypointmarker",{objId:o,latLng:e.latLng}),this.#Ra&&this.#Ka.contains(this.#Ra)?(this.#Ka.removeChild(this.#Ra),this.#Ka.removeChild(this.#Ha),this.#Ka.removeChild(this.#Ba),this.#Ka.removeChild(this.#za)):(this.#Ra=null,this.#Ha=null,this.#Ba=null,this.#za=null);const i=this.#Ka.getBoundingClientRect();this.#Za=(2*fs.PROFILE_MARGIN+fs.PROFILE_WIDTH)*(t.clientX-i.x)/i.width;const n=fs.PROFILE_MARGIN+fs.PROFILE_HEIGHT;this.#Ra=document.createElementNS(_,"polyline"),this.#Ra.setAttributeNS(null,"points",String(this.#Za)+","+fs.PROFILE_MARGIN+" "+this.#Za+","+n),this.#Ra.setAttributeNS(null,"class","travelnotes-route-svg-profile-marker-polyline"),this.#Ka.appendChild(this.#Ra);const s=Un.getRoute(Number.parseInt(this.#Ka.dataset.tanObjId));this.#Fa=e.distance>s.distance/2?"end":"start",this.#Za+=e.distance>s.distance/2?-10:fs.X_DELTA_TEXT,this.#Ha=this.#Ua(D.formatDistance(e.distance),fs.PROFILE_MARGIN+fs.Y_DELTA_TEXT),this.#Ba=this.#Ua("Alt. "+e.elev.toFixed(0)+" m.",fs.PROFILE_MARGIN+2*fs.Y_DELTA_TEXT),this.#za=this.#Ua("Pente "+e.ascent.toFixed(0)+" % ",fs.PROFILE_MARGIN+3*fs.Y_DELTA_TEXT)}}}class yr extends vs{#_n=null;#Va;#Wa;#Xa;#Ya=null;#Ga=null;#qa=null;#Ja=b.nextObjId;#$a;#Qa(){this.#_n&&(this.#_n.removeEventListener("contextmenu",this.#Ya,!1),this.#_n.removeEventListener("mousemove",this.#Ga,!1),this.#_n.removeEventListener("mouseleave",this.#qa,!1),this.#Va.removeChild(this.#_n),this.#_n=null,Bn.dispatch("removeobject",{objId:this.#Ja}),this.#Xa.textContent="",this.#Wa.textContent="")}setContent(t){this.#$a=t.objId,this.#Qa(),this.#_n=(new fs).createSvg(t),this.#_n.dataset.tanObjId=t.objId,this.#_n.dataset.tanMarkerObjId=this.#Ja,this.#_n.addEventListener("contextmenu",this.#Ya,!1),this.#_n.addEventListener("mousemove",this.#Ga,!1),this.#_n.addEventListener("mouseleave",this.#qa,!1),this.#Va.appendChild(this.#_n),this.setContentName(t)}setContentName(t){this.#Xa.textContent=S.getText("ProfileWindow - Route {name}",{name:t.computedName}),this.#Wa.textContent=S.getText("ProfileWindow - Ascent: {ascent} m. - Descent: {descent} m. - Distance: {distance}",{ascent:t.itinerary.ascent.toFixed(0),descent:t.itinerary.descent.toFixed(0),distance:D.formatDistance(t.distance)})}constructor(){super(),this.#Ya=new vr,this.#Ga=new _r,this.#qa=new fr,this.#Va=W.create("div",{className:"travelnotes-profile-dialog-svg-container"}),this.#Xa=W.create("div",{className:"travelnotes-profile-dialog-name-container"}),this.#Wa=W.create("div",{className:"travelnotes-profile-dialog-ascent-container"})}createContentHTML(){}onCancel(){this.#Qa(),super.onCancel(),Bn.dispatch("profileclosed",{objId:this.#$a})}show(){super.show(),this.mover.moveDialogToTopLeft()}get contentHTMLElements(){return[this.#Va,this.#Xa,this.#Wa]}get title(){return S.getText("ProfileWindow - Profile")}}class br{#pi;#tl;#el;get#ol(){return t.route.elev.smoothPoints}#il(){this.#el=[],this.#el.push({distance:0,elev:this.#pi.itinerary.itineraryPoints.first.elev,smoothElev:this.#pi.itinerary.itineraryPoints.first.elev});const t=this.#pi.itinerary.itineraryPoints.iterator;t.done;let e=0,o=t.value.distance,i=t.value.elev;t.done;let n=this.#tl;for(;n<this.#pi.distance;){if(o<n)for(e=o,i=t.value.elev;o<n;)o+=t.value.distance,t.done;const s=i+(n-e)*((t.value.elev-i)/(o-e));this.#el.push({distance:n,elev:s,smoothElev:0}),n+=this.#tl}this.#el.push({distance:this.#pi.distance,elev:this.#pi.itinerary.itineraryPoints.last.elev,smoothElev:this.#pi.itinerary.itineraryPoints.last.elev})}#nl(){let t=(this.#el[this.#ol-1].elev-this.#el[0].elev)/(this.#ol-1),e=0;for(e=0;e<this.#ol;e++)this.#el[e].smoothElev=this.#el[0].elev+t*e;for(e=this.#ol;e<this.#el.length-this.#ol;e++){let t=0;for(let o=e-this.#ol;o<=e+this.#ol;o++)t+=this.#el[o].elev;this.#el[e].smoothElev=t/(2*this.#ol+1)}e--;const o=(this.#el[e+this.#ol].smoothElev-this.#el[e].smoothElev)/this.#ol;let i=this.#el[e].smoothElev,n=1;for(e++;e<this.#el.length-1;n++,e++)this.#el[e].smoothElev=i+o*n}#sl(){const e=this.#pi.itinerary.itineraryPoints.iterator;let o=0;for(;!e.done;)o+=e.next?Math.abs(e.value.elev-e.next.elev):0;this.#tl=Math.floor(Math.min(t.route.elev.smoothCoefficient*this.#pi.distance/o,this.#pi.distance/(3*this.#ol)))}#rl(){const t=this.#pi.itinerary.itineraryPoints.iterator;t.done;let e=t.value.distance;for(;!t.done;){const o=this.#el[Math.floor(e/this.#tl)],i=this.#el[Math.ceil(e/this.#tl)];if(o&&i){const n=e-o.distance,s=(i.elev-o.elev)/(i.distance-o.distance);t.value.elev=o.elev+n*s}e+=t.value.distance}}constructor(){Object.freeze(this)}smooth(t){this.#pi=t,this.#sl(),this.#il(),this.#nl(),this.#rl()}}const Lr=new class{#al=new Map;constructor(){Object.freeze(this)}createProfile(e){const o=this.#al.get(e.objId);if(e.itinerary.hasProfile){t.route.elev.smooth&&(new br).smooth(e);let i=0,n=0,s=e.itinerary.itineraryPoints.first.elev;e.itinerary.itineraryPoints.forEach(t=>{let e=t.elev-s;0>e?n-=e:i+=e,s=t.elev}),e.itinerary.ascent=i,e.itinerary.descent=n,o&&o.setContent(e)}else o&&o.onCancel()}updateProfileName(t){const e=this.#al.get(t);if(e){const o=Un.getRoute(t);o&&e.setContentName(o)}}updateProfile(t,e){const o=this.#al.get(t);o&&(this.#al.delete(t),e&&e.itinerary.hasProfile?(o.setContent(e),this.#al.set(e.objId,o)):o.onCancel())}deleteProfile(t){const e=this.#al.get(t);e&&e.onCancel()}deleteAllProfiles(){this.#al.forEach(t=>t.onCancel())}showProfile(t){const e=Un.getRoute(t);let o=this.#al.get(t);o||(o=new yr,o.setContent(e),o.show(),this.#al.set(t,o))}onProfileClosed(t){this.#al.delete(t)}};class Tr{constructor(){Object.seal(this)}bottomLeft;upperRight;entryPoint;exitPoint}class Er{#ll;#pi;#hl;#cl(t,e,o){return e.lng===o.lng?new en(e.lat>o.lat?t.bottomLeft.lat:t.upperRight.lat,e.lng):e.lat===o.lat?new en(e.lat,e.lng<o.lng?t.upperRight.lng:t.bottomLeft.lng):null}#dl(t,e){const o=1e-6;return e.lat-t.bottomLeft.lat<o||t.upperRight.lat-e.lat<o||e.lng-t.bottomLeft.lng<o||t.upperRight.lng-e.lng<o?en.clone(e):null}#ul(t,e,o){if(t.bottomLeft.lat===t.upperRight.lat&&t.bottomLeft.lng===t.upperRight.lng){const t=Math.min(Math.abs(this.#hl.height/(o.lat-e.lat)),Math.abs(this.#hl.width/(o.lng-e.lng)));return new en(e.lat+t*(o.lat-e.lat),e.lng+t*(o.lng-e.lng))}return null}#ml(t,e,o){let i=this.#ul(t,e,o);if(i)return i;if(i=this.#dl(t,e),i)return i;if(i=this.#cl(t,e,o),i)return i;const n=(e.lat-o.lat)/(e.lng-o.lng),s=e.lat-n*e.lng;if(i=new en(n*t.upperRight.lng+s,t.upperRight.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng<o.lng)return i;if(i=new en(t.upperRight.lat,(t.upperRight.lat-s)/n),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat<o.lat)return i;if(i=new en(n*t.bottomLeft.lng+s,t.bottomLeft.lng),i.lat<=t.upperRight.lat&&i.lat>=t.bottomLeft.lat&&i.lng>o.lng)return i;if(i=new en(t.bottomLeft.lat,(t.bottomLeft.lat-s)/n),i.lng>=t.bottomLeft.lng&&i.lng<=t.upperRight.lng&&i.lat>o.lat)return i;throw new Error("intermediate point not found")}#pl(){this.#ll=[];const t=this.#pi.itinerary.itineraryPoints.iterator;let e=t.done,o=new Tr;o.bottomLeft=en.clone(t.value),o.upperRight=en.clone(t.value),o.entryPoint=en.clone(t.value);let i=t.value,n=en.clone(t.value);e=t.done;let s=t.value;for(;!e;){const r=new Tr;r.bottomLeft=new en(Math.min(o.bottomLeft.lat,s.lat),Math.min(o.bottomLeft.lng,s.lng)),r.upperRight=new en(Math.max(o.upperRight.lat,s.lat),Math.max(o.upperRight.lng,s.lng)),r.entryPoint=en.clone(o.entryPoint),this.#hl.height>r.upperRight.lat-r.bottomLeft.lat&&this.#hl.width>r.upperRight.lng-r.bottomLeft.lng?(o=r,i=t.value,n=en.clone(t.value),e=t.done,s=t.value,e&&(o.exitPoint=n,this.#ll.push(Object.freeze(o)))):(n=this.#ml(o,i,s),o.bottomLeft=new en(Math.min(o.bottomLeft.lat,n.lat),Math.min(o.bottomLeft.lng,n.lng)),o.upperRight=new en(Math.max(o.upperRight.lat,n.lat),Math.max(o.upperRight.lng,n.lng)),o.exitPoint=n,this.#ll.push(Object.freeze(o)),o=new Tr,o.bottomLeft=en.clone(n),o.upperRight=en.clone(n),o.entryPoint=en.clone(n))}}constructor(t,e){Object.freeze(this),this.#pi=t,this.#hl=e,this.#pl()}get printViews(){return this.#ll}}class wr{#Tt;#Es;constructor(t,e){Object.freeze(this),this.#Tt=t,this.#Es=e}get width(){return this.#Tt}get height(){return this.#Es}}class Mr{#ce;#Et;#gl;constructor(t){if("string"!=typeof t?.text||"string"!=typeof t?.color||"string"!=typeof t?.backgroundColor)throw new Error("invalid toolbar for layer");Object.freeze(this),this.#ce=N.sanitizeToJsString(t.text),this.#Et=N.sanitizeToColor(t.color),this.#gl=N.sanitizeToColor(t.backgroundColor)}get text(){return this.#ce}get color(){return this.#Et}get backgroundColor(){return this.#gl}}class xr{#X=null;#vl=null;#p=null;#fl=null;#_l=null;#yl=null;#bl=null;#Ll=null;#zt=null;#Tl=!1;#El=null;#wl=null;#Ml(){if("string"!=typeof this.#wl?.name)throw new Error("invalid name for layer");this.#X=N.sanitizeToJsString(this.#wl.name)}#xl(){if("wms"!==this.#wl?.service&&"wmts"!==this.#wl?.service)throw new Error("invalid service for layer "+this.#X);this.#vl=this.#wl.service}#Il(){if("string"!=typeof this.#wl?.url)throw new Error("invalid url for layer "+this.#X);this.#p=this.#wl.url}#Cl(){if("wms"===this.#vl){if("string"!=typeof this.#wl?.wmsOptions?.layers||"string"!=typeof this.#wl?.wmsOptions?.format||"boolean"!=typeof this.#wl?.wmsOptions?.transparent)throw new Error("invalid wmsOptions for layer "+this.#X);this.#fl=this.#wl.wmsOptions,this.#fl.layers=N.sanitizeToJsString(this.#fl.layers),this.#fl.format=N.sanitizeToJsString(this.#fl.format)}}#Pl(){try{this.#wl.bounds&&"number"==typeof this.#wl.bounds[0][0]&&"number"==typeof this.#wl.bounds[0][1]&&"number"==typeof this.#wl.bounds[1][0]&&"number"==typeof this.#wl.bounds[1][1]&&(this.#_l=this.#wl.bounds)}catch{throw new Error("invalid bounds for layer "+this.#X)}}#Ol(){if(this.#wl.minZoom){if("number"!=typeof this.#wl.minZoom)throw new Error("invalid minZoom for layer "+this.#X);this.#yl=this.#wl.minZoom}if(this.#wl.maxZoom){if("number"!=typeof this.#wl.maxZoom)throw new Error("invalid maxZoom for layer "+this.#X);this.#bl=this.#wl.maxZoom}}#Nl(){this.#Ll=new Mr(this.#wl.toolbar)}#Sl(){if("string"!=typeof this.#wl?.providerName)throw new Error("invalid providerName for layer "+this.#X);this.#zt=N.sanitizeToJsString(this.#wl.providerName)}#Dl(){if("boolean"!=typeof this.#wl.providerKeyNeeded)throw new Error("invalid providerKeyNeeded for layer "+this.#X);this.#Tl=this.#wl.providerKeyNeeded}#jl(){if(""===this.#wl.attribution)this.#El="";else{if("string"!=typeof this.#wl?.attribution)throw new Error("invalid attribution for map layer "+this.#X);this.#El=N.sanitizeToHtmlString(this.#wl.attribution).htmlString}}constructor(t){Object.freeze(this),this.#wl=t,this.#Ml(),this.#xl(),this.#Il(),this.#Cl(),this.#Pl(),this.#Ol(),this.#Nl(),this.#Sl(),this.#Dl(),this.#jl(),this.#wl=null}get name(){return this.#X}get service(){return this.#vl}get url(){return this.#p}get wmsOptions(){return this.#fl}get bounds(){return this.#_l}get minZoom(){return this.#yl}get maxZoom(){return this.#bl}get toolbarButtonData(){return this.#Ll}get providerName(){return this.#zt}get providerKeyNeeded(){return this.#Tl}get attribution(){return this.#El}}const Ir=new class{#kl;#Al;#Rl;constructor(){Object.freeze(this),this.#kl=new Map,this.#Rl=!1,this.#Al=new xr({service:"wmts",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",name:"OSM - Color",toolbar:{text:"OSM",color:"#ff0000",backgroundColor:"#ffffff"},providerName:"OSM",providerKeyNeeded:!1,attribution:""}),this.#kl.set(this.#Al.name,this.#Al)}getMapLayer(t){let e=this.#kl.get(t)||this.#Al;return e.providerKeyNeeded&&(zn.hasKey(e.providerName.toLowerCase())||(e=this.#Al)),e}forEach(t){this.#kl.forEach(t)}addMapLayers(t){this.#Rl||(t.forEach(t=>{const e=new xr(t);this.#kl.get(e.name)||this.#kl.set(e.name,e)}),this.#Rl=!0)}get defaultMapLayer(){return this.#Al}};class Cr{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class Pr{#Hl=null;constructor(t){Object.freeze(this),this.#Hl=t}handleEvent(){this.#Hl.onAfterPrint(),this.#Hl=null}}class Or{#Bl;#pi;#ll;#zl;#Fl;#Te;#Zl;#Kl;#Ul;#Vl;#Wl;onAfterPrint(){this.#Kl.forEach(t=>document.body.removeChild(t)),this.#Kl.length=0,this.#Fl.removeEventListener("click",this.#Vl,!1),this.#Te.removeEventListener("click",this.#Wl,!1),document.body.removeChild(this.#zl);const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.remove("travelnotes-hidden");U.map.invalidateSize(!1),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name),window.removeEventListener("afterprint",this.#Wl,!0),this.#Wl=null,this.#Vl=null}#Xl(){const t=Ir.getMapLayer(U.travel.layerName),e=zn.getUrl(t),o="wmts"===t.service.toLowerCase()?new Ai(e):new Ai.WMS(e,t.wmsOptions);return o.options.attribution=N.sanitizeToHtmlString(' Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t.attribution+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a> ').htmlString,o}#Yl(){const t=[];return this.#pi.notes.forEach(e=>{const o=new ji({iconSize:[e.iconWidth,e.iconHeight],iconAnchor:[e.iconWidth/2,e.iconHeight/2],popupAnchor:[0,-e.iconHeight/2],html:e.iconContent,className:"travelnotes-map-all-notes"}),i=new pi(e.iconLatLng,{zIndexOffset:100,icon:o,draggable:!0});t.push(i)}),t}#Gl(e){this.#Zl++;const o="travelnotes-route-view-container-"+this.#Zl,i=document.createElement("div");i.className="travelnotes-route-view-container",i.id=o,document.body.appendChild(i),this.#Kl.push(i),i.style.width=String(this.#Bl.paperWidth)+"mm",i.style.height=String(this.#Bl.paperHeight)+"mm";const n=this.#Bl.printNotes?this.#Yl():[];n.push(this.#Xl()),n.push(new vi([e.entryPoint.lat,e.entryPoint.lng],t.printRouteMap.entryPointMarker)),n.push(new vi([e.exitPoint.lat,e.exitPoint.lng],t.printRouteMap.exitPointMarker)),n.push(this.#Ul),new So(o,{attributionControl:!0,zoomControl:!1,center:[(e.bottomLeft.lat+e.upperRight.lat)/2,(e.bottomLeft.lng+e.upperRight.lng)/2],zoom:this.#Bl.zoomFactor,minZoom:this.#Bl.zoomFactor,maxZoom:this.#Bl.zoomFactor,layers:n})}#ql(){this.#zl=W.create("div",{id:"travelnotes-print-toolbar"},document.body),this.#Fl=W.create("div",{className:"travelnotes-ui-button",title:S.getText("PrintPageBuilder - Print"),textContent:"ðŸ–¨ï¸"},this.#zl),this.#Fl.addEventListener("click",this.#Vl,!1),this.#Te=W.create("div",{className:"travelnotes-ui-button",title:S.getText("PrintPageBuilder - Cancel print"),textContent:"âŒ"},this.#zl),this.#Te.addEventListener("click",this.#Wl,!1)}constructor(t,e,o){Object.freeze(this),this.#pi=t,this.#ll=e,this.#Bl=o,this.#Zl=0,this.#Kl=[],this.#Vl=new Cr,this.#Wl=new Pr(this)}preparePage(){this.#Bl.firefoxBrowser?document.body.classList.add("travelnotes-maps-firefox-browser"):document.body.classList.remove("travelnotes-maps-firefox-browser");const t=document.body.children;for(let e=0;e<t.length;e++)t.item(e).classList.add("travelnotes-hidden");document.title=""===U.travel.name?"maps":U.travel.name+" - "+this.#pi.computedName+" - maps",this.#ql(),window.addEventListener("afterprint",this.#Wl,!0);const e=[],o=this.#pi.itinerary.itineraryPoints.iterator;for(;!o.done;)e.push(o.value.latLng);this.#Ul=new _i(e,{color:this.#pi.color,weight:this.#pi.width,dashArray:this.#pi.dashString}),this.#Zl=0,this.#ll.forEach(t=>this.#Gl(t))}}class Nr{#Jl=0;static get#$l(){return 256}#Ql(t){const e=W.create("div",{},document.body);e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width=String(t.paperWidth-2*t.borderWidth)+"mm",e.style.height=String(t.paperHeight-2*t.borderWidth)+"mm";const o=rn.screenCoordToLatLng(0,0),i=rn.screenCoordToLatLng(e.clientWidth,e.clientHeight);this.#Jl=Math.ceil(e.clientWidth/Nr.#$l)*Math.ceil(e.clientHeight/Nr.#$l),document.body.removeChild(e);const n=U.map.getZoomScale(U.map.getZoom(),t.zoomFactor);return new wr(Math.abs(o[1]-i[1])*n,Math.abs(o[0]-i[0])*n)}constructor(){Object.freeze(this)}print(e,o){const i=Un.getRoute(o);if(!i)return;const n=new Er(i,this.#Ql(e));if(t.printRouteMap.maxTiles<n.printViews.length*this.#Jl)return void Rn.showError(S.getText("RoutePrinter - The maximum of allowed pages is reached."));new Or(i,n.printViews,e).preparePage()}}class Sr{static marker=null;static initialLatLng=null}class Dr{static handleEvent(){Sr.marker&&(Oo.off(Sr.marker),U.map.removeLayer(Sr.marker),Sr.marker=null)}}const jr=new class{constructor(){Object.freeze(this)}addRoute(){const t=new F;U.travel.routes.add(t),this.chainRoutes(),l.editedChanged===U.travel.editedRoute.editionStatus?(Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook")):this.editRoute(t.objId)}editRoute(t){const e=Un.getRoute(t),o=e.itinerary.provider,i=U.providers.get(o.toLowerCase());if(o&&""!==o&&(!i||i.providerKeyNeeded&&!zn.hasKey(o)))return void Rn.showError(S.getText("RouteEditor - Not possible to edit a route created with this provider",{provider:o}));g!==U.editedRouteObjId&&this.cancelEdition(),o&&""!==o&&Bn.dispatch("setprovider",{provider:o});const n=e.itinerary.transitMode;n&&""!==n&&Bn.dispatch("settransitmode",{transitMode:n}),U.travel.editedRoute=new F,e.editionStatus=l.editedNoChange,U.travel.editedRoute.jsonObject=e.jsonObject,U.editedRouteObjId=e.objId,U.travel.editedRoute.hidden=!1,e.hidden=!1,Lr.updateProfile(U.editedRouteObjId,U.travel.editedRoute),this.chainRoutes(),Bn.dispatch("routeupdated",{removedRouteObjId:e.objId,addedRouteObjId:U.travel.editedRoute.objId}),Bn.dispatch("updateroadbook"),Bn.dispatch("updatetravelproperties")}removeRoute(t){let e=t;e!==U.editedRouteObjId&&e!==U.travel.editedRoute.objId||(e=U.editedRouteObjId,this.cancelEdition()),Bn.dispatch("routeupdated",{removedRouteObjId:e,addedRouteObjId:g}),U.travel.routes.remove(e),Lr.deleteProfile(e),this.chainRoutes(),Bn.dispatch("updateroadbook"),Bn.dispatch("updatetravelproperties")}saveGpx(t){(new Vn).routeToGpx(t)}chainRoutes(){const t=U.travel.routes.iterator;let e=o.defaultValue;for(;!t.done;){t.value.chain?(t.value.chainedDistance=e,e+=t.value.distance):t.value.chainedDistance=o.defaultValue;const i=t.value.notes.iterator;for(;!i.done;)i.value.chainedDistance=t.value.chainedDistance;if(t.value.objId===U.editedRouteObjId){U.travel.editedRoute.chainedDistance=U.travel.editedRoute.chain?t.value.chainedDistance:o.defaultValue;const e=U.travel.editedRoute.notes.iterator;for(;!e.done;)e.value.chainedDistance=U.travel.editedRoute.chainedDistance}}}saveEdition(){const t=new F;t.jsonObject=U.travel.editedRoute.jsonObject,U.travel.routes.replace(U.editedRouteObjId,t),U.editedRouteObjId=t.objId,this.cancelEdition()}cancelEdition(){Dr.handleEvent();const t=Un.getRoute(U.editedRouteObjId);t.editionStatus=l.notEdited,Lr.updateProfile(U.travel.editedRoute.objId,t),Bn.dispatch("routeupdated",{removedRouteObjId:U.travel.editedRoute.objId,addedRouteObjId:U.editedRouteObjId}),U.editedRouteObjId=g,U.travel.editedRoute=new F,this.chainRoutes(),Bn.dispatch("updateroadbook"),Bn.dispatch("updatetravelproperties")}routeProperties(t){const e=Un.getRoute(t);new ss(e).show().then(()=>{this.chainRoutes(),e.haveValidWayPoints()&&Bn.dispatch("routepropertiesupdated",{routeObjId:e.objId}),Bn.dispatch("updateroadbook"),Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateprofilename",{routeObjId:t})}).catch(t=>{t instanceof Error&&console.error(t)})}printRouteMap(t){(new ls).show().then(e=>(new Nr).print(e,t)).catch(t=>{t instanceof Error&&console.error(t)})}showRoute(t){Un.getRoute(t).hidden=!1,Bn.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t}),Bn.dispatch("updatetravelproperties")}hideRoute(t){Un.getRoute(t).hidden=!0,Bn.dispatch("routeupdated",{removedRouteObjId:t,addedRouteObjId:g}),Bn.dispatch("updatetravelproperties")}showRoutes(){const t=U.travel.routes.iterator;for(;!t.done;)t.value.hidden&&(t.value.hidden=!1,Bn.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t.value.objId}));Bn.dispatch("updatetravelproperties")}hideRoutes(){const t=U.travel.routes.iterator;for(;!t.done;)t.value.hidden||t.value.objId===U.editedRouteObjId||(t.value.hidden=!0,Bn.dispatch("routeupdated",{removedRouteObjId:t.value.objId,addedRouteObjId:g}));Bn.dispatch("updatetravelproperties")}};class kr{static get#th(){return.5}static get#eh(){return 5}static get#oh(){return 10}static get#ih(){return 31}static get#nh(){return 32}static get#sh(){return 63}#rh(t){return Math.floor(Math.abs(t)+kr.#th)*(0<=t?1:-1)}#ah(t,e,o){const i=this.#rh(t*o),n=this.#rh(e*o);let s=i-n;s<<=1,0>i-n&&(s=~s);let r="";for(;kr.#nh<=s;)r+=String.fromCharCode((kr.#nh|s&kr.#ih)+kr.#sh),s>>=kr.#eh;return r+=String.fromCharCode(s+kr.#sh),r}#s;#lh(t){let e=null,o=0,i=0;do{e=t.charCodeAt(this.#s++)-kr.#sh,i|=(e&kr.#ih)<<o,o+=kr.#eh}while(kr.#nh<=e);return 1&i?~(i>>1):i>>1}constructor(){Object.freeze(this)}encode(t,e){if(!t.length)return"";const o=e.length,i=Array.from(e,t=>Math.pow(kr.#oh,t));let n="";for(let e=0;e<o;e++)n+=this.#ah(t[0][e],0,i[e]);for(let e=1;e<t.length;e++){const s=t[e],r=t[e-1];for(let t=0;t<o;t++)n+=this.#ah(s[t],r[t],i[t])}return n}decode(t,e){const o=e.length;if(!t||0===t.length)return[];this.#s=0;const i=[],n=Array.from(e,t=>Math.pow(kr.#oh,t)),s=new Array(o).fill(0);for(;this.#s<t.length;){const e=new Array(o).fill(0);for(let i=0;i<o;i++)s[i]+=this.#lh(t),e[i]=s[i]/n[i];i.push(e)}return i}}class Ar{#hh(t){const e={values:"",objType:(new R).objType.jsonObject},o=[];t.itinerary.itineraryPoints.forEach(t=>{o.push([t.lat,t.lng,t.distance,t.elev,t.objId])}),e.values=(new kr).encode(o,[a.fixed,a.fixed,2,2,0]),t.itinerary.itineraryPoints=e}#ch(t){const e=[];if(t.itinerary.itineraryPoints.values)(new kr).decode(t.itinerary.itineraryPoints.values,[a.fixed,a.fixed,2,2,0]).forEach(n=>{const s={lat:a.defaultValue,lng:a.defaultValue,distance:o.defaultValue,elev:i.defaultValue,objId:g};[s.lat,s.lng,s.distance,s.elev,s.objId]=n,s.objType=t.itinerary.itineraryPoints.objType,e.push(s)});else{t.itinerary.itineraryPoints.latLngs=(new kr).decode(t.itinerary.itineraryPoints.latLngs,[a.fixed,a.fixed]);let o=0;t.itinerary.itineraryPoints.latLngs.forEach(n=>{const s={};s.lat=n[0],s.lng=n[1],s.distance=t.itinerary.itineraryPoints.distances[o],t.itinerary.itineraryPoints.elevs?s.elev=t.itinerary.itineraryPoints.elevs[o]:s.elev=i.defaultValue,s.objId=t.itinerary.itineraryPoints.objIds[o],s.objType=t.itinerary.itineraryPoints.objType,e.push(s),o++})}t.itinerary.itineraryPoints=e}constructor(){Object.freeze(this)}decompress(t){t.routes.forEach(this.#ch),t.editedRoute&&this.#ch(t.editedRoute)}compress(t){const e=t.jsonObject;return e.routes.forEach(t=>this.#hh(t)),this.#hh(e.editedRoute),e}}class Rr{constructor(){Object.freeze(this)}openDistantFile(t){(new Ar).decompress(t),U.travel.jsonObject=t,U.travel.readOnly=!0,document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name);const e=U.travel.routes.iterator;for(;!e.done;)l.notEdited===e.value.editionStatus?Bn.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:e.value.objId}):U.editedRouteObjId=e.value.objId;g!==U.editedRouteObjId&&Bn.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:U.travel.editedRoute.objId});const o=U.travel.notes.iterator;for(;!o.done;)Bn.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:o.value.objId});(new ur).zoomToTravel()}}const Hr=new class{#Go=null;constructor(){Object.freeze(this)}createUI(){this.#Go=W.create("div",{id:"travelnotes-attributions-ui"},document.body)}set attributions(t){const e='Â© <a href="https://leafletjs.com/" target="_blank" title="Leaflet">Leaflet</a> | Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="OpenStreetMap contributors">OpenStreetMap contributors</a> '+t+'| Â© <a href="https://github.com/wwwouaiebe" target="_blank" title="https://github.com/wwwouaiebe">Travel & Notes</a>';for(;this.#Go.firstChild;)this.#Go.removeChild(this.#Go.firstChild);N.sanitizeToHtmlElement(e,this.#Go)}};const Br=new class{constructor(){Object.freeze(this)}setMapLayer(t){const e=Ir.getMapLayer(t);Bn.dispatch("layerchange",{layer:e}),Hr.attributions=e.attribution,U.travel.layerName=e.name}};class zr{toolbarItemsArray;constructor(){Object.seal(this),this.toolbarItemsArray=[]}}class Fr{#dh;constructor(t){Object.freeze(this),this.#dh=t}handleEvent(t){this.#dh.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].doAction()}}class Zr{#uh;#dh;#mh;static get#ph(){return 5}constructor(t,e){Object.freeze(this),this.#uh=t,this.#dh=e}handleEvent(t){switch(t.type){case"touchstart":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);this.#mh=e.screenY}break;case"touchend":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);Zr.#ph>Math.abs(e.screenY-this.#mh)&&(t.stopPropagation(),t.preventDefault(),this.#dh.toolbarItemsArray[Number.parseInt(t.target.dataset.tanItemId)].doAction(),this.#uh.hide())}}}}class Kr{#gh;constructor(){Object.freeze(this),this.#gh=Number.MAX_VALUE}handleEvent(t){switch(t.type){case"touchstart":if(1===t.changedTouches.length){const e=t.changedTouches.item(0);this.#gh=e.screenY}break;case"touchmove":case"touchend":if(1===t.changedTouches.length){const e=t.changedTouches.item(0),o=this.#gh-e.screenY;t.currentTarget.scrollTop+=o,this.#gh=e.screenY}break;default:this.#gh=Number.MAX_VALUE}"touchend"===t.type&&(this.#gh=Number.MAX_VALUE)}}class Ur{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.currentTarget.scrollTop+=t.deltaY*v[t.deltaMode])}}class Vr{#To;#vh;#Jo;#fh;#_h;#yh;#bh;#Lh;#dh;static get#Th(){return 100}#Eh;#wh(t,e){const o=W.create("div",{className:"travelnotes-base-toolbar-button",textContent:t.textContent,title:t.title,dataset:{ItemId:e}},this.#vh);o.addEventListener("click",this.#yh,!1),o.addEventListener("touchstart",this.#bh,!1),o.addEventListener("touchend",this.#bh,!1)}#oo(){this.#vh=W.create("div",{className:"travelnotes-base-toolbar-buttons-container"},this.#To),this.#dh.toolbarItemsArray=[],this.addToolbarItems(),this.#dh.toolbarItemsArray.forEach((t,e)=>{this.#wh(t,e)}),this.#vh.addEventListener("wheel",this.#fh,{passive:!0}),this.#vh.addEventListener("touchstart",this.#_h,!1),this.#vh.addEventListener("touchmove",this.#_h,!1),this.#vh.addEventListener("touchend",this.#_h,!1),this.#Lh=!0}#Mh(t){Vr.#Th>t.timeStamp-this.#Eh||this.#xh(t)}#xh(t){if(this.#Eh=t.timeStamp,this.#Lh){if(this.#Jo)return clearTimeout(this.#Jo),void(this.#Jo=null);this.hide()}else this.#oo()}#Ih(){this.#Lh&&(this.#Jo=setTimeout(()=>this.hide(),t.toolbars.timeOut))}constructor(){Object.freeze(this)}hide(){for(this.#Jo&&(clearTimeout(this.#Jo),this.#Jo=null);this.#vh.firstChild;){const t=this.#vh.firstChild;t.removeEventListener("click",this.#yh,!1),t.removeEventListener("touchstart",this.#bh,!1),t.removeEventListener("touchend",this.#bh,!1),this.#vh.removeChild(t)}this.#vh.removeEventListener("wheel",this.#fh,{passive:!0}),this.#vh.removeEventListener("touchstart",this.#_h,!1),this.#vh.removeEventListener("touchmove",this.#_h,!1),this.#vh.removeEventListener("touchend",this.#_h,!1),this.#To.removeChild(this.#vh),this.#vh=null,this.#Lh=!1}createUI(t,e){if(this.#To)return!1;this.#Jo=null,this.#Lh=!1,this.#Eh=0,this.#dh=new zr,this.#fh=new Ur,this.#_h=new Kr,this.#yh=new Fr(this.#dh),this.#bh=new Zr(this,this.#dh),this.#To=W.create("div",{className:"travelnotes-base-toolbar-container "+e},document.body),this.#To.addEventListener("click",t=>this.#Mh(t),!1),this.#To.addEventListener("mouseenter",t=>this.#xh(t),!1),this.#To.addEventListener("mouseleave",t=>this.#Ih(t),!1),W.create("div",{className:"travelnotes-base-toolbar-header-text",textContent:t},W.create("div",{className:"travelnotes-base-toolbar-header"},this.#To))}addToolbarItem(t){this.#dh.toolbarItemsArray.push(t)}addCssClass(t){this.#To.classList.add(t)}}class Wr{#Ch;#he;#bs;constructor(t,e,o){this.#Ch=t,this.#Ch="function"==typeof t?t():t,this.#he=e,this.#bs=o}get textContent(){return this.#Ch}get title(){return this.#he}doAction(){switch(typeof this.#bs){case"string":{const t=document.createElement("a");t.href=this.#bs,t.target="_blank",t.click()}break;case"function":this.#bs()}}}const Xr=new class extends Vr{constructor(){super()}createUI(){super.createUI(S.getText("MapLayersToolbar - Layers"),c.topLeft),this.addCssClass(".travelnotes-maplayers-toolbar-container")}addToolbarItems(){Ir.forEach(t=>{(t.providerKeyNeeded&&zn.hasKey(t.providerName.toLowerCase())||!t.providerKeyNeeded)&&this.addToolbarItem(new Wr(t.toolbarButtonData.text,t.name,()=>{Br.setMapLayer(t.name)}))}),t.mapLayersToolbar?.theDevil?.addButton&&this.addToolbarItem(new Wr("ðŸ‘¿","Reminder! The devil will know everything about you","https://www.google.com/maps/@"+U.map.getCenter().lat+","+U.map.getCenter().lng+","+U.map.getZoom()+"z"))}};class Yr{#Ph;#Oh;#Nh;#Sh;#Dh;#jh;#kh;static get#Ah(){return 3e5}#Rh(t){U.map.setZoom(U.map.getZoom()+t)}#Hh(){this.#Ph&&(this.#Ph.textContent="Â "+this.#Sh+"Â "+this.#Dh+"Â -Â ZoomÂ :Â "+String(this.#jh)+"Â ");const t=U.map;t.getMaxZoom()===this.#jh?this.#Oh.classList.add("travelnotes-mouse-ui-disabled"):this.#Oh.classList.remove("travelnotes-mouse-ui-disabled"),t.getMinZoom()===this.#jh?this.#Nh.classList.add("travelnotes-mouse-ui-disabled"):this.#Nh.classList.remove("travelnotes-mouse-ui-disabled")}constructor(){Object.freeze(this),this.#Sh=h.saved,this.#Dh="",this.#jh=0,this.#kh=null}set saveStatus(t){h.modified===t&&h.notSaved===this.#Sh||(this.#Sh=t,h.modified!==t||this.#kh?h.saved===t&&this.#kh&&(clearTimeout(this.#kh),this.#kh=null):this.#kh=setTimeout(()=>this.#Sh=h.notSaved,Yr.#Ah),this.#Hh())}createUI(){const e=W.create("div",{id:"travelnotes-mouse-ui"},document.body);this.#Nh=W.create("span",{id:"travelnotes-mouse-ui-zoom-minus",textContent:"â–¼"},e),this.#Nh.addEventListener("click",()=>this.#Rh(-1)),this.#Ph=W.create("span",null,e),this.#Oh=W.create("span",{id:"travelnotes-mouse-ui-zoom-plus",textContent:"â–²"},e),this.#Oh.addEventListener("click",()=>this.#Rh(1)),this.#jh=U.map.getZoom(),this.#Dh=D.formatLat(t.map.center.lat)+"Â -Â "+D.formatLng(t.map.center.lng),U.map.on("mousemove",t=>{this.#Dh=D.formatLatLng([t.latlng.lat,t.latlng.lng]),this.#Hh()}),U.map.on("zoomend",()=>{this.#jh=U.map.getZoom(),this.#Hh()})}}const Gr=new Yr;class qr extends vs{#Bh=null;constructor(){super()}createContentHTML(){this.#Bh=W.create("div",{id:"travelnotes-about-dialog-about"}),N.sanitizeToHtmlElement('<p>This  program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or any later version.</p><p>Copyright - 2017 2023 - wwwouaiebe</p><p>Contact : <a href="https://www.ouaie.be/pages/Contact" target="_blank">https://www.ouaie.be/</a></p><p>GitHub : <a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank">https://github.com/wwwouaiebe/TravelNotes</a></p><p>Version : '+E+'.<p>This program uses: <a href="https://leafletjs.com/" target="_blank">leaflet</a>, <a href="https://github.com/Project-OSRM/osrm-text-instructions" target="_blank">Project-OSRM/osrm-text-instructions</a> and  <a href="https://github.com/drolbr/Overpass-API" target="_blank">the Overpass API</a></p>',this.#Bh)}show(){super.show(),this.mover.centerDialog()}get contentHTMLElements(){return[this.#Bh]}get title(){return S.getText("AboutDialog - About Travel & Notes")}}const Jr=new class{#zh=navigator.geolocation?n.inactive:n.disabled;#Fh=null;#Zh(t){Bn.dispatch("geolocationpositionchanged",{position:t})}#Kh(){n.active===this.#zh&&(this.#zh=n.inactive),Bn.dispatch("geolocationstatuschanged",{status:this.#zh}),this.#Fh&&(navigator.geolocation.clearWatch(this.#Fh),this.#Fh=null)}#Uh(t){1===t.code&&(this.#zh=n.refusedByUser),2===t.code&&Rn.showError(S.getText("GeoLocator - Geolocation disabled on the device")),this.#Kh()}#Vh(){this.#zh=n.active,Bn.dispatch("geolocationstatuschanged",{status:this.#zh}),t.geoLocation.watch?this.#Fh=navigator.geolocation.watchPosition(t=>this.#Zh(t),t=>this.#Uh(t),t.geoLocation.options):navigator.geolocation.getCurrentPosition(t=>this.#Zh(t),t=>this.#Uh(t),t.geoLocation.options)}constructor(){Object.freeze(this)}get status(){return this.#zh}switch(){switch(this.#zh){case n.inactive:this.#Vh();break;case n.active:this.#Kh()}return this.#zh}};class $r{#Wh;#Xh;#Yh;constructor(t,e,o){Object.freeze(this),this.#Wh=t,this.#Xh=e,this.#Yh=o}get removeTravelNotes(){return this.#Wh}get removeRoutesNotes(){return this.#Xh}get removeManeuvers(){return this.#Yh}}class Qr extends fn{#Gh;#qh;#Jh;constructor(t){super(t)}createContentHTML(){this.#Gh=new Wn({afterText:S.getText("SaveAsDialog - Remove Travel Notes"),checked:!1}),this.#qh=new Wn({afterText:S.getText("SaveAsDialog - Remove Routes Notes"),checked:!1}),this.#Jh=new Wn({afterText:S.getText("SaveAsDialog - Remove Maneuvers"),checked:!1})}onOk(){super.onOk(new $r(this.#Gh.checked,this.#qh.checked,this.#Jh.checked))}get contentHTMLElements(){return[this.#Gh.controlHTMLElement,this.#qh.controlHTMLElement,this.#Jh.controlHTMLElement]}get title(){return S.getText("SaveAsDialog - SaveAs")}}const ta=new class{#$h(e){const o=new Z;o.jsonObject=U.travel.jsonObject,o.name+="-partial";let i=o.routes.iterator;for(;!i.done;)i.value.hidden=!1;if(e.removeTravelNotes&&o.notes.removeAll(),e.removeRoutesNotes)for(i=o.routes.iterator;!i.done;)i.value.notes.removeAll();if(e.removeManeuvers)for(i=o.routes.iterator;!i.done;)i.value.itinerary.maneuvers.removeAll();const n=(new Ar).compress(o);D.saveFile(n.name+"."+(pn.isTouch?t.files.writeTouch:t.files.writeOthers),JSON.stringify(n),"application/json")}#Qh(){return""!==U.travel.name||(Rn.showError(S.getText("TravelEditor - Gives a name to the travel")),Bn.dispatch("showtravelproperties"),!1)}constructor(){Object.freeze(this)}routeDropped(t,e,o){const i=t===U.travel.editedRoute.objId?U.editedRouteObjId:t,n=e===U.travel.editedRoute.objId?U.editedRouteObjId:e;U.travel.routes.moveTo(i,n,o),jr.chainRoutes(),Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook")}saveAsTravel(){if(this.#Qh())return g!==U.editedRouteObjId?(Rn.showError(S.getText("TravelEditor - Not possible to partial save when a route is edited.")),void Bn.dispatch("showtravelproperties")):void(new Qr).show().then(t=>{this.#$h(t)}).catch(t=>{t instanceof Error&&console.error(t)})}saveTravel(){if(!this.#Qh())return;const e=U.travel.routes.iterator;for(;!e.done;)e.value.hidden=!1;const o=(new Ar).compress(U.travel);D.saveFile(o.name+"."+(pn.isTouch?t.files.writeTouch:t.files.writeOthers),JSON.stringify(o),"application/json"),Gr.saveStatus=h.saved}newTravel(){t.travelNotes.haveBeforeUnloadWarning&&!window.confirm(S.getText("TravelEditor - This page ask to close; data are perhaps not saved."))||(Lr.deleteAllProfiles(),Bn.dispatch("removeallobjects"),U.editedRouteObjId=g,U.travel.jsonObject=(new Z).jsonObject,Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook"),Bn.dispatch("updatetravelnotes"),t.travelNotes.startupRouteEdition&&jr.editRoute(U.travel.routes.first.objId),Gr.saveStatus=h.saved)}};class ea extends gn{#tc;#ec(){this.onTop?(this.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-docked"),this.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-hidden-content"),this.dialogHTMLElement.style.top="0px",this.#tc=!0):(this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-docked"),this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-hidden-content"),this.#tc=!1)}constructor(){super(),this.#tc=!1}get dialogDocked(){return this.#tc}centerDialog(){this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-docked"),this.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-hidden-content"),super.centerDialog()}moveDialogTo(t,e,o){super.moveDialogTo(t,e,o),o&&"touchmove"===o||this.#ec()}}class oa extends vs{#ve;#fe;#oc;#ic;#Eh;#Lh;static get#Th(){return 100}static get#nc(){return 1500}#sc(){this.mover.dialogDocked&&(Is.isActive?this.#oc=setTimeout(()=>{this.#sc()},Math.max(oa.#nc,t.dockableBaseDialog.timeout)):this.mover.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-hidden-content"))}#rc(t){this.#Eh=t.timeStamp,this.#oc&&(clearTimeout(this.#oc),this.#oc=null),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.remove("travelnotes-dockable-base-dialog-hidden-content")}#ac(){this.mover.dialogDocked&&(this.#oc=setTimeout(()=>{this.#sc()},Math.max(oa.#nc,t.dockableBaseDialog.timeout)))}#lc(t){t.preventDefault(),oa.#Th>t.timeStamp-this.#Eh||this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.toggle("travelnotes-dockable-base-dialog-hidden-content")}constructor(t,e){super(),this.#ve=t,this.#fe=e,this.#oc=null,this.#ic=null,this.#Eh=0,this.#Lh=!1}get mover(){return this.#ic?this.#ic:this.#ic=new ea}onCancel(){super.onCancel(),this.#Lh=!1,this.#ic&&(this.#ic=null)}show(){this.#Lh||(super.show(),this.addCssClass("travelnotes-dockable-base-dialog"),this.updateContent(),null!==this.#ve&&null!==this.#fe?(this.mover.moveDialogTo(this.#ve,this.#fe),this.#ve=null,this.#fe=null):this.mover.moveDialogToLastPosition(),this.mover.dialogHTMLElement.addEventListener("mouseenter",t=>this.#rc(t),!1),t.dockableBaseDialog.hideOnMouseLeave&&this.mover.dialogHTMLElement.addEventListener("mouseleave",()=>this.#ac(),!1),this.mover.topBarHTMLElement.addEventListener("click",t=>this.#lc(t),!1),this.mover.dialogDocked&&this.mover.dialogHTMLElement.classList.add("travelnotes-dockable-base-dialog-hidden-content"),this.#Lh=!0)}}class ia{#X="";#hc=!1;#cc=[];#dc=["node","way","relation"];#uc=[];#mc=!1;#pc=!1;#t=g;constructor(t,e){this.#X=N.sanitizeToJsString(t),e&&(this.#pc=!0,this.#hc=!0),this.#t=b.nextObjId,Object.freeze(this)}get name(){return this.#X}get isRoot(){return this.#hc}get items(){return this.#cc}get elementTypes(){return this.#dc}setElementType(t){f!==["node","way","relation"].indexOf(t)&&(this.#dc=[t])}get filterTagsArray(){return this.#uc}get isSelected(){return this.#mc}set isSelected(t){this.#mc=t,this.items.forEach(e=>{e.isSelected=t})}get isExpanded(){return this.#pc}set isExpanded(t){this.#pc=t}get objId(){return this.#t}}const na=new class{#gc;#vc;#fc;#_c;#yc(t){const e=t.split(";");for(;""===e[e.length-1];)e.pop();let o=0;const i=[];e.forEach(t=>{if(""!==t)if(f===t.indexOf("="))this.#fc=new ia(t),this.#vc.set(this.#fc.objId,this.#fc),this.#_c[o].push(this.#fc),this.#_c[o+1]=this.#fc.items;else{let e=t.split("=");if("element"===e[0])this.#fc.setElementType(e[1]);else{let t={};t[e[0]]="*"===e[1]?null:e[1],i.push(t)}}o++}),0!==i.length&&this.#fc.filterTagsArray.push(i)}#bc(t){t.items.forEach(t=>{this.#bc(t)}),t.isExpanded=!0}#Lc(t){t.items.forEach(t=>{this.#Lc(t)}),t.isExpanded=!1}constructor(){this.#gc=new ia("",!0),this.#vc=new Map,this.#vc.set(this.#gc.objId,this.#gc),this.#_c=[this.#gc.items],Object.freeze(this)}get dictionary(){return this.#gc}parseDictionary(t){t.split(/\r\n|\r|\n/).forEach(t=>{""!==t&&this.#yc(t)})}selectItem(t,e){this.#vc.get(t).isSelected=e}unselectAll(){this.#gc.isSelected=!1}expandItem(t){let e=this.#vc.get(t);e.isExpanded=!e.isExpanded}expand(){this.#bc(this.#gc)}collapse(){this.#gc.items.forEach(t=>this.#Lc(t))}};class sa{#Tc;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),na.unselectAll(),this.#Tc.redraw()}}class ra{#Tc;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),na.collapse(),this.#Tc.redraw()}}class aa{#Tc;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),na.expand(),this.#Tc.redraw()}}class la{#Ec;#wc;#Mc;static get#xc(){return 5e3}#Ic(t,e){let o=!0;return e.forEach(e=>{const[i,n]=Object.entries(e)[0];o=o&&t.tags[i]&&(!n||t.tags[i]===n)}),o}#Cc(t,e){this.#wc.forEach(o=>{o.filterTagsArray.forEach(i=>{this.#Ic(t,i)&&(t.description=o.name,e.set(t.id,t))})})}#Pc(){const e=[],o=new Map;this.#wc.forEach(t=>{t.filterTagsArray.forEach(e=>{const[i,n]=Object.entries(e[0])[0];let s=o.get(i);s||(s={values:new Map,elements:new Map},o.set(i,s)),s.values.set(n,n),t.elementTypes.forEach(t=>{s.elements.set(t,t)})})});const i=this.#Oc();this.#Mc=i;const n="("+i.getSouthWest().lat.toFixed(a.fixed)+","+i.getSouthWest().lng.toFixed(a.fixed)+","+i.getNorthEast().lat.toFixed(a.fixed)+","+i.getNorthEast().lng.toFixed(a.fixed)+")";return o.forEach((o,i)=>{let s='"'+i+'"';if(1===o.values.size){const t=o.values.values().next().value;t&&(s+='="'+t+'"')}else 1<o.values.size&&(s+='~"',o.values.forEach(t=>{s+=t+"|"}),s=s.substring(0,s.length-1)+'"');if(t.overpassApi.useNwr){const t=1===o.elements.size?o.elements.values().next().value:"nwr";e.push(t+"["+s+"]"+n+";"+("node"===t?"":"(._;>;);")+"out;")}else{let t=[];1===o.elements.size?t.push(o.elements.values().next().value):t=["node","way","rel"],t.forEach(t=>{e.push(t+"["+s+"]"+n+";"+("node"===t?"":"(._;>;);")+"out;")})}}),e}#Nc(t){t.isSelected&&0<t.filterTagsArray.length&&this.#wc.push(t),t.items.forEach(t=>this.#Nc(t))}#Oc(){const t=U.map.getCenter(),e=U.map.getBounds(),o=rn.getSquareBoundingBox([t.lat,t.lng],la.#xc);return e.getSouthWest().lat=Math.max(e.getSouthWest().lat,o.getSouthWest().lat),e.getSouthWest().lng=Math.max(e.getSouthWest().lng,o.getSouthWest().lng),e.getNorthEast().lat=Math.min(e.getNorthEast().lat,o.getNorthEast().lat),e.getNorthEast().lng=Math.min(e.getNorthEast().lng,o.getNorthEast().lng),e}constructor(){Object.freeze(this),this.#Ec=!1,this.#wc=[],this.#Mc=null}async search(){if(this.#Ec)return;this.#Ec=!0,this.#wc=[],this.#Nc(na.dictionary);const t=new Rs({searchPlaces:!1});await t.loadData(this.#Pc());const e=new Map;t.statusOk||Rn.showError(S.getText("OsmSearchEngine - incomplete results")),[t.nodes,t.ways,t.relations].forEach(t=>{t.forEach(t=>{t.tags&&this.#Cc(t,e)})}),U.searchData.length=0,Array.from(e.values()).sort((t,e)=>t.description>e.description).forEach(t=>U.searchData.push(t)),this.#Ec=!1,Bn.dispatch("updateosmsearch")}get searchBounds(){return this.#Oc()}get previousSearchBounds(){return this.#Mc}}const ha=new la;class ca{#Tc;#Sc;constructor(t,e){Object.freeze(this),this.#Tc=t,this.#Sc=e}handleEvent(t){t.stopPropagation(),na.dictionary.isExpanded=!1,this.#Tc.redraw(),U.searchData.length=0,Bn.dispatch("updateosmsearch"),this.#Sc.showWait(),ha.search()}}class da{#Dc;constructor(t,e){Object.freeze(this),this.#Dc=W.create("div"),W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("OsmSearchToolbarButtons - Start the search"),textContent:"ðŸ”Ž"},this.#Dc).addEventListener("click",new ca(t,e),!1),W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("OsmSearchToolbarButtons - Expand the tree"),textContent:"â–¼"},this.#Dc).addEventListener("click",new aa(t),!1),W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("OsmSearchToolbarButtons - Collapse the tree"),textContent:"â–¶"},this.#Dc).addEventListener("click",new ra(t),!1),W.create("div",{className:"travelnotes-base-dialog-button",title:S.getText("OsmSearchToolbarButtons - Clear the tree"),textContent:"âŒ"},this.#Dc).addEventListener("click",new sa(t),!1)}get toolbarButtonsHTMLElement(){return this.#Dc}}class ua{#Tc=null;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),na.expandItem(Number.parseInt(t.target.parentNode.dataset.tanObjId)),this.#Tc.redraw()}}class ma{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),t.deltaY&&(t.target.scrollTop+=t.deltaY*v[t.deltaMode]),t.stopPropagation()}}class pa{#Tc=null;constructor(t){Object.freeze(this),this.#Tc=t}handleEvent(t){t.stopPropagation(),na.selectItem(Number.parseInt(t.target.parentNode.dataset.tanObjId),t.target.checked),this.#Tc.redraw()}}class ga{#jc;#kc;#Ac;#Rc;#Hc(t){this.#Rc++;const e=W.create("div",{className:"travelnotes-osm-search-dialog-search-item-margin"+this.#Rc,dataset:{ObjId:t.objId}},this.#jc);if(!t.isRoot){W.create("input",{type:"checkbox",checked:t.isSelected},e).addEventListener("change",this.#Ac,!1)}if(0===t.filterTagsArray.length){W.create("div",{className:"travelnotes-base-dialog-button travelnotes-osm-search-dialog-tree-arrow",textContent:t.isExpanded?"â–¼":"â–¶"},e).addEventListener("click",this.#kc,!1)}W.create("text",{value:t.name},e),t.isExpanded&&t.items.forEach(t=>this.#Hc(t)),this.#Rc--}constructor(){Object.freeze(this),this.#Rc=0,this.#jc=W.create("div",{id:"travelnotes-osm-search-dialog-search-tree"}),this.#jc.addEventListener("wheel",new ma,{passive:!0}),this.#Ac=new pa(this),this.#kc=new ua(this),this.#Hc(na.dictionary)}redraw(){this.#jc.textContent="",this.#Hc(na.dictionary)}get treeHTMLElement(){return this.#jc}}class va{#He;constructor(){this.#He=W.create("div",{className:"travelnotes-wait-animation"}),W.create("div",{className:"travelnotes-wait-animation-bullet"},this.#He),this.#He.classList.add("travelnotes-hidden")}showWait(){this.#He.classList.remove("travelnotes-hidden")}hideWait(){this.#He.classList.add("travelnotes-hidden")}get waitHTMLElement(){return this.#He}}class fa{#ua;constructor(t,e){Object.freeze(this),this.#ua=new Gs(t,e)}destructor(){this.#ua=null}get addressButtonClick(){return this.#ua}}class _a extends fn{#Bc;#zc;#La;#xa;constructor(t){super(),this.#Bc=t,this.#xa=new fa(this,this.#Bc.latLng)}createContentHTML(){this.#zc=new is({headerText:S.getText("WayPointPropertiesDialog - Name")},this.#xa),this.#zc.value=this.#Bc.name,this.#La=new ks(this.#xa),this.#La.address=this.#Bc.address}onCancel(){this.#xa.destructor(),super.onCancel()}onOk(){this.#Bc.address=this.#La.address,this.#Bc.name=this.#zc.value,this.#xa.destructor(),super.onOk()}get contentHTMLElements(){return[this.#zc.controlHTMLElement,this.#La.controlHTMLElement]}set name(t){this.#zc.name=t}set address(t){this.#La.address=t}get title(){return S.getText("WayPointPropertiesDialog - Waypoint properties")}get wayPoint(){return this.#Bc}setControlsValues(t){this.#La.address=t.address,this.#zc.value=t.name}}const ya=new class{#Fc;#Zc;#Kc(t){const e=t.itinerary.itineraryPoints.iterator,i=t.itinerary.maneuvers.iterator;for(e.done,i.done,i.value.distance=o.defaultValue,i.done,t.distance=o.defaultValue,t.duration=o.defaultValue;!e.done;)e.previous.distance=Fn.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,i.previous.distance+=e.previous.distance,i.value.itineraryPointObjId===e.value.objId&&(t.duration+=i.previous.duration,i.value.distance=o.defaultValue,i.next&&i.value.itineraryPointObjId===i.next.itineraryPointObjId&&(i.done,i.value.distance=o.defaultValue),i.done)}#Uc(t){this.#Fc=!1,t instanceof Error?(console.error(t),Rn.showError(t.message)):Rn.showError("A network error occurs when calling the provider")}#Vc(){if(this.#Fc=!1,this.#Kc(U.travel.editedRoute),"circle"!==U.travel.editedRoute.itinerary.transitMode){const t=U.travel.editedRoute.wayPoints.iterator;for(;!t.done;)t.first?t.value.latLng=U.travel.editedRoute.itinerary.itineraryPoints.first.latLng:t.last?t.value.latLng=U.travel.editedRoute.itinerary.itineraryPoints.last.latLng:t.value.latLng=rn.getClosestLatLngDistance(U.travel.editedRoute,t.value.latLng).latLng}const t=U.travel.editedRoute.notes.iterator;for(;!t.done;){const e=rn.getClosestLatLngDistance(U.travel.editedRoute,t.value.latLng);t.value.latLng=e.latLng,t.value.distance=e.distance}jr.chainRoutes(),U.travel.editedRoute.notes.sort((t,e)=>t.distance-e.distance),this.#Zc&&(new ur).zoomToRoute(U.travel.editedRoute.objId),Lr.createProfile(U.travel.editedRoute),Bn.dispatch("routeupdated",{removedRouteObjId:U.travel.editedRoute.objId,addedRouteObjId:U.travel.editedRoute.objId}),Bn.dispatch("updateroadbook"),Bn.dispatch("updatetravelproperties")}constructor(){Object.freeze(this)}startRouting(){if(!this.#Fc&&U.travel.editedRoute.haveValidWayPoints()){this.#Zc=0===U.travel.editedRoute.itinerary.itineraryPoints.length,this.#Fc=!0;const t=U.providers.get(U.routing.provider.toLowerCase());U.travel.editedRoute.itinerary.provider=t.name,U.travel.editedRoute.itinerary.transitMode=U.routing.transitMode,t.getPromiseRoute(U.travel.editedRoute).then(()=>this.#Vc()).catch(()=>this.#Uc())}}};const ba=new class{async#Wc(e){if(!t.wayPoint.reverseGeocoding)return Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook"),void Bn.dispatch("updateprofilename",{routeObjId:U.editedRouteObjId});const o=await(new zs).getAddressAsync(e.latLng);U.editedRouteObjId===U.travel.editedRoute.objId&&(U.travel.editedRoute.editionStatus=l.editedChanged),e.address=o.street,""!==o.city&&(e.address+=" "+o.city),e.name="",t.wayPoint.geocodingIncludeName&&(e.name=o.name),Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook"),Bn.dispatch("updateprofilename",{routeObjId:U.travel.editedRoute.objId})}#Xc(t){const e=U.travel.editedRoute.wayPoints.first;e.latLng=t,this.#Wc(e),Bn.dispatch("addwaypoint",{wayPoint:e,letter:"A"})}#Yc(t){const e=U.travel.editedRoute.wayPoints.last;e.latLng=t,this.#Wc(e),Bn.dispatch("addwaypoint",{wayPoint:e,letter:"B"})}constructor(){Object.freeze(this)}addWayPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged;const e=new A;e.latLng=t,U.travel.editedRoute.wayPoints.add(e),this.#Wc(e),Bn.dispatch("addwaypoint",{wayPoint:U.travel.editedRoute.wayPoints.last,letter:U.travel.editedRoute.wayPoints.length-2}),U.travel.editedRoute.wayPoints.swap(e.objId,!0),ya.startRouting()}addWayPointOnRoute(t,e){const o=rn.getClosestLatLngDistance(U.travel.editedRoute,t).distance;U.travel.editedRoute.editionStatus=l.editedChanged;const i=new A;i.latLng=e;let n="";const s=U.travel.editedRoute.wayPoints.iterator;for(;!s.done;){if(o<rn.getClosestLatLngDistance(U.travel.editedRoute,s.value.latLng).distance){n=String(s.index),U.travel.editedRoute.wayPoints.add(i),U.travel.editedRoute.wayPoints.moveTo(i.objId,s.value.objId,!0),this.#Wc(i),Bn.dispatch("addwaypoint",{wayPoint:i,letter:n}),ya.startRouting();break}}}reverseWayPoints(){U.travel.editedRoute.editionStatus=l.editedChanged;let t=U.travel.editedRoute.wayPoints.iterator;for(;!t.done;)Bn.dispatch("removeobject",{objId:t.value.objId});for(U.travel.editedRoute.wayPoints.reverse(),t=U.travel.editedRoute.wayPoints.iterator;!t.done;)Bn.dispatch("addwaypoint",{wayPoint:t.value,letter:t.first?"A":t.last?"B":String(t.index)});Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook"),ya.startRouting()}removeWayPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,Bn.dispatch("removeobject",{objId:t}),U.travel.editedRoute.wayPoints.remove(t),ya.startRouting()}setStartPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,this.#Xc(t),ya.startRouting()}setEndPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,this.#Yc(t),ya.startRouting()}setStartAndEndPoint(t){U.travel.editedRoute.editionStatus=l.editedChanged,this.#Xc(t),this.#Yc(t),2<U.travel.editedRoute.wayPoints.length&&ya.startRouting()}wayPointDragEnd(t){U.travel.editedRoute.editionStatus=l.editedChanged;const e=U.travel.editedRoute.wayPoints.getAt(t.target.objId),o=t.target.getLatLng();e.latLng=[o.lat,o.lng],this.#Wc(e),ya.startRouting()}wayPointProperties(t){const e=U.travel.editedRoute.wayPoints.getAt(t);new _a(e).show().then(()=>{Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook")}).catch(t=>{t instanceof Error&&console.error(t)})}};class La{#ns;#Pa;constructor(t,e){this.#ns=t,this.#Pa=e}get latLng(){return this.#ns}get geometry(){return this.#Pa}}class Ta extends Is{#Gc;#ns;constructor(t,e){super(t,e),this.#Gc=U.searchData[Number.parseInt(t.currentTarget.dataset.tanElementIndex)],this.#ns=[this.#Gc.lat,this.#Gc.lon],Bn.dispatch("removeobject",{objId:this.targetObjId})}get menuItems(){return[new Cs(S.getText("OsmSearchContextMenu - Select this point as start point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.first.lat,()=>ba.setStartPoint(this.#ns)),new Cs(S.getText("OsmSearchContextMenu - Select this point as way point"),g!==U.editedRouteObjId,()=>ba.addWayPoint(this.#ns)),new Cs(S.getText("OsmSearchContextMenu - Select this point as end point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.last.lat,()=>ba.setEndPoint(this.#ns)),new Cs(S.getText("OsmSearchContextMenu - Create a route note with this result"),!0,()=>mr.newSearchRouteNote(this.#Gc)),new Cs(S.getText("OsmSearchContextMenu - Create a travel note with this result"),!0,()=>mr.newSearchTravelNote(this.#Gc)),new Cs(S.getText(mr.osmSearchNoteDialog?"OsmSearchContextMenu - Hide note dialog":"OsmSearchContextMenu - Show note dialog"),!0,()=>mr.changeOsmSearchNoteDialog()),new Cs(S.getText("OsmSearchContextMenu - Zoom to this result"),!0,()=>(new ur).zoomToPoi(new La(this.#ns,this.#Gc.geometry)))]}}class Ea{#qc;#Jc;#$c;#Qc;#td;#ed;#od;#id;#nd;#sd;#rd;#ad;#ld;#hd;static get#cd(){return 1e3}static get#dd(){return 40}static get#ud(){return 5}static get#md(){return 200}static get#pd(){return 100}#gd(t){t!==this.#Qc&&Ea.#dd<t-this.#Qc&&(this.#od.scrollTop-=Ea.#ud,this.#Qc=t),this.#id>this.#sd&&0<this.#od.scrollTop&&window.requestAnimationFrame(t=>{this.#gd(t)})}#vd(t){t!==this.#Qc&&Ea.#dd<t-this.#Qc&&(this.#od.scrollTop+=Ea.#ud,this.#Qc=t);let e=1>Math.abs(this.#od.scrollHeight-this.#od.clientHeight-this.#od.scrollTop);this.#nd<this.#sd&&!e&&window.requestAnimationFrame(t=>{this.#vd(t)})}#se(t){const e=t.changedTouches.item(0);if(1===t.touches.length){if(Ea.#cd<t.timeStamp-this.#$c||0===this.#$c)return void(this.#$c=t.timeStamp);t.preventDefault(),this.#Jc=!0,this.#ed=t.currentTarget.parentNode,this.#od=t.currentTarget.parentNode.parentNode.parentNode,this.#sd=e.screenY;const o=t.currentTarget.getBoundingClientRect();this.#ld=e.screenX-o.left,this.#hd=e.screenY-o.top,this.#td=t.currentTarget.cloneNode(!0),this.#td.classList.add("travelnotes-sortable-list-dragged-item"),document.body.appendChild(this.#td),this.#td.style.left=String(e.screenX-this.#ld)+"px",this.#td.style.top=String(e.screenY-this.#hd)+"px",this.#id=this.#ed.getBoundingClientRect().y-this.#od.getBoundingClientRect().y+this.#od.scrollTop+Ea.#md,this.#nd=this.#od.getBoundingClientRect().bottom-Ea.#pd}}#ne(t){if(!this.#Jc)return;const e=t.changedTouches.item(0);if(1===t.touches.length&&this.#td){this.#td.style.left=String(e.screenX-this.#ld)+"px",this.#td.style.top=String(e.screenY-this.#hd)+"px",this.#sd=e.screenY,this.#id>this.#sd&&0<this.#od.scrollTop&&window.requestAnimationFrame(t=>{this.#gd(t)});let t=1>Math.abs(this.#od.scrollHeight-this.#od.clientHeight-this.#od.scrollTop);this.#nd<this.#sd&&!t&&window.requestAnimationFrame(t=>{this.#vd(t)})}}#fd(t){this.#ed.childNodes.forEach(e=>{let o=e.getBoundingClientRect();o.left<t.clientX&&o.right>t.clientX&&o.top<t.clientY&&o.bottom>t.clientY&&(this.#rd=e,this.#ad=t.clientY-o.top<o.height/2)})}#ie(t){if(this.#Jc){let e=t.changedTouches.item(0);if(this.#fd(e),this.#rd)try{this.#qc(Number.parseInt(t.currentTarget.dataset.tanObjId),Number.parseInt(this.#rd.dataset.tanObjId),this.#ad)}catch{}}this.#_d()}#_d(){this.#td&&document.body.removeChild(this.#td),this.#td=null,this.#od=null,this.#Jc=!1,this.#Qc=0,this.#ed=null,this.#id=0,this.#nd=0,this.#sd=0,this.#rd=null,this.#ad=!0}constructor(t){Object.freeze(this),this.#qc=t,this.#td=null,this.#$c=0,this.#_d()}handleEvent(t){switch(t.type){case"touchstart":this.#se(t);break;case"touchmove":this.#ne(t);break;case"touchend":this.#ie(t);break;case"touchcancel":this.#_d()}}}class wa{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();try{t.dataTransfer.setData("ObjId",t.target.dataset.tanObjId),t.dataTransfer.dropEffect="move"}catch(t){t instanceof Error&&console.error(t)}}}class Ma{#qc;constructor(t){Object.freeze(this),this.#qc=t}handleEvent(t){t.preventDefault();const e=t.currentTarget.getBoundingClientRect();try{this.#qc(Number.parseInt(t.dataTransfer.getData("ObjId")),Number.parseInt(t.currentTarget.dataset.tanObjId),t.clientY-e.top<e.bottom-t.clientY)}catch{}}}class xa{#yd;constructor(t){Object.freeze(this),this.#yd=t}handleEvent(t){t.stopPropagation(),t.preventDefault(),new this.#yd(t,t.target.parentNode).show()}}class Ia extends bn{#bd;#Ld;#Td;#Ed;#ed;constructor(t,e,o){super(),this.#bd=new wa,this.#Ld=new Ma(t),this.#Td=new xa(e),this.#Ed=new Ea(t),o&&W.create("div",{className:"travelnotes-base-dialog-flex-row",textContent:o},this.controlHTMLElement),this.#ed=W.create("div",{className:"travelnotes-sortable-list-container"},this.controlHTMLElement)}updateContent(t){for(;this.#ed.firstChild;)this.#ed.firstChild.removeEventListener("dragstart",this.#bd,!1),this.#ed.firstChild.removeEventListener("drop",this.#Ld,!1),this.#ed.firstChild.removeEventListener("contextmenu",this.#Td,!1),this.#ed.firstChild.removeEventListener("touchstart",this.#Ed,!1),this.#ed.firstChild.removeEventListener("touchmove",this.#Ed,!1),this.#ed.firstChild.removeEventListener("touchend",this.#Ed,!1),this.#ed.removeChild(this.#ed.firstChild);t.forEach(t=>{t.draggable=!0,t.addEventListener("dragstart",this.#bd,!1),t.addEventListener("drop",this.#Ld,!1),t.addEventListener("contextmenu",this.#Td,!1),t.addEventListener("touchstart",this.#Ed,!1),t.addEventListener("touchmove",this.#Ed,!1),t.addEventListener("touchend",this.#Ed,!1),this.#ed.appendChild(t),t.classList.add("travelnotes-sortable-list-item")})}}class Ca{#wd;#Gc;#Md;static get#fr(){return 40}#xd(){let t="";t=this.#Gc.tags.rcn_ref?"<div class='travenNotes-map-note travenNotes-map-note-category-0073'><svg viewBox='0 0 20 20'><text class='' x=10 y=14>"+this.#Gc.tags.rcn_ref+"</text></svg></div>":Ns.preDefinedIconDataFromName(this.#Gc.description)||"";const e=W.create("div",{className:"travelnotes-osm-search-dialog-search-result-icon-cell"},this.#wd);N.sanitizeToHtmlElement(t,e)}#Id(t){t&&W.create("div",{textContent:t},this.#Md)}#Ur(){const t=(this.#Gc.tags["addr:street"]?(this.#Gc.tags["addr:housenumber"]?this.#Gc.tags["addr:housenumber"]+" ":"")+this.#Gc.tags["addr:street"]+" ":"")+(this.#Gc.tags["addr:city"]?(this.#Gc.tags["addr:postcode"]?this.#Gc.tags["addr:postcode"]+" ":"")+this.#Gc.tags["addr:city"]:"");""!==t&&this.#Id(t)}#Cd(){this.#Gc.tags.phone&&this.#Id("â˜Žï¸ : "+this.#Gc.tags.phone,this.#Md)}#Pd(){this.#Gc.tags.email&&W.create("a",{href:"mailto:"+this.#Gc.tags.email,textContent:this.#Gc.tags.email},W.create("div",{textContent:"ðŸ“§ : "},this.#Md))}#Od(){this.#Gc.tags.website&&W.create("a",{href:this.#Gc.tags.website,target:"_blank",textContent:this.#Gc.tags.website.length>Ca.#fr?this.#Gc.tags.website.substring(0,Ca.#fr)+"...":this.#Gc.tags.website},W.create("div",null,this.#Md))}#Nd(){this.#Md=W.create("div",{className:"travelnotes-osm-search-dialog-search-result-cell"},this.#wd),this.#Id(this.#Gc.description),this.#Id(this.#Gc.tags.name),this.#Id(this.#Gc.tags.rcn_ref),this.#Ur(),this.#Cd(),this.#Pd(),this.#Od()}#Sd(){for(const[t,e]of Object.entries(this.#Gc.tags))this.#wd.title+=t+"="+e+"\n"}constructor(){Object.freeze(this)}buildHTMLElement(t,e){return this.#Gc=t,this.#wd=W.create("div",{className:"travelnotes-osm-search-dialog-search-result-row",dataset:{ObjId:b.nextObjId,ElementIndex:e}}),this.#xd(),this.#Nd(),this.#Sd(),this.#wd}}class Pa{#Dd;#jd;#kd(){g===this.#jd?this.#jd=b.nextObjId:Bn.dispatch("removeobject",{objId:this.#jd}),Bn.dispatch("addrectangle",{objId:this.#jd,bounds:ha.searchBounds,properties:t.osmSearch.nextSearchLimit})}#Ad(){const e=ha.previousSearchBounds;e&&(g===this.#Dd?this.#Dd=b.nextObjId:Bn.dispatch("removeobject",{objId:this.#Dd}),Bn.dispatch("addrectangle",{objId:this.#Dd,bounds:[[e.getSouthWest().lat,e.getSouthWest().lng],[e.getNorthEast().lat,e.getNorthEast().lng]],properties:t.osmSearch.previousSearchLimit}))}constructor(){Object.freeze(this),this.#Dd=g,this.#jd=g}show(){U.map.on("zoom",this.#kd,this),U.map.on("move",this.#kd,this),this.#kd(),this.#Ad()}hide(){U.map.off("zoom",this.#kd,this),U.map.off("move",this.#kd,this),g!==this.#jd&&(Bn.dispatch("removeobject",{objId:this.#jd}),this.#jd=g),g!==this.#Dd&&(Bn.dispatch("removeobject",{objId:this.#Dd}),this.#Dd=g)}}class Oa{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation();const e=U.searchData[Number.parseInt(t.target.dataset.tanElementIndex)];Bn.dispatch("addsearchpointmarker",{objId:Number.parseInt(t.target.dataset.tanObjId),latLng:[e.lat,e.lon],geometry:e.geometry})}}class Na{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),Bn.dispatch("removeobject",{objId:Number.parseInt(t.target.dataset.tanObjId)})}}class Sa extends oa{#Rd;#To;#Hd;#Tc;#Sc;#Bd;#zd;#Fd;#ql(){this.#To=W.create("div"),this.#Tc=new ga,this.#Sc=new va;const t=new da(this.#Tc,this.#Sc);this.#To.appendChild(t.toolbarButtonsHTMLElement),this.#To.appendChild(this.#Tc.treeHTMLElement),this.#To.appendChild(this.#Sc.waitHTMLElement)}constructor(){super(t.osmSearchDialog.dialogX,t.osmSearchDialog.dialogY)}createContentHTML(){this.#ql(),this.#Hd=new Ia(null,Ta),this.#Bd=new Ca,this.#Rd=new Pa,this.#zd=new Oa,this.#Fd=new Na}get contentHTMLElements(){return[].concat(this.#Hd.controlHTMLElement)}get title(){return S.getText("OsmSearchDialog - Searching OpenStreetMap")}get toolbarHTMLElement(){return this.#To}onCancel(){this.#Rd.hide(),super.onCancel()}show(){super.show(),this.#Rd.show()}updateContent(){this.#Sc.hideWait(),this.#Rd.hide(),this.#Rd.show();const t=[];U.searchData.forEach((e,o)=>{const i=this.#Bd.buildHTMLElement(e,o);i.addEventListener("mouseenter",this.#zd,!1),i.addEventListener("mouseleave",this.#Fd,!1),t.push(i)}),this.#Hd.updateContent(t)}}class Da extends fn{#Zd;constructor(t){super(t)}createContentHTML(){this.#Zd=W.create("div",{textContent:this.options.text||""})}get contentHTMLElements(){return[this.#Zd]}get title(){return this.options.title||""}}class ja{#pi=null;#Kd=0;#Ud(t){const e=new z;for(const o in t)e[o]=t[o];e.iconLatLng=e.latLng,e.distance=rn.getClosestLatLngDistance(this.#pi,e.latLng).distance,e.chainedDistance=this.#pi.chainedDistance,this.#pi.notes.add(e),Bn.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:e.objId})}async#Vd(){const t=new dr;t.createUI();const e=new sr,o=this.#pi.itinerary.maneuvers.iterator;for(;!o.done;){t.showInfo(S.getText("AllManeuverNotesBuilder - Creating note",{noteNumber:o.index+1,notesLength:this.#Kd}));const i=this.#pi.itinerary.itineraryPoints.getAt(o.value.itineraryPointObjId).latLng,n=await e.getIconAndAdressAsync(i,this.#pi);n?this.#Ud(n):console.error("An error occurs when creating the svg icon "+o.index)}this.#pi.notes.sort((t,e)=>t.distance-e.distance),Bn.dispatch("updateroadbook"),t.close()}constructor(){Object.freeze(this)}addAllManeuverNotes(e){this.#pi=Un.getRoute(e),this.#Kd=this.#pi.itinerary.maneuvers.length,t.note.maxManeuversNotes<this.#Kd?Rn.showError(S.getText("AllManeuverNotesBuilder - max maneuvers notes reached {maneuversLength}{maxManeuversNotes}",{maneuversLength:this.#Kd,maxManeuversNotes:t.note.maxManeuversNotes})):new Da({title:S.getText("AllManeuverNotesBuilder - Add a note for each maneuver"),text:S.getText("AllManeuverNotesBuilder - Add a note for each maneuver. Are you sure?",{noteLength:this.#Kd}),secondButtonText:"âŒ"}).show().then(()=>this.#Vd()).catch(t=>{t instanceof Error&&console.error(t)})}}class ka extends Is{#pi=null;constructor(t,e){super(t,e),this.#pi=Un.getRoute(this.targetObjId)}get menuItems(){return[new Cs(S.getText("RouteContextMenu - Edit this route"),this.targetObjId!==U.travel.editedRoute.objId&&l.editedChanged!==U.travel.editedRoute.editionStatus,()=>jr.editRoute(this.targetObjId)),new Cs(S.getText("RouteContextMenu - Delete this route"),this.targetObjId!==U.travel.editedRoute.objId||l.editedChanged!==U.travel.editedRoute.editionStatus,()=>jr.removeRoute(this.targetObjId)),new Cs(S.getText(this.#pi.hidden?"RouteContextMenu - Show this route":"RouteContextMenu - Hide this route"),this.#pi.hidden||U.travel.editedRoute.objId!==this.targetObjId,()=>{this.#pi.hidden?jr.showRoute(this.targetObjId):jr.hideRoute(this.targetObjId)}),new Cs(S.getText("RouteContextMenu - Properties"),!this.#pi.hidden,()=>jr.routeProperties(this.targetObjId)),new Cs(S.getText("RouteContextMenu - Zoom to route"),!this.#pi.hidden,()=>(new ur).zoomToRoute(this.targetObjId)),new Cs(S.getText("RouteContextMenu - View the elevation"),this.#pi.itinerary.hasProfile,()=>Lr.showProfile(this.targetObjId)),new Cs(S.getText("RouteContextMenu - Print route map"),t.printRouteMap.isEnabled,()=>jr.printRouteMap(this.targetObjId)),new Cs(S.getText("RouteContextMenu - Save this route in a GPX file"),0<this.#pi.itinerary.itineraryPoints.length,()=>jr.saveGpx(this.targetObjId)),new Cs(S.getText("RouteContextMenu - Invert waypoints"),U.travel.editedRoute.objId===this.targetObjId,()=>ba.reverseWayPoints()),new Cs(S.getText("RouteContextMenu - Add a note on the route"),!this.haveParentNode,()=>mr.newRouteNote(this.targetObjId,this.latLng)),new Cs(S.getText("RouteContextMenu - Create a note for each route maneuver"),!this.#pi.hidden,()=>(new ja).addAllManeuverNotes(this.targetObjId)),new Cs(S.getText("RouteContextMenu - Save modifications on this route"),U.travel.editedRoute.objId===this.targetObjId,()=>jr.saveEdition()),new Cs(S.getText("RouteContextMenu - Cancel modifications on this route"),U.travel.editedRoute.objId===this.targetObjId,()=>jr.cancelEdition())]}}class Aa{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),U.travel.name=N.sanitizeToJsString(t.target.value),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name),Bn.dispatch("updateroadbook")}}class Ra extends oa{#Wd=null;#Xd=null;constructor(){super(t.travelPropertiesDialog.dialogX,t.travelPropertiesDialog.dialogY)}createContentHTML(){this.#Wd=new is(S.getText("TravelPropertiesDialog - Name"),{controlChange:new Aa}),this.#Wd.value=U.travel.name,this.#Xd=new Ia(ta.routeDropped,ka,S.getText("TravelPropertiesDialog - Routes"))}get contentHTMLElements(){return[this.#Wd.controlHTMLElement,this.#Xd.controlHTMLElement]}get title(){return S.getText("TravelPropertiesDialog - Travel properties")}#xi(t,e){const o=(t.editionStatus===l.notEdited?"":"ðŸ”´Â ")+(t.chain?"â›“Â ":"")+(t.objId===U.editedRouteObjId?U.travel.editedRoute.computedName:t.computedName);e.push(W.create("div",{textContent:o,dataset:{ObjId:String(t.objId)}}))}updateContent(){if(!this.#Xd)return;const t=[];U.travel.routes.forEach(e=>{e.objId===U.editedRouteObjId?this.#xi(U.travel.editedRoute,t):this.#xi(e,t)}),this.#Xd.updateContent(t),this.#Wd.value=U.travel.name}}class Ha extends Is{#pi;constructor(t,e){super(t,e),this.#pi=Un.getNoteAndRoute(this.targetObjId).route}get menuItems(){return[new Cs(S.getText("NoteContextMenu - Edit this note"),!0,()=>mr.editNote(this.targetObjId)),new Cs(S.getText("NoteContextMenu - Delete this note"),!0,()=>mr.removeNote(this.targetObjId)),new Cs(S.getText("NoteContextMenu - Zoom to note"),!0,()=>(new ur).zoomToNote(this.targetObjId)),new Cs(S.getText(this.#pi?"NoteContextMenu - Detach note from route":"NoteContextMenu - Attach note to route"),g===U.editedRouteObjId,()=>{this.#pi?mr.detachNoteFromRoute(this.targetObjId):mr.attachNoteToRoute(this.targetObjId)})]}}class Ba extends oa{#Yd;constructor(){super(t.travelNotesDialog.dialogX,t.travelNotesDialog.dialogY)}createContentHTML(){this.#Yd=new Ia(mr.travelNoteDropped,Ha)}get contentHTMLElements(){return[this.#Yd.controlHTMLElement]}get title(){return S.getText("TravelNotesDialog - Travel notes dialog")}updateContent(){if(!this.#Yd)return;let t=Vs.getTravelNotesHTML("travelnotes-travel-notes-dialog-");this.#Yd.updateContent(Array.from(t.childNodes))}}const za=new class{#Gd=null;#qd=null;#Jd=null;constructor(){Object.freeze(this)}get osmSearchDialog(){return this.#Gd||(this.#Gd=new Sa(t.osmSearchDialog.dialogX,t.osmSearchDialog.dialogY)),this.#Gd}get travelPropertiesDialog(){return this.#qd||(this.#qd=new Ra(t.travelPropertiesDialog.dialogX,t.travelPropertiesDialog.dialogY)),this.#qd}get travelNotesDialog(){return this.#Jd||(this.#Jd=new Ba(t.travelNotesDialog.dialogX,t.travelNotesDialog.dialogY)),this.#Jd}showTravelProperties(){this.travelPropertiesDialog.show(),this.travelPropertiesDialog.mover.centerDialog()}};const Fa=new class{#Go;#Jo=null;hide(){this.#Jo&&(clearTimeout(this.#Jo),this.#Jo=null),this.#Go.removeEventListener("click",this.toggle,!1),document.body.removeChild(this.#Go)}constructor(){Object.freeze(this)}async toggle(){document.fullscreenElement?await document.exitFullscreen():await document.body.requestFullscreen()}show(){const e=t.FullScreenUI.timeOut;0===e||!document.fullscreenEnabled||document.body.clientWidth>t.FullScreenUI.screenMaxWidth||(this.#Go=W.create("div",{id:"travelnotes-full-screen-ui",textContent:S.getText("FullScreenUI - start full screen")},document.body),this.#Go.addEventListener("click",this.toggle,!1),this.#Jo=setTimeout(()=>this.hide(),e))}};const Za=new class{#$d;constructor(){Object.freeze(this),this.#$d=null}increment(){this.#$d||(this.#$d=t.fontSize.initialValue),this.#$d+=t.fontSize.incrementValue,document.body.style["font-size"]=String(this.#$d)+"mm"}decrement(){this.#$d||(this.#$d=t.fontSize.initialValue),this.#$d-=t.fontSize.incrementValue,document.body.style["font-size"]=String(this.#$d)+"mm"}};class Ka{#Qd;#Rt;#pi;#tu;#eu(t){let e=new R;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("ele"===o[t].nodeName)e.elev=Number.parseFloat(o[t].textContent),0!==e.elev&&(this.#pi.itinerary.hasProfile=!0);this.#pi.itinerary.itineraryPoints.add(e)}#ou(t){const e=t.childNodes;for(let t=0;t<e.length;t++)if("trkpt"===e[t].nodeName)this.#eu(e[t])}#iu(){let t=0,e=0,o=this.#pi.itinerary.itineraryPoints.iterator;for(o.done;!o.done;){let i=o.value.elev-o.previous.elev;0>i?e-=i:t+=i}this.#pi.itinerary.ascent=t,this.#pi.itinerary.descent=e}#nu(t){this.#pi=new F;const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#pi.name=e[t].textContent;break;case"trkseg":this.#ou(e[t])}this.#pi.itinerary.hasProfile&&this.#iu(),this.#Rt.routes.add(this.#pi)}#su(t){let e=Number.MAX_VALUE,o=g;return this.#pi.itinerary.itineraryPoints.forEach(i=>{const n=Fn.pointsDistance(t,i.latLng);n<e&&(e=n,o=i.objId)}),o}#ru(t){const e=new H;e.iconName="kUndefined";const o=Number.parseFloat(t.getAttributeNS(null,"lat")),i=Number.parseFloat(t.getAttributeNS(null,"lon"));e.itineraryPointObjId=this.#su([o,i]);const n=t.childNodes;for(let t=0;t<n.length;t++)if("desc"===n[t].nodeName)e.instruction=n[t].textContent;this.#pi.itinerary.maneuvers.add(e)}#au(t){const e=t.childNodes;for(let t=0;t<e.length;t++)switch(e[t].nodeName){case"name":this.#pi.name=e[t].textContent;break;case"rtept":this.#ru(e[t])}}#lu(t){const e=new z;e.latLng=t.latLng,e.iconLatLng=t.latLng;const o=t.name.split("+");e.iconContent='<div class="travenNotes-map-note travelnotes-map-note-category-0073"><svg viewBox="0 0 20 20"><text x="10" y="14">'+o[0]+"</text></svg></div>",e.tooltipContent=S.getText("GpxParser - Network node")+o[0],o[1]&&(e.tooltipContent+=S.getText("GpxParser - Go to network node")+o[1]),e.distance=rn.getClosestLatLngDistance(this.#pi,e.latLng).distance,this.#pi.notes.add(e)}#hu(t){let e=new A;e.lat=Number.parseFloat(t.getAttributeNS(null,"lat")),e.lng=Number.parseFloat(t.getAttributeNS(null,"lon"));const o=t.childNodes;for(let t=0;t<o.length;t++)if("name"===o[t].nodeName)e.name=o[t].textContent;this.#pi.wayPoints.add(e),this.#tu&&this.#lu(e)}#cu(t){for(let e=0;e<t.length;e++)this.#hu(t[e])}#du(){this.#Rt.routes.forEach(t=>{t.wayPoints.remove(t.wayPoints.first.objId),t.wayPoints.remove(t.wayPoints.last.objId);const e=new A;e.latLng=t.itinerary.itineraryPoints.first.latLng,t.wayPoints.add(e);const o=new A;o.latLng=t.itinerary.itineraryPoints.last.latLng,t.wayPoints.add(o)})}#Kc(t){const e=t.itinerary.itineraryPoints.iterator,i=t.itinerary.maneuvers.iterator;e.done;let n=i.done;for(n||(i.value.distance=o.defaultValue,n=i.done),t.distance=o.defaultValue,t.duration=o.defaultValue;!e.done;)e.previous.distance=Fn.pointsDistance(e.previous.latLng,e.value.latLng),t.distance+=e.previous.distance,n||(i.previous.distance+=e.previous.distance,i.value.itineraryPointObjId===e.value.objId&&(t.duration+=i.previous.duration,i.value.distance=o.defaultValue,i.next&&i.value.itineraryPointObjId===i.next.itineraryPointObjId&&(n=i.done,i.value.distance=o.defaultValue),n=i.done))}constructor(){Object.freeze(this)}parse(t){this.#Qd=(new DOMParser).parseFromString(t,"text/xml"),this.#tu=Boolean(this.#Qd.querySelector("gpx").getAttributeNS(null,"creator").match(/fietsnet|knooppuntnet/g)),this.#Rt=new Z,this.#Rt.routes.remove(this.#Rt.routes.first.objId);const e=this.#Qd.querySelectorAll("trk");for(let t=0;t<e.length;t++)this.#nu(e[t]);const o=this.#Qd.querySelectorAll("rte");1===o.length&&1===this.#Rt.routes.length&&this.#au(o[0]),this.#Rt.routes.forEach(t=>this.#Kc(t));const i=this.#Qd.querySelectorAll("wpt");return 0<i.length&&1===this.#Rt.routes.length?(this.#pi.wayPoints.remove(this.#pi.wayPoints.first.objId),this.#pi.wayPoints.remove(this.#pi.wayPoints.last.objId),this.#cu(i)):this.#du(),this.#Rt}}class Ua{#uu(){Bn.dispatch("removeallobjects"),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name);const t=U.travel.routes.iterator;for(;!t.done;)l.notEdited===t.value.editionStatus&&Bn.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:t.value.objId});g!==U.editedRouteObjId&&Bn.dispatch("routeupdated",{removedRouteObjId:g,addedRouteObjId:U.travel.editedRoute.objId});const e=U.travel.notes.iterator;for(;!e.done;)Bn.dispatch("noteupdated",{removedNoteObjId:g,addedNoteObjId:e.value.objId});if(Bn.dispatch("updatetravelnotes"),(new ur).zoomToTravel(),Br.setMapLayer(U.travel.layerName),g!==U.editedRouteObjId){const t=U.travel.editedRoute.itinerary.provider;if(""===t||U.providers.get(t.toLowerCase())){Bn.dispatch("setprovider",{provider:t});const e=U.travel.editedRoute.itinerary.transitMode;""!==e&&Bn.dispatch("settransitmode",{transitMode:e})}else Rn.showError(S.getText("FileLoader - Not possible to select as provider",{provider:t}))}jr.chainRoutes(),Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook")}constructor(){Object.freeze(this)}openLocalGpxFile(t){Lr.deleteAllProfiles(),U.travel.jsonObject=(new Ka).parse(t).jsonObject,U.editedRouteObjId=g,this.#uu(),Gr.saveStatus=h.saved}openLocalTrvFile(t){Lr.deleteAllProfiles();const e=JSON.parse(t);(new Ar).decompress(e),U.travel.jsonObject=e,U.editedRouteObjId=g,U.travel.routes.forEach(t=>{l.notEdited!==t.editionStatus&&(U.editedRouteObjId=t.objId)}),this.#uu(),Gr.saveStatus=h.saved}#mu(t){const e=t.routes.iterator;for(;!e.done;)U.travel.routes.add(e.value);const o=t.notes.iterator;for(;!o.done;)U.travel.notes.add(o.value);this.#uu(),Gr.saveStatus=h.modified}mergeLocalGpxFile(t){this.#mu((new Ka).parse(t))}mergeLocalTrvFile(t){const e=JSON.parse(t);(new Ar).decompress(e);const o=new Z;o.jsonObject=e,this.#mu(o)}}class Va{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation();const o=e.target.files[0].name,i=o.split(".").pop().toLowerCase(),n=new FileReader;n.onload=()=>{try{f!==t.files.openTaN.indexOf(i)?(new Ua).openLocalTrvFile(n.result):f!==t.files.openGpx.indexOf(i)&&(new Ua).openLocalGpxFile(n.result)}catch(t){t instanceof Error&&(console.error(t),Rn.showError("An error occurs when reading the file "+o))}},n.readAsText(e.target.files[0])}}class Wa{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation();const o=e.target.files[0].name,i=o.split(".").pop().toLowerCase(),n=new FileReader;n.onload=()=>{try{f!==t.files.openTaN.indexOf(i)?(new Ua).mergeLocalTrvFile(n.result):f!==t.files.openGpx.indexOf(i)&&(new Ua).mergeLocalGpxFile(n.result)}catch(t){t instanceof Error&&(console.error(t),Rn.showError("An error occurs when reading the file "+o))}},n.readAsText(e.target.files[0])}}const Xa=new class extends Vr{constructor(){super()}createUI(){super.createUI("Travel & Notes",c.topRight)}addToolbarItems(){const e=pn.isTouch?t.files.writeTouch:t.files.writeOthers,o=Object.seal({openTaN:"",openGpx:""});t.files.openTaN.forEach(t=>o.openTaN+="."+t+","),t.files.openGpx.forEach(t=>o.openGpx+="."+t+",");const i=(o.openTaN+o.openGpx).slice(0,-1);o.openTaN=o.openTaN.slice(0,-1),o.openGpx=o.openGpx.slice(0,-1),o.openTaN.replaceAll(",",", "),o.openGpx.replaceAll(",",", "),this.addToolbarItem(Jr.status===n.active?new Wr("ðŸ€",S.getText("TravelNotesToolbar - Stop Geo location"),()=>{Jr.switch()}):new Wr("ðŸŒ",S.getText("TravelNotesToolbar - Start Geo location"),()=>{Jr.switch()})),this.addToolbarItem(new Wr("âŒ",S.getText("TravelNotesToolbar - Cancel travel"),()=>{ta.newTravel(),document.title="Travel & Notes"+(""===U.travel.name?"":" - "+U.travel.name)})),this.addToolbarItem(new Wr("ðŸ’¾",S.getText("TravelNotesToolbar - Save travel",{extension:e}),()=>{ta.saveTravel()})),this.addToolbarItem(new Wr("ðŸ“‚",S.getText("TravelNotesToolbar - Open travel",o),()=>{t.travelNotes.haveBeforeUnloadWarning&&!window.confirm(S.getText("TravelNotesToolbar - This page ask to close; data are perhaps not saved."))||D.openFile(new Va,i)})),this.addToolbarItem(new Wr("ðŸŒ",S.getText("TravelNotesToolbar - Import travel",o),()=>{g===U.editedRouteObjId?D.openFile(new Wa,i):Rn.showError(S.getText("TravelNotesToolbar - Not possible to merge a travel when a route is edited"))})),this.addToolbarItem(new Wr("ðŸ“™",S.getText("TravelNotesToolbar - Open travel roadbook"),"TravelNotesRoadbook.html?lng="+t.travelNotes.language+"&page="+U.UUID)),t.ApiKeysDialog.showButton&&this.addToolbarItem(new Wr("ðŸ”‘",S.getText("TravelNotesToolbar - api keys"),()=>{zn.setKeysFromDialog()})),this.addToolbarItem(new Wr("ðŸ›„",S.getText("TravelNotesToolbar - Travel properties"),()=>{za.travelPropertiesDialog.show()})),this.addToolbarItem(new Wr("ðŸ—¨ï¸",S.getText("TravelNotesToolbar - Travel notes"),()=>{za.travelNotesDialog.show()})),this.addToolbarItem(new Wr("ðŸ”",S.getText("Search with OpenStreetMap"),()=>{za.osmSearchDialog.show()})),this.addToolbarItem(new Wr("â˜¢ï¸",S.getText("TravelNotesToolbar - Save as travel",{extension:e}),()=>{ta.saveAsTravel()})),this.addToolbarItem(new Wr("ðŸ› ï¸",S.getText("TravelNotesToolbar - About Travel & Notes"),()=>(new qr).show())),document.fullscreenEnabled&&this.addToolbarItem(document.fullscreenElement?new Wr("ðŸ”»",S.getText("TravelNotesToolbar - disable fullscreen"),()=>Fa.toggle()):new Wr("ðŸ”º",S.getText("TravelNotesToolbar - enable fullscreen"),()=>Fa.toggle())),this.addToolbarItem(new Wr("+",S.getText("TravelNotesToolbar - Increment the font size"),()=>{Za.increment()})),this.addToolbarItem(new Wr("-",S.getText("TravelNotesToolbar - Decrement the font size"),()=>{Za.decrement()})),this.addToolbarItem(new Wr("ðŸ ","Home",window.location.origin)),this.addToolbarItem(new Wr("?","Help","https://wwwouaiebe.github.io/TravelNotes/userGuides/README.html#")),this.addToolbarItem(new Wr("@","Contact",t.travelNotesToolbar.contactMail.url||window.location.origin))}};class Ya{#pu;#at;#gu;static get#vu(){return Object.freeze({bike:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <path fill="rgb(0,0,191)" d="m 11.25,3.125 v 1.09375 l 1.5625,0.9765625 V 6.5625 H 7.4999999 V 5.625 h 0.625 c 1.25,0 1.25,-1.25 0,-1.25 h -2.5 c -1.25,0 -1.25,1.25 0,1.25 h 0.625 V 6.5625 L 5.0781249,8.75 c -0.026125,-5.821e-4 -0.0519,0 -0.078125,0 -2.0153538,0 -3.75,1.734646 -3.75,3.75 0,2.015354 1.7346462,3.75 3.75,3.75 2.0153537,0 3.75,-1.734646 3.75,-3.75 0,-0.432461 -0.089462,-0.858226 -0.234375,-1.25 h 0.546875 c 0.9375,0 1.1534331,-0.567495 1.4843751,-0.898437 L 12.773438,7.8125 13.4375,9.1015625 C 12.159328,9.7073948 11.25,11.031094 11.25,12.5 c 0,2.015354 1.734646,3.75 3.75,3.75 2.015354,0 3.75,-1.734646 3.75,-3.75 0,-2.015354 -1.734646,-3.75 -3.75,-3.75 -0.03934,0 -0.07808,-0.00131 -0.117187,0 L 13.75,6.5625 V 4.5703125 Z M 7.2265624,7.8125 H 11.132813 L 9.1796874,10 h -1.40625 c -0.0231,0 -0.054487,0.0026 -0.078125,0 C 7.3660586,9.6463159 6.9994024,9.3504739 6.5624999,9.140625 6.5471874,9.1173375 6.5373874,9.0856825 6.5234374,9.0625 Z M 4.9999999,10 c 1.2571387,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.2428613,2.5 -2.5,2.5 -1.2571388,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.2428612,-2.5 2.5,-2.5 z M 15,10 c 1.257137,0 2.5,1.242862 2.5,2.5 0,1.257139 -1.242863,2.5 -2.5,2.5 -1.257139,0 -2.5,-1.242861 -2.5,-2.5 0,-1.257138 1.242861,-2.5 2.5,-2.5 z" /> </svg>',pedestrian:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20"  xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)" transform="matrix(0.15866777,0,0,0.12627988,148.47251,-116.69398)"> <path d="m -875.5,962.4 c 2,-1.5 4.6,-2.3 7.4,-2.2 3.6,0.3 6.7,2.5 8.4,5.2 l 10.7,21.2 14.5,10.1 c 1.2,1 2,2.5 1.9,4.2 -0.1,2.6 -2.5,4.6 -5.2,4.3 -0.7,0 -1.5,-0.3 -2.2,-0.7 l -15.6,-10.7 c -0.4,-0.4 -0.9,-0.9 -1.2,-1.5 l -4.1,-7.9 -4.8,21.1 18.9,22.3 c 0.4,0.7 0.7,1.5 0.9,2.2 l 5.1,26.9 c 0,0.6 0,1 0,1.5 -0.3,4.1 -3.8,6.8 -7.7,6.7 -3.2,-0.3 -5.7,-2.6 -6.5,-5.7 l -4.8,-25.1 -15.3,-17 -3.6,16.3 c -0.1,0.7 -1.2,2.3 -1.5,2.9 l -14.6,24.9 c -1.5,2.2 -3.9,3.8 -6.7,3.4 -4.1,-0.3 -7,-3.8 -6.7,-7.7 0.1,-1.2 0.6,-2.2 1,-3.1 l 13.7,-22.8 11.4,-50.4 -7.4,6 -4.1,18 c -0.4,2.2 -2.6,4.2 -5.1,4.1 -2.6,-0.1 -4.6,-2.5 -4.5,-5.2 0,-0.1 0,-0.4 0.1,-0.6 l 4.6,-20.9 c 0.3,-0.9 0.7,-1.6 1.5,-2.2 z" /> <path d="m -884.5,943.5 c 1.3,8.6 8.7,15.3 17.8,15.3 5.7,0 10.2,-4.6 10.2,-10.2 0,-5.6 -4.6,-10.2 -10.2,-10.2 -3.9,0 -7.2,2 -8.9,5.2 -0.2,0.4 -0.5,0.7 -0.8,1 -2,2 -5.3,2 -7.3,0 -0.4,-0.4 -0.6,-0.7 -0.8,-1.1 z" /> </g> </svg>',car:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" > <g fill="rgb(0,0,191)"> <path d="m 2,13 a 1.7142857,1.7142857 0 0 0 1.7142857,1.714286 H 16.285714 A 1.7142857,1.7142857 0 0 0 18,13 V 9.5714286 A 1.7142857,1.7142857 0 0 0 16.285714,7.8571429 H 3.7142857 A 1.7142857,1.7142857 0 0 0 2,9.5714286 Z m 1.8285714,-2.285714 a 1.0285714,1.0285714 0 1 1 0,0.01143 z m 10.2857146,0 a 1.0285714,1.0285714 0 1 1 0,0.01143 z" /> <path d="M 4.2857143,7.8571429 V 5 A 1.7142857,1.7142857 0 0 1 6,3.2857143 h 8 A 1.7142857,1.7142857 0 0 1 15.714286,5 V 7.8571429 H 14 V 6.1428571 A 1.1428571,1.1428571 0 0 0 12.857143,5 H 7.1428571 A 1.1428571,1.1428571 0 0 0 6,6.1428571 v 1.7142858 z" /> <g transform="matrix(1.1428571,0,0,1.1428571,2,2.1428571)"> <rect x="1" y="10" width="2" height="3" /> <rect x="11" y="10" width="2" height="3" /> </g> </g> </svg>',train:'data:image/svg+xml;utf8,<svg viewBox="-3 -3 20 20" xmlns="http://www.w3.org/2000/svg"> <g fill="rgb(0,0,191)"> <path d="M 5,0 C 3.025911,-0.0084 1,3 1,7 l 0,2 c 0,1 1,2 2,2 l 8,0 c 1,0 2,-1 2,-2 L 13,7 C 13,3 11,0 9,0 z m -1,3 6,0 c 0,0 1,1 1,3 L 3.03125,6 C 2.994661,3.9916 4,3 4,3 z M 3,8 6,8 6,9 3,9 z m 5,0 3,0 0,1 -3,0 z m -6,4 -1,2 3,0 1,-2 z m 7,0 1,2 3,0 -1,-2 z"/></g></svg>',line:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <line x1="5" y1="17" x2= "11" y2="2" stroke="rgb(0,0,0)" /> <line x1="3" y1="6" x2="17" y2="9" stroke="rgb(191,0,0)" /> <line x1="3" y1= "16" x2="17" y2="5" stroke="rgb(255,204,0)" /> </svg>',circle:'data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" > <g fill="transparent"> <circle cx="8" cy="6" r="5" stroke="rgb(0,0,0)" /> <circle cx="12" cy="12" r="4" stroke="rgb(255,204,0)" /> <circle cx="14" cy="8" r="3" stroke="rgb(191,0,0)" /> </g> </svg>'})}constructor(t,e){Object.freeze(this),this.#pu=t,this.#at=e,this.#gu=W.create("img",{src:Ya.#vu[e],id:"travelnotes-providers-toolbar-"+e+"img-button",className:"travelnotes-providers-toolbar-img-button",title:S.getText("ProvidersToolbar - TransitMode "+e)}),this.#gu.addEventListener("click",this),this.visible=!1}handleEvent(t){t.stopPropagation(),this.#pu.transitMode=this.#at,this.#pu.hide(),ya.startRouting()}get buttonHTMLElement(){return this.#gu}get transitMode(){return this.#at}set active(t){t?this.#gu.classList.add("travelnotes-providers-toolbar-active-transit-mode-img-button"):this.#gu.classList.remove("travelnotes-providers-toolbar-active-transit-mode-img-button")}set visible(t){t?this.#gu.classList.remove("travelnotes-hidden"):this.#gu.classList.add("travelnotes-hidden")}}class Ga{#pu;#rt;#gu;constructor(t,e){Object.freeze(this),this.#pu=t,this.#rt=e,this.#gu=W.create("img",{src:e.icon,id:"travelnotes-providers-toolbar-"+e.name+"img-button",className:"travelnotes-providers-toolbar-img-button",title:e.title||e.name}),this.#gu.addEventListener("click",this)}handleEvent(t){t.stopPropagation(),this.#pu.provider=this.#rt.name,ya.startRouting()}get buttonHTMLElement(){return this.#gu}get provider(){return this.#rt}set active(t){t?this.#gu.classList.add("travelnotes-providers-toolbar-active-provider-img-button"):this.#gu.classList.remove("travelnotes-providers-toolbar-active-provider-img-button")}}class qa{#To;#fu;#vh;#_u;#yu;#bu;#Lu;#Lh;#oc;static get#Tu(){return 100}#Eu(){["bike","pedestrian","car","train","line","circle"].forEach(t=>{const e=new Ya(this,t);this.#_u.set(t,e),this.#vh.appendChild(e.buttonHTMLElement)})}#wu(){U.providers.forEach(t=>{if(!t.providerKeyNeeded||zn.hasKey(t.name)){const e=new Ga(this,t);this.#yu.set(t.name,e),this.#vh.appendChild(e.buttonHTMLElement)}})}#oo(){this.#Lh=!0,setTimeout(()=>this.#Mu(),qa.#Tu)}#Mu(){this.#To.style.top=0,this.#vh.classList.remove("travelnotes-hidden"),this.centerToolbar()}#xu(){pn.isTouch&&(this.#Lh?this.hide():this.#oo())}#Iu(){pn.isTouch||(this.#oc&&(clearTimeout(this.#oc),this.#oc=null),this.#oo())}#Cu(){pn.isTouch||(this.#oc=setTimeout(()=>this.hide(),t.toolbars.timeOut))}hide(){this.#oc&&(clearTimeout(this.#oc),this.#oc=null),this.#vh.classList.add("travelnotes-hidden"),this.centerToolbar(),this.#Lh=!1}constructor(){Object.freeze(this),this.#_u=new Map,this.#yu=new Map}centerToolbar(){this.#fu.textContent=S.getText("ProvidersToolbar - Computed by {provider} for {transitMode}",{provider:U.routing.provider,transitMode:S.getText("ProvidersToolbar - TransitMode "+U.routing.transitMode)}),this.#To.style.left=String((window.visualViewport.width-this.#To.clientWidth)/2)+"px",this.#To.style.top=String(window.visualViewport.height-this.#To.clientHeight-2)+"px"}createUI(){this.#To=W.create("div",{id:"travelnotes-providers-toolbar-container"},document.body),this.#To.addEventListener("mouseenter",t=>this.#Iu(t),!1),this.#To.addEventListener("mouseleave",t=>this.#Cu(t),!1),this.#fu=W.create("div",{className:"travelnotes-providers-toolbar-top-bar",textContent:S.getText("TravelNotes-ProvidersToolbar - Providers")},this.#To),this.#fu.addEventListener("click",t=>this.#xu(t),!1),this.#vh=W.create("div",{className:"travelnotes-providers-toolbar-img-buttons travelnotes-hidden"},this.#To),this.#Eu(),this.#wu(),this.provider=this.#yu.keys().next().value,this.centerToolbar()}set provider(t){U.routing.provider=t,this.#Lu&&(this.#Lu.active=!1),this.#Lu=this.#yu.get(t),this.#Lu.active=!0;const e=U.providers.get(t.toLowerCase());this.#_u.forEach(t=>{t.visible=f!==e.transitModes.indexOf(t.transitMode)}),this.#bu&&f!==e.transitModes.indexOf(this.#bu.transitMode)||(this.#bu=null,this.#_u.forEach(t=>{this.#bu||f===e.transitModes.indexOf(t.transitMode)?t.active=!1:(this.#bu=t,t.active=!0,U.routing.transitMode=t.transitMode)})),this.centerToolbar()}set transitMode(t){U.routing.transitMode=t,this.#bu&&(this.#bu.active=!1),this.#bu=this.#_u.get(t),this.#bu.active=!0,this.centerToolbar()}providersAdded(){for(;this.#vh.firstChild;)this.#vh.removeChild(this.#vh.firstChild);this.#_u.clear(),this.#yu.clear(),this.#Eu(),this.#wu(),this.provider=this.#yu.keys().next().value;const t=this.#yu.keys().next().value;this.provider=t,this.transitMode=U.providers.get(t.toLowerCase()).transitModes[0],this.centerToolbar()}}const Ja=new qa;class $a extends Is{constructor(t,e){super(t,e)}get menuItems(){return[new Cs(S.getText("MapContextMenu - Select this point as start point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.first.lat,()=>ba.setStartPoint(this.latLng)),new Cs(S.getText("MapContextMenu - Select this point as way point"),g!==U.editedRouteObjId,()=>ba.addWayPoint(this.latLng)),new Cs(S.getText("MapContextMenu - Select this point as end point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.last.lat,()=>ba.setEndPoint(this.latLng)),new Cs(S.getText("MapContextMenu - Select this point as start and end point"),g!==U.editedRouteObjId&&a.defaultValue===U.travel.editedRoute.wayPoints.first.lat&&a.defaultValue===U.travel.editedRoute.wayPoints.last.lat,()=>ba.setStartAndEndPoint(this.latLng)),new Cs(S.getText("MapContextMenu - Add a route"),!0,()=>jr.addRoute()),new Cs(S.getText("MapContextMenu - Hide all routes"),!0,()=>jr.hideRoutes()),new Cs(S.getText("MapContextMenu - Show all routes"),!0,()=>jr.showRoutes()),new Cs(S.getText("MapContextMenu - New travel note"),!0,()=>mr.newTravelNote(this.latLng)),new Cs(S.getText("MapContextMenu - Hide all notes"),!0,()=>mr.hideNotes()),new Cs(S.getText("MapContextMenu - Show all notes"),!0,()=>mr.showNotes()),new Cs(S.getText("MapContextMenu - Zoom to travel"),!0,()=>(new ur).zoomToTravel()),new Cs("What the fuck?",!0,()=>{const t=document.createElement("a");t.href="https://www.openstreetmap.org/query?lat="+this.latLng[0].toFixed(a.fixed)+"&lon="+this.latLng[1].toFixed(a.fixed)+"#map="+U.map.getZoom()+"/"+this.latLng[0].toFixed(a.fixed)+"/"+this.latLng[1].toFixed(a.fixed),t.target="_blank",t.click()})]}}class Qa{static handleEvent(){Oo.off(Sr.marker,"mouseout",Dr.handleEvent)}}class tl{static handleEvent(t){t.latlng.lat=Sr.initialLatLng[0],t.latlng.lng=Sr.initialLatLng[1],t.target.objId=U.travel.editedRoute.objId,new ka(t).show()}}class el{static handleEvent(t){U.mapObjects.get(U.travel.editedRoute.objId).openPopup(t.latlng)}}class ol{static handleEvent(t){ba.addWayPointOnRoute(Sr.initialLatLng,[t.target.getLatLng().lat,t.target.getLatLng().lng]),Sr.marker&&(Oo.off(Sr.marker,"dragstart",Qa.handleEvent),Oo.off(Sr.marker,"dragend",ol.handleEvent),Oo.off(Sr.marker,"contextmenu",tl.handleEvent),U.map.removeLayer(Sr.marker),Sr.marker=null)}}class il{static#Pu=1;static handleEvent(e){const o=Un.getRoute(e.target.objId);if(Sr.initialLatLng=[e.latlng.lat,e.latlng.lng],Sr.marker)Sr.marker.setLatLng(e.latlng);else{Sr.marker=new pi(e.latlng,{icon:new ji({iconSize:[y,y],iconAnchor:[10,y],html:'<div class="travelnotes-map-way-point travelnotes-map-way-point-tmp"></div><div class="travelnotes-map-way-point-text">?</div>',className:"travelnotes-map-way-point-style"}),draggable:!0});let i="";(f===t.route.showDragTooltip||il.#Pu<=t.route.showDragTooltip)&&(il.#Pu++,i=S.getText("EditedRouteMouseOverEL - Drag and drop to add a waypoint")+" - "),i+=o.computedName+" - ";let n=rn.getClosestLatLngDistance(o,[e.latlng.lat,e.latlng.lng]).distance;n+=o.chainedDistance,i+=D.formatDistance(n),Sr.marker.bindTooltip(i),Sr.marker.getTooltip().options.offset=[0,0],Sr.marker.addTo(U.map),Oo.on(Sr.marker,"mouseout",Dr.handleEvent),Oo.on(Sr.marker,"dragstart",Qa.handleEvent),Oo.on(Sr.marker,"dragend",ol.handleEvent),Oo.on(Sr.marker,"contextmenu",tl.handleEvent),Oo.on(Sr.marker,"click",el.handleEvent)}}}class nl{static createFakeEvent(e){const o=Un.getNearestRouteData([e.latlng.lat,e.latlng.lng]);if(!o.route)return;const i=new St(o.latLngOnRoute[0],o.latLngOnRoute[1]),n=U.map.latLngToContainerPoint(i);return n.distanceTo(e.containerPoint)>(pn.isTouch?t.mapContextMenu.touchMaxRouteDistance:t.mapContextMenu.mouseMaxRouteDistance)?void 0:Object.freeze({clientX:n.x,clientY:n.y,latlng:i,target:o.route})}static handleClickEvent(t){const e=nl.createFakeEvent(t);e&&pn.isTouch&&e.target.editionStatus!==l.notEdited&&il.handleEvent(e)}static handleContextMenuEvent(t){const e=nl.createFakeEvent(t);e?new ka(e).show():new $a(t).show()}}const sl=new class{#Ou=!1;constructor(){Object.freeze(this)}async addReadOnlyTravel(t){if(this.#Ou)return;this.#Ou=!0,Hr.createUI(),Br.setMapLayer("OSM - Color");const e=await fetch(t);p===e.status&&e.ok?(new Rr).openDistantFile(await e.json()):(U.map.setView([a.defaultValue,a.defaultValue],2),document.title="Travel & Notes")}addToolbarsMenusUIs(e,o){this.#Ou||(this.#Ou=!0,document.title="Travel & Notes",U.map.on("contextmenu",nl.handleContextMenuEvent),U.map.on("click",nl.handleClickEvent),U.map.setView([t.map.center.lat,t.map.center.lng],t.map.zoom),Hr.createUI(),Gr.createUI(),Gr.saveStatus=h.saved,Rn.showHelp("<p>"+S.getText("Help - Continue with interface1")+"</p><p>"+S.getText("Help - Continue with interface2")+"</p>"),Xr.createUI(),Br.setMapLayer("OSM - Color"),Xa.createUI(),Ja.createUI(),zn.setKeysFromServerFile(),U.travel.jsonObject=(new Z).jsonObject,t.travelNotes.startupRouteEdition&&jr.editRoute(U.travel.routes.first.objId),Bn.dispatch("updatetravelproperties"),Bn.dispatch("updateroadbook"),Fa.show(),e&&o&&mr.newUrlNote([e,o]))}addProvider(t){zn.addProvider(t)}showInfo(t){Rn.showInfo(t)}get overpassApiUrl(){return t.overpassApi.url}get map(){return U.map}get version(){return E}};class rl{#Nu(t,e){if("object"==typeof t&&"object"==typeof e){for(const o in e)"object"==typeof e[o]?this.#Nu(t[o],e[o]):typeof t[o]==typeof e[o]&&("string"==typeof e[o]?e[o]="color"===o?N.sanitizeToColor(t[o])||e[o]:"url"===o?N.sanitizeToUrl(t[o]).url:N.sanitizeToJsString(t[o]):e[o]=t[o]||e[o]);for(const o in t)"object"==typeof t[o]?("[object Array]"===Object.prototype.toString.call(t[o])?e[o]=e[o]||[]:e[o]=e[o]||{},this.#Nu(t[o],e[o])):"string"==typeof e.property?e[o]=N.sanitizeToHtmlString(t[o],[]).htmlString:e[o]=t[o]}}#Su(t){for(const e in t)"object"==typeof t[e]&&this.#Su(t[e]);Object.freeze(t)}constructor(){Object.freeze(this)}overload(e){this.#Nu(e,t),this.#Su(t)}}const al=new class{#Du(t,e){const i=W.create("div"),n=W.create("div",{className:t+"route-maneuvers-and-notes-icon-cell"},i);W.create("div",{className:"travelnotes-maneuver-note travelnotes-maneuver-note-"+e.maneuver.iconName},n),n.dataset.tanWidth=String(s.width)+"px",n.dataset.tanHeight=String(s.height)+"px";const r=W.create("div",{className:t+"route-maneuvers-and-notes-cell"},i);return W.create("div",{className:t+"maneuver-tooltip-content",textContent:S.getText("RouteHTMLViewsFactory - "+e.maneuver.iconName)},r),N.sanitizeToHtmlElement(e.maneuver.instruction,W.create("div",{className:t+"route-maneuver-instruction"},r)),e.route.chain&&N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Distance from start of travel")+"</span>Â :Â "+D.formatDistance(e.route.chainedDistance+e.maneuverDistance),W.create("div",{className:t+"route-maneuver-travel-distance"},r)),N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Distance from start of route")+"</span>Â :Â "+D.formatDistance(e.maneuverDistance),W.create("div",{className:t+"route-maneuver-route-distance"},r)),o.defaultValue<e.maneuver.distance&&N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Next maneuver after")+"</span>Â :Â "+D.formatDistance(e.maneuver.distance),W.create("div",{className:t+"route-maneuver-next-distance"},r)),i}constructor(){Object.freeze(this)}getRouteProfileHTML(t,e){const o=W.create("div",{className:t+"route-profile"});return N.sanitizeToHtmlElement(S.getText("RouteHTMLViewsFactory - Profile"),o),o.appendChild((new fs).createSvg(e)),o}getRouteManeuversAndNotesHTML(t,e,o){const i=[],n=e.notes.iterator;for(;!n.done;)i.push({data:n.value,distance:n.value.distance});const s=e.itinerary.maneuvers.iterator;let r=0;for(;!s.done;)i.push({data:s.value,distance:r}),r+=s.value.distance;i.sort((t,e)=>t.distance-e.distance);const a=W.create("div",{className:t+"route-maneuvers-and-notes"});return i.forEach(i=>{let n=null;"Note"===i.data.objType.name?(n=Vs.getNoteTextAndIconHTML(t,{note:i.data,route:e}),n.className=t+"route-notes-row"):(n=this.#Du(t,{route:e,maneuver:i.data,maneuverDistance:i.distance}),n.className=t+"route-maneuvers-row"),o&&(n.dataset.tanObjId=i.data.objId,n.dataset.tanMarkerObjId=b.nextObjId,n.dataset.tanObjType=i.data.objType.name),a.appendChild(n)}),a}getRouteHeaderHTML(t,e){const o=W.create("div",{className:t+"route-header",id:"route"+e.objId});return N.sanitizeToHtmlElement(e.computedName,W.create("div",{className:t+"route-header-name"},o)),0!==e.distance&&N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Route distance")+"</span>Â :Â "+D.formatDistance(e.distance),W.create("div",{className:t+"route-header-distance"},o)),U.travel.readOnly||"bike"===e.itinerary.transitMode||N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Duration")+"</span>Â :Â "+D.formatTime(e.duration),W.create("div",{className:t+"route-header-duration"},o)),e.itinerary.hasProfile&&(N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Ascent")+"</span>Â :Â "+String(e.itinerary.ascent.toFixed(0))+" m.",W.create("div",{className:t+"route-header-ascent"},o)),N.sanitizeToHtmlElement("<span>"+S.getText("RouteHTMLViewsFactory - Descent")+"</span>Â :Â "+String(e.itinerary.descent.toFixed(0))+" m.",W.create("div",{className:t+"route-header-descent"},o))),o}getRouteFooterHTML(t,e){let o=""!==e.itinerary.provider&&""!==e.itinerary.transitMode?S.getText("RouteHTMLViewsFactory - Itinerary computed by {provider} and optimized for {transitMode}",{provider:e.itinerary.provider,transitMode:S.getText("RouteHTMLViewsFactory - TransitMode "+e.itinerary.transitMode)}):"";const i=W.create("div",{className:t+"route-footer"});return N.sanitizeToHtmlElement(o,i),i}};class ll{static handleEvent(t){const e=Un.getRoute(t.target.objId);let o=rn.getClosestLatLngDistance(e,[t.latlng.lat,t.latlng.lng]).distance;o+=e.chainedDistance,o=D.formatDistance(o);const i=U.mapObjects.get(t.target.objId);i.closeTooltip();let n=e.computedName;U.travel.readOnly||(n+=0===n.length?"":" - ",n+=o),i.setTooltipContent(n),i.openTooltip(t.latlng)}}class hl{#Ra;#ju;#ku;constructor(t,e,o){Object.freeze(this),this.#Ra=t,this.#ju=e,this.#ku=o}get marker(){return this.#Ra}get polyline(){return this.#ju}get bullet(){return this.#ku}}class cl{#Au;#Ru;static get#Hu(){return 18}static get#Bu(){return 0}static get#zu(){return 100}constructor(){Object.freeze(this),this.#Au=null,this.#Ru=null}addToMap(t,e){e.objId=t,e.addTo(U.map),U.mapObjects.set(t,e)}addRoute(t){const e=Un.getRoute(t),o=[],i=e.itinerary.itineraryPoints.iterator;for(;!i.done;)o.push(i.value.latLng);const n=new _i(o,{color:e.color,weight:e.width,dashArray:e.dashString});this.addToMap(e.objId,n),pn.isTouch||(n.bindPopup(t=>N.clone(al.getRouteHeaderHTML("travelnotes-map-",Un.getRoute(t.objId)))),Oo.on(n,"click",t=>t.target.openPopup(t.latlng))),l.notEdited===e.editionStatus&&(n.bindTooltip(e.computedName,{sticky:!0,direction:"right"}),pn.isTouch||(Oo.on(n,"mouseover",ll.handleEvent),Oo.on(n,"mousemove",ll.handleEvent)));const s=e.notes.iterator;for(;!s.done;)this.addNote(s.value.objId);return e}addNote(e){const o=Un.getNoteAndRoute(e).note,i=new pi(o.latLng,{icon:new ji({iconSize:[t.note.grip.size,t.note.grip.size],iconAnchor:[t.note.grip.size/2,t.note.grip.size/2],html:"<div></div>",className:"travelnotes-map-note-bullet"}),opacity:t.note.grip.opacity,draggable:!U.travel.readOnly});i.objId=o.objId;const n=new pi(o.iconLatLng,{zIndexOffset:cl.#zu,icon:new ji({iconSize:[o.iconWidth,o.iconHeight],iconAnchor:[o.iconWidth/2,o.iconHeight/2],popupAnchor:[0,-o.iconHeight/2],html:o.iconContent,className:"travelnotes-map-all-notes"}),draggable:!U.travel.readOnly});n.objId=o.objId,n.bindPopup(t=>N.clone(Vs.getNoteTextHTML("travelnotes-map-",Un.getNoteAndRoute(t.objId)))),0!==o.tooltipContent.length&&(n.bindTooltip(t=>Un.getNoteAndRoute(t.objId).note.tooltipContent),n.getTooltip().options.offset[0]=o.iconWidth/2);const s=new _i([o.latLng,o.iconLatLng],t.note.polyline);s.objId=o.objId;const r=new hi([n,s,i]);return r.markerId=Lt.stamp(n),r.polylineId=Lt.stamp(s),r.bulletId=Lt.stamp(i),this.addToMap(o.objId,r),t.note.haveBackground&&document.querySelectorAll(".travenNotes-map-note,.travelnotes-svg-icon").forEach(t=>t.classList.add("travelnotes-map-note-background")),new hl(n,s,i)}zoomTo(e,o){if(o){let t=[];o.forEach(e=>t=t.concat(e)),U.map.fitBounds(rn.getLatLngBounds(t))}else U.map.setView(e,t.itineraryPoint.zoomFactor)}setLayer(t,e){const o="wmts"===t.service.toLowerCase()?new Ai(e):new Ai.WMS(e,t.wmsOptions);this.#Au&&U.map.removeLayer(this.#Au),U.map.addLayer(o),this.#Au=o,U.travel.readOnly||(U.map.getZoom()<(t.minZoom||cl.#Bu)&&U.map.setZoom(t.minZoom||cl.#Bu),U.map.setMinZoom(t.minZoom||cl.#Bu),U.map.getZoom()>(t.maxZoom||cl.#Hu)&&U.map.setZoom(t.maxZoom||cl.#Hu),U.map.setMaxZoom(t.maxZoom||cl.#Hu),t.bounds?(U.map.getBounds().intersects(t.bounds)&&!U.map.getBounds().contains(t.bounds)||(U.map.setMaxBounds(null),U.map.fitBounds(t.bounds),U.map.setZoom(t.minZoom||cl.#Bu)),U.map.setMaxBounds(t.bounds)):U.map.setMaxBounds(null)),U.map.fire("baselayerchange",o)}onGeolocationStatusChanged(t){n.active!==t&&this.#Ru&&(U.map.removeLayer(this.#Ru),this.#Ru=null)}#Fu(t){const e=S.getText("MapEditorViewer -Copied to clipboard"),o=t.target.getTooltip().getContent();f===o.indexOf(e)&&navigator.clipboard.writeText(o.replaceAll("<br/>","\n")).then(()=>{t.target.getTooltip().setContent(o+"<br/><br/>"+S.getText("MapEditorViewer -Copied to clipboard"))}).catch(()=>console.error("Failed to copy to clipboard "))}onGeolocationPositionChanged(e){let o=t.geoLocation.zoomToPosition;this.#Ru&&(U.map.removeLayer(this.#Ru),o=!1);let i="Position (+/- "+e.coords.accuracy.toFixed(0)+" m) : <br/>"+D.formatLatLngDMS([e.coords.latitude,e.coords.longitude])+"<br/>"+D.formatLatLng([e.coords.latitude,e.coords.longitude])+"<br/>";e.coords.altitude&&(i+="<br/> Altitude  :<br/>"+e.coords.altitude.toFixed(0)+" m",e.coords.altitudeAccuracy&&(i+="(+/- "+e.coords.altitudeAccuracy.toFixed(0)+" m)")),0===t.geoLocation.marker.radius?(this.#Ru=new fi(new St(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#Ru.setRadius(e.coords.accuracy.toFixed(0))):this.#Ru=new vi(new St(e.coords.latitude,e.coords.longitude),t.geoLocation.marker),this.#Ru.bindTooltip(i).addTo(U.map),t.geoLocation.watch||this.#Ru.bindPopup(i).openPopup(),this.#Ru.on("click",t=>{this.#Fu(t)}),o&&U.map.setView(new St(e.coords.latitude,e.coords.longitude),t.geoLocation.zoomFactor)}}class dl{static handleEvent(t){const e=Un.getNoteAndRoute(t.target.objId),o=e.note,i=e.route,n=U.mapObjects.get(t.target.objId);if(null===i)o.latLng=[t.target.getLatLng().lat,t.target.getLatLng().lng],Bn.dispatch("updatetravelnotes");else{const e=rn.getClosestLatLngDistance(i,[t.target.getLatLng().lat,t.target.getLatLng().lng]);o.latLng=e.latLng,o.distance=e.distance,i.notes.sort((t,e)=>t.distance-e.distance),n.getLayer(n.bulletId).setLatLng(e.latLng)}n.getLayer(n.polylineId).setLatLngs([o.latLng,o.iconLatLng]),Bn.dispatch("updateroadbook")}}class ul{static handleEvent(t){const e=Un.getNoteAndRoute(t.target.objId).note,o=U.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([[t.latlng.lat,t.latlng.lng],e.iconLatLng])}}class ml{static handleEvent(e){e.originalEvent.target.style.opacity=t.note.grip.moveOpacity}}class pl{static handleEvent(e){e.originalEvent.target.style.opacity=t.note.grip.opacity}}class gl{static handleEvent(t){new Ha(t).show()}}class vl{static handleEvent(t){const e=Un.getNoteAndRoute(t.target.objId).note;e.iconLatLng=[t.target.getLatLng().lat,t.target.getLatLng().lng];const o=U.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,e.iconLatLng])}}class fl{static handleEvent(t){const e=Un.getNoteAndRoute(t.target.objId).note,o=U.mapObjects.get(t.target.objId);o.getLayer(o.polylineId).setLatLngs([e.latLng,[t.latlng.lat,t.latlng.lng]])}}class _l extends Is{constructor(t,e){super(t,e)}get menuItems(){return[new Cs(S.getText("WayPointContextMenu - Delete this waypoint"),U.travel.editedRoute.wayPoints.first.objId!==this.targetObjId&&U.travel.editedRoute.wayPoints.last.objId!==this.targetObjId,()=>ba.removeWayPoint(this.targetObjId)),new Cs(S.getText("WayPointContextMenu - Modify properties"),!0,()=>ba.wayPointProperties(this.targetObjId))]}}class yl{static handleEvent(t){new _l(t).show()}}class bl{static handleEvent(t){ba.wayPointDragEnd(t)}}class Ll{static handleEvent(t){Oo.stopPropagation(t),new ka(t).show()}}class Tl extends cl{static get#Zu(){return.01}#Ku(t){const e=U.mapObjects.get(t);e&&(Oo.off(e),U.map.removeLayer(e),U.mapObjects.delete(t))}constructor(){super()}updateRoute(t,e){if(g!==t){const e=Un.getRoute(t);this.#Ku(e.objId);const o=e.notes.iterator;for(;!o.done;)this.#Ku(o.value.objId);const i=e.wayPoints.iterator;for(;!i.done;)this.#Ku(i.value.objId)}if(g!==e){const t=this.addRoute(e),o=U.mapObjects.get(e);if(!U.travel.readOnly){Oo.on(o,"contextmenu",Ll.handleEvent),l.notEdited===t.editionStatus||pn.isTouch||Oo.on(o,"mouseover",il.handleEvent);const e=t.notes.iterator;for(;!e.done;){const t=U.mapObjects.get(e.value.objId),o=t.getLayer(t.markerId),i=t.getLayer(t.bulletId);Oo.on(i,"dragend",dl.handleEvent),Oo.on(i,"drag",ul.handleEvent),Oo.on(i,"mouseenter",ml.handleEvent),Oo.on(i,"mouseleave",pl.handleEvent),Oo.on(o,"contextmenu",gl.handleEvent),Oo.on(o,"dragend",vl.handleEvent),Oo.on(o,"drag",fl.handleEvent)}}if(!U.travel.readOnly&&l.notEdited!==t.editionStatus){const t=U.travel.editedRoute.wayPoints.iterator;for(;!t.done;)this.addWayPoint(t.value,t.first?"A":t.last?"B":t.index)}}}updateRouteProperties(t){const e=U.mapObjects.get(t),o=Un.getRoute(t);e.setStyle({color:o.color,weight:o.width,dashArray:o.dashString})}updateNote(t,e){let o=!1;if(g!==t){const e=U.mapObjects.get(t);e&&(o=e.getLayer(e.markerId).isPopupOpen()),this.#Ku(t)}if(g!==e){const t=this.addNote(e);o&&t.marker.openPopup(),U.travel.readOnly||(Oo.on(t.bullet,"dragend",dl.handleEvent),Oo.on(t.bullet,"drag",ul.handleEvent),Oo.on(t.bullet,"mouseenter",ml.handleEvent),Oo.on(t.bullet,"mouseleave",pl.handleEvent),Oo.on(t.marker,"contextmenu",gl.handleEvent),Oo.on(t.marker,"dragend",vl.handleEvent),Oo.on(t.marker,"drag",fl.handleEvent))}}removeObject(t){this.#Ku(t)}removeAllObjects(){U.mapObjects.forEach(t=>{Oo.off(t),U.map.removeLayer(t)}),U.mapObjects.clear()}addWayPoint(t,e){if(a.defaultValue===t.lat&&a.defaultValue===t.lng)return;const o='<div class="travelnotes-map-way-point travelnotes-map-way-point-'+("A"===e?"start":"B"===e?"end":"via")+'"></div><div class="travelnotes-map-way-point-text">'+e+"</div>",i=new pi(t.latLng,{icon:new ji({iconSize:[y,y],iconAnchor:[10,y],html:o,className:"travelnotes-map-way-point-style"}),draggable:!0});i.bindTooltip(t=>Un.getWayPoint(t.objId).fullName),i.getTooltip().options.offset=[10,-10],Oo.on(i,"contextmenu",yl.handleEvent),i.objId=t.objId,this.addToMap(t.objId,i),Oo.on(i,"dragend",bl.handleEvent)}addItineraryPointMarker(e,o){this.addToMap(e,new vi(o,t.itineraryPoint.marker))}addSearchPointMarker(e,o,i){let n=!1;if(i){let t=[];i.forEach(e=>{t=t.concat(e)});const e=rn.getLatLngBounds(t),o=U.map.getBounds();n=(e.getEast()-e.getWest())/(o.getEast()-o.getWest())>Tl.#Zu&&(e.getNorth()-e.getSouth())/(o.getNorth()-o.getSouth())>Tl.#Zu}n?this.addToMap(e,new _i(i,t.osmSearch.searchPointPolyline)):this.addToMap(e,new vi(o,t.osmSearch.searchPointMarker))}addRectangle(t,e,o){this.addToMap(t,new Ui(e,o))}setLayer(t){const e=zn.getUrl(t);e&&super.setLayer(t,e)}}const El=new Tl;class wl{#Uu;#kt;#Vu;static get#Wu(){return 1}#Xu(t,e){if(this.#Uu)return void t();const o=window.indexedDB.open("TravelNotesDb",wl.#Wu);o.onerror=()=>{this.#Uu=null,e(new Error("Not possible to open the db"))},o.onsuccess=e=>{this.#Uu=e.target.result,t()},o.onupgradeneeded=t=>{this.#Uu=t.target.result,this.#Uu.createObjectStore("Travels",{keyPath:"UUID"})}}#Yu(t,e){if(!this.#Uu)return void e(new Error("Database not opened"));const o=this.#Uu.transaction(["Travels"],"readonly");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").get(this.#kt).onsuccess=e=>t(e.target.result?e.target.result.data:null)}#Gu(t,e){if(!this.#Uu)return void e(new Error("Database not opened"));const o=this.#Uu.transaction(["Travels"],"readwrite");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").put({UUID:this.#kt,data:this.#Vu}).onsuccess=()=>t()}#qu(){this.#Uu.close(),this.#Uu=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise((t,e)=>this.#Xu(t,e))}getReadPromise(t){return this.#kt=t,new Promise((t,e)=>this.#Yu(t,e))}getWritePromise(t,e){return this.#kt=t,this.#Vu=e,new Promise((t,e)=>this.#Gu(t,e))}closeDb(t){if(!this.#Uu)return;if(!t)return void this.#qu();const e=this.#Uu.transaction(["Travels"],"readwrite");e.onerror=()=>{};const o=e.objectStore("Travels").delete(t);o.onerror=()=>this.#qu(),o.onsuccess=()=>this.#qu()}}const Ml=new wl;const xl=new class{#Ju(e){const i=W.create("div",{className:e+"travel-header"});N.sanitizeToHtmlElement(U.travel.name,W.create("div",{className:e+"travel-header-name"},i));let n=o.defaultValue,s=0,r=0;const a=U.travel.routes.iterator;for(;!a.done;){const o=a.value.objId===U.editedRouteObjId&&t.routeEditor.showEditedRouteInRoadbook?U.travel.editedRoute:a.value;N.sanitizeToHtmlElement('<a href="#route'+o.objId+'" >'+o.computedName+"</a>Â :Â "+D.formatDistance(o.distance)+".",W.create("div",{className:e+"travel-header-route-name"},i)),o.chain&&(n+=o.distance,s+=o.itinerary.ascent,r+=o.itinerary.descent)}return N.sanitizeToHtmlElement("<span>"+S.getText("TravelHTMLViewsFactory - Travel distance")+"</span>Â :Â "+D.formatDistance(n),W.create("div",{className:e+"travel-header-travel-distance"},i)),0!==s&&N.sanitizeToHtmlElement("<span>"+S.getText("travelHTMLViewsFactory - Travel ascent")+"</span>Â :Â "+String(s.toFixed(0))+" m.",W.create("div",{className:e+"travel-header-travel-ascent"},i)),0!==r&&N.sanitizeToHtmlElement("<span>"+S.getText("TravelHTMLViewsFactory - Travel descent")+"</span>Â :Â "+String(r.toFixed(0))+" m.",W.create("div",{className:e+"travel-header-travel-descent"},i)),i}#$u(t){const e=S.getText("TravelHTMLViewsFactory - Travel footer")+'<a href="https://github.com/wwwouaiebe/TravelNotes" target="_blank" title="https://github.com/wwwouaiebe/TravelNotes" >Travel & Notes</a>, Â© <a href="https://www.ouaie.be/" target="_blank" title="https://www.ouaie.be/" >wwwouaiebe 2017 '+new Date(Date.now()).getFullYear()+'</a> Â© <a href="https://www.openstreetmap.org/copyright" target="_blank" title="https://www.openstreetmap.org/copyright">'+S.getText("TravelHTMLViewsFactory - OpenStreetMap contributors")+"</a>",o=W.create("div",{className:t+"travel-footer"});return N.sanitizeToHtmlElement(e,o),o}constructor(){Object.freeze(this)}getTravelHTML(e){const o=W.create("div",{className:e+"travel"});o.appendChild(this.#Ju(e)),o.appendChild(Vs.getTravelNotesHTML(e));const i=U.travel.routes.iterator;for(;!i.done;){const n=t.routeEditor.showEditedRouteInRoadbook&&i.value.objId===U.editedRouteObjId?U.travel.editedRoute:i.value;o.appendChild(al.getRouteHeaderHTML(e,n)),n.itinerary.hasProfile&&o.appendChild(al.getRouteProfileHTML(e,n)),o.appendChild(al.getRouteManeuversAndNotesHTML(e,n,!1)),o.appendChild(al.getRouteFooterHTML(e,n))}return o.appendChild(this.#$u(e)),o}};class Il{#Qu;constructor(){Object.freeze(this),this.#Qu=D.storageAvailable("localStorage")}handleEvent(){Gr.saveStatus=h.modified,this.#Qu&&Ml.getOpenPromise().then(()=>{Ml.getWritePromise(U.UUID,xl.getTravelHTML("travelnotes-roadbook-").outerHTML)}).then(()=>localStorage.setItem(U.UUID,Date.now())).catch(t=>{t instanceof Error&&console.error(t)})}}class Cl{#tm=null;#em(){Ja.centerToolbar(),this.#tm=null}constructor(){Object.freeze(this)}handleEvent(){this.#tm&&(clearTimeout(this.#tm),this.#tm=null),this.#tm=setTimeout(()=>this.#em(),t.travelNotes.resizeDelay)}}class Pl{static addEventsListeners(){document.addEventListener("additinerarypointmarker",t=>{t.data&&El.addItineraryPointMarker(t.data.objId,t.data.latLng)}),document.addEventListener("addrectangle",t=>{t.data&&El.addRectangle(t.data.objId,t.data.bounds,t.data.properties)}),document.addEventListener("addsearchpointmarker",t=>{t.data&&El.addSearchPointMarker(t.data.objId,t.data.latLng,t.data.geometry)}),document.addEventListener("addwaypoint",t=>{t.data&&El.addWayPoint(t.data.wayPoint,t.data.letter)}),document.addEventListener("geolocationpositionchanged",t=>{t.data&&El.onGeolocationPositionChanged(t.data.position)}),document.addEventListener("geolocationstatuschanged",t=>{t.data&&El.onGeolocationStatusChanged(t.data.status)}),document.addEventListener("layerchange",t=>{t.data&&El.setLayer(t.data.layer)}),document.addEventListener("noteupdated",t=>{t.data&&El.updateNote(t.data.removedNoteObjId,t.data.addedNoteObjId)}),document.addEventListener("profileclosed",t=>{t.data&&Lr.onProfileClosed(t.data.objId)}),document.addEventListener("providersadded",()=>Ja.providersAdded()),document.addEventListener("removeallobjects",()=>El.removeAllObjects()),document.addEventListener("removeobject",t=>{t.data&&El.removeObject(t.data.objId)}),document.addEventListener("routepropertiesupdated",t=>{t.data&&El.updateRouteProperties(t.data.routeObjId)}),document.addEventListener("routeupdated",t=>{t.data&&El.updateRoute(t.data.removedRouteObjId,t.data.addedRouteObjId)}),document.addEventListener("setprovider",t=>{t?.data?.provider&&(Ja.provider=t.data.provider)}),document.addEventListener("settransitmode",t=>{t?.data?.transitMode&&(Ja.transitMode=t.data.transitMode)}),document.addEventListener("showtravelproperties",()=>za.showTravelProperties()),document.addEventListener("updateosmsearch",()=>za.osmSearchDialog.updateContent()),document.addEventListener("updateprofilename",t=>{t.data&&Lr.updateProfileName(t.data.routeObjId)}),document.addEventListener("updateroadbook",new Il),document.addEventListener("updatetravelnotes",()=>za.travelNotesDialog.updateContent()),document.addEventListener("updatetravelproperties",()=>za.travelPropertiesDialog.updateContent()),document.addEventListener("zoomto",t=>{t.data&&El.zoomTo(t.data.latLng,t.data.geometry)}),window.visualViewport.addEventListener("resize",new Cl)}static addUnloadEventsListeners(){window.addEventListener("unload",()=>localStorage.removeItem(U.UUID)),window.addEventListener("beforeunload",e=>{if(Ml.closeDb(U.UUID),t.travelNotes.haveBeforeUnloadWarning)return e.returnValue="x","x"})}}(new class{#om;#im;#nm;#sm;#rm;#am;#lm(){const t=new URL(window.location);let e=t.searchParams.get("fil");if(e&&0!==e.length)try{if(e=atob(e),e.match(/[^\w-%:./]/))throw new Error("invalid char in the url encoded in the fil parameter");const o=new URL(e,t.protocol+"//"+t.hostname+(""===t.port?"":":"+t.port));if(!(Url=t.protocol&&o.protocol&&t.protocol===o.protocol&&t.hostname&&o.hostname&&t.hostname===o.hostname))throw new Error("The distant file is not on the same site than the app");this.#om=encodeURI(o.href)}catch(t){t instanceof Error&&console.error(t)}const o=t.searchParams.get("lng");o&&o.match(/^[A-Z,a-z]{2}$/)&&(this.#sm=o.toLowerCase());const i=t.searchParams.get("lat");i&&(this.#im=Number.parseFloat(i),Number.isNaN(this.#im)&&(this.#im=null));const n=t.searchParams.get("lon");n&&(this.#nm=Number.parseFloat(n),Number.isNaN(this.#nm)&&(this.#nm=null))}async#hm(){const e=await fetch(this.#rm+"Config.json");if(p===e.status&&e.ok){const o=await e.json();return o.travelNotes.language=this.#sm||o.travelNotes.language,"wwwouaiebe.github.io"===window.location.hostname&&(o.ApiKeysDialog.haveUnsecureButtons=!0,o.errorsUI.showHelp=!0,o.mapLayersToolbar.theDevil.addButton=!1,o.note.maxManeuversNotes=12,o.note.haveBackground=!0,o.noteDialog.theDevil.addButton=!1,o.printRouteMap.maxTiles=10,o.route.showDragTooltip=f),(new rl).overload(o),U.providers.forEach(e=>{e.userLanguage=t.travelNotes.language}),!0}return!1}async#cm(t,e){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(S.setTranslations(await t.value.json()),!0):"fulfilled"===e.status&&p===e.value.status&&e.value.ok?(S.setTranslations(await e.value.json()),this.#am+="Not possible to load the TravelNotes"+this.#sm.toUpperCase()+".json file. English will be used. ",!0):(this.#am+="Not possible to load the translations. ",!1)}async#dm(t,e){if("fulfilled"===t.status&&p===t.value.status&&t.value.ok){const e=await t.value.json();return Ns.loadJson(e),!0}if("fulfilled"===e.status&&p===e.value.status&&e.value.ok){const t=await e.value.json();return Ns.loadJson(t),this.#am+="Not possible to load the TravelNotesNoteDialog"+this.#sm.toUpperCase()+".json file. English will be used. ",!0}return this.#am+="Not possible to load the translations for the note dialog. ",!1}async#um(t,e){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(na.parseDictionary(await t.value.text()),!0):"fulfilled"===e.status&&p===e.value.status&&e.value.ok?(na.parseDictionary(await e.value.text()),this.#am+="Not possible to load the TravelNotesSearchDictionary"+this.#sm.toUpperCase()+".csv file. English will be used. ",!0):(this.#am+="Not possible to load the search dictionary. OSM search will not be available.",!0)}async#mm(t){return"fulfilled"===t.status&&p===t.value.status&&t.value.ok?(Ir.addMapLayers(await t.value.json()),!0):(this.#am+="Not possible to load the TravelNotesLayers.json file. Only the OpenStreetMap background will be available. ",!0)}async#pm(){const t=await Promise.allSettled([fetch(this.#rm+this.#sm.toUpperCase()+".json"),fetch(this.#rm+"EN.json"),fetch(this.#rm+"NoteDialog"+this.#sm.toUpperCase()+".json"),fetch(this.#rm+"NoteDialogEN.json"),fetch(this.#rm+"SearchDictionary"+this.#sm.toUpperCase()+".csv"),fetch(this.#rm+"SearchDictionaryEN.csv"),fetch(this.#rm+"Layers.json")]),e=await this.#cm(t[0],t[1])&&await this.#dm(t[2],t[3])&&await this.#um(t[4],t[5])&&await this.#mm(t[6]);return""!==this.#am&&e?Rn.showError(this.#am):""!==this.#am&&(document.body.textContent=this.#am),e}#gm(){Pl.addEventsListeners(),document.body.style["font-size"]=String(t.fontSize.initialValue)+"mm";const e=document.createElement("div");e.id="travelnotes-map",document.body.appendChild(e),U.map=new So(e.id,{attributionControl:!1,zoomControl:!1}).setView([a.defaultValue,a.defaultValue],0),this.#om?sl.addReadOnlyTravel(this.#om):(Pl.addUnloadEventsListeners(),sl.addToolbarsMenusUIs(this.#im,this.#nm))}constructor(){Object.freeze(this),this.#rm=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes",this.#am=""}async loadApp(){window.TaN=sl,this.#lm(),await this.#hm()?(this.#sm=this.#sm||t.travelNotes.language||"fr",Rn.createUI(),await this.#pm()&&this.#gm()):document.body.textContent="Not possible to load the TravelNotesConfig.json file. "}}).loadApp()}();
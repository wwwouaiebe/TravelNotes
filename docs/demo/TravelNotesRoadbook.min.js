/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 4.1.0
 * Build 00207 - 2022-10-14T14:54:43+0200 
 * Copyright 2017 2022 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";class e{#e=new Map;constructor(){Object.freeze(this),this.#e.set("a",["href","target"]),this.#e.set("div",[]),this.#e.set("del",[]),this.#e.set("em",[]),this.#e.set("figcaption",[]),this.#e.set("figure",[]),this.#e.set("h1",[]),this.#e.set("h2",[]),this.#e.set("h3",[]),this.#e.set("h4",[]),this.#e.set("h5",[]),this.#e.set("h6",[]),this.#e.set("hr",[]),this.#e.set("img",["src","alt","width","height"]),this.#e.set("ins",[]),this.#e.set("li",[]),this.#e.set("mark",[]),this.#e.set("ol",[]),this.#e.set("p",[]),this.#e.set("s",[]),this.#e.set("small",[]),this.#e.set("strong",[]),this.#e.set("span",[]),this.#e.set("sub",[]),this.#e.set("sup",[]),this.#e.set("ul",[]),this.#e.set("svg",["xmlns","viewBox","class"]),this.#e.set("text",["x","y","text-anchor"]),this.#e.set("polyline",["points","class","transform"]),this.#e.set("#text",[])}getValidAttributesNames(e){return this.#e.get(e).concat(["id","class","dir","title"])}getValidNodeName(e){const t=e.toLowerCase();return this.#e.get(t)?t:""}}class t{#t;#s;constructor(e,t){Object.freeze(this),this.#t=e,this.#s=t}get htmlString(){return this.#t}get errorsString(){return this.#s}}class s{#o;#s;constructor(e,t){Object.freeze(this),this.#o=e,this.#s=t}get url(){return this.#o}get errorsString(){return this.#s}}class o{#r="";#i="";static#n=new e;#a(e){return e.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#l(e,t){const s=this.sanitizeToUrl(e,t).url;""===s&&""!==e?this.#i+="\nAn invalid url ("+e+") was removed from a "+t+" attribute":this.#r+=" "+t+'="'+s+'"'}#d(e,t){o.#n.getValidAttributesNames(t).forEach((t=>{e.hasAttributeNS(null,t)&&(this.#r+=" "+t+'="'+this.#a(e.getAttributeNS(null,t))+'"',e.removeAttributeNS(null,t))}))}#h(e,t){e.hasAttribute("target")&&(this.#r+=' rel="noopener noreferrer"'),o.#n.getValidAttributesNames(t).forEach((t=>{e.hasAttribute(t)&&("href"===t||"src"===t?this.#l(e.getAttribute(t),t):this.#r+=" "+t+'="'+this.#a(e.getAttribute(t))+'"',e.removeAttribute(t))}))}#c(e){for(let t=0;t<e.attributes.length;t++)"rel"!==e.attributes[t].name&&(this.#i+="\nAn unsecure attribute "+e.attributes[t].name+'="'+e.attributes[t].value+'" was removed.')}#u(e){const t=e.childNodes;for(let s=0;s<t.length;s++){const t=e.childNodes[s],r=o.#n.getValidNodeName(t.nodeName);""===r?this.#i+="\nAn invalid tag "+t.nodeName+" was removed":"#text"===r?this.#r+=this.#a(t.nodeValue):(this.#r+="<"+r,"svg"===r||"text"===r||"polyline"===r?this.#d(t,r):this.#h(t,r),this.#r+=">",this.#u(t),this.#r+="</"+r+">",t.attributes&&this.#c(t))}}#g(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return o.#n.getValidAttributesNames(t).forEach((t=>{e.hasAttributeNS(null,t)&&(s.setAttributeNS(null,t,e.getAttributeNS(null,t)),e.removeAttributeNS(null,t))})),s}#v(e,t){const s=document.createElement(t);return o.#n.getValidAttributesNames(t).forEach((t=>{if(e.hasAttribute(t))if("href"===t||"src"===t){const o=this.sanitizeToUrl(e.getAttribute(t),t).url;""!==o&&s.setAttribute(t,o)}else s.setAttribute(t,e.getAttribute(t))})),e.hasAttribute("target")&&s.setAttribute("rel","noopener noreferrer"),s}#m(e,t){const s=e.childNodes;for(let r=0;r<s.length;r++){const s=e.childNodes[r],i=o.#n.getValidNodeName(s.nodeName);if("#text"===i)t.appendChild(document.createTextNode(s.nodeValue));else if(""!==i){const e="svg"===i||"text"===i||"polyline"===i?this.#g(s,i):this.#v(s,i);t.appendChild(e),this.#m(s,e)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(e,t){const s=(new DOMParser).parseFromString("<div>"+e+"</div>","text/html"),o=new DocumentFragment;s&&"#document"===s.nodeName?(this.#m(s.body.firstChild,o),t.appendChild(o)):t.textContent=""}clone(e){const t=document.createElement(e.tagName);return this.#m(e,t),t}sanitizeToHtmlString(e){this.#r="",this.#i="";const s=(new DOMParser).parseFromString("<div>"+e.replace("&nbsp;","਀")+"</div>","text/html");return s&&"#document"===s.nodeName?(this.#u(s.body.firstChild),new t(this.#r,this.#i)):new t("","Parsing error")}sanitizeToUrl(e,t){const o=t||"href",r=(new DOMParser).parseFromString("<div>"+e+"</div>","text/html");if(!r||"#document"!==r.nodeName)return new s("","Parsing error");const i=r.body.firstChild;let n="";for(let e=0;e<i.childNodes.length;e++){if("#text"!==i.childNodes[e].nodeName)return new s("","Invalid characters found in the url");n+=i.childNodes[e].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==e)return new s("","Invalid characters found in the url");const a=["https:"];if("http:"!==window.location.protocol&&"href"!==o||a.push("http:"),"href"===o){a.push("mailto:"),a.push("sms:"),a.push("tel:");const e=n.match(/^\u0023\w*/);if(e&&n===e[0])return new s(n,"")}"src"===o&&a.push("data:");let l=null;try{l=new URL(n)}catch(e){return new s("","Invalid url string")}if(-1===a.indexOf(l.protocol))return new s("","Invalid protocol "+l.protocol);if(-1!==["sms:","tel:"].indexOf(l.protocol))return l.pathname.match(/^\+[0-9,*,\u0023]*$/)?new s(n,""):new s("","Invalid sms: or tel: url");try{encodeURIComponent(l.href)}catch(e){return new s("","Invalid character in url")}return new s(n,"")}sanitizeToJsString(e){const t=(new DOMParser).parseFromString("<div>"+e+"</div>","text/html");if(!t||"#document"!==t.nodeName)return"";const s=t.body.firstChild;let o="";for(let e=0;e<s.childNodes.length;e++){if("#text"!==s.childNodes[e].nodeName)return"";o+=s.childNodes[e].nodeValue}return o=o.replaceAll(/</g,"≺").replaceAll(/>/g,"≻").replaceAll(/"/g,"″").replaceAll(/\u0027/g,"′"),o}sanitizeToColor(e){const t=e.match(/^\u0023[0-9,A-F,a-f]{6}$/);return t?t[0]:null}}const r=new o;const i=new class{#N=new Map;constructor(){Object.freeze(this)}setTranslations(e){e.forEach((e=>this.#N.set(e.msgid,r.sanitizeToJsString(e.msgstr))))}getText(e,t){let s=this.#N.get(e);return t&&s&&Object.getOwnPropertyNames(t).forEach((e=>s=s.replace("{"+e+"}",t[e]))),s||e}};class n{#p;#w;#b;static get#f(){return 1}#T(e,t){if(this.#p)return void e();const s=window.indexedDB.open("TravelNotesDb",n.#f);s.onerror=()=>{this.#p=null,t(new Error("Not possible to open the db"))},s.onsuccess=t=>{this.#p=t.target.result,e()},s.onupgradeneeded=e=>{this.#p=e.target.result,this.#p.createObjectStore("Travels",{keyPath:"UUID"})}}#y(e,t){if(!this.#p)return void t(new Error("Database not opened"));const s=this.#p.transaction(["Travels"],"readonly");s.onerror=()=>t(new Error("Transaction error"));s.objectStore("Travels").get(this.#w).onsuccess=t=>e(t.target.result?t.target.result.data:null)}#S(e,t){if(!this.#p)return void t(new Error("Database not opened"));const s=this.#p.transaction(["Travels"],"readwrite");s.onerror=()=>t(new Error("Transaction error"));s.objectStore("Travels").put({UUID:this.#w,data:this.#b}).onsuccess=()=>e()}#E(){this.#p.close(),this.#p=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise(((e,t)=>this.#T(e,t)))}getReadPromise(e){return this.#w=e,new Promise(((e,t)=>this.#y(e,t)))}getWritePromise(e,t){return this.#w=e,this.#b=t,new Promise(((e,t)=>this.#S(e,t)))}closeDb(e){if(!this.#p)return;if(!e)return void this.#E();const t=this.#p.transaction(["Travels"],"readwrite");t.onerror=()=>{};const s=t.objectStore("Travels").delete(e);s.onerror=()=>this.#E(),s.onsuccess=()=>this.#E()}}const a=new n;const l=new class{#M;#A;#R;#x;#D;#I(e,t){document.querySelectorAll(e).forEach((e=>{t?e.classList.remove("TravelNotes-Hidden"):e.classList.add("TravelNotes-Hidden")}))}#L(e){e?(this.#M.classList.add("TravelNotes-SmallNotes"),this.#M.classList.remove("TravelNotes-BigNotes")):(this.#M.classList.add("TravelNotes-BigNotes"),this.#M.classList.remove("TravelNotes-SmallNotes")),document.querySelectorAll(".TravelNotes-Roadbook-Travel-Notes-IconCell, .TravelNotes-Roadbook-Route-ManeuversAndNotes-IconCell").forEach((t=>{t.style.width=e?"6cm":t.dataset.tanWidth,t.style.height=e?"6cm":t.dataset.tanHeight}))}constructor(){Object.freeze(this),this.#M=document.getElementById("TravelNotes"),this.#A=!0,this.#R=!0,this.#x=!1,this.#D=!1}get showTravelNotes(){return this.#A}set showTravelNotes(e){this.#A=e,this.#I(".TravelNotes-Roadbook-Travel-Notes-Row",e)}get showRouteNotes(){return this.#R}set showRouteNotes(e){this.#R=e,this.#I(".TravelNotes-Roadbook-Route-Notes-Row",e)}get showManeuversNotes(){return this.#x}set showManeuversNotes(e){this.#x=e,this.#I(".TravelNotes-Roadbook-Route-Maneuvers-Row",e)}get showSmallNotes(){return this.#D}set showSmallNotes(e){this.#D=e,this.#L(e)}updateNotes(){this.showTravelNotes=this.#A,this.showRouteNotes=this.#R,this.showManeuversNotes=this.#x,this.showSmallNotes=this.#D}updateRoadbook(e){this.#M.innerHTML=e;const t=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name");t&&(document.title=""===t.textContent?"roadbook":t.textContent+" - roadbook"),document.querySelectorAll(".TravelNotes-Roadbook-Travel-Notes-IconCell, .TravelNotes-Roadbook-Route-ManeuversAndNotes-IconCell").forEach((e=>{e.style.width=e.dataset.tanWidth,e.style.height=e.dataset.tanHeight})),this.updateNotes()}};class d{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),l.showManeuversNotes=e.target.checked}}class h{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),l.showRouteNotes=e.target.checked}}class c{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),l.showTravelNotes=e.target.checked}}class u{constructor(){Object.freeze(this)}handleEvent(e){e.stopPropagation(),l.showSmallNotes=e.target.checked}}class g{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class v{constructor(){Object.freeze(this)}handleEvent(){try{const e=document.querySelector(".TravelNotes-Roadbook-Travel-Header-Name").textContent+"-Roadbook.html",t=document.getElementById("TravelNotes-ButtonsDiv"),s=t.removeChild(document.getElementById("TravelNotes-SaveButton")),o=window.URL.createObjectURL(new File(["<!DOCTYPE html>",document.documentElement.outerHTML],e,{type:"text/plain"})),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download",e),r.style.display="none",r.click(),window.URL.revokeObjectURL(o),t.appendChild(s)}catch(e){e instanceof Error&&console.error(e)}}}class m{#w=null;constructor(e){this.#w=e}handleEvent(){a.getReadPromise(this.#w).then((e=>{e?l.updateRoadbook(e):l.updateRoadbook("")})).catch((e=>{e instanceof Error&&console.error(e)}))}}(new class{#w=null;#U="fr";#k=null;#B(){document.getElementById("TravelNotes-Travel-ShowNotes").checked=l.showTravelNotes,document.getElementById("TravelNotes-Routes-ShowNotes").checked=l.showRouteNotes,document.getElementById("TravelNotes-Routes-ShowManeuvers").checked=l.showManeuversNotes,document.getElementById("TravelNotes-Routes-ShowSmallNotes").checked=l.showSmallNotes}#H(){document.getElementById("TravelNotes-Travel-ShowNotes").addEventListener("change",new c),document.getElementById("TravelNotes-Routes-ShowNotes").addEventListener("change",new h),document.getElementById("TravelNotes-Routes-ShowManeuvers").addEventListener("change",new d),document.getElementById("TravelNotes-Routes-ShowSmallNotes").addEventListener("change",new u),document.getElementById("TravelNotes-PrintButton").addEventListener("click",new g)}#C(){this.#k=document.createElement("div"),this.#k.id="TravelNotes-SaveButton",this.#k.textContent="💾",this.#k.className="TravelNotes-RoadbookButton",this.#k.addEventListener("click",new v),document.getElementById("TravelNotes-ButtonsDiv").appendChild(this.#k)}#O(){a.getOpenPromise().then((()=>a.getReadPromise(this.#w))).then((e=>l.updateRoadbook(e))).catch((e=>{e instanceof Error&&console.error(e)})),window.addEventListener("storage",new m(this.#w)),window.addEventListener("unload",(()=>a.closeDb()))}#z(){fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+this.#U.toUpperCase()+".json").then((e=>{200===e.status&&e.ok&&e.json().then((e=>i.setTranslations(e))).then((()=>this.#P())).catch((e=>{e instanceof Error&&console.error(e)}))})).catch()}#P(){document.getElementById("TravelNotes-Travel-ShowNotesLabel").textContent=i.getText("RoadbookLoader - show travel notes"),document.getElementById("TravelNotes-Routes-ShowManeuversLabel").textContent=i.getText("RoadbookLoader - show maneuver"),document.getElementById("TravelNotes-Routes-ShowNotesLabel").textContent=i.getText("RoadbookLoader - show routes notes"),document.getElementById("TravelNotes-Routes-ShowSmallNotesLabel").textContent=i.getText("RoadbookLoader - show small routes notes")}constructor(){Object.freeze(this);let e=new URLSearchParams(document.location.search.substring(1));this.#w=e.get("page"),this.#U=e.get("lng")||"fr"}loadRoadbook(){this.#B(),this.#H(),this.#w&&(this.#C(),this.#O(),this.#z()),l.updateNotes()}}).loadRoadbook()}();
/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 5.0.0-dev
 * Build 113 - Sun Jan 11 2026 12:06:15 GMT+0100 (heure normale dâ€™Europe centrale)
 * Copyright 2019 2026 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
*/


class HTMLSanitizerData{#t=new Map;constructor(){Object.freeze(this),this.#t.set("a",["href","target"]),this.#t.set("div",[]),this.#t.set("del",[]),this.#t.set("em",[]),this.#t.set("figcaption",[]),this.#t.set("figure",[]),this.#t.set("h1",[]),this.#t.set("h2",[]),this.#t.set("h3",[]),this.#t.set("h4",[]),this.#t.set("h5",[]),this.#t.set("h6",[]),this.#t.set("hr",[]),this.#t.set("img",["src","alt","width","height"]),this.#t.set("ins",[]),this.#t.set("li",[]),this.#t.set("mark",[]),this.#t.set("ol",[]),this.#t.set("p",[]),this.#t.set("s",[]),this.#t.set("small",[]),this.#t.set("strong",[]),this.#t.set("span",[]),this.#t.set("sub",[]),this.#t.set("sup",[]),this.#t.set("ul",[]),this.#t.set("svg",["xmlns","viewBox","class"]),this.#t.set("text",["x","y","text-anchor"]),this.#t.set("polyline",["points","class","transform"]),this.#t.set("#text",[])}getValidAttributesNames(t){return this.#t.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#t.get(e)?e:""}}class HtmlStringValidationResult{#e;#o;constructor(t,e){Object.freeze(this),this.#e=t,this.#o=e}get htmlString(){return this.#e}get errorsString(){return this.#o}}class UrlValidationResult{#s;#o;constructor(t,e){Object.freeze(this),this.#s=t,this.#o=e}get url(){return this.#s}get errorsString(){return this.#o}}const HTTP_STATUS_OK=200,NOT_FOUND=-1,ONE=1,SVG_NS="http://www.w3.org/2000/svg",ZERO=0;class HTMLSanitizer{#r="";#n="";static#a=new HTMLSanitizerData;#i(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#l(t,e){const o=this.sanitizeToUrl(t,e).url;""===o&&""!==t?this.#n+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#r+=" "+e+'="'+o+'"'}#d(t,e){HTMLSanitizer.#a.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(this.#r+=" "+e+'="'+this.#i(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))})}#h(t,e){t.hasAttribute("target")&&(this.#r+=' rel="noopener noreferrer"'),HTMLSanitizer.#a.getValidAttributesNames(e).forEach(e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#l(t.getAttribute(e),e):this.#r+=" "+e+'="'+this.#i(t.getAttribute(e))+'"',t.removeAttribute(e))})}#c(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#n+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#u(t){const e=t.childNodes;for(let o=0;o<e.length;o++){const e=t.childNodes[o],s=HTMLSanitizer.#a.getValidNodeName(e.nodeName);""===s?this.#n+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===s?this.#r+=this.#i(e.nodeValue):(this.#r+="<"+s,"svg"===s||"text"===s||"polyline"===s?this.#d(e,s):this.#h(e,s),this.#r+=">",this.#u(e),this.#r+="</"+s+">",e.attributes&&this.#c(e))}}#g(t,e){const o=document.createElementNS(SVG_NS,e);return HTMLSanitizer.#a.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(o.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))}),o}#m(t,e){const o=document.createElement(e);return HTMLSanitizer.#a.getValidAttributesNames(e).forEach(e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const s=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==s&&o.setAttribute(e,s)}else o.setAttribute(e,t.getAttribute(e))}),t.hasAttribute("target")&&o.setAttribute("rel","noopener noreferrer"),o}#v(t,e){const o=t.childNodes;for(let s=0;s<o.length;s++){const o=t.childNodes[s],r=HTMLSanitizer.#a.getValidNodeName(o.nodeName);if("#text"===r)e.appendChild(document.createTextNode(o.nodeValue));else if(""!==r){const t="svg"===r||"text"===r||"polyline"===r?this.#g(o,r):this.#m(o,r);e.appendChild(t),this.#v(o,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const o=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),s=new DocumentFragment;o&&"#document"===o.nodeName?(this.#v(o.body.firstChild,s),e.appendChild(s)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#v(t,e),e}sanitizeToHtmlString(t){this.#r="",this.#n="";const e=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","à¨€")+"</div>","text/html");return e&&"#document"===e.nodeName?(this.#u(e.body.firstChild),new HtmlStringValidationResult(this.#r,this.#n)):new HtmlStringValidationResult("","Parsing error")}sanitizeToUrl(t,e){const o=e||"href",s=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!s||"#document"!==s.nodeName)return new UrlValidationResult("","Parsing error");const r=s.body.firstChild;let n="";for(let t=0;t<r.childNodes.length;t++){if("#text"!==r.childNodes[t].nodeName)return new UrlValidationResult("","Invalid characters found in the url");n+=r.childNodes[t].nodeValue}if(n=n.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),n!==t)return new UrlValidationResult("","Invalid characters found in the url");const a=["https:"];if("http:"!==window.location.protocol&&"href"!==o||a.push("http:"),"href"===o){a.push("mailto:"),a.push("sms:"),a.push("tel:");const t=n.match(/^\u0023\w*/);if(t&&n===t[0])return new UrlValidationResult(n,"")}"src"===o&&a.push("data:");let i=null;try{i=new URL(n)}catch{return new UrlValidationResult("","Invalid url string")}if(-1===a.indexOf(i.protocol))return new UrlValidationResult("","Invalid protocol "+i.protocol);if(-1!==["sms:","tel:"].indexOf(i.protocol))return i.pathname.match(/^\+[0-9,*,\u0023]*$/)?new UrlValidationResult(n,""):new UrlValidationResult("","Invalid sms: or tel: url");try{encodeURIComponent(i.href)}catch{return new UrlValidationResult("","Invalid character in url")}return new UrlValidationResult(n,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const o=e.body.firstChild;let s="";for(let t=0;t<o.childNodes.length;t++){if("#text"!==o.childNodes[t].nodeName)return"";s+=o.childNodes[t].nodeValue}return s=s.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),s}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const theHTMLSanitizer=new HTMLSanitizer;class Translator{#p=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach(t=>this.#p.set(t.msgid,theHTMLSanitizer.sanitizeToJsString(t.msgstr)))}getText(t,e){let o=this.#p.get(t);return e&&o&&Object.getOwnPropertyNames(e).forEach(t=>o=o.replace("{"+t+"}",e[t])),o||t}}const theTranslator=new Translator;class IndexedDb{#w;#b;#f;static get#N(){return 1}#E(t,e){if(this.#w)return void t();const o=window.indexedDB.open("TravelNotesDb",IndexedDb.#N);o.onerror=()=>{this.#w=null,e(new Error("Not possible to open the db"))},o.onsuccess=e=>{this.#w=e.target.result,t()},o.onupgradeneeded=t=>{this.#w=t.target.result,this.#w.createObjectStore("Travels",{keyPath:"UUID"})}}#S(t,e){if(!this.#w)return void e(new Error("Database not opened"));const o=this.#w.transaction(["Travels"],"readonly");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").get(this.#b).onsuccess=e=>t(e.target.result?e.target.result.data:null)}#y(t,e){if(!this.#w)return void e(new Error("Database not opened"));const o=this.#w.transaction(["Travels"],"readwrite");o.onerror=()=>e(new Error("Transaction error"));o.objectStore("Travels").put({UUID:this.#b,data:this.#f}).onsuccess=()=>t()}#T(){this.#w.close(),this.#w=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise((t,e)=>this.#E(t,e))}getReadPromise(t){return this.#b=t,new Promise((t,e)=>this.#S(t,e))}getWritePromise(t,e){return this.#b=t,this.#f=e,new Promise((t,e)=>this.#y(t,e))}closeDb(t){if(!this.#w)return;if(!t)return void this.#T();const e=this.#w.transaction(["Travels"],"readwrite");e.onerror=()=>{};const o=e.objectStore("Travels").delete(t);o.onerror=()=>this.#T(),o.onsuccess=()=>this.#T()}}const theIndexedDb=new IndexedDb;class RoadbookUpdater{#M;#L;#U;#R;#k;#A;#x(t,e){document.querySelectorAll(t).forEach(t=>{e?t.classList.remove("travelnotes-hidden"):t.classList.add("travelnotes-hidden")})}#D(t){document.querySelectorAll(".travelnotes-roadbook-route-profile").forEach(e=>{t?e.classList.remove("travelnotes-hidden"):e.classList.add("travelnotes-hidden")})}#I(t){t?(this.#M.classList.add("travelnotes-small-notes"),this.#M.classList.remove("travelnotes-big-notes")):(this.#M.classList.add("travelnotes-big-notes"),this.#M.classList.remove("travelnotes-small-notes")),document.querySelectorAll(".travelnotes-roadbook-travel-notes-icon-cell, .travelnotes-roadbook-route-maneuvers-and-notes-icon-cell").forEach(e=>{e.style.width=t?"6cm":e.dataset.tanWidth,e.style.height=t?"6cm":e.dataset.tanHeight})}constructor(){Object.freeze(this),this.#M=document.getElementById("travelnotes"),this.#L=!0,this.#U=!0,this.#R=!1,this.#k=!1,this.#A=!0}get showTravelNotes(){return this.#L}set showTravelNotes(t){this.#L=t,this.#x(".travelnotes-roadbook-travel-notes-row",t)}get showRouteNotes(){return this.#U}set showRouteNotes(t){this.#U=t,this.#x(".travelnotes-roadbook-route-notes-row",t)}get showManeuversNotes(){return this.#R}set showManeuversNotes(t){this.#R=t,this.#x(".travelnotes-roadbook-route-maneuvers-row",t)}get showSmallNotes(){return this.#k}set showSmallNotes(t){this.#k=t,this.#I(t)}get showProfiles(){return this.#A}set showProfiles(t){this.#A=t,this.#D(t)}updateNotesAndProfiles(){this.showTravelNotes=this.#L,this.showRouteNotes=this.#U,this.showManeuversNotes=this.#R,this.showSmallNotes=this.#k,this.showProfiles=this.#A}updateRoadbook(t){this.#M.innerHTML=t;const e=document.querySelector(".travelnotes-roadbook-travel-header-name");e&&(document.title=""===e.textContent?"roadbook":e.textContent+" - roadbook"),document.querySelectorAll(".travelnotes-roadbook-travel-notes-icon-cell, .travelnotes-roadbook-route-maneuvers-and-notes-icon-cell").forEach(t=>{t.style.width=t.dataset.tanWidth,t.style.height=t.dataset.tanHeight}),this.updateNotesAndProfiles()}}const theRoadbookUpdater=new RoadbookUpdater;class ShowManeuverNotesChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theRoadbookUpdater.showManeuversNotes=t.target.checked}}class ShowRouteNotesChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theRoadbookUpdater.showRouteNotes=t.target.checked}}class ShowTravelNotesChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theRoadbookUpdater.showTravelNotes=t.target.checked}}class ShowSmallNotesChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theRoadbookUpdater.showSmallNotes=t.target.checked}}class ShowProfilesChangeEL{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),theRoadbookUpdater.showProfiles=t.target.checked}}class PrintRoadbookClickEL{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class SaveFileButtonClickEL{constructor(){Object.freeze(this)}handleEvent(){try{const t=document.querySelector(".travelnotes-roadbook-travel-header-name").textContent+"-Roadbook.html",e=document.getElementById("travelnotes-roadbook-buttons-container"),o=e.removeChild(document.getElementById("travelnotes-save-button")),s=window.URL.createObjectURL(new File(["<!DOCTYPE html>",document.documentElement.outerHTML],t,{type:"text/plain"})),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",t),r.style.display="none",r.click(),window.URL.revokeObjectURL(s),e.appendChild(o)}catch(t){t instanceof Error&&console.error(t)}}}class StorageEL{#b=null;constructor(t){this.#b=t}handleEvent(){theIndexedDb.getReadPromise(this.#b).then(t=>{t?theRoadbookUpdater.updateRoadbook(t):theRoadbookUpdater.updateRoadbook("")}).catch(t=>{t instanceof Error&&console.error(t)})}}class RoadbookLoader{#b=null;#H="fr";#P=null;#z(){document.getElementById("travelnotes-travel-show-notes").checked=theRoadbookUpdater.showTravelNotes,document.getElementById("travelnotes-routes-show-notes").checked=theRoadbookUpdater.showRouteNotes,document.getElementById("travelnotes-routes-show-maneuvers").checked=theRoadbookUpdater.showManeuversNotes,document.getElementById("travelnotes-routes-show-small-notes").checked=theRoadbookUpdater.showSmallNotes,document.getElementById("travelnotes-routes-show-profiles").checked=theRoadbookUpdater.showProfiles}#C(){document.getElementById("travelnotes-travel-show-notes").addEventListener("change",new ShowTravelNotesChangeEL),document.getElementById("travelnotes-routes-show-notes").addEventListener("change",new ShowRouteNotesChangeEL),document.getElementById("travelnotes-routes-show-maneuvers").addEventListener("change",new ShowManeuverNotesChangeEL),document.getElementById("travelnotes-routes-show-small-notes").addEventListener("change",new ShowSmallNotesChangeEL),document.getElementById("travelnotes-routes-show-profiles").addEventListener("change",new ShowProfilesChangeEL),document.getElementById("travelnotes-print-button").addEventListener("click",new PrintRoadbookClickEL)}#O(){this.#P=document.createElement("div"),this.#P.id="travelnotes-save-button",this.#P.textContent="ðŸ’¾",this.#P.className="travelnotes-roadbook-button",this.#P.addEventListener("click",new SaveFileButtonClickEL),document.getElementById("travelnotes-roadbook-buttons-container").appendChild(this.#P)}#B(){theIndexedDb.getOpenPromise().then(()=>theIndexedDb.getReadPromise(this.#b)).then(t=>theRoadbookUpdater.updateRoadbook(t)).catch(t=>{t instanceof Error&&console.error(t)}),window.addEventListener("storage",new StorageEL(this.#b)),window.addEventListener("unload",()=>theIndexedDb.closeDb())}#V(){fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+this.#H.toUpperCase()+".json").then(t=>{200===t.status&&t.ok&&t.json().then(t=>theTranslator.setTranslations(t)).then(()=>this.#j()).catch(t=>{t instanceof Error&&console.error(t)})}).catch()}#j(){document.getElementById("travelnotes-travel-show-notes-label").textContent=theTranslator.getText("RoadbookLoader - show travel notes"),document.getElementById("travelnotes-routes-show-maneuvers-label").textContent=theTranslator.getText("RoadbookLoader - show maneuver"),document.getElementById("travelnotes-routes-show-notes-label").textContent=theTranslator.getText("RoadbookLoader - show routes notes"),document.getElementById("travelnotes-routes-show-small-notes-label").textContent=theTranslator.getText("RoadbookLoader - show small routes notes"),document.getElementById("travelnotes-routes-show-profiles-label").textContent=theTranslator.getText("RoadbookLoader - show profiles")}constructor(){Object.freeze(this);let t=new URLSearchParams(document.location.search.substring(1));this.#b=t.get("page"),this.#H=t.get("lng")||"fr"}loadRoadbook(){this.#z(),this.#C(),this.#b&&(this.#O(),this.#B(),this.#V()),theRoadbookUpdater.updateNotesAndProfiles()}}(new RoadbookLoader).loadRoadbook();
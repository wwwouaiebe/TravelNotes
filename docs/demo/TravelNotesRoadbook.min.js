/**
 * 
 * @source: https://github.com/wwwouaiebe/TravelNotes
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * travelnotes - version 5.0.0-dev
 * Build 43 - Mon Jan 05 2026 15:38:07 GMT+0100 (heure normale dâ€™Europe centrale)
 * Copyright 2019 2026 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
*/


!function(){"use strict";class t{#t=new Map;constructor(){Object.freeze(this),this.#t.set("a",["href","target"]),this.#t.set("div",[]),this.#t.set("del",[]),this.#t.set("em",[]),this.#t.set("figcaption",[]),this.#t.set("figure",[]),this.#t.set("h1",[]),this.#t.set("h2",[]),this.#t.set("h3",[]),this.#t.set("h4",[]),this.#t.set("h5",[]),this.#t.set("h6",[]),this.#t.set("hr",[]),this.#t.set("img",["src","alt","width","height"]),this.#t.set("ins",[]),this.#t.set("li",[]),this.#t.set("mark",[]),this.#t.set("ol",[]),this.#t.set("p",[]),this.#t.set("s",[]),this.#t.set("small",[]),this.#t.set("strong",[]),this.#t.set("span",[]),this.#t.set("sub",[]),this.#t.set("sup",[]),this.#t.set("ul",[]),this.#t.set("svg",["xmlns","viewBox","class"]),this.#t.set("text",["x","y","text-anchor"]),this.#t.set("polyline",["points","class","transform"]),this.#t.set("#text",[])}getValidAttributesNames(t){return this.#t.get(t).concat(["id","class","dir","title"])}getValidNodeName(t){const e=t.toLowerCase();return this.#t.get(e)?e:""}}class e{#e;#s;constructor(t,e){Object.freeze(this),this.#e=t,this.#s=e}get htmlString(){return this.#e}get errorsString(){return this.#s}}class s{#o;#s;constructor(t,e){Object.freeze(this),this.#o=t,this.#s=e}get url(){return this.#o}get errorsString(){return this.#s}}class o{#r="";#n="";static#i=new t;#a(t){return t.replaceAll(/\u003c/g,"&lt;").replaceAll(/\u003e/g,"&gt;").replaceAll(/\u0022/g,"&quot;").replaceAll(/\u0027/g,"&apos;").replaceAll(/\u0a00/g,"&nbsp;")}#l(t,e){const s=this.sanitizeToUrl(t,e).url;""===s&&""!==t?this.#n+="\nAn invalid url ("+t+") was removed from a "+e+" attribute":this.#r+=" "+e+'="'+s+'"'}#d(t,e){o.#i.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(this.#r+=" "+e+'="'+this.#a(t.getAttributeNS(null,e))+'"',t.removeAttributeNS(null,e))})}#h(t,e){t.hasAttribute("target")&&(this.#r+=' rel="noopener noreferrer"'),o.#i.getValidAttributesNames(e).forEach(e=>{t.hasAttribute(e)&&("href"===e||"src"===e?this.#l(t.getAttribute(e),e):this.#r+=" "+e+'="'+this.#a(t.getAttribute(e))+'"',t.removeAttribute(e))})}#c(t){for(let e=0;e<t.attributes.length;e++)"rel"!==t.attributes[e].name&&(this.#n+="\nAn unsecure attribute "+t.attributes[e].name+'="'+t.attributes[e].value+'" was removed.')}#u(t){const e=t.childNodes;for(let s=0;s<e.length;s++){const e=t.childNodes[s],r=o.#i.getValidNodeName(e.nodeName);""===r?this.#n+="\nAn invalid tag "+e.nodeName+" was removed":"#text"===r?this.#r+=this.#a(e.nodeValue):(this.#r+="<"+r,"svg"===r||"text"===r||"polyline"===r?this.#d(e,r):this.#h(e,r),this.#r+=">",this.#u(e),this.#r+="</"+r+">",e.attributes&&this.#c(e))}}#g(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg",e);return o.#i.getValidAttributesNames(e).forEach(e=>{t.hasAttributeNS(null,e)&&(s.setAttributeNS(null,e,t.getAttributeNS(null,e)),t.removeAttributeNS(null,e))}),s}#m(t,e){const s=document.createElement(e);return o.#i.getValidAttributesNames(e).forEach(e=>{if(t.hasAttribute(e))if("href"===e||"src"===e){const o=this.sanitizeToUrl(t.getAttribute(e),e).url;""!==o&&s.setAttribute(e,o)}else s.setAttribute(e,t.getAttribute(e))}),t.hasAttribute("target")&&s.setAttribute("rel","noopener noreferrer"),s}#v(t,e){const s=t.childNodes;for(let r=0;r<s.length;r++){const s=t.childNodes[r],n=o.#i.getValidNodeName(s.nodeName);if("#text"===n)e.appendChild(document.createTextNode(s.nodeValue));else if(""!==n){const t="svg"===n||"text"===n||"polyline"===n?this.#g(s,n):this.#m(s,n);e.appendChild(t),this.#v(s,t)}}}constructor(){Object.freeze(this)}sanitizeToHtmlElement(t,e){const s=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html"),o=new DocumentFragment;s&&"#document"===s.nodeName?(this.#v(s.body.firstChild,o),e.appendChild(o)):e.textContent=""}clone(t){const e=document.createElement(t.tagName);return this.#v(t,e),e}sanitizeToHtmlString(t){this.#r="",this.#n="";const s=(new DOMParser).parseFromString("<div>"+t.replace("&nbsp;","à¨€")+"</div>","text/html");return s&&"#document"===s.nodeName?(this.#u(s.body.firstChild),new e(this.#r,this.#n)):new e("","Parsing error")}sanitizeToUrl(t,e){const o=e||"href",r=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!r||"#document"!==r.nodeName)return new s("","Parsing error");const n=r.body.firstChild;let i="";for(let t=0;t<n.childNodes.length;t++){if("#text"!==n.childNodes[t].nodeName)return new s("","Invalid characters found in the url");i+=n.childNodes[t].nodeValue}if(i=i.replaceAll(/</g,"").replaceAll(/>/g,"").replaceAll(/"/g,"").replaceAll(/\u0027/g,"").replaceAll(/&lt;/g,"").replaceAll(/&gt;/g,"").replaceAll(/&quot;/g,"").replaceAll(/&apos;/g,"").replaceAll(/%3C/g,"").replaceAll(/%3c/g,"").replaceAll(/%3E/g,"").replaceAll(/%3e/g,"").replaceAll(/%22/g,"").replaceAll(/%27/g,""),i!==t)return new s("","Invalid characters found in the url");const a=["https:"];if("http:"!==window.location.protocol&&"href"!==o||a.push("http:"),"href"===o){a.push("mailto:"),a.push("sms:"),a.push("tel:");const t=i.match(/^\u0023\w*/);if(t&&i===t[0])return new s(i,"")}"src"===o&&a.push("data:");let l=null;try{l=new URL(i)}catch{return new s("","Invalid url string")}if(-1===a.indexOf(l.protocol))return new s("","Invalid protocol "+l.protocol);if(-1!==["sms:","tel:"].indexOf(l.protocol))return l.pathname.match(/^\+[0-9,*,\u0023]*$/)?new s(i,""):new s("","Invalid sms: or tel: url");try{encodeURIComponent(l.href)}catch{return new s("","Invalid character in url")}return new s(i,"")}sanitizeToJsString(t){const e=(new DOMParser).parseFromString("<div>"+t+"</div>","text/html");if(!e||"#document"!==e.nodeName)return"";const s=e.body.firstChild;let o="";for(let t=0;t<s.childNodes.length;t++){if("#text"!==s.childNodes[t].nodeName)return"";o+=s.childNodes[t].nodeValue}return o=o.replaceAll(/</g,"â‰º").replaceAll(/>/g,"â‰»").replaceAll(/"/g,"â€³").replaceAll(/\u0027/g,"â€²"),o}sanitizeToColor(t){const e=t.match(/^\u0023[0-9,A-F,a-f]{6}$/);return e?e[0]:null}}const r=new o;const n=new class{#w=new Map;constructor(){Object.freeze(this)}setTranslations(t){t.forEach(t=>this.#w.set(t.msgid,r.sanitizeToJsString(t.msgstr)))}getText(t,e){let s=this.#w.get(t);return e&&s&&Object.getOwnPropertyNames(e).forEach(t=>s=s.replace("{"+t+"}",e[t])),s||t}};class i{#p;#b;#f;static get#N(){return 1}#y(t,e){if(this.#p)return void t();const s=window.indexedDB.open("TravelNotesDb",i.#N);s.onerror=()=>{this.#p=null,e(new Error("Not possible to open the db"))},s.onsuccess=e=>{this.#p=e.target.result,t()},s.onupgradeneeded=t=>{this.#p=t.target.result,this.#p.createObjectStore("Travels",{keyPath:"UUID"})}}#E(t,e){if(!this.#p)return void e(new Error("Database not opened"));const s=this.#p.transaction(["Travels"],"readonly");s.onerror=()=>e(new Error("Transaction error"));s.objectStore("Travels").get(this.#b).onsuccess=e=>t(e.target.result?e.target.result.data:null)}#S(t,e){if(!this.#p)return void e(new Error("Database not opened"));const s=this.#p.transaction(["Travels"],"readwrite");s.onerror=()=>e(new Error("Transaction error"));s.objectStore("Travels").put({UUID:this.#b,data:this.#f}).onsuccess=()=>t()}#M(){this.#p.close(),this.#p=null}constructor(){Object.freeze(this)}getOpenPromise(){return new Promise((t,e)=>this.#y(t,e))}getReadPromise(t){return this.#b=t,new Promise((t,e)=>this.#E(t,e))}getWritePromise(t,e){return this.#b=t,this.#f=e,new Promise((t,e)=>this.#S(t,e))}closeDb(t){if(!this.#p)return;if(!t)return void this.#M();const e=this.#p.transaction(["Travels"],"readwrite");e.onerror=()=>{};const s=e.objectStore("Travels").delete(t);s.onerror=()=>this.#M(),s.onsuccess=()=>this.#M()}}const a=new i;const l=new class{#A;#T;#x;#D;#L;#I;#k(t,e){document.querySelectorAll(t).forEach(t=>{e?t.classList.remove("travelnotes-hidden"):t.classList.add("travelnotes-hidden")})}#U(t){document.querySelectorAll(".travelnotes-roadbook-route-profile").forEach(e=>{t?e.classList.remove("travelnotes-hidden"):e.classList.add("travelnotes-hidden")})}#P(t){t?(this.#A.classList.add("travelnotes-small-notes"),this.#A.classList.remove("travelnotes-big-notes")):(this.#A.classList.add("travelnotes-big-notes"),this.#A.classList.remove("travelnotes-small-notes")),document.querySelectorAll(".travelnotes-roadbook-travel-notes-icon-cell, .travelnotes-roadbook-route-maneuvers-and-notes-icon-cell").forEach(e=>{e.style.width=t?"6cm":e.dataset.tanWidth,e.style.height=t?"6cm":e.dataset.tanHeight})}constructor(){Object.freeze(this),this.#A=document.getElementById("travelnotes"),this.#T=!0,this.#x=!0,this.#D=!1,this.#L=!1,this.#I=!0}get showTravelNotes(){return this.#T}set showTravelNotes(t){this.#T=t,this.#k(".travelnotes-roadbook-travel-notes-row",t)}get showRouteNotes(){return this.#x}set showRouteNotes(t){this.#x=t,this.#k(".travelnotes-roadbook-route-notes-row",t)}get showManeuversNotes(){return this.#D}set showManeuversNotes(t){this.#D=t,this.#k(".travelnotes-roadbook-route-maneuvers-row",t)}get showSmallNotes(){return this.#L}set showSmallNotes(t){this.#L=t,this.#P(t)}get showProfiles(){return this.#I}set showProfiles(t){this.#I=t,this.#U(t)}updateNotesAndProfiles(){this.showTravelNotes=this.#T,this.showRouteNotes=this.#x,this.showManeuversNotes=this.#D,this.showSmallNotes=this.#L,this.showProfiles=this.#I}updateRoadbook(t){this.#A.innerHTML=t;const e=document.querySelector(".travelnotes-roadbook-travel-header-name");e&&(document.title=""===e.textContent?"roadbook":e.textContent+" - roadbook"),document.querySelectorAll(".travelnotes-roadbook-travel-notes-icon-cell, .travelnotes-roadbook-route-maneuvers-and-notes-icon-cell").forEach(t=>{t.style.width=t.dataset.tanWidth,t.style.height=t.dataset.tanHeight}),this.updateNotesAndProfiles()}};class d{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),l.showManeuversNotes=t.target.checked}}class h{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),l.showRouteNotes=t.target.checked}}class c{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),l.showTravelNotes=t.target.checked}}class u{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),l.showSmallNotes=t.target.checked}}class g{constructor(){Object.freeze(this)}handleEvent(t){t.stopPropagation(),l.showProfiles=t.target.checked}}class m{constructor(){Object.freeze(this)}handleEvent(){window.print()}}class v{constructor(){Object.freeze(this)}handleEvent(){try{const t=document.querySelector(".travelnotes-roadbook-travel-header-name").textContent+"-Roadbook.html",e=document.getElementById("travelnotes-roadbook-buttons-container"),s=e.removeChild(document.getElementById("travelnotes-save-button")),o=window.URL.createObjectURL(new File(["<!DOCTYPE html>",document.documentElement.outerHTML],t,{type:"text/plain"})),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download",t),r.style.display="none",r.click(),window.URL.revokeObjectURL(o),e.appendChild(s)}catch(t){t instanceof Error&&console.error(t)}}}class w{#b=null;constructor(t){this.#b=t}handleEvent(){a.getReadPromise(this.#b).then(t=>{t?l.updateRoadbook(t):l.updateRoadbook("")}).catch(t=>{t instanceof Error&&console.error(t)})}}(new class{#b=null;#R="fr";#B=null;#H(){document.getElementById("travelnotes-travel-show-notes").checked=l.showTravelNotes,document.getElementById("travelnotes-routes-show-notes").checked=l.showRouteNotes,document.getElementById("travelnotes-routes-show-maneuvers").checked=l.showManeuversNotes,document.getElementById("travelnotes-routes-show-small-notes").checked=l.showSmallNotes,document.getElementById("travelnotes-routes-show-profiles").checked=l.showProfiles}#O(){document.getElementById("travelnotes-travel-show-notes").addEventListener("change",new c),document.getElementById("travelnotes-routes-show-notes").addEventListener("change",new h),document.getElementById("travelnotes-routes-show-maneuvers").addEventListener("change",new d),document.getElementById("travelnotes-routes-show-small-notes").addEventListener("change",new u),document.getElementById("travelnotes-routes-show-profiles").addEventListener("change",new g),document.getElementById("travelnotes-print-button").addEventListener("click",new m)}#z(){this.#B=document.createElement("div"),this.#B.id="travelnotes-save-button",this.#B.textContent="ðŸ’¾",this.#B.className="travelnotes-roadbook-button",this.#B.addEventListener("click",new v),document.getElementById("travelnotes-roadbook-buttons-container").appendChild(this.#B)}#C(){a.getOpenPromise().then(()=>a.getReadPromise(this.#b)).then(t=>l.updateRoadbook(t)).catch(t=>{t instanceof Error&&console.error(t)}),window.addEventListener("storage",new w(this.#b)),window.addEventListener("unload",()=>a.closeDb())}#j(){fetch(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"TravelNotes"+this.#R.toUpperCase()+".json").then(t=>{200===t.status&&t.ok&&t.json().then(t=>n.setTranslations(t)).then(()=>this.#V()).catch(t=>{t instanceof Error&&console.error(t)})}).catch()}#V(){document.getElementById("travelnotes-travel-show-notes-label").textContent=n.getText("RoadbookLoader - show travel notes"),document.getElementById("travelnotes-routes-show-maneuvers-label").textContent=n.getText("RoadbookLoader - show maneuver"),document.getElementById("travelnotes-routes-show-notes-label").textContent=n.getText("RoadbookLoader - show routes notes"),document.getElementById("travelnotes-routes-show-small-notes-label").textContent=n.getText("RoadbookLoader - show small routes notes"),document.getElementById("travelnotes-routes-show-profiles-label").textContent=n.getText("RoadbookLoader - show profiles")}constructor(){Object.freeze(this);let t=new URLSearchParams(document.location.search.substring(1));this.#b=t.get("page"),this.#R=t.get("lng")||"fr"}loadRoadbook(){this.#H(),this.#O(),this.#b&&(this.#z(),this.#C(),this.#j()),l.updateNotesAndProfiles()}}).loadRoadbook()}();